<!-- path: hnvtx/schemas/index.ts -->
```typescript
export * from "@/schemas/auth";
export * from "@/schemas/masters";
export * from "@/schemas/core";
export * from "@/schemas/system-specific";
export * from "@/schemas/helpers";
export * from "@/schemas/user";
export * from "@/schemas/form-specific";

```

<!-- path: hnvtx/schemas/helpers.ts -->
```typescript
import z from "zod";

export const ipv4Regex =
  /^((25[0-5]|(2[0-4]|1\d|[1-9]|)\d)\.){3}(25[0-5]|(2[0-4]|1\d|[1-9]|)\d)$/;
export const ipValidation = z
  .string()
  .regex(ipv4Regex, { message: "Invalid IPv4 address format." });

// 2. Create a preprocessor for OPTIONAL numbers.
export const emptyStringToNumber = z.preprocess(
  (val) => (val === "" || val === null ? null : Number(val)),
  z.number().optional().nullable()
);

// 3. Create a preprocessor for REQUIRED numbers.
export const requiredStringToNumber = z.preprocess((val) => {
  if (val === "" || val === null || val === undefined) return undefined;
  return Number(val); // ensure cast
}, z.number({ error: (issue) => (issue.input === undefined ? "This field is required" : "Not a number") }));

// A reusable schema for optional IP addresses that can be an empty string
export const optionalIpValidation = z.union([
  z.string().regex(ipv4Regex, { message: "Invalid IPv4 address format." }),
  z.string().length(0), // Allows empty string
])
.optional()
.nullable()
.transform(val => val === "" ? null : val); // Transform empty string to null for the database

//  Create a preprocessor for optional dates
export const optionalDate = z.preprocess(
  (val) => {
    if (val === "" || val === null || val === undefined) return undefined;
    return new Date(val as string);
  },
  z.date().optional().nullable()
);


export const requiredDate = z.preprocess(
  (val) => {
    if (val === "" || val === null || val === undefined) return undefined;
    return new Date(val as string);
  },
  z.date({
    error: (iss) => iss.input === undefined ? "This field is required" : "Not a valid date"
  })
);

export const optionalDateString = z.iso.datetime().nullable().optional();
```

<!-- path: hnvtx/schemas/user.ts -->
```typescript
// =================================================================
// USER MANAGEMENT
// =================================================================

import z from "zod";

export const userProfileSchema = z.object({
  id: z.uuid().optional(),
  first_name: z.string().min(1, { message: "First name cannot be empty." }).nullable(),
  last_name: z.string().min(1, { message: "Last name cannot be empty." }).nullable(),
  avatar_url: z.url({ message: "Invalid URL format." })
    .optional()
    .or(z.literal("")).nullable(),
  phone_number: z
    .string()
    .regex(/^\+?[1-9]\d{1,14}$/, "Invalid phone number format.")
    .optional()
    .or(z.literal(""))
    .nullable(),
  date_of_birth: z.coerce
    .date()
    .optional()
    .nullable()
    .refine(
      (date) => !date || (date > new Date("1900-01-01") && date < new Date()),
      {
        message: "Please enter a valid date of birth.",
      }
    ),
  role: z
    .enum([
      "admin",
      "viewer",
      "cpan_admin",
      "maan_admin",
      "sdh_admin",
      "vmux_admin",
      "mng_admin",
    ])
    .default("viewer"),
  designation: z.string().optional().nullable(),
  address: z
    .object({
      street: z.string().optional(),
      city: z.string().optional(),
      state: z.string().optional(),
      zip_code: z.string().optional(),
      country: z.string().optional(),
    })
    .default({})
    .optional().nullable(),
  preferences: z.object({
    language: z.string().optional(),
    notifications: z.boolean().optional(),
  })
  .default({})
  .optional().nullable(),
  status: z.enum(["active", "inactive", "suspended"]).default("inactive"),
  created_at: z.coerce.date().optional(),
  updated_at: z.coerce.date().optional(),
});


```

<!-- path: hnvtx/schemas/core.ts -->
```typescript
// =================================================================
// CORE INFRASTRUCTURE
// =================================================================

import z from 'zod';
import {
  emptyStringToNumber,
  ipValidation,
  optionalDate,
  optionalDateString,
  requiredStringToNumber,
} from '@/schemas/helpers';

export const ringSchema = z.object({
  id: z.uuid().optional(),
  name: z.string().min(1, { message: 'Ring name is required.' }),
  ring_type_id: z.uuid().optional().nullable(),
  description: z.string().optional().nullable(),
  maintenance_terminal_id: z.uuid().optional().nullable(),
  total_nodes: z.number().int().default(0).optional(),
  status: z.boolean().default(true).optional(),
  created_at: optionalDate,
  updated_at: optionalDate,
});

export const nodeSchema = z.object({
  id: z.uuid().optional(),
  name: z.string().min(1, { message: 'Node name is required.' }),
  node_type_id: z.uuid().optional().nullable(),
  latitude: requiredStringToNumber,
  longitude: requiredStringToNumber,
  maintenance_terminal_id: z.uuid().optional().nullable(),
  remark: z.string().optional().nullable(),
  status: z.boolean().default(true).optional(),
  created_at: optionalDate,
  updated_at: optionalDate,
});

export const ofcCableSchema = z
  .object({
    id: z.uuid().optional(),
    route_name: z.string().min(1, { message: 'Route name is required.' }),
    sn_id: z.uuid({ message: 'Starting node is required.' }),
    en_id: z.uuid({ message: 'Ending node is required.' }),
    ofc_type_id: z.uuid({ message: 'OFC type is required.' }),
    // capacity must be a positive integer
    capacity: requiredStringToNumber.pipe(
      z
        .number()
        .int({ message: 'Capacity must be an integer.' })
        .refine((val) => val > 0, {
          message: 'Capacity must be a positive integer.',
        })
    ),
    // current_rkm must be a positive number
    current_rkm: emptyStringToNumber.pipe(
      z.number().refine((val) => val >= 0, {
        message: 'Current RKM must be a positive number.',
      })
    ),
    transnet_id: z.string().optional().nullable(),
    // transnet_rkm must be a positive number
    transnet_rkm: emptyStringToNumber.pipe(
      z.number().refine((val) => val >= 0, {
        message: 'Transnet RKM must be a positive number.',
      })
    ),
    asset_no: z.string().optional().nullable(),
    maintenance_terminal_id: z.uuid().optional().nullable(),
    commissioned_on: optionalDate,
    remark: z.string().optional().nullable(),
    status: z.boolean().default(true).optional(),
    created_at: optionalDate,
    updated_at: optionalDate,
    total_count: z.number().int().optional().nullable(),
  })
  .superRefine((data, ctx) => {
    const a = data.sn_id;
    const b = data.en_id;
    // Run this check only when both IDs are present
    if (!a || !b) return;
    if (a === b) {
      ctx.addIssue({
        code: 'custom',
        message: 'Ending node must be different from starting node.',
        path: ['en_id'],
      });
    }
  });

export const systemSchema = z.object({
  commissioned_on: optionalDateString,
  created_at: optionalDateString,
  id: z.string().optional(),
  ip_address: z.unknown().nullable().optional(),
  maintenance_terminal_id: z.string().nullable().optional(),
  node_id: z.string(),
  remark: z.string().nullable().optional(),
  s_no: z.string().nullable().optional(),
  status: z.boolean().nullable().optional(),
  system_name: z.string().nullable().optional(),
  system_type_id: z.string(),
  updated_at: optionalDateString,
});

export const ofcConnectionSchema = z.object({
  // Primary key and foreign keys
  id: z.uuid().optional(),
  ofc_id: z.uuid({ message: 'OFC Cable is required.' }),
  logical_path_id: z.uuid().optional().nullable(),
  system_id: z.uuid().optional().nullable(),

  // Fiber connection details
  fiber_no_sn: z.number().int({ message: 'Start Node Fiber No. is required.' }),
  fiber_no_en: z.number().int().optional().nullable(),

  // Fields for logical path ordering and type
  path_segment_order: z.number().int().optional().nullable(),
  connection_category: z.string({
    message: 'Connection Category is required.',
  }),
  connection_type: z.string({ message: 'Connection Type is required.' }),

  // Port names
  source_port: z.string().optional().nullable(),
  destination_port: z.string().optional().nullable(),

  // Start Node (sn) side measurements
  sn_dom: optionalDate,
  otdr_distance_sn_km: emptyStringToNumber,
  sn_power_dbm: emptyStringToNumber,

  // End Node (en) side measurements
  en_dom: optionalDate,
  otdr_distance_en_km: emptyStringToNumber,
  en_power_dbm: emptyStringToNumber,

  // Overall measurements and status
  route_loss_db: emptyStringToNumber,
  status: z.boolean().optional().nullable(), // Corrected to allow null
  remark: z.string().optional().nullable(),

  // Timestamps are usually handled by the database
  created_at: optionalDate,
  updated_at: optionalDate,
});

export const systemConnectionSchema = z.object({
  id: z.uuid().optional(),
  system_id: z.uuid({ message: 'System is required.' }),
  node_a_id: z.uuid().optional().nullable(),
  node_b_id: z.uuid().optional().nullable(),
  connected_system_id: z.uuid().optional().nullable(),
  ea_ip: ipValidation.optional().or(z.literal('')),
  ea_interface: z.string().optional().nullable(),
  eb_ip: ipValidation.optional().or(z.literal('')),
  eb_interface: z.string().optional().nullable(),
  media_type_id: z.uuid().optional().nullable(),
  bandwidth_mbps: z.number().int().optional().nullable(),
  vlan: z.string().optional().nullable(),
  commissioned_on: optionalDate,
  remark: z.string().optional().nullable(),
  status: z.boolean().default(true).optional(),
  created_at: optionalDate,
  updated_at: optionalDate,
});

export const managementPortSchema = z.object({
  id: z.uuid().optional(),
  port_no: z.string().min(1, { message: 'Port number is required.' }),
  name: z.string().optional().nullable(),
  node_id: z.uuid().optional().nullable(),
  system_id: z.uuid().optional().nullable(),
  commissioned_on: optionalDate,
  remark: z.string().optional().nullable(),
  status: z.boolean().default(true).optional(),
  created_at: optionalDate,
  updated_at: optionalDate,
});

export const sdhNodeAssociationSchema = z.object({
  id: z.uuid().optional(),
  sdh_system_id: z.string().uuid({ message: 'SDH System is required.' }),
  node_id: z.string().uuid({ message: 'Node is required.' }),
  node_position: z
    .enum(['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'])
    .optional()
    .nullable(),
  node_ip: ipValidation.optional().or(z.literal('')),
});

```

<!-- path: hnvtx/schemas/auth.ts -->
```typescript
import z from "zod";

export const userSchema = z.object({
  email: z.email("Invalid email address"),
  password: z
    .string()
    .min(6, "Password must be at least 6 characters long")
    .max(50, "Password must not exceed 50 characters")
    .regex(
      /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/,
      "Password must contain at least one uppercase letter, one lowercase letter, one number and one special character"
    ),
});

export const signupSchema = userSchema
  .extend({
    firstName: z
      .string()
      .min(1, "First name is required")
      .max(50, "First name must not exceed 50 characters"),
    lastName: z
      .string()
      .min(1, "Last name is required")
      .max(50, "Last name must not exceed 50 characters"),
    confirmPassword: z.string().min(6, "Confirm password is required"),
  })
  .refine((data) => data.password === data.confirmPassword, {
    message: "Passwords must match",
    path: ["confirmPassword"],
  });


```

<!-- path: hnvtx/schemas/system-specific.ts -->
```typescript
// =================================================================
// SYSTEM-SPECIFIC TABLES
// =================================================================

import z from "zod";

export const cpanSystemSchema = z.object({
  system_id: z.uuid(),
  ring_no: z.string().optional().nullable(),
  area: z.string().optional().nullable(),
});

export const maanSystemSchema = z.object({
  system_id: z.uuid(),
  ring_no: z.string().optional().nullable(),
  area: z.string().optional().nullable(),
});

export const sdhSystemSchema = z.object({
  system_id: z.uuid(),
  gne: z.string().optional().nullable(),
  make: z.string().optional().nullable(),
});

export const vmuxSystemSchema = z.object({
  system_id: z.uuid(),
  vm_id: z.string().optional().nullable(),
});

export const cpanConnectionSchema = z.object({
  system_connection_id: z.uuid(),
  sfp_port: z.string().optional().nullable(),
  sfp_type_id: z.uuid().optional().nullable(),
  sfp_capacity: z.string().optional().nullable(),
  sfp_serial_no: z.string().optional().nullable(),
  fiber_in: z.number().int().optional().nullable(),
  fiber_out: z.number().int().optional().nullable(),
  customer_name: z.string().optional().nullable(),
  bandwidth_allocated_mbps: z.number().int().optional().nullable(),
});

export const maanConnectionSchema = cpanConnectionSchema.extend({});

export const sdhConnectionSchema = z.object({
  system_connection_id: z.uuid(),
  stm_no: z.string().optional().nullable(),
  carrier: z.string().optional().nullable(),
  a_slot: z.string().optional().nullable(),
  a_customer: z.string().optional().nullable(),
  b_slot: z.string().optional().nullable(),
  b_customer: z.string().optional().nullable(),
});

export const vmuxConnectionSchema = z.object({
  system_connection_id: z.uuid(),
  subscriber: z.string().optional().nullable(),
  c_code: z.string().optional().nullable(),
  channel: z.string().optional().nullable(),
  tk: z.string().optional().nullable(),
});
```

<!-- path: hnvtx/schemas/form-specific.ts -->
```typescript
// =================================================================
// FORM SPECIFIC TYPE EXPORTS
// =================================================================

import z from 'zod';
import { signupSchema, userSchema } from '@/schemas/auth';
import {
  employeeDesignationSchema,
  employeeSchema,
  lookupTypeSchema,
  maintenanceAreaSchema,
} from '@/schemas/masters';
import {
  managementPortSchema,
  nodeSchema,
  ofcCableSchema,
  ofcConnectionSchema,
  ringSchema,
  sdhNodeAssociationSchema,
  systemConnectionSchema,
  systemSchema,
} from '@/schemas/core';
import {
  cpanConnectionSchema,
  cpanSystemSchema,
  maanConnectionSchema,
  maanSystemSchema,
  sdhConnectionSchema,
  sdhSystemSchema,
  vmuxConnectionSchema,
  vmuxSystemSchema,
} from '@/schemas/system-specific';
import { userProfileSchema } from '@/schemas/user';
import { optionalDate } from '@/schemas/helpers';

// =================================================================
// TYPE EXPORTS
// =================================================================
export type LookupType = z.infer<typeof lookupTypeSchema>;
export type MaintenanceArea = z.infer<typeof maintenanceAreaSchema>;
export type EmployeeDesignation = z.infer<typeof employeeDesignationSchema>;
export type Employee = z.infer<typeof employeeSchema>;
export type Ring = z.infer<typeof ringSchema>;
export type Node = z.infer<typeof nodeSchema>;
export type OfcCable = z.infer<typeof ofcCableSchema>;
export type OfcConnection = z.infer<typeof ofcConnectionSchema>;
export type SystemConnection = z.infer<typeof systemConnectionSchema>;
export type ManagementPort = z.infer<typeof managementPortSchema>;
export type SdhNodeAssociation = z.infer<typeof sdhNodeAssociationSchema>;
export type CpanSystem = z.infer<typeof cpanSystemSchema>;
export type MaanSystem = z.infer<typeof maanSystemSchema>;
export type SdhSystem = z.infer<typeof sdhSystemSchema>;
export type VmuxSystem = z.infer<typeof vmuxSystemSchema>;
export type CpanConnection = z.infer<typeof cpanConnectionSchema>;
export type MaanConnection = z.infer<typeof maanConnectionSchema>;
export type SdhConnection = z.infer<typeof sdhConnectionSchema>;
export type VmuxConnection = z.infer<typeof vmuxConnectionSchema>;
export type UserProfile = z.infer<typeof userProfileSchema>;
export type UserFormData = z.infer<typeof userSchema>;
export type SignupFormData = z.infer<typeof signupSchema>;

export type System = z.infer<typeof systemSchema>;

export const nodeFormSchema = nodeSchema.omit({
  id: true,
  created_at: true,
  updated_at: true,
});
export type NodeFormData = z.infer<typeof nodeFormSchema>;

export const employeeFormSchema = employeeSchema.omit({
  id: true,
  created_at: true,
  updated_at: true,
  status: true,
});
export type EmployeeFormData = z.infer<typeof employeeFormSchema>;

export const userProfileFormSchema = userProfileSchema.omit({
  created_at: true,
  updated_at: true,
});
export type UserProfileFormData = z.infer<typeof userProfileFormSchema>;

export const maintenanceAreaFormSchema = maintenanceAreaSchema.omit({
  id: true,
  created_at: true,
  updated_at: true,
});
export type MaintenanceAreaFormData = z.infer<typeof maintenanceAreaFormSchema>;

export const ringFormSchema = ringSchema.omit({
  id: true,
  created_at: true,
  updated_at: true,
});
export type RingFormData = z.infer<typeof ringFormSchema>;

export const ofcCableFormSchema = ofcCableSchema.omit({
  id: true,
  created_at: true,
  updated_at: true,
});
export type OfcCableFormData = z.infer<typeof ofcCableFormSchema>;

// Form schema - accepts Date objects, outputs strings for database
export const systemFormSchema = systemSchema
  .omit({
    id: true,
    created_at: true,
    updated_at: true,
  })
  .extend({
    commissioned_on: optionalDate, // Form uses Date object
  })
  .transform((data) => ({
    ...data,
    commissioned_on: data.commissioned_on ? data.commissioned_on.toISOString() : null,
  }));

export type SystemFormData = z.input<typeof systemFormSchema>; // What form expects (Date)
export type SystemFormOutput = z.output<typeof systemFormSchema>; // What database gets (string)

export const ofcConnectionFormSchema = ofcConnectionSchema.omit({
  id: true,
  created_at: true,
  updated_at: true,
});
export type OfcConnectionFormData = z.infer<typeof ofcConnectionFormSchema>;

```

<!-- path: hnvtx/schemas/masters.ts -->
```typescript
// =================================================================
// MASTER TABLES (Using the corrected helpers)
// =================================================================

import z from "zod";

export const lookupTypeSchema = z.object({
  id: z.uuid().optional(),
  category: z.string().min(1, { message: "Category is required." }),
  name: z.string().min(1, { message: "Name is required." }),
  code: z.string().optional().nullable(),
  description: z.string().optional().nullable(),
  sort_order: z.number().int().default(0).optional(),
  is_system_default: z.boolean().default(false).optional(),
  status: z.boolean().default(true).optional(),
  created_at: z.coerce.date().optional(),
  updated_at: z.coerce.date().optional(),
});

export const maintenanceAreaSchema = z.object({
  id: z.uuid().optional(),
  name: z.string().min(1, { message: "Area name is required." }),
  code: z.string().optional().nullable(),
  area_type_id: z.uuid().optional().nullable(),
  parent_id: z.uuid().optional().nullable(),
  contact_person: z.string().optional().nullable(),
  contact_number: z.string().optional().nullable(),
  email: z
    .email({ message: "Invalid email address." })
    .optional()
    .or(z.literal("")),
  latitude: z.number().optional().nullable(),
  longitude: z.number().optional().nullable(),
  address: z.string().optional().nullable(),
  status: z.boolean().default(true).optional(),
  created_at: z.coerce.date().optional(),
  updated_at: z.coerce.date().optional(),
});

export const employeeDesignationSchema = z.object({
  id: z.uuid().optional(),
  name: z.string().min(1, { message: "Designation name is required." }),
  parent_id: z.uuid().optional().nullable(),
  status: z.boolean().default(true).optional(),
  created_at: z.coerce.date().optional(),
  updated_at: z.coerce.date().optional(),
});

export const employeeSchema = z.object({
  id: z.uuid().optional(),
  employee_name: z.string().min(1, { message: "Employee name is required." }),
  employee_pers_no: z.string().optional().nullable(),
  employee_contact: z.string().optional().nullable(),
  employee_email: z.email({ message: "Invalid email address." })
    .optional()
    .or(z.literal("")),
  // dob/doj should not be future dates
  employee_dob: z.coerce
    .date<Date>()
    .optional()
    .nullable()
    .refine((date) => !date || date < new Date(), {
      message: "Date of birth cannot be in the future.",
    }),
  employee_doj: z.coerce
    .date<Date>()
    .optional()
    .nullable()
    .refine((date) => !date || date < new Date(), {
      message: "Date of joining cannot be in the future.",
    }),
  employee_designation_id: z.string().uuid().optional().nullable(),
  employee_addr: z.string().optional().nullable(),
  maintenance_terminal_id: z.string().uuid().optional().nullable(),
  remark: z.string().optional().nullable(),
  status: z.boolean().default(true).optional(),
  created_at: z.coerce.date().optional(),
  updated_at: z.coerce.date().optional(),
});

```

<!-- path: hnvtx/plan.md -->
```markdown
# Migration Strategy and Implementation Guide

## Phase 1: Immediate Implementation (Current Requirement)

### 1. Keep Current Schema

- Continue using your existing `ofc_cables` and `ofc_connections` tables
- Implement the auto-creation logic as shown in the code artifact

### 2. Business Logic for Auto-Creation

```typescript
// Service function for connection management
export class OfcConnectionService {
  static async ensureConnectionsExist(cableId: string): Promise<void> {
    const cable = await this.getCableById(cableId);
    const existingConnections = await this.getConnectionsByCableId(cableId);

    const missingCount = cable.capacity - existingConnections.length;

    if (missingCount > 0) {
      await this.createMissingConnections(cableId, missingCount, existingConnections);
    }
  }
}
```

## Phase 2: Enhanced Schema Migration (Future-Proofing)

### Migration Steps:

#### Step 1: Add New Tables

1. Create `fiber_joints` table
2. Create `logical_fiber_paths` table
3. Create `fiber_joint_connections` table
4. Create `ofc_connections_enhanced` table

#### Step 2: Data Migration Script

```sql
-- Migrate existing connections to enhanced structure
INSERT INTO ofc_connections_enhanced (
  ofc_id, fiber_no, logical_path_id, path_segment_order,
  source_type, source_id, destination_type, destination_id,
  otdr_distance_km, power_dbm, connection_type, remark, status
)
SELECT
  ofc_id,
  fiber_no_sn,
  gen_random_uuid(), -- Generate logical path ID
  1, -- First segment
  'node', sn_id,
  'node', en_id,
  (otdr_distance_sn_km + otdr_distance_en_km) / 2, -- Average distance
  (sn_power_dbm + en_power_dbm) / 2, -- Average power
  'straight',
  remark,
  status
FROM ofc_connections oc
JOIN ofc_cables cable ON oc.ofc_id = cable.id;
```

#### Step 3: Create Logical Paths

```sql
-- Create logical paths for existing straight connections
INSERT INTO logical_fiber_paths (
  path_name, source_system_id, destination_system_id,
  total_distance_km, path_type, operational_status
)
SELECT DISTINCT
  CONCAT(cable.route_name, '_', oc.fiber_no_sn) as path_name,
  oc.system_sn_id,
  oc.system_en_id,
  (oc.otdr_distance_sn_km + oc.otdr_distance_en_km),
  'point_to_point',
  CASE WHEN oc.status THEN 'active' ELSE 'decommissioned' END
FROM ofc_connections oc
JOIN ofc_cables cable ON oc.ofc_id = cable.id
WHERE oc.system_sn_id IS NOT NULL AND oc.system_en_id IS NOT NULL;
```

## Phase 3: Advanced Features Implementation

### 1. Joint Management System

```typescript
interface FiberJoint {
  id: string;
  joint_name: string;
  joint_type: 'splice' | 't_joint' | 'cross_connect' | 'patch_panel';
  location_description: string;
  latitude?: number;
  longitude?: number;
  node_id?: string;
}

class JointManagementService {
  async createSpliceJoint(cableAId: string, cableBId: string, location: string) {
    // Create joint record
    const joint = await this.createJoint({
      joint_name: `Splice_${location}`,
      joint_type: 'splice',
      location_description: location
    });

    // Update fiber connections to route through joint
    await this.updateFiberRoutingThroughJoint(joint.id, cableAId, cableBId);
  }

  async createTJoint(mainCableId: string, branchCableId: string, fiberNumbers: number[]) {
    // Implementation for T-joint creation
  }
}
```

### 2. Path Calculation Engine

```typescript
class PathCalculationService {
  async calculateEndToEndPath(sourceSystemId: string, destSystemId: string): Promise<LogicalPath> {
    // Use graph algorithms to find optimal path through:
    // - Direct cables
    // - Splice joints
    // - T-joints
    // - Cross-connects
  }

  async calculatePathLoss(pathId: string): Promise<number> {
    // Sum up all losses along the path:
    // - Fiber loss (distance × attenuation)
    // - Splice losses
    // - Connector losses
  }
}
```

## Benefits of This Approach

### 1. Immediate Value

- ✅ Solve current requirement quickly
- ✅ Maintain existing functionality
- ✅ No disruption to current operations

### 2. Future Flexibility

- ✅ Support complex network topologies
- ✅ Handle joints and splicing
- ✅ Track end-to-end logical paths
- ✅ Support multiple routing scenarios

### 3. Scalability

- ✅ Efficient querying with proper indexes
- ✅ Modular design for easy extensions
- ✅ Support for different connection types

### 4. Data Integrity

- ✅ Referential integrity through foreign keys
- ✅ Constraint checks for valid data
- ✅ Audit trail with timestamps

## Recommended Implementation Timeline

### Week 1-2: Immediate Solution

- Implement auto-connection creation
- Deploy cable detail page
- Test with existing data

### Week 3-4: Schema Enhancement

- Create new tables
- Implement migration scripts
- Test data migration

### Week 5-8: Advanced Features

- Implement joint management
- Build path calculation engine
- Create management interfaces

### Week 9-10: Testing & Optimization

- Performance testing
- User acceptance testing
- Production deployment

## Key Considerations

1. **Data Migration**: Plan downtime and backup strategies
2. **Performance**: Index optimization for large datasets
3. **User Training**: New interfaces and concepts
4. **Integration**: API compatibility with existing systems
5. **Monitoring**: Health checks for data consistency

This approach gives you immediate value while building toward a comprehensive, future-proof fiber management system.

You're absolutely right! I made an error in my terminology. Those are not tables - they are **enumerated values** (string constants) for the `joint_type` column. Let me clarify and provide a better, more scalable approach:Now let me create a better version that uses proper lookup tables instead of hardcoded enum values:You're absolutely correct! The previous approach used hardcoded string values with CHECK constraints, which is not scalable. The improved schema above uses **proper lookup tables** instead:

## Key Improvements:

### 1. **Lookup Tables Instead of Enums:**

- `joint_types` table instead of hardcoded values
- `connection_types` table for different connection types
- `endpoint_types` table for source/destination types
- `path_statuses` table for path operational states

### 2. **Benefits of Using Lookup Tables:**

- **Extensible**: Easy to add new types without schema changes
- **Referential Integrity**: Foreign key constraints ensure data consistency
- **Descriptive**: Each type has a name and description
- **Maintainable**: Can enable/disable types without deleting data
- **Reportable**: Easy to query type information with JOINs

### 3. **Example Usage:**

```typescript
// TypeScript interfaces for the lookup tables
interface JointType {
  id: string;
  type_code: string;
  type_name: string;
  description: string;
  typical_fiber_count: number;
  is_active: boolean;
}

interface ConnectionType {
  id: string;
  type_code: string;
  type_name: string;
  description: string;
  is_active: boolean;
}

// Query with proper joins
const query = `
  SELECT
    fj.joint_name,
    jt.type_name as joint_type,
    jt.description,
    fj.max_fiber_capacity
  FROM fiber_joints fj
  JOIN joint_types jt ON fj.joint_type_id = jt.id
  WHERE jt.is_active = true
`;
```

### 4. **Migration from Current Schema:**

```sql
-- Get joint type ID by code
SELECT id FROM joint_types WHERE type_code = 'SPLICE';

-- Insert new joint with proper foreign key
INSERT INTO fiber_joints (joint_name, joint_type_id, location_description)
VALUES ('Main_Splice_001',
        (SELECT id FROM joint_types WHERE type_code = 'SPLICE'),
        'Junction Box at Node A');
```

This approach gives you much better flexibility and maintainability compared to hardcoded enum values. You can easily add new joint types, connection types, or statuses through the application interface without touching the database schema.

Of course. This is an excellent project with a very strong foundation. The use of TypeScript, Zod for schema validation, React Query for data fetching, and a component-based architecture is a great start. Here is a detailed analysis of areas where you can improve maintainability, reusability, UI/UX, and performance.

# 1. Reusability & Maintainability (Code Architecture)

Your `DRY-guide-ofc.md` shows you're already thinking about this, which is fantastic. Here’s how to take it further.

#### **Suggestion: Create a Generic CRUD Page Component/Hook**

* **Observation:** Your dashboard pages (`rings/page.tsx`, `employees/page.tsx`, `nodes/page.tsx`) share a significant amount of boilerplate logic: state for pagination, search, filters, modals, data fetching, mutations, and rendering a `DataTable`.
* **Improvement:** Abstract this common logic into a reusable component or a higher-level hook.

  * **High-Level Hook (`useCrudManager`):** Create a hook like `useCrudManager("employees", { relations: [...] })`. This hook would internally manage `useTableQuery`, `useTableInsert`, etc., and expose a clean API:
    ```typescript
    const {
      data,
      isLoading,
      pagination,
      setPagination,
      filters,
      setFilters,
      createItem,
      updateItem,
      deleteItem
    } = useCrudManager("employees");
    ```
  * **Layout Component (`<CrudPageLayout>`):** This component would use the hook above and accept props for entity-specific parts like `columns`, `pageTitle`, `FiltersComponent`, and `FormComponent`.
* **Benefit:** Creating a new CRUD page would be reduced to defining the columns, filter UI, and form, eliminating dozens of lines of repeated code per page. This dramatically improves maintainability.

#### **Suggestion: Modularize `schema.ts`**

* **Observation:** The `schemas/schema.ts` file is becoming a monolith, containing schemas for auth, master tables, core infrastructure, and user profiles. As the application grows, this will become difficult to navigate.
* **Improvement:** Create a `schemas/` directory and split the file by domain.
  * `schemas/auth.ts` (userSchema, signupSchema)
  * `schemas/masters.ts` (lookupTypeSchema, maintenanceAreaSchema, etc.)
  * `schemas/core.ts` (ringSchema, nodeSchema, ofcCableSchema, etc.)
  * `schemas/user.ts` (userProfileSchema)
  * `schemas/index.ts` (to re-export all schemas from one place)
* **Benefit:** Improves code organization, making it faster to find and update specific schemas.

#### **Suggestion: Centralize Table Actions Logic**

* **Observation:** You have separate functions like `getRingsTableColumns`, `getEmployeeTableActions`, etc. This is a good pattern.
* **Improvement:** Consolidate the creation of common actions. For example, the `edit`, `delete`, and `toggleStatus` actions are nearly identical across pages. You can create a helper function that generates these standard actions.
  ```typescript
  // in a new file, e.g., components/table/action-helpers.ts
  export function createStandardActions({ onEdit, onDelete, onToggleStatus }) {
    return [
      // Edit action config...
      // Delete action config...
      // Toggle status action config...
    ];
  }
  ```
* **Benefit:** Ensures consistency in action icons, labels, and behavior across all data tables.

### 2. UI/UX Consistency & Improvement

The UI is clean and functional. These suggestions focus on creating a more polished and consistent "design system."

#### **Suggestion: Create a Standard `PageHeader` Component**

* **Observation:** The headers on pages like `rings/page.tsx` (`RingsHeader.tsx`) and `employees/page.tsx` (inline JSX) have similar elements (title, description, action buttons) but are implemented differently.
* **Improvement:** Create a single, reusable `<PageHeader>` component.
  ```typescript
  <PageHeader
    title="Ring Management"
    description="Manage network rings and related info"
    actions={
      <>
        <Button onClick={onRefresh} variant="outline" icon={<FiRefreshCw />}>Refresh</Button>
        <Button onClick={onAddNew} icon={<FiPlus />}>Add Ring</Button>
      </>
    }
  />
  ```
* **Benefit:** Enforces a consistent layout and style for all page titles and primary actions, improving user experience.

#### **Suggestion: Enhance the Form Component Suite**

* **Observation:** Your `FormControls.tsx` is a great start. However, the forms themselves (`OfcForm.tsx`, `RingModal.tsx`) still contain repetitive layout code.
* **Improvement:** Create a generic `<Form>` component that integrates with `react-hook-form`. It could accept a schema and render fields dynamically or provide slots for layout. Also, standardize the modal forms to use a consistent footer with `Cancel` and `Submit` buttons. Your `FormCard` component is an excellent step in this direction.
* **Benefit:** Speeds up form creation and ensures all forms have a similar look, feel, and validation message style.

#### **Suggestion: Standardize Colors and Theming**

* **Observation:** Colors are used directly in components (e.g., `bg-blue-600`, `text-red-500`).
* **Improvement:** Define your color palette as CSS variables in `globals.css` and reference them in `tailwind.config.js`.

  ```css
  /* globals.css */
  :root {
    --primary: 220 83% 53%; /* HSL for blue */
    --destructive: 0 84% 60%; /* HSL for red */
    /* ... other colors */
  }
  ```

  ```javascript
  // tailwind.config.js
  theme: {
    extend: {
      colors: {
        primary: 'hsl(var(--primary))',
        destructive: 'hsl(var(--destructive))',
      },
    },
  },
  ```
* **Benefit:** Creates a centralized design system. Changing the primary brand color becomes a one-line change.

### 3. Performance Optimization

Your application seems well-structured, but as it scales, these optimizations will become crucial.

#### **Suggestion: Aggressive Caching for Lookup Data**

* **Observation:** Data like "Node Types", "Ring Types", and "Maintenance Areas" are fetched on multiple pages and likely change infrequently.
* **Improvement:** In your `useTableQuery` hooks for this type of data, set a much longer `staleTime` in the React Query options.
  ```typescript
  // Example for fetching node types
  useTableQuery(supabase, "lookup_types", {
    filters: { category: { operator: 'eq', value: 'NODE_TYPES' } },
    staleTime: 15 * 60 * 1000, // 15 minutes
    gcTime: 30 * 60 * 1000, // 30 minutes
  });
  ```
* **Benefit:** Prevents redundant network requests for semi-static data, making navigation between pages feel instantaneous.

#### **Suggestion: Differentiate List vs. Detail Queries**

* **Observation:** The data tables might be fetching all columns for every row (e.g., long `description` or `remark` fields), which can increase the data payload for list views.
* **Improvement:** When fetching data for a `DataTable`, explicitly select only the columns needed for display using the `columns` option in `useTableQuery`. Fetch the full record only when the user opens an edit modal or a details view.
  ```typescript
  // For a list view
  useTableQuery(supabase, "rings", { columns: "id, name, status, ring_type_id" });

  // For an edit modal (using useTableRecord)
  useTableRecord(supabase, "rings", editingRingId, { columns: "*" });
  ```
* **Benefit:** Reduces the amount of data transferred from the database, leading to faster page loads, especially on tables with many rows.

#### **Suggestion: Leverage Next.js Server Components**

* **Observation:** Most of your pages are client components (`"use client";`). This is necessary for interactivity, but the initial data can often be fetched on the server.
* **Improvement:** Adopt a hybrid approach. Create a server component as the main page entry point to fetch the initial data. Then, pass this data as a prop to your interactive client component. Your `ofcadv/page.tsx` already does this perfectly with `getRoutesForSelection`.
  ```typescript
  // app/dashboard/rings/page.tsx (now a Server Component)
  export default async function RingsPage() {
    const supabase = createClient(); // Server client
    const { data: initialRings } = await supabase.from('rings').select('*');
    return <RingsClientPage initialRings={initialRings} />;
  }

  // components/rings/RingsClientPage.tsx (your old page.tsx content)
  "use client";
  export default function RingsClientPage({ initialRings }) {
    // Use useQuery with `initialData: initialRings`
    // ...
  }
  ```
* **Benefit:** Improves initial page load performance (First Contentful Paint) as the data is fetched and rendered on the server, sending a more complete HTML page to the client.

By focusing on these areas, you can significantly enhance the `hnvtx` project, making it more robust, scalable, and easier to build upon in the future.

Excellent question. Following the DRY (Don't Repeat Yourself) principle is crucial for long-term project success. I've analyzed your project and found a prime example of type repetition that can be easily fixed, along with some broader patterns to follow.

### The Most Direct Repetition: `LookupType`

This is the clearest violation of the DRY principle in your project. You have defined the `LookupType` shape in two separate places.

**Problem:**

You have a Zod schema in `schemas/schema.ts` that already defines the structure of a lookup type and from which you export a TypeScript type:

```typescript
// in: schemas/schema.ts
import { z } from "zod";

export const lookupTypeSchema = z.object({
  id: z.uuid().optional(),
  category: z.string().min(1, { message: "Category is required." }),
  name: z.string().min(1, { message: "Name is required." }),
  // ... other fields
});

export type LookupType = z.infer<typeof lookupTypeSchema>; // <-- SOURCE OF TRUTH
```

However, in `components/lookup/lookup-types.ts`, you have manually re-declared the same structure:

```typescript
// in: components/lookup/lookup-types.ts
export interface LookupType { // <-- REPETITION
    id: string;
    category: string;
    name: string;
    code: string | null;
    description: string | null;
    // ... other fields
}
```

This is problematic because:

1. **Maintenance Overhead:** If you add a field to `lookupTypeSchema`, you must remember to manually add it to the interface in `lookup-types.ts`.
2. **Risk of Divergence:** It's easy to forget to update one, leading to subtle bugs where your validation schema and your component's type expectations are out of sync.

**Solution: Use a Single Source of Truth**

The fix is to eliminate the manual interface and import the type directly from your schema file.

**Step 1: Delete the Repetitive File Content**

Remove the `LookupType` interface from `components/lookup/lookup-types.ts`.

**Step 2: Update Files to Import the Correct Type**

In any file that was using the manually defined type (like `LookupModal.tsx`, `lookup-hooks.ts`, etc.), change the import.

**Before:**

```typescript
// in: components/lookup/lookup-hooks.ts
import { LookupType } from "@/components/lookup/lookup-types"; ```

**After:**
```typescript
// in: components/lookup/lookup-hooks.ts
import { type LookupType } from "@/schemas/schema"; // Import the type from your single source of truth
```

*(Note: Using `import type` is a good practice as it ensures the import is erased at compile time if only used for type annotations, resulting in a smaller JavaScript bundle.)*

By making this change, `schemas/schema.ts` becomes the undisputed **Single Source of Truth** for the shape of `LookupType`.

### Broader Principle: Zod Schemas vs. Supabase-Generated Types

While not a direct repetition, you have two "sources of truth" for your data types, which requires careful management to stay DRY.

1. **Zod Schemas (`schemas/schema.ts`):** Your source of truth for **validation and form data**.
2. **Supabase Types (`types/supabase-types.ts`):** Your source of truth for **raw database interactions**.

This is a common and perfectly valid pattern, but the key to keeping it DRY is to establish clear rules on when to use which.

**How to Apply the DRY Principle Here:**

1. **For Forms and Validation:** Always use the Zod-inferred types. Your `RingModal.tsx` and `EmployeeForm.tsx` do this well by creating a form-specific schema and using `z.infer` for the form data type. This is excellent.
2. **For Database Query/Return Types:** Use the Supabase-generated types. Your hooks in `hooks/database/` and pages like `employees/page.tsx` correctly use types like `Row<"employees">` and `Tables<"maintenance_areas">`. This is also excellent.
3. **For Component Props and Shared Types:** When a component needs to accept data that has been fetched from the database, it's best to use the types generated by Supabase.

**Good Examples in Your Project (What to Keep Doing):**

You are already applying the DRY principle well in several places by *extending* or *aliasing* base types instead of re-creating them.

* In `components/maintenance-areas/maintenance-areas-types.ts`:

  ```typescript
  // This is GOOD. It's not a re-declaration.
  // It's creating a new, more specific type from a base type.
  export interface MaintenanceAreaWithRelations extends MaintenanceArea {
    area_type: AreaType | null;
    parent_area: MaintenanceAreaWithRelations | null;
    child_areas: MaintenanceAreaWithRelations[];
  }
  ```
* In `components/users/user-types.ts`:

  ```typescript
  // This is also GOOD. It's creating a clear, readable alias for a generated type.
  export type UserProfileData = Database["public"]["Views"]["v_user_profiles_extended"]["Row"];
  ```

### Actionable Summary to Improve DRY Compliance

1. **Refactor `LookupType`:** Delete the interface in `components/lookup/lookup-types.ts` and update all relevant files to import `type LookupType` from `@/schemas/schema`.
2. **Establish a Convention:**
   * Use **Zod-inferred types** for all form data and validation logic.
   * Use **Supabase-generated types** (`Row<T>`, `Tables<T>`) for database query results and component props that receive that data.
3. **Continue the Pattern:** Keep using type composition (extending interfaces, creating aliases) as you've done in `maintenance-areas-types.ts`. Avoid manually re-typing the properties of an object that is already defined elsewhere.

Of course. Here is the complete and actionable list of all the files you need to change to eliminate the repetitive `LookupType` definition and follow the DRY principle.

### Summary of Changes:

1. We will delete the manually created `LookupType` interface.
2. We will update all components that were using it to import the `LookupType` type that is automatically generated from your Zod schema (`schemas/schema.ts`). This makes your schema the single source of truth.

---

### **File 1: The Repetitive Type Definition (To Be Modified)**

**File Path:** `components/lookup/lookup-types.ts`

**Action:** Delete the `LookupType` interface from this file.

**Change from this:**

```typescript
export interface LookupType {
    id: string;
    category: string;
    name: string;
    code: string | null;
    description: string | null;
    sort_order: number | null;
    status: boolean | null;
    is_system_default: boolean | null;
    created_at: string | null;
    updated_at: string | null;
  }

  export interface LookupTypesPageProps {
    initialCategory?: string;
  }
```

**To this:**

```typescript
// The LookupType interface has been removed.
// We only keep what's still necessary.

export interface LookupTypesPageProps {
    initialCategory?: string;
}
```

---

### **File 2: The Main Hook (To Be Updated)**

**File Path:** `components/lookup/lookup-hooks.ts`

**Action:** Change the import source for `LookupType`.

**Change this line:**

```typescript
import { LookupType } from "@/components/lookup/lookup-types";
```

**To this:**

```typescript
import { type LookupType } from "@/schemas/schema";
```

---

### **File 3: The Table Component (To Be Updated)**

**File Path:** `components/lookup/LookupTypesTable.tsx`

**Action:** Change the import source for `LookupType`.

**Change this line:**

```typescript
import { LookupType } from "@/components/lookup/lookup-types";
```

**To this:**

```typescript
import { type LookupType } from "@/schemas/schema";
```

---

### **File 4: The Modal Component (To Be Updated for Consistency)**

**File Path:** `components/lookup/LookupModal.tsx`

**Action:** This file was using the Supabase-generated type. We will update it to use the Zod-inferred type from `schemas/schema.ts` for consistency across all `lookup` components, especially since this modal deals with form validation.

**Change this line:**

```typescript
type LookupType = Database["public"]["Tables"]["lookup_types"]["Row"];
```

**To this (add it near your other imports):**

```typescript
import { type LookupType } from "@/schemas/schema";
```

By making these four changes, you will have successfully refactored your code to be more maintainable and robust. Your Zod schema will now be the single, authoritative source for what a `LookupType` object looks like.

You are absolutely right to ask that. My apologies for focusing too narrowly. My previous answer highlighted the most direct and obvious example of repetition, but upon a more thorough review of the entire project, I found **one other similar instance** that should be corrected.

After these two areas (`LookupType` and `NodeSchema`) are addressed, the rest of your project follows excellent DRY principles for types by correctly using aliases and extending interfaces.

Here is the complete list of changes, including the new finding.

---

### **Issue 1: Repetitive `LookupType` Definition (As Discussed)**

This remains the most critical change.

* **Problem:** The `LookupType` interface is manually defined in `components/lookup/lookup-types.ts`, repeating the structure already defined in `schemas/schema.ts`.
* **Solution:**
  1. **Modify `components/lookup/lookup-types.ts`:** Remove the manual `LookupType` interface.
  2. **Update `components/lookup/lookup-hooks.ts`:** Change `import { LookupType } from "@/components/lookup/lookup-types";` to `import { type LookupType } from "@/schemas/schema";`.
  3. **Update `components/lookup/LookupTypesTable.tsx`:** Change `import { LookupType } from "@/components/lookup/lookup-types";` to `import { type LookupType } from "@/schemas/schema";`.
  4. **Update `components/lookup/LookupModal.tsx`:** Change `type LookupType = Database["public"]["Tables"]["lookup_types"]["Row"];` to `import { type LookupType } from "@/schemas/schema";`.

---

### **Issue 2: Repetitive `Node` Schema Definition (New Finding)**

This issue is identical in nature to the `LookupType` problem. You have defined the validation rules for a Node in two separate places.

**Problem:**

1. **Source of Truth:** In `schemas/schema.ts`, you have the main `nodeSchema`.

   ```typescript
   // in: schemas/schema.ts
   export const nodeSchema = z.object({
     id: z.uuid().optional(),
     name: z.string().min(1, { message: "Node name is required." }),
     node_type_id: z.uuid().optional().nullable(),
     // ...all other node fields
   });
   ```
2. **Repetition:** In `components/nodes/nodes_types.ts`, you have a second, slightly different Zod schema for the form.

   ```typescript
   // in: components/nodes/nodes_types.ts
   export const nodeFormSchema = z.object({ // <-- REPETITION
     name: z.string().min(1, { message: "Node name is required." }),
     node_type_id: z.string().uuid().optional().nullable(),
     // ...all other node fields except timestamps and id
   });
   ```

This creates the same maintenance problem: if you change a validation rule in `nodeSchema`, you must remember to change it in `nodeFormSchema` as well.

**Solution: Derive the Form Schema from the Main Schema**

We will modify the main schema file to export a derived version specifically for the form, making it the single source of truth.

#### **Step 1: Modify the "Source of Truth" Schema File**

**File Path:** `schemas/schema.ts`

**Action:** At the end of the `nodeSchema` definition, use Zod's `.omit()` method to create and export a new schema for your form. Also, export the inferred type for the form data.

**Change this:**

```typescript
// in: schemas/schema.ts (current code)
export const nodeSchema = z.object({
  id: z.uuid().optional(),
  name: z.string().min(1, { message: "Node name is required." }),
  node_type_id: z.uuid().optional().nullable(),
  ip_address: ipValidation.optional().or(z.literal('')),
  latitude: emptyStringToNumber,
  longitude: emptyStringToNumber,
  vlan: z.string().optional().nullable(),
  site_id: z.string().optional().nullable(),
  builtup: z.string().optional().nullable(),
  maintenance_terminal_id: z.uuid().optional().nullable(),
  ring_id: z.uuid().optional().nullable(),
  order_in_ring: z.number().int().optional().nullable(),
  ring_status: z.string().default('ACTIVE').optional(),
  east_port: z.string().optional().nullable(),
  west_port: z.string().optional().nullable(),
  remark: z.string().optional().nullable(),
  status: z.boolean().default(true).optional(),
  created_at: z.coerce.date().optional(),
  updated_at: z.coerce.date().optional(),
});
```

**To this (add the new exports at the end):**

```typescript
// in: schemas/schema.ts (new code)
export const nodeSchema = z.object({
  id: z.uuid().optional(),
  name: z.string().min(1, { message: "Node name is required." }),
  node_type_id: z.uuid().optional().nullable(),
  ip_address: ipValidation.optional().or(z.literal('')),
  latitude: emptyStringToNumber,
  longitude: emptyStringToNumber,
  vlan: z.string().optional().nullable(),
  site_id: z.string().optional().nullable(),
  builtup: z.string().optional().nullable(),
  maintenance_terminal_id: z.uuid().optional().nullable(),
  ring_id: z.uuid().optional().nullable(),
  order_in_ring: z.number().int().optional().nullable(),
  ring_status: z.string().default('ACTIVE').optional(),
  east_port: z.string().optional().nullable(),
  west_port: z.string().optional().nullable(),
  remark: z.string().optional().nullable(),
  status: z.boolean().default(true).optional(),
  created_at: z.coerce.date().optional(),
  updated_at: z.coerce.date().optional(),
});

// ADD THESE NEW EXPORTS
export const nodeFormSchema = nodeSchema.omit({
  id: true,
  created_at: true,
  updated_at: true,
});
export type NodeFormData = z.infer<typeof nodeFormSchema>;
```

#### **Step 2: Modify the Node Types File**

**File Path:** `components/nodes/nodes_types.ts`

**Action:** Delete the entire `nodeFormSchema` object. We will now import it. Also, update the `NodeForm` type to be imported.

**Change from this:**

```typescript
// in: components/nodes/nodes_types.ts (current code)
export const nodeFormSchema = z.object({
  name: z.string().min(1, { message: "Node name is required." }),
  // ... all the repeated fields
  status: z.boolean(),
});

export type NodeForm = z.infer<typeof nodeFormSchema>;
```

**To this:**

```typescript
// in: components/nodes/nodes_types.ts (new code)
// The manual zod schema has been removed.
// We will import what we need directly in the component.

// ... (keep the other interfaces like NodeWithRelations, etc.)
export interface NodeWithRelations extends Node {
  // ...
}
```*(You can also remove the `NodeForm` export as we will import `NodeFormData` directly in the modal).*

#### **Step 3: Update the Node Form Modal**

**File Path:** `components/nodes/NodeFormModal.tsx`

**Action:** Update the imports to use the new schema and type from the single source of truth.

**Change this:**
```typescript
// in: components/nodes/NodeFormModal.tsx (current code)
import { nodeFormSchema } from "./nodes_types";
// ...
export function NodeFormModal(...) {
  type NodeForm = z.infer<typeof nodeFormSchema>;
  const { /* ... */ } = useForm<NodeForm>({
    resolver: zodResolver(nodeFormSchema),
    // ...
  });
  // ...
}
```

**To this:**

```typescript
// in: components/nodes/NodeFormModal.tsx (new code)
import { nodeFormSchema, type NodeFormData } from "@/schemas/schema"; // <-- Updated import
// ...
export function NodeFormModal(...) {
  // We no longer need to infer the type here
  const { /* ... */ } = useForm<NodeFormData>({ // <-- Use the imported type
    resolver: zodResolver(nodeFormSchema), // <-- Use the imported schema
    // ...
  });
  // ...
  const onValidSubmit = useCallback((formData: NodeFormData) => { // <-- Use the imported type
    // ...
  }, [/* ... */]);
  // ...
}
```

After making these changes for both `LookupType` and `NodeSchema`, your project will be significantly more maintainable, and you can be confident that your validation logic and type definitions are perfectly synchronized. **No other files contain this type of direct repetition.**

Of course. Beyond the type and schema repetition we've already addressed, there are several excellent opportunities to apply the DRY principle to your project's logic, UI components, and configuration. This will make your codebase cleaner, faster to develop in, and much easier to maintain.

Here is a list of the most impactful areas for improvement, with specific file examples and solutions.

### 1. Logic & Behavior: The "CRUD Page" Pattern

This is the most significant area for improvement. Your dashboard pages are excellent but contain a lot of repeated logic.

**Observation:**
The following pages all repeat the same core logic for managing a database table:

* `app/dashboard/rings/page.tsx`
* `app/dashboard/employees/page.tsx`
* `app/dashboard/nodes/page.tsx`
* `app/dashboard/users/page.tsx`
* `app/dashboard/ofc/page.tsx`

The repeated logic in each file includes:

* **State Management:** `useState` for pagination (`currentPage`, `pageLimit`), search (`searchQuery`), filters, and modal visibility (`isModalOpen`, `editing...`).
* **Data Fetching:** A `useTableQuery` or `usePaged...` hook to get data, along with a separate `useEffect` to calculate `totalCount`.
* **Mutations:** `useTableDelete`, `useToggleStatus`, `useTableInsert`, `useTableUpdate`.
* **Event Handlers:** Functions like `openAddModal`, `openEditModal`, `closeModal`, `handleDelete`, `handleToggleStatus`.
* **Memoization:** `useMemo` blocks to derive server filters and define table `actions`.

**Improvement: Create a Reusable `useCrudPage` Hook**

You can abstract almost all this logic into a single, generic hook. This hook would be the engine for all your data-driven pages.

**Step 1: Create the `useCrudPage` Hook**
Create a new file, for example `hooks/useCrudPage.ts`:

```typescript
// hooks/useCrudPage.ts
"use client";

import { useState, useMemo, useCallback, useEffect } from "react";
import { useDebounce } from "use-debounce";
import { createClient } from "@/utils/supabase/client";
import {
  useTableWithRelations,
  useTableInsert,
  useTableUpdate,
  useToggleStatus,
  Filters,
  TableName,
  Row,
  TableInsert,
  TableUpdate,
} from "@/hooks/database";
import { toast } from "sonner";
import { useDeleteManager } from "./useDeleteManager";

// A generic type to ensure records passed to actions have an 'id' and optionally a 'name'
type RecordWithId<T = Record<string, unknown>> = {
  id: string | number;
  name?: string;
} & T;

/**
 * A comprehensive hook to manage the state and logic for a standard CRUD page.
 * @param tableName The name of the Supabase table.
 * @param options Configuration options for the hook.
 */
export function useCrudPage<T extends TableName>({
  tableName,
  relations = [],
  searchColumn = "name",
}: {
  tableName: T;
  relations?: string[];
  searchColumn: (keyof Row<T> & string) | "name";
}) {
  const supabase = createClient();

  // --- STATE MANAGEMENT ---
  const [currentPage, setCurrentPage] = useState(1);
  const [pageLimit, setPageLimit] = useState(10);
  const [searchQuery, setSearchQuery] = useState("");
  const [filters, setFilters] = useState<Filters>({});
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingRecord, setEditingRecord] = useState<Row<T> | null>(null);
  const [debouncedSearch] = useDebounce(searchQuery, 400);

  // --- FILTERS ---
  const serverFilters = useMemo(() => {
    const combinedFilters: Filters = { ...filters };
    if (debouncedSearch) {
      combinedFilters[searchColumn] = {
        operator: "ilike",
        value: `%${debouncedSearch}%`,
      };
    }
    return combinedFilters;
  }, [filters, debouncedSearch, searchColumn]);

  // Reset pagination when filters change
  useEffect(() => {
    setCurrentPage(1);
  }, [debouncedSearch, filters]);

  // --- DATA FETCHING ---
  const { data, isLoading, error, refetch } = useTableWithRelations(
    supabase,
    tableName,
    relations,
    {
      filters: serverFilters,
      limit: pageLimit,
      offset: (currentPage - 1) * pageLimit,
      includeCount: true,
    }
  );

  const totalCount =
    (data?.[0] as { total_count: number })?.total_count ?? data?.length ?? 0;

  // --- MUTATIONS ---
  const { mutate: insertItem, isPending: isInserting } = useTableInsert(
    supabase,
    tableName,
    {
      onSuccess: () => {
        refetch();
        closeModal();
        toast.success("Record created successfully!");
      },
      onError: (err) => toast.error(`Creation failed: ${err.message}`),
    }
  );
  const { mutate: updateItem, isPending: isUpdating } = useTableUpdate(
    supabase,
    tableName,
    {
      onSuccess: () => {
        refetch();
        closeModal();
        toast.success("Record updated successfully!");
      },
      onError: (err) => toast.error(`Update failed: ${err.message}`),
    }
  );
  const { mutate: toggleStatus } = useToggleStatus(supabase, tableName, {
    onSuccess: () => refetch(),
    onError: (err) => toast.error(`Status toggle failed: ${err.message}`),
  });

  // *** INTEGRATE useDeleteManager ***
  const deleteManager = useDeleteManager({ tableName, onSuccess: refetch });

  const isMutating = isInserting || isUpdating || deleteManager.isPending;

  // --- HANDLERS ---
  const openAddModal = useCallback(() => {
    setEditingRecord(null);
    setIsModalOpen(true);
  }, []);
  const openEditModal = useCallback((record: Row<T>) => {
    setEditingRecord(record);
    setIsModalOpen(true);
  }, []);
  const closeModal = useCallback(() => {
    setIsModalOpen(false);
    setEditingRecord(null);
  }, []);

  const handleSave = useCallback(
    (formData: Partial<TableInsert<T>>) => {
      if (editingRecord && "id" in editingRecord && editingRecord.id) {
        updateItem({
          id: String(editingRecord.id),
          data: formData as TableUpdate<T>,
        });
      } else {
        insertItem(formData as TableInsert<T>);
      }
    },
    [editingRecord, insertItem, updateItem]
  );

  // The delete handler now just triggers the delete manager
  const handleDelete = useCallback(
    (record: RecordWithId) => {
      deleteManager.deleteSingle({
        id: String(record.id),
        name: record.name || String(record.id),
      });
    },
    [deleteManager]
  );

  const handleToggleStatus = useCallback(
    (record: RecordWithId & { status?: boolean | null }) => {
      toggleStatus({
        id: String(record.id),
        status: !(record.status ?? false) // Default to false if null/undefined
      });
    },
    [toggleStatus]
  );

  // --- RETURN VALUE ---
  return {
    // Data and state
    data: data || [],
    totalCount,
    isLoading,
    error,
    isMutating,
    refetch,

    // UI State
    pagination: { currentPage, pageLimit, setCurrentPage, setPageLimit },
    search: { searchQuery, setSearchQuery },
    filters: { filters, setFilters },
    modal: { isModalOpen, editingRecord, openAddModal, openEditModal, closeModal },

    // Actions
    actions: { handleSave, handleDelete, handleToggleStatus },

    // Expose delete modal state and handlers directly
    deleteModal: {
      isOpen: deleteManager.isConfirmModalOpen,
      message: deleteManager.confirmationMessage,
      confirm: deleteManager.handleConfirm,
      cancel: deleteManager.handleCancel,
      isLoading: deleteManager.isPending,
    },
  };
}
```

**Step 2: Refactor a Page to Use the Hook**

Now, your `app/dashboard/rings/page.tsx` would become dramatically simpler.

**Before (app/dashboard/rings/page.tsx):**

* ~150 lines of state, effects, memos, and handlers.

**After (app/dashboard/rings/page.tsx):**
```typescript
// app/dashboard/rings/page.tsx
"use client";

import React, { useMemo } from "react";
import { DataTable } from "@/components/table/DataTable";
import { Row } from "@/hooks/database";
import { getRingsTableColumns } from "@/components/rings/RingsTableColumns";
import { RingsFilters } from "@/components/rings/RingsFilters";
import { FiEdit2, FiTrash2, FiToggleLeft, FiToggleRight } from "react-icons/fi";
import { RingModal, RingRow } from "@/components/rings/RingModal";
import { RingsHeader } from "@/components/rings/RingsHeader";
import { useCrudPage } from "@/hooks/useCrudPage";
import { ConfirmModal } from "@/components/common/ui";
import { TableAction } from "@/components/table/datatable-types";

const RingsPage = () => {
  const {
    data: ringsData,
    totalCount,
    isLoading,
    refetch,
    pagination,
    search,
    modal,
    actions: crudActions,
    deleteModal, // Destructure the delete modal state
  } = useCrudPage({
    tableName: "rings",
    relations: [
      "ring_type:ring_type_id(id, code)",
      "maintenance_terminal:maintenance_terminal_id(id,name)"
    ],
    searchColumn: 'name',
  });

  const columns = useMemo(() => getRingsTableColumns(), []);

  const tableActions = useMemo<TableAction<'rings'>[]>(() => [
    {
      key: "edit",
      label: "Edit",
      icon: <FiEdit2 />,
      onClick: (record) => modal.openEditModal(record)
    },
    {
      key: "activate",
      label: "Activate",
      icon: <FiToggleRight />,
      hidden: (r) => Boolean(r.status),
      onClick: (r) => crudActions.handleToggleStatus(r)
    },
    {
      key: "deactivate",
      label: "Deactivate",
      icon: <FiToggleLeft />,
      hidden: (r) => !r.status,
      onClick: (r) => crudActions.handleToggleStatus(r)
    },
    {
      key: "delete",
      label: "Delete",
      icon: <FiTrash2 />,
      variant: "danger" as const,
      onClick: (r) => crudActions.handleDelete(r)
    },
  ], [modal, crudActions]);


  return (
    <div className='mx-auto space-y-4'>
      {/* Header */}
      <RingsHeader onRefresh={refetch} onAddNew={modal.openAddModal} isLoading={isLoading} totalCount={totalCount} />

      {/* Table */}
      <DataTable
        tableName='rings'
        data={ringsData as Row<'rings'>[]}
        columns={columns}
        loading={isLoading}
        actions={tableActions}
        pagination={{
          current: pagination.currentPage,
          pageSize: pagination.pageLimit,
          total: totalCount,
          showSizeChanger: true,
          onChange: (page, pageSize) => {
            pagination.setCurrentPage(page);
            pagination.setPageLimit(pageSize);
          },
        }}
        customToolbar={<RingsFilters searchQuery={search.searchQuery} onSearchChange={search.setSearchQuery} />}
      />

      <RingModal
        isOpen={modal.isModalOpen}
        onClose={modal.closeModal}
        editingRing={modal.editingRecord as RingRow | null}
        onCreated={crudActions.handleSave}
        onUpdated={crudActions.handleSave}
      />

      {/* Render the confirmation modal, driven by the hook's state */}
      <ConfirmModal
        isOpen={deleteModal.isOpen}
        onConfirm={deleteModal.confirm}
        onCancel={deleteModal.cancel}
        title="Confirm Deletion"
        message={deleteModal.message}
        confirmText="Delete"
        cancelText="Cancel"
        type="danger"
        showIcon
        loading={deleteModal.isLoading}
      />
    </div>
  );
};

export default RingsPage;
```
*Benefit: This reduces page-specific code by over 70%, centralizes data logic, and makes creating new data-heavy pages incredibly fast.*

---
### 2. UI & Components: Creating a Consistent Design System

**Observation:**
You have components that serve the same purpose but are implemented slightly differently across pages, leading to minor inconsistencies.

*   **Page Headers:** `RingsHeader.tsx`, `CategoriesHeader.tsx`, `NodesHeader.tsx` and the inline header in `employees/page.tsx` are all very similar.
*   **Form Footers:** The `Cancel` and `Save Changes` buttons in your modals (`RingModal`, `NodeFormModal`, `EmployeeForm`) are styled and structured slightly differently.
*   **Filter UI:** The filter panels in `EmployeeFilters.tsx` and `UserFilters.tsx` are built from scratch.

**Improvement: Create Abstracted UI Components**

1.  **Create a `<PageHeader>` component:** This component should accept `title`, `description`, and an `actions` prop (which can be a `ReactNode`) to hold the buttons. This would unify the look of all your dashboard page headers.

2.  **Create a `<FormFooter>` component:** This component would render a standardized `Cancel` button and a `Submit` button. It would accept `onCancel`, `isLoading`, and `submitText` props. You could then use this in all your form modals. Your `FormCard` component is a great foundation for this.

3.  **Create a `<FilterBar>` component:** This component could take an array of filter configurations (e.g., `{ type: 'select', options: [...] }`, `{ type: 'search' }`) and render the filter controls dynamically, further reducing boilerplate in your specific filter components.

*Benefit: Enforces a strict visual and functional consistency across the application, improving UX and making the UI easier to reason about.*

---

### 3. Configuration & Styling: Centralizing Constants

**Observation:**
You have hardcoded strings and styles that could be centralized.

*   **Colors:** You use Tailwind classes like `bg-blue-600`, `text-red-500` directly.
*   **Default Values:** Default values for pagination or debounce delays are set independently on each page.

**Improvement: Centralize in Configuration Files**

1.  **Use CSS Variables for Theme Colors:** As mentioned previously, define your color palette in `globals.css` and reference it in `tailwind.config.js`. This makes your entire color scheme changeable from one place.

2.  **Create a `config/constants.ts` file:**
    ```typescript
    // config/constants.ts
    export const DEFAULTS = {
      DEBOUNCE_DELAY: 400,
      PAGE_SIZE: 10,
      PAGE_SIZE_OPTIONS: [10, 20, 50, 100],
    };
    ```
    Now your pages can import these defaults (`DEFAULTS.PAGE_SIZE`) instead of hardcoding the number `10`.

*Benefit: Makes global changes trivial and ensures that behaviors like search debounce and pagination are consistent everywhere.*

Of course. You've already addressed the most direct repetitions. The next level of applying the DRY principle involves abstracting patterns in logic, behavior, and architecture. These suggestions are aimed at making your application more robust, scalable, and even faster to develop new features for.

Here are further suggestions beyond type/schema repetition:

### 1. Data Fetching & State Logic: Optimistic Updates

**Observation:**
Your mutation hooks (`useTableInsert`, `useTableUpdate`, `useToggleStatus`) currently wait for the database to confirm a change before updating the UI. This is safe but can feel slow to the user. A toggle click, for example, should feel instant.

**Improvement: Implement Optimistic Updates with React Query**

React Query has a powerful `onMutate` lifecycle function that allows you to update the local cache *before* the mutation is sent. If the mutation fails, you can roll back the change.

**Example: `useToggleStatus` in `hooks/database/basic-mutation-hooks.ts`**

**Before:**
```typescript
export function useToggleStatus<T extends TableName>(supabase: SupabaseClient<Database>, tableName: T, options?: UseTableMutationOptions<TableRow<T>, { id: string; status: boolean; }>) {
  // ...
  return useMutation({
    mutationFn: async ({ id, status }) => { /* ... */ },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["table", tableName] });
    },
  });
}
```

**After (with Optimistic Update):**

```typescript
export function useToggleStatus<T extends TableName>(supabase: SupabaseClient<Database>, tableName: T, options?: UseTableMutationOptions<TableRow<T>, { id: string; status: boolean; }>) {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async ({ id, status }) => { /* ... */ },

    // This is the new part
    onMutate: async (variables) => {
      const { id, status } = variables;
      // 1. Cancel any outgoing refetches (so they don't overwrite our optimistic update)
      await queryClient.cancelQueries({ queryKey: ["table", tableName] });

      // 2. Snapshot the previous value
      const previousData = queryClient.getQueryData(["table", tableName]);

      // 3. Optimistically update to the new value
      queryClient.setQueryData(["table", tableName], (oldData: any[] | undefined) =>
        oldData?.map(item => (item.id === id ? { ...item, status: status } : item))
      );

      // 4. Return a context object with the snapshotted value
      return { previousData };
    },

    // 5. If the mutation fails, use the context returned from onMutate to roll back
    onError: (err, variables, context) => {
      if (context?.previousData) {
        queryClient.setQueryData(["table", tableName], context.previousData);
      }
      toast.error("Update failed, changes have been reverted.");
    },

    // 6. Always refetch after the mutation is settled (success or error)
    onSettled: () => {
      queryClient.invalidateQueries({ queryKey: ["table", tableName] });
    },
  });
}
```

* **Benefit:** The UI updates instantly, providing a much faster and more responsive user experience. The application feels more like a native desktop app. This pattern can be applied to `delete` and `update` mutations as well.

### 2. API Layer Abstraction

**Observation:**
Your React Query hooks directly call Supabase functions (`supabase.from(...)` or `supabase.rpc(...)`). This tightly couples your data fetching logic to the Supabase client instance.

**Improvement: Create a Dedicated Service/API Layer**

Create a directory like `services/` and abstract the actual Supabase calls into dedicated functions. Your hooks will then call these functions instead of Supabase directly.

**Example: Ring Management**

**Step 1: Create `services/ringService.ts`**

```typescript
// services/ringService.ts
import { createClient } from '@/utils/supabase/client';

export const ringService = {
  async getAll(params: { relations?: string[], filters?: any }) {
    const supabase = createClient();
    let query = supabase.from('rings').select(
      params.relations ? `*, ${params.relations.join(',')}` : '*'
    );
    // apply filters...
    const { data, error } = await query;
    if (error) throw error;
    return data;
  },

  async update(id: string, updates: any) {
    const supabase = createClient();
    const { data, error } = await supabase.from('rings').update(updates).eq('id', id).select().single();
    if (error) throw error;
    return data;
  }
};
```

**Step 2: Refactor the Hook to Use the Service**

```typescript
// in your react-query hooks file
import { ringService } from '@/services/ringService';

export function useGetAllRings(params) {
  return useQuery({
    queryKey: ['rings', params],
    queryFn: () => ringService.getAll(params), // Call the service instead of Supabase
  });
}

export function useUpdateRing() {
  return useMutation({
    mutationFn: ({ id, updates }) => ringService.update(id, updates), // Call the service
    // ... onSuccess, onError handlers
  });
}
```

* **Benefit:**
  * **Decoupling:** If you ever migrate away from Supabase or change your backend, you only need to update the `services` files, not every single hook.
  * **Testability:** It's much easier to mock `ringService.getAll` in a unit test than to mock the entire Supabase client.
  * **Centralization:** All logic related to fetching or manipulating "rings" is in one place.

### 3. Error Handling and User Feedback

**Observation:**
Most errors are handled by a `toast`. While good, some errors (like a full page failing to load) could be handled more gracefully.

**Improvement: Use Error Boundaries and a Standard `<ErrorDisplay>` Component**

1. **Create an Error Boundary:** Wrap your main dashboard layout in a React Error Boundary. This is a class component that catches JavaScript errors anywhere in its child component tree. Instead of the whole app crashing, it can display a fallback UI.
2. **Generalize Your `<ErrorDisplay>` Component:** Your `components/categories/ErrorDisplay.tsx` is perfect. Generalize it to be used on any page where a primary data fetch might fail (e.g., inside the `AdminUsersPage` if the user query fails).

**Example Usage in a Page:**

```typescript
// app/dashboard/users/page.tsx

const { data, isLoading, isError, error } = useAdminGetAllUsersExtended(...);

if (isError) {
  // Use a generalized component instead of the one from 'categories'
  return <ErrorDisplay error={error} onRetry={refetch} />;
}
```

* **Benefit:** Makes your application more resilient. A single component crashing won't take down the entire page, and you can provide more contextual error messages to the user than a simple toast.

### 4. Developer Experience: Storybook

**Observation:**
You have a growing library of well-defined, reusable UI components (`Button`, `Modal`, `SearchableSelect`, `DataTable`, etc.). As the project grows, developing and testing these in isolation becomes difficult.

**Improvement: Integrate Storybook**

Storybook is a tool for building UI components in isolation. You would create "stories" for each of your components, allowing you to see and interact with them in all their different states (e.g., a `Button` in its `loading`, `disabled`, `primary`, and `danger` states) without needing to run the full application.

* **Benefit:**
  * **Faster Development:** Build and test components without needing to navigate through your app's auth and page structure.
  * **Visual Regression Testing:** Automatically detect unintended visual changes to your components.
  * **Living Documentation:** Storybook acts as a live style guide and documentation for your design system.

Of course. Since we've covered the most direct code repetitions, let's move on to higher-level architectural patterns and best practices. These suggestions focus on making the `hnvtx` project more scalable, secure, and professional.

### 1. Performance & Scalability

As your database grows, how you fetch and display data becomes critical.

#### **Suggestion: Implement Database Indexing**

* **Observation:** Your queries rely on filtering and ordering by columns like `category`, `name`, `status`, `ofc_id`, `sn_id`, `en_id`, and various foreign keys (`_id` columns). Without proper indexes, these queries will become progressively slower as your tables grow.
* **Improvement:** Add database indexes on frequently queried columns. You can do this directly in the Supabase dashboard or via a SQL migration script.
  ```sql
  -- Example indexes for a migration file

  -- For filtering lookup types by category
  CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_lookup_types_category ON public.lookup_types (category);

  -- For filtering OFC connections by the cable they belong to
  CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_ofc_connections_ofc_id ON public.ofc_connections (ofc_id);

  -- For searching employees by name (using a trigram index for ILIKE)
  CREATE EXTENSION IF NOT EXISTS pg_trgm;
  CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_employees_name_trgm ON public.employees USING gin (employee_name gin_trgm_ops);

  -- Composite index for frequent combined filters
  CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_systems_type_and_node ON public.systems (system_type_id, node_id);
  ```
* **Benefit:** This is one of the most effective ways to boost database performance. Queries that used to take seconds on large tables can be reduced to milliseconds, dramatically improving application speed.

#### **Suggestion: Implement UI Skeleton Loaders**

* **Observation:** When data is loading, the UI shows a spinner. While functional, it can lead to a disjointed experience where the layout shifts abruptly once data arrives.
* **Improvement:** Create and use skeleton loader components that mimic the final layout of your data tables, cards, and headers. Your `components/common/ui/table/TableSkeleton.tsx` is the perfect foundation for this.
  * In `app/dashboard/rings/page.tsx`, when `ringsLoading` is true, render `<PageSkeleton />` instead of the `DataTable`.
  * The `<PageSkeleton />` can be configured to show a skeleton version of the header, filter bar, and table rows.
* **Benefit:** Improves the *perceived performance* of your application significantly. The user sees a stable layout immediately, which feels faster and more polished than a blank screen with a spinner.

### 2. Security & Robustness

Moving security logic as close to the data as possible is a best practice.

#### **Suggestion: Implement Supabase Row-Level Security (RLS)**

* **Observation:** Your current security model relies on client-side logic (`useUserPermissions`, `Protected` component) to hide UI elements and prevent navigation. While this is good for UX, a savvy user could still attempt to call the API directly to access data they shouldn't see.
* **Improvement:** Enable Row-Level Security (RLS) on your Supabase tables. RLS applies security rules directly in the database, ensuring that even direct API calls only return data the authenticated user is permitted to see.
  * **Example Policy:** An RLS policy on the `user_profiles` table could state that a user can only see their own profile, unless they have the 'admin' role.

  ```sql
  -- Enable RLS on the user_profiles table
  ALTER TABLE public.user_profiles ENABLE ROW LEVEL SECURITY;

  -- Policy: Admins can see all profiles
  CREATE POLICY "Admins can view all profiles"
  ON public.user_profiles FOR SELECT
  USING (get_my_role() = 'admin'); -- Assumes you have a helper function

  -- Policy: Users can view their own profile
  CREATE POLICY "Users can view their own profile"
  ON public.user_profiles FOR SELECT
  USING (auth.uid() = id);
  ```
* **Benefit:** This creates a much more secure application. It becomes your primary line of defense, ensuring data access rules are enforced at the database level, regardless of how the data is requested.

### 3. Developer Experience & Code Quality

These suggestions make the project easier to work on and less prone to bugs.

#### **Suggestion: Centralize React Query Keys**

* **Observation:** Your query keys are often constructed inline within the `useQuery` calls (e.g., `["table", tableName, ...]`). This can lead to inconsistencies and makes it difficult to manage cache invalidation from different parts of the app. Your `ofcadv/queryKeys.ts` is a great start, but this pattern should be global.
* **Improvement:** Create a central `queryKeys.ts` factory file for the entire application.
  ```typescript
  // lib/queryKeys.ts
  export const queryKeys = {
    all: ['all'] as const,

    // Tables
    tables: () => [...queryKeys.all, 'tables'] as const,
    table: (tableName: string) => [...queryKeys.tables(), tableName] as const,
    tableList: (tableName: string, filters: any) => [...queryKeys.table(tableName), 'list', filters] as const,
    tableDetail: (tableName: string, id: string) => [...queryKeys.table(tableName), 'detail', id] as const,

    // Auth
    user: () => ['user'] as const,
    role: () => ['role'] as const,
  };
  ```

  Now your hooks can use this factory:
  `useQuery({ queryKey: queryKeys.tableList("rings", { filters }), ... })`
* **Benefit:** Eliminates "magic strings" for query keys, provides autocompletion, and makes cache invalidation (`queryClient.invalidateQueries({ queryKey: queryKeys.table("rings") })`) much safer and less error-prone.

#### **Suggestion: Implement Automated Testing**

* **Observation:** The project currently lacks an automated testing suite. As complexity grows, it becomes impossible to manually test every feature after making a change.
* **Improvement:** Introduce a multi-layered testing strategy.
  1. **Unit Tests (Jest & React Testing Library):** For small, isolated components and utility functions. Test your `formatters.ts` functions or your `Button` component in different states.
  2. **Integration Tests (Jest & React Testing Library):** Test how multiple components work together. For example, test that clicking the "Add Ring" button correctly opens the `RingModal`.
  3. **End-to-End (E2E) Tests (Cypress or Playwright):** Simulate a real user journey. Write a test that logs in, navigates to the rings page, creates a new ring, verifies it appears in the table, and then deletes it.
* **Benefit:** Provides a safety net that catches regressions automatically, giving you the confidence to refactor and add new features without breaking existing ones. This is a cornerstone of professional software development.

You've hit on a critical and advanced feature that moves your project from a simple inventory system to a true network topology management tool. This is an excellent next step, and while it's complex, it's absolutely achievable with your current setup.

I understand completely:

1. **Schema Correction:** The `systems` table needs a `ring_no` field.
2. **Path Building:** You want to create a specific, ordered path for a system's ring using existing `ofc_cables` as segments.
3. **Cascading Logic:** If one cable doesn't complete the path to the next required node, you need to add another cable in sequence.
4. **Contextual UI:** The UI for adding a path segment should be "smart"—it should only show you cables that can logically be connected next.

Here is a comprehensive, step-by-step strategy to implement this.

### Phase 1: Schema and Data Model Changes (The Foundation)

First, we need to update your database and Zod schemas to support this new relationship.

#### **Step 1: Update the `systems` Table**

Let's add the `ring_no` field you mentioned.

**SQL Migration:**

```sql
ALTER TABLE public.systems
ADD COLUMN ring_no VARCHAR(255);

-- Optional: Add an index if you plan to search by ring number frequently
CREATE INDEX IF NOT EXISTS idx_systems_ring_no ON public.systems (ring_no);
```

#### **Step 2: Create a New Linking Table**

This is the core of the solution. We need a new table to define the relationship between a system, the OFC cables that form its path, and the order of those cables. Let's call it `system_ring_paths`.

**SQL Migration:**

```sql
CREATE TABLE public.system_ring_paths (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    system_id UUID NOT NULL REFERENCES public.systems(id) ON DELETE CASCADE,
    ofc_cable_id UUID NOT NULL REFERENCES public.ofc_cables(id) ON DELETE RESTRICT,
    path_order INT NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW(),

    -- Ensures a system can't have the same cable twice in its path
    UNIQUE (system_id, ofc_cable_id),

    -- Ensures the order is unique for each system's path
    UNIQUE (system_id, path_order)
);

-- Add indexes for efficient querying
CREATE INDEX idx_system_ring_paths_system_id ON public.system_ring_paths (system_id);
CREATE INDEX idx_system_ring_paths_ofc_cable_id ON public.system_ring_paths (ofc_cable_id);
```

* `system_id`: Links back to the system this path belongs to.
* `ofc_cable_id`: Links to the `ofc_cables` record that acts as a segment in the path.
* `path_order`: A simple integer (`1`, `2`, `3`...) that defines the sequence of the cables. This is how you achieve the "cascading" effect.

### Phase 2: Update Zod Schemas (`schemas/schema.ts`)

Now, reflect these database changes in your Zod schemas to maintain type safety.

**File:** `schemas/schema.ts`

**Action:**

1. Add `ring_no` to `systemSchema`.
2. Create a new schema for `system_ring_paths`.

```typescript
// ... inside schemas/schema.ts

// 1. UPDATE systemSchema
export const systemSchema = z.object({
  id: z.uuid().optional(),
  system_type_id: z.string().uuid({ message: "System type is required." }),
  node_id: z.string().uuid({ message: "Node is required." }),
  system_name: z.string().optional().nullable(),
  ip_address: ipValidation.optional().or(z.literal('')),
  ring_no: z.string().optional().nullable(), // <-- ADD THIS LINE
  maintenance_terminal_id: z.uuid().optional().nullable(),
  commissioned_on: z.coerce.date().optional().nullable(),
  remark: z.string().optional().nullable(),
  status: z.boolean().default(true).optional(),
  created_at: z.coerce.date().optional(),
  updated_at: z.coerce.date().optional(),
});

// 2. CREATE the new systemRingPathSchema
export const systemRingPathSchema = z.object({
    id: z.uuid().optional(),
    system_id: z.string().uuid(),
    ofc_cable_id: z.string().uuid(),
    path_order: z.number().int().positive(),
    created_at: z.coerce.date().optional(),
});
```

### Phase 3: Implementation Strategy (UI & Logic)

This is where we build the user interface for managing these paths. The best place for this is a dedicated **System Details Page**.

#### **Step 1: Create a System Details Page**

Create a new page at `app/dashboard/systems/[id]/page.tsx`. This page will fetch details for a single system and display a new section for managing its ring path.

#### **Step 2: Design the "Ring Path" UI Component**

On the System Details page, create a new component. It should:

1. Display the system's `ring_no`.
2. Show a list of the OFC cables currently in its path, in the correct order. Each item should show the cable's `route_name` and its start/end nodes.
3. Have an "Add Path Segment" button.
4. Allow re-ordering and deleting of existing segments.

#### **Step 3: Implement the "Smart" Segment Selector Logic**

This is the most crucial part. When a user clicks "Add Path Segment", the dropdown should only show valid next options.

Here's the logic for the hook that will power this dropdown (`useAvailableSegments`):

1. **Determine the "Last Node":**

   * Query the `system_ring_paths` table for the current system, ordered by `path_order DESC`, limit 1.
   * If a segment exists, get its `ofc_cable_id` and then fetch that cable's `en_id` (ending node). This is your "last node".
   * If **no segments exist** for this system yet, the "last node" is the system's own `node_id`.
2. **Find Available Cables:**

   * Query the `ofc_cables` table.
   * The condition is: `WHERE sn_id = <last_node_id> OR en_id = <last_node_id>`.
   * **Crucially**, you must also filter out any `ofc_cable_id` that is *already* in the current system's path to prevent adding the same cable twice or creating loops.

**Example Hook Implementation:**

```typescript
// hooks/useAvailableSegments.ts
import { useTableQuery } from '@/hooks/database';

function useAvailableSegments(systemId: string, systemNodeId: string) {
  const supabase = createClient();

  // 1. Get the current path to find the last node and exclude existing cables
  const { data: currentPath } = useTableQuery(supabase, 'system_ring_paths', {
    filters: { system_id: systemId },
    orderBy: [{ column: 'path_order', ascending: false }],
  });

  const lastSegment = currentPath?.[0];
  const lastCableId = lastSegment?.ofc_cable_id;

  // 2. Fetch the last cable to find its end node
  const { data: lastCable } = useTableQuery(supabase, 'ofc_cables', {
    filters: { id: lastCableId },
    enabled: !!lastCableId,
  });

  const lastNodeId = lastCable?.[0]?.en_id ?? systemNodeId;
  const existingCableIds = currentPath?.map(p => p.ofc_cable_id) ?? [];

  // 3. Fetch available next cables
  const { data: availableCables, isLoading } = useTableQuery(supabase, 'ofc_cables', {
    filters: {
      or: `(sn_id.eq.${lastNodeId},en_id.eq.${lastNodeId})`,
      id: { operator: 'not.in', value: `(${existingCableIds.join(',')})` }
    },
    enabled: !!lastNodeId,
  });

  return { availableCables, isLoading };
}```

### Phase 4: Backend View for Easy Data Retrieval

To make it easy to display the full path on the client, create a database view that joins all the necessary information.

**SQL Migration for the View:**
```sql
CREATE OR REPLACE VIEW public.v_system_ring_paths_detailed AS
SELECT
  srp.id,
  srp.system_id,
  srp.ofc_cable_id,
  srp.path_order,
  s.system_name,
  s.ring_no,
  oc.route_name,
  oc.sn_id AS start_node_id,
  sn.name AS start_node_name,
  oc.en_id AS end_node_id,
  en.name AS end_node_name,
  srp.created_at
FROM
  public.system_ring_paths srp
  JOIN public.systems s ON srp.system_id = s.id
  JOIN public.ofc_cables oc ON srp.ofc_cable_id = oc.id
  LEFT JOIN public.nodes sn ON oc.sn_id = sn.id
  LEFT JOIN public.nodes en ON oc.en_id = en.id
ORDER BY
  srp.system_id,
  srp.path_order;
```

Now, on your System Details page, you can simply query this view to get all the path segments for a given system, already joined with the cable and node names, perfectly ordered.

This comprehensive approach addresses your requirements by updating the schema, reflecting those changes in your validation layer, providing a clear UI/UX strategy for implementation, and creating a performant backend view to simplify data fetching.

That's an excellent and critical question. It gets to the heart of the relationship between the physical path and the logical connections.

The direct answer is **no, it will not happen automatically** based on the schema and logic we've discussed so far. Adding an `ofc_cable` to the `system_ring_paths` table does not, by itself, update the `system_id` column in the `ofc_connections` table.

### Why It's Not Automatic (And Shouldn't Be)

This is a crucial distinction in your data model:

* **`system_ring_paths` (Physical Path):** This table defines the *physical route* or the sequence of cables the ring follows. Think of it as defining the series of highways you will take on a road trip.
* **`ofc_connections` (Logical Connection):** This table represents an individual *fiber* within a cable. Assigning a `system_id` to a row here means you are provisioning a specific service onto a specific strand of glass. Think of it as assigning a specific car (your system) to a specific lane (a fiber) on one of those highways.

When you add a cable to the path, the system doesn't know *which of the 48 or 96 fibers* inside that cable should be assigned to this specific system. This needs to be a separate, deliberate action.

### The Correct Approach: A Two-Step Provisioning Process

The best practice is to treat this as a two-step process in your UI, which mirrors real-world network provisioning:

1. **Step 1: Define the Physical Path (What you just designed).** A user goes to the System Details page and adds the `ofc_cable` segments in the correct order to build the ring. The `system_ring_paths` table is now populated.
2. **Step 2: Provision the System onto the Fibers (The new part).** After the path is defined, the user needs to assign the system to specific fibers along that path.

Here is how you can implement this second step:

#### **1. Create a "Manage Connections" UI**

On your `app/dashboard/systems/[id]/page.tsx`, below the "Ring Path" builder, add a new section called "Fiber-Level Connections" or "System Provisioning".

This UI will:

* Fetch all the cable segments from your `v_system_ring_paths_detailed` view for the current system.
* For each cable segment in the path, it will display a list of its available fiber connections (rows from `ofc_connections`).
* The user can then select a fiber (e.g., `fiber_no_sn`) and click an "Assign to this System" button.

#### **2. Implement the "Assign System" Logic**

The "Assign to this System" button will trigger a mutation.

* **Action:** It will perform an `UPDATE` on the `ofc_connections` table.
* **Condition:** `WHERE id = <selected_fiber_connection_id>`
* **Update:** `SET system_id = <current_system_id>`

You can build a powerful UI for this. Imagine a list of all fibers in the path, and you can bulk-select and assign them.

**Conceptual Code for the Connections Component:**

```typescript
// components/systems/SystemFiberProvisioning.tsx

// ... imports

const SystemFiberProvisioning = ({ system }) => {
  const supabase = createClient();
  const queryClient = useQueryClient();

  // 1. Get the cable IDs in the path for this system
  const { data: pathSegments } = useTableQuery(supabase, 'system_ring_paths', {
    filters: { system_id: system.id },
    columns: 'ofc_cable_id'
  });
  const cableIdsInPath = pathSegments?.map(p => p.ofc_cable_id) || [];

  // 2. Fetch all fiber connections for those cables
  const { data: fiberConnections, refetch } = useTableQuery(supabase, 'ofc_connections', {
    filters: { ofc_id: { operator: 'in', value: cableIdsInPath } },
    enabled: cableIdsInPath.length > 0,
  });

  // 3. Create the mutation to update the system_id
  const { mutate: assignSystem, isPending } = useTableUpdate(supabase, 'ofc_connections', {
    onSuccess: () => {
      toast.success("System assigned to fiber successfully!");
      refetch(); // Refetch the connections to show the updated state
    },
    onError: (err) => toast.error(`Failed to assign system: ${err.message}`),
  });

  const handleAssign = (connectionId: string) => {
    assignSystem({
      id: connectionId,
      data: { system_id: system.id }
    });
  };

  return (
    <div>
      <h3 className="text-lg font-semibold">Provision System on Fibers</h3>
      {fiberConnections?.map(conn => (
        <div key={conn.id} className="flex justify-between items-center p-2 border-b">
          <span>Fiber #{conn.fiber_no_sn} on Cable {conn.ofc_id}</span>
          {conn.system_id ? (
            <span className="text-sm text-gray-500">Assigned to: {conn.system_id === system.id ? <b>This System</b> : conn.system_id}</span>
          ) : (
            <Button onClick={() => handleAssign(conn.id)} disabled={isPending}>
              Assign to this System
            </Button>
          )}
        </div>
      ))}
    </div>
  );
};
```

### Alternative (Advanced & Less Flexible): Database Trigger

If you wanted this to be truly automatic, you would need to write a database trigger. This is generally **not recommended** because it hides business logic in the database and is less flexible.

**How it would work:**

```sql
-- Create a trigger function
CREATE OR REPLACE FUNCTION public.assign_first_available_fiber()
RETURNS TRIGGER AS $$
BEGIN
    UPDATE public.ofc_connections
    SET system_id = NEW.system_id
    WHERE id = (
        SELECT id
        FROM public.ofc_connections
        WHERE ofc_cable_id = NEW.ofc_cable_id
        AND system_id IS NULL
        AND status = TRUE
        ORDER BY fiber_no_sn
        LIMIT 1
    );
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Create the trigger
CREATE TRIGGER on_system_path_insert
AFTER INSERT ON public.system_ring_paths
FOR EACH ROW
EXECUTE FUNCTION public.assign_first_available_fiber();
```

* **Pros:** Fully automatic.
* **Cons:**
  * **No User Control:** It just picks the first available fiber. The user has no say in which one.
  * **"Magic":** This behavior is not obvious from the application code.
  * **Error Handling:** What happens if there are no available fibers? The trigger would do nothing, and the user wouldn't know why.

### Recommendation

**Strongly follow the two-step UI process.** It is more explicit, gives the user full control, and correctly separates the concerns of defining a physical route from the logical act of provisioning a service onto it.

Your thinking is on the right track. Recognizing that this connection needs to happen is the key insight. The solution is to build a dedicated UI for that second, crucial step.

You are absolutely right. My previous answer was an incremental step, but your new question points towards a much larger, more fundamental architectural improvement. You've correctly identified that several tables and concepts (`ofc_connections`, `logical_fiber_paths`, `fiber_joints`) are all part of a bigger picture: **modeling an end-to-end service path.**

Let's address this head-on with a comprehensive, future-proof solution that integrates the ideas from your `plan.md` and correctly models the relationship between physical infrastructure and logical services.

This is a significant architectural upgrade, but it will make your application vastly more powerful and scalable.

### The Core Concept: Separating Physical vs. Logical Layers

The most robust and future-proof solution is to clearly separate the concepts of the **physical network layer** (what exists in the ground) and the **logical service layer** (what services run over it).

1. **Physical Layer:** Consists of `nodes`, `ofc_cables`, and `fiber_joints`. These are tangible assets. An `ofc_connection` represents a single strand of glass *within a single cable*.
2. **Logical Layer:** A `logical_fiber_path` represents an end-to-end circuit or service that is provisioned for a `system`. This path traverses one or more physical assets.

Your current `ofc_connections` table mixes these two layers by having both physical measurements (`otdr_distance`) and logical assignments (`system_id`, `source_port`). We will fix this.

---

### Phase 1: The Definitive Schema Migration

This migration fully embraces the concepts from your `plan.md` and provides the foundation for the new feature.

#### **Step 1: Simplify `ofc_connections` to be Purely Physical**

This table should only describe the state of a fiber within one cable. We will move the logical/system-related fields out.

**SQL Migration (ALTER TABLE):**

```sql
-- First, we need to move the data before we can drop the columns.
-- This is a one-time data migration script.
INSERT INTO logical_fiber_paths (path_name, source_system_id, destination_system_id, path_type, operational_status)
SELECT
    'Migrated Path for System ' || system_id,
    system_id, -- Assuming a system connects to itself or another system (logic may need refinement)
    NULL,      -- Destination system is often unknown in the old model
    'point_to_point',
    CASE WHEN status = TRUE THEN 'active' ELSE 'inactive' END
FROM ofc_connections
WHERE system_id IS NOT NULL;

-- Now, alter the table
ALTER TABLE public.ofc_connections
DROP COLUMN IF EXISTS system_id,
DROP COLUMN IF EXISTS source_port,
DROP COLUMN IF EXISTS destination_port,
DROP COLUMN IF EXISTS connection_category,
DROP COLUMN IF EXISTS connection_type;

-- ADD a new column to link a fiber to its logical path
ALTER TABLE public.ofc_connections
ADD COLUMN logical_path_id UUID REFERENCES public.logical_fiber_paths(id) ON DELETE SET NULL;

CREATE INDEX IF NOT EXISTS idx_ofc_connections_logical_path_id ON public.ofc_connections(logical_path_id);
```

#### **Step 2: Create the `logical_fiber_paths` Table**

This is the central table for your services. It represents a named, end-to-end circuit.

**SQL Migration (CREATE TABLE):**

```sql
CREATE TABLE public.logical_fiber_paths (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    path_name VARCHAR(255) NOT NULL,
    path_type_id UUID REFERENCES public.lookup_types(id), -- e.g., Ring, Point-to-Point, Spur

    -- A path is provisioned FOR a system
    source_system_id UUID NOT NULL REFERENCES public.systems(id) ON DELETE CASCADE,
    destination_system_id UUID REFERENCES public.systems(id) ON DELETE SET NULL,

    -- These fields now live here, not on ofc_connections
    source_port TEXT,
    destination_port TEXT,

    operational_status VARCHAR(50) DEFAULT 'planning', -- e.g., planning, active, maintenance, decommissioned
    total_distance_km NUMERIC(10, 3), -- Will be calculated from segments
    remark TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ
);
```

#### **Step 3: Create the `logical_path_segments` Linking Table**

This is the key to your "cascading" logic. It defines the ordered sequence of physical assets that make up a logical path.

**SQL Migration (CREATE TABLE):**

```sql
CREATE TABLE public.logical_path_segments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    logical_path_id UUID NOT NULL REFERENCES public.logical_fiber_paths(id) ON DELETE CASCADE,

    -- A segment can be EITHER a cable OR a joint (polymorphic)
    ofc_cable_id UUID REFERENCES public.ofc_cables(id),
    fiber_joint_id UUID REFERENCES public.fiber_joints(id),

    -- The order in the path
    path_order INT NOT NULL,

    -- Ensure a segment is either a cable or a joint, not both
    CHECK ((ofc_cable_id IS NOT NULL AND fiber_joint_id IS NULL) OR (ofc_cable_id IS NULL AND fiber_joint_id IS NOT NULL)),

    -- The order must be unique for each path
    UNIQUE (logical_path_id, path_order)
);

CREATE INDEX idx_logical_path_segments_path_id ON public.logical_path_segments(logical_path_id);
```

#### **Step 4: Update `systems` Table**

As requested, add `ring_no`.

```sql
ALTER TABLE public.systems ADD COLUMN ring_no VARCHAR(255);
```

---

### Phase 2: Updating Your Zod Schemas

Now, update `schemas/schema.ts` to reflect this new, robust structure.

```typescript
// in: schemas/schema.ts

// 1. Update systemSchema
export const systemSchema = z.object({
  // ... existing fields
  ring_no: z.string().optional().nullable(), // ADD THIS
});

// 2. Simplify ofcConnectionSchema
export const ofcConnectionSchema = z.object({
  id: z.uuid().optional(),
  ofc_id: z.uuid({ message: "OFC Cable is required." }),
  logical_path_id: z.uuid().optional().nullable(), // This now links to the logical path
  fiber_no_sn: z.number().int({ message: "Start Node Fiber No. is required." }),
  fiber_no_en: z.number().int().optional().nullable(),
  // REMOVED: system_id, source_port, destination_port, connection_category, connection_type
  // ... keep physical measurement fields like otdr_distance, power, etc.
});

// 3. Add new schemas
export const logicalFiberPathSchema = z.object({
  id: z.uuid().optional(),
  path_name: z.string().min(1, "Path name is required."),
  path_type_id: z.uuid().optional().nullable(),
  source_system_id: z.uuid(),
  destination_system_id: z.uuid().optional().nullable(),
  source_port: z.string().optional().nullable(),
  destination_port: z.string().optional().nullable(),
  operational_status: z.string().default('planning'),
  total_distance_km: z.number().optional().nullable(),
  remark: z.string().optional().nullable(),
});

export const logicalPathSegmentSchema = z.object({
    id: z.uuid().optional(),
    logical_path_id: z.uuid(),
    ofc_cable_id: z.uuid().optional().nullable(),
    fiber_joint_id: z.uuid().optional().nullable(),
    path_order: z.number().int().positive(),
}).refine(data => (data.ofc_cable_id && !data.fiber_joint_id) || (!data.ofc_cable_id && data.fiber_joint_id), {
    message: "A segment must be either a cable or a joint, not both.",
    path: ["ofc_cable_id"],
});
```

---

### Phase 3: The "Path Provisioning" UI Workflow

This is how a user would interact with the new system. This would live on a **System Details Page** (`app/dashboard/systems/[id]/page.tsx`).

#### **Step 1: The User Defines a Logical Path**

* On the system's detail page, there is a section called "Logical Paths". The user clicks "Create New Path".
* A modal appears. The user gives the path a **Name** (e.g., "Primary Ring - CPAN Node 12"), selects a **Path Type** (from `lookup_types`), and selects a **Destination System**. The Source System is pre-filled.
* This creates a new record in `logical_fiber_paths` with a status of `planning`.

#### **Step 2: The User Builds the Physical Route (Segment by Segment)**

* After creating the path, the user is presented with the "Path Builder" UI.
* It shows: **Current Path End Point: [Node Name]**. Initially, this is the source system's `node_id`.
* A button "Add Next Segment" opens a "smart" selector.
* **Selector Logic:** The selector queries `ofc_cables` where `sn_id` or `en_id` matches the **Current Path End Point**. It filters out cables already used in this path.
* When a user selects a cable (e.g., `NodeA -> NodeB`), it's added to the path. A new record is created in `logical_path_segments` with the correct `path_order`. The UI updates the **Current Path End Point** to `NodeB`.
* The user repeats this process, "walking" the network from node to node, until the path's end point matches the destination system's `node_id`.

#### **Step 3: The User Provisions a Fiber**

* Once the physical path is complete, a new UI section appears: "Provision Fibers".
* The system checks for end-to-end fiber continuity. It queries `ofc_connections` for **every cable** in the path and finds fiber numbers that are available (i.e., `logical_path_id IS NULL`) across the entire chain.
* The user selects an available fiber number (e.g., Fiber #5).
* On confirmation, a transaction is executed:
  1. `UPDATE public.logical_fiber_paths SET operational_status = 'active' WHERE id = ...;`
  2. For *each* `ofc_cable_id` in the path, it runs: `UPDATE public.ofc_connections SET logical_path_id = <new_path_id> WHERE ofc_cable_id = ... AND fiber_no_sn = 5;`

### Benefits of This Future-Proof Solution

1. **Correctly Models Reality:** It separates the physical infrastructure from the logical services that run on top of it.
2. **Scalable:** This model can handle incredibly complex paths that traverse dozens of cables and joints without modification.
3. **Flexible:** You can now model different types of paths (rings, point-to-point, spurs) using the same tables.
4. **Future-Ready:** It seamlessly integrates your planned `fiber_joints` table. A joint is just another type of segment in the `logical_path_segments` table.
5. **Clear Provisioning:** The link between a system and a fiber is now explicit through the `logical_fiber_paths` table, which is exactly how network services are managed in the real world. The `system_id` is no longer ambiguously attached to a single piece of cable.

```

<!-- path: hnvtx/app/customuppy.css -->
```css
/* Custom Uppy Styles - Add this to your globals.css or import as a separate file */

/* Dark theme customizations */
.uppy-dark .uppy-Dashboard {
  background-color: #1f2937;
  color: #f9fafb;
  border-color: #374151;
}

.uppy-dark .uppy-Dashboard-inner {
  background-color: #1f2937;
  border-color: #374151;
}

.uppy-dark .uppy-Dashboard-AddFiles {
  background-color: #374151;
  border-color: #4b5563;
}

.uppy-dark .uppy-Dashboard-AddFiles:hover {
  background-color: #4b5563;
}

.uppy-dark .uppy-DashboardTab-btn {
  color: #d1d5db;
  background-color: transparent;
}

.uppy-dark .uppy-DashboardTab-btn:hover {
  background-color: #374151;
  color: #f9fafb;
}

.uppy-dark .uppy-DashboardTab-btn:focus {
  background-color: #4b5563;
  color: #f9fafb;
}

.uppy-dark .uppy-DashboardTab-btn[aria-selected="true"] {
  background-color: #3b82f6;
  color: #ffffff;
}

.uppy-dark .uppy-Dashboard-dropFilesHereHint {
  color: #9ca3af;
}

.uppy-dark .uppy-Dashboard-browse {
  color: #60a5fa;
}

.uppy-dark .uppy-Dashboard-browse:hover {
  color: #93c5fd;
}

.uppy-dark .uppy-Dashboard-Item {
  background-color: #374151;
  border-color: #4b5563;
}

.uppy-dark .uppy-Dashboard-Item-preview {
  background-color: #4b5563;
}

.uppy-dark .uppy-Dashboard-Item-name {
  color: #f9fafb;
}

.uppy-dark .uppy-Dashboard-Item-status {
  color: #d1d5db;
}

.uppy-dark .uppy-Dashboard-ItemProgress {
  background-color: #4b5563;
}

.uppy-dark .uppy-Dashboard-ItemProgress-bar {
  background-color: #3b82f6;
}

/* Progress bar customization */
.uppy-ProgressBar {
  height: 8px;
  background-color: #e5e7eb;
  border-radius: 4px;
  overflow: hidden;
}

.uppy-dark .uppy-ProgressBar {
  background-color: #4b5563;
}

.uppy-ProgressBar-inner {
  background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%);
  transition: width 0.3s ease;
  height: 100%;
}

/* Custom drag-drop area */
.uppy-DragDrop-container {
  border: 2px dashed #d1d5db;
  border-radius: 8px;
  background-color: #f9fafb;
  transition: all 0.3s ease;
}

.uppy-dark .uppy-DragDrop-container {
  border-color: #4b5563;
  background-color: #374151;
  color: #f9fafb;
}

.uppy-DragDrop-container:hover,
.uppy-is-drag-over .uppy-DragDrop-container {
  border-color: #3b82f6;
  background-color: #eff6ff;
}

.uppy-dark .uppy-DragDrop-container:hover,
.uppy-dark.uppy-is-drag-over .uppy-DragDrop-container {
  border-color: #60a5fa;
  background-color: #1e3a8a;
}

/* Webcam styles */
.uppy-dark .uppy-Webcam-container {
  background-color: #1f2937;
}

.uppy-dark .uppy-Webcam-video {
  border-color: #374151;
}

.uppy-dark .uppy-Webcam-button {
  background-color: #3b82f6;
  color: #ffffff;
}

.uppy-dark .uppy-Webcam-button:hover {
  background-color: #2563eb;
}

/* Image editor styles */
.uppy-dark .uppy-ImageEditor-container {
  background-color: #1f2937;
}

.uppy-dark .uppy-ImageEditor-sidebar {
  background-color: #374151;
  border-color: #4b5563;
}

.uppy-dark .uppy-ImageEditor-button {
  background-color: #4b5563;
  color: #f9fafb;
  border-color: #6b7280;
}

.uppy-dark .uppy-ImageEditor-button:hover {
  background-color: #6b7280;
}

.uppy-dark .uppy-ImageEditor-button--active {
  background-color: #3b82f6;
  color: #ffffff;
}

/* Custom animations */
@keyframes uppy-fade-in {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.uppy-Dashboard-Item {
  animation: uppy-fade-in 0.3s ease-out;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .uppy-Dashboard {
    border-radius: 0;
  }
  
  .uppy-Dashboard-inner {
    padding: 1rem;
  }
  
  .uppy-DragDrop-container {
    padding: 2rem 1rem;
  }
}

/* File type icons */
.uppy-Dashboard-Item-previewIcon {
  font-size: 2rem;
}

/* Success/Error states */
.uppy-Dashboard-Item--success .uppy-Dashboard-Item-progress {
  background-color: #10b981;
}

.uppy-Dashboard-Item--error .uppy-Dashboard-Item-progress {
  background-color: #ef4444;
}

.uppy-Dashboard-Item--error .uppy-Dashboard-Item-name {
  color: #ef4444;
}

/* Custom button styles */
.uppy-Dashboard-browse,
.uppy-Dashboard-AddFiles-title {
  font-weight: 600;
}

.uppy-Dashboard-AddFiles-info {
  font-size: 0.875rem;
  opacity: 0.8;
}

/* Hide powered by Uppy */
.uppy-Dashboard-poweredBy {
  display: none !important;
}

/* Add this to your customuppy.css file */
.uppy-dashboard-container {
  position: relative;
  width: 100%;
  overflow: hidden;
}

.uppy-dashboard-container .uppy-Dashboard {
  width: 100% !important;
  max-width: 100% !important;
}

.uppy-dashboard-container .uppy-Dashboard-inner {
  width: 100% !important;
  max-width: 100% !important;
  overflow-x: hidden;
}

/* For mobile devices */
@media (max-width: 768px) {
  .uppy-dashboard-container .uppy-Dashboard {
    height: 350px !important; /* Reduced height for mobile */
  }
  
  .uppy-dashboard-container .uppy-Dashboard-files {
    padding: 0 5px;
  }
  
  .uppy-dashboard-container .uppy-DashboardItem-name {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 150px;
  }
}
```

<!-- path: hnvtx/app/globals.css -->
```css
@import "tailwindcss";

@custom-variant dark (&:where([class=dark], [class=dark] *));

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}


/* Smooth transitions for interactive elements */
button,
a {
  transition: opacity 0.15s ease-in-out, transform 0.15s ease-in-out;
}

/* Loading state transitions */
[data-loading='true'] {
  opacity: 0.8;
  transform: translateY(1px);
}

.dark {
  --background: #0a0a0a;
  --foreground: #ededed;
  input[type="date"]::-webkit-calendar-picker-indicator {
    filter: invert(1);
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: var(--font-sans);
  overflow-x: hidden;
}

/* Ensure react-datepicker popper appears above modals/overlays */
.react-datepicker-popper {
  z-index: 9999 !important;
}
```

<!-- path: hnvtx/app/(auth)/signup/page.tsx -->
```typescript
"use client";

import Link from "next/link";
import { redirect, useRouter } from "next/navigation";
import { useAuth } from "@/hooks/useAuth";
import { useEffect } from "react";
import { toast } from "sonner";
import { useForm } from "react-hook-form";
import { SignupFormData, signupSchema } from "@/schemas";
import { zodResolver } from "@hookform/resolvers/zod";

export default function SignUpPage() {
  const { signUp, authState } = useAuth();
  const router = useRouter();

  // Redirect if already authenticated
  useEffect(() => {
    if (authState === "authenticated") {
      redirect("/onboarding");
    }
  }, [authState]);

  // Setup React Hook Form
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
  } = useForm<SignupFormData>({
    resolver: zodResolver(signupSchema),
    defaultValues: {
      firstName: "",
      lastName: "",
      email: "",
      password: "",
      confirmPassword: "",
    },
  });

  // Form submit handler
  const onSubmit = async (data: SignupFormData) => {
    const success = await signUp({
      email: data.email,
      password: data.password,
      firstName: data.firstName,
      lastName: data.lastName,
    });

    if (success) {
      router.push("/verify-email");
    } else {
      toast.error("Sign up failed. Please try again.");
    }
  };

  return (
    <div className='min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8'>
      <div className='max-w-md w-full space-y-8'>
        <div>
          <h2 className='mt-6 text-center text-3xl font-extrabold text-gray-900 dark:text-white'>Create your account</h2>
          <p className='mt-2 text-center text-sm text-gray-600 dark:text-gray-400'>
            Or{" "}
            <Link href='/login' className='font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300'>
              sign in to your existing account
            </Link>
          </p>
        </div>

        <div className='bg-white dark:bg-gray-800 py-8 px-6 shadow-lg rounded-lg'>
          <form className='space-y-6' onSubmit={handleSubmit(onSubmit)}>
            <div className='grid grid-cols-2 gap-4'>
              <div>
                <label htmlFor='firstName' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
                  First name *
                </label>
                <input
                  id='firstName'
                  type='text'
                  autoComplete='given-name'
                  {...register("firstName")}
                  className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white'
                  placeholder='First name'
                />
                {errors.firstName && <p className='text-red-500 text-sm'>{errors.firstName.message}</p>}
              </div>

              <div>
                <label htmlFor='lastName' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
                  Last name *
                </label>
                <input
                  id='lastName'
                  type='text'
                  autoComplete='family-name'
                  {...register("lastName")}
                  className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white'
                  placeholder='Last name'
                />
                {errors.lastName && <p className='text-red-500 text-sm'>{errors.lastName.message}</p>}
              </div>
            </div>

            <div>
              <label htmlFor='email' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
                Email address *
              </label>
              <input
                id='email'
                type='email'
                autoComplete='email'
                {...register("email")}
                className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white'
                placeholder='Enter your email'
              />
              {errors.email && <p className='text-red-500 text-sm'>{errors.email.message}</p>}
            </div>

            <div>
              <label htmlFor='password' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
                Password *
              </label>
              <input
                id='password'
                type='password'
                autoComplete='new-password'
                {...register("password")}
                className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white'
                placeholder='Create a password'
              />
              {errors.password && <p className='text-red-500 text-sm'>{errors.password.message}</p>}
            </div>

            <div>
              <label htmlFor='confirmPassword' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
                Confirm password *
              </label>
              <input
                id='confirmPassword'
                type='password'
                autoComplete='new-password'
                {...register("confirmPassword")}
                className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white'
                placeholder='Confirm your password'
              />
              {errors.confirmPassword && <p className='text-red-500 text-sm'>{errors.confirmPassword.message}</p>}
            </div>

            <div>
              <button
                type='submit'
                disabled={isSubmitting || authState === "loading"}
                className='group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none disabled:opacity-50'>
                {isSubmitting || authState === "loading" ? <div className='animate-spin rounded-full h-5 w-5 border-b-2 border-white'></div> : "Create account"}
              </button>
            </div>

            <div className='text-center'>
              <p className='text-xs text-gray-500 dark:text-gray-400'>
                By creating an account, you agree to our{" "}
                <Link href='/terms' className='text-blue-600 hover:text-blue-500 dark:text-blue-400'>
                  Terms of Service
                </Link>{" "}
                and{" "}
                <Link href='/privacy' className='text-blue-600 hover:text-blue-500 dark:text-blue-400'>
                  Privacy Policy
                </Link>
              </p>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

```

<!-- path: hnvtx/app/(auth)/forgot-password/page.tsx -->
```typescript
// app/(auth)/forgot-password/page.tsx
'use client'

import { motion } from 'framer-motion'
import ForgotPasswordForm from '@/components/auth/ForgotPasswordForm'
import Link from 'next/link'

export default function ForgotPasswordPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8">
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.5 }}
        className="max-w-md w-full space-y-8"
      >
        <div>
          <h2 className="mt-6 text-center text-3xl font-extrabold text-gray-900 dark:text-white">
            Reset your password
          </h2>
          <p className="mt-2 text-center text-sm text-gray-600 dark:text-gray-400">
            Remember your password?{' '}
            <Link
              href="/login"
              className="font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400"
            >
              Sign in
            </Link>
          </p>
        </div>
        <ForgotPasswordForm />
      </motion.div>
    </div>
  )
}

```

<!-- path: hnvtx/app/(auth)/login/page.tsx -->
```typescript
"use client";

import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import Link from "next/link";
import { useRouter, useSearchParams } from "next/navigation";
import { useAuth } from "@/hooks/useAuth";
import OAuthProviders from "@/components/auth/OAuthProviders";
import { useEffect } from "react";
import { toast } from "sonner";
import { UserFormData, userSchema } from "@/schemas";

export default function LoginPage() {
  const { authState, signIn } = useAuth();
  const router = useRouter();
  const searchParams = useSearchParams();
  const redirectTo = searchParams.get("redirectTo") || "/dashboard";
  const errorParam = searchParams.get("error");

  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
  } = useForm<userProfileSchema>({
    resolver: zodResolver(userSchema),
    defaultValues: {
      email: "",
      password: "",
    },
  });

  // Redirect if already authenticated
  useEffect(() => {
    if (authState === "authenticated") {
      router.push("/dashboard");
    }
  }, [authState, router]);

  useEffect(() => {
    if (errorParam === "oauth_failed") {
      toast.error("OAuth authentication failed. Please try again.");
    }
  }, [errorParam]);

  const onSubmit = async (data: UserFormData) => {
    const success = await signIn(data.email, data.password);
    if (success) {
      router.push(redirectTo);
    }
  };

  return (
    <div className='min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8'>
      <div className='max-w-md w-full space-y-8'>
        <div>
          <h2 className='mt-6 text-center text-3xl font-extrabold text-gray-900 dark:text-white font-family-heading'>
            Sign in to your account
          </h2>
          <p className='mt-2 text-center text-sm text-gray-600 dark:text-gray-400'>
            Or{" "}
            <Link
              href='/signup'
              className='font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300'
            >
              create a new account
            </Link>
          </p>
        </div>

        <div className='bg-white dark:bg-gray-800 py-8 px-6 shadow-lg rounded-lg'>
          <OAuthProviders variant='login' providers={["google"]} className='mb-6' />

          <form className='space-y-6' onSubmit={handleSubmit(onSubmit)}>
            <div>
              <label htmlFor='email' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
                Email address
              </label>
              <input
                id='email'
                type='email'
                autoComplete='email'
                {...register("email")}
                className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 dark:focus:border-blue-400 dark:bg-gray-700 dark:text-white'
                placeholder='Enter your email'
              />
              {errors.email && <p className='text-red-500 text-sm'>{errors.email.message}</p>}
            </div>

            <div>
              <label htmlFor='password' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
                Password
              </label>
              <input
                id='password'
                type='password'
                autoComplete='current-password'
                {...register("password")}
                className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 dark:focus:border-blue-400 dark:bg-gray-700 dark:text-white'
                placeholder='Enter your password'
              />
              {errors.password && <p className='text-red-500 text-sm'>{errors.password.message}</p>}
            </div>

            <div className='flex items-center justify-between'>
              <div className='text-sm'>
                <Link
                  href='/forgot-password'
                  className='font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300'
                >
                  Forgot your password?
                </Link>
              </div>
            </div>

            <div>
              <button
                type='submit'
                disabled={isSubmitting}
                className='group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-500 dark:hover:bg-blue-600 dark:focus:ring-blue-400'
              >
                {isSubmitting ? (
                  <div className='animate-spin rounded-full h-5 w-5 border-b-2 border-white'></div>
                ) : (
                  "Sign in"
                )}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

```

<!-- path: hnvtx/app/(auth)/layout.tsx -->
```typescript
// app/(auth)/layout.tsx
"use client";

import { motion } from "framer-motion";
import { useAuth } from "@/hooks/useAuth";
import { redirect } from "next/navigation";

export default function AuthLayout({ children }: { children: React.ReactNode }) {
  const { authState } = useAuth();

  if (authState === "authenticated") {
    redirect("/dashboard");
  }

  return (
    <div className='min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900'>
      <div className='flex min-h-screen'>
        {/* Left side - Branding */}
        <div className='relative hidden overflow-hidden lg:flex lg:flex-1'>
          <div className='absolute inset-0 bg-gradient-to-br from-blue-600 to-purple-700 opacity-90 dark:from-gray-800 dark:to-gray-900' />
          {/* <div className="absolute inset-0 bg-[url('/grid.svg')] opacity-5" /> */}
          <div className='relative z-10 flex flex-col justify-center px-12 text-white'>
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.6 }}>
              <h1 className='mb-6 text-4xl font-bold'>Welcome to HARINAVI TRANSMISSION MAINTENANCE DATABASE</h1>
              <p className='mb-8 text-xl opacity-90 dark:opacity-80'>Secure authentication with role-based access control</p>
              <div className='space-y-4'>
                <div className='flex items-center space-x-3'>
                  <div className='h-2 w-2 rounded-full bg-white dark:bg-blue-400' />
                  <span>Multi-role user management</span>
                </div>
                <div className='flex items-center space-x-3'>
                  <div className='h-2 w-2 rounded-full bg-white dark:bg-blue-400' />
                  <span>Secure email verification</span>
                </div>
                <div className='flex items-center space-x-3'>
                  <div className='h-2 w-2 rounded-full bg-white dark:bg-blue-400' />
                  <span>Protected routes & permissions</span>
                </div>
                <div className='flex items-center space-x-3'>
                  <div className='h-2 w-2 rounded-full bg-white dark:bg-blue-400' />
                  <span>Dark mode support</span>
                </div>
              </div>
            </motion.div>
          </div>
        </div>

        {/* Right side - Auth forms */}
        <div className='flex flex-1 flex-col justify-center px-6 py-12 lg:px-8'>
          <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ duration: 0.6, delay: 0.2 }} className='mx-auto w-full max-w-md'>
            {children}
          </motion.div>
        </div>
      </div>
    </div>
  );
}

```

<!-- path: hnvtx/app/(auth)/verify-email/page.tsx -->
```typescript
// app/(auth)/verify-email/page.tsx
import Link from 'next/link'

export default function VerifyEmailPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-md w-full space-y-8 text-center">
        <div>
          <div className="mx-auto h-12 w-12 text-green-600 dark:text-green-500">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 7.89a2 2 0 002.82 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
          </div>
          <h2 className="mt-6 text-3xl font-extrabold text-gray-900 dark:text-white">
            Check your email
          </h2>
          <p className="mt-2 text-sm text-gray-600 dark:text-gray-400">
            We&apos;ve sent a confirmation link to your email address. Please click the link to verify your account.
          </p>
        </div>

        <div className="mt-8 space-y-4">
          <p className="text-sm text-gray-500 dark:text-gray-400">
            Didn&apos;t receive the email? Check your spam folder or{' '}
            <Link href="/signup" className="font-medium text-indigo-600 hover:text-indigo-500 dark:text-indigo-400 dark:hover:text-indigo-300">
              try signing up again
            </Link>
          </p>

          <Link
            href="/login"
            className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-indigo-600 bg-indigo-100 hover:bg-indigo-200 dark:text-indigo-100 dark:bg-indigo-800 dark:hover:bg-indigo-700"
          >
            Back to Sign In
          </Link>
        </div>
      </div>
    </div>
  )
}
```

<!-- path: hnvtx/app/(auth)/reset-password/page.tsx -->
```typescript
// app/(auth)/reset-password/page.tsx
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { motion } from "framer-motion";
import { toast } from "sonner";
import { LoadingSpinner } from "@/components/common/ui/LoadingSpinner";
import { useAuth } from "@/hooks/useAuth";

export default function ResetPasswordPage() {
  const [password, setPassword] = useState("");
  const [confirmPassword, setConfirmPassword] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const router = useRouter();
  // const searchParams = useSearchParams()
  const { resetPassword } = useAuth();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (password !== confirmPassword) {
      toast.error("Passwords do not match");
      return;
    }

    if (password.length < 8) {
      toast.error("Password must be at least 8 characters long");
      return;
    }

    setIsLoading(true);
    try {
      const success = await resetPassword(password);

      if (success) {
        toast.success("Password updated successfully!");
        router.push("/login");
      } else {
        setIsLoading(false);
        toast.error("Something went wrong");
      }
    } catch (error) {
      toast.error("Something went wrong");
      setIsLoading(false);
    }
  };

  return (
    <div className='min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8'>
      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className='max-w-md w-full space-y-8'>
        <div>
          <h2 className='mt-6 text-center text-3xl font-extrabold text-gray-900 dark:text-white'>Set new password</h2>
        </div>

        <form className='mt-8 space-y-6' onSubmit={handleSubmit}>
          <div>
            <label htmlFor='password' className='sr-only'>
              New Password
            </label>
            <input
              id='password'
              name='password'
              type='password'
              required
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className='appearance-none rounded-t-md relative block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-white bg-white dark:bg-gray-800 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm'
              placeholder='New password'
            />
          </div>
          <div>
            <label htmlFor='confirmPassword' className='sr-only'>
              Confirm Password
            </label>
            <input
              id='confirmPassword'
              name='confirmPassword'
              type='password'
              required
              value={confirmPassword}
              onChange={(e) => setConfirmPassword(e.target.value)}
              className='appearance-none rounded-b-md relative block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-white bg-white dark:bg-gray-800 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm'
              placeholder='Confirm new password'
            />
          </div>

          <div>
            <button
              type='submit'
              disabled={isLoading}
              className='group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-blue-700 dark:hover:bg-blue-800'>
              {isLoading ? <LoadingSpinner size='sm' /> : "Update Password"}
            </button>
          </div>
        </form>
      </motion.div>
    </div>
  );
}

```

<!-- path: hnvtx/app/privacy/page.tsx -->
```typescript

// app/privacy/page.tsx
import Privacy from "@/components/auth/privacy";

const PrivacyPage = () => {
  return <Privacy />;
};

export default PrivacyPage;

```

<!-- path: hnvtx/app/api/evolve/[routeId]/route.ts -->
```typescript
// app/api/evolve/[routeId]/route.ts
import { NextResponse } from 'next/server';
import { RouteDetailsPayload, EvolutionCommitPayload } from '@/components/ofcadv/types';
import { isEvolutionCommitPayload } from '@/components/ofcadv/schemas';

// GET handler for fetching detailed data for a selected route
export async function GET(
  request: Request,
  { params }: { params: { routeId: string } }
) {
  const routeId = params.routeId;
  console.log(`== API [GET]: Fetching details for route: ${routeId} ==`);

  // Mocking a DB call to get full details
  const mockDetails: RouteDetailsPayload = {
    route: {
      id: routeId,
      name: `Route ${routeId.split('-')[1]}`,
      start_site: { id: 'site-a', name: 'NodeA' },
      end_site: { id: 'site-b', name: 'NodeB' },
      capacity: 48,
      distance_km: 25.5,
      evolution_status: routeId === 'route-1' ? 'simple' : 'with_jcs',
    },
    equipment: routeId === 'route-2' ? [
        {
            id: 'jc-existing-1',
            name: 'JC-Mid-01',
            equipment_type: 'junction_closure',
            latitude: 23.5254, longitude: 87.2926,
            status: 'existing',
            attributes: { jc_type: 'inline', capacity: 48, position_on_route: 40 }
        }
    ] : [],
  };

  return NextResponse.json(mockDetails);
}


// POST handler for committing the evolution
export async function POST(
  request: Request,
  { params }: { params: { routeId: string } }
) {
  const routeId = params.routeId;
  const payload: unknown = await request.json();

  if (!isEvolutionCommitPayload(payload)) {
    return NextResponse.json(
      { message: 'Invalid payload for route evolution commit' },
      { status: 400 }
    );
  }

  console.log(`== API [POST]: Committing evolution for route: ${routeId} ==`);
  console.log("Payload Received:", JSON.stringify(payload, null, 2));

  // --- In a real application, you would: ---
  // 1. Validate the incoming payload against a schema.
  // 2. Start a database transaction.
  // 3. await db.equipment.createMany({ data: payload.plannedEquipment });
  // 4. await db.cableSegments.createMany({ data: payload.plannedSegments });
  // 5. await db.fiberSplices.createMany({ data: payload.plannedSplices });
  // 6. await db.ofc_routes.update({ where: { id: routeId }, data: { evolution_status: 'fully_segmented' } });
  // 7. Log the event.
  // 8. If all successful, commit the transaction. If any step fails, rollback.

  // Simulating a successful commit
  return NextResponse.json({
    message: `Successfully evolved route ${routeId} with ${payload.plannedEquipment.length} new closures.`,
  });
}
```

<!-- path: hnvtx/app/api/v1/routes/[id]/evolve/route.ts -->
```typescript
// app/api/v1/routes/[id]/evolve/route.ts
import { NextResponse } from 'next/server';
import { isEvolutionCommitPayload } from '@/components/ofcadv/schemas';

export async function POST(
  request: Request,
  { params }: { params: { id: string } }
) {
  const routeId = params.id;
  const payload: unknown = await request.json();

  if (!isEvolutionCommitPayload(payload)) {
    return NextResponse.json(
      { message: 'Invalid payload for route evolution commit' },
      { status: 400 }
    );
  }

  console.log(`== API[v1] [POST]: Evolve route: ${routeId} ==`);
  console.log('Payload Received:', JSON.stringify(payload, null, 2));

  // Simulate success
  return NextResponse.json({
    message: `Successfully evolved route ${routeId} with ${payload.plannedEquipment.length} new closures.`,
  });
}

```

<!-- path: hnvtx/app/api/v1/routes/[id]/evolution/route.ts -->
```typescript
// app/api/v1/routes/[id]/evolution/route.ts
import { NextResponse } from 'next/server';
import { RouteDetailsPayload } from '@/components/ofcadv/types';

export async function GET(
  request: Request,
  { params }: { params: { id: string } }
) {
  const routeId = params.id;
  console.log(`== API[v1] [GET]: Evolution details for route: ${routeId} ==`);

  // Reuse the same mock as the non-versioned endpoint
  const mockDetails: RouteDetailsPayload = {
    route: {
      id: routeId,
      name: `Route ${routeId.split('-')[1]}`,
      start_site: { id: 'site-a', name: 'NodeA' },
      end_site: { id: 'site-b', name: 'NodeB' },
      capacity: 48,
      distance_km: 25.5,
      evolution_status: routeId === 'route-1' ? 'simple' : 'with_jcs',
    },
    equipment: routeId === 'route-2' ? [
      {
        id: 'jc-existing-1',
        name: 'JC-Mid-01',
        equipment_type: 'junction_closure',
        latitude: 23.5254, longitude: 87.2926,
        status: 'existing',
        attributes: { jc_type: 'inline', capacity: 48, position_on_route: 40 }
      }
    ] : [],
  };

  return NextResponse.json(mockDetails);
}

```

<!-- path: hnvtx/app/api/admin/users/route.ts -->
```typescript


// // app/api/admin/users/route.ts
// import { createAdmin } from "@/utils/supabase/admin";
// import { NextResponse } from "next/server";

// export async function POST(request: Request) {
//   try {
//     const userData = await request.json();
//     const supabase = createAdmin();

//     // Create the user in auth
//     const { data, error } = await supabase.auth.admin.createUser({
//       id: userData.id,
//       email: userData.email,
//       password: userData.password,
//       email_confirm: userData.email_confirm ?? true,
//     });

//     if (error) {
//       console.error("Error creating user:", error);
//       return NextResponse.json(
//         { error: error.message },
//         { status: error.status || 500 }
//       );
//     }

//     // Insert/Update user profile in public table
//     if (data.user) {
//       await supabase.from("user_profiles").upsert({
//         id: data.user.id,
//         email: data.user.email,
//         role: userData.role || "viewer",
//         created_at: new Date().toISOString(),
//         updated_at: new Date().toISOString(),
//       });
//     }

//     return NextResponse.json(data);
//   } catch (error: any) {
//     console.error("Error in user creation API:", error);
//     return NextResponse.json(
//       { error: error.message || "Internal server error" },
//       { status: 500 }
//     );
//   }
// }

// +++++++++++++= For forced UUID insertion, Supabase many functions like reset password etc not work with this method
// +++++++++++++= So we are using raw SQL to insert user
// +++++++++++++= This is a temporary solution
// +++++++++++++= 
// app/api/admin/users/route.ts
import { NextResponse } from "next/server";
import { Pool } from "pg";
import bcrypt from "bcrypt";

const pgHost = process.env.PGHOST;
const pgUser = process.env.PGUSER;
const pgPassword = process.env.PGPASSWORD;
const pgDatabase = process.env.PGDATABASE;
const pgPort = process.env.PGPORT;

const pool = new Pool({
  connectionString: `postgresql://${pgUser}:${pgPassword}@${pgHost}:${pgPort}/${pgDatabase}`,
});

export async function POST(req: Request) {
  try {
    const userData = await req.json();
    const hashed = await bcrypt.hash(userData.password, 10);

    const client = await pool.connect();
    try {
      await client.query("BEGIN");

      // 1️⃣ Insert into auth.users
      const { rows } = await client.query(
        `
        INSERT INTO auth.users (id, instance_id, email, encrypted_password, email_confirmed_at, raw_user_meta_data)
        VALUES ($1, '00000000-0000-0000-0000-000000000000', $2, $3, $4, $5)
        RETURNING id, email
        `,
        [
          userData.id,
          userData.email,
          hashed,
          userData.email_confirm ? new Date().toISOString() : null,
          JSON.stringify({
            first_name: userData.first_name,
            last_name: userData.last_name,
            role: userData.role,
            status: userData.status,
          }),
        ]
      );
      console.log("USER PAYLOAD:", {
        id: userData.id,
        email: userData.email,
        password: userData.password,
        email_confirm: userData.email_confirm,
        first_name: userData.first_name,
        last_name: userData.last_name,
        role: userData.role,
        status: userData.status,
      });

      // const userId = rows[0].id;

      // // 2️⃣ Insert into public.user_profiles
      // await client.query(
      //   `
      //   INSERT INTO public.user_profiles (
      //     id, first_name, last_name, role, status, created_at, updated_at
      //   )
      //   VALUES ($1, $2, $3, $4, $5, NOW(), NOW())
      //   `,
      //   [
      //     userId,
      //     (userData.first_name || "N/A").trim(),
      //     (userData.last_name || "N/A").trim(), // ✅ no empty string
      //     userData.role || "viewer",
      //     userData.status || "inactive",
      //   ]
      // );
      // console.log("PROFILE PAYLOAD:", {
      //   first: userData.first_name,
      //   last: userData.last_name,
      //   role: userData.role,
      //   status: userData.status,
      // });
      await client.query("COMMIT");

      return NextResponse.json({ user: rows[0] });
    } catch (err) {
      await client.query("ROLLBACK");
      throw err;
    } finally {
      client.release();
    }
  } catch (err: any) {
    console.error("Error inserting user:", err);
    return NextResponse.json({ error: err.message }, { status: 500 });
  }
}


```

<!-- path: hnvtx/app/manifest.ts -->
```typescript
import type { MetadataRoute } from "next";
 
export default function manifest(): MetadataRoute.Manifest {
  return {
    name: "Harinavi Transmission Maintenance",
    short_name: "Harinavi Database App",
    description:
      "Complete records management system for Harinavi Transmission maintenance",
    start_url: "/",
    display: "standalone",
    background_color: "#ffffff",
    theme_color: "#000000",
    orientation: "portrait-primary",
    icons: [
      {
        src: "/icon-192x192.png",
        sizes: "192x192",
        type: "image/png",
        purpose: "maskable",
      },
      {
        src: "/icon-256x256.png",
        sizes: "256x256",
        type: "image/png",
      },
      {
        src: "/icon-384x384.png",
        sizes: "384x384",
        type: "image/png",
      },
      {
        src: "/icon-512x512.png",
        sizes: "512x512",
        type: "image/png",
        purpose: "maskable",
      },
    ],
    categories: ["productivity", "business"],
    screenshots: [
      {
        src: "/screenshot-wide.png",
        sizes: "1280x720",
        type: "image/png",
        form_factor: "wide",
      },
      {
        src: "/screenshot-narrow.png",
        sizes: "750x1334",
        type: "image/png",
        form_factor: "narrow",
      },
    ],
  };
}
```

<!-- path: hnvtx/app/auth/callback/route.ts -->
```typescript
// app/auth/callback/route.ts
import { createClient } from '@/utils/supabase/server'
import { NextResponse } from 'next/server'

export async function GET(request: Request) {
  const { searchParams, origin } = new URL(request.url)
  const code = searchParams.get('code')
  const next = searchParams.get('next') ?? '/dashboard'
  const error = searchParams.get('error')
  const errorDescription = searchParams.get('error_description')

  // console.log('Auth callback received:', { code: !!code, error, errorDescription })

  // Handle OAuth errors
  if (error) {
    console.error('OAuth error:', error, errorDescription)
    const errorParams = new URLSearchParams({
      error: error,
      message: errorDescription || 'Authentication failed'
    })
    return NextResponse.redirect(`${origin}/auth/error?${errorParams}`)
  }

  if (code) {
    const supabase = await createClient()
    
    try {
      // console.log('Exchanging code for session...')
      const { data, error: exchangeError } = await supabase.auth.exchangeCodeForSession(code)
      
      if (exchangeError) {
        console.error('Session exchange error:', exchangeError)
        const errorParams = new URLSearchParams({
          error: 'session_exchange_failed',
          message: exchangeError.message
        })
        return NextResponse.redirect(`${origin}/auth/error?${errorParams}`)
      }

      if (data.user) {
        // console.log('User authenticated:', data.user.id)
        
        // Check if user has a profile
        // console.log('Checking for existing profile...')
        const { data: profile, error: profileError } = await supabase
          .from('user_profiles')
          .select('id')
          .eq('id', data.user.id)
          .single()

        // console.log('Profile check result:', { profile: !!profile, error: profileError?.code })

        // If no profile exists, redirect to onboarding
        // check non blocking way after 2 seconds
        setTimeout(() => {
          if (profileError && profileError.code === 'PGRST116') {
            // console.log('No profile found, redirecting to onboarding')
            return NextResponse.redirect(`${origin}/onboarding`)
          }
        }, 2000)
        

        if (profileError && profileError.code !== 'PGRST116') {
          console.error('Profile check error:', profileError)
          // Continue anyway, let the client handle it
        }

        // If profile exists, redirect to intended destination
        if (profile) {
          // console.log('Profile exists, redirecting to:', next)
          return NextResponse.redirect(`${origin}${next}`)
        }

        // Fallback: redirect to dashboard if no profile check conclusive
        // console.log('Fallback redirect to dashboard')
        return NextResponse.redirect(`${origin}/dashboard`)
      }
      
    } catch (error) {
      console.error('Unexpected error in auth callback:', error)
      const errorParams = new URLSearchParams({
        error: 'unexpected_error',
        message: 'An unexpected error occurred during authentication'
      })
      return NextResponse.redirect(`${origin}/auth/error?${errorParams}`)
    }
  }

  // No code parameter - invalid callback
  console.error('No code parameter received')
  const errorParams = new URLSearchParams({
    error: 'invalid_callback',
    message: 'Invalid authentication callback'
  })
  return NextResponse.redirect(`${origin}/auth/error?${errorParams}`)
}
```

<!-- path: hnvtx/app/terms/page.tsx -->
```typescript
// app/terms/page.tsx
import Terms from '@/components/auth/terms';

const TermsPage = () => {
 return (
 <Terms />
 );
};

export default TermsPage;
```

<!-- path: hnvtx/app/page.tsx -->
```typescript
"use client";

import OfflineStatus from "@/components/pwa/offline-status";
import PWAInstallPrompt from "@/components/pwa/pwa-install-prompt";

import { useScroll, useTransform } from "framer-motion";
import { useEffect, useState } from "react";

import AnimatedBackground from "@/components/home/AnimatedBackground";
import HeroContent from "@/components/home/HeroContent";
import ParticlesOverlay from "@/components/home/ParticlesOverlay";
import ScrollIndicator from "@/components/home/ScrollIndicator";
import StatsHighlights from "@/components/home/StatsHighlights";
import { containerVariants, ctaVariants, floatingAnimation, highlightVariants, subtitleVariants, titleVariants } from "@/components/home/variants";
import OutdatedBrowserModal from "@/components/outdated/OutdatedBrowserModal";
import { useOutdatedBrowserCheck } from "@/hooks/useOutdatedBrowserCheck";

export default function Home() {
  const [showModal, setShowModal] = useState(false);
  const isOutdated = useOutdatedBrowserCheck();

  const { scrollY } = useScroll();
  const textY = useTransform(scrollY, [0, 500], [0, -50]);

  // Check if browser modal should be shown
  useEffect(() => {
    if (isOutdated && typeof window !== "undefined") {
      const dismissed = localStorage.getItem("legacyBrowserDismissed");
      if (!dismissed) {
        setShowModal(true);
      }
    }
  }, [isOutdated]);

  const handleCloseModal = () => {
    setShowModal(false);
    if (typeof window !== "undefined") {
      localStorage.setItem("legacyBrowserDismissed", "true");
    }
  };

  if (isOutdated === null) return null;

  return (
    <>
      <div className='relative min-h-screen w-full overflow-hidden'>
        <AnimatedBackground />
        <ParticlesOverlay />

        {showModal && <OutdatedBrowserModal handleCloseModal={handleCloseModal} />}

        <div className='overflow-hidden relative z-10 flex min-h-screen flex-col items-center justify-center bg-gradient-to-b from-black/60 via-black/40 to-black/60'>
          <HeroContent
            variants={{
              containerVariants,
              titleVariants,
              subtitleVariants,
              highlightVariants,
              ctaVariants,
            }}
            floatingAnimation={floatingAnimation}
            textY={textY}
          />
          <StatsHighlights />
        </div>

        <ScrollIndicator />
      </div>
      <PWAInstallPrompt />
      <OfflineStatus />
    </>
  );
}

```

<!-- path: hnvtx/app/dashboard/rings/page.tsx -->
```typescript
// app/dashboard/rings/page.tsx
"use client";

import React, { useMemo } from "react";
import { DataTable } from "@/components/table/DataTable";
import { Row, usePagedRingsWithCount } from "@/hooks/database";
import { RingsFilters } from "@/components/rings/RingsFilters";
import { RingModal } from "@/components/rings/RingModal";
import { ConfirmModal } from "@/components/common/ui";
import { createStandardActions } from "@/components/table/action-helpers";
import {
  PageHeader,
  useStandardHeaderActions,
} from "@/components/common/PageHeader";
import { GiLinkedRings } from "react-icons/gi";
import { toast } from "sonner";
import { RingsColumns } from "@/config/table-columns/RingsTableColumns";
import { createClient } from "@/utils/supabase/client";
import { desiredRingColumnOrder } from "@/config/column-orders";
import {
  DataQueryHookParams,
  DataQueryHookReturn,
  useCrudManager,
} from "@/hooks/useCrudManager";
import { RingRowsWithRelations } from "@/types/relational-row-types";
import { RingTypeRowsWithCount } from "@/types/view-row-types";

// 1. ADAPTER HOOK: Makes `useRingsData` compatible with `useCrudManager`
const useRingsData = (
  params: DataQueryHookParams
): DataQueryHookReturn<RingTypeRowsWithCount> => {
  const { currentPage, pageLimit, filters, searchQuery } = params;
  const supabase = createClient();

  const { data, isLoading, error, refetch } = usePagedRingsWithCount(
    supabase,
    {
      filters: {
        ...filters,
        ...(searchQuery ? { name: searchQuery } : {}),
      },
      limit: pageLimit,
      offset: (currentPage - 1) * pageLimit,
      // queryOptions: {
      //   enabled: true,
      //   refetchOnWindowFocus: false,
      //   refetchOnMount: true,
      //   refetchInterval: 0,
      //   refetchIntervalInBackground: false,
      //   staleTime: 3 * 60 * 1000,
      // }
    }
  );

  // Calculate counts from the full dataset
  const totalCount = data?.[0]?.total_count || 0;
  const activeCount = data?.[0]?.active_count || 0;
  const inactiveCount = data?.[0]?.inactive_count || 0;

  return {
    data: data || [],
    totalCount,
    activeCount,
    inactiveCount,
    isLoading,
    error,
    refetch,
  };
};

const RingsPage = () => {
  // 2. USE THE CRUD MANAGER with the adapter hook and both generic types
  const {
    data: rings,
    totalCount,
    activeCount,
    inactiveCount,
    isLoading,
    // isMutating,
    // error,
    refetch,
    pagination,
    search,
    // filters,
    editModal,
    viewModal,
    // bulkActions,
    deleteModal,
    actions: crudActions,
  } = useCrudManager<"rings", RingTypeRowsWithCount>({
    tableName: "rings",
    dataQueryHook: useRingsData,
  });

  // 3. Extract ring types from the rings data
  const ringTypes = useMemo(() => {
    const uniqueRingTypes = new Map();
    console.log("rings", rings);
    rings.forEach((ring) => {
      if (ring.ring_type_code) {
        uniqueRingTypes.set(ring.ring_type_id, {
          id: ring.ring_type_id,
          name: ring.ring_type_code,
        });
      }
    });
    return Array.from(uniqueRingTypes.values());
  }, [rings]);

  // 4. Extract maintenance areas from the rings data
  const maintenanceAreas = useMemo(() => {
    const uniqueMaintenanceAreas = new Map();
    rings.forEach((ring) => {
      if (ring.maintenance_area_area_type_id && ring.maintenance_terminal_id) {
        uniqueMaintenanceAreas.set(ring.maintenance_terminal_id, {
          id: ring.maintenance_terminal_id,
          name: ring.maintenance_area_name,
        });
      }
    });
    return Array.from(uniqueMaintenanceAreas.values());
  }, [rings]);

  const columns = RingsColumns(rings);
  // Type guard to remove undefined from the mapped array
  const notUndefined = <T,>(x: T | undefined): x is T => x !== undefined;
  const orderedColumns = [
    ...desiredRingColumnOrder
      .map((k) => columns.find((c) => c.key === k))
      .filter(notUndefined),
    ...columns.filter((c) => !desiredRingColumnOrder.includes(c.key)),
  ];

  // --- tableActions ---
  const tableActions = useMemo(
    () =>
      createStandardActions<RingTypeRowsWithCount>({
        onEdit: editModal.openEdit,
        onView: viewModal.open,
        onDelete: crudActions.handleDelete,
        // You can also add custom logic, for example:
        // canDelete: (record) => record.name !== 'CRITICAL_RING',
      }),
    [
      editModal.openEdit,
      viewModal.open,
      crudActions.handleDelete,
    ]
  );

  

  // --- Define header content using the hook ---
  const headerActions = useStandardHeaderActions({
    data: rings as Row<"rings">[],
    onRefresh: async () => {
      await refetch();
      toast.success("Refreshed successfully!");
    },
    onAddNew: editModal.openAdd,
    isLoading: isLoading,
    exportConfig: { tableName: "rings" },
  });

  const headerStats = [
    { value: totalCount, label: "Total Rings" },
    {
      value: activeCount,
      label: "Active",
      color: "success" as const,
    },
    {
      value: inactiveCount,
      label: "Inactive",
      color: "danger" as const,
    },
  ];

  return (
    <div className="mx-auto space-y-4">
      {/* Header */}
      <PageHeader
        title="Ring Management"
        description="Manage network rings and their related information."
        icon={<GiLinkedRings />}
        stats={headerStats}
        actions={headerActions} // <-- Pass the generated actions
        isLoading={isLoading}
      />

      {/* Table */}
      <DataTable
        tableName="v_rings_with_count"
        data={rings}
        columns={orderedColumns}
        loading={isLoading}
        actions={tableActions}
        pagination={{
          current: pagination.currentPage,
          pageSize: pagination.pageLimit,
          total: totalCount,
          showSizeChanger: true,
          onChange: (page, pageSize) => {
            pagination.setCurrentPage(page);
            pagination.setPageLimit(pageSize);
          },
        }}
        customToolbar={
          <RingsFilters
            searchQuery={search.searchQuery}
            onSearchChange={search.setSearchQuery}
          />
        }
      />

      <RingModal
        isOpen={editModal.isOpen}
        onClose={editModal.close}
        editingRing={editModal.record as RingRowsWithRelations | null}
        onCreated={crudActions.handleSave}
        onUpdated={crudActions.handleSave}
        ringTypes={ringTypes}
        maintenanceAreas={maintenanceAreas}
      />

      {/* Render the confirmation modal, driven by the hook's state */}
      <ConfirmModal
        isOpen={deleteModal.isOpen}
        onConfirm={deleteModal.onConfirm}
        onCancel={deleteModal.onCancel}
        title="Confirm Deletion"
        message={deleteModal.message}
        confirmText="Delete"
        cancelText="Cancel"
        type="danger"
        showIcon
        loading={deleteModal.loading}
      />
    </div>
  );
};

export default RingsPage;

```

<!-- path: hnvtx/app/dashboard/users/page.tsx -->
```typescript
"use client";

import React, { useState, useMemo, useCallback } from "react";
import { FiUsers } from "react-icons/fi";
import { useAdminGetAllUsersExtended, useIsSuperAdmin, useAdminUserOperations } from "@/hooks/useAdminUsers";
import { DataTable } from "@/components/table/DataTable";
import { Row } from "@/hooks/database";
import { ConfirmModal, ErrorDisplay } from "@/components/common/ui";
import { UserFilters } from "@/components/users/UserFilters";
import { BulkActions } from "@/components/users/BulkActions";
import { DataQueryHookParams, DataQueryHookReturn, useCrudManager } from "@/hooks/useCrudManager";
import { PageHeader, useStandardHeaderActions } from "@/components/common/PageHeader";
import { toast } from "sonner";
import { createStandardActions } from "@/components/table/action-helpers";
import UserProfileEditModal from "@/components/users/UserProfileEditModal";
import { UserProfileFormData } from "@/schemas";
import { UserProfileData } from "@/components/users/user-types";
import { UserProfileColumns } from "@/config/table-columns/UsersTableColumns";
import { UserDetailsModal } from "@/config/user-details-config";
import { UserCreateModal } from "@/components/users/UserCreateModal";

// This hook adapts the specific RPC hook to the generic interface required by useCrudManager.
// 1. ADAPTER HOOK: Makes `useAdminGetAllUsersExtended` compatible with `useCrudManager`
const useUsersData = (params: DataQueryHookParams): DataQueryHookReturn<UserProfileData> => {
  const { currentPage, pageLimit, searchQuery, filters } = params;

  const { data, isLoading, error, refetch } = useAdminGetAllUsersExtended({
    search_query: searchQuery || undefined,
    filter_role: (filters.role as string) || undefined,
    filter_status: (filters.status as string) || undefined,
    page_offset: (currentPage - 1) * pageLimit,
    page_limit: pageLimit,
  });

  return {
    data: data || [], // `data` is now correctly typed as UserProfileData[]
    totalCount: data?.length || 0,
    activeCount: (data || []).filter((u) => !!u.status).length,
    inactiveCount: (data || []).filter((u) => !u.status).length,
    isLoading,
    error: (error as Error) || null,
    refetch: () => {
      void refetch();
    },
  };
};
const AdminUsersPage = () => {
  // --- STATE MANAGEMENT (Mimicking useCrudManager) ---
  const [showFilters, setShowFilters] = useState(false);
  const { data: isSuperAdmin } = useIsSuperAdmin();
  const { createUser, deleteUsers: bulkDelete, updateUserRoles: bulkUpdateRole, updateUserStatus: bulkUpdateStatus, isLoading: isOperationLoading } = useAdminUserOperations();

  // 2. USE THE CRUD MANAGER with the adapter hook and both generic types
  const {
    data: users,
    totalCount,
    isLoading,
    isMutating,
    error,
    refetch,
    pagination,
    search,
    filters,
    editModal,
    viewModal,
    bulkActions,
    deleteModal,
    actions: crudActions,
  } = useCrudManager<"user_profiles", UserProfileData>({
    tableName: "user_profiles",
    dataQueryHook: useUsersData,
    
  });

  const columns = UserProfileColumns(users);
  const { selectedRowIds, handleClearSelection } = bulkActions;

  const tableActions = useMemo(
    () =>
      createStandardActions<UserProfileData>({
        onEdit: editModal.openEdit,
        onView: viewModal.open,
        onDelete: crudActions.handleDelete,
        canDelete: (record) => !record.is_super_admin,
      }),
    [editModal.openEdit, viewModal.open, crudActions.handleDelete]
  );

  const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);

  const handleCreateUser = async (userData: any) => {
    await createUser.mutateAsync({
      ...userData,
      status: 'active' // Default status for new users
    });
  };

  const handleBulkDelete = useCallback(async () => {
    if (selectedRowIds.length === 0) return;
    if (!window.confirm(`Are you sure you want to delete ${selectedRowIds.length} selected user(s)?`)) return;

    await bulkDelete.mutateAsync({ user_ids: selectedRowIds });
    handleClearSelection();
  }, [selectedRowIds, bulkDelete, handleClearSelection]);

  const handleBulkUpdateRole = useCallback(
    async (newRole: string) => {
      if (selectedRowIds.length === 0) return;
      await bulkUpdateRole.mutateAsync({
        user_ids: selectedRowIds,
        new_role: newRole,
      });
      handleClearSelection();
    },
    [selectedRowIds, bulkUpdateRole, handleClearSelection]
  );

  const handleBulkUpdateStatus = useCallback(
    async (newStatus: string) => {
      if (selectedRowIds.length === 0) return;
      await bulkUpdateStatus.mutateAsync({
        user_ids: selectedRowIds,
        new_status: newStatus,
      });
      handleClearSelection();
    },
    [selectedRowIds, bulkUpdateStatus, handleClearSelection]
  );

  // --- Define header content using the hook ---
  const headerActions = useStandardHeaderActions<"user_profiles">({
    data: users as Row<"user_profiles">[],
    onRefresh: async () => {
      await refetch();
      toast.success("Refreshed successfully!");
    },
    onAddNew: () => setIsCreateModalOpen(true),
    isLoading: isLoading,
    exportConfig: { tableName: "user_profiles" },
  });

  const headerStats = [
    { value: totalCount, label: "Total Users" },
    {
      value: users.filter((r) => r.status).length,
      label: "Active",
      color: "success" as const,
    },
    {
      value: users.filter((r) => !r.status).length,
      label: "Inactive",
      color: "danger" as const,
    },
  ];

  if (error) {
    return (
      <ErrorDisplay
        error={error.message}
        actions={[
          {
            label: "Retry",
            onClick: refetch,
            variant: "primary",
          },
        ]}
      />
    );
  }

  return (
    <div className='p-3 sm:p-4 md:p-6 lg:p-8 space-y-4 sm:space-y-6'>
      <PageHeader
        title='User Management'
        description='Manage network users and their related information.'
        icon={<FiUsers />}
        stats={headerStats}
        actions={headerActions} // <-- Pass the generated actions
        isLoading={isLoading}
      />
      <BulkActions
        selectedCount={bulkActions.selectedCount}
        isSuperAdmin={!!isSuperAdmin}
        isOperationLoading={isMutating}
        onBulkDelete={handleBulkDelete}
        onBulkUpdateRole={handleBulkUpdateRole}
        onBulkUpdateStatus={handleBulkUpdateStatus}
        onClearSelection={bulkActions.handleClearSelection}
      />
      <DataTable
        tableName='v_user_profiles_extended'
        data={users as unknown as Row<"v_user_profiles_extended">[]}
        columns={columns}
        loading={isLoading || isOperationLoading}
        actions={tableActions}
        selectable
        onRowSelect={(rows) => {
          // Filter out any rows where id is null
          const validRows = rows.filter((row): row is UserProfileData & { id: string } => row.id !== null);
          bulkActions.handleRowSelect(validRows);
        }}
        searchable={false}
        filterable={false}
        pagination={{
          current: pagination.currentPage,
          pageSize: pagination.pageLimit,
          total: totalCount,
          showSizeChanger: true,
          onChange: (page, pageSize) => {
            pagination.setCurrentPage(page);
            pagination.setPageLimit(pageSize);
          },
        }}
        customToolbar={
          <UserFilters
            searchQuery={search.searchQuery}
            onSearchChange={search.setSearchQuery}
            roleFilter={(filters.filters.role as string) || ""}
            onRoleFilterChange={(value) => filters.setFilters((prev) => ({ ...prev, role: value }))}
            statusFilter={(filters.filters.status as string) || ""}
            onStatusFilterChange={(value) => filters.setFilters((prev) => ({ ...prev, status: value }))}
            emailVerificationFilter={""} // This filter is not implemented in the hook yet
            onEmailVerificationFilterChange={() => {}}
            showFilters={showFilters}
            onToggleFilters={() => setShowFilters(!showFilters)}
            onClearFilters={() => {
              search.setSearchQuery("");
              filters.setFilters((prev) => ({ ...prev, role: "", status: "" }));
            }}
          />
        }
      />
      <UserProfileEditModal
        isOpen={editModal.isOpen}
        user={editModal.record as UserProfileFormData}
        onClose={editModal.close}
        onSave={() => {
          refetch();
        }}
      />

      <UserDetailsModal 
        isOpen={viewModal.isOpen} 
        user={viewModal.record} 
        onClose={viewModal.close} 
      />
      <ConfirmModal 
        isOpen={deleteModal.isOpen} 
        onConfirm={deleteModal.onConfirm} 
        onCancel={deleteModal.onCancel} 
        title='Confirm Deletion' 
        message={deleteModal.message} 
        loading={deleteModal.loading} 
        type='danger' 
      />
      
      <UserCreateModal
        isOpen={isCreateModalOpen}
        onClose={() => setIsCreateModalOpen(false)}
        onCreate={handleCreateUser}
        isLoading={createUser.isPending}
      />
    </div>
  );
};

export default AdminUsersPage;

```

<!-- path: hnvtx/app/dashboard/lookup/page.tsx -->
```typescript
"use client";

import { Card } from "@/components/common/ui/Card";
import { LookupModal } from "@/components/lookup/LookupModal";
import { useLookupTypes } from "@/components/lookup/lookup-hooks";
import { LookupTypesFilters } from "@/components/lookup/LookupTypesFilters";
import { LookupTypesTable } from "@/components/lookup/LookupTypesTable";
import { useSorting } from "@/hooks/useSorting";
import {
  NoCategoriesState,
  SelectCategoryPrompt,
  LoadingState,
  ErrorState,
} from "@/components/lookup/LookupTypesEmptyStates";
import { useMemo } from "react";
import { FiList } from "react-icons/fi";
import { PageHeader, useStandardHeaderActions } from "@/components/common/PageHeader";
import { toast } from "sonner";
import { Filters } from "@/hooks/database";
import { ErrorDisplay } from "@/components/common/ui";

export default function LookupTypesPage() {
  const {
    state: {
      selectedCategory,
      isLookupModalOpen,
      searchTerm,
      editingLookup,
      categories,
      lookupTypes,
      isLoading,
      hasCategories,
      hasSelectedCategory,
      categoriesError,
      lookupError,
    },
    handlers: {
      setSearchTerm,
      handleCategoryChange,
      handleRefresh,
      handleAddNew,
      handleEdit,
      handleDelete,
      handleToggleStatus,
      handleModalClose,
      handleLookupCreated,
      handleLookupUpdated,
    },
  } = useLookupTypes();

  // Apply sorting to lookup types
  const {
    sortedData: sortedLookupTypes,
    handleSort,
    getSortDirection,
  } = useSorting({
    data: lookupTypes,
    defaultSortKey: "name",
    defaultDirection: "asc",
    options: {
      caseSensitive: false,
      numericSort: true,
    },
  });

  // Filter sorted data based on search term
  const filteredAndSortedLookupTypes = useMemo(() => {
    if (!searchTerm.trim()) return sortedLookupTypes;

    const lowerSearchTerm = searchTerm.toLowerCase();
    return sortedLookupTypes.filter(
      (lookup) =>
        lookup.name?.toLowerCase().includes(lowerSearchTerm) ||
        lookup.code?.toLowerCase().includes(lowerSearchTerm) ||
        lookup.description?.toLowerCase().includes(lowerSearchTerm)
    );
  }, [sortedLookupTypes, searchTerm]);

    // --- Define header content using the hook ---
      const serverFilters = useMemo(() => {
        const f: Filters = {
          // Filter to download only categories with name not equal to "DEFAULT"
          name: {
            operator: "neq",
            value: "DEFAULT",
          },
        };
        return f;
      }, []);
    const headerActions = useStandardHeaderActions({
      data: lookupTypes,
      onRefresh: async () => {
        await handleRefresh();
        toast.success("Refreshed successfully!");
      },
      onAddNew: handleAddNew,
      isLoading: isLoading,
      exportConfig: { tableName: "lookup_types", filters: serverFilters },
    });

    // --- Define header stats ---
    const activeLookups = lookupTypes.filter((lookup) => lookup.status);
    const inactiveLookups = lookupTypes.filter((lookup) => !lookup.status);
    const headerStats = [
      { value: lookupTypes.length, label: "Total Lookup Types" },
      { value: activeLookups.length, label: "Active", color: "success" as const },
      { value: inactiveLookups.length, label: "Inactive", color: "danger" as const },
    ];

    // Error handling
    if (lookupError) {
      return (
        <ErrorDisplay
          error={lookupError.message}
          actions={[
            {
              label: "Retry",
              onClick: handleRefresh,
              variant: "primary",
            },
          ]}
        />
      );
    }

  return (
    <div className="space-y-6 p-6">
      <PageHeader
        title="Lookup Types"
        description="Manage lookup types"
        icon={<FiList />}
        stats={headerStats}
        actions={headerActions}
        isLoading={isLoading}
      />

      {!hasCategories && !isLoading && (
        <NoCategoriesState
          error={categoriesError as Error}
          isLoading={isLoading}
        />
      )}

      {hasCategories && (
        <LookupTypesFilters
          categories={categories}
          selectedCategory={selectedCategory}
          onCategoryChange={handleCategoryChange}
          searchTerm={searchTerm}
          onSearchTermChange={setSearchTerm}
          hasSelectedCategory={hasSelectedCategory}
        />
      )}

      {lookupError && hasSelectedCategory && (
        <ErrorState error={lookupError} onRetry={handleRefresh} />
      )}

      {isLoading && hasSelectedCategory && (
        <LoadingState selectedCategory={selectedCategory} />
      )}

      {hasSelectedCategory && !isLoading && !lookupError && (
        <Card className="overflow-hidden">
          <div className="border-b bg-gray-50 dark:bg-gray-800 dark:border-gray-700 p-4">
            <p className="text-sm text-gray-600 dark:text-gray-400">
              Showing {filteredAndSortedLookupTypes.length} of{" "}
              {lookupTypes.length} lookup types for category:{" "}
              <strong className="text-gray-900 dark:text-gray-100">{`"${selectedCategory}"`}</strong>
              {searchTerm && (
                <span className="ml-2">
                  (filtered by: <em>&quot;{searchTerm}&quot;</em>)
                </span>
              )}
            </p>
          </div>

          <LookupTypesTable
            lookups={filteredAndSortedLookupTypes.map((lookup) => ({
              ...lookup,
              sort_order: lookup.sort_order ?? 0,
              created_at: lookup.created_at
                ? new Date(lookup.created_at)
                : undefined,
              updated_at: lookup.updated_at
                ? new Date(lookup.updated_at)
                : undefined,
              is_system_default: lookup.is_system_default ?? false,
              status: lookup.status ?? true,
            }))}
            onEdit={handleEdit}
            onDelete={handleDelete}
            onToggleStatus={handleToggleStatus}
            selectedCategory={selectedCategory}
            searchTerm={searchTerm}
            onSort={handleSort}
            getSortDirection={getSortDirection}
          />
        </Card>
      )}

      {!hasSelectedCategory && !isLoading && hasCategories && (
        <SelectCategoryPrompt />
      )}

      <LookupModal
        isOpen={isLookupModalOpen}
        onClose={handleModalClose}
        onLookupCreated={handleLookupCreated}
        onLookupUpdated={handleLookupUpdated}
        editingLookup={editingLookup}
        category={selectedCategory}
        categories={categories}
      />
    </div>
  );
}

```

<!-- path: hnvtx/app/dashboard/vmux/page.tsx -->
```typescript
import React from 'react'

const page = () => {
  return (
    <div>VMUX page</div>
  )
}

export default page
```

<!-- path: hnvtx/app/dashboard/categories/page.tsx -->
```typescript
"use client";

import { useCallback, useEffect, useMemo, useState } from "react";
import { toast } from "sonner";
import { createClient } from "@/utils/supabase/client";
import { Filters, useDeduplicated, useTableQuery } from "@/hooks/database";
import { useDeleteManager } from "@/hooks/useDeleteManager";
import { CategoriesTable } from "@/components/categories/CategoriesTable";
import { CategorySearch } from "@/components/categories/CategorySearch";
import { CategoryModal } from "@/components/categories/CategoryModal";
import { ConfirmModal } from "@/components/common/ui/Modal";
import { EmptyState } from "@/components/categories/EmptyState";
import { LoadingState } from "@/components/categories/LoadingState";
import { Categories, CategoryInfo, GroupedLookupsByCategory } from "@/components/categories/categories-types";
import { PageHeader, useStandardHeaderActions } from "@/components/common/PageHeader";
import { FiLayers, FiPlus, FiRefreshCw } from "react-icons/fi";
import { useDelete } from "@/hooks/useDelete";
import { formatCategoryName } from "@/components/categories/utils";
import { ErrorDisplay } from "@/components/common/ui";

export default function CategoriesPage() {
  const [searchTerm, setSearchTerm] = useState("");
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingCategory, setEditingCategory] = useState<string | null>(null);
  const [categoryLookupCounts, setCategoryLookupCounts] = useState<Record<string, CategoryInfo>>({});
  const [selectedDesignationId, setSelectedDesignationId] = useState<string | null>(null);

  const supabase = createClient();

  const {
    data: categoriesDeduplicated = [],
    isLoading: dedupLoading,
    error: dedupError,
    refetch: refetchCategories,
  } = useDeduplicated(supabase, "lookup_types", {
    columns: ["category"],
    orderBy: [{ column: "created_at", ascending: true }],
  });

  const {
    data: groupedLookupsByCategory,
    isLoading: groupedLookupsByCategoryLoading,
    error: groupedLookupsByCategoryError,
    refetch: refetchGroupedLookupsByCategory,
  } = useTableQuery(supabase, "lookup_types", {
    select: (allLookups): GroupedLookupsByCategory => {
      if (!allLookups) return {};
      return allLookups.reduce((accumulator, currentLookup) => {
        const category = currentLookup.category;
        if (!accumulator[category]) {
          accumulator[category] = [];
        }
        accumulator[category].push(currentLookup);
        return accumulator;
      }, {} as GroupedLookupsByCategory);
    },
  });

  const deleteManager = useDelete({
    tableName: "lookup_types",
    onSuccess: () => {
      if (selectedDesignationId === deleteManager.itemToDelete?.id) {
        setSelectedDesignationId(null);
      }
      refetchCategories();
    },
  });

  const isLoading = dedupLoading || groupedLookupsByCategoryLoading || deleteManager.isPending;

  const refreshCategoryInfo = useCallback(() => {
    const counts: Record<string, CategoryInfo> = {};
    for (const category of categoriesDeduplicated) {
      const categoryLookups = groupedLookupsByCategory?.[category.category] || [];
      counts[category.category] = {
        name: category.category,
        lookupCount: categoryLookups.length,
        hasSystemDefaults: categoryLookups.some((lookup) => lookup.is_system_default),
      };
    }
    setCategoryLookupCounts(counts);
  }, [categoriesDeduplicated, groupedLookupsByCategory]);

  useEffect(() => {
    if (!isLoading) {
      refreshCategoryInfo();
    }
  }, [categoriesDeduplicated, groupedLookupsByCategory, isLoading, refreshCategoryInfo]);

  async function handleRefresh() {
    try {
      await Promise.all([refetchCategories(), refetchGroupedLookupsByCategory()]);
      if (!isModalOpen) {
        toast.success("Data refreshed successfully");
      }
    } catch (error) {
      console.error("Error refreshing data:", error);
    }
  }

  const handleCategoryCreated = async () => {
    setIsModalOpen(false);
    setEditingCategory(null);
    handleRefresh();
  };

  const handleEdit = (categoryName: string) => {
    setEditingCategory(categoryName);
    setIsModalOpen(true);
    // handleRefresh();
  };

  const bulkDeleteManager = useDeleteManager({
    tableName: "lookup_types",
    onSuccess: () => {
      if (selectedDesignationId === deleteManager.itemToDelete?.id) {
        setSelectedDesignationId(null);
      }
      refetchCategories();
    },
  });
  const handleDeleteCategory = (categoryToDelete: string) => {
    bulkDeleteManager.deleteBulk({
      column: "category",
      value: categoryToDelete,
      displayName: categoryToDelete,
    });
  };

  const openCreateModal = () => {
    setEditingCategory(null);
    setIsModalOpen(true);
  };

  const handleModalClose = () => {
    setIsModalOpen(false);
    setEditingCategory(null);
  };

  const filteredCategories = (categoriesDeduplicated as Categories[])?.filter(
    (category) =>
      (category.category && category.category.toLowerCase().includes(searchTerm.toLowerCase())) ||
      formatCategoryName(category as Categories)
        .toLowerCase()
        .includes(searchTerm.toLowerCase())
  );

  // --- Define header content using the hook ---
  const serverFilters = useMemo(() => {
    const f: Filters = {
      // Filter to download only categories with name not equal to "DEFAULT"
      name: {
        operator: "eq",
        value: "DEFAULT",
      },
    };
    return f;
  }, []);
  const headerActions = useStandardHeaderActions({
    data: categoriesDeduplicated,
    onRefresh: async () => {
      await refetchCategories();
      toast.success("Refreshed successfully!");
    },
    onAddNew: openCreateModal,
    isLoading: isLoading,
    exportConfig: { tableName: "lookup_types", fileName: "Categories", filters: serverFilters },
  });

  const activeCategories = categoriesDeduplicated.filter((category) => category.status);
  const inactiveCategories = categoriesDeduplicated.filter((category) => !category.status);

  const headerStats = [
    { value: categoriesDeduplicated.length, label: "Total Categories" },
    {
      value: activeCategories.length,
      label: "Active",
      color: "success" as const,
    },
    {
      value: inactiveCategories.length,
      label: "Inactive",
      color: "danger" as const,
    },
  ];

  const error = dedupError || groupedLookupsByCategoryError;

  if (error) {
    return <ErrorDisplay error={error.message} actions={[
      {
        label: "Retry",
        onClick: refetchCategories,
        variant: "primary",
      },
    ]} />;
  }

  return (
    <div className='space-y-6 p-6 dark:bg-gray-900 dark:text-gray-100'>
      <PageHeader title='Categories' description='Manage categories and their related information.' icon={<FiLayers />} stats={headerStats} actions={headerActions} isLoading={isLoading} />

      <CategorySearch searchTerm={searchTerm} onSearchChange={setSearchTerm} />

      {isLoading && <LoadingState />}

      {!isLoading && !dedupError && !groupedLookupsByCategoryError && (
        <CategoriesTable
          categories={filteredCategories}
          categoryLookupCounts={categoryLookupCounts}
          totalCategories={categoriesDeduplicated.length}
          onEdit={handleEdit}
          onDelete={handleDeleteCategory}
          isDeleting={deleteManager.isPending}
          searchTerm={searchTerm}
        />
      )}

      {categoriesDeduplicated.length === 0 && !isLoading && !dedupError && <EmptyState onCreate={openCreateModal} />}

      <ConfirmModal
        isOpen={deleteManager.isConfirmModalOpen}
        onConfirm={deleteManager.handleConfirm}
        onCancel={deleteManager.handleCancel}
        title='Confirm Deletion'
        message={deleteManager.confirmationMessage}
        confirmText='Delete'
        cancelText='Cancel'
        type='danger'
        showIcon
        closeOnBackdrop
        closeOnEscape
        loading={deleteManager.isPending}
        size='md'
      />

      <CategoryModal isOpen={isModalOpen} onClose={handleModalClose} onCategoryCreated={handleCategoryCreated} editingCategory={editingCategory || ""} categories={categoriesDeduplicated} lookupsByCategory={groupedLookupsByCategory} />
    </div>
  );
}





```

<!-- path: hnvtx/app/dashboard/nodes/page.tsx -->
```typescript
'use client';

import React, { useMemo } from 'react';
import { DataTable } from '@/components/table/DataTable';
import { NodesFilters } from '@/components/nodes/NodesFilters';
import { NodesTableColumns } from '@/config/table-columns/NodesTableColumns';
import { NodeFormModal } from '@/components/nodes/NodeFormModal';
import { ConfirmModal, ErrorDisplay } from '@/components/common/ui';
import {
  Row,
  usePagedNodesComplete,
} from '@/hooks/database';
import { FiCpu } from 'react-icons/fi';
import { createClient } from '@/utils/supabase/client';
import {
  DataQueryHookParams,
  DataQueryHookReturn,
  useCrudManager,
} from '@/hooks/useCrudManager';
import { createStandardActions } from '@/components/table/action-helpers';
import {
  PageHeader,
  useStandardHeaderActions,
} from '@/components/common/PageHeader';
import { toast } from 'sonner';
import { NodeRowsWithCount } from '@/types/view-row-types';
import { NodeDetailsModal } from '@/config/node-details-config';
import { NodeRowsWithRelations } from '@/types/relational-row-types';
import useOrderedColumns from '@/hooks/useOrderedColumns';

// 1. ADAPTER HOOK: Makes `useNodesData` compatible with `useCrudManager`
const useNodesData = (
  params: DataQueryHookParams
): DataQueryHookReturn<NodeRowsWithCount> => {
  const { currentPage, pageLimit, filters, searchQuery } = params;

  const supabase = createClient();

  const { data, isLoading, error, refetch } = usePagedNodesComplete(supabase, {
    filters: {
      ...filters,
      ...(searchQuery ? { name: searchQuery } : {}),
    },
    limit: pageLimit,
    offset: (currentPage - 1) * pageLimit,
  });

  // Calculate counts from the full dataset
  const totalCount = data?.[0]?.total_count || 0;
  const activeCount = data?.[0]?.active_count || 0;
  const inactiveCount = data?.[0]?.inactive_count || 0;

  return {
    data: data || [],
    totalCount,
    activeCount,
    inactiveCount,
    isLoading,
    error,
    refetch,
  };
};

const NodesPage = () => {
  // 2. USE THE CRUD MANAGER with the adapter hook and both generic types
  const {
    data: nodes,
    totalCount,
    activeCount,
    inactiveCount,
    isLoading,
    // isMutating,
    error,
    refetch,
    pagination,
    search,
    filters,
    editModal,
    viewModal,
    // bulkActions,
    deleteModal,
    actions: crudActions,
  } = useCrudManager<'nodes', NodeRowsWithCount>({
    tableName: 'nodes',
    dataQueryHook: useNodesData,
  });

  // 3. Extract node types from the nodes data
  const nodeTypes = useMemo(() => {
    const uniqueNodeTypes = new Map();
    nodes.forEach((node) => {
      if (node.node_type_id) {
        uniqueNodeTypes.set(node.node_type_id, {
          id: node.node_type_id,
          name: node.node_type_name,
        });
      }
    });

    return Array.from(uniqueNodeTypes.values());
  }, [nodes]);

  const columns = NodesTableColumns(nodes);

  const desiredColumns = [
    'name',
    'latitude',
    'longitude',
    'node_type_name',
    'node_type_code',
    'maintenance_area_name',
    'maintenance_area_code',
    'maintenance_area_type_name',
    'status',
    'remark',
    'id',
    'node_type_id',
    'maintenance_terminal_id',
    'created_at',
    'updated_at',
    'total_count',
    'active_count',
    'inactive_count',
  ]

  const orderedColumns = useOrderedColumns(columns, desiredColumns);

  const tableActions = useMemo(
    () =>
      createStandardActions<NodeRowsWithCount>({
        onEdit: editModal.openEdit,
        onView: viewModal.open,
        onDelete: crudActions.handleDelete,
      }),
    [editModal.openEdit, viewModal.open, crudActions.handleDelete]
  );

  // --- Define header content using the hook ---
  const headerActions = useStandardHeaderActions({
    data: nodes as Row<'nodes'>[],
    onAddNew: () => {
      editModal.openAdd();
    },
    onRefresh: () => {
      refetch();
      toast.success('Refreshed successfully!');
    },
    isLoading: isLoading,
    exportConfig: { tableName: 'nodes' },
  });

  const headerStats = [
    { value: totalCount, label: 'Total Nodes' },
    {
      value: activeCount,
      label: 'Active',
      color: 'success' as const,
    },
    {
      value: inactiveCount,
      label: 'Inactive',
      color: 'danger' as const,
    },
  ];

  if (error) {
    return (
      <ErrorDisplay
        error={error.message}
        actions={[
          {
            label: 'Retry',
            onClick: refetch,
            variant: 'primary',
          },
        ]}
      />
    );
  }

  return (
    <div className="mx-auto space-y-4">
      <PageHeader
        title="Node Management"
        description="Manage network nodes and their related information."
        icon={<FiCpu />}
        stats={headerStats}
        actions={headerActions} // <-- Pass the generated actions
        isLoading={isLoading}
      />

      <NodeDetailsModal
        isOpen={viewModal.isOpen}
        node={viewModal.record as NodeRowsWithCount}
        onClose={viewModal.close}
      />

      <DataTable
        tableName="v_nodes_complete"
        data={nodes}
        columns={orderedColumns}
        loading={isLoading}
        actions={tableActions}
        selectable={true} // Assuming you might want bulk actions later
        showColumnsToggle={true}
        pagination={{
          current: pagination.currentPage,
          pageSize: pagination.pageLimit,
          total: totalCount,
          showSizeChanger: true,
          onChange: (page, pageSize) => {
            pagination.setCurrentPage(page);
            pagination.setPageLimit(pageSize);
          },
        }}
        customToolbar={
          <NodesFilters
            searchQuery={search.searchQuery}
            onSearchChange={search.setSearchQuery}
            nodeTypes={nodeTypes}
            selectedNodeType={
              filters.filters.node_type_id as string | undefined
            }
            onNodeTypeChange={(value) =>
              filters.setFilters((prev) => ({ ...prev, node_type_id: value }))
            }
          />
        }
      />

      {editModal.isOpen && (
        <NodeFormModal
          isOpen={editModal.isOpen}
          onClose={editModal.close}
          editingNode={editModal.record as NodeRowsWithRelations | null}
          onCreated={crudActions.handleSave}
          onUpdated={crudActions.handleSave}
        />
      )}

      <ConfirmModal
        isOpen={deleteModal.isOpen}
        onConfirm={deleteModal.onConfirm}
        onCancel={deleteModal.onCancel}
        title="Confirm Deletion"
        message={deleteModal.message}
        loading={deleteModal.loading}
        type="danger"
      />
    </div>
  );
};

export default NodesPage;

```

<!-- path: hnvtx/app/dashboard/employees/page.tsx -->
```typescript
'use client';

import React, { useMemo, useState } from 'react';
import { FiDownload, FiPlus } from 'react-icons/fi';
import { createClient } from '@/utils/supabase/client';
import { useCrudPage } from '@/hooks/useCrudPage';
import { TableInsert, usePagedEmployeesWithCount, useTableQuery } from '@/hooks/database';
import { DataTable } from '@/components/table/DataTable';
import { Row } from '@/hooks/database';
import { Button, ConfirmModal, ErrorDisplay } from '@/components/common/ui';
import EmployeeForm from '@/components/employee/EmployeeForm';
// import EmployeeDetailsModal from "@/components/employee/EmployeeDetailsModal";
import EmployeeFilters from '@/components/employee/EmployeeFilters';
import { getEmployeeTableColumns } from '@/components/employee/EmployeeTableColumns';
import { getEmployeeTableActions } from '@/components/employee/EmployeeTableActions';
import { EmployeeWithRelations } from '@/components/employee/employee-types';
import { BulkActions } from '@/components/common/BulkActions';
import { useTableExcelDownload } from '@/hooks/database/excel-queries';
import { toast } from 'sonner';
import { formatDate } from '@/utils/formatters';
import { useDynamicColumnConfig } from '@/hooks/useColumnConfig';
import { EmployeeDetailsModal } from '@/config/employee-details-config';
import {
  DataQueryHookParams,
  DataQueryHookReturn,
  useCrudManager,
} from '@/hooks/useCrudManager';
import { EmployeeRowsWithCount } from '@/types/view-row-types';
import { EmployeeRowsWithRelations } from '@/types/relational-row-types';

// 1. ADAPTER HOOK
const useEmployeesData = (
  params: DataQueryHookParams
): DataQueryHookReturn<EmployeeRowsWithCount> => {
  const { currentPage, pageLimit, filters, searchQuery } = params;

  const supabase = createClient();

  const { data, isLoading, error, refetch } = usePagedEmployeesWithCount(
    supabase,
    {
      filters: {
        ...filters,
        ...(searchQuery ? { name: searchQuery } : {}),
      },
      limit: pageLimit,
      offset: (currentPage - 1) * pageLimit,
    }
  );

  // Calculate counts from the full dataset
  const totalCount = data?.[0]?.total_count || 0;
  const activeCount = data?.[0]?.active_count || 0;
  const inactiveCount = data?.[0]?.inactive_count || 0;

  return {
    data: data || [],
    totalCount,
    activeCount,
    inactiveCount,
    isLoading,
    error,
    refetch,
  };
};

const EmployeesPage = () => {
  const [showFilters, setShowFilters] = useState(false);

  // 2. USE THE CRUD MANAGER with the adapter hook and both generic types
  const {
    data: employeesData,
    totalCount,
    activeCount,
    inactiveCount,
    isLoading,
    // isMutating,
    error,
    refetch,
    pagination,
    search,
    filters,
    editModal,
    viewModal,
    bulkActions,
    deleteModal,
    actions: crudActions,
  } = useCrudManager<'employees', EmployeeRowsWithCount>({
    tableName: 'employees',
    dataQueryHook: useEmployeesData,
    processDataForSave: (data) => {
      // Employee-specific date logic
      if (data.employee_dob) data.employee_dob = new Date(data.employee_dob);
      if (data.employee_doj) data.employee_doj = new Date(data.employee_doj);
      return data as TableInsert<'employees'>;
      }
  });

  const [viewingEmployeeId, setViewingEmployeeId] = useState<string | null>(
    null
  );

  const supabase = createClient();
  const { data: designations = [] } = useTableQuery(
    supabase,
    'employee_designations',
    { orderBy: [{ column: 'name' }] }
  );
  const { data: maintenanceAreas = [] } = useTableQuery(
    supabase,
    'maintenance_areas',
    { filters: { status: true }, orderBy: [{ column: 'name' }] }
  );

  const columns = useMemo(
    () =>
      getEmployeeTableColumns({
        designationMap: Object.fromEntries(
          designations.map((d) => [d.id, d.name])
        ),
        areaMap: Object.fromEntries(
          maintenanceAreas.map((a) => [a.id, a.name])
        ),
      }),
    [designations, maintenanceAreas]
  );

  const tableActions = useMemo(
    () =>
      getEmployeeTableActions({
        onView: (id) => setViewingEmployeeId(id),
        onEdit: (id) => {
          const emp = employeesData.find((e) => e.id === id);
          if (emp) editModal.openEdit(emp);
        },
        onToggleStatus: (record) => crudActions.handleToggleStatus(record),
        onDelete: (employeeId, displayName = 'this employee') =>
          crudActions.handleDelete({ id: employeeId, name: displayName }),
      }),
    [employeesData, editModal, crudActions]
  );

  // Download Configurations
  const exportColumns = useDynamicColumnConfig('employees', {
    data: employeesData as Row<'employees'>[],
  });
  const tableExcelDownload = useTableExcelDownload(supabase, 'employees', {
    onSuccess: () => {
      toast.success('Export successful');
    },
    onError: () => toast.error('Export failed'),
  });

  const handleExport = async () => {
    const tableName = 'employees';
    const tableOptions = {
      fileName: `${formatDate(new Date(), { format: 'dd-mm-yyyy' })}-${String(
        tableName
      )}-export.xlsx`,
      sheetName: String(tableName),
      columns: exportColumns,
      // filters: filters.filters,
      maxRows: 1000,
      customStyles: {},
    };
    tableExcelDownload.mutate(tableOptions);
  };

  if (error) {
    return (
      <ErrorDisplay
        error={error.message}
        actions={[
          {
            label: 'Retry',
            onClick: refetch,
            variant: 'primary',
          },
        ]}
      />
    );
  }

  return (
    <div className="mx-auto space-y-4">
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold">
          Employee Management ({totalCount})
        </h1>
        <div className="flex gap-2">
          <Button
            variant="outline"
            leftIcon={<FiDownload />}
            onClick={handleExport}
          >
            Export
          </Button>
          <Button onClick={editModal.openAdd} leftIcon={<FiPlus />}>
            Add Employee
          </Button>
        </div>
      </div>
      <BulkActions
        selectedCount={bulkActions.selectedCount}
        isOperationLoading={isLoading}
        onBulkDelete={bulkActions.handleBulkDelete}
        onBulkUpdateStatus={bulkActions.handleBulkUpdateStatus}
        onClearSelection={bulkActions.handleClearSelection}
        entityName="employee"
        showStatusUpdate={true}
      />

      <DataTable
        tableName="employees"
        data={employeesData as Row<'employees'>[]}
        columns={columns}
        loading={isLoading}
        actions={tableActions}
        selectable
        onRowSelect={(selectedRows) => {
          // Filter out any rows where id is null
          const validRows = selectedRows.filter((row): row is EmployeeRowsWithCount & { 
            id: string;
            employee_name: string;  // Ensure employee_name is not null
          } => row.id !== null && row.employee_name !== null);
          bulkActions.handleRowSelect(validRows);
        }}
        searchable={false} // Turn off internal search
        filterable={false} // Turn off internal filters
        showColumnsToggle={true}
        pagination={{
          current: pagination.currentPage,
          pageSize: pagination.pageLimit,
          total: totalCount,
          showSizeChanger: true,
          onChange: (page, pageSize) => {
            pagination.setCurrentPage(page);
            pagination.setPageLimit(pageSize);
          },
        }}
        customToolbar={
          <EmployeeFilters
            searchQuery={search.searchQuery} // <-- PASS THE SEARCH QUERY DOWN
            showFilters={showFilters}
            filters={filters.filters}
            onSearchChange={search.setSearchQuery}
            onFilterToggle={() => setShowFilters(!showFilters)}
            onDesignationChange={(value) =>
              filters.setFilters((prev) => ({
                ...prev,
                employee_designation_id: value,
              }))
            }
            onStatusChange={(value) =>
              filters.setFilters((prev) => ({ ...prev, status: value }))
            }
            onMaintenanceAreaChange={(value) =>
              filters.setFilters((prev) => ({
                ...prev,
                maintenance_terminal_id: value,
              }))
            }
            designations={designations as Row<'employee_designations'>[]}
            maintenanceAreas={maintenanceAreas as Row<'maintenance_areas'>[]}
          />
        }
      />

      <EmployeeForm
        isOpen={editModal.isOpen}
        onClose={editModal.close}
        employee={editModal.record as EmployeeWithRelations | null}
        onSubmit={crudActions.handleSave}
        onCancel={editModal.close}
        isLoading={isLoading}
        designations={designations as Row<'employee_designations'>[]}
        maintenanceAreas={maintenanceAreas as Row<'maintenance_areas'>[]}
      />

      {/* {viewingEmployeeId && (
        <EmployeeDetailsModal
          employeeId={viewingEmployeeId}
          onClose={() => setViewingEmployeeId(null)}
          onEdit={() => {
            const emp = employeesData.find((e) => e.id === viewingEmployeeId);
            if (emp) modal.openEditModal(emp);
            setViewingEmployeeId(null);
          }}
        />
      )} */}
      <EmployeeDetailsModal
        employee={employeesData.find((e) => e.id === viewingEmployeeId)}
        onClose={() => setViewingEmployeeId(null)}
        isOpen={viewingEmployeeId !== null}
      />

      <ConfirmModal
         isOpen={deleteModal.isOpen}
         onConfirm={deleteModal.onConfirm}
         onCancel={deleteModal.onCancel}
         title="Confirm Deletion"
         message={deleteModal.message}
         loading={deleteModal.loading}
         type="danger"
      />
    </div>
  );
};

export default EmployeesPage;

```

<!-- path: hnvtx/app/dashboard/page.tsx -->
```typescript
"use client";

import { tableQueryUtils, useDashboardOverview, useQueryPerformance } from "@/hooks/database";
import { useQueryClient } from "@tanstack/react-query";
import { createClient } from "@/utils/supabase/client";
import { Button } from "@/components/common/ui";

export default function DashboardPage() {
  const { getQueryStats, clearStaleQueries, prefetchCriticalData } = useQueryPerformance();
  const queryClient = useQueryClient();
  const supabase = createClient();
  // const { data } = useDashboardOverview(supabase, {});

  const stats = getQueryStats();

  const handleOptimizeCache = async () => {
    // Clear stale queries
    clearStaleQueries();

    // Remove old queries
    tableQueryUtils.removeStaleQueries(queryClient, 5 * 60 * 1000); // 5 minutes

    // Prefetch critical data
    await prefetchCriticalData(supabase, ['lookup_types', 'employees', 'employee_designations']);

    // Get cache stats for specific table
    const lookupTypesCacheStats = tableQueryUtils.getTableCacheStats(queryClient, 'lookup_types');
    console.log('Lookup Types cache stats:', lookupTypesCacheStats);

    const employeesCacheStats = tableQueryUtils.getTableCacheStats(queryClient, 'employees');
    console.log('Employees cache stats:', employeesCacheStats);

    const employeeDesignationsCacheStats = tableQueryUtils.getTableCacheStats(queryClient, 'employee_designations');
    console.log('Employee Designations cache stats:', employeeDesignationsCacheStats);

    // console.log('Dashboard Overview:', data);
  };
  return (
    <div className="flex flex-col items-center justify-center py-16">
      <Button onClick={handleOptimizeCache}>Optimize Cache</Button>
      <h2 className="mb-4 text-2xl font-bold text-gray-600 dark:text-gray-300">Welcome to your dashboard</h2>
      <p className="text-gray-600 dark:text-gray-300">
        Select an item from the sidebar to get started.
      </p>
      <pre>{JSON.stringify(stats, null, 2)}</pre>
      <div>
      <h3>Query Performance</h3>
      <p>Total Queries: {stats.totalQueries}</p>
      <p>Stale Queries: {stats.staleQueries}</p>
      <p>Cache Size: {(stats.cacheSizeBytes / 1024 / 1024).toFixed(2)} MB</p>
      <button onClick={handleOptimizeCache}>Optimize Cache</button>
    </div>
    </div>
  );
}

```

<!-- path: hnvtx/app/dashboard/systems/page.tsx -->
```typescript
'use client';

import { useMemo, useState, useCallback } from 'react';
import { FiPlus, FiServer, FiRefreshCw, FiDatabase } from 'react-icons/fi';
import { toast } from 'sonner';
import { useRouter } from 'next/navigation';

import {
  convertRichFiltersToSimpleJson,
  Filters,
  useGetLookupTypesByCategory,
  usePagedSystemsComplete,
} from '@/hooks/database';
import { createClient } from '@/utils/supabase/client';
import { ConfirmModal } from '@/components/common/ui/Modal/confirmModal';
import { DataTable } from '@/components/table/DataTable';
import { Row } from '@/hooks/database';
import {
  PageSkeleton,
  StatsCardsSkeleton,
} from '@/components/common/ui/table/TableSkeleton';
import {
  DataQueryHookParams,
  DataQueryHookReturn,
  useCrudManager,
} from '@/hooks/useCrudManager';
import { SystemRowsWithCountWithRelations } from '@/types/view-row-types';
import { Json } from '@/types/supabase-types';
import { SystemsTableColumns } from '@/config/table-columns/SystemsTableColumns';
import { createStandardActions } from '@/components/table/action-helpers';
import { useIsSuperAdmin } from '@/hooks/useAdminUsers';
import {
  PageHeader,
  useStandardHeaderActions,
} from '@/components/common/PageHeader';
import { ErrorDisplay } from '@/components/common/ui';
import { SearchAndFilters } from '@/components/common/filters/SearchAndFilters';
import { SelectFilter } from '@/components/common/filters/FilterInputs';
import { SystemRowsWithRelations } from '@/types/relational-row-types';
import { SystemModal } from '@/components/systems/system-modal';

// 1. ADAPTER HOOK: Makes `useSystemsData` compatible with `useCrudManager`
const useSystemsData = (
  params: DataQueryHookParams
): DataQueryHookReturn<SystemRowsWithCountWithRelations> => {
  const { currentPage, pageLimit, filters, searchQuery } = params;
  const supabase = createClient();
  // Build the server filters object that the RPC function expects.
  const serverFilters = useMemo(() => {
    const richFilters: Filters = { ...filters };

    if (searchQuery) {
      richFilters.or = `system_name.ilike.%${searchQuery}%,system_type_name.ilike.%${searchQuery}%,status.ilike.%${searchQuery}%`;
    }
    return convertRichFiltersToSimpleJson(richFilters);
  }, [filters, searchQuery]);

  const { data, isLoading, error, refetch } = usePagedSystemsComplete(
    supabase,
    {
      filters: serverFilters as Json,
      limit: pageLimit,
      offset: (currentPage - 1) * pageLimit,
    }
  );

  // Calculate counts from the full dataset
  const totalCount = data?.[0]?.total_count || 0;
  const activeCount = data?.[0]?.active_count || 0;
  const inactiveCount = data?.[0]?.inactive_count || 0;

  return {
    data: (data || []).map((item) => ({
      ...item,
      maintenance_terminal_id: null, // Add missing field
      node_id: null, // Add missing field
      system_type_id: null, // Add missing field
    })),
    totalCount,
    activeCount,
    inactiveCount,
    isLoading,
    error,
    refetch,
  };
};

export default function SystemsPage() {
  const supabase = createClient();
  const router = useRouter();

  // 2. USE THE CRUD MANAGER with the adapter hook and both generic types
  const {
    data: paginatedSystems,
    totalCount,
    activeCount,
    inactiveCount,
    isLoading,
    isMutating,
    error: systemsError,
    refetch,
    pagination,
    search,
    filters: crudFilters,
    editModal,
    viewModal,
    bulkActions,
    deleteModal,
    actions: crudActions,
  } = useCrudManager<'systems', SystemRowsWithCountWithRelations>({
    tableName: 'systems',
    dataQueryHook: useSystemsData,
    searchColumn: 'system_name', // This can be considered the "primary" search field for display purposes
  });

  // --- State Management ---
  const { data: isSuperAdmin } = useIsSuperAdmin();
  const [showFilters, setShowFilters] = useState(false);
  const handleClearFilters = () => {
    crudFilters.setFilters({});
    search.setSearchQuery('');
  };
  const activeFilterCount = Object.values(crudFilters.filters).filter(
    Boolean
  ).length;
  const hasActiveFilters = activeFilterCount > 0 || !!search.searchQuery;

  const { data: systemTypes = [], isLoading: isLoadingSystemTypes } =
    useGetLookupTypesByCategory(supabase, 'SYSTEM_TYPES');

  // --- Action Handlers ---
  const handleView = useCallback(
    (system: Row<'v_systems_complete'>) => {
      router.push(`/systems/${system.id}`);
    },
    [router]
  );

  const handleEdit = useCallback(
    (system: Row<'v_systems_complete'>) => {
      router.push(`/systems/${system.id}/edit`);
    },
    [router]
  );

  const handleRefresh = useCallback(() => {
    refetch();
    toast.success('Systems data refreshed');
  }, [refetch]);

  // --- Table Column Configuration ---
  const columns = SystemsTableColumns(paginatedSystems);

  // const headerActions = useStandardHeaderActions({
  //   onRefresh: async () => {
  //     await refetch();
  //     toast.success('Refreshed successfully!');
  //   },
  //   onAddNew: editModal.openAdd,
  //   isLoading: isMutating,
  //   exportConfig: {
  //     tableName: 'systems',
  //   },
  // });

  // --- tableActions ---
  const tableActions = useMemo(
    () =>
      createStandardActions<SystemRowsWithCountWithRelations>({
        onEdit: editModal.openEdit,
        onView: viewModal.open,
        onDelete: crudActions.handleDelete,
        onToggleStatus: crudActions.handleToggleStatus,
        canDelete: () => isSuperAdmin === true,
      }),
    [
      editModal.openEdit,
      viewModal.open,
      crudActions.handleDelete,
      crudActions.handleToggleStatus,
      isSuperAdmin,
    ]
  );

  // --- Define header content using the hook ---
  const headerActions = useStandardHeaderActions({
    data: paginatedSystems as Row<'systems'>[],
    onRefresh: async () => {
      await refetch();
      toast.success('Refreshed successfully!');
    },
    onAddNew: editModal.openAdd,
    isLoading: isLoading,
    exportConfig: { tableName: 'systems' },
  });

  const headerStats = [
    { value: totalCount, label: 'Total Systems', color: 'primary' as const },
    {
      value: activeCount,
      label: 'Active',
      color: 'success' as const,
    },
    {
      value: inactiveCount,
      label: 'Inactive',
      color: 'danger' as const,
    },
    {
      value: systemTypes.length,
      label: 'System Types',
      color: 'default' as const,
    }
  ];

  // --- Loading State ---
  if (isLoading && !paginatedSystems.length) {
    return <PageSkeleton />;
  }

  if (systemsError) {
    return (
      <ErrorDisplay
        error={systemsError.message}
        actions={[
          {
            label: 'Retry',
            onClick: refetch,
            variant: 'primary',
          },
        ]}
      />
    );
  }

  return (
    <>
      <div className="min-h-screen bg-gray-50 p-6 dark:bg-gray-900">
        <div className="mx-auto">
          {/* Header */}
          <PageHeader
            title="System Management"
            description="Manage network systems and their related information."
            icon={<FiDatabase />}
            stats={headerStats}
            actions={headerActions}
            isLoading={isLoading}
          />

          <DataTable
            title="Systems"
            data={paginatedSystems}
            columns={columns}
            pagination={{
              current: pagination.currentPage,
              pageSize: pagination.pageLimit,
              total: totalCount,
              onChange: (page, limit) => {
                pagination.setCurrentPage(page);
                pagination.setPageLimit(limit);
              },
            }}
            actions={tableActions}
            searchable={true}
            filterable={true}
            sortable={true}
            selectable={true}
            exportable={true}
            refreshable={true}
            density="default"
            bordered={true}
            striped={true}
            hoverable={true}
            className="mt-6"
            emptyText="No systems found matching your criteria"
            tableName="v_systems_complete"
            loading={isLoading}
            customToolbar={
              <SearchAndFilters
                searchTerm={search.searchQuery}
                onSearchChange={search.setSearchQuery}
                showFilters={showFilters}
                onToggleFilters={() => setShowFilters((p) => !p)}
                onClearFilters={handleClearFilters}
                hasActiveFilters={hasActiveFilters}
                activeFilterCount={activeFilterCount}
                searchPlaceholder="Search by Asset No or Route Name or Transnet ID..."
              >
                {/* THIS IS THE CLEANER, TYPE-SAFE WAY */}
                <SelectFilter
                  label="System Type"
                  filterKey="system_type_id"
                  filters={crudFilters.filters}
                  setFilters={crudFilters.setFilters}
                  options={systemTypes.map((t) => ({
                    value: t.id,
                    label: t.code,
                  }))}
                />
              </SearchAndFilters>
            }
          />
        </div>
      </div>

      {/* Modals */}
      <SystemModal
        isOpen={editModal.isOpen}
        onClose={editModal.close}
        rowData={editModal.record as SystemRowsWithCountWithRelations | null}
        refetch={refetch}
      />

      <ConfirmModal
        isOpen={deleteModal.isOpen}
        onConfirm={deleteModal.onConfirm}
        onCancel={deleteModal.onCancel}
        title="Confirm Deletion"
        message={deleteModal.message}
        confirmText="Delete"
        cancelText="Cancel"
        type="danger"
        showIcon
        closeOnBackdrop
        closeOnEscape
        loading={deleteModal.loading}
        size="md"
      />
    </>
  );
}

```

<!-- path: hnvtx/app/dashboard/maintenance-areas/page.tsx -->
```typescript
// components/maintenance-areas/MaintenanceAreasPage.tsx
"use client";

import { useMemo, useState } from "react";
import { createClient } from "@/utils/supabase/client";
import { useTableWithRelations, useTableQuery, Filters } from "@/hooks/database";
import { AreaFormModal } from "@/components/maintenance-areas/AreaFormModal";
import { ConfirmModal } from "@/components/common/ui/Modal";
import { useMaintenanceAreasMutations } from "@/components/maintenance-areas/useMaintenanceAreasMutations";
import { FiMapPin } from "react-icons/fi";
import { toast } from "sonner";
import { PageHeader, useStandardHeaderActions } from "@/components/common/PageHeader";
import { ErrorDisplay } from "@/components/common/ui";
import { EntityManagementComponent } from "@/components/common/entity-management/EntityManagementComponent";
import { areaConfig, MaintenanceAreaWithRelations } from "@/config/areas";
import { useDelete } from "@/hooks/useDelete";
import { TablesInsert } from "@/types/supabase-types";

export default function MaintenanceAreasPage() {
  const supabase = createClient();

  // State management
  const [filters, setFilters] = useState<{ status?: string; areaType?: string }>({});
  const [selectedAreaId, setSelectedAreaId] = useState<string | null>(null);
  const [isFormOpen, setFormOpen] = useState(false);
  const [editingArea, setEditingArea] = useState<MaintenanceAreaWithRelations | null>(null);

  // Data queries
  const serverFilters = useMemo(() => {
    const f: Filters = {};
    if (filters.status) f.status = filters.status === "true";
    if (filters.areaType) f.area_type_id = filters.areaType;
    return f;
  }, [filters]);

  const areasQuery = useTableWithRelations(supabase, "maintenance_areas", ["area_type:area_type_id(id, name)", "parent_area:parent_id(id, name, code)"], {
    filters: serverFilters,
    orderBy: [{ column: "name", ascending: true }],
  });

  const { isLoading, error, refetch } = areasQuery;

  const { data: areaTypes = [] } = useTableQuery(supabase, "lookup_types", {
    filters: { category: { operator: "eq", value: "MAINTENANCE_AREA_TYPES" } },
    orderBy: [{ column: "name", ascending: true }],
  });

  // Data mutations
  const { createAreaMutation, updateAreaMutation, toggleStatusMutation, handleFormSubmit } = useMaintenanceAreasMutations(supabase, () => {
    areasQuery.refetch();
    setFormOpen(false);
    setEditingArea(null);
  });

  const deleteManager = useDelete({
    tableName: "maintenance_areas",
    onSuccess: () => {
      if (selectedAreaId === deleteManager.itemToDelete?.id) {
        setSelectedAreaId(null);
      }
      areasQuery.refetch();
    },
  });

  // Derived state
  const allAreas = useMemo(() => (areasQuery.data as MaintenanceAreaWithRelations[]) || [], [areasQuery.data]);
  const selectedArea = useMemo(() => allAreas.find((area) => area.id === selectedAreaId) || null, [selectedAreaId, allAreas]);

  // Event handlers
  const handleOpenCreateForm = () => {
    setEditingArea(null);
    setFormOpen(true);
  };

  const handleOpenEditForm = (area: MaintenanceAreaWithRelations) => {
    setEditingArea(area);
    setFormOpen(true);
  };

  // --- Define header content using the hook ---
  const headerActions = useStandardHeaderActions({
    data: allAreas,
    onRefresh: async () => {
      await refetch();
      toast.success("Refreshed successfully!");
    },
    // onAddNew: handleOpenCreateForm,
    isLoading: areasQuery.isLoading,
    exportConfig: { tableName: "maintenance_areas" },
  });

  const headerStats = [
    { value: allAreas.length, label: "Total Areas" },
    {
      value: allAreas.filter((r) => r.status).length,
      label: "Active",
      color: "success" as const,
    },
    {
      value: allAreas.filter((r) => !r.status).length,
      label: "Inactive",
      color: "danger" as const,
    },
  ];

  if (error) {
    return (
      <ErrorDisplay
        error={error.message}
        actions={[
          {
            label: "Retry",
            onClick: refetch,
            variant: "primary",
          },
        ]}
      />
    );
  }

  return (
    <div className='p-4 md:p-6 dark:bg-gray-900 min-h-screen'>
      <PageHeader title='Maintenance Areas' description='Manage maintenance areas, zones, and terminals.' icon={<FiMapPin />} stats={headerStats} actions={headerActions} isLoading={isLoading} className='mb-4' />
      <EntityManagementComponent<MaintenanceAreaWithRelations>
        config={areaConfig}
        entitiesQuery={areasQuery}
        toggleStatusMutation={toggleStatusMutation}
        onEdit={handleOpenEditForm}
        onDelete={deleteManager.deleteSingle}
        onCreateNew={handleOpenCreateForm}
      />

      {/* Modals */}
      {isFormOpen && (
        <AreaFormModal
          isOpen={isFormOpen}
          onClose={() => setFormOpen(false)}
          onSubmit={(data: TablesInsert<'maintenance_areas'>) => handleFormSubmit(data, editingArea)}
          area={editingArea}
          allAreas={allAreas}
          areaTypes={areaTypes}
          isLoading={createAreaMutation.isPending || updateAreaMutation.isPending}
        />
      )}

      <ConfirmModal
        isOpen={deleteManager.isConfirmModalOpen}
        onConfirm={deleteManager.handleConfirm}
        onCancel={deleteManager.handleCancel}
        title='Confirm Deletion'
        message={deleteManager.confirmationMessage}
        confirmText='Delete'
        cancelText='Cancel'
        type='danger'
        showIcon
        closeOnBackdrop
        closeOnEscape
        loading={deleteManager.isPending}
        size='md'
      />
    </div>
  );
}

```

<!-- path: hnvtx/app/dashboard/designations/page.tsx -->
```typescript
"use client";

import { useMemo, useState } from "react";
import { ConfirmModal } from "@/components/common/ui/Modal";
import { useTableWithRelations, useTableInsert, useTableUpdate, useToggleStatus, Filters } from "@/hooks/database";
import { TablesInsert, TablesUpdate } from "@/types/supabase-types";
import { createClient } from "@/utils/supabase/client";
import { EmployeeDesignation, DesignationWithRelations } from "@/config/designations";
import { useDelete } from "@/hooks/useDelete";
import { DesignationFormModal } from "@/components/designations/DesignationFormModal";
import { PageHeader, useStandardHeaderActions } from "@/components/common/PageHeader";
import { ErrorDisplay } from "@/components/common/ui";
import { toast } from "sonner";
import { ImUserTie } from "react-icons/im";
import { EntityManagementComponent } from "@/components/common/entity-management/EntityManagementComponent";
import { designationConfig } from "@/config/designations";

export default function DesignationManagerPage() {
  const supabase = createClient();

  // State management
  const [filters, setFilters] = useState<{ status?: string }>({});
  const [selectedDesignationId, setSelectedDesignationId] = useState<string | null>(null);
  const [isFormOpen, setFormOpen] = useState(false);
  const [editingDesignation, setEditingDesignation] = useState<DesignationWithRelations | null>(null);
  // Data queries
  const serverFilters = useMemo(() => {
    const f: Filters = {};
    if (filters.status) f.status = filters.status === "true";
    return f;
  }, [filters]);

  const designationsQuery = useTableWithRelations<"employee_designations", DesignationWithRelations[]>(supabase, "employee_designations", ["parent_designation:parent_id(id, name)"], {
    filters: serverFilters,
    orderBy: [{ column: "name", ascending: true }],
  });

  const { refetch, error, data } = designationsQuery;

  const totalCount = data?.length || 0;

  // Data mutations
  const onMutationSuccess = () => {
    designationsQuery.refetch();
    setFormOpen(false);
    setEditingDesignation(null);
  };

  const createDesignationMutation = useTableInsert(supabase, "employee_designations", { onSuccess: onMutationSuccess });
  const updateDesignationMutation = useTableUpdate(supabase, "employee_designations", { onSuccess: onMutationSuccess });
  const toggleStatusMutation = useToggleStatus(supabase, "employee_designations", { onSuccess: onMutationSuccess });

  const deleteManager = useDelete({
    tableName: "employee_designations",
    onSuccess: () => {
      if (selectedDesignationId === deleteManager.itemToDelete?.id) {
        setSelectedDesignationId(null);
      }
      designationsQuery.refetch();
    },
  });

  // Derived state
  const allDesignations = useMemo(() => (designationsQuery.data as DesignationWithRelations[]) || [], [designationsQuery.data]);

  // Event handlers
  const handleOpenCreateForm = () => {
    setEditingDesignation(null);
    setFormOpen(true);
  };

  const handleOpenEditForm = (designation: DesignationWithRelations) => {
    setEditingDesignation(designation);
    setFormOpen(true);
  };

  const handleFormSubmit = (data: TablesInsert<"employee_designations">) => {
    if (editingDesignation) {
      updateDesignationMutation.mutate({
        id: editingDesignation.id,
        data: data as TablesUpdate<"employee_designations">,
      });
    } else {
      createDesignationMutation.mutate(data);
    }
  };

  // --- Define header content using the hook ---
  const headerActions = useStandardHeaderActions({
    data: designationsQuery.data,
    onRefresh: async () => {
      await refetch();
      toast.success("Refreshed successfully!");
    },
    // onAddNew: placeholder ToDo,
    isLoading: designationsQuery.isLoading,
    exportConfig: { tableName: "employee_designations" },
  });

  const headerStats = [
    { value: totalCount, label: "Total Designations" },
    {
      value: allDesignations.filter((r) => r.status).length,
      label: "Active",
      color: "success" as const,
    },
    {
      value: allDesignations.filter((r) => !r.status).length,
      label: "Inactive",
      color: "danger" as const,
    },
  ];

  if (error) {
    return (
      <ErrorDisplay
        error={error.message}
        actions={[
          {
            label: "Retry",
            onClick: refetch,
            variant: "primary",
          },
        ]}
      />
    );
  }

  const isLoading = designationsQuery.isLoading || createDesignationMutation.isPending || updateDesignationMutation.isPending || toggleStatusMutation.isPending;

  return (
    <div className='min-h-screen bg-gray-50 dark:bg-gray-900 overflow-x-hidden'>
      <PageHeader title='Designation Management' description='Manage designations and their related information.' icon={<ImUserTie />} stats={headerStats} actions={headerActions} isLoading={isLoading} className="mb-4" />
      <EntityManagementComponent<DesignationWithRelations>
        config={designationConfig}
        entitiesQuery={designationsQuery}
        toggleStatusMutation={toggleStatusMutation}
        onEdit={handleOpenEditForm}
        onDelete={deleteManager.deleteSingle}
        onCreateNew={handleOpenCreateForm}
      />

      {/* Modals */}
      {isFormOpen && (
        <DesignationFormModal
          isOpen={isFormOpen}
          onClose={() => setFormOpen(false)}
          onSubmit={handleFormSubmit}
          designation={editingDesignation}
          allDesignations={allDesignations as unknown as EmployeeDesignation[]}
          isLoading={createDesignationMutation.isPending || updateDesignationMutation.isPending}
        />
      )}
      <ConfirmModal
        isOpen={deleteManager.isConfirmModalOpen}
        onConfirm={deleteManager.handleConfirm}
        onCancel={deleteManager.handleCancel}
        title='Confirm Deletion'
        message={deleteManager.confirmationMessage}
        confirmText='Delete'
        cancelText='Cancel'
        type='danger'
        showIcon
        closeOnBackdrop
        closeOnEscape
        loading={deleteManager.isPending}
        size='md'
      />
    </div>
  );
}

```

<!-- path: hnvtx/app/dashboard/ofc/[id]/page.tsx -->
```typescript
'use client';

// app/dashboard/ofc/[id]/page.tsx
import { useCallback, useEffect, useMemo, useState } from 'react';
import Link from 'next/link';
import { useParams, useRouter } from 'next/navigation';
import { createClient } from '@/utils/supabase/client';
import { useOfcConnection } from '@/hooks/useOfcConnection';
import {PageSpinner,
} from '@/components/common/ui/LoadingSpinner';
import { DataTable } from '@/components/table';
import { useTableExcelDownload } from '@/hooks/database/excel-queries';
import { formatDate } from '@/utils/formatters';
import { Column } from '@/hooks/database/excel-queries/excel-helpers';
import { Row } from '@/hooks/database';
import { Button } from '@/components/common/ui';
import { OfcStats } from '@/components/ofc/OfcStats';
import { DEFAULTS } from '@/config/constants';
import { OfcDetailsTableColumns } from '@/config/table-columns/OfcDetailsTableColumns';
import useOrderedColumns from '@/hooks/useOrderedColumns';
import { useDynamicColumnConfig } from '@/hooks/useColumnConfig';
import CableNotFound from '@/components/ofc-details/CableNotFound';
import OfcDetailsHeader from '@/components/ofc-details/OfcDetailsHeader';

export const dynamic = 'force-dynamic';

export type OfcConnectionFilters = {
  search: string;
  ofc_owner_id: string;
};

export default function OfcCableDetailsPage() {
  const router = useRouter();
  const params = useParams();
  const { id } = params;
  const supabase = createClient();
  const [pagination, setPagination] = useState({
    page: 1,
    pageLimit: DEFAULTS.PAGE_SIZE,
  });
  const [isBackClicked, setIsBackClicked] = useState(false);

  const {
    cable,
    existingConnections,
    isLoading,
    ensureConnectionsExist,
    totalCount,
    activeCount,
    inactiveCount,
  } = useOfcConnection({
    supabase,
    cableId: id as string,
    limit: pagination.pageLimit,
    offset: (pagination.page - 1) * pagination.pageLimit,
    orderBy: 'fiber_no_sn',
    orderDir: 'asc',
  });

  // Automatically ensure connections exist when component mounts
  useEffect(() => {
    if (!isLoading) {
      ensureConnectionsExist();
    }
  }, [isLoading, ensureConnectionsExist]);

  // Prepare data for DataTable: strip aggregate fields returned by RPC
  const tableData = useMemo(() => {
    const rows = existingConnections ?? [];
    return rows.map(
      // eslint-disable-next-line @typescript-eslint/no-unused-vars
      ({ active_count, inactive_count, total_count, ...rest }) => rest
    );
  }, [existingConnections]);

  console.log('tableData', tableData);

  // DataTable Configuration
  const columns = OfcDetailsTableColumns(
    tableData as Row<'v_ofc_connections_complete'>[]
  );

  const desiredOrder = [
    'ofc_route_name',
    'ofc_type_name',
    'fiber_no_sn',
    'otdr_distance_sn_km',
    'sn_dom',
    'sn_power_dbm',
    'fiber_no_en',
    'otdr_distance_en_km',
    'en_dom',
    'en_power_dbm',
    'route_loss_db',
    'status',
    'remark',
    'maintenance_area_name',
  ];

  const orderedColumns = useOrderedColumns(columns, desiredOrder);

  // Download Configuration
  // Convert filters to server format

  const tableExcelDownload = useTableExcelDownload(supabase, 'ofc_connections');
  
  // Generate export columns without using useMemo to avoid conditional hook calls
  const exportColumns = useDynamicColumnConfig('ofc_connections', {data: []});
  
  const handleExport = useCallback(() => {
    if (!cable?.id) return;
    
    const tableName = 'ofc_connections';
    
    const tableOptions = {
      fileName: `${formatDate(new Date(), { format: 'dd-mm-yyyy' })}-${String(
        tableName + '-' + (cable?.route_name || '')
      )}-export.xlsx`,
      sheetName: 'OFC Connections',
      columns: exportColumns as Column<Row<'ofc_connections'>>[],
      filters: {
        ofc_id: cable.id,
      },
      orderBy: 'fiber_no_sn',
      orderDir: 'asc' as const,
      maxRows: 10000,
      customStyles: {
        headerFont: { bold: true, color: { argb: 'FFFFFFFF' } },
        headerFill: {
          type: 'pattern' as const,
          pattern: 'solid' as const,
          fgColor: { argb: 'FF1E40AF' },
        },
      },
    };
    
    tableExcelDownload.mutate(tableOptions);
  }, [cable?.id, cable?.route_name, tableExcelDownload, exportColumns]);

  const loading = isLoading;

  const handleBackToOfcList = () => {
    setIsBackClicked(true);
    router.back();
  };

  if (loading) {
    return <PageSpinner />;
  }

  if (!cable) {
    return <CableNotFound id={id as string} handleBackToOfcList={handleBackToOfcList} isBackClicked={isBackClicked} />
  }


  return (
    <div className="mx-auto space-y-6 p-4 md:p-6">
      <div className="flex items-center justify-between gap-4">
        <div>
          <h1 className="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white">
            OFC Cable Details
          </h1>
          <p className="text-sm text-gray-500 dark:text-gray-400">{`${
            cable?.transnet_id
              ? 'Transnet ID: ' + cable?.transnet_id
              : 'No Entry in Transnet'
          }`}</p>
          <p className="text-sm text-gray-500 dark:text-gray-400">{`${
            cable?.asset_no
              ? ''
              : 'No Asset no. available'
          }`}</p>
        </div>
        <div>
          <Link
            href="/dashboard/ofc"
            className="px-3 py-2 text-sm border rounded-lg hover:bg-gray-50"
          >
            Back to List
          </Link>
          <Button onClick={handleExport} variant="outline" className="ml-2">
            Export
          </Button>
        </div>
      </div>
      <OfcStats
        total={totalCount}
        active={activeCount}
        inactive={inactiveCount}
      />
      <OfcDetailsHeader cable={cable as unknown as Row<'v_ofc_cables_complete'>} />

      <div className="rounded-lg border border-gray-200 dark:border-gray-700 p-4">
        <DataTable<'v_ofc_connections_complete'>
          tableName="v_ofc_connections_complete"
          data={tableData as Row<'v_ofc_connections_complete'>[]}
          columns={
            orderedColumns as Column<Row<'v_ofc_connections_complete'>>[]
          }
          loading={isLoading}
          selectable={true}
          searchable={true}
          filterable={false}
          pagination={{
            current: pagination.page,
            pageSize: pagination.pageLimit,
            total: totalCount,
            showSizeChanger: true,
            pageSizeOptions: DEFAULTS.PAGE_SIZE_OPTIONS,
            onChange: (page, pageLimit) => setPagination({ page, pageLimit }),
          }}
        />
      </div>
    </div>
  );
}

```

<!-- path: hnvtx/app/dashboard/ofc/page.tsx -->
```typescript
'use client';

import React, { useMemo, useState, useCallback } from 'react';
import { createClient } from '@/utils/supabase/client';
import {
  useTableInsert,
  useTableUpdate,
  usePagedOfcCablesComplete,
  Filters,
  convertRichFiltersToSimpleJson,
} from '@/hooks/database';
import { useIsSuperAdmin } from '@/hooks/useAdminUsers';
import { useRouter } from 'next/navigation';

import { DataTable } from '@/components/table/DataTable';
import { ConfirmModal, ErrorDisplay } from '@/components/common/ui';
import { BulkActions } from '@/components/common/BulkActions';
import OfcForm from '@/components/ofc/OfcForm/OfcForm';
import { Json, TablesInsert } from '@/types/supabase-types';
import { OfcCablesWithRelations } from '@/components/ofc/ofc-types';
import { toast } from 'sonner';
import {
  PageHeader,
  useStandardHeaderActions,
} from '@/components/common/PageHeader';
import { AiFillMerge } from 'react-icons/ai';
import { createStandardActions } from '@/components/table/action-helpers';
import {
  DataQueryHookParams,
  DataQueryHookReturn,
  useCrudManager,
} from '@/hooks/useCrudManager';
import { OfcCableRowsWithCount } from '@/types/view-row-types';
import { SearchAndFilters } from '@/components/common/filters/SearchAndFilters';
import { SelectFilter } from '@/components/common/filters/FilterInputs';
import useOrderedColumns from '@/hooks/useOrderedColumns';
import { OfcTableColumns } from '@/config/table-columns/OfcTableColumns';

// 1. ADAPTER HOOK: Makes `useOfcData` compatible with `useCrudManager`
const useOfcData = (
  params: DataQueryHookParams
): DataQueryHookReturn<OfcCableRowsWithCount> => {
  const { currentPage, pageLimit, filters, searchQuery } = params;
  const supabase = createClient();

  // Build the server filters object that the RPC function expects.
  const serverFilters = useMemo(() => {
    const richFilters: Filters = { ...filters };
    if (searchQuery) {
      richFilters.or = `(route_name ILIKE '%${searchQuery}%' OR asset_no ILIKE '%${searchQuery}%' OR transnet_id ILIKE '%${searchQuery}%')`;
    }
    return convertRichFiltersToSimpleJson(richFilters);
  }, [filters, searchQuery]);

  const { data, isLoading, error, refetch } = usePagedOfcCablesComplete(
    supabase,
    {
      filters: serverFilters as Json,
      limit: pageLimit,
      offset: (currentPage - 1) * pageLimit,
    }
  );

  // Calculate counts from the full dataset
  const totalCount = data?.[0]?.total_count || 0;
  const activeCount = data?.[0]?.active_count || 0;
  const inactiveCount = data?.[0]?.inactive_count || 0;

  return {
    data: data || [],
    totalCount,
    activeCount,
    inactiveCount,
    isLoading,
    error,
    refetch,
  };
};

const OfcPage = () => {
  // 2. USE THE CRUD MANAGER with the adapter hook and both generic types
  const {
    data: ofcData,
    totalCount,
    activeCount,
    inactiveCount,
    isLoading,
    isMutating,
    error,
    refetch,
    pagination,
    search,
    filters: crudFilters,
    editModal,
    // viewModal,
    bulkActions,
    deleteModal,
    actions: crudActions,
  } = useCrudManager<'ofc_cables', OfcCableRowsWithCount>({
    tableName: 'ofc_cables',
    dataQueryHook: useOfcData,
    searchColumn: 'route_name', // This can be considered the "primary" search field for display purposes
  });

  // 3. Extract ring types from the rings data
  const ofcTypes = useMemo(() => {
    const uniqueOfcTypes = new Map();
    ofcData.forEach((ofc) => {
      if (ofc.ofc_type_code) {
        uniqueOfcTypes.set(ofc.ofc_type_id, {
          id: ofc.ofc_type_id,
          name: ofc.ofc_type_code,
        });
      }
    });
    return Array.from(uniqueOfcTypes.values());
  }, [ofcData]);

  const maintenanceAreas = useMemo(() => {
    const uniqueMaintenanceAreas = new Map();
    ofcData.forEach((ofc) => {
      if (ofc.maintenance_area_code) {
        uniqueMaintenanceAreas.set(ofc.maintenance_terminal_id, {
          id: ofc.maintenance_terminal_id,
          name: ofc.maintenance_area_code,
        });
      }
    });
    return Array.from(uniqueMaintenanceAreas.values());
  }, [ofcData]);

  const ofcOwners = useMemo(() => {
    const uniqueOwners = new Map();
    ofcData.forEach((ofc) => {
      if (ofc.ofc_owner_code) {
        uniqueOwners.set(ofc.ofc_owner_id, {
          id: ofc.ofc_owner_id,
          ofc_owner_code: ofc.ofc_owner_code,
        });
      }
    });
    return Array.from(uniqueOwners.values());
  }, [ofcData]);

  const supabase = createClient();
  const router = useRouter();
  const [showFilters, setShowFilters] = useState(false);

  const activeFilterCount = Object.values(crudFilters.filters).filter(
    Boolean
  ).length;
  const hasActiveFilters = activeFilterCount > 0 || !!search.searchQuery;

  const handleClearFilters = () => {
    crudFilters.setFilters({});
    search.setSearchQuery('');
  };

  const { data: isSuperAdmin } = useIsSuperAdmin();

  // Memoize the record to prevent unnecessary re-renders
  const memoizedOfcCable = useMemo(
    () => editModal.record as OfcCablesWithRelations | null,
    [editModal.record]
  );

  // --- MUTATIONS ---
  const { mutate: insertOfcCable, isPending: isInserting } = useTableInsert(
    supabase,
    'ofc_cables',
    {
      onSuccess: () => {
        refetch();
        closeModal();
        toast.success('OFC Cable created.');
      },
    }
  );
  const { mutate: updateOfcCable, isPending: isUpdating } = useTableUpdate(
    supabase,
    'ofc_cables',
    {
      onSuccess: () => {
        refetch();
        closeModal();
        toast.success('OFC Cable updated.');
      },
    }
  );

  // --- HANDLERS ---
  const closeModal = useCallback(() => {
    editModal.close();
  }, [editModal]);
  const handleSave = (data: TablesInsert<'ofc_cables'>) => {
    if (editModal.record) {
      updateOfcCable({ id: editModal.record.id!, data });
    } else {
      insertOfcCable(data);
    }
  };

  // --- MEMOIZED VALUES ---
  const columns = OfcTableColumns(ofcData);

  const desiredOrder = [
    'route_name',
    'capacity',
    'ofc_type_code',
    'transnet_id',
    'transnet_rkm',
    'current_rkm',
    'ofc_owner_code',
    'asset_no',
    'maintenance_area_code',
    'commissioned_on',
    'remark',
  ];
  const orderedColumns = useOrderedColumns(columns, desiredOrder);

  const tableActions = useMemo(
    () =>
      createStandardActions({
        onEdit: editModal.openEdit,
        onView: (record) => router.push(`/dashboard/ofc/${record.id}`),
        onDelete: crudActions.handleDelete,
        onToggleStatus: crudActions.handleToggleStatus,
        canDelete: () => isSuperAdmin === true,
      }),
    [crudActions, editModal.openEdit, router, isSuperAdmin]
  );

  const headerStats = [
    { value: totalCount, label: 'Total OFC Cables' },
    {
      value: activeCount,
      label: 'Active',
      color: 'success' as const,
    },
    {
      value: inactiveCount,
      label: 'Inactive',
      color: 'danger' as const,
    },
  ];

  const loading = isLoading || isInserting || isUpdating;

  const headerActions = useStandardHeaderActions({
    onRefresh: async () => {
      await refetch();
      toast.success('Refreshed successfully!');
    },
    onAddNew: editModal.openAdd,
    isLoading: loading,
    exportConfig: {
      tableName: 'ofc_cables',
      filterOptions: [
        {
          label: 'BSNL',
          filters: {
            ofc_owner_id: {
              operator: 'eq',
              value: 'ad3477d5-de78-4b9f-9302-a4b5db326e9f',
            },
          },
        },
        {
          label: 'BBNL',
          filters: {
            ofc_owner_id: {
              operator: 'eq',
              value: 'e40c2549-11ec-485d-a67a-8261fcaec68a',
            },
          },
        },
      ],
    },
  });

  if (error) {
    return (
      <ErrorDisplay
        error={error.message}
        actions={[
          {
            label: 'Retry',
            onClick: refetch,
            variant: 'primary',
          },
        ]}
      />
    );
  }

  return (
    <div className="mx-auto space-y-6 p-4 md:p-6">
      <PageHeader
        title="OFC Cable Management"
        description="Manage OFC cables and their related information."
        icon={<AiFillMerge />}
        stats={headerStats}
        actions={headerActions}
        isLoading={loading}
      />
      <BulkActions
        selectedCount={bulkActions.selectedCount}
        isOperationLoading={isMutating}
        onBulkDelete={() => bulkActions.handleBulkDelete()}
        onBulkUpdateStatus={bulkActions.handleBulkUpdateStatus}
        onClearSelection={bulkActions.handleClearSelection}
        entityName="ofc cable"
        showStatusUpdate={true}
        canDelete={() => isSuperAdmin === true && bulkActions.selectedCount > 0}
      />

      <DataTable
        tableName="v_ofc_cables_complete"
        data={ofcData}
        columns={orderedColumns}
        loading={loading}
        actions={tableActions}
        selectable
        onRowSelect={(selectedRows: OfcCableRowsWithCount[]): void => {
          // Update selection with new row IDs
          bulkActions.handleRowSelect(selectedRows as never);
        }}
        searchable={false}
        filterable={false}
        pagination={{
          current: pagination.currentPage,
          pageSize: pagination.pageLimit,
          total: totalCount,
          showSizeChanger: true,
          onChange: (page, limit) => {
            pagination.setCurrentPage(page);
            pagination.setPageLimit(limit);
          },
        }}
        customToolbar={
          <SearchAndFilters
            searchTerm={search.searchQuery}
            onSearchChange={search.setSearchQuery}
            showFilters={showFilters}
            onToggleFilters={() => setShowFilters((p) => !p)}
            onClearFilters={handleClearFilters}
            hasActiveFilters={hasActiveFilters}
            activeFilterCount={activeFilterCount}
            searchPlaceholder="Search by Asset No or Route Name or Transnet ID..."
          >
            {/* THIS IS THE CLEANER, TYPE-SAFE WAY */}
            <SelectFilter
              label="OFC Type"
              filterKey="ofc_type_id"
              filters={crudFilters.filters}
              setFilters={crudFilters.setFilters}
              options={ofcTypes.map((t) => ({ value: t.id, label: t.name }))}
            />
            <SelectFilter
              label="Status"
              filterKey="status"
              filters={crudFilters.filters}
              setFilters={crudFilters.setFilters}
              options={[
                { value: 'true', label: 'Active' },
                { value: 'false', label: 'Inactive' },
              ]}
            />
            <SelectFilter
              label="ofc_owner"
              filterKey="ofc_owner_id"
              filters={crudFilters.filters}
              setFilters={crudFilters.setFilters}
              options={ofcOwners.map((t) => ({
                value: t.id,
                label: t.ofc_owner_code,
              }))}
            />
            <SelectFilter
              label="Maintenance Terminal"
              filterKey="maintenance_terminal_id"
              filters={crudFilters.filters}
              setFilters={crudFilters.setFilters}
              options={maintenanceAreas.map((t) => ({
                value: t.id,
                label: t.name,
              }))}
            />
          </SearchAndFilters>
        }
      />

      <OfcForm
        isOpen={editModal.isOpen}
        onClose={editModal.close}
        ofcCable={memoizedOfcCable}
        onSubmit={handleSave}
        pageLoading={isMutating}
      />

      <ConfirmModal
        isOpen={deleteModal.isOpen}
        onConfirm={deleteModal.onConfirm}
        onCancel={deleteModal.onCancel}
        title="Confirm Deletion"
        message={deleteModal.message}
        type="danger"
        loading={deleteModal.loading}
        confirmText="Delete"
        cancelText="Cancel"
        showIcon={true}
      />
    </div>
  );
};

export default OfcPage;

```

<!-- path: hnvtx/app/dashboard/layout.tsx -->
```typescript
"use client";

import useIsMobile from "@/hooks/useIsMobile";
import { UserRole } from "@/types/user-roles";
import { useState } from "react";
import { Protected } from "@/components/auth/Protected";
import DashboardContent from "@/components/dashboard/DashboardContent";
import { QueryProvider } from "@/providers/QueryProvider";
import { RouteBasedUploadConfigProvider } from "@/hooks/UseRouteBasedUploadConfigOptions";

interface DashboardLayoutProps {
  children: React.ReactNode;
  showFileUpload?: boolean;
  showColumnManagement?: boolean;
  allowedRoles?: UserRole[];
}

export default function DashboardLayout({
  children,
  showFileUpload = true,
  showColumnManagement = true,
  allowedRoles = [
    UserRole.VIEWER,
    UserRole.ADMIN,
    UserRole.CPANADMIN,
    UserRole.MAANADMIN,
    UserRole.SDHADMIN,
    UserRole.VMUXADMIN,
    UserRole.MNGADMIN,
  ],
}: DashboardLayoutProps) {
  const [isCollapsed, setIsCollapsed] = useState(true);
  const isMobile = useIsMobile();

  // Determine table name based on current route

  return (
    <QueryProvider>
      <Protected allowedRoles={allowedRoles}>
        <RouteBasedUploadConfigProvider
          options={{
            autoSetConfig: true,
            customConfig: {
              // Global defaults that apply to all pages
              isUploadEnabled: true,
            },
          }}
        >
          <div className="min-h-screen bg-gray-50 dark:bg-gray-900 overflow-x-hidden">
            {/* File Upload Provider - conditionally render */}
            {showFileUpload ? (
              <DashboardContent
                isCollapsed={isCollapsed}
                setIsCollapsed={setIsCollapsed}
                isMobile={isMobile}
                showColumnManagement={showColumnManagement}
              >
                {children}
              </DashboardContent>
            ) : (
              <DashboardContent
                isCollapsed={isCollapsed}
                setIsCollapsed={setIsCollapsed}
                isMobile={isMobile}
                showColumnManagement={showColumnManagement}
              >
                {children}
              </DashboardContent>
            )}
          </div>
        </RouteBasedUploadConfigProvider>
      </Protected>
    </QueryProvider>
  );
}

```

<!-- path: hnvtx/app/dashboard/diagrams/page.tsx -->
```typescript
"use client";

// app/diagrams/page.tsx

import dynamic from "next/dynamic";

// Disable SSR for the StorageManager component
const FileUploader = dynamic(
  () => import("@/components/diagrams/FileUploader"),
  { ssr: false },
);

import { useEffect, useState } from "react";
import { createClient } from "@/utils/supabase/client";

export default function Home() {
  const [user, setUser] = useState<any>(null);
  const supabase = createClient();

  useEffect(() => {
    let listener: any;

    async function initSupabase() {
      const { data: { user } = {} } = await supabase.auth.getUser();
      setUser(user ?? null);

      const { data } = supabase.auth.onAuthStateChange(
        (_event: any, session: any) => {
          setUser(session?.user ?? null);
        },
      );
      listener = data;
    }

    initSupabase();

    return () => {
      if (listener?.unsubscribe) {
        listener.unsubscribe();
      }
    };
  }, []);

  return (
    <div className="p-4">
      <h1 className="mb-4 text-2xl font-bold">
        Upload OFC Diagrams
      </h1>
      {!user ? <p>Please log in to upload files.</p> : <FileUploader />}
    </div>
  );
}

```

<!-- path: hnvtx/app/dashboard/ofcadv/page.tsx -->
```typescript
// app/evolve/page.tsx
import { getRoutesForSelection } from '@/components/ofcadv/data';
import RouteManager from '@/components/ofcadv/RouteManager';

export default async function EvolveRoutePage() {
  // This data fetching runs on the server.
  const initialRoutes = await getRoutesForSelection();

  return (
    <div className="max-w-7xl mx-auto p-6">
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-2">
          Route Evolution Manager
        </h1>
      </div>
      {/* The interactive client component receives server-fetched data as a prop */}
      <RouteManager initialRoutes={initialRoutes} />
    </div>
  );
}
```

<!-- path: hnvtx/app/onboarding/onboarding-form-enhanced.tsx -->
```typescript
"use client";

import { useState, useEffect, useCallback } from "react";
import { useAuthStore } from "@/stores/authStore";
import { Database, Json } from "@/types/supabase-types";
import Image from "next/image";
import { createClient } from "@/utils/supabase/client";
import { useGetMyUserDetails, useTableUpdate } from "@/hooks/database";

type ProfileUpdate = Database["public"]["Tables"]["user_profiles"]["Update"];

// Define Address as a type that can be serialized to JSON
type Address = {
  street?: string | null;
  city?: string | null;
  state?: string | null;
  zip_code?: string | null;
  country?: string | null;
};

interface ProfileFormData {
  first_name: string;
  last_name: string;
  avatar_url: string;
  date_of_birth: string;
  designation: string;
  phone_number: string;
  address: Address | null;
  preferences: Json | null;
}

// Helper function to safely get first profile
const getFirstProfile = (profiles: any[] | undefined) => {
  return profiles && profiles.length > 0 ? profiles[0] : null;
};

// Helper function to safely cast to Address
const toAddress = (data: unknown): Address | null => {
  if (!data || typeof data !== "object") return null;
  return data as Address;
};

// Helper function to create initial form data
const createInitialFormData = (): ProfileFormData => ({
  first_name: "",
  last_name: "",
  avatar_url: "",
  date_of_birth: "",
  designation: "",
  phone_number: "",
  address: null,
  preferences: null,
});

export default function OnboardingFormEnhanced() {
  const user = useAuthStore((state) => state.user);
  const supabase = createClient();
  // const updateProfile = useUpdateProfile();
  const [isDirty, setIsDirty] = useState(false);
  const [formData, setFormData] = useState<ProfileFormData>(createInitialFormData);
  const [localError, setLocalError] = useState<Error | null>(null);
  const [isUpdateSuccess, setIsUpdateSuccess] = useState(false);
  
  
  const { data: profiles, isLoading: profileLoading, error: profileError } = useGetMyUserDetails(supabase);

  const { mutate, isPending: updatePending } = useTableUpdate(supabase, "user_profiles", {
    onSuccess: () => {
      setIsDirty(false);
      setIsUpdateSuccess(true);
      setLocalError(null); // Clear any previous errors on success
    },
    onError: (error) => {
      console.log(error);
      setLocalError(error); // Store the error in local state
      setIsUpdateSuccess(false);
    },
  });

  const isLoading = profileLoading || updatePending;

  // Get the first profile safely
  const profile = getFirstProfile(profiles);

  // Initialize form data when profile loads
  useEffect(() => {
    if (profile) {
      // console.log("profile", profile);
      const newFormData: ProfileFormData = {
        first_name: profile.first_name || "",
        last_name: profile.last_name || "",
        avatar_url: profile.avatar_url || "",
        date_of_birth: profile.date_of_birth || "",
        designation: profile.designation || "",
        phone_number: profile.phone_number || "",
        address: toAddress(profile.address),
        preferences: (profile.preferences as Json) || null,
      };
      setFormData(newFormData);
      setIsDirty(false);
    }
  }, [profile]);

  // Memoized reset function
  const resetForm = useCallback(() => {
    if (profile) {
      setFormData({
        first_name: profile.first_name || "",
        last_name: profile.last_name || "",
        avatar_url: profile.avatar_url || "",
        date_of_birth: profile.date_of_birth || "",
        designation: profile.designation || "",
        phone_number: profile.phone_number || "",
        address: toAddress(profile.address),
        preferences: (profile.preferences as Json) || null,
      });
      setIsDirty(false);
    }
  }, [profile]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!isDirty) return;

    try {
      const updates: Partial<ProfileUpdate> = {};

      if (profile) {
        // Compare each field and only update if changed
        if (formData.first_name !== (profile.first_name || "")) {
          updates.first_name = formData.first_name;
        }
        if (formData.last_name !== (profile.last_name || "")) {
          updates.last_name = formData.last_name;
        }
        if (formData.avatar_url !== (profile.avatar_url || "")) {
          updates.avatar_url = formData.avatar_url;
        }
        if (formData.date_of_birth !== (profile.date_of_birth || "")) {
          updates.date_of_birth = formData.date_of_birth;
        }
        if (formData.designation !== (profile.designation || "")) {
          updates.designation = formData.designation;
        }
        if (formData.phone_number !== (profile.phone_number || "")) {
          updates.phone_number = formData.phone_number;
        }

        // Compare address objects
        const currentAddress = toAddress(profile.address) || {};
        const newAddress = formData.address || {};
        if (JSON.stringify(currentAddress) !== JSON.stringify(newAddress)) {
          updates.address = newAddress;
        }

        // Compare preferences objects
        const currentPreferences = (profile.preferences as Json) || {};
        const newPreferences = formData.preferences || {};
        if (JSON.stringify(currentPreferences) !== JSON.stringify(newPreferences)) {
          updates.preferences = newPreferences;
        }
      } else {
        // If no profile exists, create a new one with all form data
        Object.assign(updates, {
          first_name: formData.first_name,
          last_name: formData.last_name,
          avatar_url: formData.avatar_url,
          date_of_birth: formData.date_of_birth,
          designation: formData.designation,
          phone_number: formData.phone_number,
          address: formData.address,
          preferences: formData.preferences,
        });
      }

      if (Object.keys(updates).length > 0) {
        await mutate({
          id: profile.id,
          data: updates,
        });
      }
    } catch (error) {
      console.error("Update failed:", error);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target;
    setFormData((prev) => ({
      ...prev,
      [name]: value,
    }));
    setIsDirty(true);
  };

  const handleAddressChange = (field: keyof Address, value: string) => {
    setFormData((prev) => ({
      ...prev,
      address: {
        ...(prev.address || {}),
        [field]: value,
      },
    }));
    setIsDirty(true);
  };

  // Show loading state
  if (profileLoading) {
    return (
      <div className='animate-pulse space-y-4'>
        <div className='h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4'></div>
        <div className='space-y-3'>
          <div className='h-10 bg-gray-200 dark:bg-gray-700 rounded'></div>
          <div className='h-10 bg-gray-200 dark:bg-gray-700 rounded'></div>
          <div className='h-10 bg-gray-200 dark:bg-gray-700 rounded'></div>
        </div>
      </div>
    );
  }

  // Show error state
  if (profileError) {
    return (
      <div className='p-4 rounded-md bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300'>
        <h3 className='font-medium'>Error loading profile</h3>
        <p className='text-sm mt-1'>{profileError.message}</p>
        <button onClick={() => window.location.reload()} className='mt-3 text-sm underline hover:no-underline text-red-600 dark:text-red-400'>
          Try again
        </button>
      </div>
    );
  }

  return (
    <form onSubmit={handleSubmit} className='space-y-6'>
      {/* Status Messages */}
      {localError && (
        <div className='p-4 rounded-md bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 flex justify-between items-start'>
          <div>
            <h3 className='font-medium'>Update Failed</h3>
            <p className='text-sm mt-1'>{localError.message}</p>
          </div>
          <button type='button' onClick={() => setLocalError(null)} className='text-red-400 hover:text-red-600 dark:hover:text-red-200' aria-label='Dismiss error'>
            ×
          </button>
        </div>
      )}
      {isUpdateSuccess && (
        <div className='p-4 rounded-md bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 flex justify-between items-center'>
          <span className='font-medium'>Profile updated successfully!</span>
          <button type='button' onClick={() => setIsUpdateSuccess(false)} className='text-green-400 hover:text-green-600 dark:hover:text-green-200' aria-label='Dismiss success message'>
            ×
          </button>
        </div>
      )}

      <div className='grid grid-cols-1 gap-6 sm:grid-cols-2'>
        {/* Email - Read Only */}
        <div>
          <label htmlFor='email' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
            Email
          </label>
          <input
            id='email'
            type='email'
            value={user?.email || ""}
            disabled
            className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-400 sm:text-sm'
          />
        </div>

        {/* Phone Number */}
        <div>
          <label htmlFor='phone_number' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
            Phone Number
          </label>
          <input
            id='phone_number'
            name='phone_number'
            type='tel'
            value={formData.phone_number}
            onChange={handleChange}
            placeholder='+1 (555) 123-4567'
            className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100'
          />
        </div>

        {/* First Name */}
        <div>
          <label htmlFor='first_name' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
            First Name <span className='text-red-500'>*</span>
          </label>
          <input
            id='first_name'
            name='first_name'
            type='text'
            required
            value={formData.first_name}
            onChange={handleChange}
            className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100'
          />
        </div>

        {/* Last Name */}
        <div>
          <label htmlFor='last_name' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
            Last Name <span className='text-red-500'>*</span>
          </label>
          <input
            id='last_name'
            name='last_name'
            type='text'
            required
            value={formData.last_name}
            onChange={handleChange}
            className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100'
          />
        </div>

        {/* Designation */}
        <div>
          <label htmlFor='designation' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
            Job Title / Designation
          </label>
          <input
            id='designation'
            name='designation'
            type='text'
            value={formData.designation}
            onChange={handleChange}
            placeholder='e.g. Software Engineer'
            className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100'
          />
        </div>

        {/* Date of Birth */}
        <div>
          <label htmlFor='date_of_birth' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
            Date of Birth
          </label>
          <input
            id='date_of_birth'
            name='date_of_birth'
            type='date'
            value={formData.date_of_birth}
            onChange={handleChange}
            max={new Date().toISOString().split("T")[0]} // Prevent future dates
            className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100'
          />
        </div>

        {/* Avatar URL */}
        <div className='sm:col-span-2'>
          <label htmlFor='avatar_url' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
            Avatar URL
          </label>
          <div className='mt-1 flex rounded-md shadow-sm'>
            <input
              id='avatar_url'
              name='avatar_url'
              type='url'
              value={formData.avatar_url}
              onChange={handleChange}
              placeholder='https://example.com/avatar.jpg'
              className='flex-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-l-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100'
            />
            {formData.avatar_url && (
              <div className='inline-flex items-center px-3 border border-l-0 border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 rounded-r-md'>
                <Image
                  src={formData.avatar_url}
                  alt='Avatar preview'
                  className='h-8 w-8 rounded-full object-cover'
                  width={32}
                  height={32}
                  onError={(e) => {
                    e.currentTarget.style.display = "none";
                  }}
                />
              </div>
            )}
          </div>
        </div>

        {/* Address Section */}
        <div className='sm:col-span-2 space-y-4 border border-gray-200 dark:border-gray-700 p-4 rounded-md bg-gray-50 dark:bg-gray-800'>
          <h3 className='text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center'>
            <svg className='w-4 h-4 mr-2' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
              <path strokeLinecap='round' strokeLinejoin='round' strokeWidth={2} d='M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z' />
              <path strokeLinecap='round' strokeLinejoin='round' strokeWidth={2} d='M15 11a3 3 0 11-6 0 3 3 0 016 0z' />
            </svg>
            Address Information
          </h3>

          <div className='grid grid-cols-1 gap-4 sm:grid-cols-2'>
            <div className='sm:col-span-2'>
              <label htmlFor='address_street' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
                Street Address
              </label>
              <input
                id='address_street'
                type='text'
                value={formData.address?.street || ""}
                onChange={(e) => handleAddressChange("street", e.target.value)}
                placeholder='123 Main Street'
                className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100'
              />
            </div>

            <div>
              <label htmlFor='address_city' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
                City
              </label>
              <input
                id='address_city'
                type='text'
                value={formData.address?.city || ""}
                onChange={(e) => handleAddressChange("city", e.target.value)}
                placeholder='New York'
                className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100'
              />
            </div>

            <div>
              <label htmlFor='address_state' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
                State/Province
              </label>
              <input
                id='address_state'
                type='text'
                value={formData.address?.state || ""}
                onChange={(e) => handleAddressChange("state", e.target.value)}
                placeholder='NY'
                className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100'
              />
            </div>

            <div>
              <label htmlFor='address_postal_code' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
                Postal Code
              </label>
              <input
                id='address_postal_code'
                type='text'
                value={formData.address?.zip_code || ""}
                onChange={(e) => handleAddressChange("zip_code", e.target.value)}
                placeholder='10001'
                className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100'
              />
            </div>

            <div>
              <label htmlFor='address_country' className='block text-sm font-medium text-gray-700 dark:text-gray-300'>
                Country
              </label>
              <input
                id='address_country'
                type='text'
                value={formData.address?.country || ""}
                onChange={(e) => handleAddressChange("country", e.target.value)}
                placeholder='United States'
                className='mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100'
              />
            </div>
          </div>
        </div>
      </div>

      {/* Form Actions */}
      <div className='flex justify-between items-center pt-4 border-t border-gray-200 dark:border-gray-700'>
        <div className='text-sm text-gray-500 dark:text-gray-400'>{isDirty && <span className='text-orange-600 dark:text-orange-400'>● Unsaved changes</span>}</div>
        <div className='flex space-x-3'>
          <button
            type='button'
            onClick={resetForm}
            disabled={!isDirty || updatePending}
            className='px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed'>
            Reset
          </button>
          <button
            type='submit'
            disabled={!isDirty || updatePending}
            className='px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center'>
            {updatePending && (
              <svg className='animate-spin -ml-1 mr-2 h-4 w-4 text-white' fill='none' viewBox='0 0 24 24'>
                <circle className='opacity-25' cx='12' cy='12' r='10' stroke='currentColor' strokeWidth='4' />
                <path className='opacity-75' fill='currentColor' d='M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z' />
              </svg>
            )}
            {updatePending ? "Updating..." : "Update Profile"}
          </button>
        </div>
      </div>
    </form>
  );
}

```

<!-- path: hnvtx/app/onboarding/page.tsx -->
```typescript
"use client";
import Link from "next/link";
import OnboardingFormEnhanced from "./onboarding-form-enhanced";
import { useAuth } from "@/hooks/useAuth";
import { useState } from "react";

export default function OnboardingPage() {
  const { logout } = useAuth();
  const [initialLoading, setInitialLoading] = useState(true);
  

  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-900 flex flex-col">
      {/* Header */}
      <div className="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800">
        <h1 className="text-2xl font-bold text-gray-900 dark:text-white">Update Your Profile</h1>
        <div className="flex items-center gap-4">
          <Link
            href="/dashboard"
            className="text-blue-600 dark:text-blue-400 hover:underline text-sm font-medium"
          >
            Go to Dashboard
          </Link>
          <form onSubmit={logout}>
            <button
              type="submit"
              className="bg-red-600 hover:bg-red-700 dark:hover:bg-red-800 text-white px-4 py-2 rounded-md text-sm font-medium"
            >
              Sign Out
            </button>
          </form>
        </div>
      </div>

      {/* Centered Form */}
      <div className="flex flex-1 items-center justify-center p-4">
        <div className="max-w-md w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6 border border-gray-200 dark:border-gray-700">
          <OnboardingFormEnhanced />
        </div>
      </div>
    </div>
  );
}
```

<!-- path: hnvtx/app/onboarding/layout.tsx -->
```typescript
// app/onboarding/layout.tsx
"use client"

import { Protected } from "@/components/auth/Protected";
import { QueryProvider } from "@/providers/QueryProvider";


export default function AccountLayout({ children }: { children: React.ReactNode }) {
    
  return (
    <QueryProvider><Protected>{children}</Protected></QueryProvider>
  );
}

```

<!-- path: hnvtx/app/layout.tsx -->
```typescript
import type { Metadata, Viewport } from "next";
import localFont from "next/font/local";
import "./globals.css";
import "react-datepicker/dist/react-datepicker.css";
import PolyfillLoader from "@/components/polyfills/PolyfillLoader";
import { ToastProvider } from "@/providers/ToastProvider";
import ThemeProvider from "@/providers/ThemeProvider";

const defaultUrl = process.env.VERCEL_URL
  ? `https://${process.env.VERCEL_URL}`
  : "http://localhost:3000";

// Load the main body font (Inter)
const fontSans = localFont({
  src: "../public/fonts/Inter.woff2",
  display: "swap",
  variable: "--font-sans", // We'll use this for Tailwind's 'sans' class
  preload: true,
  fallback: ["system-ui", "arial"],
});

// Load the secondary heading font (Montserrat)
const fontHeading = localFont({
  src: "../public/fonts/Montserrat.woff2",
  display: "swap",
  variable: "--font-heading", // We'll use this for a custom 'heading' class
  preload: true,
  fallback: ["system-ui", "times new roman"],
});

export const viewport: Viewport = {
  width: "device-width",
  initialScale: 1,
  maximumScale: 1,
  userScalable: false,
  themeColor: [
    { media: "(prefers-color-scheme: light)", color: "cyan" },
    { media: "(prefers-color-scheme: dark)", color: "black" },
  ],
};

export const metadata: Metadata = {
  metadataBase: new URL(defaultUrl),
  applicationName: "Harinavi Transmission Maintenance",
  title: {
    default: "Harinavi Transmission Maintenance",
    template: "%s - PWA App",
  },
  description: "We provide reliable telecom transmission maintenance services.",
  manifest: "/manifest.json",
  appleWebApp: {
    capable: true,
    statusBarStyle: "default",
    title: "Harinavi Transmission Maintenance",
  },
  formatDetection: {
    telephone: false,
  },
  icons: {
    shortcut: "/favicon.ico",
    apple: [{ url: "/icon-192x192.png", sizes: "192x192" }],
    icon: "/favicon.ico",
  },
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body
        className={`${fontSans.variable} ${fontHeading.variable} antialiased`}
      >
        <ThemeProvider>
          <ToastProvider>{children}</ToastProvider>
        </ThemeProvider>
        <PolyfillLoader />
      </body>
    </html>
  );
}

```

<!-- path: hnvtx/config/user-details-config.tsx -->
```typescript
// ==== USER DETAILS MODAL CONFIGURATION ====
import { 
    DetailsModal, 
    defaultFormatters, 
    type HeaderConfig, 
    type SectionConfig 
  } from '@/components/common/ui/Modal/DtailsModal';
  import { 
    FiUser, 
    FiPhone, 
    FiCalendar, 
    FiUserCheck, 
    FiBriefcase, 
    FiMail, 
    FiShield, 
    FiClock, 
    FiSettings, 
    FiMapPin 
  } from "react-icons/fi";
  import { RoleBadge } from "@/components/common/ui/badges/RoleBadge";
  import { StatusBadge } from "@/components/common/ui/badges/StatusBadge";
  
  // User details modal configuration
  export const userDetailsConfig = {
    header: {
      title: (user: any) => {
        const firstName = user.first_name?.trim() || "";
        const lastName = user.last_name?.trim() || "";
        const fullName = `${firstName} ${lastName}`.trim();
        return fullName || "No name provided";
      },
      subtitle: (user: any) => user.email,
      avatar: {
        urlKey: 'avatar_url',
        fallbackText: (user: any) => {
          const firstInitial = user.first_name?.charAt(0)?.toUpperCase() || "";
          const lastInitial = user.last_name?.charAt(0)?.toUpperCase() || "";
          return firstInitial + lastInitial || "?";
        }
      },
      badges: [
        {
          key: 'designation',
          component: (designation: string) => designation ? (
            <span className="px-3 py-1 text-xs font-semibold bg-blue-100 text-blue-800 rounded-full dark:bg-blue-900 dark:text-blue-200">
              {designation}
            </span>
          ) : null
        }
      ]
    } as HeaderConfig,
    sections: [
      {
        title: "Personal Information",
        icon: <FiUser size={20} />,
        fields: [
          {
            key: 'first_name',
            label: 'First Name',
            icon: <FiUser size={18} />
          },
          {
            key: 'last_name',
            label: 'Last Name',
            icon: <FiUser size={18} />
          },
          {
            key: 'email',
            label: 'Email Address',
            icon: <FiMail size={18} />,
            formatter: (email: string, data: any) => defaultFormatters.email(email, data?.is_email_verified)
          },
          {
            key: 'phone_number',
            label: 'Phone Number',
            icon: <FiPhone size={18} />
          },
          {
            key: 'date_of_birth',
            label: 'Date of Birth',
            icon: <FiCalendar size={18} />,
            formatter: defaultFormatters.date
          },
          {
            key: 'designation',
            label: 'Designation',
            icon: <FiBriefcase size={18} />
          }
        ]
      },
      {
        title: "Account Information",
        icon: <FiUserCheck size={20} />,
        fields: [
          {
            key: 'role',
            label: 'Role',
            icon: <FiShield size={18} />,
            formatter: (role: any) => <RoleBadge role={role} />
          },
          {
            key: 'status',
            label: 'Status',
            formatter: (status: string) => <StatusBadge status={status || ""} />
          },
          {
            key: 'created_at',
            label: 'Account Created',
            icon: <FiCalendar size={18} />,
            formatter: defaultFormatters.date
          },
          {
            key: 'last_sign_in_at',
            label: 'Last Sign In',
            icon: <FiClock size={18} />,
            formatter: defaultFormatters.dateTime
          },
          {
            key: 'updated_at',
            label: 'Last Updated',
            icon: <FiClock size={18} />,
            formatter: defaultFormatters.dateTime
          }
        ]
      },
      {
        title: "Address Information",
        icon: <FiMapPin size={20} />,
        condition: (user: any) => user.address && defaultFormatters.address(user.address),
        renderCustom: (user: any) => (
          <div className="p-6 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-850 rounded-2xl border border-gray-200 dark:border-gray-700">
            <p className="text-gray-900 dark:text-white font-medium text-lg leading-relaxed">
              {defaultFormatters.address(user.address)}
            </p>
          </div>
        )
      },
      {
        title: "User Preferences",
        icon: <FiSettings size={20} />,
        condition: (user: any) => user.preferences && Object.keys(user.preferences).length > 0,
        renderCustom: (user: any) => (
          <div className="p-6 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-850 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden">
            {defaultFormatters.json(user.preferences)}
          </div>
        )
      }
    ] as SectionConfig[]
  };

  export const UserDetailsModal = ({ user, onClose, isOpen }: { user: any, onClose: () => void, isOpen: boolean }) => {
    return (
      <DetailsModal
        data={user}
        onClose={onClose}
        isOpen={isOpen}
        config={userDetailsConfig}
      />
    );
  };
```

<!-- path: hnvtx/config/column-orders.ts -->
```typescript
export const desiredCpanConnectionColumnOrder = [
    "customer_name",
    "bandwidth_allocated_mbps",
    "sfp_type_id",
    "sfp_capacity",
    "sfp_port",
    "sfp_serial_no",
    "fiber_in",
    "fiber_out",
    "system_connection_id",
  ];
  
  export const desiredCpanSystemColumnOrder = [
    "area",
    "ring_no",
    "system_id",
  ];
  
  export const desiredEmployeeDesignationColumnOrder = [
    "name",
    "parent_id",
    "status",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredEmployeeColumnOrder = [
    "employee_name",
    "employee_pers_no",
    "employee_designation_id",
    "employee_contact",
    "employee_email",
    "employee_addr",
    "employee_dob",
    "employee_doj",
    "maintenance_terminal_id",
    "remark",
    "status",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredFiberJointConnectionColumnOrder = [
    "joint_id",
    "input_ofc_id",
    "input_fiber_no",
    "output_ofc_id",
    "output_fiber_no",
    "splice_loss_db",
    "logical_path_id",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredFiberJointColumnOrder = [
    "joint_name",
    "joint_category",
    "joint_type",
    "installed_date",
    "node_id",
    "maintenance_area_id",
    "location_description",
    "latitude",
    "longitude",
    "remark",
    "status",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredLogicalFiberPathColumnOrder = [
    "path_name",
    "path_category",
    "path_type",
    "source_system_id",
    "destination_system_id",
    "source_port",
    "destination_port",
    "operational_status_category",
    "operational_status",
    "service_type",
    "bandwidth_gbps",
    "wavelength_nm",
    "total_distance_km",
    "total_loss_db",
    "commissioned_date",
    "remark",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredLookupTypeColumnOrder = [
    "category",
    "name",
    "code",
    "description",
    "sort_order",
    "is_system_default",
    "status",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredMaanConnectionColumnOrder = [
    "customer_name",
    "bandwidth_allocated_mbps",
    "sfp_type_id",
    "sfp_capacity",
    "sfp_port",
    "sfp_serial_no",
    "fiber_in",
    "fiber_out",
    "system_connection_id",
  ];
  
  export const desiredMaanSystemColumnOrder = [
    "area",
    "ring_no",
    "system_id",
  ];
  
  export const desiredMaintenanceAreaColumnOrder = [
    "name",
    "area_type_id",
    "code",
    "parent_id",
    "address",
    "contact_person",
    "contact_number",
    "email",
    "latitude",
    "longitude",
    "status",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredManagementPortColumnOrder = [
    "port_no",
    "name",
    "system_id",
    "node_id",
    "commissioned_on",
    "remark",
    "status",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredNodeColumnOrder = [
    "name",
    "node_type_id",
    "maintenance_terminal_id",
    "latitude",
    "longitude",
    "remark",
    "status",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredOfcCableColumnOrder = [
    "route_name",
    "ofc_type_id",
    "capacity",
    "ofc_owner_id",
    "sn_id",
    "en_id",
    "transnet_id",
    "transnet_rkm",
    "current_rkm",
    "maintenance_terminal_id",
    "asset_no",
    "commissioned_on",
    "remark",
    "status",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredOfcConnectionColumnOrder = [
    "ofc_id",
    "connection_category",
    "connection_type",
    "system_id",
    "fiber_no_sn",
    "fiber_no_en",
    "source_port",
    "destination_port",
    "sn_power_dbm",
    "en_power_dbm",
    "route_loss_db",
    "sn_dom",
    "en_dom",
    "otdr_distance_sn_km",
    "otdr_distance_en_km",
    "logical_path_id",
    "path_segment_order",
    "remark",
    "status",
    "created_at",
    "updated_at",
    "id",
  ];
  
  // "id", "created_at", "updated_at","active_count","inactive_count","maintenance_area_area_type_id","maintenance_area_code","maintenance_area_contact_number","maintenance_area_contact_person","maintenance_area_created_at","maintenance_area_email","maintenance_area_latitude","maintenance_area_longitude","maintenance_area_parent_id","maintenance_area_status","maintenance_area_updated_at","ring_type_category","ring_type_created_at","ring_type_id","ring_type_is_system_default","ring_type_name","ring_type_sort_order","ring_type_status","ring_type_updated_at","total_count","maintenance_terminal_id"
  export const desiredRingColumnOrder = [
    "name",
    "total_nodes",
    "maintenance_area_name",
    "ring_type_code",
    "description",
    "status",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredSdhConnectionColumnOrder = [
    "stm_no",
    "carrier",
    "a_customer",
    "b_customer",
    "a_slot",
    "b_slot",
    "system_connection_id",
  ];
  
  export const desiredSdhNodeAssociationColumnOrder = [
    "sdh_system_id",
    "node_id",
    "node_position",
    "node_ip",
    "id",
  ];
  
  export const desiredSdhSystemColumnOrder = [
    "gne",
    "make",
    "system_id",
  ];
  
  export const desiredSystemConnectionColumnOrder = [
    "system_id",
    "connected_system_id",
    "media_type_id",
    "bandwidth_mbps",
    "sn_id",
    "sn_interface",
    "sn_ip",
    "en_id",
    "en_interface",
    "en_ip",
    "vlan",
    "commissioned_on",
    "remark",
    "status",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredSystemColumnOrder = [
    "system_name",
    "system_type_id",
    "node_id",
    "s_no",
    "ip_address",
    "maintenance_terminal_id",
    "commissioned_on",
    "remark",
    "status",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredUserActivityLogColumnOrder = [
    "user_id",
    "user_role",
    "action_type",
    "table_name",
    "record_id",
    "details",
    "old_data",
    "new_data",
    "created_at",
    "id",
  ];
  
  export const desiredUserProfileColumnOrder = [
    "first_name",
    "last_name",
    "designation",
    "phone_number",
    "email", // Assuming email will be derived from user_profiles_extended or similar
    "role",
    "status",
    "date_of_birth",
    "address",
    "avatar_url",
    "preferences",
    "created_at",
    "updated_at",
    "id",
  ];
  
  export const desiredVmuxConnectionColumnOrder = [
    "c_code",
    "subscriber",
    "channel",
    "tk",
    "system_connection_id",
  ];
  
  export const desiredVmuxSystemColumnOrder = [
    "vm_id",
    "system_id",
  ];
```

<!-- path: hnvtx/config/helper-types.ts -->
```typescript
// config/helpers.ts

import { Database, Tables } from "@/types/supabase-types";
import { TABLES, VIEWS } from "@/config/table-column-keys";

// Database schema types
export type ViewName = keyof Database["public"]["Views"];
export type TableName = keyof Database["public"]["Tables"];

export type TableNames = keyof typeof TABLES;
export type ViewNames = keyof typeof VIEWS;

export type TableOrViewName = TableName | ViewName;

export type CurrentTableName = keyof typeof TABLES;

// A generic Row type helper that works for both tables and views
export type GenericRow<T extends TableOrViewName> = T extends TableName
  ? Tables<T>
  : T extends ViewName
  ? Database["public"]["Views"][T]["Row"]
  : never;

// This Mapped Type now correctly includes both Tables and Views.
export type AllColumnKeys = {
  [K in TableName]: (keyof Tables<K> & string)[];
} & {
  // Add a mapped type for Views. This merges the view keys into the type.
  [K in ViewName]: (keyof Database["public"]["Views"][K]["Row"] & string)[];
};



export type ExcelFormat =
  | "text"
  | "number"
  | "date"
  | "currency"
  | "percentage";
export type ColumnTransform = (value: unknown) => unknown;

export type ColumnMeta = {
  title?: string;
  excelHeader?: string;
  excelFormat?: ExcelFormat;
  transform?: ColumnTransform;
};

export type TableMetaMap = {
  [K in TableName]?: Partial<Record<keyof Tables<K> & string, ColumnMeta>>;
};

export type UploadTableMeta<T extends TableName> = {
  uploadType: "insert" | "upsert";
  conflictColumn?: keyof Tables<T> & string;
  isUploadEnabled?: boolean;
};

export type UploadMetaMap = {
  [K in TableName]?: UploadTableMeta<K>;
};

// export function toTitleCase(str: string): string {
//   return str
//     .replace(/_/g, " ")
//     .replace(/\w\S*/g, (w) => w.charAt(0).toUpperCase() + w.slice(1));
// }





```

<!-- path: hnvtx/config/table-column-keys.ts -->
```typescript
import { toPgBoolean, toPgDate, toTitleCase } from "@/config/helper-functions";
import {
  AllColumnKeys,
  ColumnMeta,
  ColumnTransform,
  GenericRow,
  TableMetaMap,
  TableName,
  TableOrViewName,
  UploadMetaMap,
  UploadTableMeta,
} from "@/config/helper-types";
import { Tables } from "@/types/supabase-types";



export const UPLOAD_TABLE_META: UploadMetaMap = {
  employees: {
    uploadType: "upsert",
    conflictColumn: "employee_pers_no",
    isUploadEnabled: true,
  },
  user_profiles: {
    uploadType: "upsert",
    conflictColumn: "id",
    isUploadEnabled: true,
  },
  lookup_types: {
    uploadType: "upsert",
    conflictColumn: "id",
    isUploadEnabled: true,
  },
  rings: { uploadType: "upsert", conflictColumn: "id", isUploadEnabled: true },
  employee_designations: {
    uploadType: "upsert",
    conflictColumn: "id",
    isUploadEnabled: true,
  },
  maintenance_areas: {
    uploadType: "upsert",
    conflictColumn: "id",
    isUploadEnabled: true,
  },
  ofc_cables: {
    uploadType: "upsert",
    conflictColumn: "id",
    isUploadEnabled: true,
  },
  ofc_connections: {
    uploadType: "upsert",
    conflictColumn: "id",
    isUploadEnabled: true,
  },
  nodes: { uploadType: "upsert", conflictColumn: "id", isUploadEnabled: true },
  systems: {
    uploadType: "upsert",
    conflictColumn: "id",
    isUploadEnabled: true,
  },
};

// Per-table column metadata for UI/export and upload (only override where needed)
export const TABLE_COLUMN_META: TableMetaMap = {
  employees: {
    employee_dob: {
      title: "Employee DOB",
      excelHeader: "Employee DOB",
      transform: toPgDate,
      excelFormat: "date",
    },
    employee_doj: {
      title: "Employee DOJ",
      excelHeader: "Employee DOJ",
      transform: toPgDate,
      excelFormat: "date",
    },
    status: { title: "Status", excelHeader: "Status", transform: toPgBoolean },
  },
  lookup_types: {
    status: { transform: toPgBoolean },
    is_system_default: { transform: toPgBoolean },
  },
  rings: {
    status: { transform: toPgBoolean },
  },
  user_profiles: {
    date_of_birth: { transform: toPgDate, excelFormat: "date" },
  },
  ofc_cables: {
    commissioned_on: { transform: toPgDate, excelFormat: "date" },
    status: { transform: toPgBoolean },
  },
  ofc_connections: {
    en_dom: { transform: toPgDate, excelFormat: "date" },
    sn_dom: { transform: toPgDate, excelFormat: "date" },
    status: { transform: toPgBoolean },
  },
  nodes: {
    status: { transform: toPgBoolean },
  },
  systems: {
    commissioned_on: { transform: toPgDate, excelFormat: "date" },
    status: { transform: toPgBoolean },
  },
};

  // Build UI column configs (lightweight structure; consumer can enrich widths/formats)
  export function buildColumnConfig<T extends TableOrViewName>(tableName: T) {
    const keys = TABLE_COLUMN_KEYS[tableName] as (keyof GenericRow<T> & string)[];
    const meta = (TABLE_COLUMN_META[tableName as TableName] || {}) as Record<
      string,
      ColumnMeta
    >;
    return keys.map((key) => {
      const m = meta[key] || {};
      const title = m.title ?? toTitleCase(key);
      return {
        key,
        dataIndex: key,
        title,
        excelFormat: m.excelFormat,
      };
    });
  }
  // Build upload config from SSOT
  export function buildUploadConfig<T extends TableName>(tableName: T) {
    const keys = TABLE_COLUMN_KEYS[tableName] as (keyof Tables<T> & string)[];
    const meta = (TABLE_COLUMN_META[tableName] || {}) as Record<
      string,
      ColumnMeta
    >;
    const tableMeta = (UPLOAD_TABLE_META[tableName] || {
      uploadType: "upsert",
    }) as UploadTableMeta<T>;
  
    const columnMapping = keys.map((key) => {
      const m = meta[key] || {};
      const excelHeader = m.excelHeader ?? toTitleCase(key);
      // Auto-infer transforms if not explicitly provided
      let transform = m.transform as ColumnTransform | undefined;
      if (!transform) {
        const k = String(key).toLowerCase();
        if (k.endsWith("_at") || k.endsWith("_on") || k.includes("date")) {
          transform = toPgDate;
        } else if (
          k.startsWith("is_") ||
          k.startsWith("has_") ||
          k.startsWith("can_") ||
          k.includes("enabled") ||
          k.includes("active") ||
          k === "status"
        ) {
          transform = toPgBoolean;
        }
      }
      return {
        excelHeader,
        dbKey: key,
        transform,
      };
    });
  
    return {
      tableName,
      columnMapping,
      uploadType: tableMeta.uploadType,
      conflictColumn: tableMeta.conflictColumn,
      isUploadEnabled: tableMeta.isUploadEnabled ?? true,
    };
  }

/**
 * The single source of truth for the default columns to be displayed for each table.
 * This is the ONLY place you need to manually list column names.
 * TypeScript validates this entire object.
 */
export const TABLE_COLUMN_KEYS: AllColumnKeys = {
  // We list all keys for each table here.
  user_profiles: [
    "id",
    "first_name",
    "last_name",
    "phone_number",
    "role",
    "designation",
    "status",
    "avatar_url",
    "date_of_birth",
    "address",
    "preferences",
    "created_at",
    "updated_at",
  ],
  lookup_types: [
    "id",
    "category",
    "name",
    "code",
    "description",
    "sort_order",
    "status",
    "is_system_default",
    "created_at",
    "updated_at",
  ],
  maintenance_areas: [
    "id",
    "code",
    "name",
    "address",
    "email",
    "contact_person",
    "contact_number",
    "latitude",
    "longitude",
    "area_type_id",
    "parent_id",
    "status",
    "created_at",
    "updated_at",
  ],
  employee_designations: [
    "id",
    "name",
    "parent_id",
    "status",
    "created_at",
    "updated_at",
  ],
  employees: [
    "id",
    "employee_pers_no",
    "employee_name",
    "employee_email",
    "employee_dob",
    "employee_doj",
    "employee_contact",
    "employee_addr",
    "employee_designation_id",
    "maintenance_terminal_id",
    "status",
    "remark",
    "created_at",
    "updated_at",
  ],
  rings: [
    "id",
    "name",
    "description",
    "ring_type_id",
    "maintenance_terminal_id",
    "total_nodes",
    "status",
    "created_at",
    "updated_at",
  ],
  nodes: [
    "id",
    "name",
    "node_type_id",
    "maintenance_terminal_id",
    "latitude",
    "longitude",
    "status",
    "remark",
    "created_at",
    "updated_at",
  ],
  ofc_cables: [
    "id",
    "route_name",
    "sn_id",
    "en_id",
    "capacity",
    "ofc_type_id",
    "ofc_owner_id",
    "asset_no",
    "transnet_id",
    "transnet_rkm",
    "current_rkm",
    "maintenance_terminal_id",
    "commissioned_on",
    "status",
    "remark",
    "created_at",
    "updated_at",
  ],
  systems: [
    "id",
    "system_name",
    "s_no",
    "node_id",
    "system_type_id",
    "ip_address",
    "maintenance_terminal_id",
    "commissioned_on",
    "status",
    "remark",
    "created_at",
    "updated_at",
  ],
  ofc_connections: [
    "id",
    "ofc_id",
    "logical_path_id",
    "system_id",
    "fiber_no_sn",
    "fiber_no_en",
    "path_segment_order",
    "connection_type",
    "connection_category",
    "source_port",
    "destination_port",
    "en_dom",
    "sn_dom",
    "otdr_distance_en_km",
    "otdr_distance_sn_km",
    "sn_power_dbm",
    "en_power_dbm",
    "route_loss_db",
    "status",
    "remark",
    "created_at",
    "updated_at",
  ],
  maan_connections: [
    "system_connection_id",
    "customer_name",
    "bandwidth_allocated_mbps",
    "sfp_type_id",
    "sfp_capacity",
    "sfp_serial_no",
    "sfp_port",
    "fiber_in",
    "fiber_out",
  ],
  maan_systems: ["system_id", "area", "ring_no"],
  cpan_systems: ["system_id", "area", "ring_no"],
  cpan_connections: [
    "system_connection_id",
    "customer_name",
    "bandwidth_allocated_mbps",
    "sfp_type_id",
    "sfp_capacity",
    "sfp_serial_no",
    "sfp_port",
    "fiber_in",
    "fiber_out",
  ],
  management_ports: [
    "id",
    "name",
    "port_no",
    "commissioned_on",
    "node_id",
    "system_id",
    "status",
    "remark",
    "created_at",
    "updated_at",
  ],

  sdh_connections: [
    "system_connection_id",
    "stm_no",
    "carrier",
    "a_customer",
    "a_slot",
    "b_customer",
    "b_slot",
  ],
  sdh_node_associations: [
    "id",
    "sdh_system_id",
    "node_id",
    "node_position",
    "node_ip",
  ],
  sdh_systems: ["system_id", "make", "gne"],
  system_connections: [
    "id",
    "system_id",
    "sn_id",
    "en_id",
    "connected_system_id",
    "media_type_id",
    "sn_interface",
    "en_interface",
    "sn_ip",
    "en_ip",
    "vlan",
    "bandwidth_mbps",
    "commissioned_on",
    "status",
    "remark",
    "created_at",
    "updated_at",
  ],
  vmux_connections: [
    "system_connection_id",
    "subscriber",
    "channel",
    "c_code",
    "tk",
  ],
  vmux_systems: ["system_id", "vm_id"],
  fiber_joints: [
    "id",
    "joint_name",
    "joint_category",
    "joint_type",
    "node_id",
    "maintenance_area_id",
    "latitude",
    "longitude",
    "location_description",
    "installed_date",
    "status",
    "remark",
    "created_at",
    "updated_at",
  ],
  logical_fiber_paths: [
    "id",
    "path_name",
    "source_system_id",
    "destination_system_id",
    "path_category",
    "path_type",
    "source_port",
    "destination_port",
    "service_type",
    "operational_status_category",
    "operational_status",
    "commissioned_date",
    "wavelength_nm",
    "bandwidth_gbps",
    "total_distance_km",
    "total_loss_db",
    "remark",
    "created_at",
    "updated_at",
  ],
  fiber_joint_connections: [
    "id",
    "joint_id",
    "input_ofc_id",
    "output_ofc_id",
    "input_fiber_no",
    "output_fiber_no",
    "logical_path_id",
    "splice_loss_db",
    "created_at",
    "updated_at",
  ],
  user_activity_logs: [
    "id",
    "created_at",
    "user_id",
    "user_role",
    "action_type",
    "table_name",
    "record_id",
    "old_data",
    "new_data",
    "details",
  ],
  files: [
    "id",
    "file_name",
    "file_route",
    "file_size",
    "file_type",
    "file_url",
    "folder_id",
    "uploaded_at",
    "user_id"
  ],
  folders: [
    "id",
    "name",
    "user_id",
    "created_at",
  ],

  // ===== Views =====
  v_cable_utilization: [
    "cable_id",
    "route_name",
    "capacity",
    "used_fibers",
    "available_fibers",
    "utilization_percent",
  ],
  v_end_to_end_paths: [
    "path_id",
    "path_name",
    "source_system_id",
    "destination_system_id",
    "operational_status",
    "segment_count",
    "route_names",
    "total_distance_km",
    "total_loss_db",
  ],
  v_ofc_cables_complete: [
    "id",
    "route_name",
    "sn_id",
    "en_id",
    "capacity",
    "ofc_type_id",
    "ofc_type_name",
    "ofc_type_code",
    "ofc_owner_id",
    "ofc_owner_name",
    "ofc_owner_code",
    "asset_no",
    "transnet_id",
    "transnet_rkm",
    "current_rkm",
    "maintenance_terminal_id",
    "maintenance_area_name",
    "maintenance_area_code",
    "commissioned_on",
    "status",
    "remark",
    "created_at",
    "updated_at",
    "total_count",
    "active_count",
    "inactive_count",
  ],
  v_nodes_complete: [
    "id",
    "name",
    "node_type_id",
    "node_type_name",
    "node_type_code",
    "maintenance_terminal_id",
    "maintenance_area_name",
    "maintenance_area_code",
    "maintenance_area_type_name",
    "latitude",
    "longitude",
    "status",
    "remark",
    "created_at",
    "updated_at",
    "total_count",
    "active_count",
    "inactive_count",
  ],
  v_ofc_connections_complete: [
    "connection_category",
    "connection_type",
    "created_at",
    "destination_port",
    "en_dom",
    "en_id",
    "en_name",
    "en_power_dbm",
    "fiber_no_en",
    "fiber_no_sn",
    "id",
    "logical_path_id",
    "maintenance_area_name",
    "ofc_id",
    "ofc_route_name",
    "ofc_type_name",
    "otdr_distance_en_km",
    "otdr_distance_sn_km",
    "path_segment_order",
    "remark",
    "route_loss_db",
    "sn_dom",
    "sn_id",
    "sn_name",
    "sn_power_dbm",
    "source_port",
    "status",
    "system_id",
    "system_name",
    "updated_at",
  ],
  v_system_connections_complete: [
    "id",
    "system_id",
    "system_name",
    "system_type_name",
    "sn_name",
    "sn_node_name",
    "en_name",
    "en_node_name",
    "sn_ip",
    "en_ip",
    "sn_interface",
    "en_interface",
    "media_type_name",
    "bandwidth_mbps",
    "connected_system_name",
    "connected_system_type_name",
    "vlan",
    "commissioned_on",
    "remark",
    "status",
    "created_at",
    "updated_at",
    "maan_sfp_port",
    "maan_sfp_type_name",
    "maan_sfp_capacity",
    "maan_sfp_serial_no",
    "maan_fiber_in",
    "maan_fiber_out",
    "maan_customer_name",
    "maan_bandwidth_allocated_mbps",
    "sdh_stm_no",
    "sdh_carrier",
    "sdh_a_slot",
    "sdh_a_customer",
    "sdh_b_slot",
    "sdh_b_customer",
    "vmux_subscriber",
    "vmux_c_code",
    "vmux_channel",
    "vmux_tk",
  ],
  v_systems_complete: [
    "id",
    "system_name",
    "ip_address",
    "s_no",
    "commissioned_on",
    "remark",
    "status",
    "created_at",
    "updated_at",
    "node_name",
    "latitude",
    "longitude",
    "system_type_name",
    "system_type_code",
    "system_category",
    "maintenance_area_name",
    "maan_ring_no",
    "maan_area",
    "sdh_gne",
    "sdh_make",
    "vmux_vm_id",
  ],
  v_user_profiles_extended: [
    "id",
    "email",
    "last_sign_in_at",
    "created_at",
    "updated_at",
    "auth_updated_at",
    "is_super_admin",
    "is_email_verified",
    "email_confirmed_at",
    "is_phone_verified",
    "phone_confirmed_at",
    "first_name",
    "last_name",
    "full_name",
    "avatar_url",
    "phone_number",
    "date_of_birth",
    "address",
    "preferences",
    "role",
    "designation",
    "status",
    "raw_user_meta_data",
    "raw_app_meta_data",
    "computed_status",
    "account_age_days",
    "last_activity_period",
  ],
  v_lookup_types_with_count: [
    "id",
    "category",
    "name",
    "code",
    "description",
    "sort_order",
    "status",
    "is_system_default",
    "created_at",
    "updated_at",
    "total_count",
    "active_count",
    "inactive_count",
  ],
  v_employee_designations_with_count: [
    "id",
    "name",
    "parent_id",
    "status",
    "created_at",
    "updated_at",
    "total_count",
    "active_count",
    "inactive_count",
  ],
  v_maintenance_areas_with_count: [
    "id",
    "code",
    "name",
    "address",
    "email",
    "contact_person",
    "contact_number",
    "latitude",
    "longitude",
    "area_type_id",
    "parent_id",
    "status",
    "created_at",
    "updated_at",
    "total_count",
    "active_count",
    "inactive_count",
  ],
  v_employees_with_count: [
    "id",
    "employee_pers_no",
    "employee_name",
    "employee_email",
    "employee_dob",
    "employee_doj",
    "employee_contact",
    "employee_addr",
    "employee_designation_id",
    "maintenance_terminal_id",
    "status",
    "remark",
    "created_at",
    "updated_at",
    "total_count",
    "active_count",
    "inactive_count",
  ],
  v_rings_with_count: [
    // from rings r.*
    "id",
    "name",
    "description",
    "ring_type_id",
    "maintenance_terminal_id",
    "total_nodes",
    "status",
    "created_at",
    "updated_at",
  
    // from lookup_types lt_ring
    "ring_type_name",
    "ring_type_code",
    "ring_type_category",
    "ring_type_sort_order",
    "ring_type_is_system_default",
    "ring_type_status",
    "ring_type_created_at",
    "ring_type_updated_at",
  
    // from maintenance_areas ma
    "maintenance_area_name",
    "maintenance_area_code",
    "maintenance_area_email",
    "maintenance_area_contact_person",
    "maintenance_area_contact_number",
    "maintenance_area_latitude",
    "maintenance_area_longitude",
    "maintenance_area_area_type_id",
    "maintenance_area_parent_id",
    "maintenance_area_status",
    "maintenance_area_created_at",
    "maintenance_area_updated_at",
  
    // counts
    "total_count",
    "active_count",
    "inactive_count",
  ]
};

// Separate tables and views for better type safety
export const TABLES = {
  user_profiles: "user_profiles",
  employees: "employees",
  lookup_types: "lookup_types",
  rings: "rings",
  employee_designations: "employee_designations",
  maintenance_areas: "maintenance_areas",
  ofc_cables: "ofc_cables",
  ofc_connections: "ofc_connections",
  nodes: "nodes",
  systems: "systems",
  cpan_connections: "cpan_connections",
  cpan_systems: "cpan_systems",
  fiber_joint_connections: "fiber_joint_connections",
  fiber_joints: "fiber_joints",
  logical_fiber_paths: "logical_fiber_paths",
  maan_connections: "maan_connections",
  maan_systems: "maan_systems",
  management_ports: "management_ports",
  sdh_connections: "sdh_connections",
  sdh_node_associations: "sdh_node_associations",
  sdh_systems: "sdh_systems",
  system_connections: "system_connections",
  user_activity_logs: "user_activity_logs",
  vmux_connections: "vmux_connections",
  vmux_systems: "vmux_systems",
} as const;

// Define views separately
export const VIEWS = {
  v_cable_utilization: "v_cable_utilization",
  v_end_to_end_paths: "v_end_to_end_paths",
  v_nodes_complete: "v_nodes_complete",
  v_ofc_cables_complete: "v_ofc_cables_complete",
  v_ofc_connections_complete: "v_ofc_connections_complete",
  v_system_connections_complete: "v_system_connections_complete",
  v_systems_complete: "v_systems_complete",
  v_user_profiles_extended: "v_user_profiles_extended",
  v_lookup_types_with_count: "v_lookup_types_with_count",
  v_employee_designations_with_count: "v_employee_designations_with_count",
  v_maintenance_areas_with_count: "v_maintenance_areas_with_count",
  v_employees_with_count: "v_employees_with_count",
  v_rings_with_count: "v_rings_with_count",
} as const;

// For backward compatibility, export TABLE_NAMES as a union of tables and views
export const TABLE_NAMES = {
  ...TABLES,
  ...VIEWS,
} as const;

```

<!-- path: hnvtx/config/ofc-details-config.tsx -->
```typescript
// ==== OFC DETAILS MODAL CONFIGURATION ====
import { 
    DetailsModal, 
    defaultFormatters, 
    type HeaderConfig, 
    type SectionConfig 
  } from '@/components/common/ui/Modal/DtailsModal';
  import { 
    FiActivity,
    FiCalendar, 
    FiClock, 
    FiDatabase, 
    FiMapPin, 
    FiInfo,
    FiGitBranch,
    FiTool
  } from "react-icons/fi";
  import { StatusBadge } from "@/components/common/ui/badges/StatusBadge";
import { Row } from '@/hooks/database';
  
  // OFC details modal configuration
  export const ofcDetailsConfig = {
    header: {
      title: (ofc: Row<"v_ofc_cables_complete">) => ofc.route_name || "Unnamed OFC Route",
      subtitle: (ofc: Row<"v_ofc_cables_complete">) => ofc.ofc_owner_name || "Unknown Owner",
      avatar: {
        urlKey: '', // OFC doesn’t have avatars
        fallbackText: (ofc: Row<"v_ofc_cables_complete">) => (ofc.ofc_owner_name?.charAt(0)?.toUpperCase() || "O")
      },
      badges: [
        {
          key: 'ofc_type_name',
          component: (type: string) => type ? (
            <span className="px-3 py-1 text-xs font-semibold bg-purple-100 text-purple-800 rounded-full dark:bg-purple-900 dark:text-purple-200">
              {type}
            </span>
          ) : null
        },
        {
          key: 'status',
          component: (status: boolean) => (
            <StatusBadge status={status ? "ACTIVE" : "INACTIVE"} />
          )
        }
      ]
    } as HeaderConfig,
  
    sections: [
      {
        title: "Route Information",
        icon: <FiGitBranch size={20} />,
        fields: [
          { key: 'route_name', label: 'Route Name', icon: <FiInfo size={18} /> },
          { key: 'asset_no', label: 'Asset No.', icon: <FiDatabase size={18} /> },
          { key: 'sn_id', label: 'SN ID', icon: <FiDatabase size={18} /> },
          { key: 'en_id', label: 'EN ID', icon: <FiDatabase size={18} /> },
          { key: 'transnet_id', label: 'Transnet ID', icon: <FiDatabase size={18} /> }
        ]
      },
      {
        title: "Capacity & Type",
        icon: <FiTool size={20} />,
        fields: [
          { key: 'capacity', label: 'Capacity (Fibers)', icon: <FiActivity size={18} /> },
          { key: 'ofc_type_name', label: 'OFC Type', icon: <FiTool size={18} /> },
          { key: 'ofc_type_code', label: 'OFC Type Code', icon: <FiTool size={18} /> }
        ]
      },
      {
        title: "Ownership & Maintenance",
        icon: <FiMapPin size={20} />,
        fields: [
          { key: 'ofc_owner_name', label: 'Owner', icon: <FiInfo size={18} /> },
          { key: 'ofc_owner_code', label: 'Owner Code', icon: <FiDatabase size={18} /> },
          { key: 'maintenance_area_name', label: 'Maintenance Area', icon: <FiMapPin size={18} /> },
          { key: 'maintenance_area_code', label: 'Area Code', icon: <FiDatabase size={18} /> },
          { key: 'maintenance_terminal_id', label: 'Maintenance Terminal ID', icon: <FiDatabase size={18} /> }
        ]
      },
      {
        title: "Length Information",
        icon: <FiActivity size={20} />,
        fields: [
          { key: 'current_rkm', label: 'Current RKM', icon: <FiActivity size={18} /> },
          { key: 'transnet_rkm', label: 'Transnet RKM', icon: <FiActivity size={18} /> }
        ]
      },
      {
        title: "Commissioning & Timestamps",
        icon: <FiCalendar size={20} />,
        fields: [
          { key: 'commissioned_on', label: 'Commissioned On', icon: <FiCalendar size={18} />, formatter: defaultFormatters.date },
          { key: 'created_at', label: 'Created At', icon: <FiCalendar size={18} />, formatter: defaultFormatters.dateTime },
          { key: 'updated_at', label: 'Updated At', icon: <FiClock size={18} />, formatter: defaultFormatters.dateTime }
        ]
      },
      {
        title: "Counts",
        icon: <FiDatabase size={20} />,
        fields: [
          { key: 'total_count', label: 'Total', icon: <FiDatabase size={18} /> },
          { key: 'active_count', label: 'Active', icon: <FiDatabase size={18} /> },
          { key: 'inactive_count', label: 'Inactive', icon: <FiDatabase size={18} /> }
        ]
      }
    ] as SectionConfig[]
  };
  
  export const OfcDetailsModal = ({ ofc, onClose, isOpen }: { ofc: Row<"v_ofc_connections_complete">[], onClose: () => void, isOpen: boolean }) => {
    return (
      <DetailsModal
        data={ofc}
        onClose={onClose}
        isOpen={isOpen}
        config={ofcDetailsConfig}
      />
    );
  };
  
```

<!-- path: hnvtx/config/employee-details-config.tsx -->
```typescript
// ==== EMPLOYEE DETAILS MODAL CONFIGURATION ====
import { 
    DetailsModal, 
    defaultFormatters, 
    type HeaderConfig, 
    type SectionConfig 
  } from '@/components/common/ui/Modal/DtailsModal';
  import { 
    FiUser, 
    FiPhone, 
    FiMail, 
    FiBriefcase, 
    FiCalendar, 
    FiClock, 
    FiMapPin, 
    FiInfo 
  } from "react-icons/fi";
  import { StatusBadge } from "@/components/common/ui/badges/StatusBadge";
  
  // Employee details modal configuration
  export const employeeDetailsConfig = {
    header: {
      title: (emp: any) => emp.employee_name || "Unnamed Employee",
      subtitle: (emp: any) => emp.employee_pers_no || "No Personnel No.",
      avatar: {
        urlKey: '', // employees don’t have avatars
        fallbackText: (emp: any) => (emp.employee_name?.charAt(0)?.toUpperCase() || "?")
      },
      badges: [
        {
          key: 'employee_designations.name',
          component: (designation: string) => designation ? (
            <span className="px-3 py-1 text-xs font-semibold bg-blue-100 text-blue-800 rounded-full dark:bg-blue-900 dark:text-blue-200">
              {designation}
            </span>
          ) : null
        },
        {
          key: 'status',
          component: (status: boolean) => (
            <StatusBadge status={status ? "ACTIVE" : "INACTIVE"} />
          )
        }
      ]
    } as HeaderConfig,
  
    sections: [
      {
        title: "Personal Information",
        icon: <FiUser size={20} />,
        fields: [
          { key: 'employee_name', label: 'Full Name', icon: <FiUser size={18} /> },
          { key: 'employee_pers_no', label: 'Personnel No.', icon: <FiInfo size={18} /> },
          { key: 'employee_contact', label: 'Contact No.', icon: <FiPhone size={18} /> },
          { 
            key: 'employee_email', 
            label: 'Email Address', 
            icon: <FiMail size={18} />, 
            formatter: (email: string, data: any) => email || "Not Provided" 
          },
          { 
            key: 'employee_dob', 
            label: 'Date of Birth', 
            icon: <FiCalendar size={18} />, 
            formatter: defaultFormatters.date 
          },
          { 
            key: 'employee_doj', 
            label: 'Date of Joining', 
            icon: <FiCalendar size={18} />, 
            formatter: defaultFormatters.date 
          }
        ]
      },
      {
        title: "Employment Details",
        icon: <FiBriefcase size={20} />,
        fields: [
          { 
            key: 'employee_designations.name', 
            label: 'Designation', 
            icon: <FiBriefcase size={18} /> 
          },
          { 
            key: 'maintenance_terminal_id', 
            label: 'Maintenance Terminal ID', 
            icon: <FiInfo size={18} /> 
          },
          { 
            key: 'remark', 
            label: 'Remark', 
            icon: <FiInfo size={18} /> 
          }
        ]
      },
      {
        title: "Address",
        icon: <FiMapPin size={20} />,
        condition: (emp: any) => !!emp.employee_addr,
        renderCustom: (emp: any) => (
          <div className="p-6 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-850 rounded-2xl border border-gray-200 dark:border-gray-700">
            <p className="text-gray-900 dark:text-white font-medium text-lg leading-relaxed">
              {emp.employee_addr}
            </p>
          </div>
        )
      },
      {
        title: "Timestamps",
        icon: <FiCalendar size={20} />,
        fields: [
          { key: 'created_at', label: 'Created At', icon: <FiCalendar size={18} />, formatter: defaultFormatters.dateTime },
          { key: 'updated_at', label: 'Updated At', icon: <FiClock size={18} />, formatter: defaultFormatters.dateTime }
        ]
      }
    ] as SectionConfig[]
  };
  
  export const EmployeeDetailsModal = ({ employee, onClose, isOpen }: { employee: any, onClose: () => void, isOpen: boolean }) => {
    return (
      <DetailsModal
        data={employee}
        onClose={onClose}
        isOpen={isOpen}
        config={employeeDetailsConfig}
      />
    );
  };
  
```

<!-- path: hnvtx/config/constants.ts -->
```typescript
export const DEFAULTS = {
  DEBOUNCE_DELAY: 400,
  PAGE_SIZE: 10,
  PAGE_SIZE_OPTIONS: [10, 20, 50, 100, 500],
};

```

<!-- path: hnvtx/config/node-details-config.tsx -->
```typescript
// ==== NODE DETAILS MODAL CONFIGURATION ====
import { 
  DetailsModal, 
  defaultFormatters, 
  type HeaderConfig, 
  type SectionConfig 
} from '@/components/common/ui/Modal/DtailsModal';
import { 
  FiCpu,
  FiCalendar, 
  FiClock, 
  FiMapPin, 
  FiDatabase, 
  FiServer,
  FiCode,
  FiInfo
} from "react-icons/fi";
import { StatusBadge } from "@/components/common/ui/badges/StatusBadge";
import { NodeRowsWithCount } from '@/types/view-row-types';

// Node details modal configuration
export const nodeDetailsConfig = {
  header: {
    title: (node: NodeRowsWithCount) => node.name || "Unnamed Node",
    avatar: {
      urlKey: '', // nodes probably don’t have avatars
      fallbackText: (node: NodeRowsWithCount) => (node.name?.charAt(0)?.toUpperCase() || "?")
    },
    badges: [
      {
        key: 'node_type_name',
        component: (type: string) => type ? (
          <span className="px-3 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full dark:bg-green-900 dark:text-green-200">
            {type}
          </span>
        ) : null
      },
      {
        key: 'ring_status',
        component: (status: string) => status ? (
          <StatusBadge status={status} />
        ) : null
      }
    ]
  } as HeaderConfig,

  sections: [
    {
      title: "Basic Information",
      icon: <FiCpu size={20} />,
      fields: [
        { key: 'name', label: 'Node Name', icon: <FiServer size={18} /> },
        { key: 'node_type_name', label: 'Node Type', icon: <FiCode size={18} /> },
        { key: 'remark', label: 'Remark', icon: <FiInfo size={18} /> },
      ]
    },
    {
      title: "Maintenance Area",
      icon: <FiMapPin size={20} />,
      fields: [
        { key: 'maintenance_area_code', label: 'Area Code', icon: <FiDatabase size={18} /> },
        { key: 'maintenance_area_name', label: 'Area Name', icon: <FiMapPin size={18} /> },
        { key: 'maintenance_area_type_name', label: 'Area Type', icon: <FiMapPin size={18} /> },
      ]
    },
    {
      title: "Geolocation",
      icon: <FiMapPin size={20} />,
      fields: [
        { key: 'latitude', label: 'Latitude', icon: <FiMapPin size={18} /> },
        { key: 'longitude', label: 'Longitude', icon: <FiMapPin size={18} /> },
      ]
    },
    {
      title: "Timestamps",
      icon: <FiCalendar size={20} />,
      fields: [
        { key: 'created_at', label: 'Created At', icon: <FiCalendar size={18} />, formatter: defaultFormatters.dateTime },
        { key: 'updated_at', label: 'Updated At', icon: <FiClock size={18} />, formatter: defaultFormatters.dateTime }
      ]
    }
  ] as SectionConfig[]
};

export const NodeDetailsModal = ({ node, onClose, isOpen }: { node: NodeRowsWithCount, onClose: () => void, isOpen: boolean }) => {
  return (
    <DetailsModal
      data={node}
      onClose={onClose}
      isOpen={isOpen}
      config={nodeDetailsConfig}
    />
  );
};

```

<!-- path: hnvtx/config/helper-functions.ts -->
```typescript
// Helper: normalize various Excel/CSV date representations to 'YYYY-MM-DD' or null
export const toPgDate = (value: unknown): string | null => {
  if (value === null || value === undefined) return null;
  // Treat empty string as null to avoid Postgres date parse errors
  if (typeof value === "string") {
    const v = value.trim();
    if (v === "") return null;
    // If already in YYYY-MM-DD, return as-is
    if (/^\d{4}-\d{2}-\d{2}$/.test(v)) return v;

    // If the string is a numeric-like Excel serial, treat it as such
    if (/^\d+(?:\.\d+)?$/.test(v)) {
      const num = parseFloat(v);
      if (!isNaN(num)) {
        const ms = Math.round((num - 25569) * 86400 * 1000);
        const d = new Date(ms);
        if (!isNaN(d.getTime())) {
          const yyyy = d.getFullYear();
          const mm = String(d.getMonth() + 1).padStart(2, "0");
          const dd = String(d.getDate()).padStart(2, "0");
          return `${yyyy}-${mm}-${dd}`;
        }
      }
    }

    // Handle common D/M/Y or M/D/Y with optional time "DD/MM/YYYY HH:MM:SS" or "MM/DD/YYYY HH:MM:SS"
    const dmYTime =
      /^(\d{1,2})\/(\d{1,2})\/(\d{4})(?:[ T](\d{1,2}):(\d{2})(?::(\d{2}))?)?$/;
    const match = v.match(dmYTime);
    if (match) {
      const d1 = parseInt(match[1], 10);
      const d2 = parseInt(match[2], 10);
      const yyyy = parseInt(match[3], 10);
      // Disambiguate: if first part > 12 -> DD/MM/YYYY; if second part > 12 -> MM/DD/YYYY; otherwise assume DD/MM/YYYY (common in India)
      const isDMY = d1 > 12 || (d2 <= 12 && d1 <= 12);
      const dd = String(isDMY ? d1 : d2).padStart(2, "0");
      const mm = String(isDMY ? d2 : d1).padStart(2, "0");
      return `${yyyy}-${mm}-${dd}`;
    }

    // Fallback to Date parsing for other formats
    const d = new Date(v);
    if (!isNaN(d.getTime())) {
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      return `${yyyy}-${mm}-${dd}`;
    }
    return null;
  }
  // Excel serial number dates
  if (typeof value === "number") {
    // Excel epoch (days since 1899-12-30). Multiply by ms per day.
    const ms = Math.round((value - 25569) * 86400 * 1000);
    const d = new Date(ms);
    if (!isNaN(d.getTime())) {
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      return `${yyyy}-${mm}-${dd}`;
    }
    return null;
  }
  // Date object
  if (value instanceof Date && !isNaN(value.getTime())) {
    const yyyy = value.getFullYear();
    const mm = String(value.getMonth() + 1).padStart(2, "0");
    const dd = String(value.getDate()).padStart(2, "0");
    return `${yyyy}-${mm}-${dd}`;
  }
  return null;
};

export function toTitleCase(str: string): string {
  if (!str) return "";
  return str
    .replace(/_/g, " ")
    .replace(/([A-Z])/g, " $1")
    .replace(/\b\w/g, (char) => char.toUpperCase())
    .trim();
}

export function inferExcelFormat(
  columnName: string
): "text" | "number" | "date" | "currency" | "percentage" | "json" {
  const name = columnName.toLowerCase();
  if (
    name.endsWith("_at") ||
    name.endsWith("_on") ||
    name.endsWith("dob") ||
    name.endsWith("doj") ||
    name.includes("date")
  )
    return "date";
  if (
    name.includes("amount") ||
    name.includes("price") ||
    name.includes("total") ||
    name.includes("rkm") ||
    name.includes("mbps")
  )
    return "number";
  if (name.includes("percent")) return "percentage";
  // common JSON-like columns
  if (
    name.includes("address") ||
    name.includes("preference") ||
    name.includes("metadata") ||
    name.includes("meta_data") ||
    name.includes("raw_user_meta_data") ||
    name.includes("raw_app_meta_data") ||
    name.endsWith("_json") ||
    name.includes("json")
  )
    return "json";
  return "text";
}

// Helper: normalize boolean-like values to true/false or null
export const toPgBoolean = (value: unknown): boolean | null => {
  if (value === null || value === undefined) return null;
  if (typeof value === "boolean") return value;
  if (typeof value === "number") {
    if (value === 1) return true;
    if (value === 0) return false;
  }
  if (typeof value === "string") {
    const v = value.trim().toLowerCase();
    if (v === "") return null;
    if (["true", "t", "1", "yes", "y"].includes(v)) return true;
    if (["false", "f", "0", "no", "n"].includes(v)) return false;
  }
  return null;
};

/**
 * Dynamically calculates the width of a column based on its content.
 * 
 * @param columnName - The name of the column
 * @param rows - The table data (array of objects from Supabase)
 * @param ctx - Optional CanvasRenderingContext2D for measuring text width
 * @returns A number representing the width in pixels (capped at 300px)
 */
export function inferDynamicColumnWidth(
  columnName: string,
  rows: Record<string, any>[],
  ctx?: CanvasRenderingContext2D
): number {
  const MIN_WIDTH = 120;
  const MAX_WIDTH = 400;
  const PADDING = 32; // left + right cell padding
  
  // fallback font if no canvas context provided
  if (!ctx) {
    const canvas = document.createElement("canvas");
    ctx = canvas.getContext("2d")!;
    ctx.font = "14px Inter, sans-serif"; // match your table CSS font
  }

  // measure header
  let maxWidth = ctx.measureText(columnName).width;

  // measure each row cell
  for (const row of rows) {
    const value = row[columnName];
    if (value == null) continue;
    const text = String(value);
    const width = ctx.measureText(text).width;
    if (width > maxWidth) {
      maxWidth = width;
    }
  }

  // add padding and clamp
  return Math.min(Math.max(Math.ceil(maxWidth) + PADDING, MIN_WIDTH), MAX_WIDTH);
}


```

<!-- path: hnvtx/config/table-columns/OfcDetailsTableColumns.tsx -->
```typescript
import { Row } from '@/hooks/database';
import { useDynamicColumnConfig } from '@/hooks/useColumnConfig';
import { formatDate } from '@/utils/formatters';

export const OfcDetailsTableColumns = (
  data: Row<'v_ofc_connections_complete'>[]
) => {
  return useDynamicColumnConfig('v_ofc_connections_complete', {
    data: data,

    omit: [
      'id',
      'ofc_id',
      'created_at',
      'updated_at',
      'sn_id',
      'en_id',
      'connection_category',
      'connection_type',
      'destination_port',
      'en_name',
      'logical_path_id',
      'path_segment_order',
      'sn_name',
      'source_port',
      'system_id',
      'system_name',
    ],
    overrides: {
      fiber_no_sn: { 
        title: 'End A Fiber', 
        sortable: true, 
        searchable: true,
        excelFormat: 'number',
        render: (value) => {
          if (value === null || value === undefined) return '';
          return String(value);
        }
      },
      fiber_no_en: { 
        title: 'End B Fiber', 
        sortable: true, 
        searchable: true,
        excelFormat: 'number',
        render: (value) => {
          if (value === null || value === undefined) return '';
          return String(value);
        }
      },
      otdr_distance_sn_km: {
        title: 'End A OTDR Distance (km)',
        sortable: true,
        searchable: true,
      },
      otdr_distance_en_km: {
        title: 'End B OTDR Distance (km)',
        sortable: true,
        searchable: true,
      },
      en_dom: { title: 'End B D.O.M.', sortable: true, width: '150px', searchable: true, render: (value) => formatDate(value as string, { format: 'dd-mm-yyyy' }) },
      en_power_dbm: {
        title: 'End B Power (dBm)',
        sortable: true,
        searchable: true,
      },
      sn_dom: { title: 'End A D.O.M.', sortable: true, width: '150px', searchable: true, render: (value) => formatDate(value as string, { format: 'dd-mm-yyyy' }) },
      sn_power_dbm: {
        title: 'End A Power (dBm)',
        sortable: true,
        searchable: true,
      },
      route_loss_db: {
        title: 'Route Loss (dB)',
        sortable: true,
        searchable: true,
      },
      connection_type: {
        title: 'Connection Type',
        sortable: true,
        searchable: true,
      },
      ofc_type_name: { title: 'Ofc Type', sortable: true, searchable: true },
      destination_port: {
        title: 'Destination Port',
        sortable: true,
        searchable: true,
      },
      logical_path_id: {
        title: 'Logical Path ID',
        sortable: true,
        searchable: true,
      },
      ofc_id: { title: 'OFC ID', sortable: true, searchable: true },
      path_segment_order: {
        title: 'Path Segment Order',
        sortable: true,
        searchable: true,
      },
      remark: { title: 'Remark', sortable: true, searchable: true },
      source_port: { title: 'Source Port', sortable: true, searchable: true },
      system_id: { title: 'System ID', sortable: true, searchable: true },
      updated_at: { title: 'Updated At', sortable: true, searchable: true },
      status: {
        title: 'Status',
        sortable: true,
        searchable: true,
        render: (value) => (
          <span
            className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
              value ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
            }`}
          >
            {value ? 'Active' : 'Inactive'}
          </span>
        ),
      },
    },
  });
};

```

<!-- path: hnvtx/config/table-columns/NodesTableColumns.tsx -->
```typescript
import { Row } from '@/hooks/database';
import { useDynamicColumnConfig } from '@/hooks/useColumnConfig';
import TruncateTooltip from '@/components/common/TruncateTooltip';
import { NodeRowsWithCount } from '@/types/view-row-types';
import { StatusBadge } from '@/components/common/ui';

export const NodesTableColumns = (data: Row<'v_nodes_complete'>[]) => {
  return useDynamicColumnConfig('v_nodes_complete', {
    data: data,
    omit: [
      'node_type_id',
      'node_type_code',
      'maintenance_area_code',
      'id',
      'maintenance_terminal_id',
      'created_at',
      'updated_at',
      'total_count',
      'active_count',
      'inactive_count',
    ],
    overrides: {
      name: {
        render: (value: unknown) => {
          return (
            <TruncateTooltip
              text={(value as string) ?? ''}
              className="font-semibold"
            />
          );
        },
      },
      maintenance_area_name: {
        title: 'Maintenance Area',
        render: (_value: unknown, record: NodeRowsWithCount) => {
          const rel = record.maintenance_area_name;
          return (
            <TruncateTooltip text={rel ?? 'N/A'} className="font-semibold" />
          );
        },
      },
      status: {
        render: (value: unknown) => {
          return <StatusBadge status={value as string} />;
        },
      },
    },
  });
};

```

<!-- path: hnvtx/config/table-columns/UsersTableColumns.tsx -->
```typescript
import Image from 'next/image';
import {StatusBadge} from '@/components/common/ui/badges/StatusBadge';
import { useDynamicColumnConfig } from "@/hooks/useColumnConfig";
import { formatDate } from "@/utils/formatters";
import { RoleBadge } from '@/components/common/ui';
import { UserRole } from '@/types/user-roles';
import { renderKeyValueCell } from '@/utils/renderKeyValueCell';
import { UserProfileData } from '@/components/users/user-types';
import TruncateTooltip from '@/components/common/TruncateTooltip';

export const UserProfileColumns = (data:UserProfileData[]) => {
  return useDynamicColumnConfig("v_user_profiles_extended", {
    data:data,
    omit: ["id", "created_at", "updated_at", "auth_updated_at", "email_confirmed_at", "raw_user_meta_data", "raw_app_meta_data", "phone_confirmed_at", "first_name", "last_name", "is_phone_verified", "computed_status"],
    overrides: {
      last_sign_in_at: {
        render: (value) => {
          return formatDate(value as string, { format: "dd-mm-yyyy" });
        },
      },
      status: {
        render: (value) => {
          return <StatusBadge status={value as string} />;
        },
      },
      date_of_birth: {
        render: (value) => {
          return formatDate(value as string, { format: "dd-mm-yyyy" });
        },
      },
      avatar_url: {
        render: (value) => {
          return value ? (
            <><Image src={value as string} alt='Avatar' className='w-10 h-10 rounded-full' width={40} height={40} /> <TruncateTooltip text={value as string} className="font-semibold" /></>
          ) : (
            <><Image src='/default-avatar.png' alt='Avatar' className='w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-700' width={40} height={40} /> <TruncateTooltip text={value as string} className="font-semibold" /></>
          );
        },
      },
      role: {
        render: (value) => {
          return <RoleBadge role={value as UserRole} />;
        },
      },
      address: {
        render: (value) => renderKeyValueCell(value),
      },
      preferences: {
        render: (value) => renderKeyValueCell(value),
      },
    },
  });
};
```

<!-- path: hnvtx/config/table-columns/RingsTableColumns.tsx -->
```typescript
import { StatusBadge } from "@/components/common/ui/badges/StatusBadge";
import { useDynamicColumnConfig } from "@/hooks/useColumnConfig";
import { RingTypeRowsWithCount } from "@/types/view-row-types";
import { TruncateTooltip } from "@/components/common/TruncateTooltip";
import { Row } from "@/hooks/database";

export const RingsColumns = (data: Row<"v_rings_with_count">[]) => {
  return useDynamicColumnConfig("v_rings_with_count", {
    data: data,
    omit: [
      "id",
      "created_at",
      "updated_at",
      "active_count",
      "inactive_count",
      "maintenance_area_area_type_id",
      "maintenance_area_code",
      "maintenance_area_contact_number",
      "maintenance_area_contact_person",
      "maintenance_area_created_at",
      "maintenance_area_email",
      "maintenance_area_latitude",
      "maintenance_area_longitude",
      "maintenance_area_parent_id",
      "maintenance_area_status",
      "maintenance_area_updated_at",
      "ring_type_category",
      "ring_type_created_at",
      "ring_type_id",
      "ring_type_is_system_default",
      "ring_type_name",
      "ring_type_sort_order",
      "ring_type_status",
      "ring_type_updated_at",
      "total_count",
      "maintenance_terminal_id",
    ],
    overrides: {
      name: {
        render: (value: unknown) => {
          return <TruncateTooltip text={(value as string) ?? ""} className='font-semibold' />;
        },
      },
      description: {
        title: "Description",
        render: (value: unknown) => {
          return <TruncateTooltip text={(value as string) ?? ""} className='font-semibold' />;
        },
      },
      total_nodes: {
        title: "Total Nodes",
        render: (value: unknown) => {
          return <span className='font-semibold'>{value as string}</span>;
        },
      },
      ring_type_code: {
        title: "Ring Type",
        render: (_value: unknown, record: RingTypeRowsWithCount) => {
          const rel = record.ring_type_code;
          return <TruncateTooltip text={rel ?? "N/A"} className='font-semibold' />;
        },
      },
      maintenance_area_name: {
        title: "Maintenance Area",
        render: (_value: unknown, record: RingTypeRowsWithCount) => {
          const rel = record.maintenance_area_name;
          return <TruncateTooltip text={rel ?? "N/A"} className='font-semibold' />;
        },
      },
      status: {
        render: (value: unknown) => {
          return <StatusBadge status={value as string} />;
        },
      },
    },
  });
};

```

<!-- path: hnvtx/config/table-columns/OfcTableColumns.tsx -->
```typescript
import { Row } from '@/hooks/database';
import { useDynamicColumnConfig } from '@/hooks/useColumnConfig';
import TruncateTooltip from '@/components/common/TruncateTooltip';
import { StatusBadge } from '@/components/common/ui';
import { formatDate } from '@/utils/formatters';

export const OfcTableColumns = (data: Row<'v_ofc_cables_complete'>[]) => {
  return useDynamicColumnConfig('v_ofc_cables_complete', {
    data: data,

    omit: [
      'active_count',
      'created_at',
      'en_id',
      'id',
      'inactive_count',
      'maintenance_area_name',
      'maintenance_terminal_id',
      'ofc_owner_id',
      'ofc_owner_name',
      'ofc_type_id',
      'ofc_type_name',
      'sn_id',
      'total_count',
      'updated_at',
      'status'
    ],
    overrides: {
      asset_no: {
        render: (value: unknown) => {
          return (
            <TruncateTooltip
              text={(value as string) ?? ''}
              className="font-semibold"
            />
          );
        },
      },
      route_name: {
        title: 'Route',
        render: (_value: unknown, record: Row<'v_ofc_cables_complete'>) => {
          const rel = record.route_name;
          return (
            <TruncateTooltip text={rel ?? 'N/A'} className="font-semibold" />
          );
        },
      },
      maintenance_area_name: {
        title: 'Maintenance Area',
        render: (_value: unknown, record: Row<'v_ofc_cables_complete'>) => {
          const rel = record.maintenance_area_name;
          return (
            <TruncateTooltip text={rel ?? 'N/A'} className="font-semibold" />
          );
        },
      },
      commissioned_on: {
        render: (value: unknown) => {
          return formatDate(value as string, { format: 'dd-mm-yyyy' });
        },
      },
      status: {
        render: (value: unknown) => {
          return <StatusBadge status={value as string} />;
        },
      },
    },
  });
};

```

<!-- path: hnvtx/config/table-columns/SystemsTableColumns.tsx -->
```typescript
import { Row } from '@/hooks/database';
import { useDynamicColumnConfig } from '@/hooks/useColumnConfig';
import TruncateTooltip from '@/components/common/TruncateTooltip';
import { StatusBadge } from '@/components/common/ui';
import { FiMapPin } from 'react-icons/fi';
import { formatDate } from '@/utils/formatters';

export const SystemsTableColumns = (data: Row<'v_systems_complete'>[]) => {
  return useDynamicColumnConfig('v_systems_complete', {
    data: data,
    omit: [
 
    ],
    overrides: {
      system_name:{
            key: "system_name",
            title: "Name",
            dataIndex: "system_name",
            sortable: true,
            searchable: true,
            filterable: true,
            width: 200,
            render: (value: unknown, record: Row<'v_systems_complete'>) => {
              const stringValue = value as string; // Type assertion since we know it will be a string
              return (
                <div className='flex flex-col'>
                  <span className='font-medium text-gray-900 dark:text-white'>{stringValue}</span>
                  <span className='text-xs text-gray-500 dark:text-gray-400'>S/N: {record.s_no}</span>
                </div>
              );
            },
          },
          system_type_name:{
            key: "system_type_name",
            title: "Type",
            dataIndex: "system_type_name",
            sortable: true,
            searchable: true,
            filterable: true,
            width: 150,
          },
          node_name:{
            key: "node_name",
            title: "Node / Location",
            dataIndex: "node_name",
            sortable: true,
            searchable: true,
            filterable: true,
            width: 150,
            render: (value) => (
              <div className="flex items-center gap-1">
                <FiMapPin className="h-3 w-3 text-gray-400" />
                <span>{value as string || "N/A"}</span>
              </div>
            ),
          },
          ip_address:{
            key: "ip_address",
            title: "IP Address",
            dataIndex: "ip_address",
            sortable: true,
            searchable: true,
            filterable: true,
            width: 150,
            render: (value: unknown) => (
              <code className="rounded bg-gray-100 px-2 py-1 text-sm dark:bg-gray-700">
                {value as string || "N/A"}
              </code>
            ),
          },
          status:{
            key: "status",
            title: "Status",
            dataIndex: "status",
            sortable: true,
            searchable: true,
            filterable: true,
            width: 150,
            render: (value) => <StatusBadge status={value as boolean} />
          },
          commissioned_on:{
            key: "commissioned_on",
            title: "Commissioned On",
            dataIndex: "commissioned_on",
            sortable: true,
            searchable: true,
            filterable: true,
            width: 150,
            render: (value) => formatDate(value as string, { format: 'dd-mm-yyyy' }),
          }
    },
  });
};

```

<!-- path: hnvtx/config/areas.ts -->
```typescript
// config/designations.ts

import { EntityConfig } from "@/components/common/entity-management/types";
import { FiBriefcase } from "react-icons/fi";
import { Tables, TablesInsert } from "@/types/supabase-types";

// --- TYPE DEFINITIONS ---
export type MaintenanceArea = Tables<"maintenance_areas">;

export type AreaType = Tables<"lookup_types">;

export interface MaintenanceAreaWithRelations extends MaintenanceArea {
  area_type: AreaType | null;
  parent_area: MaintenanceAreaWithRelations | null;
  child_areas: MaintenanceAreaWithRelations[];
}

export interface DeleteProps {
  tableName: string;
  onSuccess?: () => void;
}

export interface AreaFormModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSubmit: (data: TablesInsert<"maintenance_areas">) => void;
  area: MaintenanceAreaWithRelations | null;
  allAreas: MaintenanceArea[];
  areaTypes: AreaType[];
  isLoading: boolean;
}

export interface DetailItemProps {
  label: string;
  value: string | null | undefined;
  icon?: React.ReactNode;
}

export const areaConfig: EntityConfig<MaintenanceAreaWithRelations> = {
  entityName: 'area',
  entityDisplayName: 'Area',
  entityPluralName: 'Areas',
  parentField: 'parent_area',
  icon: FiBriefcase,
  isHierarchical: true,
  searchFields: ['name'],
  detailFields: [
    { key: 'name', label: 'Name', type: 'text' },
    { key: 'status', label: 'Status', type: 'status' },
    { 
      key: 'parent_area', 
      label: 'Parent Area', 
      type: 'parent' 
    },
    { key: 'created_at', label: 'Created At', type: 'date' },
  ],
  filterOptions: [
    {
      key: 'status',
      label: 'Status',
      type: 'select',
      options: [
        { value: '', label: 'All Status' },
        { value: 'true', label: 'Active' },
        { value: 'false', label: 'Inactive' },
      ],
    },
  ],
};
```

<!-- path: hnvtx/config/designations.ts -->
```typescript
// config/designations.ts

import { EntityConfig } from "@/components/common/entity-management/types";
import { FiBriefcase } from "react-icons/fi";
import { Tables } from "@/types/supabase-types";

// --- TYPE DEFINITIONS ---
export type EmployeeDesignation = Tables<"employee_designations">;

export interface DesignationWithRelations extends EmployeeDesignation {
  parent_designation: EmployeeDesignation | null;
  child_designations: DesignationWithRelations[];
}

export const designationConfig: EntityConfig<DesignationWithRelations> = {
  entityName: 'designation',
  entityDisplayName: 'Designation',
  entityPluralName: 'Designations',
  parentField: 'parent_designation',
  icon: FiBriefcase,
  isHierarchical: true,
  searchFields: ['name'],
  detailFields: [
    { key: 'name', label: 'Name', type: 'text' },
    { key: 'status', label: 'Status', type: 'status' },
    { 
      key: 'parent_designation', 
      label: 'Parent Designation', 
      type: 'parent' 
    },
    { key: 'created_at', label: 'Created At', type: 'date' },
  ],
  filterOptions: [
    {
      key: 'status',
      label: 'Status',
      type: 'select',
      options: [
        { value: '', label: 'All Status' },
        { value: 'true', label: 'Active' },
        { value: 'false', label: 'Inactive' },
      ],
    },
  ],
};
```

<!-- path: hnvtx/types/supabase-types.ts -->
```typescript
export type Json =
  | string
  | number
  | boolean
  | null
  | { [key: string]: Json | undefined }
  | Json[]

export type Database = {
  // Allows to automatically instantiate createClient with right options
  // instead of createClient<Database, { PostgrestVersion: 'XX' }>(URL, KEY)
  __InternalSupabase: {
    PostgrestVersion: "12.2.3 (519615d)"
  }
  auth: {
    Tables: {
      audit_log_entries: {
        Row: {
          created_at: string | null
          id: string
          instance_id: string | null
          ip_address: string
          payload: Json | null
        }
        Insert: {
          created_at?: string | null
          id: string
          instance_id?: string | null
          ip_address?: string
          payload?: Json | null
        }
        Update: {
          created_at?: string | null
          id?: string
          instance_id?: string | null
          ip_address?: string
          payload?: Json | null
        }
        Relationships: []
      }
      flow_state: {
        Row: {
          auth_code: string
          auth_code_issued_at: string | null
          authentication_method: string
          code_challenge: string
          code_challenge_method: Database["auth"]["Enums"]["code_challenge_method"]
          created_at: string | null
          id: string
          provider_access_token: string | null
          provider_refresh_token: string | null
          provider_type: string
          updated_at: string | null
          user_id: string | null
        }
        Insert: {
          auth_code: string
          auth_code_issued_at?: string | null
          authentication_method: string
          code_challenge: string
          code_challenge_method: Database["auth"]["Enums"]["code_challenge_method"]
          created_at?: string | null
          id: string
          provider_access_token?: string | null
          provider_refresh_token?: string | null
          provider_type: string
          updated_at?: string | null
          user_id?: string | null
        }
        Update: {
          auth_code?: string
          auth_code_issued_at?: string | null
          authentication_method?: string
          code_challenge?: string
          code_challenge_method?: Database["auth"]["Enums"]["code_challenge_method"]
          created_at?: string | null
          id?: string
          provider_access_token?: string | null
          provider_refresh_token?: string | null
          provider_type?: string
          updated_at?: string | null
          user_id?: string | null
        }
        Relationships: []
      }
      identities: {
        Row: {
          created_at: string | null
          email: string | null
          id: string
          identity_data: Json
          last_sign_in_at: string | null
          provider: string
          provider_id: string
          updated_at: string | null
          user_id: string
        }
        Insert: {
          created_at?: string | null
          email?: string | null
          id?: string
          identity_data: Json
          last_sign_in_at?: string | null
          provider: string
          provider_id: string
          updated_at?: string | null
          user_id: string
        }
        Update: {
          created_at?: string | null
          email?: string | null
          id?: string
          identity_data?: Json
          last_sign_in_at?: string | null
          provider?: string
          provider_id?: string
          updated_at?: string | null
          user_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "identities_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "users"
            referencedColumns: ["id"]
          },
        ]
      }
      instances: {
        Row: {
          created_at: string | null
          id: string
          raw_base_config: string | null
          updated_at: string | null
          uuid: string | null
        }
        Insert: {
          created_at?: string | null
          id: string
          raw_base_config?: string | null
          updated_at?: string | null
          uuid?: string | null
        }
        Update: {
          created_at?: string | null
          id?: string
          raw_base_config?: string | null
          updated_at?: string | null
          uuid?: string | null
        }
        Relationships: []
      }
      mfa_amr_claims: {
        Row: {
          authentication_method: string
          created_at: string
          id: string
          session_id: string
          updated_at: string
        }
        Insert: {
          authentication_method: string
          created_at: string
          id: string
          session_id: string
          updated_at: string
        }
        Update: {
          authentication_method?: string
          created_at?: string
          id?: string
          session_id?: string
          updated_at?: string
        }
        Relationships: [
          {
            foreignKeyName: "mfa_amr_claims_session_id_fkey"
            columns: ["session_id"]
            isOneToOne: false
            referencedRelation: "sessions"
            referencedColumns: ["id"]
          },
        ]
      }
      mfa_challenges: {
        Row: {
          created_at: string
          factor_id: string
          id: string
          ip_address: unknown
          otp_code: string | null
          verified_at: string | null
          web_authn_session_data: Json | null
        }
        Insert: {
          created_at: string
          factor_id: string
          id: string
          ip_address: unknown
          otp_code?: string | null
          verified_at?: string | null
          web_authn_session_data?: Json | null
        }
        Update: {
          created_at?: string
          factor_id?: string
          id?: string
          ip_address?: unknown
          otp_code?: string | null
          verified_at?: string | null
          web_authn_session_data?: Json | null
        }
        Relationships: [
          {
            foreignKeyName: "mfa_challenges_auth_factor_id_fkey"
            columns: ["factor_id"]
            isOneToOne: false
            referencedRelation: "mfa_factors"
            referencedColumns: ["id"]
          },
        ]
      }
      mfa_factors: {
        Row: {
          created_at: string
          factor_type: Database["auth"]["Enums"]["factor_type"]
          friendly_name: string | null
          id: string
          last_challenged_at: string | null
          phone: string | null
          secret: string | null
          status: Database["auth"]["Enums"]["factor_status"]
          updated_at: string
          user_id: string
          web_authn_aaguid: string | null
          web_authn_credential: Json | null
        }
        Insert: {
          created_at: string
          factor_type: Database["auth"]["Enums"]["factor_type"]
          friendly_name?: string | null
          id: string
          last_challenged_at?: string | null
          phone?: string | null
          secret?: string | null
          status: Database["auth"]["Enums"]["factor_status"]
          updated_at: string
          user_id: string
          web_authn_aaguid?: string | null
          web_authn_credential?: Json | null
        }
        Update: {
          created_at?: string
          factor_type?: Database["auth"]["Enums"]["factor_type"]
          friendly_name?: string | null
          id?: string
          last_challenged_at?: string | null
          phone?: string | null
          secret?: string | null
          status?: Database["auth"]["Enums"]["factor_status"]
          updated_at?: string
          user_id?: string
          web_authn_aaguid?: string | null
          web_authn_credential?: Json | null
        }
        Relationships: [
          {
            foreignKeyName: "mfa_factors_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "users"
            referencedColumns: ["id"]
          },
        ]
      }
      one_time_tokens: {
        Row: {
          created_at: string
          id: string
          relates_to: string
          token_hash: string
          token_type: Database["auth"]["Enums"]["one_time_token_type"]
          updated_at: string
          user_id: string
        }
        Insert: {
          created_at?: string
          id: string
          relates_to: string
          token_hash: string
          token_type: Database["auth"]["Enums"]["one_time_token_type"]
          updated_at?: string
          user_id: string
        }
        Update: {
          created_at?: string
          id?: string
          relates_to?: string
          token_hash?: string
          token_type?: Database["auth"]["Enums"]["one_time_token_type"]
          updated_at?: string
          user_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "one_time_tokens_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "users"
            referencedColumns: ["id"]
          },
        ]
      }
      refresh_tokens: {
        Row: {
          created_at: string | null
          id: number
          instance_id: string | null
          parent: string | null
          revoked: boolean | null
          session_id: string | null
          token: string | null
          updated_at: string | null
          user_id: string | null
        }
        Insert: {
          created_at?: string | null
          id?: number
          instance_id?: string | null
          parent?: string | null
          revoked?: boolean | null
          session_id?: string | null
          token?: string | null
          updated_at?: string | null
          user_id?: string | null
        }
        Update: {
          created_at?: string | null
          id?: number
          instance_id?: string | null
          parent?: string | null
          revoked?: boolean | null
          session_id?: string | null
          token?: string | null
          updated_at?: string | null
          user_id?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "refresh_tokens_session_id_fkey"
            columns: ["session_id"]
            isOneToOne: false
            referencedRelation: "sessions"
            referencedColumns: ["id"]
          },
        ]
      }
      saml_providers: {
        Row: {
          attribute_mapping: Json | null
          created_at: string | null
          entity_id: string
          id: string
          metadata_url: string | null
          metadata_xml: string
          name_id_format: string | null
          sso_provider_id: string
          updated_at: string | null
        }
        Insert: {
          attribute_mapping?: Json | null
          created_at?: string | null
          entity_id: string
          id: string
          metadata_url?: string | null
          metadata_xml: string
          name_id_format?: string | null
          sso_provider_id: string
          updated_at?: string | null
        }
        Update: {
          attribute_mapping?: Json | null
          created_at?: string | null
          entity_id?: string
          id?: string
          metadata_url?: string | null
          metadata_xml?: string
          name_id_format?: string | null
          sso_provider_id?: string
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "saml_providers_sso_provider_id_fkey"
            columns: ["sso_provider_id"]
            isOneToOne: false
            referencedRelation: "sso_providers"
            referencedColumns: ["id"]
          },
        ]
      }
      saml_relay_states: {
        Row: {
          created_at: string | null
          flow_state_id: string | null
          for_email: string | null
          id: string
          redirect_to: string | null
          request_id: string
          sso_provider_id: string
          updated_at: string | null
        }
        Insert: {
          created_at?: string | null
          flow_state_id?: string | null
          for_email?: string | null
          id: string
          redirect_to?: string | null
          request_id: string
          sso_provider_id: string
          updated_at?: string | null
        }
        Update: {
          created_at?: string | null
          flow_state_id?: string | null
          for_email?: string | null
          id?: string
          redirect_to?: string | null
          request_id?: string
          sso_provider_id?: string
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "saml_relay_states_flow_state_id_fkey"
            columns: ["flow_state_id"]
            isOneToOne: false
            referencedRelation: "flow_state"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "saml_relay_states_sso_provider_id_fkey"
            columns: ["sso_provider_id"]
            isOneToOne: false
            referencedRelation: "sso_providers"
            referencedColumns: ["id"]
          },
        ]
      }
      schema_migrations: {
        Row: {
          version: string
        }
        Insert: {
          version: string
        }
        Update: {
          version?: string
        }
        Relationships: []
      }
      sessions: {
        Row: {
          aal: Database["auth"]["Enums"]["aal_level"] | null
          created_at: string | null
          factor_id: string | null
          id: string
          ip: unknown | null
          not_after: string | null
          refreshed_at: string | null
          tag: string | null
          updated_at: string | null
          user_agent: string | null
          user_id: string
        }
        Insert: {
          aal?: Database["auth"]["Enums"]["aal_level"] | null
          created_at?: string | null
          factor_id?: string | null
          id: string
          ip?: unknown | null
          not_after?: string | null
          refreshed_at?: string | null
          tag?: string | null
          updated_at?: string | null
          user_agent?: string | null
          user_id: string
        }
        Update: {
          aal?: Database["auth"]["Enums"]["aal_level"] | null
          created_at?: string | null
          factor_id?: string | null
          id?: string
          ip?: unknown | null
          not_after?: string | null
          refreshed_at?: string | null
          tag?: string | null
          updated_at?: string | null
          user_agent?: string | null
          user_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "sessions_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "users"
            referencedColumns: ["id"]
          },
        ]
      }
      sso_domains: {
        Row: {
          created_at: string | null
          domain: string
          id: string
          sso_provider_id: string
          updated_at: string | null
        }
        Insert: {
          created_at?: string | null
          domain: string
          id: string
          sso_provider_id: string
          updated_at?: string | null
        }
        Update: {
          created_at?: string | null
          domain?: string
          id?: string
          sso_provider_id?: string
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "sso_domains_sso_provider_id_fkey"
            columns: ["sso_provider_id"]
            isOneToOne: false
            referencedRelation: "sso_providers"
            referencedColumns: ["id"]
          },
        ]
      }
      sso_providers: {
        Row: {
          created_at: string | null
          id: string
          resource_id: string | null
          updated_at: string | null
        }
        Insert: {
          created_at?: string | null
          id: string
          resource_id?: string | null
          updated_at?: string | null
        }
        Update: {
          created_at?: string | null
          id?: string
          resource_id?: string | null
          updated_at?: string | null
        }
        Relationships: []
      }
      users: {
        Row: {
          aud: string | null
          banned_until: string | null
          confirmation_sent_at: string | null
          confirmation_token: string | null
          confirmed_at: string | null
          created_at: string | null
          deleted_at: string | null
          email: string | null
          email_change: string | null
          email_change_confirm_status: number | null
          email_change_sent_at: string | null
          email_change_token_current: string | null
          email_change_token_new: string | null
          email_confirmed_at: string | null
          encrypted_password: string | null
          id: string
          instance_id: string | null
          invited_at: string | null
          is_anonymous: boolean
          is_sso_user: boolean
          is_super_admin: boolean | null
          last_sign_in_at: string | null
          phone: string | null
          phone_change: string | null
          phone_change_sent_at: string | null
          phone_change_token: string | null
          phone_confirmed_at: string | null
          raw_app_meta_data: Json | null
          raw_user_meta_data: Json | null
          reauthentication_sent_at: string | null
          reauthentication_token: string | null
          recovery_sent_at: string | null
          recovery_token: string | null
          role: string | null
          updated_at: string | null
        }
        Insert: {
          aud?: string | null
          banned_until?: string | null
          confirmation_sent_at?: string | null
          confirmation_token?: string | null
          confirmed_at?: string | null
          created_at?: string | null
          deleted_at?: string | null
          email?: string | null
          email_change?: string | null
          email_change_confirm_status?: number | null
          email_change_sent_at?: string | null
          email_change_token_current?: string | null
          email_change_token_new?: string | null
          email_confirmed_at?: string | null
          encrypted_password?: string | null
          id: string
          instance_id?: string | null
          invited_at?: string | null
          is_anonymous?: boolean
          is_sso_user?: boolean
          is_super_admin?: boolean | null
          last_sign_in_at?: string | null
          phone?: string | null
          phone_change?: string | null
          phone_change_sent_at?: string | null
          phone_change_token?: string | null
          phone_confirmed_at?: string | null
          raw_app_meta_data?: Json | null
          raw_user_meta_data?: Json | null
          reauthentication_sent_at?: string | null
          reauthentication_token?: string | null
          recovery_sent_at?: string | null
          recovery_token?: string | null
          role?: string | null
          updated_at?: string | null
        }
        Update: {
          aud?: string | null
          banned_until?: string | null
          confirmation_sent_at?: string | null
          confirmation_token?: string | null
          confirmed_at?: string | null
          created_at?: string | null
          deleted_at?: string | null
          email?: string | null
          email_change?: string | null
          email_change_confirm_status?: number | null
          email_change_sent_at?: string | null
          email_change_token_current?: string | null
          email_change_token_new?: string | null
          email_confirmed_at?: string | null
          encrypted_password?: string | null
          id?: string
          instance_id?: string | null
          invited_at?: string | null
          is_anonymous?: boolean
          is_sso_user?: boolean
          is_super_admin?: boolean | null
          last_sign_in_at?: string | null
          phone?: string | null
          phone_change?: string | null
          phone_change_sent_at?: string | null
          phone_change_token?: string | null
          phone_confirmed_at?: string | null
          raw_app_meta_data?: Json | null
          raw_user_meta_data?: Json | null
          reauthentication_sent_at?: string | null
          reauthentication_token?: string | null
          recovery_sent_at?: string | null
          recovery_token?: string | null
          role?: string | null
          updated_at?: string | null
        }
        Relationships: []
      }
    }
    Views: {
      [_ in never]: never
    }
    Functions: {
      email: {
        Args: Record<PropertyKey, never>
        Returns: string
      }
      jwt: {
        Args: Record<PropertyKey, never>
        Returns: Json
      }
      role: {
        Args: Record<PropertyKey, never>
        Returns: string
      }
      uid: {
        Args: Record<PropertyKey, never>
        Returns: string
      }
    }
    Enums: {
      aal_level: "aal1" | "aal2" | "aal3"
      code_challenge_method: "s256" | "plain"
      factor_status: "unverified" | "verified"
      factor_type: "totp" | "webauthn" | "phone"
      one_time_token_type:
        | "confirmation_token"
        | "reauthentication_token"
        | "recovery_token"
        | "email_change_token_new"
        | "email_change_token_current"
        | "phone_change_token"
    }
    CompositeTypes: {
      [_ in never]: never
    }
  }
  public: {
    Tables: {
      employee_designations: {
        Row: {
          created_at: string | null
          id: string
          name: string
          parent_id: string | null
          status: boolean | null
          updated_at: string | null
        }
        Insert: {
          created_at?: string | null
          id?: string
          name: string
          parent_id?: string | null
          status?: boolean | null
          updated_at?: string | null
        }
        Update: {
          created_at?: string | null
          id?: string
          name?: string
          parent_id?: string | null
          status?: boolean | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "employee_designations_parent_id_fkey"
            columns: ["parent_id"]
            isOneToOne: false
            referencedRelation: "employee_designations"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "employee_designations_parent_id_fkey"
            columns: ["parent_id"]
            isOneToOne: false
            referencedRelation: "v_employee_designations_with_count"
            referencedColumns: ["id"]
          },
        ]
      }
      employees: {
        Row: {
          created_at: string | null
          employee_addr: string | null
          employee_contact: string | null
          employee_designation_id: string | null
          employee_dob: string | null
          employee_doj: string | null
          employee_email: string | null
          employee_name: string
          employee_pers_no: string | null
          id: string
          maintenance_terminal_id: string | null
          remark: string | null
          status: boolean | null
          updated_at: string | null
        }
        Insert: {
          created_at?: string | null
          employee_addr?: string | null
          employee_contact?: string | null
          employee_designation_id?: string | null
          employee_dob?: string | null
          employee_doj?: string | null
          employee_email?: string | null
          employee_name: string
          employee_pers_no?: string | null
          id?: string
          maintenance_terminal_id?: string | null
          remark?: string | null
          status?: boolean | null
          updated_at?: string | null
        }
        Update: {
          created_at?: string | null
          employee_addr?: string | null
          employee_contact?: string | null
          employee_designation_id?: string | null
          employee_dob?: string | null
          employee_doj?: string | null
          employee_email?: string | null
          employee_name?: string
          employee_pers_no?: string | null
          id?: string
          maintenance_terminal_id?: string | null
          remark?: string | null
          status?: boolean | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "employees_employee_designation_id_fkey"
            columns: ["employee_designation_id"]
            isOneToOne: false
            referencedRelation: "employee_designations"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "employees_employee_designation_id_fkey"
            columns: ["employee_designation_id"]
            isOneToOne: false
            referencedRelation: "v_employee_designations_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "employees_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "employees_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
        ]
      }
      fiber_joint_connections: {
        Row: {
          created_at: string | null
          id: string
          input_fiber_no: number
          input_ofc_id: string
          joint_id: string
          logical_path_id: string | null
          output_fiber_no: number
          output_ofc_id: string
          splice_loss_db: number | null
          updated_at: string | null
        }
        Insert: {
          created_at?: string | null
          id?: string
          input_fiber_no: number
          input_ofc_id: string
          joint_id: string
          logical_path_id?: string | null
          output_fiber_no: number
          output_ofc_id: string
          splice_loss_db?: number | null
          updated_at?: string | null
        }
        Update: {
          created_at?: string | null
          id?: string
          input_fiber_no?: number
          input_ofc_id?: string
          joint_id?: string
          logical_path_id?: string | null
          output_fiber_no?: number
          output_ofc_id?: string
          splice_loss_db?: number | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "fiber_joint_connections_input_ofc_id_fkey"
            columns: ["input_ofc_id"]
            isOneToOne: false
            referencedRelation: "ofc_cables"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "fiber_joint_connections_input_ofc_id_fkey"
            columns: ["input_ofc_id"]
            isOneToOne: false
            referencedRelation: "v_cable_utilization"
            referencedColumns: ["cable_id"]
          },
          {
            foreignKeyName: "fiber_joint_connections_input_ofc_id_fkey"
            columns: ["input_ofc_id"]
            isOneToOne: false
            referencedRelation: "v_ofc_cables_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "fiber_joint_connections_joint_id_fkey"
            columns: ["joint_id"]
            isOneToOne: false
            referencedRelation: "fiber_joints"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "fiber_joint_connections_logical_path_id_fkey"
            columns: ["logical_path_id"]
            isOneToOne: false
            referencedRelation: "logical_fiber_paths"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "fiber_joint_connections_logical_path_id_fkey"
            columns: ["logical_path_id"]
            isOneToOne: false
            referencedRelation: "v_end_to_end_paths"
            referencedColumns: ["path_id"]
          },
          {
            foreignKeyName: "fiber_joint_connections_output_ofc_id_fkey"
            columns: ["output_ofc_id"]
            isOneToOne: false
            referencedRelation: "ofc_cables"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "fiber_joint_connections_output_ofc_id_fkey"
            columns: ["output_ofc_id"]
            isOneToOne: false
            referencedRelation: "v_cable_utilization"
            referencedColumns: ["cable_id"]
          },
          {
            foreignKeyName: "fiber_joint_connections_output_ofc_id_fkey"
            columns: ["output_ofc_id"]
            isOneToOne: false
            referencedRelation: "v_ofc_cables_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      fiber_joints: {
        Row: {
          created_at: string | null
          id: string
          installed_date: string | null
          joint_category: string
          joint_name: string
          joint_type: string
          latitude: number | null
          location_description: string | null
          longitude: number | null
          maintenance_area_id: string | null
          node_id: string | null
          remark: string | null
          status: boolean | null
          updated_at: string | null
        }
        Insert: {
          created_at?: string | null
          id?: string
          installed_date?: string | null
          joint_category?: string
          joint_name: string
          joint_type?: string
          latitude?: number | null
          location_description?: string | null
          longitude?: number | null
          maintenance_area_id?: string | null
          node_id?: string | null
          remark?: string | null
          status?: boolean | null
          updated_at?: string | null
        }
        Update: {
          created_at?: string | null
          id?: string
          installed_date?: string | null
          joint_category?: string
          joint_name?: string
          joint_type?: string
          latitude?: number | null
          location_description?: string | null
          longitude?: number | null
          maintenance_area_id?: string | null
          node_id?: string | null
          remark?: string | null
          status?: boolean | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "fiber_joints_maintenance_area_id_fkey"
            columns: ["maintenance_area_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "fiber_joints_maintenance_area_id_fkey"
            columns: ["maintenance_area_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "fiber_joints_node_id_fkey"
            columns: ["node_id"]
            isOneToOne: false
            referencedRelation: "nodes"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "fiber_joints_node_id_fkey"
            columns: ["node_id"]
            isOneToOne: false
            referencedRelation: "v_nodes_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "fk_joint_type"
            columns: ["joint_category", "joint_type"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["category", "name"]
          },
          {
            foreignKeyName: "fk_joint_type"
            columns: ["joint_category", "joint_type"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["category", "name"]
          },
          {
            foreignKeyName: "fk_joint_type"
            columns: ["joint_category", "joint_type"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: [
              "maintenance_area_type_category",
              "maintenance_area_type_name",
            ]
          },
          {
            foreignKeyName: "fk_joint_type"
            columns: ["joint_category", "joint_type"]
            isOneToOne: false
            referencedRelation: "v_rings_with_count"
            referencedColumns: ["ring_type_category", "ring_type_name"]
          },
          {
            foreignKeyName: "fk_joint_type"
            columns: ["joint_category", "joint_type"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["system_category", "system_type_name"]
          },
        ]
      }
      files: {
        Row: {
          file_name: string
          file_route: string
          file_size: string
          file_type: string
          file_url: string
          folder_id: string | null
          id: string
          uploaded_at: string | null
          user_id: string
        }
        Insert: {
          file_name: string
          file_route: string
          file_size: string
          file_type: string
          file_url: string
          folder_id?: string | null
          id?: string
          uploaded_at?: string | null
          user_id: string
        }
        Update: {
          file_name?: string
          file_route?: string
          file_size?: string
          file_type?: string
          file_url?: string
          folder_id?: string | null
          id?: string
          uploaded_at?: string | null
          user_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "files_folder_id_fkey"
            columns: ["folder_id"]
            isOneToOne: false
            referencedRelation: "folders"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "files_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "v_user_profiles_extended"
            referencedColumns: ["id"]
          },
        ]
      }
      folders: {
        Row: {
          created_at: string | null
          id: string
          name: string
          user_id: string
        }
        Insert: {
          created_at?: string | null
          id?: string
          name: string
          user_id: string
        }
        Update: {
          created_at?: string | null
          id?: string
          name?: string
          user_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "folders_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "v_user_profiles_extended"
            referencedColumns: ["id"]
          },
        ]
      }
      logical_fiber_paths: {
        Row: {
          bandwidth_gbps: number | null
          commissioned_date: string | null
          created_at: string | null
          destination_port: string | null
          destination_system_id: string | null
          id: string
          operational_status: string
          operational_status_category: string
          path_category: string
          path_name: string | null
          path_type: string
          remark: string | null
          service_type: string | null
          source_port: string | null
          source_system_id: string | null
          total_distance_km: number | null
          total_loss_db: number | null
          updated_at: string | null
          wavelength_nm: number | null
        }
        Insert: {
          bandwidth_gbps?: number | null
          commissioned_date?: string | null
          created_at?: string | null
          destination_port?: string | null
          destination_system_id?: string | null
          id?: string
          operational_status?: string
          operational_status_category?: string
          path_category?: string
          path_name?: string | null
          path_type?: string
          remark?: string | null
          service_type?: string | null
          source_port?: string | null
          source_system_id?: string | null
          total_distance_km?: number | null
          total_loss_db?: number | null
          updated_at?: string | null
          wavelength_nm?: number | null
        }
        Update: {
          bandwidth_gbps?: number | null
          commissioned_date?: string | null
          created_at?: string | null
          destination_port?: string | null
          destination_system_id?: string | null
          id?: string
          operational_status?: string
          operational_status_category?: string
          path_category?: string
          path_name?: string | null
          path_type?: string
          remark?: string | null
          service_type?: string | null
          source_port?: string | null
          source_system_id?: string | null
          total_distance_km?: number | null
          total_loss_db?: number | null
          updated_at?: string | null
          wavelength_nm?: number | null
        }
        Relationships: [
          {
            foreignKeyName: "fk_operational_status"
            columns: ["operational_status_category", "operational_status"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["category", "name"]
          },
          {
            foreignKeyName: "fk_operational_status"
            columns: ["operational_status_category", "operational_status"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["category", "name"]
          },
          {
            foreignKeyName: "fk_operational_status"
            columns: ["operational_status_category", "operational_status"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: [
              "maintenance_area_type_category",
              "maintenance_area_type_name",
            ]
          },
          {
            foreignKeyName: "fk_operational_status"
            columns: ["operational_status_category", "operational_status"]
            isOneToOne: false
            referencedRelation: "v_rings_with_count"
            referencedColumns: ["ring_type_category", "ring_type_name"]
          },
          {
            foreignKeyName: "fk_operational_status"
            columns: ["operational_status_category", "operational_status"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["system_category", "system_type_name"]
          },
          {
            foreignKeyName: "fk_path_type"
            columns: ["path_category", "path_type"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["category", "name"]
          },
          {
            foreignKeyName: "fk_path_type"
            columns: ["path_category", "path_type"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["category", "name"]
          },
          {
            foreignKeyName: "fk_path_type"
            columns: ["path_category", "path_type"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: [
              "maintenance_area_type_category",
              "maintenance_area_type_name",
            ]
          },
          {
            foreignKeyName: "fk_path_type"
            columns: ["path_category", "path_type"]
            isOneToOne: false
            referencedRelation: "v_rings_with_count"
            referencedColumns: ["ring_type_category", "ring_type_name"]
          },
          {
            foreignKeyName: "fk_path_type"
            columns: ["path_category", "path_type"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["system_category", "system_type_name"]
          },
          {
            foreignKeyName: "logical_fiber_paths_destination_system_id_fkey"
            columns: ["destination_system_id"]
            isOneToOne: false
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "logical_fiber_paths_destination_system_id_fkey"
            columns: ["destination_system_id"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "logical_fiber_paths_source_system_id_fkey"
            columns: ["source_system_id"]
            isOneToOne: false
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "logical_fiber_paths_source_system_id_fkey"
            columns: ["source_system_id"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      lookup_types: {
        Row: {
          category: string
          code: string | null
          created_at: string | null
          description: string | null
          id: string
          is_system_default: boolean | null
          name: string
          sort_order: number | null
          status: boolean | null
          updated_at: string | null
        }
        Insert: {
          category: string
          code?: string | null
          created_at?: string | null
          description?: string | null
          id?: string
          is_system_default?: boolean | null
          name: string
          sort_order?: number | null
          status?: boolean | null
          updated_at?: string | null
        }
        Update: {
          category?: string
          code?: string | null
          created_at?: string | null
          description?: string | null
          id?: string
          is_system_default?: boolean | null
          name?: string
          sort_order?: number | null
          status?: boolean | null
          updated_at?: string | null
        }
        Relationships: []
      }
      maintenance_areas: {
        Row: {
          address: string | null
          area_type_id: string | null
          code: string | null
          contact_number: string | null
          contact_person: string | null
          created_at: string | null
          email: string | null
          id: string
          latitude: number | null
          longitude: number | null
          name: string
          parent_id: string | null
          status: boolean | null
          updated_at: string | null
        }
        Insert: {
          address?: string | null
          area_type_id?: string | null
          code?: string | null
          contact_number?: string | null
          contact_person?: string | null
          created_at?: string | null
          email?: string | null
          id?: string
          latitude?: number | null
          longitude?: number | null
          name: string
          parent_id?: string | null
          status?: boolean | null
          updated_at?: string | null
        }
        Update: {
          address?: string | null
          area_type_id?: string | null
          code?: string | null
          contact_number?: string | null
          contact_person?: string | null
          created_at?: string | null
          email?: string | null
          id?: string
          latitude?: number | null
          longitude?: number | null
          name?: string
          parent_id?: string | null
          status?: boolean | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "maintenance_areas_area_type_id_fkey"
            columns: ["area_type_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "maintenance_areas_area_type_id_fkey"
            columns: ["area_type_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "maintenance_areas_parent_id_fkey"
            columns: ["parent_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "maintenance_areas_parent_id_fkey"
            columns: ["parent_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
        ]
      }
      management_ports: {
        Row: {
          commissioned_on: string | null
          created_at: string | null
          id: string
          name: string | null
          node_id: string | null
          port_no: string
          remark: string | null
          status: boolean | null
          system_id: string | null
          updated_at: string | null
        }
        Insert: {
          commissioned_on?: string | null
          created_at?: string | null
          id?: string
          name?: string | null
          node_id?: string | null
          port_no: string
          remark?: string | null
          status?: boolean | null
          system_id?: string | null
          updated_at?: string | null
        }
        Update: {
          commissioned_on?: string | null
          created_at?: string | null
          id?: string
          name?: string | null
          node_id?: string | null
          port_no?: string
          remark?: string | null
          status?: boolean | null
          system_id?: string | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "management_ports_node_id_fkey"
            columns: ["node_id"]
            isOneToOne: false
            referencedRelation: "nodes"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "management_ports_node_id_fkey"
            columns: ["node_id"]
            isOneToOne: false
            referencedRelation: "v_nodes_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "management_ports_system_id_fkey"
            columns: ["system_id"]
            isOneToOne: false
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "management_ports_system_id_fkey"
            columns: ["system_id"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      nodes: {
        Row: {
          created_at: string | null
          id: string
          latitude: number | null
          longitude: number | null
          maintenance_terminal_id: string | null
          name: string
          node_type_id: string | null
          remark: string | null
          status: boolean | null
          updated_at: string | null
        }
        Insert: {
          created_at?: string | null
          id?: string
          latitude?: number | null
          longitude?: number | null
          maintenance_terminal_id?: string | null
          name: string
          node_type_id?: string | null
          remark?: string | null
          status?: boolean | null
          updated_at?: string | null
        }
        Update: {
          created_at?: string | null
          id?: string
          latitude?: number | null
          longitude?: number | null
          maintenance_terminal_id?: string | null
          name?: string
          node_type_id?: string | null
          remark?: string | null
          status?: boolean | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "nodes_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "nodes_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "nodes_node_type_id_fkey"
            columns: ["node_type_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "nodes_node_type_id_fkey"
            columns: ["node_type_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
        ]
      }
      ofc_cables: {
        Row: {
          asset_no: string | null
          capacity: number
          commissioned_on: string | null
          created_at: string | null
          current_rkm: number | null
          en_id: string
          id: string
          maintenance_terminal_id: string | null
          ofc_owner_id: string
          ofc_type_id: string
          remark: string | null
          route_name: string
          sn_id: string
          status: boolean | null
          transnet_id: string | null
          transnet_rkm: number | null
          updated_at: string | null
        }
        Insert: {
          asset_no?: string | null
          capacity: number
          commissioned_on?: string | null
          created_at?: string | null
          current_rkm?: number | null
          en_id: string
          id?: string
          maintenance_terminal_id?: string | null
          ofc_owner_id: string
          ofc_type_id: string
          remark?: string | null
          route_name: string
          sn_id: string
          status?: boolean | null
          transnet_id?: string | null
          transnet_rkm?: number | null
          updated_at?: string | null
        }
        Update: {
          asset_no?: string | null
          capacity?: number
          commissioned_on?: string | null
          created_at?: string | null
          current_rkm?: number | null
          en_id?: string
          id?: string
          maintenance_terminal_id?: string | null
          ofc_owner_id?: string
          ofc_type_id?: string
          remark?: string | null
          route_name?: string
          sn_id?: string
          status?: boolean | null
          transnet_id?: string | null
          transnet_rkm?: number | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "ofc_cables_en_id_fkey"
            columns: ["en_id"]
            isOneToOne: false
            referencedRelation: "nodes"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_en_id_fkey"
            columns: ["en_id"]
            isOneToOne: false
            referencedRelation: "v_nodes_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_ofc_owner_id_fkey"
            columns: ["ofc_owner_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_ofc_owner_id_fkey"
            columns: ["ofc_owner_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_ofc_type_id_fkey"
            columns: ["ofc_type_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_ofc_type_id_fkey"
            columns: ["ofc_type_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_sn_id_fkey"
            columns: ["sn_id"]
            isOneToOne: false
            referencedRelation: "nodes"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_sn_id_fkey"
            columns: ["sn_id"]
            isOneToOne: false
            referencedRelation: "v_nodes_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      ofc_connections: {
        Row: {
          connection_category: string
          connection_type: string
          created_at: string | null
          destination_port: string | null
          en_dom: string | null
          en_power_dbm: number | null
          fiber_no_en: number | null
          fiber_no_sn: number
          id: string
          logical_path_id: string | null
          ofc_id: string
          otdr_distance_en_km: number | null
          otdr_distance_sn_km: number | null
          path_segment_order: number | null
          remark: string | null
          route_loss_db: number | null
          sn_dom: string | null
          sn_power_dbm: number | null
          source_port: string | null
          status: boolean | null
          system_id: string | null
          updated_at: string | null
        }
        Insert: {
          connection_category?: string
          connection_type?: string
          created_at?: string | null
          destination_port?: string | null
          en_dom?: string | null
          en_power_dbm?: number | null
          fiber_no_en?: number | null
          fiber_no_sn: number
          id?: string
          logical_path_id?: string | null
          ofc_id: string
          otdr_distance_en_km?: number | null
          otdr_distance_sn_km?: number | null
          path_segment_order?: number | null
          remark?: string | null
          route_loss_db?: number | null
          sn_dom?: string | null
          sn_power_dbm?: number | null
          source_port?: string | null
          status?: boolean | null
          system_id?: string | null
          updated_at?: string | null
        }
        Update: {
          connection_category?: string
          connection_type?: string
          created_at?: string | null
          destination_port?: string | null
          en_dom?: string | null
          en_power_dbm?: number | null
          fiber_no_en?: number | null
          fiber_no_sn?: number
          id?: string
          logical_path_id?: string | null
          ofc_id?: string
          otdr_distance_en_km?: number | null
          otdr_distance_sn_km?: number | null
          path_segment_order?: number | null
          remark?: string | null
          route_loss_db?: number | null
          sn_dom?: string | null
          sn_power_dbm?: number | null
          source_port?: string | null
          status?: boolean | null
          system_id?: string | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "fk_connection_type"
            columns: ["connection_category", "connection_type"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["category", "name"]
          },
          {
            foreignKeyName: "fk_connection_type"
            columns: ["connection_category", "connection_type"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["category", "name"]
          },
          {
            foreignKeyName: "fk_connection_type"
            columns: ["connection_category", "connection_type"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: [
              "maintenance_area_type_category",
              "maintenance_area_type_name",
            ]
          },
          {
            foreignKeyName: "fk_connection_type"
            columns: ["connection_category", "connection_type"]
            isOneToOne: false
            referencedRelation: "v_rings_with_count"
            referencedColumns: ["ring_type_category", "ring_type_name"]
          },
          {
            foreignKeyName: "fk_connection_type"
            columns: ["connection_category", "connection_type"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["system_category", "system_type_name"]
          },
          {
            foreignKeyName: "fk_ofc_connections_logical_path"
            columns: ["logical_path_id"]
            isOneToOne: false
            referencedRelation: "logical_fiber_paths"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "fk_ofc_connections_logical_path"
            columns: ["logical_path_id"]
            isOneToOne: false
            referencedRelation: "v_end_to_end_paths"
            referencedColumns: ["path_id"]
          },
          {
            foreignKeyName: "fk_ofc_connections_system"
            columns: ["system_id"]
            isOneToOne: false
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "fk_ofc_connections_system"
            columns: ["system_id"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_connections_ofc_id_fkey"
            columns: ["ofc_id"]
            isOneToOne: false
            referencedRelation: "ofc_cables"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_connections_ofc_id_fkey"
            columns: ["ofc_id"]
            isOneToOne: false
            referencedRelation: "v_cable_utilization"
            referencedColumns: ["cable_id"]
          },
          {
            foreignKeyName: "ofc_connections_ofc_id_fkey"
            columns: ["ofc_id"]
            isOneToOne: false
            referencedRelation: "v_ofc_cables_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      ring_based_systems: {
        Row: {
          maintenance_area_id: string | null
          ring_id: string | null
          system_id: string
        }
        Insert: {
          maintenance_area_id?: string | null
          ring_id?: string | null
          system_id: string
        }
        Update: {
          maintenance_area_id?: string | null
          ring_id?: string | null
          system_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "ring_based_systems_maintenance_area_id_fkey"
            columns: ["maintenance_area_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ring_based_systems_maintenance_area_id_fkey"
            columns: ["maintenance_area_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ring_based_systems_ring_id_fkey"
            columns: ["ring_id"]
            isOneToOne: false
            referencedRelation: "rings"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ring_based_systems_ring_id_fkey"
            columns: ["ring_id"]
            isOneToOne: false
            referencedRelation: "v_rings_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ring_based_systems_system_id_fkey"
            columns: ["system_id"]
            isOneToOne: true
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ring_based_systems_system_id_fkey"
            columns: ["system_id"]
            isOneToOne: true
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      rings: {
        Row: {
          created_at: string | null
          description: string | null
          id: string
          maintenance_terminal_id: string | null
          name: string
          ring_type_id: string | null
          status: boolean | null
          total_nodes: number | null
          updated_at: string | null
        }
        Insert: {
          created_at?: string | null
          description?: string | null
          id?: string
          maintenance_terminal_id?: string | null
          name: string
          ring_type_id?: string | null
          status?: boolean | null
          total_nodes?: number | null
          updated_at?: string | null
        }
        Update: {
          created_at?: string | null
          description?: string | null
          id?: string
          maintenance_terminal_id?: string | null
          name?: string
          ring_type_id?: string | null
          status?: boolean | null
          total_nodes?: number | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "rings_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "rings_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "rings_ring_type_id_fkey"
            columns: ["ring_type_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "rings_ring_type_id_fkey"
            columns: ["ring_type_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
        ]
      }
      sdh_connections: {
        Row: {
          a_customer: string | null
          a_slot: string | null
          b_customer: string | null
          b_slot: string | null
          carrier: string | null
          stm_no: string | null
          system_connection_id: string
        }
        Insert: {
          a_customer?: string | null
          a_slot?: string | null
          b_customer?: string | null
          b_slot?: string | null
          carrier?: string | null
          stm_no?: string | null
          system_connection_id: string
        }
        Update: {
          a_customer?: string | null
          a_slot?: string | null
          b_customer?: string | null
          b_slot?: string | null
          carrier?: string | null
          stm_no?: string | null
          system_connection_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "sdh_connections_system_connection_id_fkey"
            columns: ["system_connection_id"]
            isOneToOne: true
            referencedRelation: "system_connections"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "sdh_connections_system_connection_id_fkey"
            columns: ["system_connection_id"]
            isOneToOne: true
            referencedRelation: "v_system_connections_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      sdh_node_associations: {
        Row: {
          id: string
          node_id: string
          node_ip: unknown | null
          node_position: string | null
          sdh_system_id: string
        }
        Insert: {
          id?: string
          node_id: string
          node_ip?: unknown | null
          node_position?: string | null
          sdh_system_id: string
        }
        Update: {
          id?: string
          node_id?: string
          node_ip?: unknown | null
          node_position?: string | null
          sdh_system_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "sdh_node_associations_node_id_fkey"
            columns: ["node_id"]
            isOneToOne: false
            referencedRelation: "nodes"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "sdh_node_associations_node_id_fkey"
            columns: ["node_id"]
            isOneToOne: false
            referencedRelation: "v_nodes_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "sdh_node_associations_sdh_system_id_fkey"
            columns: ["sdh_system_id"]
            isOneToOne: false
            referencedRelation: "sdh_systems"
            referencedColumns: ["system_id"]
          },
        ]
      }
      sdh_systems: {
        Row: {
          gne: string | null
          make: string | null
          system_id: string
        }
        Insert: {
          gne?: string | null
          make?: string | null
          system_id: string
        }
        Update: {
          gne?: string | null
          make?: string | null
          system_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "sdh_systems_system_id_fkey"
            columns: ["system_id"]
            isOneToOne: true
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "sdh_systems_system_id_fkey"
            columns: ["system_id"]
            isOneToOne: true
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      sfp_based_connections: {
        Row: {
          bandwidth_allocated_mbps: number | null
          customer_name: string | null
          fiber_in: number | null
          fiber_out: number | null
          sfp_capacity: string | null
          sfp_port: string | null
          sfp_serial_no: string | null
          sfp_type_id: string | null
          system_connection_id: string
        }
        Insert: {
          bandwidth_allocated_mbps?: number | null
          customer_name?: string | null
          fiber_in?: number | null
          fiber_out?: number | null
          sfp_capacity?: string | null
          sfp_port?: string | null
          sfp_serial_no?: string | null
          sfp_type_id?: string | null
          system_connection_id: string
        }
        Update: {
          bandwidth_allocated_mbps?: number | null
          customer_name?: string | null
          fiber_in?: number | null
          fiber_out?: number | null
          sfp_capacity?: string | null
          sfp_port?: string | null
          sfp_serial_no?: string | null
          sfp_type_id?: string | null
          system_connection_id?: string
        }
        Relationships: [
          {
            foreignKeyName: "sfp_based_connections_sfp_type_id_fkey"
            columns: ["sfp_type_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "sfp_based_connections_sfp_type_id_fkey"
            columns: ["sfp_type_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "sfp_based_connections_system_connection_id_fkey"
            columns: ["system_connection_id"]
            isOneToOne: true
            referencedRelation: "system_connections"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "sfp_based_connections_system_connection_id_fkey"
            columns: ["system_connection_id"]
            isOneToOne: true
            referencedRelation: "v_system_connections_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      system_connections: {
        Row: {
          bandwidth_mbps: number | null
          commissioned_on: string | null
          connected_system_id: string | null
          created_at: string | null
          en_id: string | null
          en_interface: string | null
          en_ip: unknown | null
          id: string
          media_type_id: string | null
          remark: string | null
          sn_id: string | null
          sn_interface: string | null
          sn_ip: unknown | null
          status: boolean | null
          system_id: string
          updated_at: string | null
          vlan: string | null
        }
        Insert: {
          bandwidth_mbps?: number | null
          commissioned_on?: string | null
          connected_system_id?: string | null
          created_at?: string | null
          en_id?: string | null
          en_interface?: string | null
          en_ip?: unknown | null
          id?: string
          media_type_id?: string | null
          remark?: string | null
          sn_id?: string | null
          sn_interface?: string | null
          sn_ip?: unknown | null
          status?: boolean | null
          system_id: string
          updated_at?: string | null
          vlan?: string | null
        }
        Update: {
          bandwidth_mbps?: number | null
          commissioned_on?: string | null
          connected_system_id?: string | null
          created_at?: string | null
          en_id?: string | null
          en_interface?: string | null
          en_ip?: unknown | null
          id?: string
          media_type_id?: string | null
          remark?: string | null
          sn_id?: string | null
          sn_interface?: string | null
          sn_ip?: unknown | null
          status?: boolean | null
          system_id?: string
          updated_at?: string | null
          vlan?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "system_connections_connected_system_id_fkey"
            columns: ["connected_system_id"]
            isOneToOne: false
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "system_connections_connected_system_id_fkey"
            columns: ["connected_system_id"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "system_connections_en_id_fkey"
            columns: ["en_id"]
            isOneToOne: false
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "system_connections_en_id_fkey"
            columns: ["en_id"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "system_connections_media_type_id_fkey"
            columns: ["media_type_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "system_connections_media_type_id_fkey"
            columns: ["media_type_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "system_connections_sn_id_fkey"
            columns: ["sn_id"]
            isOneToOne: false
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "system_connections_sn_id_fkey"
            columns: ["sn_id"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "system_connections_system_id_fkey"
            columns: ["system_id"]
            isOneToOne: false
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "system_connections_system_id_fkey"
            columns: ["system_id"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      systems: {
        Row: {
          commissioned_on: string | null
          created_at: string | null
          id: string
          ip_address: unknown | null
          maintenance_terminal_id: string | null
          node_id: string
          remark: string | null
          s_no: string | null
          status: boolean | null
          system_name: string | null
          system_type_id: string
          updated_at: string | null
        }
        Insert: {
          commissioned_on?: string | null
          created_at?: string | null
          id?: string
          ip_address?: unknown | null
          maintenance_terminal_id?: string | null
          node_id: string
          remark?: string | null
          s_no?: string | null
          status?: boolean | null
          system_name?: string | null
          system_type_id: string
          updated_at?: string | null
        }
        Update: {
          commissioned_on?: string | null
          created_at?: string | null
          id?: string
          ip_address?: unknown | null
          maintenance_terminal_id?: string | null
          node_id?: string
          remark?: string | null
          s_no?: string | null
          status?: boolean | null
          system_name?: string | null
          system_type_id?: string
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "systems_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "systems_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "systems_node_id_fkey"
            columns: ["node_id"]
            isOneToOne: false
            referencedRelation: "nodes"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "systems_node_id_fkey"
            columns: ["node_id"]
            isOneToOne: false
            referencedRelation: "v_nodes_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "systems_system_type_id_fkey"
            columns: ["system_type_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "systems_system_type_id_fkey"
            columns: ["system_type_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
        ]
      }
      user_activity_logs: {
        Row: {
          action_type: string
          created_at: string | null
          details: string | null
          id: number
          new_data: Json | null
          old_data: Json | null
          record_id: string | null
          table_name: string | null
          user_id: string | null
          user_role: string | null
        }
        Insert: {
          action_type: string
          created_at?: string | null
          details?: string | null
          id?: number
          new_data?: Json | null
          old_data?: Json | null
          record_id?: string | null
          table_name?: string | null
          user_id?: string | null
          user_role?: string | null
        }
        Update: {
          action_type?: string
          created_at?: string | null
          details?: string | null
          id?: number
          new_data?: Json | null
          old_data?: Json | null
          record_id?: string | null
          table_name?: string | null
          user_id?: string | null
          user_role?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "user_activity_logs_user_id_fkey"
            columns: ["user_id"]
            isOneToOne: false
            referencedRelation: "v_user_profiles_extended"
            referencedColumns: ["id"]
          },
        ]
      }
      user_profiles: {
        Row: {
          address: Json | null
          avatar_url: string | null
          created_at: string | null
          date_of_birth: string | null
          designation: string | null
          first_name: string
          id: string
          last_name: string
          phone_number: string | null
          preferences: Json | null
          role: string | null
          status: string | null
          updated_at: string | null
        }
        Insert: {
          address?: Json | null
          avatar_url?: string | null
          created_at?: string | null
          date_of_birth?: string | null
          designation?: string | null
          first_name: string
          id: string
          last_name: string
          phone_number?: string | null
          preferences?: Json | null
          role?: string | null
          status?: string | null
          updated_at?: string | null
        }
        Update: {
          address?: Json | null
          avatar_url?: string | null
          created_at?: string | null
          date_of_birth?: string | null
          designation?: string | null
          first_name?: string
          id?: string
          last_name?: string
          phone_number?: string | null
          preferences?: Json | null
          role?: string | null
          status?: string | null
          updated_at?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "user_profiles_id_fkey"
            columns: ["id"]
            isOneToOne: true
            referencedRelation: "v_user_profiles_extended"
            referencedColumns: ["id"]
          },
        ]
      }
      vmux_connections: {
        Row: {
          c_code: string | null
          channel: string | null
          subscriber: string | null
          system_connection_id: string
          tk: string | null
        }
        Insert: {
          c_code?: string | null
          channel?: string | null
          subscriber?: string | null
          system_connection_id: string
          tk?: string | null
        }
        Update: {
          c_code?: string | null
          channel?: string | null
          subscriber?: string | null
          system_connection_id?: string
          tk?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "vmux_connections_system_connection_id_fkey"
            columns: ["system_connection_id"]
            isOneToOne: true
            referencedRelation: "system_connections"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "vmux_connections_system_connection_id_fkey"
            columns: ["system_connection_id"]
            isOneToOne: true
            referencedRelation: "v_system_connections_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      vmux_systems: {
        Row: {
          system_id: string
          vm_id: string | null
        }
        Insert: {
          system_id: string
          vm_id?: string | null
        }
        Update: {
          system_id?: string
          vm_id?: string | null
        }
        Relationships: [
          {
            foreignKeyName: "vmux_systems_system_id_fkey"
            columns: ["system_id"]
            isOneToOne: true
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "vmux_systems_system_id_fkey"
            columns: ["system_id"]
            isOneToOne: true
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
        ]
      }
    }
    Views: {
      v_cable_utilization: {
        Row: {
          available_fibers: number | null
          cable_id: string | null
          capacity: number | null
          route_name: string | null
          used_fibers: number | null
          utilization_percent: number | null
        }
        Relationships: []
      }
      v_employee_designations_with_count: {
        Row: {
          active_count: number | null
          created_at: string | null
          id: string | null
          inactive_count: number | null
          name: string | null
          parent_id: string | null
          status: boolean | null
          total_count: number | null
          updated_at: string | null
        }
        Relationships: [
          {
            foreignKeyName: "employee_designations_parent_id_fkey"
            columns: ["parent_id"]
            isOneToOne: false
            referencedRelation: "employee_designations"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "employee_designations_parent_id_fkey"
            columns: ["parent_id"]
            isOneToOne: false
            referencedRelation: "v_employee_designations_with_count"
            referencedColumns: ["id"]
          },
        ]
      }
      v_employees_with_count: {
        Row: {
          active_count: number | null
          created_at: string | null
          employee_addr: string | null
          employee_contact: string | null
          employee_designation_id: string | null
          employee_designation_name: string | null
          employee_dob: string | null
          employee_doj: string | null
          employee_email: string | null
          employee_name: string | null
          employee_pers_no: string | null
          id: string | null
          inactive_count: number | null
          maintenance_terminal_id: string | null
          remark: string | null
          status: boolean | null
          total_count: number | null
          updated_at: string | null
        }
        Relationships: [
          {
            foreignKeyName: "employees_employee_designation_id_fkey"
            columns: ["employee_designation_id"]
            isOneToOne: false
            referencedRelation: "employee_designations"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "employees_employee_designation_id_fkey"
            columns: ["employee_designation_id"]
            isOneToOne: false
            referencedRelation: "v_employee_designations_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "employees_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "employees_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
        ]
      }
      v_end_to_end_paths: {
        Row: {
          destination_system_id: string | null
          operational_status: string | null
          path_id: string | null
          path_name: string | null
          route_names: string | null
          segment_count: number | null
          source_system_id: string | null
          total_distance_km: number | null
          total_loss_db: number | null
        }
        Relationships: [
          {
            foreignKeyName: "logical_fiber_paths_destination_system_id_fkey"
            columns: ["destination_system_id"]
            isOneToOne: false
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "logical_fiber_paths_destination_system_id_fkey"
            columns: ["destination_system_id"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "logical_fiber_paths_source_system_id_fkey"
            columns: ["source_system_id"]
            isOneToOne: false
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "logical_fiber_paths_source_system_id_fkey"
            columns: ["source_system_id"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      v_lookup_types_with_count: {
        Row: {
          active_count: number | null
          category: string | null
          code: string | null
          created_at: string | null
          description: string | null
          id: string | null
          inactive_count: number | null
          is_system_default: boolean | null
          name: string | null
          sort_order: number | null
          status: boolean | null
          total_count: number | null
          updated_at: string | null
        }
        Relationships: []
      }
      v_maintenance_areas_with_count: {
        Row: {
          active_count: number | null
          address: string | null
          area_type_id: string | null
          code: string | null
          contact_number: string | null
          contact_person: string | null
          created_at: string | null
          email: string | null
          id: string | null
          inactive_count: number | null
          latitude: number | null
          longitude: number | null
          maintenance_area_type_category: string | null
          maintenance_area_type_code: string | null
          maintenance_area_type_created_at: string | null
          maintenance_area_type_is_system_default: boolean | null
          maintenance_area_type_name: string | null
          maintenance_area_type_sort_order: number | null
          maintenance_area_type_status: boolean | null
          maintenance_area_type_updated_at: string | null
          name: string | null
          parent_id: string | null
          status: boolean | null
          total_count: number | null
          updated_at: string | null
        }
        Relationships: [
          {
            foreignKeyName: "maintenance_areas_area_type_id_fkey"
            columns: ["area_type_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "maintenance_areas_area_type_id_fkey"
            columns: ["area_type_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "maintenance_areas_parent_id_fkey"
            columns: ["parent_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "maintenance_areas_parent_id_fkey"
            columns: ["parent_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
        ]
      }
      v_nodes_complete: {
        Row: {
          active_count: number | null
          created_at: string | null
          id: string | null
          inactive_count: number | null
          latitude: number | null
          longitude: number | null
          maintenance_area_code: string | null
          maintenance_area_name: string | null
          maintenance_area_type_name: string | null
          maintenance_terminal_id: string | null
          name: string | null
          node_type_code: string | null
          node_type_id: string | null
          node_type_name: string | null
          remark: string | null
          status: boolean | null
          total_count: number | null
          updated_at: string | null
        }
        Relationships: [
          {
            foreignKeyName: "nodes_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "nodes_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "nodes_node_type_id_fkey"
            columns: ["node_type_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "nodes_node_type_id_fkey"
            columns: ["node_type_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
        ]
      }
      v_ofc_cables_complete: {
        Row: {
          active_count: number | null
          asset_no: string | null
          capacity: number | null
          commissioned_on: string | null
          created_at: string | null
          current_rkm: number | null
          en_id: string | null
          id: string | null
          inactive_count: number | null
          maintenance_area_code: string | null
          maintenance_area_name: string | null
          maintenance_terminal_id: string | null
          ofc_owner_code: string | null
          ofc_owner_id: string | null
          ofc_owner_name: string | null
          ofc_type_code: string | null
          ofc_type_id: string | null
          ofc_type_name: string | null
          remark: string | null
          route_name: string | null
          sn_id: string | null
          status: boolean | null
          total_count: number | null
          transnet_id: string | null
          transnet_rkm: number | null
          updated_at: string | null
        }
        Relationships: [
          {
            foreignKeyName: "ofc_cables_en_id_fkey"
            columns: ["en_id"]
            isOneToOne: false
            referencedRelation: "nodes"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_en_id_fkey"
            columns: ["en_id"]
            isOneToOne: false
            referencedRelation: "v_nodes_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_ofc_owner_id_fkey"
            columns: ["ofc_owner_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_ofc_owner_id_fkey"
            columns: ["ofc_owner_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_ofc_type_id_fkey"
            columns: ["ofc_type_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_ofc_type_id_fkey"
            columns: ["ofc_type_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_sn_id_fkey"
            columns: ["sn_id"]
            isOneToOne: false
            referencedRelation: "nodes"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_sn_id_fkey"
            columns: ["sn_id"]
            isOneToOne: false
            referencedRelation: "v_nodes_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      v_ofc_connections_complete: {
        Row: {
          active_count: number | null
          connection_category: string | null
          connection_type: string | null
          created_at: string | null
          destination_port: string | null
          en_dom: string | null
          en_id: string | null
          en_name: string | null
          en_power_dbm: number | null
          fiber_no_en: number | null
          fiber_no_sn: number | null
          id: string | null
          inactive_count: number | null
          logical_path_id: string | null
          maintenance_area_name: string | null
          ofc_id: string | null
          ofc_route_name: string | null
          ofc_type_name: string | null
          otdr_distance_en_km: number | null
          otdr_distance_sn_km: number | null
          path_segment_order: number | null
          remark: string | null
          route_loss_db: number | null
          sn_dom: string | null
          sn_id: string | null
          sn_name: string | null
          sn_power_dbm: number | null
          source_port: string | null
          status: boolean | null
          system_id: string | null
          system_name: string | null
          total_count: number | null
          updated_at: string | null
        }
        Relationships: [
          {
            foreignKeyName: "fk_connection_type"
            columns: ["connection_category", "connection_type"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["category", "name"]
          },
          {
            foreignKeyName: "fk_connection_type"
            columns: ["connection_category", "connection_type"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["category", "name"]
          },
          {
            foreignKeyName: "fk_connection_type"
            columns: ["connection_category", "connection_type"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: [
              "maintenance_area_type_category",
              "maintenance_area_type_name",
            ]
          },
          {
            foreignKeyName: "fk_connection_type"
            columns: ["connection_category", "connection_type"]
            isOneToOne: false
            referencedRelation: "v_rings_with_count"
            referencedColumns: ["ring_type_category", "ring_type_name"]
          },
          {
            foreignKeyName: "fk_connection_type"
            columns: ["connection_category", "connection_type"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["system_category", "system_type_name"]
          },
          {
            foreignKeyName: "fk_ofc_connections_logical_path"
            columns: ["logical_path_id"]
            isOneToOne: false
            referencedRelation: "logical_fiber_paths"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "fk_ofc_connections_logical_path"
            columns: ["logical_path_id"]
            isOneToOne: false
            referencedRelation: "v_end_to_end_paths"
            referencedColumns: ["path_id"]
          },
          {
            foreignKeyName: "fk_ofc_connections_system"
            columns: ["system_id"]
            isOneToOne: false
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "fk_ofc_connections_system"
            columns: ["system_id"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_en_id_fkey"
            columns: ["en_id"]
            isOneToOne: false
            referencedRelation: "nodes"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_en_id_fkey"
            columns: ["en_id"]
            isOneToOne: false
            referencedRelation: "v_nodes_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_sn_id_fkey"
            columns: ["sn_id"]
            isOneToOne: false
            referencedRelation: "nodes"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_cables_sn_id_fkey"
            columns: ["sn_id"]
            isOneToOne: false
            referencedRelation: "v_nodes_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_connections_ofc_id_fkey"
            columns: ["ofc_id"]
            isOneToOne: false
            referencedRelation: "ofc_cables"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ofc_connections_ofc_id_fkey"
            columns: ["ofc_id"]
            isOneToOne: false
            referencedRelation: "v_cable_utilization"
            referencedColumns: ["cable_id"]
          },
          {
            foreignKeyName: "ofc_connections_ofc_id_fkey"
            columns: ["ofc_id"]
            isOneToOne: false
            referencedRelation: "v_ofc_cables_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      v_rings_with_count: {
        Row: {
          active_count: number | null
          created_at: string | null
          description: string | null
          id: string | null
          inactive_count: number | null
          maintenance_area_area_type_id: string | null
          maintenance_area_code: string | null
          maintenance_area_contact_number: string | null
          maintenance_area_contact_person: string | null
          maintenance_area_created_at: string | null
          maintenance_area_email: string | null
          maintenance_area_latitude: number | null
          maintenance_area_longitude: number | null
          maintenance_area_name: string | null
          maintenance_area_parent_id: string | null
          maintenance_area_status: boolean | null
          maintenance_area_updated_at: string | null
          maintenance_terminal_id: string | null
          name: string | null
          ring_type_category: string | null
          ring_type_code: string | null
          ring_type_created_at: string | null
          ring_type_id: string | null
          ring_type_is_system_default: boolean | null
          ring_type_name: string | null
          ring_type_sort_order: number | null
          ring_type_status: boolean | null
          ring_type_updated_at: string | null
          status: boolean | null
          total_count: number | null
          total_nodes: number | null
          updated_at: string | null
        }
        Relationships: [
          {
            foreignKeyName: "maintenance_areas_area_type_id_fkey"
            columns: ["maintenance_area_area_type_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "maintenance_areas_area_type_id_fkey"
            columns: ["maintenance_area_area_type_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "maintenance_areas_parent_id_fkey"
            columns: ["maintenance_area_parent_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "maintenance_areas_parent_id_fkey"
            columns: ["maintenance_area_parent_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "rings_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "rings_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "rings_ring_type_id_fkey"
            columns: ["ring_type_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "rings_ring_type_id_fkey"
            columns: ["ring_type_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
        ]
      }
      v_system_connections_complete: {
        Row: {
          active_count: number | null
          bandwidth_mbps: number | null
          commissioned_on: string | null
          connected_system_name: string | null
          connected_system_type_name: string | null
          created_at: string | null
          en_interface: string | null
          en_ip: unknown | null
          en_name: string | null
          en_node_name: string | null
          id: string | null
          inactive_count: number | null
          maan_bandwidth_allocated_mbps: number | null
          maan_customer_name: string | null
          maan_fiber_in: number | null
          maan_fiber_out: number | null
          maan_sfp_capacity: string | null
          maan_sfp_port: string | null
          maan_sfp_serial_no: string | null
          maan_sfp_type_name: string | null
          media_type_name: string | null
          remark: string | null
          sdh_stm_no: string | null
          sn_interface: string | null
          sn_ip: unknown | null
          sn_name: string | null
          sn_node_name: string | null
          status: boolean | null
          system_id: string | null
          system_name: string | null
          system_type_name: string | null
          total_count: number | null
          updated_at: string | null
          vlan: string | null
          vmux_tk: string | null
        }
        Relationships: [
          {
            foreignKeyName: "system_connections_system_id_fkey"
            columns: ["system_id"]
            isOneToOne: false
            referencedRelation: "systems"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "system_connections_system_id_fkey"
            columns: ["system_id"]
            isOneToOne: false
            referencedRelation: "v_systems_complete"
            referencedColumns: ["id"]
          },
        ]
      }
      v_systems_complete: {
        Row: {
          active_count: number | null
          commissioned_on: string | null
          created_at: string | null
          id: string | null
          inactive_count: number | null
          ip_address: unknown | null
          latitude: number | null
          longitude: number | null
          maintenance_terminal_id: string | null
          node_id: string | null
          node_name: string | null
          remark: string | null
          ring_id: string | null
          ring_logical_area_name: string | null
          s_no: string | null
          sdh_gne: string | null
          sdh_make: string | null
          status: boolean | null
          system_category: string | null
          system_maintenance_terminal_name: string | null
          system_name: string | null
          system_type_code: string | null
          system_type_id: string | null
          system_type_name: string | null
          total_count: number | null
          updated_at: string | null
          vmux_vm_id: string | null
        }
        Relationships: [
          {
            foreignKeyName: "ring_based_systems_ring_id_fkey"
            columns: ["ring_id"]
            isOneToOne: false
            referencedRelation: "rings"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "ring_based_systems_ring_id_fkey"
            columns: ["ring_id"]
            isOneToOne: false
            referencedRelation: "v_rings_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "systems_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "maintenance_areas"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "systems_maintenance_terminal_id_fkey"
            columns: ["maintenance_terminal_id"]
            isOneToOne: false
            referencedRelation: "v_maintenance_areas_with_count"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "systems_node_id_fkey"
            columns: ["node_id"]
            isOneToOne: false
            referencedRelation: "nodes"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "systems_node_id_fkey"
            columns: ["node_id"]
            isOneToOne: false
            referencedRelation: "v_nodes_complete"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "systems_system_type_id_fkey"
            columns: ["system_type_id"]
            isOneToOne: false
            referencedRelation: "lookup_types"
            referencedColumns: ["id"]
          },
          {
            foreignKeyName: "systems_system_type_id_fkey"
            columns: ["system_type_id"]
            isOneToOne: false
            referencedRelation: "v_lookup_types_with_count"
            referencedColumns: ["id"]
          },
        ]
      }
      v_user_profiles_extended: {
        Row: {
          account_age_days: number | null
          address: Json | null
          auth_updated_at: string | null
          avatar_url: string | null
          computed_status: string | null
          created_at: string | null
          date_of_birth: string | null
          designation: string | null
          email: string | null
          email_confirmed_at: string | null
          first_name: string | null
          full_name: string | null
          id: string | null
          is_email_verified: boolean | null
          is_phone_verified: boolean | null
          is_super_admin: boolean | null
          last_activity_period: string | null
          last_name: string | null
          last_sign_in_at: string | null
          phone_confirmed_at: string | null
          phone_number: string | null
          preferences: Json | null
          raw_app_meta_data: Json | null
          raw_user_meta_data: Json | null
          role: string | null
          status: string | null
          updated_at: string | null
        }
        Relationships: []
      }
    }
    Functions: {
      add_lookup_type: {
        Args: {
          p_category: string
          p_code?: string
          p_description?: string
          p_name: string
          p_sort_order?: number
        }
        Returns: string
      }
      admin_bulk_delete_users: {
        Args: { user_ids: string[] }
        Returns: boolean
      }
      admin_bulk_update_role: {
        Args: { new_role: string; user_ids: string[] }
        Returns: boolean
      }
      admin_bulk_update_status: {
        Args: { new_status: string; user_ids: string[] }
        Returns: boolean
      }
      admin_get_all_users: {
        Args: {
          date_from?: string
          date_to?: string
          filter_role?: string
          filter_status?: string
          page_limit?: number
          page_offset?: number
          search_query?: string
        }
        Returns: {
          address: Json
          avatar_url: string
          created_at: string
          date_of_birth: string
          designation: string
          email: string
          first_name: string
          id: string
          is_email_verified: boolean
          last_name: string
          last_sign_in_at: string
          phone_number: string
          preferences: Json
          role: string
          status: string
          total_count: number
          updated_at: string
        }[]
      }
      admin_get_all_users_extended: {
        Args: {
          date_from?: string
          date_to?: string
          filter_activity?: string
          filter_role?: string
          filter_status?: string
          page_limit?: number
          page_offset?: number
          search_query?: string
        }
        Returns: {
          account_age_days: number
          active_count: number
          address: Json
          avatar_url: string
          computed_status: string
          created_at: string
          date_of_birth: string
          designation: string
          email: string
          first_name: string
          full_name: string
          id: string
          inactive_count: number
          is_email_verified: boolean
          is_super_admin: boolean
          last_activity_period: string
          last_name: string
          last_sign_in_at: string
          phone_number: string
          preferences: Json
          role: string
          status: string
          total_count: number
          updated_at: string
        }[]
      }
      admin_get_user_by_id: {
        Args: { user_id: string }
        Returns: {
          address: Json
          avatar_url: string
          created_at: string
          date_of_birth: string
          designation: string
          email: string
          first_name: string
          id: string
          is_email_verified: boolean
          last_name: string
          last_sign_in_at: string
          phone_number: string
          preferences: Json
          role: string
          status: string
          updated_at: string
        }[]
      }
      admin_update_user_profile: {
        Args: {
          update_address?: Json
          update_avatar_url?: string
          update_date_of_birth?: string
          update_designation?: string
          update_first_name?: string
          update_last_name?: string
          update_phone_number?: string
          update_preferences?: Json
          update_role?: string
          update_status?: string
          user_id: string
        }
        Returns: boolean
      }
      aggregate_query: {
        Args: {
          aggregation_options: Json
          filters?: Json
          order_by?: Json
          table_name: string
        }
        Returns: {
          result: Json
        }[]
      }
      bulk_update: {
        Args: { batch_size?: number; table_name: string; updates: Json }
        Returns: Json
      }
      execute_sql: {
        Args: { sql_query: string }
        Returns: Json
      }
      get_dashboard_overview: {
        Args: Record<PropertyKey, never>
        Returns: Json
      }
      get_entity_counts: {
        Args: { p_entity_name: string; p_filters?: Json }
        Returns: {
          active_count: number
          inactive_count: number
          total_count: number
        }[]
      }
      get_lookup_type_id: {
        Args: { p_category: string; p_name: string }
        Returns: string
      }
      get_lookup_types_by_category: {
        Args: { p_category: string }
        Returns: {
          code: string
          description: string
          id: string
          name: string
          sort_order: number
        }[]
      }
      get_my_role: {
        Args: Record<PropertyKey, never>
        Returns: string
      }
      get_my_user_details: {
        Args: Record<PropertyKey, never>
        Returns: {
          address: Json
          avatar_url: string
          created_at: string
          date_of_birth: string
          designation: string
          email: string
          first_name: string
          id: string
          is_email_verified: boolean
          is_super_admin: boolean
          last_name: string
          last_sign_in_at: string
          phone_number: string
          preferences: Json
          role: string
          updated_at: string
        }[]
      }
      get_paged_employee_designations_with_count: {
        Args: {
          p_filters?: Json
          p_limit: number
          p_offset: number
          p_order_by?: string
          p_order_dir?: string
        }
        Returns: {
          active_count: number
          created_at: string
          id: string
          inactive_count: number
          name: string
          parent_id: string
          status: boolean
          total_count: number
          updated_at: string
        }[]
      }
      get_paged_employees_with_count: {
        Args: {
          p_filters?: Json
          p_limit: number
          p_offset: number
          p_order_by?: string
          p_order_dir?: string
        }
        Returns: {
          active_count: number
          created_at: string
          employee_addr: string
          employee_contact: string
          employee_designation_id: string
          employee_designation_name: string
          employee_dob: string
          employee_doj: string
          employee_email: string
          employee_name: string
          employee_pers_no: string
          id: string
          inactive_count: number
          maintenance_terminal_id: string
          remark: string
          status: boolean
          total_count: number
          updated_at: string
        }[]
      }
      get_paged_lookup_types_with_count: {
        Args: {
          p_filters?: Json
          p_limit: number
          p_offset: number
          p_order_by?: string
          p_order_dir?: string
        }
        Returns: {
          active_count: number
          category: string
          code: string
          created_at: string
          description: string
          id: string
          inactive_count: number
          is_system_default: boolean
          name: string
          sort_order: number
          status: boolean
          total_count: number
          updated_at: string
        }[]
      }
      get_paged_maintenance_areas_with_count: {
        Args: {
          p_filters?: Json
          p_limit: number
          p_offset: number
          p_order_by?: string
          p_order_dir?: string
        }
        Returns: {
          active_count: number
          address: string
          area_type_id: string
          code: string
          contact_number: string
          contact_person: string
          created_at: string
          email: string
          id: string
          inactive_count: number
          latitude: number
          longitude: number
          maintenance_area_type_category: string
          maintenance_area_type_code: string
          maintenance_area_type_created_at: string
          maintenance_area_type_is_system_default: boolean
          maintenance_area_type_name: string
          maintenance_area_type_sort_order: number
          maintenance_area_type_status: boolean
          maintenance_area_type_updated_at: string
          name: string
          parent_id: string
          status: boolean
          total_count: number
          updated_at: string
        }[]
      }
      get_paged_nodes_complete: {
        Args: {
          p_filters?: Json
          p_limit: number
          p_offset: number
          p_order_by?: string
          p_order_dir?: string
        }
        Returns: {
          active_count: number
          created_at: string
          id: string
          inactive_count: number
          latitude: number
          longitude: number
          maintenance_area_code: string
          maintenance_area_name: string
          maintenance_area_type_name: string
          maintenance_terminal_id: string
          name: string
          node_type_code: string
          node_type_id: string
          node_type_name: string
          remark: string
          status: boolean
          total_count: number
          updated_at: string
        }[]
      }
      get_paged_ofc_cables_complete: {
        Args: {
          p_filters?: Json
          p_limit: number
          p_offset: number
          p_order_by?: string
          p_order_dir?: string
        }
        Returns: {
          active_count: number
          asset_no: string
          capacity: number
          commissioned_on: string
          created_at: string
          current_rkm: number
          en_id: string
          id: string
          inactive_count: number
          maintenance_area_code: string
          maintenance_area_name: string
          maintenance_terminal_id: string
          ofc_owner_code: string
          ofc_owner_id: string
          ofc_owner_name: string
          ofc_type_code: string
          ofc_type_id: string
          ofc_type_name: string
          remark: string
          route_name: string
          sn_id: string
          status: boolean
          total_count: number
          transnet_id: string
          transnet_rkm: number
          updated_at: string
        }[]
      }
      get_paged_ofc_connections_complete: {
        Args: {
          p_filters?: Json
          p_limit: number
          p_offset: number
          p_order_by?: string
          p_order_dir?: string
        }
        Returns: {
          active_count: number
          created_at: string
          en_dom: string
          en_id: string
          en_name: string
          fiber_no_en: number
          fiber_no_sn: number
          id: string
          inactive_count: number
          maintenance_area_name: string
          ofc_id: string
          ofc_route_name: string
          ofc_type_name: string
          otdr_distance_en_km: number
          otdr_distance_sn_km: number
          remark: string
          sn_dom: string
          sn_id: string
          sn_name: string
          status: boolean
          system_name: string
          total_count: number
          updated_at: string
        }[]
      }
      get_paged_rings_with_count: {
        Args: {
          p_filters?: Json
          p_limit: number
          p_offset: number
          p_order_by?: string
          p_order_dir?: string
        }
        Returns: {
          active_count: number
          created_at: string
          description: string
          id: string
          inactive_count: number
          maintenance_area_area_type_id: string
          maintenance_area_code: string
          maintenance_area_contact_number: string
          maintenance_area_contact_person: string
          maintenance_area_created_at: string
          maintenance_area_email: string
          maintenance_area_latitude: number
          maintenance_area_longitude: number
          maintenance_area_name: string
          maintenance_area_parent_id: string
          maintenance_area_status: boolean
          maintenance_area_updated_at: string
          maintenance_terminal_id: string
          name: string
          ring_type_category: string
          ring_type_code: string
          ring_type_created_at: string
          ring_type_id: string
          ring_type_is_system_default: boolean
          ring_type_name: string
          ring_type_sort_order: number
          ring_type_status: boolean
          ring_type_updated_at: string
          status: boolean
          total_count: number
          total_nodes: number
          updated_at: string
        }[]
      }
      get_paged_system_connections_complete: {
        Args: {
          p_filters?: Json
          p_limit: number
          p_offset: number
          p_order_by?: string
          p_order_dir?: string
        }
        Returns: {
          active_count: number
          bandwidth_mbps: number
          commissioned_on: string
          connected_system_name: string
          connected_system_type_name: string
          created_at: string
          en_interface: string
          en_ip: string
          en_name: string
          en_node_name: string
          id: string
          inactive_count: number
          maan_bandwidth_allocated_mbps: number
          maan_customer_name: string
          maan_fiber_in: number
          maan_fiber_out: number
          maan_sfp_capacity: string
          maan_sfp_port: string
          maan_sfp_serial_no: string
          maan_sfp_type_name: string
          media_type_name: string
          remark: string
          sdh_a_customer: string
          sdh_a_slot: string
          sdh_b_customer: string
          sdh_b_slot: string
          sdh_carrier: string
          sdh_stm_no: string
          sn_interface: string
          sn_ip: string
          sn_name: string
          sn_node_name: string
          status: boolean
          system_id: string
          system_name: string
          system_type_name: string
          total_count: number
          updated_at: string
          vlan: string
          vmux_c_code: string
          vmux_channel: string
          vmux_subscriber: string
          vmux_tk: string
        }[]
      }
      get_paged_v_systems_complete: {
        Args: {
          p_filters?: Json
          p_limit: number
          p_offset: number
          p_order_by?: string
          p_order_dir?: string
        }
        Returns: {
          active_count: number
          commissioned_on: string
          created_at: string
          id: string
          inactive_count: number
          ip_address: unknown
          latitude: number
          longitude: number
          node_name: string
          remark: string
          ring_id: string
          ring_logical_area_name: string
          s_no: string
          sdh_gne: string
          sdh_make: string
          status: boolean
          system_category: string
          system_maintenance_terminal_name: string
          system_name: string
          system_type_code: string
          system_type_name: string
          total_count: number
          updated_at: string
          vmux_vm_id: string
        }[]
      }
      get_unique_values: {
        Args: {
          column_name: string
          filters?: Json
          limit_count?: number
          order_by?: Json
          table_name: string
        }
        Returns: {
          value: Json
        }[]
      }
      is_super_admin: {
        Args: Record<PropertyKey, never>
        Returns: boolean
      }
      log_user_activity: {
        Args: {
          p_action_type: string
          p_details?: string
          p_new_data?: Json
          p_old_data?: Json
          p_record_id?: string
          p_table_name?: string
        }
        Returns: undefined
      }
    }
    Enums: {
      [_ in never]: never
    }
    CompositeTypes: {
      [_ in never]: never
    }
  }
}

type DatabaseWithoutInternals = Omit<Database, "__InternalSupabase">

type DefaultSchema = DatabaseWithoutInternals[Extract<keyof Database, "public">]

export type Tables<
  DefaultSchemaTableNameOrOptions extends
    | keyof (DefaultSchema["Tables"] & DefaultSchema["Views"])
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"] &
        DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Views"])
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? (DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"] &
      DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Views"])[TableName] extends {
      Row: infer R
    }
    ? R
    : never
  : DefaultSchemaTableNameOrOptions extends keyof (DefaultSchema["Tables"] &
        DefaultSchema["Views"])
    ? (DefaultSchema["Tables"] &
        DefaultSchema["Views"])[DefaultSchemaTableNameOrOptions] extends {
        Row: infer R
      }
      ? R
      : never
    : never

export type TablesInsert<
  DefaultSchemaTableNameOrOptions extends
    | keyof DefaultSchema["Tables"]
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Insert: infer I
    }
    ? I
    : never
  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema["Tables"]
    ? DefaultSchema["Tables"][DefaultSchemaTableNameOrOptions] extends {
        Insert: infer I
      }
      ? I
      : never
    : never

export type TablesUpdate<
  DefaultSchemaTableNameOrOptions extends
    | keyof DefaultSchema["Tables"]
    | { schema: keyof DatabaseWithoutInternals },
  TableName extends DefaultSchemaTableNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"]
    : never = never,
> = DefaultSchemaTableNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaTableNameOrOptions["schema"]]["Tables"][TableName] extends {
      Update: infer U
    }
    ? U
    : never
  : DefaultSchemaTableNameOrOptions extends keyof DefaultSchema["Tables"]
    ? DefaultSchema["Tables"][DefaultSchemaTableNameOrOptions] extends {
        Update: infer U
      }
      ? U
      : never
    : never

export type Enums<
  DefaultSchemaEnumNameOrOptions extends
    | keyof DefaultSchema["Enums"]
    | { schema: keyof DatabaseWithoutInternals },
  EnumName extends DefaultSchemaEnumNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions["schema"]]["Enums"]
    : never = never,
> = DefaultSchemaEnumNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[DefaultSchemaEnumNameOrOptions["schema"]]["Enums"][EnumName]
  : DefaultSchemaEnumNameOrOptions extends keyof DefaultSchema["Enums"]
    ? DefaultSchema["Enums"][DefaultSchemaEnumNameOrOptions]
    : never

export type CompositeTypes<
  PublicCompositeTypeNameOrOptions extends
    | keyof DefaultSchema["CompositeTypes"]
    | { schema: keyof DatabaseWithoutInternals },
  CompositeTypeName extends PublicCompositeTypeNameOrOptions extends {
    schema: keyof DatabaseWithoutInternals
  }
    ? keyof DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"]
    : never = never,
> = PublicCompositeTypeNameOrOptions extends {
  schema: keyof DatabaseWithoutInternals
}
  ? DatabaseWithoutInternals[PublicCompositeTypeNameOrOptions["schema"]]["CompositeTypes"][CompositeTypeName]
  : PublicCompositeTypeNameOrOptions extends keyof DefaultSchema["CompositeTypes"]
    ? DefaultSchema["CompositeTypes"][PublicCompositeTypeNameOrOptions]
    : never

export const Constants = {
  auth: {
    Enums: {
      aal_level: ["aal1", "aal2", "aal3"],
      code_challenge_method: ["s256", "plain"],
      factor_status: ["unverified", "verified"],
      factor_type: ["totp", "webauthn", "phone"],
      one_time_token_type: [
        "confirmation_token",
        "reauthentication_token",
        "recovery_token",
        "email_change_token_new",
        "email_change_token_current",
        "phone_change_token",
      ],
    },
  },
  public: {
    Enums: {},
  },
} as const

```

<!-- path: hnvtx/types/user-roles.ts -->
```typescript
// types/user-roles.ts

export enum UserRole {
    ADMIN = "admin",
    CPANADMIN = "cpan_admin",
    MAANADMIN = "maan_admin",
    SDHADMIN = "sdh_admin",
    VMUXADMIN = "vmux_admin",
    MNGADMIN = "mng_admin",
    VIEWER = "viewer",
    AUTHENTICATED = "authenticated",
    ANON = "anon",
}
```

<!-- path: hnvtx/types/relational-row-types.ts -->
```typescript
import { Row } from "@/hooks/database";

export type RingRowsWithRelations = Row<'rings'> & {
  ring_type?: {
    id: string;
    code: string;
  } | null;
  maintenance_terminal?: {
    id: string;
    name: string;
  } | null;
};
  
  export type EmployeeDesignationRowsWithRelations = Row<'employee_designations'> & {
    parent?: {
      id: string;
      name: string;
    } | null;
  };
  
  export type EmployeeRowsWithRelations = Row<'employees'> & {
    employee_designation?: {
      id: string;
      name: string;
    } | null;
    maintenance_terminal?: {
      id: string;
      name: string;
    } | null;
  };
  
  export type FiberJointConnectionRowsWithRelations = Row<'fiber_joint_connections'> & {
    input_ofc_cable?: {
      id: string;
      route_name: string;
    } | null;
    fiber_joint?: {
      id: string;
      joint_name: string;
    } | null;
    logical_fiber_path?: {
      id: string;
      path_name: string;
    } | null;
    output_ofc_cable?: {
      id: string;
      route_name: string;
    } | null;
  };
  
  export type FiberJointRowsWithRelations = Row<'fiber_joints'> & {
    maintenance_area?: {
      id: string;
      name: string;
    } | null;
    node?: {
      id: string;
      name: string;
    } | null;
    joint_type_lookup?: {
      category: string;
      name: string;
    } | null;
  };
  
  export type LogicalFiberPathRowsWithRelations = Row<'logical_fiber_paths'> & {
    operational_status_lookup?: {
      category: string;
      name: string;
    } | null;
    path_type_lookup?: {
      category: string;
      name: string;
    } | null;
    destination_system?: {
      id: string;
      system_name: string;
    } | null;
    source_system?: {
      id: string;
      system_name: string;
    } | null;
  };
  
  
  export type MaintenanceAreaRowsWithRelations = Row<'maintenance_areas'> & {
    area_type?: {
      id: string;
      name: string;
    } | null;
    parent?: {
      id: string;
      name: string;
    } | null;
  };
  
  export type ManagementPortRowsWithRelations = Row<'management_ports'> & {
    node?: {
      id: string;
      name: string;
    } | null;
    system?: {
      id: string;
      system_name: string;
    } | null;
  };
  
  export type NodeRowsWithRelations = Row<'nodes'> & {
    maintenance_terminal?: {
      id: string;
      name: string;
    } | null;
    node_type?: {
      id: string;
      name: string;
    } | null;
  };
  
  export type OfcCableRowsWithRelations = Row<'ofc_cables'> & {
    en_node?: {
      id: string;
      name: string;
    } | null;
    maintenance_terminal?: {
      id: string;
      name: string;
    } | null;
    ofc_owner?: {
      id: string;
      name: string;
    } | null;
    ofc_type?: {
      id: string;
      name: string;
    } | null;
    sn_node?: {
      id: string;
      name: string;
    } | null;
  };
  
  export type OfcConnectionRowsWithRelations = Row<'ofc_connections'> & {
    connection_type_lookup?: {
      category: string;
      name: string;
    } | null;
    logical_fiber_path?: {
      id: string;
      path_name: string;
    } | null;
    system?: {
      id: string;
      system_name: string;
    } | null;
    ofc_cable?: {
      id: string;
      route_name: string;
    } | null;
  };
  
  export type SdhConnectionRowsWithRelations = Row<'sdh_connections'> & {
    system_connection?: {
      id: string;
    } | null;
  };
  
  export type SdhNodeAssociationRowsWithRelations = Row<'sdh_node_associations'> & {
    node?: {
      id: string;
      name: string;
    } | null;
    sdh_system?: {
      system_id: string;
    } | null;
  };
  
  export type SdhSystemRowsWithRelations = Row<'sdh_systems'> & {
    system?: {
      id: string;
    } | null;
  };
  
  export type SystemConnectionRowsWithRelations = Row<'system_connections'> & {
    connected_system?: {
      id: string;
      system_name: string;
    } | null;
    en_system?: {
      id: string;
      system_name: string;
    } | null;
    media_type?: {
      id: string;
      name: string;
    } | null;
    sn_system?: {
      id: string;
      system_name: string;
    } | null;
    system?: {
      id: string;
      system_name: string;
    } | null;
  };
  
  // In your types file, update the SystemRowsWithRelations type:
export type SystemRowsWithRelations = Row<'systems'> & {
  maintenance_terminal?: {
    id: string;
    name: string;
  } | null;
  node?: {
    id: string;
    name: string;
  } | null;
  system_type?: {
    id: string;
    name: string;
  } | null;
  // Add this to make commissioned_on required
  commissioned_on: Date | null;
} & {
  // This makes all fields from the base Row type required
  [K in keyof Row<'systems'>]: Row<'systems'>[K];
};
  
  export type UserActivityLogRowsWithRelations = Row<'user_activity_logs'> & {
    user_profile_extended?: {
      id: string;
    } | null;
  };
  
  export type UserProfileRowsWithRelations = Row<'user_profiles'> & {
    user_profile_extended?: {
      id: string;
    } | null;
  };
  
  export type VmuxConnectionRowsWithRelations = Row<'vmux_connections'> & {
    system_connection?: {
      id: string;
    } | null;
  };
  
  export type VmuxSystemRowsWithRelations = Row<'vmux_systems'> & {
    system?: {
      id: string;
    } | null;
  };
```

<!-- path: hnvtx/types/pollyfills.d.ts -->
```typescript
declare module 'core-js/stable';
declare module 'regenerator-runtime/runtime';
declare module 'whatwg-fetch';
declare module 'intersection-observer';
declare module 'url-polyfill';
```

<!-- path: hnvtx/types/error-types.ts -->
```typescript
export type DetailedError = Error & { details?: unknown };

export function hasDetails(error: unknown): error is DetailedError {
  return typeof error === "object" && error !== null && "details" in error;
}
```

<!-- path: hnvtx/types/view-row-types.ts -->
```typescript
import { Row } from "@/hooks/database";

export type RingTypeRowsWithCount = Row<'v_rings_with_count'>
export type NodeRowsWithCount = Row<'v_nodes_complete'>
export type OfcCableRowsWithCount = Row<'v_ofc_cables_complete'>
export type OfcConnectionRowsWithCount = Row<'v_ofc_connections_complete'>
export type SystemConnectionRowsWithCount = Row<'v_system_connections_complete'>
export type SystemRowsWithCount = Row<'v_systems_complete'>
export type UserProfileRowsWithCount = Row<'v_user_profiles_extended'>
export type LookupTypeRowsWithCount = Row<'v_lookup_types_with_count'>
export type EmployeeDesignationRowsWithCount = Row<'v_employee_designations_with_count'>
export type MaintenanceAreaRowsWithCount = Row<'v_maintenance_areas_with_count'>
export type EmployeeRowsWithCount = Row<'v_employees_with_count'>

export type  SystemRowsWithCountWithRelations = Row<'v_systems_complete'> & {
    system_type?: {
        id: string;
        name: string;
    } | null;
    node?: {
        id: string;
        name: string;
    } | null;
    maintenance_terminal?: {
        id: string;
        name: string;
    } | null;
};
    

```

<!-- path: hnvtx/package-lock.json -->
```json
{
  "name": "hnvtx",
  "version": "0.1.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "hnvtx",
      "version": "0.1.0",
      "dependencies": {
        "@hookform/resolvers": "^5.2.1",
        "@radix-ui/react-select": "^2.2.6",
        "@supabase/ssr": "^0.6.1",
        "@supabase/supabase-js": "^2.56.0",
        "@tanstack/react-query": "^5.85.5",
        "@tanstack/react-query-devtools": "^5.85.1",
        "@types/bcrypt": "^6.0.0",
        "@types/pg": "^8.15.5",
        "@uppy/core": "^5.0.1",
        "@uppy/dashboard": "^5.0.1",
        "@uppy/drag-drop": "^5.0.1",
        "@uppy/react": "^5.0.2",
        "@uppy/webcam": "^5.0.0",
        "@uppy/xhr-upload": "^5.0.0",
        "bcrypt": "^6.0.0",
        "class-variance-authority": "^0.7.1",
        "clsx": "^2.1.1",
        "core-js": "^3.45.0",
        "exceljs": "^4.4.0",
        "framer-motion": "^12.23.12",
        "intersection-observer": "^0.12.2",
        "lodash.isequal": "^4.5.0",
        "lucide-react": "^0.541.0",
        "next": "^15.4.4",
        "papaparse": "^5.5.3",
        "pg": "^8.16.3",
        "react": "^19.1.0",
        "react-datepicker": "^8.7.0",
        "react-dom": "^19.1.0",
        "react-hook-form": "^7.62.0",
        "react-icons": "^5.5.0",
        "react-select": "^5.10.2",
        "regenerator-runtime": "^0.14.1",
        "sonner": "^2.0.7",
        "tailwind-merge": "^3.3.1",
        "url-polyfill": "^1.1.13",
        "use-debounce": "^10.0.5",
        "web-push": "^3.6.7",
        "whatwg-fetch": "^3.6.20",
        "xlsx": "^0.18.5",
        "zod": "^4.1.5",
        "zustand": "^5.0.7"
      },
      "devDependencies": {
        "@eslint/eslintrc": "^3.3.1",
        "@tailwindcss/postcss": "^4.1.11",
        "@tanstack/eslint-plugin-query": "^5.83.1",
        "@types/lodash": "^4.17.20",
        "@types/lodash.isequal": "^4.5.8",
        "@types/node": "^20.19.11",
        "@types/papaparse": "^5.3.16",
        "@types/react": "^19.1.10",
        "@types/react-dom": "^19.1.7",
        "@types/uuid": "^10.0.0",
        "@types/web-push": "^3.6.4",
        "dotenv-cli": "^10.0.0",
        "eslint": "^9.33.0",
        "eslint-config-next": "^15.4.4",
        "prism-react-renderer": "^2.4.1",
        "supabase": "^2.39.2",
        "tailwindcss": "^4.1.11",
        "tw-animate-css": "^1.3.7",
        "typescript": "^5.9.2"
      }
    },
    "node_modules/@alloc/quick-lru": {
      "version": "5.2.0",
      "resolved": "https://registry.npmjs.org/@alloc/quick-lru/-/quick-lru-5.2.0.tgz",
      "integrity": "sha512-UrcABB+4bUrFABwbluTIBErXwvbsU/V7TZWfmbgJfbkwiBuziS9gxdODUyuiecfdGQ85jglMW6juS3+z5TsKLw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/@ampproject/remapping": {
      "version": "2.3.0",
      "resolved": "https://registry.npmjs.org/@ampproject/remapping/-/remapping-2.3.0.tgz",
      "integrity": "sha512-30iZtAPgz+LTIYoeivqYo853f02jBYSd5uGnGpkFV0M3xOt9aN73erkgYAmZU43x4VfqcnLxW9Kpg3R5LC4YYw==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@jridgewell/gen-mapping": "^0.3.5",
        "@jridgewell/trace-mapping": "^0.3.24"
      },
      "engines": {
        "node": ">=6.0.0"
      }
    },
    "node_modules/@babel/code-frame": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/code-frame/-/code-frame-7.27.1.tgz",
      "integrity": "sha512-cjQ7ZlQ0Mv3b47hABuTevyTuYN4i+loJKGeV9flcCgIK37cCXRh+L1bd3iBHlynerhQ7BhCkn2BPbQUL+rGqFg==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-validator-identifier": "^7.27.1",
        "js-tokens": "^4.0.0",
        "picocolors": "^1.1.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/generator": {
      "version": "7.28.0",
      "resolved": "https://registry.npmjs.org/@babel/generator/-/generator-7.28.0.tgz",
      "integrity": "sha512-lJjzvrbEeWrhB4P3QBsH7tey117PjLZnDbLiQEKjQ/fNJTjuq4HSqgFA+UNSwZT8D7dxxbnuSBMsa1lrWzKlQg==",
      "license": "MIT",
      "dependencies": {
        "@babel/parser": "^7.28.0",
        "@babel/types": "^7.28.0",
        "@jridgewell/gen-mapping": "^0.3.12",
        "@jridgewell/trace-mapping": "^0.3.28",
        "jsesc": "^3.0.2"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-globals": {
      "version": "7.28.0",
      "resolved": "https://registry.npmjs.org/@babel/helper-globals/-/helper-globals-7.28.0.tgz",
      "integrity": "sha512-+W6cISkXFa1jXsDEdYA8HeevQT/FULhxzR99pxphltZcVaugps53THCeiWA8SguxxpSp3gKPiuYfSWopkLQ4hw==",
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-module-imports": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-module-imports/-/helper-module-imports-7.27.1.tgz",
      "integrity": "sha512-0gSFWUPNXNopqtIPQvlD5WgXYI5GY2kP2cCvoT8kczjbfcfuIljTbcWrulD1CIPIX2gt1wghbDy08yE1p+/r3w==",
      "license": "MIT",
      "dependencies": {
        "@babel/traverse": "^7.27.1",
        "@babel/types": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-string-parser": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-string-parser/-/helper-string-parser-7.27.1.tgz",
      "integrity": "sha512-qMlSxKbpRlAridDExk92nSobyDdpPijUq2DW6oDnUqd0iOGxmQjyqhMIihI9+zv4LPyZdRje2cavWPbCbWm3eA==",
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/helper-validator-identifier": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-validator-identifier/-/helper-validator-identifier-7.27.1.tgz",
      "integrity": "sha512-D2hP9eA+Sqx1kBZgzxZh0y1trbuU+JoDkiEwqhQ36nodYqJwyEIhPSdMNd7lOm/4io72luTPWH20Yda0xOuUow==",
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/parser": {
      "version": "7.28.0",
      "resolved": "https://registry.npmjs.org/@babel/parser/-/parser-7.28.0.tgz",
      "integrity": "sha512-jVZGvOxOuNSsuQuLRTh13nU0AogFlw32w/MT+LV6D3sP5WdbW61E77RnkbaO2dUvmPAYrBDJXGn5gGS6tH4j8g==",
      "license": "MIT",
      "dependencies": {
        "@babel/types": "^7.28.0"
      },
      "bin": {
        "parser": "bin/babel-parser.js"
      },
      "engines": {
        "node": ">=6.0.0"
      }
    },
    "node_modules/@babel/runtime": {
      "version": "7.28.2",
      "resolved": "https://registry.npmjs.org/@babel/runtime/-/runtime-7.28.2.tgz",
      "integrity": "sha512-KHp2IflsnGywDjBWDkR9iEqiWSpc8GIi0lgTT3mOElT0PP1tG26P4tmFI2YvAdzgq9RGyoHZQEIEdZy6Ec5xCA==",
      "license": "MIT",
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/template": {
      "version": "7.27.2",
      "resolved": "https://registry.npmjs.org/@babel/template/-/template-7.27.2.tgz",
      "integrity": "sha512-LPDZ85aEJyYSd18/DkjNh4/y1ntkE5KwUHWTiqgRxruuZL2F1yuHligVHLvcHY2vMHXttKFpJn6LwfI7cw7ODw==",
      "license": "MIT",
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/parser": "^7.27.2",
        "@babel/types": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/traverse": {
      "version": "7.28.0",
      "resolved": "https://registry.npmjs.org/@babel/traverse/-/traverse-7.28.0.tgz",
      "integrity": "sha512-mGe7UK5wWyh0bKRfupsUchrQGqvDbZDbKJw+kcRGSmdHVYrv+ltd0pnpDTVpiTqnaBru9iEvA8pz8W46v0Amwg==",
      "license": "MIT",
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/generator": "^7.28.0",
        "@babel/helper-globals": "^7.28.0",
        "@babel/parser": "^7.28.0",
        "@babel/template": "^7.27.2",
        "@babel/types": "^7.28.0",
        "debug": "^4.3.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@babel/types": {
      "version": "7.28.2",
      "resolved": "https://registry.npmjs.org/@babel/types/-/types-7.28.2.tgz",
      "integrity": "sha512-ruv7Ae4J5dUYULmeXw1gmb7rYRz57OWCPM57pHojnLq/3Z1CK2lNSLTCVjxVk1F/TZHwOZZrOWi0ur95BbLxNQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-string-parser": "^7.27.1",
        "@babel/helper-validator-identifier": "^7.27.1"
      },
      "engines": {
        "node": ">=6.9.0"
      }
    },
    "node_modules/@emnapi/core": {
      "version": "1.4.5",
      "resolved": "https://registry.npmjs.org/@emnapi/core/-/core-1.4.5.tgz",
      "integrity": "sha512-XsLw1dEOpkSX/WucdqUhPWP7hDxSvZiY+fsUC14h+FtQ2Ifni4znbBt8punRX+Uj2JG/uDb8nEHVKvrVlvdZ5Q==",
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "@emnapi/wasi-threads": "1.0.4",
        "tslib": "^2.4.0"
      }
    },
    "node_modules/@emnapi/runtime": {
      "version": "1.4.5",
      "resolved": "https://registry.npmjs.org/@emnapi/runtime/-/runtime-1.4.5.tgz",
      "integrity": "sha512-++LApOtY0pEEz1zrd9vy1/zXVaVJJ/EbAF3u0fXIzPJEDtnITsBGbbK0EkM72amhl/R5b+5xx0Y/QhcVOpuulg==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "tslib": "^2.4.0"
      }
    },
    "node_modules/@emnapi/wasi-threads": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/@emnapi/wasi-threads/-/wasi-threads-1.0.4.tgz",
      "integrity": "sha512-PJR+bOmMOPH8AtcTGAyYNiuJ3/Fcoj2XN/gBEWzDIKh254XO+mM9XoXHk5GNEhodxeMznbg7BlRojVbKN+gC6g==",
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "tslib": "^2.4.0"
      }
    },
    "node_modules/@emotion/babel-plugin": {
      "version": "11.13.5",
      "resolved": "https://registry.npmjs.org/@emotion/babel-plugin/-/babel-plugin-11.13.5.tgz",
      "integrity": "sha512-pxHCpT2ex+0q+HH91/zsdHkw/lXd468DIN2zvfvLtPKLLMo6gQj7oLObq8PhkrxOZb/gGCq03S3Z7PDhS8pduQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/helper-module-imports": "^7.16.7",
        "@babel/runtime": "^7.18.3",
        "@emotion/hash": "^0.9.2",
        "@emotion/memoize": "^0.9.0",
        "@emotion/serialize": "^1.3.3",
        "babel-plugin-macros": "^3.1.0",
        "convert-source-map": "^1.5.0",
        "escape-string-regexp": "^4.0.0",
        "find-root": "^1.1.0",
        "source-map": "^0.5.7",
        "stylis": "4.2.0"
      }
    },
    "node_modules/@emotion/cache": {
      "version": "11.14.0",
      "resolved": "https://registry.npmjs.org/@emotion/cache/-/cache-11.14.0.tgz",
      "integrity": "sha512-L/B1lc/TViYk4DcpGxtAVbx0ZyiKM5ktoIyafGkH6zg/tj+mA+NE//aPYKG0k8kCHSHVJrpLpcAlOBEXQ3SavA==",
      "license": "MIT",
      "dependencies": {
        "@emotion/memoize": "^0.9.0",
        "@emotion/sheet": "^1.4.0",
        "@emotion/utils": "^1.4.2",
        "@emotion/weak-memoize": "^0.4.0",
        "stylis": "4.2.0"
      }
    },
    "node_modules/@emotion/hash": {
      "version": "0.9.2",
      "resolved": "https://registry.npmjs.org/@emotion/hash/-/hash-0.9.2.tgz",
      "integrity": "sha512-MyqliTZGuOm3+5ZRSaaBGP3USLw6+EGykkwZns2EPC5g8jJ4z9OrdZY9apkl3+UP9+sdz76YYkwCKP5gh8iY3g==",
      "license": "MIT"
    },
    "node_modules/@emotion/memoize": {
      "version": "0.9.0",
      "resolved": "https://registry.npmjs.org/@emotion/memoize/-/memoize-0.9.0.tgz",
      "integrity": "sha512-30FAj7/EoJ5mwVPOWhAyCX+FPfMDrVecJAM+Iw9NRoSl4BBAQeqj4cApHHUXOVvIPgLVDsCFoz/hGD+5QQD1GQ==",
      "license": "MIT"
    },
    "node_modules/@emotion/react": {
      "version": "11.14.0",
      "resolved": "https://registry.npmjs.org/@emotion/react/-/react-11.14.0.tgz",
      "integrity": "sha512-O000MLDBDdk/EohJPFUqvnp4qnHeYkVP5B0xEG0D/L7cOKP9kefu2DXn8dj74cQfsEzUqh+sr1RzFqiL1o+PpA==",
      "license": "MIT",
      "dependencies": {
        "@babel/runtime": "^7.18.3",
        "@emotion/babel-plugin": "^11.13.5",
        "@emotion/cache": "^11.14.0",
        "@emotion/serialize": "^1.3.3",
        "@emotion/use-insertion-effect-with-fallbacks": "^1.2.0",
        "@emotion/utils": "^1.4.2",
        "@emotion/weak-memoize": "^0.4.0",
        "hoist-non-react-statics": "^3.3.1"
      },
      "peerDependencies": {
        "react": ">=16.8.0"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@emotion/serialize": {
      "version": "1.3.3",
      "resolved": "https://registry.npmjs.org/@emotion/serialize/-/serialize-1.3.3.tgz",
      "integrity": "sha512-EISGqt7sSNWHGI76hC7x1CksiXPahbxEOrC5RjmFRJTqLyEK9/9hZvBbiYn70dw4wuwMKiEMCUlR6ZXTSWQqxA==",
      "license": "MIT",
      "dependencies": {
        "@emotion/hash": "^0.9.2",
        "@emotion/memoize": "^0.9.0",
        "@emotion/unitless": "^0.10.0",
        "@emotion/utils": "^1.4.2",
        "csstype": "^3.0.2"
      }
    },
    "node_modules/@emotion/sheet": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/@emotion/sheet/-/sheet-1.4.0.tgz",
      "integrity": "sha512-fTBW9/8r2w3dXWYM4HCB1Rdp8NLibOw2+XELH5m5+AkWiL/KqYX6dc0kKYlaYyKjrQ6ds33MCdMPEwgs2z1rqg==",
      "license": "MIT"
    },
    "node_modules/@emotion/unitless": {
      "version": "0.10.0",
      "resolved": "https://registry.npmjs.org/@emotion/unitless/-/unitless-0.10.0.tgz",
      "integrity": "sha512-dFoMUuQA20zvtVTuxZww6OHoJYgrzfKM1t52mVySDJnMSEa08ruEvdYQbhvyu6soU+NeLVd3yKfTfT0NeV6qGg==",
      "license": "MIT"
    },
    "node_modules/@emotion/use-insertion-effect-with-fallbacks": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/@emotion/use-insertion-effect-with-fallbacks/-/use-insertion-effect-with-fallbacks-1.2.0.tgz",
      "integrity": "sha512-yJMtVdH59sxi/aVJBpk9FQq+OR8ll5GT8oWd57UpeaKEVGab41JWaCFA7FRLoMLloOZF/c/wsPoe+bfGmRKgDg==",
      "license": "MIT",
      "peerDependencies": {
        "react": ">=16.8.0"
      }
    },
    "node_modules/@emotion/utils": {
      "version": "1.4.2",
      "resolved": "https://registry.npmjs.org/@emotion/utils/-/utils-1.4.2.tgz",
      "integrity": "sha512-3vLclRofFziIa3J2wDh9jjbkUz9qk5Vi3IZ/FSTKViB0k+ef0fPV7dYrUIugbgupYDx7v9ud/SjrtEP8Y4xLoA==",
      "license": "MIT"
    },
    "node_modules/@emotion/weak-memoize": {
      "version": "0.4.0",
      "resolved": "https://registry.npmjs.org/@emotion/weak-memoize/-/weak-memoize-0.4.0.tgz",
      "integrity": "sha512-snKqtPW01tN0ui7yu9rGv69aJXr/a/Ywvl11sUjNtEcRc+ng/mQriFL0wLXMef74iHa/EkftbDzU9F8iFbH+zg==",
      "license": "MIT"
    },
    "node_modules/@eslint-community/eslint-utils": {
      "version": "4.7.0",
      "resolved": "https://registry.npmjs.org/@eslint-community/eslint-utils/-/eslint-utils-4.7.0.tgz",
      "integrity": "sha512-dyybb3AcajC7uha6CvhdVRJqaKyn7w2YKqKyAN37NKYgZT36w+iRb0Dymmc5qEJ549c/S31cMMSFd75bteCpCw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "eslint-visitor-keys": "^3.4.3"
      },
      "engines": {
        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      },
      "peerDependencies": {
        "eslint": "^6.0.0 || ^7.0.0 || >=8.0.0"
      }
    },
    "node_modules/@eslint-community/eslint-utils/node_modules/eslint-visitor-keys": {
      "version": "3.4.3",
      "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-3.4.3.tgz",
      "integrity": "sha512-wpc+LXeiyiisxPlEkUzU6svyS1frIO3Mgxj1fdy7Pm8Ygzguax2N3Fa/D/ag1WqbOprdI+uY6wMUl8/a2G+iag==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^12.22.0 || ^14.17.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/@eslint-community/regexpp": {
      "version": "4.12.1",
      "resolved": "https://registry.npmjs.org/@eslint-community/regexpp/-/regexpp-4.12.1.tgz",
      "integrity": "sha512-CCZCDJuduB9OUkFkY2IgppNZMi2lBQgD2qzwXkEia16cge2pijY/aXi96CJMquDMn3nJdlPV1A5KrJEXwfLNzQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^12.0.0 || ^14.0.0 || >=16.0.0"
      }
    },
    "node_modules/@eslint/config-array": {
      "version": "0.21.0",
      "resolved": "https://registry.npmjs.org/@eslint/config-array/-/config-array-0.21.0.tgz",
      "integrity": "sha512-ENIdc4iLu0d93HeYirvKmrzshzofPw6VkZRKQGe9Nv46ZnWUzcF1xV01dcvEg/1wXUR61OmmlSfyeyO7EvjLxQ==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@eslint/object-schema": "^2.1.6",
        "debug": "^4.3.1",
        "minimatch": "^3.1.2"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/config-helpers": {
      "version": "0.3.1",
      "resolved": "https://registry.npmjs.org/@eslint/config-helpers/-/config-helpers-0.3.1.tgz",
      "integrity": "sha512-xR93k9WhrDYpXHORXpxVL5oHj3Era7wo6k/Wd8/IsQNnZUTzkGS29lyn3nAT05v6ltUuTFVCCYDEGfy2Or/sPA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/core": {
      "version": "0.15.2",
      "resolved": "https://registry.npmjs.org/@eslint/core/-/core-0.15.2.tgz",
      "integrity": "sha512-78Md3/Rrxh83gCxoUc0EiciuOHsIITzLy53m3d9UyiW8y9Dj2D29FeETqyKA+BRK76tnTp6RXWb3pCay8Oyomg==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@types/json-schema": "^7.0.15"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/eslintrc": {
      "version": "3.3.1",
      "resolved": "https://registry.npmjs.org/@eslint/eslintrc/-/eslintrc-3.3.1.tgz",
      "integrity": "sha512-gtF186CXhIl1p4pJNGZw8Yc6RlshoePRvE0X91oPGb3vZ8pM3qOS9W9NGPat9LziaBV7XrJWGylNQXkGcnM3IQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ajv": "^6.12.4",
        "debug": "^4.3.2",
        "espree": "^10.0.1",
        "globals": "^14.0.0",
        "ignore": "^5.2.0",
        "import-fresh": "^3.2.1",
        "js-yaml": "^4.1.0",
        "minimatch": "^3.1.2",
        "strip-json-comments": "^3.1.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/@eslint/js": {
      "version": "9.33.0",
      "resolved": "https://registry.npmjs.org/@eslint/js/-/js-9.33.0.tgz",
      "integrity": "sha512-5K1/mKhWaMfreBGJTwval43JJmkip0RmM+3+IuqupeSKNC/Th2Kc7ucaq5ovTSra/OOKB9c58CGSz3QMVbWt0A==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://eslint.org/donate"
      }
    },
    "node_modules/@eslint/object-schema": {
      "version": "2.1.6",
      "resolved": "https://registry.npmjs.org/@eslint/object-schema/-/object-schema-2.1.6.tgz",
      "integrity": "sha512-RBMg5FRL0I0gs51M/guSAj5/e14VQ4tpZnQNWwuDT66P14I43ItmPfIZRhO9fUVIPOAQXU47atlywZ/czoqFPA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@eslint/plugin-kit": {
      "version": "0.3.5",
      "resolved": "https://registry.npmjs.org/@eslint/plugin-kit/-/plugin-kit-0.3.5.tgz",
      "integrity": "sha512-Z5kJ+wU3oA7MMIqVR9tyZRtjYPr4OC004Q4Rw7pgOKUOKkJfZ3O24nz3WYfGRpMDNmcOi3TwQOmgm7B7Tpii0w==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@eslint/core": "^0.15.2",
        "levn": "^0.4.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      }
    },
    "node_modules/@fast-csv/format": {
      "version": "4.3.5",
      "resolved": "https://registry.npmjs.org/@fast-csv/format/-/format-4.3.5.tgz",
      "integrity": "sha512-8iRn6QF3I8Ak78lNAa+Gdl5MJJBM5vRHivFtMRUWINdevNo00K7OXxS2PshawLKTejVwieIlPmK5YlLu6w4u8A==",
      "license": "MIT",
      "dependencies": {
        "@types/node": "^14.0.1",
        "lodash.escaperegexp": "^4.1.2",
        "lodash.isboolean": "^3.0.3",
        "lodash.isequal": "^4.5.0",
        "lodash.isfunction": "^3.0.9",
        "lodash.isnil": "^4.0.0"
      }
    },
    "node_modules/@fast-csv/format/node_modules/@types/node": {
      "version": "14.18.63",
      "resolved": "https://registry.npmjs.org/@types/node/-/node-14.18.63.tgz",
      "integrity": "sha512-fAtCfv4jJg+ExtXhvCkCqUKZ+4ok/JQk01qDKhL5BDDoS3AxKXhV5/MAVUZyQnSEd2GT92fkgZl0pz0Q0AzcIQ==",
      "license": "MIT"
    },
    "node_modules/@fast-csv/parse": {
      "version": "4.3.6",
      "resolved": "https://registry.npmjs.org/@fast-csv/parse/-/parse-4.3.6.tgz",
      "integrity": "sha512-uRsLYksqpbDmWaSmzvJcuApSEe38+6NQZBUsuAyMZKqHxH0g1wcJgsKUvN3WC8tewaqFjBMMGrkHmC+T7k8LvA==",
      "license": "MIT",
      "dependencies": {
        "@types/node": "^14.0.1",
        "lodash.escaperegexp": "^4.1.2",
        "lodash.groupby": "^4.6.0",
        "lodash.isfunction": "^3.0.9",
        "lodash.isnil": "^4.0.0",
        "lodash.isundefined": "^3.0.1",
        "lodash.uniq": "^4.5.0"
      }
    },
    "node_modules/@fast-csv/parse/node_modules/@types/node": {
      "version": "14.18.63",
      "resolved": "https://registry.npmjs.org/@types/node/-/node-14.18.63.tgz",
      "integrity": "sha512-fAtCfv4jJg+ExtXhvCkCqUKZ+4ok/JQk01qDKhL5BDDoS3AxKXhV5/MAVUZyQnSEd2GT92fkgZl0pz0Q0AzcIQ==",
      "license": "MIT"
    },
    "node_modules/@floating-ui/core": {
      "version": "1.7.3",
      "resolved": "https://registry.npmjs.org/@floating-ui/core/-/core-1.7.3.tgz",
      "integrity": "sha512-sGnvb5dmrJaKEZ+LDIpguvdX3bDlEllmv4/ClQ9awcmCZrlx5jQyyMWFM5kBI+EyNOCDDiKk8il0zeuX3Zlg/w==",
      "license": "MIT",
      "dependencies": {
        "@floating-ui/utils": "^0.2.10"
      }
    },
    "node_modules/@floating-ui/dom": {
      "version": "1.7.4",
      "resolved": "https://registry.npmjs.org/@floating-ui/dom/-/dom-1.7.4.tgz",
      "integrity": "sha512-OOchDgh4F2CchOX94cRVqhvy7b3AFb+/rQXyswmzmGakRfkMgoWVjfnLWkRirfLEfuD4ysVW16eXzwt3jHIzKA==",
      "license": "MIT",
      "dependencies": {
        "@floating-ui/core": "^1.7.3",
        "@floating-ui/utils": "^0.2.10"
      }
    },
    "node_modules/@floating-ui/react": {
      "version": "0.27.16",
      "resolved": "https://registry.npmjs.org/@floating-ui/react/-/react-0.27.16.tgz",
      "integrity": "sha512-9O8N4SeG2z++TSM8QA/KTeKFBVCNEz/AGS7gWPJf6KFRzmRWixFRnCnkPHRDwSVZW6QPDO6uT0P2SpWNKCc9/g==",
      "license": "MIT",
      "dependencies": {
        "@floating-ui/react-dom": "^2.1.6",
        "@floating-ui/utils": "^0.2.10",
        "tabbable": "^6.0.0"
      },
      "peerDependencies": {
        "react": ">=17.0.0",
        "react-dom": ">=17.0.0"
      }
    },
    "node_modules/@floating-ui/react-dom": {
      "version": "2.1.6",
      "resolved": "https://registry.npmjs.org/@floating-ui/react-dom/-/react-dom-2.1.6.tgz",
      "integrity": "sha512-4JX6rEatQEvlmgU80wZyq9RT96HZJa88q8hp0pBd+LrczeDI4o6uA2M+uvxngVHo4Ihr8uibXxH6+70zhAFrVw==",
      "license": "MIT",
      "dependencies": {
        "@floating-ui/dom": "^1.7.4"
      },
      "peerDependencies": {
        "react": ">=16.8.0",
        "react-dom": ">=16.8.0"
      }
    },
    "node_modules/@floating-ui/utils": {
      "version": "0.2.10",
      "resolved": "https://registry.npmjs.org/@floating-ui/utils/-/utils-0.2.10.tgz",
      "integrity": "sha512-aGTxbpbg8/b5JfU1HXSrbH3wXZuLPJcNEcZQFMxLs3oSzgtVu6nFPkbbGGUvBcUjKV2YyB9Wxxabo+HEH9tcRQ==",
      "license": "MIT"
    },
    "node_modules/@hookform/resolvers": {
      "version": "5.2.1",
      "resolved": "https://registry.npmjs.org/@hookform/resolvers/-/resolvers-5.2.1.tgz",
      "integrity": "sha512-u0+6X58gkjMcxur1wRWokA7XsiiBJ6aK17aPZxhkoYiK5J+HcTx0Vhu9ovXe6H+dVpO6cjrn2FkJTryXEMlryQ==",
      "license": "MIT",
      "dependencies": {
        "@standard-schema/utils": "^0.3.0"
      },
      "peerDependencies": {
        "react-hook-form": "^7.55.0"
      }
    },
    "node_modules/@humanfs/core": {
      "version": "0.19.1",
      "resolved": "https://registry.npmjs.org/@humanfs/core/-/core-0.19.1.tgz",
      "integrity": "sha512-5DyQ4+1JEUzejeK1JGICcideyfUbGixgS9jNgex5nqkW+cY7WZhxBigmieN5Qnw9ZosSNVC9KQKyb+GUaGyKUA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=18.18.0"
      }
    },
    "node_modules/@humanfs/node": {
      "version": "0.16.6",
      "resolved": "https://registry.npmjs.org/@humanfs/node/-/node-0.16.6.tgz",
      "integrity": "sha512-YuI2ZHQL78Q5HbhDiBA1X4LmYdXCKCMQIfw0pw7piHJwyREFebJUvrQN4cMssyES6x+vfUbx1CIpaQUKYdQZOw==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "@humanfs/core": "^0.19.1",
        "@humanwhocodes/retry": "^0.3.0"
      },
      "engines": {
        "node": ">=18.18.0"
      }
    },
    "node_modules/@humanfs/node/node_modules/@humanwhocodes/retry": {
      "version": "0.3.1",
      "resolved": "https://registry.npmjs.org/@humanwhocodes/retry/-/retry-0.3.1.tgz",
      "integrity": "sha512-JBxkERygn7Bv/GbN5Rv8Ul6LVknS+5Bp6RgDC/O8gEBU/yeH5Ui5C/OlWrTb6qct7LjjfT6Re2NxB0ln0yYybA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=18.18"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/nzakas"
      }
    },
    "node_modules/@humanwhocodes/module-importer": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/@humanwhocodes/module-importer/-/module-importer-1.0.1.tgz",
      "integrity": "sha512-bxveV4V8v5Yb4ncFTT3rPSgZBOpCkjfK0y4oVVVJwIuDVBRMDXrPyXRL988i5ap9m9bnyEEjWfm5WkBmtffLfA==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=12.22"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/nzakas"
      }
    },
    "node_modules/@humanwhocodes/retry": {
      "version": "0.4.3",
      "resolved": "https://registry.npmjs.org/@humanwhocodes/retry/-/retry-0.4.3.tgz",
      "integrity": "sha512-bV0Tgo9K4hfPCek+aMAn81RppFKv2ySDQeMoSZuvTASywNTnVJCArCZE2FWqpvIatKu7VMRLWlR1EazvVhDyhQ==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=18.18"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/nzakas"
      }
    },
    "node_modules/@img/sharp-darwin-arm64": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-darwin-arm64/-/sharp-darwin-arm64-0.34.3.tgz",
      "integrity": "sha512-ryFMfvxxpQRsgZJqBd4wsttYQbCxsJksrv9Lw/v798JcQ8+w84mBWuXwl+TT0WJ/WrYOLaYpwQXi3sA9nTIaIg==",
      "cpu": [
        "arm64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-darwin-arm64": "1.2.0"
      }
    },
    "node_modules/@img/sharp-darwin-x64": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-darwin-x64/-/sharp-darwin-x64-0.34.3.tgz",
      "integrity": "sha512-yHpJYynROAj12TA6qil58hmPmAwxKKC7reUqtGLzsOHfP7/rniNGTL8tjWX6L3CTV4+5P4ypcS7Pp+7OB+8ihA==",
      "cpu": [
        "x64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-darwin-x64": "1.2.0"
      }
    },
    "node_modules/@img/sharp-libvips-darwin-arm64": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-darwin-arm64/-/sharp-libvips-darwin-arm64-1.2.0.tgz",
      "integrity": "sha512-sBZmpwmxqwlqG9ueWFXtockhsxefaV6O84BMOrhtg/YqbTaRdqDE7hxraVE3y6gVM4eExmfzW4a8el9ArLeEiQ==",
      "cpu": [
        "arm64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "darwin"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-darwin-x64": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-darwin-x64/-/sharp-libvips-darwin-x64-1.2.0.tgz",
      "integrity": "sha512-M64XVuL94OgiNHa5/m2YvEQI5q2cl9d/wk0qFTDVXcYzi43lxuiFTftMR1tOnFQovVXNZJ5TURSDK2pNe9Yzqg==",
      "cpu": [
        "x64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "darwin"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-arm": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-arm/-/sharp-libvips-linux-arm-1.2.0.tgz",
      "integrity": "sha512-mWd2uWvDtL/nvIzThLq3fr2nnGfyr/XMXlq8ZJ9WMR6PXijHlC3ksp0IpuhK6bougvQrchUAfzRLnbsen0Cqvw==",
      "cpu": [
        "arm"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-arm64": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-arm64/-/sharp-libvips-linux-arm64-1.2.0.tgz",
      "integrity": "sha512-RXwd0CgG+uPRX5YYrkzKyalt2OJYRiJQ8ED/fi1tq9WQW2jsQIn0tqrlR5l5dr/rjqq6AHAxURhj2DVjyQWSOA==",
      "cpu": [
        "arm64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-ppc64": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-ppc64/-/sharp-libvips-linux-ppc64-1.2.0.tgz",
      "integrity": "sha512-Xod/7KaDDHkYu2phxxfeEPXfVXFKx70EAFZ0qyUdOjCcxbjqyJOEUpDe6RIyaunGxT34Anf9ue/wuWOqBW2WcQ==",
      "cpu": [
        "ppc64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-s390x": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-s390x/-/sharp-libvips-linux-s390x-1.2.0.tgz",
      "integrity": "sha512-eMKfzDxLGT8mnmPJTNMcjfO33fLiTDsrMlUVcp6b96ETbnJmd4uvZxVJSKPQfS+odwfVaGifhsB07J1LynFehw==",
      "cpu": [
        "s390x"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linux-x64": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linux-x64/-/sharp-libvips-linux-x64-1.2.0.tgz",
      "integrity": "sha512-ZW3FPWIc7K1sH9E3nxIGB3y3dZkpJlMnkk7z5tu1nSkBoCgw2nSRTFHI5pB/3CQaJM0pdzMF3paf9ckKMSE9Tg==",
      "cpu": [
        "x64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linuxmusl-arm64": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linuxmusl-arm64/-/sharp-libvips-linuxmusl-arm64-1.2.0.tgz",
      "integrity": "sha512-UG+LqQJbf5VJ8NWJ5Z3tdIe/HXjuIdo4JeVNADXBFuG7z9zjoegpzzGIyV5zQKi4zaJjnAd2+g2nna8TZvuW9Q==",
      "cpu": [
        "arm64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-libvips-linuxmusl-x64": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/@img/sharp-libvips-linuxmusl-x64/-/sharp-libvips-linuxmusl-x64-1.2.0.tgz",
      "integrity": "sha512-SRYOLR7CXPgNze8akZwjoGBoN1ThNZoqpOgfnOxmWsklTGVfJiGJoC/Lod7aNMGA1jSsKWM1+HRX43OP6p9+6Q==",
      "cpu": [
        "x64"
      ],
      "license": "LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "linux"
      ],
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-linux-arm": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-arm/-/sharp-linux-arm-0.34.3.tgz",
      "integrity": "sha512-oBK9l+h6KBN0i3dC8rYntLiVfW8D8wH+NPNT3O/WBHeW0OQWCjfWksLUaPidsrDKpJgXp3G3/hkmhptAW0I3+A==",
      "cpu": [
        "arm"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-arm": "1.2.0"
      }
    },
    "node_modules/@img/sharp-linux-arm64": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-arm64/-/sharp-linux-arm64-0.34.3.tgz",
      "integrity": "sha512-QdrKe3EvQrqwkDrtuTIjI0bu6YEJHTgEeqdzI3uWJOH6G1O8Nl1iEeVYRGdj1h5I21CqxSvQp1Yv7xeU3ZewbA==",
      "cpu": [
        "arm64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-arm64": "1.2.0"
      }
    },
    "node_modules/@img/sharp-linux-ppc64": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-ppc64/-/sharp-linux-ppc64-0.34.3.tgz",
      "integrity": "sha512-GLtbLQMCNC5nxuImPR2+RgrviwKwVql28FWZIW1zWruy6zLgA5/x2ZXk3mxj58X/tszVF69KK0Is83V8YgWhLA==",
      "cpu": [
        "ppc64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-ppc64": "1.2.0"
      }
    },
    "node_modules/@img/sharp-linux-s390x": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-s390x/-/sharp-linux-s390x-0.34.3.tgz",
      "integrity": "sha512-3gahT+A6c4cdc2edhsLHmIOXMb17ltffJlxR0aC2VPZfwKoTGZec6u5GrFgdR7ciJSsHT27BD3TIuGcuRT0KmQ==",
      "cpu": [
        "s390x"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-s390x": "1.2.0"
      }
    },
    "node_modules/@img/sharp-linux-x64": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-linux-x64/-/sharp-linux-x64-0.34.3.tgz",
      "integrity": "sha512-8kYso8d806ypnSq3/Ly0QEw90V5ZoHh10yH0HnrzOCr6DKAPI6QVHvwleqMkVQ0m+fc7EH8ah0BB0QPuWY6zJQ==",
      "cpu": [
        "x64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linux-x64": "1.2.0"
      }
    },
    "node_modules/@img/sharp-linuxmusl-arm64": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-linuxmusl-arm64/-/sharp-linuxmusl-arm64-0.34.3.tgz",
      "integrity": "sha512-vAjbHDlr4izEiXM1OTggpCcPg9tn4YriK5vAjowJsHwdBIdx0fYRsURkxLG2RLm9gyBq66gwtWI8Gx0/ov+JKQ==",
      "cpu": [
        "arm64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linuxmusl-arm64": "1.2.0"
      }
    },
    "node_modules/@img/sharp-linuxmusl-x64": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-linuxmusl-x64/-/sharp-linuxmusl-x64-0.34.3.tgz",
      "integrity": "sha512-gCWUn9547K5bwvOn9l5XGAEjVTTRji4aPTqLzGXHvIr6bIDZKNTA34seMPgM0WmSf+RYBH411VavCejp3PkOeQ==",
      "cpu": [
        "x64"
      ],
      "license": "Apache-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-libvips-linuxmusl-x64": "1.2.0"
      }
    },
    "node_modules/@img/sharp-wasm32": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-wasm32/-/sharp-wasm32-0.34.3.tgz",
      "integrity": "sha512-+CyRcpagHMGteySaWos8IbnXcHgfDn7pO2fiC2slJxvNq9gDipYBN42/RagzctVRKgxATmfqOSulgZv5e1RdMg==",
      "cpu": [
        "wasm32"
      ],
      "license": "Apache-2.0 AND LGPL-3.0-or-later AND MIT",
      "optional": true,
      "dependencies": {
        "@emnapi/runtime": "^1.4.4"
      },
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-win32-arm64": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-win32-arm64/-/sharp-win32-arm64-0.34.3.tgz",
      "integrity": "sha512-MjnHPnbqMXNC2UgeLJtX4XqoVHHlZNd+nPt1kRPmj63wURegwBhZlApELdtxM2OIZDRv/DFtLcNhVbd1z8GYXQ==",
      "cpu": [
        "arm64"
      ],
      "license": "Apache-2.0 AND LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-win32-ia32": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-win32-ia32/-/sharp-win32-ia32-0.34.3.tgz",
      "integrity": "sha512-xuCdhH44WxuXgOM714hn4amodJMZl3OEvf0GVTm0BEyMeA2to+8HEdRPShH0SLYptJY1uBw+SCFP9WVQi1Q/cw==",
      "cpu": [
        "ia32"
      ],
      "license": "Apache-2.0 AND LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@img/sharp-win32-x64": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/@img/sharp-win32-x64/-/sharp-win32-x64-0.34.3.tgz",
      "integrity": "sha512-OWwz05d++TxzLEv4VnsTz5CmZ6mI6S05sfQGEMrNrQcOEERbX46332IvE7pO/EUiw7jUrrS40z/M7kPyjfl04g==",
      "cpu": [
        "x64"
      ],
      "license": "Apache-2.0 AND LGPL-3.0-or-later",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      }
    },
    "node_modules/@isaacs/fs-minipass": {
      "version": "4.0.1",
      "resolved": "https://registry.npmjs.org/@isaacs/fs-minipass/-/fs-minipass-4.0.1.tgz",
      "integrity": "sha512-wgm9Ehl2jpeqP3zw/7mo3kRHFp5MEDhqAdwy1fTGkHAwnkGOVsgpvQhL8B5n1qlb01jV3n/bI0ZfZp5lWA1k4w==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "minipass": "^7.0.4"
      },
      "engines": {
        "node": ">=18.0.0"
      }
    },
    "node_modules/@jridgewell/gen-mapping": {
      "version": "0.3.13",
      "resolved": "https://registry.npmjs.org/@jridgewell/gen-mapping/-/gen-mapping-0.3.13.tgz",
      "integrity": "sha512-2kkt/7niJ6MgEPxF0bYdQ6etZaA+fQvDcLKckhy1yIQOzaoKjBBjSj63/aLVjYE3qhRt5dvM+uUyfCg6UKCBbA==",
      "license": "MIT",
      "dependencies": {
        "@jridgewell/sourcemap-codec": "^1.5.0",
        "@jridgewell/trace-mapping": "^0.3.24"
      }
    },
    "node_modules/@jridgewell/resolve-uri": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/@jridgewell/resolve-uri/-/resolve-uri-3.1.2.tgz",
      "integrity": "sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==",
      "license": "MIT",
      "engines": {
        "node": ">=6.0.0"
      }
    },
    "node_modules/@jridgewell/sourcemap-codec": {
      "version": "1.5.5",
      "resolved": "https://registry.npmjs.org/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.5.5.tgz",
      "integrity": "sha512-cYQ9310grqxueWbl+WuIUIaiUaDcj7WOq5fVhEljNVgRfOUhY9fy2zTvfoqWsnebh8Sl70VScFbICvJnLKB0Og==",
      "license": "MIT"
    },
    "node_modules/@jridgewell/trace-mapping": {
      "version": "0.3.30",
      "resolved": "https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.30.tgz",
      "integrity": "sha512-GQ7Nw5G2lTu/BtHTKfXhKHok2WGetd4XYcVKGx00SjAk8GMwgJM3zr6zORiPGuOE+/vkc90KtTosSSvaCjKb2Q==",
      "license": "MIT",
      "dependencies": {
        "@jridgewell/resolve-uri": "^3.1.0",
        "@jridgewell/sourcemap-codec": "^1.4.14"
      }
    },
    "node_modules/@napi-rs/wasm-runtime": {
      "version": "0.2.12",
      "resolved": "https://registry.npmjs.org/@napi-rs/wasm-runtime/-/wasm-runtime-0.2.12.tgz",
      "integrity": "sha512-ZVWUcfwY4E/yPitQJl481FjFo3K22D6qF0DuFH6Y/nbnE11GY5uguDxZMGXPQ8WQ0128MXQD7TnfHyK4oWoIJQ==",
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "@emnapi/core": "^1.4.3",
        "@emnapi/runtime": "^1.4.3",
        "@tybys/wasm-util": "^0.10.0"
      }
    },
    "node_modules/@next/env": {
      "version": "15.4.4",
      "resolved": "https://registry.npmjs.org/@next/env/-/env-15.4.4.tgz",
      "integrity": "sha512-SJKOOkULKENyHSYXE5+KiFU6itcIb6wSBjgM92meK0HVKpo94dNOLZVdLLuS7/BxImROkGoPsjR4EnuDucqiiA==",
      "license": "MIT"
    },
    "node_modules/@next/eslint-plugin-next": {
      "version": "15.4.4",
      "resolved": "https://registry.npmjs.org/@next/eslint-plugin-next/-/eslint-plugin-next-15.4.4.tgz",
      "integrity": "sha512-1FDsyN//ai3Jd97SEd7scw5h1yLdzDACGOPRofr2GD3sEFsBylEEoL0MHSerd4n2dq9Zm/mFMqi4+NRMOreOKA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "fast-glob": "3.3.1"
      }
    },
    "node_modules/@next/swc-darwin-arm64": {
      "version": "15.4.4",
      "resolved": "https://registry.npmjs.org/@next/swc-darwin-arm64/-/swc-darwin-arm64-15.4.4.tgz",
      "integrity": "sha512-eVG55dnGwfUuG+TtnUCt+mEJ+8TGgul6nHEvdb8HEH7dmJIFYOCApAaFrIrxwtEq2Cdf+0m5sG1Np8cNpw9EAw==",
      "cpu": [
        "arm64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-darwin-x64": {
      "version": "15.4.4",
      "resolved": "https://registry.npmjs.org/@next/swc-darwin-x64/-/swc-darwin-x64-15.4.4.tgz",
      "integrity": "sha512-zqG+/8apsu49CltEj4NAmCGZvHcZbOOOsNoTVeIXphYWIbE4l6A/vuQHyqll0flU2o3dmYCXsBW5FmbrGDgljQ==",
      "cpu": [
        "x64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-linux-arm64-gnu": {
      "version": "15.4.4",
      "resolved": "https://registry.npmjs.org/@next/swc-linux-arm64-gnu/-/swc-linux-arm64-gnu-15.4.4.tgz",
      "integrity": "sha512-LRD4l2lq4R+2QCHBQVC0wjxxkLlALGJCwigaJ5FSRSqnje+MRKHljQNZgDCaKUZQzO/TXxlmUdkZP/X3KNGZaw==",
      "cpu": [
        "arm64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-linux-arm64-musl": {
      "version": "15.4.4",
      "resolved": "https://registry.npmjs.org/@next/swc-linux-arm64-musl/-/swc-linux-arm64-musl-15.4.4.tgz",
      "integrity": "sha512-LsGUCTvuZ0690fFWerA4lnQvjkYg9gHo12A3wiPUR4kCxbx/d+SlwmonuTH2SWZI+RVGA9VL3N0S03WTYv6bYg==",
      "cpu": [
        "arm64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-linux-x64-gnu": {
      "version": "15.4.4",
      "resolved": "https://registry.npmjs.org/@next/swc-linux-x64-gnu/-/swc-linux-x64-gnu-15.4.4.tgz",
      "integrity": "sha512-aOy5yNRpLL3wNiJVkFYl6w22hdREERNjvegE6vvtix8LHRdsTHhWTpgvcYdCK7AIDCQW5ATmzr9XkPHvSoAnvg==",
      "cpu": [
        "x64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-linux-x64-musl": {
      "version": "15.4.4",
      "resolved": "https://registry.npmjs.org/@next/swc-linux-x64-musl/-/swc-linux-x64-musl-15.4.4.tgz",
      "integrity": "sha512-FL7OAn4UkR8hKQRGBmlHiHinzOb07tsfARdGh7v0Z0jEJ3sz8/7L5bR23ble9E6DZMabSStqlATHlSxv1fuzAg==",
      "cpu": [
        "x64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-win32-arm64-msvc": {
      "version": "15.4.4",
      "resolved": "https://registry.npmjs.org/@next/swc-win32-arm64-msvc/-/swc-win32-arm64-msvc-15.4.4.tgz",
      "integrity": "sha512-eEdNW/TXwjYhOulQh0pffTMMItWVwKCQpbziSBmgBNFZIIRn2GTXrhrewevs8wP8KXWYMx8Z+mNU0X+AfvtrRg==",
      "cpu": [
        "arm64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@next/swc-win32-x64-msvc": {
      "version": "15.4.4",
      "resolved": "https://registry.npmjs.org/@next/swc-win32-x64-msvc/-/swc-win32-x64-msvc-15.4.4.tgz",
      "integrity": "sha512-SE5pYNbn/xZKMy1RE3pAs+4xD32OI4rY6mzJa4XUkp/ItZY+OMjIgilskmErt8ls/fVJ+Ihopi2QIeW6O3TrMw==",
      "cpu": [
        "x64"
      ],
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@nodelib/fs.scandir": {
      "version": "2.1.5",
      "resolved": "https://registry.npmjs.org/@nodelib/fs.scandir/-/fs.scandir-2.1.5.tgz",
      "integrity": "sha512-vq24Bq3ym5HEQm2NKCr3yXDwjc7vTsEThRDnkp2DK9p1uqLR+DHurm/NOTo0KG7HYHU7eppKZj3MyqYuMBf62g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@nodelib/fs.stat": "2.0.5",
        "run-parallel": "^1.1.9"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/@nodelib/fs.stat": {
      "version": "2.0.5",
      "resolved": "https://registry.npmjs.org/@nodelib/fs.stat/-/fs.stat-2.0.5.tgz",
      "integrity": "sha512-RkhPPp2zrqDAQA/2jNhnztcPAlv64XdhIp7a7454A5ovI7Bukxgt7MX7udwAu3zg1DcpPU0rz3VV1SeaqvY4+A==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/@nodelib/fs.walk": {
      "version": "1.2.8",
      "resolved": "https://registry.npmjs.org/@nodelib/fs.walk/-/fs.walk-1.2.8.tgz",
      "integrity": "sha512-oGB+UxlgWcgQkgwo8GcEGwemoTFt3FIO9ababBmaGwXIoBKZ+GTy0pP185beGg7Llih/NSHSV2XAs1lnznocSg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@nodelib/fs.scandir": "2.1.5",
        "fastq": "^1.6.0"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/@nolyfill/is-core-module": {
      "version": "1.0.39",
      "resolved": "https://registry.npmjs.org/@nolyfill/is-core-module/-/is-core-module-1.0.39.tgz",
      "integrity": "sha512-nn5ozdjYQpUCZlWGuxcJY/KpxkWQs4DcbMCmKojjyrYDEAGy4Ce19NN4v5MduafTwJlbKc99UA8YhSVqq9yPZA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=12.4.0"
      }
    },
    "node_modules/@radix-ui/number": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/@radix-ui/number/-/number-1.1.1.tgz",
      "integrity": "sha512-MkKCwxlXTgz6CFoJx3pCwn07GKp36+aZyu/u2Ln2VrA5DcdyCZkASEDBTd8x5whTQQL5CiYf4prXKLcgQdv29g==",
      "license": "MIT"
    },
    "node_modules/@radix-ui/primitive": {
      "version": "1.1.3",
      "resolved": "https://registry.npmjs.org/@radix-ui/primitive/-/primitive-1.1.3.tgz",
      "integrity": "sha512-JTF99U/6XIjCBo0wqkU5sK10glYe27MRRsfwoiq5zzOEZLHU3A3KCMa5X/azekYRCJ0HlwI0crAXS/5dEHTzDg==",
      "license": "MIT"
    },
    "node_modules/@radix-ui/react-arrow": {
      "version": "1.1.7",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-arrow/-/react-arrow-1.1.7.tgz",
      "integrity": "sha512-F+M1tLhO+mlQaOWspE8Wstg+z6PwxwRd8oQ8IXceWz92kfAmalTRf0EjrouQeo7QssEPfCn05B4Ihs1K9WQ/7w==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/react-primitive": "2.1.3"
      },
      "peerDependencies": {
        "@types/react": "*",
        "@types/react-dom": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc",
        "react-dom": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        },
        "@types/react-dom": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-collection": {
      "version": "1.1.7",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-collection/-/react-collection-1.1.7.tgz",
      "integrity": "sha512-Fh9rGN0MoI4ZFUNyfFVNU4y9LUz93u9/0K+yLgA2bwRojxM8JU1DyvvMBabnZPBgMWREAJvU2jjVzq+LrFUglw==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/react-compose-refs": "1.1.2",
        "@radix-ui/react-context": "1.1.2",
        "@radix-ui/react-primitive": "2.1.3",
        "@radix-ui/react-slot": "1.2.3"
      },
      "peerDependencies": {
        "@types/react": "*",
        "@types/react-dom": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc",
        "react-dom": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        },
        "@types/react-dom": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-compose-refs": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-compose-refs/-/react-compose-refs-1.1.2.tgz",
      "integrity": "sha512-z4eqJvfiNnFMHIIvXP3CY57y2WJs5g2v3X0zm9mEJkrkNv4rDxu+sg9Jh8EkXyeqBkB7SOcboo9dMVqhyrACIg==",
      "license": "MIT",
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-context": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-context/-/react-context-1.1.2.tgz",
      "integrity": "sha512-jCi/QKUM2r1Ju5a3J64TH2A5SpKAgh0LpknyqdQ4m6DCV0xJ2HG1xARRwNGPQfi1SLdLWZ1OJz6F4OMBBNiGJA==",
      "license": "MIT",
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-direction": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-direction/-/react-direction-1.1.1.tgz",
      "integrity": "sha512-1UEWRX6jnOA2y4H5WczZ44gOOjTEmlqv1uNW4GAJEO5+bauCBhv8snY65Iw5/VOS/ghKN9gr2KjnLKxrsvoMVw==",
      "license": "MIT",
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-dismissable-layer": {
      "version": "1.1.11",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-dismissable-layer/-/react-dismissable-layer-1.1.11.tgz",
      "integrity": "sha512-Nqcp+t5cTB8BinFkZgXiMJniQH0PsUt2k51FUhbdfeKvc4ACcG2uQniY/8+h1Yv6Kza4Q7lD7PQV0z0oicE0Mg==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/primitive": "1.1.3",
        "@radix-ui/react-compose-refs": "1.1.2",
        "@radix-ui/react-primitive": "2.1.3",
        "@radix-ui/react-use-callback-ref": "1.1.1",
        "@radix-ui/react-use-escape-keydown": "1.1.1"
      },
      "peerDependencies": {
        "@types/react": "*",
        "@types/react-dom": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc",
        "react-dom": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        },
        "@types/react-dom": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-focus-guards": {
      "version": "1.1.3",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-focus-guards/-/react-focus-guards-1.1.3.tgz",
      "integrity": "sha512-0rFg/Rj2Q62NCm62jZw0QX7a3sz6QCQU0LpZdNrJX8byRGaGVTqbrW9jAoIAHyMQqsNpeZ81YgSizOt5WXq0Pw==",
      "license": "MIT",
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-focus-scope": {
      "version": "1.1.7",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-focus-scope/-/react-focus-scope-1.1.7.tgz",
      "integrity": "sha512-t2ODlkXBQyn7jkl6TNaw/MtVEVvIGelJDCG41Okq/KwUsJBwQ4XVZsHAVUkK4mBv3ewiAS3PGuUWuY2BoK4ZUw==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/react-compose-refs": "1.1.2",
        "@radix-ui/react-primitive": "2.1.3",
        "@radix-ui/react-use-callback-ref": "1.1.1"
      },
      "peerDependencies": {
        "@types/react": "*",
        "@types/react-dom": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc",
        "react-dom": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        },
        "@types/react-dom": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-id": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-id/-/react-id-1.1.1.tgz",
      "integrity": "sha512-kGkGegYIdQsOb4XjsfM97rXsiHaBwco+hFI66oO4s9LU+PLAC5oJ7khdOVFxkhsmlbpUqDAvXw11CluXP+jkHg==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/react-use-layout-effect": "1.1.1"
      },
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-popper": {
      "version": "1.2.8",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-popper/-/react-popper-1.2.8.tgz",
      "integrity": "sha512-0NJQ4LFFUuWkE7Oxf0htBKS6zLkkjBH+hM1uk7Ng705ReR8m/uelduy1DBo0PyBXPKVnBA6YBlU94MBGXrSBCw==",
      "license": "MIT",
      "dependencies": {
        "@floating-ui/react-dom": "^2.0.0",
        "@radix-ui/react-arrow": "1.1.7",
        "@radix-ui/react-compose-refs": "1.1.2",
        "@radix-ui/react-context": "1.1.2",
        "@radix-ui/react-primitive": "2.1.3",
        "@radix-ui/react-use-callback-ref": "1.1.1",
        "@radix-ui/react-use-layout-effect": "1.1.1",
        "@radix-ui/react-use-rect": "1.1.1",
        "@radix-ui/react-use-size": "1.1.1",
        "@radix-ui/rect": "1.1.1"
      },
      "peerDependencies": {
        "@types/react": "*",
        "@types/react-dom": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc",
        "react-dom": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        },
        "@types/react-dom": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-portal": {
      "version": "1.1.9",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-portal/-/react-portal-1.1.9.tgz",
      "integrity": "sha512-bpIxvq03if6UNwXZ+HTK71JLh4APvnXntDc6XOX8UVq4XQOVl7lwok0AvIl+b8zgCw3fSaVTZMpAPPagXbKmHQ==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/react-primitive": "2.1.3",
        "@radix-ui/react-use-layout-effect": "1.1.1"
      },
      "peerDependencies": {
        "@types/react": "*",
        "@types/react-dom": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc",
        "react-dom": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        },
        "@types/react-dom": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-primitive": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-primitive/-/react-primitive-2.1.3.tgz",
      "integrity": "sha512-m9gTwRkhy2lvCPe6QJp4d3G1TYEUHn/FzJUtq9MjH46an1wJU+GdoGC5VLof8RX8Ft/DlpshApkhswDLZzHIcQ==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/react-slot": "1.2.3"
      },
      "peerDependencies": {
        "@types/react": "*",
        "@types/react-dom": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc",
        "react-dom": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        },
        "@types/react-dom": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-select": {
      "version": "2.2.6",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-select/-/react-select-2.2.6.tgz",
      "integrity": "sha512-I30RydO+bnn2PQztvo25tswPH+wFBjehVGtmagkU78yMdwTwVf12wnAOF+AeP8S2N8xD+5UPbGhkUfPyvT+mwQ==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/number": "1.1.1",
        "@radix-ui/primitive": "1.1.3",
        "@radix-ui/react-collection": "1.1.7",
        "@radix-ui/react-compose-refs": "1.1.2",
        "@radix-ui/react-context": "1.1.2",
        "@radix-ui/react-direction": "1.1.1",
        "@radix-ui/react-dismissable-layer": "1.1.11",
        "@radix-ui/react-focus-guards": "1.1.3",
        "@radix-ui/react-focus-scope": "1.1.7",
        "@radix-ui/react-id": "1.1.1",
        "@radix-ui/react-popper": "1.2.8",
        "@radix-ui/react-portal": "1.1.9",
        "@radix-ui/react-primitive": "2.1.3",
        "@radix-ui/react-slot": "1.2.3",
        "@radix-ui/react-use-callback-ref": "1.1.1",
        "@radix-ui/react-use-controllable-state": "1.2.2",
        "@radix-ui/react-use-layout-effect": "1.1.1",
        "@radix-ui/react-use-previous": "1.1.1",
        "@radix-ui/react-visually-hidden": "1.2.3",
        "aria-hidden": "^1.2.4",
        "react-remove-scroll": "^2.6.3"
      },
      "peerDependencies": {
        "@types/react": "*",
        "@types/react-dom": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc",
        "react-dom": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        },
        "@types/react-dom": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-slot": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-slot/-/react-slot-1.2.3.tgz",
      "integrity": "sha512-aeNmHnBxbi2St0au6VBVC7JXFlhLlOnvIIlePNniyUNAClzmtAUEY8/pBiK3iHjufOlwA+c20/8jngo7xcrg8A==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/react-compose-refs": "1.1.2"
      },
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-use-callback-ref": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-use-callback-ref/-/react-use-callback-ref-1.1.1.tgz",
      "integrity": "sha512-FkBMwD+qbGQeMu1cOHnuGB6x4yzPjho8ap5WtbEJ26umhgqVXbhekKUQO+hZEL1vU92a3wHwdp0HAcqAUF5iDg==",
      "license": "MIT",
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-use-controllable-state": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-use-controllable-state/-/react-use-controllable-state-1.2.2.tgz",
      "integrity": "sha512-BjasUjixPFdS+NKkypcyyN5Pmg83Olst0+c6vGov0diwTEo6mgdqVR6hxcEgFuh4QrAs7Rc+9KuGJ9TVCj0Zzg==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/react-use-effect-event": "0.0.2",
        "@radix-ui/react-use-layout-effect": "1.1.1"
      },
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-use-effect-event": {
      "version": "0.0.2",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-use-effect-event/-/react-use-effect-event-0.0.2.tgz",
      "integrity": "sha512-Qp8WbZOBe+blgpuUT+lw2xheLP8q0oatc9UpmiemEICxGvFLYmHm9QowVZGHtJlGbS6A6yJ3iViad/2cVjnOiA==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/react-use-layout-effect": "1.1.1"
      },
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-use-escape-keydown": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-use-escape-keydown/-/react-use-escape-keydown-1.1.1.tgz",
      "integrity": "sha512-Il0+boE7w/XebUHyBjroE+DbByORGR9KKmITzbR7MyQ4akpORYP/ZmbhAr0DG7RmmBqoOnZdy2QlvajJ2QA59g==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/react-use-callback-ref": "1.1.1"
      },
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-use-layout-effect": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-use-layout-effect/-/react-use-layout-effect-1.1.1.tgz",
      "integrity": "sha512-RbJRS4UWQFkzHTTwVymMTUv8EqYhOp8dOOviLj2ugtTiXRaRQS7GLGxZTLL1jWhMeoSCf5zmcZkqTl9IiYfXcQ==",
      "license": "MIT",
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-use-previous": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-use-previous/-/react-use-previous-1.1.1.tgz",
      "integrity": "sha512-2dHfToCj/pzca2Ck724OZ5L0EVrr3eHRNsG/b3xQJLA2hZpVCS99bLAX+hm1IHXDEnzU6by5z/5MIY794/a8NQ==",
      "license": "MIT",
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-use-rect": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-use-rect/-/react-use-rect-1.1.1.tgz",
      "integrity": "sha512-QTYuDesS0VtuHNNvMh+CjlKJ4LJickCMUAqjlE3+j8w+RlRpwyX3apEQKGFzbZGdo7XNG1tXa+bQqIE7HIXT2w==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/rect": "1.1.1"
      },
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-use-size": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-use-size/-/react-use-size-1.1.1.tgz",
      "integrity": "sha512-ewrXRDTAqAXlkl6t/fkXWNAhFX9I+CkKlw6zjEwk86RSPKwZr3xpBRso655aqYafwtnbpHLj6toFzmd6xdVptQ==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/react-use-layout-effect": "1.1.1"
      },
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/react-visually-hidden": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/@radix-ui/react-visually-hidden/-/react-visually-hidden-1.2.3.tgz",
      "integrity": "sha512-pzJq12tEaaIhqjbzpCuv/OypJY/BPavOofm+dbab+MHLajy277+1lLm6JFcGgF5eskJ6mquGirhXY2GD/8u8Ug==",
      "license": "MIT",
      "dependencies": {
        "@radix-ui/react-primitive": "2.1.3"
      },
      "peerDependencies": {
        "@types/react": "*",
        "@types/react-dom": "*",
        "react": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc",
        "react-dom": "^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        },
        "@types/react-dom": {
          "optional": true
        }
      }
    },
    "node_modules/@radix-ui/rect": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/@radix-ui/rect/-/rect-1.1.1.tgz",
      "integrity": "sha512-HPwpGIzkl28mWyZqG52jiqDJ12waP11Pa1lGoiyUkIEuMLBP0oeK/C89esbXrxsky5we7dfd8U58nm0SgAWpVw==",
      "license": "MIT"
    },
    "node_modules/@rtsao/scc": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/@rtsao/scc/-/scc-1.1.0.tgz",
      "integrity": "sha512-zt6OdqaDoOnJ1ZYsCYGt9YmWzDXl4vQdKTyJev62gFhRGKdx7mcT54V9KIjg+d2wi9EXsPvAPKe7i7WjfVWB8g==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@rushstack/eslint-patch": {
      "version": "1.12.0",
      "resolved": "https://registry.npmjs.org/@rushstack/eslint-patch/-/eslint-patch-1.12.0.tgz",
      "integrity": "sha512-5EwMtOqvJMMa3HbmxLlF74e+3/HhwBTMcvt3nqVJgGCozO6hzIPOBlwm8mGVNR9SN2IJpxSnlxczyDjcn7qIyw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@standard-schema/utils": {
      "version": "0.3.0",
      "resolved": "https://registry.npmjs.org/@standard-schema/utils/-/utils-0.3.0.tgz",
      "integrity": "sha512-e7Mew686owMaPJVNNLs55PUvgz371nKgwsc4vxE49zsODpJEnxgxRo2y/OKrqueavXgZNMDVj3DdHFlaSAeU8g==",
      "license": "MIT"
    },
    "node_modules/@supabase/auth-js": {
      "version": "2.71.1",
      "resolved": "https://registry.npmjs.org/@supabase/auth-js/-/auth-js-2.71.1.tgz",
      "integrity": "sha512-mMIQHBRc+SKpZFRB2qtupuzulaUhFYupNyxqDj5Jp/LyPvcWvjaJzZzObv6URtL/O6lPxkanASnotGtNpS3H2Q==",
      "license": "MIT",
      "dependencies": {
        "@supabase/node-fetch": "^2.6.14"
      }
    },
    "node_modules/@supabase/functions-js": {
      "version": "2.4.5",
      "resolved": "https://registry.npmjs.org/@supabase/functions-js/-/functions-js-2.4.5.tgz",
      "integrity": "sha512-v5GSqb9zbosquTo6gBwIiq7W9eQ7rE5QazsK/ezNiQXdCbY+bH8D9qEaBIkhVvX4ZRW5rP03gEfw5yw9tiq4EQ==",
      "license": "MIT",
      "dependencies": {
        "@supabase/node-fetch": "^2.6.14"
      }
    },
    "node_modules/@supabase/node-fetch": {
      "version": "2.6.15",
      "resolved": "https://registry.npmjs.org/@supabase/node-fetch/-/node-fetch-2.6.15.tgz",
      "integrity": "sha512-1ibVeYUacxWYi9i0cf5efil6adJ9WRyZBLivgjs+AUpewx1F3xPi7gLgaASI2SmIQxPoCEjAsLAzKPgMJVgOUQ==",
      "license": "MIT",
      "dependencies": {
        "whatwg-url": "^5.0.0"
      },
      "engines": {
        "node": "4.x || >=6.0.0"
      }
    },
    "node_modules/@supabase/postgrest-js": {
      "version": "1.21.3",
      "resolved": "https://registry.npmjs.org/@supabase/postgrest-js/-/postgrest-js-1.21.3.tgz",
      "integrity": "sha512-rg3DmmZQKEVCreXq6Am29hMVe1CzemXyIWVYyyua69y6XubfP+DzGfLxME/1uvdgwqdoaPbtjBDpEBhqxq1ZwA==",
      "license": "MIT",
      "dependencies": {
        "@supabase/node-fetch": "^2.6.14"
      }
    },
    "node_modules/@supabase/realtime-js": {
      "version": "2.15.1",
      "resolved": "https://registry.npmjs.org/@supabase/realtime-js/-/realtime-js-2.15.1.tgz",
      "integrity": "sha512-edRFa2IrQw50kNntvUyS38hsL7t2d/psah6om6aNTLLcWem0R6bOUq7sk7DsGeSlNfuwEwWn57FdYSva6VddYw==",
      "license": "MIT",
      "dependencies": {
        "@supabase/node-fetch": "^2.6.13",
        "@types/phoenix": "^1.6.6",
        "@types/ws": "^8.18.1",
        "ws": "^8.18.2"
      }
    },
    "node_modules/@supabase/ssr": {
      "version": "0.6.1",
      "resolved": "https://registry.npmjs.org/@supabase/ssr/-/ssr-0.6.1.tgz",
      "integrity": "sha512-QtQgEMvaDzr77Mk3vZ3jWg2/y+D8tExYF7vcJT+wQ8ysuvOeGGjYbZlvj5bHYsj/SpC0bihcisnwPrM4Gp5G4g==",
      "license": "MIT",
      "dependencies": {
        "cookie": "^1.0.1"
      },
      "peerDependencies": {
        "@supabase/supabase-js": "^2.43.4"
      }
    },
    "node_modules/@supabase/storage-js": {
      "version": "2.10.5",
      "resolved": "https://registry.npmjs.org/@supabase/storage-js/-/storage-js-2.10.5.tgz",
      "integrity": "sha512-9O7DfVI+v+exwPIKFGlCn2gigx441ojHnJ5QpHPegvblPdZQnnmCrL+A0JHj7wD/e+f9fnLu/DBKAtLYrLtftw==",
      "license": "MIT",
      "dependencies": {
        "@supabase/node-fetch": "^2.6.14"
      }
    },
    "node_modules/@supabase/supabase-js": {
      "version": "2.56.0",
      "resolved": "https://registry.npmjs.org/@supabase/supabase-js/-/supabase-js-2.56.0.tgz",
      "integrity": "sha512-XqwhHSyVnkjdliPN61CmXsmFGnFHTX2WDdwjG3Ukvdzuu3Trix+dXupYOQ3BueIyYp7B6t0yYpdQtJP2hIInyg==",
      "license": "MIT",
      "dependencies": {
        "@supabase/auth-js": "2.71.1",
        "@supabase/functions-js": "2.4.5",
        "@supabase/node-fetch": "2.6.15",
        "@supabase/postgrest-js": "1.21.3",
        "@supabase/realtime-js": "2.15.1",
        "@supabase/storage-js": "^2.10.4"
      }
    },
    "node_modules/@swc/helpers": {
      "version": "0.5.15",
      "resolved": "https://registry.npmjs.org/@swc/helpers/-/helpers-0.5.15.tgz",
      "integrity": "sha512-JQ5TuMi45Owi4/BIMAJBoSQoOJu12oOk/gADqlcUL9JEdHB8vyjUSsxqeNXnmXHjYKMi2WcYtezGEEhqUI/E2g==",
      "license": "Apache-2.0",
      "dependencies": {
        "tslib": "^2.8.0"
      }
    },
    "node_modules/@tailwindcss/node": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/node/-/node-4.1.11.tgz",
      "integrity": "sha512-yzhzuGRmv5QyU9qLNg4GTlYI6STedBWRE7NjxP45CsFYYq9taI0zJXZBMqIC/c8fViNLhmrbpSFS57EoxUmD6Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@ampproject/remapping": "^2.3.0",
        "enhanced-resolve": "^5.18.1",
        "jiti": "^2.4.2",
        "lightningcss": "1.30.1",
        "magic-string": "^0.30.17",
        "source-map-js": "^1.2.1",
        "tailwindcss": "4.1.11"
      }
    },
    "node_modules/@tailwindcss/oxide": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide/-/oxide-4.1.11.tgz",
      "integrity": "sha512-Q69XzrtAhuyfHo+5/HMgr1lAiPP/G40OMFAnws7xcFEYqcypZmdW8eGXaOUIeOl1dzPJBPENXgbjsOyhg2nkrg==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "dependencies": {
        "detect-libc": "^2.0.4",
        "tar": "^7.4.3"
      },
      "engines": {
        "node": ">= 10"
      },
      "optionalDependencies": {
        "@tailwindcss/oxide-android-arm64": "4.1.11",
        "@tailwindcss/oxide-darwin-arm64": "4.1.11",
        "@tailwindcss/oxide-darwin-x64": "4.1.11",
        "@tailwindcss/oxide-freebsd-x64": "4.1.11",
        "@tailwindcss/oxide-linux-arm-gnueabihf": "4.1.11",
        "@tailwindcss/oxide-linux-arm64-gnu": "4.1.11",
        "@tailwindcss/oxide-linux-arm64-musl": "4.1.11",
        "@tailwindcss/oxide-linux-x64-gnu": "4.1.11",
        "@tailwindcss/oxide-linux-x64-musl": "4.1.11",
        "@tailwindcss/oxide-wasm32-wasi": "4.1.11",
        "@tailwindcss/oxide-win32-arm64-msvc": "4.1.11",
        "@tailwindcss/oxide-win32-x64-msvc": "4.1.11"
      }
    },
    "node_modules/@tailwindcss/oxide-android-arm64": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-android-arm64/-/oxide-android-arm64-4.1.11.tgz",
      "integrity": "sha512-3IfFuATVRUMZZprEIx9OGDjG3Ou3jG4xQzNTvjDoKmU9JdmoCohQJ83MYd0GPnQIu89YoJqvMM0G3uqLRFtetg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-darwin-arm64": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-darwin-arm64/-/oxide-darwin-arm64-4.1.11.tgz",
      "integrity": "sha512-ESgStEOEsyg8J5YcMb1xl8WFOXfeBmrhAwGsFxxB2CxY9evy63+AtpbDLAyRkJnxLy2WsD1qF13E97uQyP1lfQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-darwin-x64": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-darwin-x64/-/oxide-darwin-x64-4.1.11.tgz",
      "integrity": "sha512-EgnK8kRchgmgzG6jE10UQNaH9Mwi2n+yw1jWmof9Vyg2lpKNX2ioe7CJdf9M5f8V9uaQxInenZkOxnTVL3fhAw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-freebsd-x64": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-freebsd-x64/-/oxide-freebsd-x64-4.1.11.tgz",
      "integrity": "sha512-xdqKtbpHs7pQhIKmqVpxStnY1skuNh4CtbcyOHeX1YBE0hArj2romsFGb6yUmzkq/6M24nkxDqU8GYrKrz+UcA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-linux-arm-gnueabihf": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-linux-arm-gnueabihf/-/oxide-linux-arm-gnueabihf-4.1.11.tgz",
      "integrity": "sha512-ryHQK2eyDYYMwB5wZL46uoxz2zzDZsFBwfjssgB7pzytAeCCa6glsiJGjhTEddq/4OsIjsLNMAiMlHNYnkEEeg==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-linux-arm64-gnu": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-linux-arm64-gnu/-/oxide-linux-arm64-gnu-4.1.11.tgz",
      "integrity": "sha512-mYwqheq4BXF83j/w75ewkPJmPZIqqP1nhoghS9D57CLjsh3Nfq0m4ftTotRYtGnZd3eCztgbSPJ9QhfC91gDZQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-linux-arm64-musl": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-linux-arm64-musl/-/oxide-linux-arm64-musl-4.1.11.tgz",
      "integrity": "sha512-m/NVRFNGlEHJrNVk3O6I9ggVuNjXHIPoD6bqay/pubtYC9QIdAMpS+cswZQPBLvVvEF6GtSNONbDkZrjWZXYNQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-linux-x64-gnu": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-linux-x64-gnu/-/oxide-linux-x64-gnu-4.1.11.tgz",
      "integrity": "sha512-YW6sblI7xukSD2TdbbaeQVDysIm/UPJtObHJHKxDEcW2exAtY47j52f8jZXkqE1krdnkhCMGqP3dbniu1Te2Fg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-linux-x64-musl": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-linux-x64-musl/-/oxide-linux-x64-musl-4.1.11.tgz",
      "integrity": "sha512-e3C/RRhGunWYNC3aSF7exsQkdXzQ/M+aYuZHKnw4U7KQwTJotnWsGOIVih0s2qQzmEzOFIJ3+xt7iq67K/p56Q==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-wasm32-wasi": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-wasm32-wasi/-/oxide-wasm32-wasi-4.1.11.tgz",
      "integrity": "sha512-Xo1+/GU0JEN/C/dvcammKHzeM6NqKovG+6921MR6oadee5XPBaKOumrJCXvopJ/Qb5TH7LX/UAywbqrP4lax0g==",
      "bundleDependencies": [
        "@napi-rs/wasm-runtime",
        "@emnapi/core",
        "@emnapi/runtime",
        "@tybys/wasm-util",
        "@emnapi/wasi-threads",
        "tslib"
      ],
      "cpu": [
        "wasm32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "@emnapi/core": "^1.4.3",
        "@emnapi/runtime": "^1.4.3",
        "@emnapi/wasi-threads": "^1.0.2",
        "@napi-rs/wasm-runtime": "^0.2.11",
        "@tybys/wasm-util": "^0.9.0",
        "tslib": "^2.8.0"
      },
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/@tailwindcss/oxide-win32-arm64-msvc": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-win32-arm64-msvc/-/oxide-win32-arm64-msvc-4.1.11.tgz",
      "integrity": "sha512-UgKYx5PwEKrac3GPNPf6HVMNhUIGuUh4wlDFR2jYYdkX6pL/rn73zTq/4pzUm8fOjAn5L8zDeHp9iXmUGOXZ+w==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/oxide-win32-x64-msvc": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/oxide-win32-x64-msvc/-/oxide-win32-x64-msvc-4.1.11.tgz",
      "integrity": "sha512-YfHoggn1j0LK7wR82TOucWc5LDCguHnoS879idHekmmiR7g9HUtMw9MI0NHatS28u/Xlkfi9w5RJWgz2Dl+5Qg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/@tailwindcss/postcss": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/@tailwindcss/postcss/-/postcss-4.1.11.tgz",
      "integrity": "sha512-q/EAIIpF6WpLhKEuQSEVMZNMIY8KhWoAemZ9eylNAih9jxMGAYPPWBn3I9QL/2jZ+e7OEz/tZkX5HwbBR4HohA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@alloc/quick-lru": "^5.2.0",
        "@tailwindcss/node": "4.1.11",
        "@tailwindcss/oxide": "4.1.11",
        "postcss": "^8.4.41",
        "tailwindcss": "4.1.11"
      }
    },
    "node_modules/@tanstack/eslint-plugin-query": {
      "version": "5.83.1",
      "resolved": "https://registry.npmjs.org/@tanstack/eslint-plugin-query/-/eslint-plugin-query-5.83.1.tgz",
      "integrity": "sha512-tdkpPFfzkTksN9BIlT/qjixSAtKrsW6PUVRwdKWaOcag7DrD1vpki3UzzdfMQGDRGeg1Ue1Dg+rcl5FJGembNg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@typescript-eslint/utils": "^8.37.0"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/tannerlinsley"
      },
      "peerDependencies": {
        "eslint": "^8.57.0 || ^9.0.0"
      }
    },
    "node_modules/@tanstack/query-core": {
      "version": "5.85.5",
      "resolved": "https://registry.npmjs.org/@tanstack/query-core/-/query-core-5.85.5.tgz",
      "integrity": "sha512-KO0WTob4JEApv69iYp1eGvfMSUkgw//IpMnq+//cORBzXf0smyRwPLrUvEe5qtAEGjwZTXrjxg+oJNP/C00t6w==",
      "license": "MIT",
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/tannerlinsley"
      }
    },
    "node_modules/@tanstack/query-devtools": {
      "version": "5.84.0",
      "resolved": "https://registry.npmjs.org/@tanstack/query-devtools/-/query-devtools-5.84.0.tgz",
      "integrity": "sha512-fbF3n+z1rqhvd9EoGp5knHkv3p5B2Zml1yNRjh7sNXklngYI5RVIWUrUjZ1RIcEoscarUb0+bOvIs5x9dwzOXQ==",
      "license": "MIT",
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/tannerlinsley"
      }
    },
    "node_modules/@tanstack/react-query": {
      "version": "5.85.5",
      "resolved": "https://registry.npmjs.org/@tanstack/react-query/-/react-query-5.85.5.tgz",
      "integrity": "sha512-/X4EFNcnPiSs8wM2v+b6DqS5mmGeuJQvxBglmDxl6ZQb5V26ouD2SJYAcC3VjbNwqhY2zjxVD15rDA5nGbMn3A==",
      "license": "MIT",
      "dependencies": {
        "@tanstack/query-core": "5.85.5"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/tannerlinsley"
      },
      "peerDependencies": {
        "react": "^18 || ^19"
      }
    },
    "node_modules/@tanstack/react-query-devtools": {
      "version": "5.85.1",
      "resolved": "https://registry.npmjs.org/@tanstack/react-query-devtools/-/react-query-devtools-5.85.1.tgz",
      "integrity": "sha512-sn1l10BTvXeu93pUi3bWv298AvU+yTmhi6LtXF5XyvVtIP420FqsO5sn5sQvRnJCwHEpMQrE23sQuvDN185qeQ==",
      "license": "MIT",
      "dependencies": {
        "@tanstack/query-devtools": "5.84.0"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/tannerlinsley"
      },
      "peerDependencies": {
        "@tanstack/react-query": "^5.85.1",
        "react": "^18 || ^19"
      }
    },
    "node_modules/@transloadit/prettier-bytes": {
      "version": "0.3.5",
      "resolved": "https://registry.npmjs.org/@transloadit/prettier-bytes/-/prettier-bytes-0.3.5.tgz",
      "integrity": "sha512-xF4A3d/ZyX2LJWeQZREZQw+qFX4TGQ8bGVP97OLRt6sPO6T0TNHBFTuRHOJh7RNmYOBmQ9MHxpolD9bXihpuVA==",
      "license": "MIT"
    },
    "node_modules/@tybys/wasm-util": {
      "version": "0.10.0",
      "resolved": "https://registry.npmjs.org/@tybys/wasm-util/-/wasm-util-0.10.0.tgz",
      "integrity": "sha512-VyyPYFlOMNylG45GoAe0xDoLwWuowvf92F9kySqzYh8vmYm7D2u4iUJKa1tOUpS70Ku13ASrOkS4ScXFsTaCNQ==",
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "tslib": "^2.4.0"
      }
    },
    "node_modules/@types/bcrypt": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/@types/bcrypt/-/bcrypt-6.0.0.tgz",
      "integrity": "sha512-/oJGukuH3D2+D+3H4JWLaAsJ/ji86dhRidzZ/Od7H/i8g+aCmvkeCc6Ni/f9uxGLSQVCRZkX2/lqEFG2BvWtlQ==",
      "license": "MIT",
      "dependencies": {
        "@types/node": "*"
      }
    },
    "node_modules/@types/estree": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/@types/estree/-/estree-1.0.8.tgz",
      "integrity": "sha512-dWHzHa2WqEXI/O1E9OjrocMTKJl2mSrEolh1Iomrv6U+JuNwaHXsXx9bLu5gG7BUWFIN0skIQJQ/L1rIex4X6w==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/json-schema": {
      "version": "7.0.15",
      "resolved": "https://registry.npmjs.org/@types/json-schema/-/json-schema-7.0.15.tgz",
      "integrity": "sha512-5+fP8P8MFNC+AyZCDxrB2pkZFPGzqQWUzpSeuuVLvm8VMcorNYavBqoFcxK8bQz4Qsbn4oUEEem4wDLfcysGHA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/json5": {
      "version": "0.0.29",
      "resolved": "https://registry.npmjs.org/@types/json5/-/json5-0.0.29.tgz",
      "integrity": "sha512-dRLjCWHYg4oaA77cxO64oO+7JwCwnIzkZPdrrC71jQmQtlhM556pwKo5bUzqvZndkVbeFLIIi+9TC40JNF5hNQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/lodash": {
      "version": "4.17.20",
      "resolved": "https://registry.npmjs.org/@types/lodash/-/lodash-4.17.20.tgz",
      "integrity": "sha512-H3MHACvFUEiujabxhaI/ImO6gUrd8oOurg7LQtS7mbwIXA/cUqWrvBsaeJ23aZEPk1TAYkurjfMbSELfoCXlGA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/lodash.isequal": {
      "version": "4.5.8",
      "resolved": "https://registry.npmjs.org/@types/lodash.isequal/-/lodash.isequal-4.5.8.tgz",
      "integrity": "sha512-uput6pg4E/tj2LGxCZo9+y27JNyB2OZuuI/T5F+ylVDYuqICLG2/ktjxx0v6GvVntAf8TvEzeQLcV0ffRirXuA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@types/lodash": "*"
      }
    },
    "node_modules/@types/node": {
      "version": "20.19.11",
      "resolved": "https://registry.npmjs.org/@types/node/-/node-20.19.11.tgz",
      "integrity": "sha512-uug3FEEGv0r+jrecvUUpbY8lLisvIjg6AAic6a2bSP5OEOLeJsDSnvhCDov7ipFFMXS3orMpzlmi0ZcuGkBbow==",
      "license": "MIT",
      "dependencies": {
        "undici-types": "~6.21.0"
      }
    },
    "node_modules/@types/papaparse": {
      "version": "5.3.16",
      "resolved": "https://registry.npmjs.org/@types/papaparse/-/papaparse-5.3.16.tgz",
      "integrity": "sha512-T3VuKMC2H0lgsjI9buTB3uuKj3EMD2eap1MOuEQuBQ44EnDx/IkGhU6EwiTf9zG3za4SKlmwKAImdDKdNnCsXg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@types/node": "*"
      }
    },
    "node_modules/@types/parse-json": {
      "version": "4.0.2",
      "resolved": "https://registry.npmjs.org/@types/parse-json/-/parse-json-4.0.2.tgz",
      "integrity": "sha512-dISoDXWWQwUquiKsyZ4Ng+HX2KsPL7LyHKHQwgGFEA3IaKac4Obd+h2a/a6waisAoepJlBcx9paWqjA8/HVjCw==",
      "license": "MIT"
    },
    "node_modules/@types/pg": {
      "version": "8.15.5",
      "resolved": "https://registry.npmjs.org/@types/pg/-/pg-8.15.5.tgz",
      "integrity": "sha512-LF7lF6zWEKxuT3/OR8wAZGzkg4ENGXFNyiV/JeOt9z5B+0ZVwbql9McqX5c/WStFq1GaGso7H1AzP/qSzmlCKQ==",
      "license": "MIT",
      "dependencies": {
        "@types/node": "*",
        "pg-protocol": "*",
        "pg-types": "^2.2.0"
      }
    },
    "node_modules/@types/phoenix": {
      "version": "1.6.6",
      "resolved": "https://registry.npmjs.org/@types/phoenix/-/phoenix-1.6.6.tgz",
      "integrity": "sha512-PIzZZlEppgrpoT2QgbnDU+MMzuR6BbCjllj0bM70lWoejMeNJAxCchxnv7J3XFkI8MpygtRpzXrIlmWUBclP5A==",
      "license": "MIT"
    },
    "node_modules/@types/prismjs": {
      "version": "1.26.5",
      "resolved": "https://registry.npmjs.org/@types/prismjs/-/prismjs-1.26.5.tgz",
      "integrity": "sha512-AUZTa7hQ2KY5L7AmtSiqxlhWxb4ina0yd8hNbl4TWuqnv/pFP0nDMb3YrfSBf4hJVGLh2YEIBfKaBW/9UEl6IQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/react": {
      "version": "19.1.10",
      "resolved": "https://registry.npmjs.org/@types/react/-/react-19.1.10.tgz",
      "integrity": "sha512-EhBeSYX0Y6ye8pNebpKrwFJq7BoQ8J5SO6NlvNwwHjSj6adXJViPQrKlsyPw7hLBLvckEMO1yxeGdR82YBBlDg==",
      "license": "MIT",
      "dependencies": {
        "csstype": "^3.0.2"
      }
    },
    "node_modules/@types/react-dom": {
      "version": "19.1.7",
      "resolved": "https://registry.npmjs.org/@types/react-dom/-/react-dom-19.1.7.tgz",
      "integrity": "sha512-i5ZzwYpqjmrKenzkoLM2Ibzt6mAsM7pxB6BCIouEVVmgiqaMj1TjaK7hnA36hbW5aZv20kx7Lw6hWzPWg0Rurw==",
      "devOptional": true,
      "license": "MIT",
      "peerDependencies": {
        "@types/react": "^19.0.0"
      }
    },
    "node_modules/@types/react-transition-group": {
      "version": "4.4.12",
      "resolved": "https://registry.npmjs.org/@types/react-transition-group/-/react-transition-group-4.4.12.tgz",
      "integrity": "sha512-8TV6R3h2j7a91c+1DXdJi3Syo69zzIZbz7Lg5tORM5LEJG7X/E6a1V3drRyBRZq7/utz7A+c4OgYLiLcYGHG6w==",
      "license": "MIT",
      "peerDependencies": {
        "@types/react": "*"
      }
    },
    "node_modules/@types/retry": {
      "version": "0.12.2",
      "resolved": "https://registry.npmjs.org/@types/retry/-/retry-0.12.2.tgz",
      "integrity": "sha512-XISRgDJ2Tc5q4TRqvgJtzsRkFYNJzZrhTdtMoGVBttwzzQJkPnS3WWTFc7kuDRoPtPakl+T+OfdEUjYJj7Jbow==",
      "license": "MIT"
    },
    "node_modules/@types/uuid": {
      "version": "10.0.0",
      "resolved": "https://registry.npmjs.org/@types/uuid/-/uuid-10.0.0.tgz",
      "integrity": "sha512-7gqG38EyHgyP1S+7+xomFtL+ZNHcKv6DwNaCZmJmo1vgMugyF3TCnXVg4t1uk89mLNwnLtnY3TpOpCOyp1/xHQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/web-push": {
      "version": "3.6.4",
      "resolved": "https://registry.npmjs.org/@types/web-push/-/web-push-3.6.4.tgz",
      "integrity": "sha512-GnJmSr40H3RAnj0s34FNTcJi1hmWFV5KXugE0mYWnYhgTAHLJ/dJKAwDmvPJYMke0RplY2XE9LnM4hqSqKIjhQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@types/node": "*"
      }
    },
    "node_modules/@types/ws": {
      "version": "8.18.1",
      "resolved": "https://registry.npmjs.org/@types/ws/-/ws-8.18.1.tgz",
      "integrity": "sha512-ThVF6DCVhA8kUGy+aazFQ4kXQ7E1Ty7A3ypFOe0IcJV8O/M511G99AW24irKrW56Wt44yG9+ij8FaqoBGkuBXg==",
      "license": "MIT",
      "dependencies": {
        "@types/node": "*"
      }
    },
    "node_modules/@typescript-eslint/eslint-plugin": {
      "version": "8.39.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/eslint-plugin/-/eslint-plugin-8.39.1.tgz",
      "integrity": "sha512-yYegZ5n3Yr6eOcqgj2nJH8cH/ZZgF+l0YIdKILSDjYFRjgYQMgv/lRjV5Z7Up04b9VYUondt8EPMqg7kTWgJ2g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@eslint-community/regexpp": "^4.10.0",
        "@typescript-eslint/scope-manager": "8.39.1",
        "@typescript-eslint/type-utils": "8.39.1",
        "@typescript-eslint/utils": "8.39.1",
        "@typescript-eslint/visitor-keys": "8.39.1",
        "graphemer": "^1.4.0",
        "ignore": "^7.0.0",
        "natural-compare": "^1.4.0",
        "ts-api-utils": "^2.1.0"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "@typescript-eslint/parser": "^8.39.1",
        "eslint": "^8.57.0 || ^9.0.0",
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/eslint-plugin/node_modules/ignore": {
      "version": "7.0.5",
      "resolved": "https://registry.npmjs.org/ignore/-/ignore-7.0.5.tgz",
      "integrity": "sha512-Hs59xBNfUIunMFgWAbGX5cq6893IbWg4KnrjbYwX3tx0ztorVgTDA6B2sxf8ejHJ4wz8BqGUMYlnzNBer5NvGg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 4"
      }
    },
    "node_modules/@typescript-eslint/parser": {
      "version": "8.39.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/parser/-/parser-8.39.1.tgz",
      "integrity": "sha512-pUXGCuHnnKw6PyYq93lLRiZm3vjuslIy7tus1lIQTYVK9bL8XBgJnCWm8a0KcTtHC84Yya1Q6rtll+duSMj0dg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@typescript-eslint/scope-manager": "8.39.1",
        "@typescript-eslint/types": "8.39.1",
        "@typescript-eslint/typescript-estree": "8.39.1",
        "@typescript-eslint/visitor-keys": "8.39.1",
        "debug": "^4.3.4"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "eslint": "^8.57.0 || ^9.0.0",
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/project-service": {
      "version": "8.39.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/project-service/-/project-service-8.39.1.tgz",
      "integrity": "sha512-8fZxek3ONTwBu9ptw5nCKqZOSkXshZB7uAxuFF0J/wTMkKydjXCzqqga7MlFMpHi9DoG4BadhmTkITBcg8Aybw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@typescript-eslint/tsconfig-utils": "^8.39.1",
        "@typescript-eslint/types": "^8.39.1",
        "debug": "^4.3.4"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/scope-manager": {
      "version": "8.39.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/scope-manager/-/scope-manager-8.39.1.tgz",
      "integrity": "sha512-RkBKGBrjgskFGWuyUGz/EtD8AF/GW49S21J8dvMzpJitOF1slLEbbHnNEtAHtnDAnx8qDEdRrULRnWVx27wGBw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@typescript-eslint/types": "8.39.1",
        "@typescript-eslint/visitor-keys": "8.39.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      }
    },
    "node_modules/@typescript-eslint/tsconfig-utils": {
      "version": "8.39.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/tsconfig-utils/-/tsconfig-utils-8.39.1.tgz",
      "integrity": "sha512-ePUPGVtTMR8XMU2Hee8kD0Pu4NDE1CN9Q1sxGSGd/mbOtGZDM7pnhXNJnzW63zk/q+Z54zVzj44HtwXln5CvHA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/type-utils": {
      "version": "8.39.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/type-utils/-/type-utils-8.39.1.tgz",
      "integrity": "sha512-gu9/ahyatyAdQbKeHnhT4R+y3YLtqqHyvkfDxaBYk97EcbfChSJXyaJnIL3ygUv7OuZatePHmQvuH5ru0lnVeA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@typescript-eslint/types": "8.39.1",
        "@typescript-eslint/typescript-estree": "8.39.1",
        "@typescript-eslint/utils": "8.39.1",
        "debug": "^4.3.4",
        "ts-api-utils": "^2.1.0"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "eslint": "^8.57.0 || ^9.0.0",
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/types": {
      "version": "8.39.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/types/-/types-8.39.1.tgz",
      "integrity": "sha512-7sPDKQQp+S11laqTrhHqeAbsCfMkwJMrV7oTDvtDds4mEofJYir414bYKUEb8YPUm9QL3U+8f6L6YExSoAGdQw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      }
    },
    "node_modules/@typescript-eslint/typescript-estree": {
      "version": "8.39.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/typescript-estree/-/typescript-estree-8.39.1.tgz",
      "integrity": "sha512-EKkpcPuIux48dddVDXyQBlKdeTPMmALqBUbEk38McWv0qVEZwOpVJBi7ugK5qVNgeuYjGNQxrrnoM/5+TI/BPw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@typescript-eslint/project-service": "8.39.1",
        "@typescript-eslint/tsconfig-utils": "8.39.1",
        "@typescript-eslint/types": "8.39.1",
        "@typescript-eslint/visitor-keys": "8.39.1",
        "debug": "^4.3.4",
        "fast-glob": "^3.3.2",
        "is-glob": "^4.0.3",
        "minimatch": "^9.0.4",
        "semver": "^7.6.0",
        "ts-api-utils": "^2.1.0"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/typescript-estree/node_modules/brace-expansion": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-2.0.2.tgz",
      "integrity": "sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "balanced-match": "^1.0.0"
      }
    },
    "node_modules/@typescript-eslint/typescript-estree/node_modules/fast-glob": {
      "version": "3.3.3",
      "resolved": "https://registry.npmjs.org/fast-glob/-/fast-glob-3.3.3.tgz",
      "integrity": "sha512-7MptL8U0cqcFdzIzwOTHoilX9x5BrNqye7Z/LuC7kCMRio1EMSyqRK3BEAUD7sXRq4iT4AzTVuZdhgQ2TCvYLg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@nodelib/fs.stat": "^2.0.2",
        "@nodelib/fs.walk": "^1.2.3",
        "glob-parent": "^5.1.2",
        "merge2": "^1.3.0",
        "micromatch": "^4.0.8"
      },
      "engines": {
        "node": ">=8.6.0"
      }
    },
    "node_modules/@typescript-eslint/typescript-estree/node_modules/glob-parent": {
      "version": "5.1.2",
      "resolved": "https://registry.npmjs.org/glob-parent/-/glob-parent-5.1.2.tgz",
      "integrity": "sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "is-glob": "^4.0.1"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/@typescript-eslint/typescript-estree/node_modules/minimatch": {
      "version": "9.0.5",
      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-9.0.5.tgz",
      "integrity": "sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "brace-expansion": "^2.0.1"
      },
      "engines": {
        "node": ">=16 || 14 >=14.17"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      }
    },
    "node_modules/@typescript-eslint/utils": {
      "version": "8.39.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/utils/-/utils-8.39.1.tgz",
      "integrity": "sha512-VF5tZ2XnUSTuiqZFXCZfZs1cgkdd3O/sSYmdo2EpSyDlC86UM/8YytTmKnehOW3TGAlivqTDT6bS87B/GQ/jyg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@eslint-community/eslint-utils": "^4.7.0",
        "@typescript-eslint/scope-manager": "8.39.1",
        "@typescript-eslint/types": "8.39.1",
        "@typescript-eslint/typescript-estree": "8.39.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      },
      "peerDependencies": {
        "eslint": "^8.57.0 || ^9.0.0",
        "typescript": ">=4.8.4 <6.0.0"
      }
    },
    "node_modules/@typescript-eslint/visitor-keys": {
      "version": "8.39.1",
      "resolved": "https://registry.npmjs.org/@typescript-eslint/visitor-keys/-/visitor-keys-8.39.1.tgz",
      "integrity": "sha512-W8FQi6kEh2e8zVhQ0eeRnxdvIoOkAp/CPAahcNio6nO9dsIwb9b34z90KOlheoyuVf6LSOEdjlkxSkapNEc+4A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@typescript-eslint/types": "8.39.1",
        "eslint-visitor-keys": "^4.2.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/typescript-eslint"
      }
    },
    "node_modules/@unrs/resolver-binding-android-arm-eabi": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-android-arm-eabi/-/resolver-binding-android-arm-eabi-1.11.1.tgz",
      "integrity": "sha512-ppLRUgHVaGRWUx0R0Ut06Mjo9gBaBkg3v/8AxusGLhsIotbBLuRk51rAzqLC8gq6NyyAojEXglNjzf6R948DNw==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ]
    },
    "node_modules/@unrs/resolver-binding-android-arm64": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-android-arm64/-/resolver-binding-android-arm64-1.11.1.tgz",
      "integrity": "sha512-lCxkVtb4wp1v+EoN+HjIG9cIIzPkX5OtM03pQYkG+U5O/wL53LC4QbIeazgiKqluGeVEeBlZahHalCaBvU1a2g==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ]
    },
    "node_modules/@unrs/resolver-binding-darwin-arm64": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-darwin-arm64/-/resolver-binding-darwin-arm64-1.11.1.tgz",
      "integrity": "sha512-gPVA1UjRu1Y/IsB/dQEsp2V1pm44Of6+LWvbLc9SDk1c2KhhDRDBUkQCYVWe6f26uJb3fOK8saWMgtX8IrMk3g==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ]
    },
    "node_modules/@unrs/resolver-binding-darwin-x64": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-darwin-x64/-/resolver-binding-darwin-x64-1.11.1.tgz",
      "integrity": "sha512-cFzP7rWKd3lZaCsDze07QX1SC24lO8mPty9vdP+YVa3MGdVgPmFc59317b2ioXtgCMKGiCLxJ4HQs62oz6GfRQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ]
    },
    "node_modules/@unrs/resolver-binding-freebsd-x64": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-freebsd-x64/-/resolver-binding-freebsd-x64-1.11.1.tgz",
      "integrity": "sha512-fqtGgak3zX4DCB6PFpsH5+Kmt/8CIi4Bry4rb1ho6Av2QHTREM+47y282Uqiu3ZRF5IQioJQ5qWRV6jduA+iGw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-arm-gnueabihf": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-arm-gnueabihf/-/resolver-binding-linux-arm-gnueabihf-1.11.1.tgz",
      "integrity": "sha512-u92mvlcYtp9MRKmP+ZvMmtPN34+/3lMHlyMj7wXJDeXxuM0Vgzz0+PPJNsro1m3IZPYChIkn944wW8TYgGKFHw==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-arm-musleabihf": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-arm-musleabihf/-/resolver-binding-linux-arm-musleabihf-1.11.1.tgz",
      "integrity": "sha512-cINaoY2z7LVCrfHkIcmvj7osTOtm6VVT16b5oQdS4beibX2SYBwgYLmqhBjA1t51CarSaBuX5YNsWLjsqfW5Cw==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-arm64-gnu": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-arm64-gnu/-/resolver-binding-linux-arm64-gnu-1.11.1.tgz",
      "integrity": "sha512-34gw7PjDGB9JgePJEmhEqBhWvCiiWCuXsL9hYphDF7crW7UgI05gyBAi6MF58uGcMOiOqSJ2ybEeCvHcq0BCmQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-arm64-musl": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-arm64-musl/-/resolver-binding-linux-arm64-musl-1.11.1.tgz",
      "integrity": "sha512-RyMIx6Uf53hhOtJDIamSbTskA99sPHS96wxVE/bJtePJJtpdKGXO1wY90oRdXuYOGOTuqjT8ACccMc4K6QmT3w==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-ppc64-gnu": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-ppc64-gnu/-/resolver-binding-linux-ppc64-gnu-1.11.1.tgz",
      "integrity": "sha512-D8Vae74A4/a+mZH0FbOkFJL9DSK2R6TFPC9M+jCWYia/q2einCubX10pecpDiTmkJVUH+y8K3BZClycD8nCShA==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-riscv64-gnu": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-riscv64-gnu/-/resolver-binding-linux-riscv64-gnu-1.11.1.tgz",
      "integrity": "sha512-frxL4OrzOWVVsOc96+V3aqTIQl1O2TjgExV4EKgRY09AJ9leZpEg8Ak9phadbuX0BA4k8U5qtvMSQQGGmaJqcQ==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-riscv64-musl": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-riscv64-musl/-/resolver-binding-linux-riscv64-musl-1.11.1.tgz",
      "integrity": "sha512-mJ5vuDaIZ+l/acv01sHoXfpnyrNKOk/3aDoEdLO/Xtn9HuZlDD6jKxHlkN8ZhWyLJsRBxfv9GYM2utQ1SChKew==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-s390x-gnu": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-s390x-gnu/-/resolver-binding-linux-s390x-gnu-1.11.1.tgz",
      "integrity": "sha512-kELo8ebBVtb9sA7rMe1Cph4QHreByhaZ2QEADd9NzIQsYNQpt9UkM9iqr2lhGr5afh885d/cB5QeTXSbZHTYPg==",
      "cpu": [
        "s390x"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-x64-gnu": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-x64-gnu/-/resolver-binding-linux-x64-gnu-1.11.1.tgz",
      "integrity": "sha512-C3ZAHugKgovV5YvAMsxhq0gtXuwESUKc5MhEtjBpLoHPLYM+iuwSj3lflFwK3DPm68660rZ7G8BMcwSro7hD5w==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-linux-x64-musl": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-linux-x64-musl/-/resolver-binding-linux-x64-musl-1.11.1.tgz",
      "integrity": "sha512-rV0YSoyhK2nZ4vEswT/QwqzqQXw5I6CjoaYMOX0TqBlWhojUf8P94mvI7nuJTeaCkkds3QE4+zS8Ko+GdXuZtA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@unrs/resolver-binding-wasm32-wasi": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-wasm32-wasi/-/resolver-binding-wasm32-wasi-1.11.1.tgz",
      "integrity": "sha512-5u4RkfxJm+Ng7IWgkzi3qrFOvLvQYnPBmjmZQ8+szTK/b31fQCnleNl1GgEt7nIsZRIf5PLhPwT0WM+q45x/UQ==",
      "cpu": [
        "wasm32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "@napi-rs/wasm-runtime": "^0.2.11"
      },
      "engines": {
        "node": ">=14.0.0"
      }
    },
    "node_modules/@unrs/resolver-binding-win32-arm64-msvc": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-win32-arm64-msvc/-/resolver-binding-win32-arm64-msvc-1.11.1.tgz",
      "integrity": "sha512-nRcz5Il4ln0kMhfL8S3hLkxI85BXs3o8EYoattsJNdsX4YUU89iOkVn7g0VHSRxFuVMdM4Q1jEpIId1Ihim/Uw==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@unrs/resolver-binding-win32-ia32-msvc": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-win32-ia32-msvc/-/resolver-binding-win32-ia32-msvc-1.11.1.tgz",
      "integrity": "sha512-DCEI6t5i1NmAZp6pFonpD5m7i6aFrpofcp4LA2i8IIq60Jyo28hamKBxNrZcyOwVOZkgsRp9O2sXWBWP8MnvIQ==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@unrs/resolver-binding-win32-x64-msvc": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/@unrs/resolver-binding-win32-x64-msvc/-/resolver-binding-win32-x64-msvc-1.11.1.tgz",
      "integrity": "sha512-lrW200hZdbfRtztbygyaq/6jP6AKE8qQN2KvPcJ+x7wiD038YtnYtZ82IMNJ69GJibV7bwL3y9FgK+5w/pYt6g==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@uppy/audio": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/audio/-/audio-3.0.0.tgz",
      "integrity": "sha512-g8QD69ngLcVrcfl8F33Lv6C/Zd7YvyE6J2jpbd7fK+Q2tZVV4JFEfamVBbIC7ok3k8DxygwSYXXeB0awPg3fDA==",
      "license": "MIT",
      "dependencies": {
        "@uppy/utils": "^7.0.0",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/box": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/box/-/box-4.0.0.tgz",
      "integrity": "sha512-CgDzzMRniI71m+sHHoMRIF6bIVwChWmhWStf6KvoBDBNixDP/D8Gv/MGs2+RwcMgaKmJJ5lmDhB5QJndvW9n7g==",
      "license": "MIT",
      "dependencies": {
        "@uppy/companion-client": "^5.0.0",
        "@uppy/provider-views": "^5.0.0",
        "@uppy/utils": "^7.0.0",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/companion-client": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/companion-client/-/companion-client-5.0.0.tgz",
      "integrity": "sha512-sI8AP5+mhi2HRuXFUGt2tJoIZqzHmznrPn8AdI2B/ny81upLvb5/Zo0BszlleK5iD7Wyxcn0hkBn/HQI73mcjA==",
      "license": "MIT",
      "dependencies": {
        "@uppy/utils": "^7.0.0",
        "namespace-emitter": "^2.0.1",
        "p-retry": "^6.1.0"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/components": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/@uppy/components/-/components-1.0.1.tgz",
      "integrity": "sha512-0e919pTTBit0A3fpjGKkGMeTI1Szwct99x1runSxEd5Y6+GNzZtc4cIStl7q/pXEjmml6/fRG0c5scmxGvVguA==",
      "license": "MIT",
      "dependencies": {
        "@uppy/audio": "^3.0.0",
        "@uppy/core": "^5.0.1",
        "@uppy/image-editor": "^4.0.0",
        "@uppy/remote-sources": "^3.0.0",
        "@uppy/screen-capture": "^5.0.0",
        "@uppy/webcam": "^5.0.0",
        "clsx": "^2.1.1",
        "dequal": "^2.0.3",
        "preact": "^10.5.13",
        "pretty-bytes": "^6.1.1"
      }
    },
    "node_modules/@uppy/core": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/@uppy/core/-/core-5.0.1.tgz",
      "integrity": "sha512-4hLCSjwkJtSZ/W/vJp+GX+4GkSXk/ilrL5ldH0gefAg+mQVxucuLFE7Rc1QdwmUQlnhqIFOSwLAkv2jTTNXGgw==",
      "license": "MIT",
      "dependencies": {
        "@transloadit/prettier-bytes": "^0.3.4",
        "@uppy/store-default": "^5.0.0",
        "@uppy/utils": "^7.0.1",
        "lodash": "^4.17.21",
        "mime-match": "^1.0.2",
        "namespace-emitter": "^2.0.1",
        "nanoid": "^5.0.9",
        "preact": "^10.5.13"
      }
    },
    "node_modules/@uppy/core/node_modules/nanoid": {
      "version": "5.1.5",
      "resolved": "https://registry.npmjs.org/nanoid/-/nanoid-5.1.5.tgz",
      "integrity": "sha512-Ir/+ZpE9fDsNH0hQ3C68uyThDXzYcim2EqcZ8zn8Chtt1iylPT9xXJB0kPCnqzgcEGikO9RxSrh63MsmVCU7Fw==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "bin": {
        "nanoid": "bin/nanoid.js"
      },
      "engines": {
        "node": "^18 || >=20"
      }
    },
    "node_modules/@uppy/dashboard": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/@uppy/dashboard/-/dashboard-5.0.1.tgz",
      "integrity": "sha512-AamgqwlLakPA4I2V51OOiwkv35B6SGXmg/++oVr1JS3IiWXDVHTznzqARxd9npvrcxE0tq4cA5bCEooXmQC8Cw==",
      "license": "MIT",
      "dependencies": {
        "@transloadit/prettier-bytes": "^0.3.4",
        "@uppy/provider-views": "^5.0.1",
        "@uppy/thumbnail-generator": "^5.0.0",
        "@uppy/utils": "^7.0.1",
        "classnames": "^2.2.6",
        "lodash": "^4.17.21",
        "nanoid": "^5.0.9",
        "preact": "^10.5.13",
        "shallow-equal": "^3.0.0"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.1"
      }
    },
    "node_modules/@uppy/dashboard/node_modules/nanoid": {
      "version": "5.1.5",
      "resolved": "https://registry.npmjs.org/nanoid/-/nanoid-5.1.5.tgz",
      "integrity": "sha512-Ir/+ZpE9fDsNH0hQ3C68uyThDXzYcim2EqcZ8zn8Chtt1iylPT9xXJB0kPCnqzgcEGikO9RxSrh63MsmVCU7Fw==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "bin": {
        "nanoid": "bin/nanoid.js"
      },
      "engines": {
        "node": "^18 || >=20"
      }
    },
    "node_modules/@uppy/drag-drop": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/@uppy/drag-drop/-/drag-drop-5.0.1.tgz",
      "integrity": "sha512-82uzOwwjbfQXH8VuEWHbe21QWLwN9LJfG/q1ZCz/iGnD0f6FYivcBMr9UD86N/5fjXfzVtNKYhjrWJEs2NySWA==",
      "license": "MIT",
      "dependencies": {
        "@uppy/utils": "^7.0.1",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.1"
      }
    },
    "node_modules/@uppy/dropbox": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/dropbox/-/dropbox-5.0.0.tgz",
      "integrity": "sha512-Ryi5Vi07koBqchNRCMLkBXOTUdMrQLrDkZFE0tvDUmPXIiK6FIQqAjCQaMGfRLR1CExYR3e7JgBbdjnkeihWjQ==",
      "license": "MIT",
      "dependencies": {
        "@uppy/companion-client": "^5.0.0",
        "@uppy/provider-views": "^5.0.0",
        "@uppy/utils": "^7.0.0",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/facebook": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/facebook/-/facebook-5.0.0.tgz",
      "integrity": "sha512-i87MEQcD4pxZEXlKZ9M8+zLJ/PZUN9DeavOwCuS1tTp8o/srncaeqs+hM5RO4jyDqel5AOgEEfuN3D/XRYpvww==",
      "license": "MIT",
      "dependencies": {
        "@uppy/companion-client": "^5.0.0",
        "@uppy/provider-views": "^5.0.0",
        "@uppy/utils": "^7.0.0",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/google-drive": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/google-drive/-/google-drive-5.0.0.tgz",
      "integrity": "sha512-KwusGTS4NvkwLDQ685fcfCosNsXeAdAq2TPOJJGSoHaMcRaYvbfciOoX5i5iRTK7NWch1AL6lx09xEFdxc7y6g==",
      "license": "MIT",
      "dependencies": {
        "@uppy/companion-client": "^5.0.0",
        "@uppy/provider-views": "^5.0.0",
        "@uppy/utils": "^7.0.0",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/image-editor": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/image-editor/-/image-editor-4.0.0.tgz",
      "integrity": "sha512-5vcVLpalC+0L/7UPNRVXOHt/ZgZO0dwJfKirVwAYhOlym2aEQN8ktopgxaTLRVsYD51l25dJRwjita0aMs0SMQ==",
      "license": "MIT",
      "dependencies": {
        "@uppy/utils": "^7.0.0",
        "cropperjs": "^1.6.2",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/instagram": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/instagram/-/instagram-5.0.0.tgz",
      "integrity": "sha512-uN7OB4Yt1mKM1yY+rzTMSmlcuBN/yMZItxpzOfeYm6d1pk3Fd0dFMIyikz/UWXdcJRv4/SyF9h2YLvGr9VAm9A==",
      "license": "MIT",
      "dependencies": {
        "@uppy/companion-client": "^5.0.0",
        "@uppy/provider-views": "^5.0.0",
        "@uppy/utils": "^7.0.0",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/onedrive": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/onedrive/-/onedrive-5.0.0.tgz",
      "integrity": "sha512-HT21O7rwenaMt+2Wrqs811k8tANKUYiuHkgeY/TvIbs2J2q51LWmPOxNUvToOxx01TT2y9mvUjvydapm/7O/+w==",
      "license": "MIT",
      "dependencies": {
        "@uppy/companion-client": "^5.0.0",
        "@uppy/provider-views": "^5.0.0",
        "@uppy/utils": "^7.0.0",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/provider-views": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/@uppy/provider-views/-/provider-views-5.0.1.tgz",
      "integrity": "sha512-kwOjJgQUFr+cCZkKRpkAeql2fiVZKWYj/9FgbvF7abtwm9tVp9r80P10jyYLUpbCZyvAwvvomLEXBKm2Qdf+Dw==",
      "license": "MIT",
      "dependencies": {
        "@uppy/utils": "^7.0.1",
        "classnames": "^2.2.6",
        "nanoid": "^5.0.9",
        "p-queue": "^8.0.0",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.1"
      }
    },
    "node_modules/@uppy/provider-views/node_modules/nanoid": {
      "version": "5.1.5",
      "resolved": "https://registry.npmjs.org/nanoid/-/nanoid-5.1.5.tgz",
      "integrity": "sha512-Ir/+ZpE9fDsNH0hQ3C68uyThDXzYcim2EqcZ8zn8Chtt1iylPT9xXJB0kPCnqzgcEGikO9RxSrh63MsmVCU7Fw==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "bin": {
        "nanoid": "bin/nanoid.js"
      },
      "engines": {
        "node": "^18 || >=20"
      }
    },
    "node_modules/@uppy/react": {
      "version": "5.0.2",
      "resolved": "https://registry.npmjs.org/@uppy/react/-/react-5.0.2.tgz",
      "integrity": "sha512-Wc0V64PvvtxrZnt3IPK1u8bMnGsN5tOQMu5yYAvTcH1vKLBEESTRm3DWy2YhCsuCYYjtWx3Pb5kH/ozm1g0xqg==",
      "license": "MIT",
      "dependencies": {
        "@uppy/components": "^1.0.1",
        "@uppy/utils": "^7.0.1",
        "preact": "^10.5.13",
        "use-sync-external-store": "^1.3.0"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.1",
        "@uppy/dashboard": "^5.0.1",
        "@uppy/screen-capture": "^5.0.0",
        "@uppy/webcam": "^5.0.0",
        "react": "^18.0.0 || ^19.0.0",
        "react-dom": "^18.0.0 || ^19.0.0"
      },
      "peerDependenciesMeta": {
        "@uppy/dashboard": {
          "optional": true
        },
        "@uppy/screen-capture": {
          "optional": true
        },
        "@uppy/webcam": {
          "optional": true
        }
      }
    },
    "node_modules/@uppy/remote-sources": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/remote-sources/-/remote-sources-3.0.0.tgz",
      "integrity": "sha512-Hums7HC0YVJP3WHI3674Fk5JYnpga6gDCBT2oK9sO2Cd0wK73VGSfzQRzDDrWxKu0updbunMMehccv4m7wNd4g==",
      "license": "MIT",
      "dependencies": {
        "@uppy/box": "^4.0.0",
        "@uppy/dashboard": "^5.0.0",
        "@uppy/dropbox": "^5.0.0",
        "@uppy/facebook": "^5.0.0",
        "@uppy/google-drive": "^5.0.0",
        "@uppy/instagram": "^5.0.0",
        "@uppy/onedrive": "^5.0.0",
        "@uppy/unsplash": "^5.0.0",
        "@uppy/url": "^5.0.0",
        "@uppy/zoom": "^4.0.0"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/screen-capture": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/screen-capture/-/screen-capture-5.0.0.tgz",
      "integrity": "sha512-gH57mCnJfcPnvlN9FF/lOF7bw0D8Cdt9zQx4hxxkHtsVOtSkCy+j7nPknMuouTK1t1XNoiFM99SDzmPyK8AdPQ==",
      "license": "MIT",
      "dependencies": {
        "@uppy/utils": "^7.0.0",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/store-default": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/store-default/-/store-default-5.0.0.tgz",
      "integrity": "sha512-hQtCSQ1yGiaval/wVYUWquYGDJ+bpQ7e4FhUUAsRQz1x1K+o7NBtjfp63O9I4Ks1WRoKunpkarZ+as09l02cPw==",
      "license": "MIT"
    },
    "node_modules/@uppy/thumbnail-generator": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/thumbnail-generator/-/thumbnail-generator-5.0.0.tgz",
      "integrity": "sha512-dqnsVOpGR+QtpBKwXYEgiIy1cEl+wfiwm/411gwsAiaYITtEGePsXfTiYNFN/dkCVfrDqWw+r/MFTxRNXZKm9A==",
      "license": "MIT",
      "dependencies": {
        "@uppy/utils": "^7.0.0",
        "exifr": "^7.0.0"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/unsplash": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/unsplash/-/unsplash-5.0.0.tgz",
      "integrity": "sha512-cB0nwp5ZKfmjbs2rPEbQ8GkfJMQ2csNGy8Mncadbe91yv6cdPhEF9Z8OqaRGMc68/2PgXXKtsLTZyDJNurQ7Ig==",
      "license": "MIT",
      "dependencies": {
        "@uppy/companion-client": "^5.0.0",
        "@uppy/provider-views": "^5.0.0",
        "@uppy/utils": "^7.0.0",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/url": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/url/-/url-5.0.0.tgz",
      "integrity": "sha512-82LBkkKwgUVhPSngfYY+aFLQjb5tnOc4IlqXSZoXV1XPb8Lsxd++gwg5EiOxQyNojJGTWPyZL1bPWn7qI5VNag==",
      "license": "MIT",
      "dependencies": {
        "@uppy/companion-client": "^5.0.0",
        "@uppy/utils": "^7.0.0",
        "nanoid": "^5.0.9",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/url/node_modules/nanoid": {
      "version": "5.1.5",
      "resolved": "https://registry.npmjs.org/nanoid/-/nanoid-5.1.5.tgz",
      "integrity": "sha512-Ir/+ZpE9fDsNH0hQ3C68uyThDXzYcim2EqcZ8zn8Chtt1iylPT9xXJB0kPCnqzgcEGikO9RxSrh63MsmVCU7Fw==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "bin": {
        "nanoid": "bin/nanoid.js"
      },
      "engines": {
        "node": "^18 || >=20"
      }
    },
    "node_modules/@uppy/utils": {
      "version": "7.0.1",
      "resolved": "https://registry.npmjs.org/@uppy/utils/-/utils-7.0.1.tgz",
      "integrity": "sha512-OLG5cbMYApwrj5VOeK4vEVOx0YtrsCMJKNqdA9LkFNIGWaF9KJPE6+P/MEvxgdAlnCZrF4Z7Gf/EuZF0gKMYJw==",
      "license": "MIT",
      "dependencies": {
        "lodash": "^4.17.21",
        "preact": "^10.5.13"
      }
    },
    "node_modules/@uppy/webcam": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/webcam/-/webcam-5.0.0.tgz",
      "integrity": "sha512-dVKC253DqbUXidZTGehfCs9yu9QXHYLNd7J82yKNg+2vNc9/5NebCChEgWBxfdxlA4sbd2PPdHp+/qmGO6uqVQ==",
      "license": "MIT",
      "dependencies": {
        "@uppy/utils": "^7.0.0",
        "is-mobile": "^4.0.0",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/xhr-upload": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/xhr-upload/-/xhr-upload-5.0.0.tgz",
      "integrity": "sha512-ry/tDULv7xPEkm7VNl6GXV46JYb5lR/BUDo0Nl+S6n3I0EEMRO/sD30yA5BQZo80oZDUEyUGLoJ8HseD0nm4tA==",
      "license": "MIT",
      "dependencies": {
        "@uppy/companion-client": "^5.0.0",
        "@uppy/utils": "^7.0.0"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/@uppy/zoom": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/@uppy/zoom/-/zoom-4.0.0.tgz",
      "integrity": "sha512-BWxV0CWS8G3C8fFcugAjRSB9Dqb8HmCkmOjcjMQSXPhI1uyaHCMJ2HC90Xe0m2p+kyXrubT/S7BRBvU3KLlfyw==",
      "license": "MIT",
      "dependencies": {
        "@uppy/companion-client": "^5.0.0",
        "@uppy/provider-views": "^5.0.0",
        "@uppy/utils": "^7.0.0",
        "preact": "^10.5.13"
      },
      "peerDependencies": {
        "@uppy/core": "^5.0.0"
      }
    },
    "node_modules/acorn": {
      "version": "8.15.0",
      "resolved": "https://registry.npmjs.org/acorn/-/acorn-8.15.0.tgz",
      "integrity": "sha512-NZyJarBfL7nWwIq+FDL6Zp/yHEhePMNnnJ0y3qfieCrmNvYct8uvtiV41UvlSe6apAfk0fY1FbWx+NwfmpvtTg==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "acorn": "bin/acorn"
      },
      "engines": {
        "node": ">=0.4.0"
      }
    },
    "node_modules/acorn-jsx": {
      "version": "5.3.2",
      "resolved": "https://registry.npmjs.org/acorn-jsx/-/acorn-jsx-5.3.2.tgz",
      "integrity": "sha512-rq9s+JNhf0IChjtDXxllJ7g41oZk5SlXtp0LHwyA5cejwn7vKmKp4pPri6YEePv2PU65sAsegbXtIinmDFDXgQ==",
      "dev": true,
      "license": "MIT",
      "peerDependencies": {
        "acorn": "^6.0.0 || ^7.0.0 || ^8.0.0"
      }
    },
    "node_modules/adler-32": {
      "version": "1.3.1",
      "resolved": "https://registry.npmjs.org/adler-32/-/adler-32-1.3.1.tgz",
      "integrity": "sha512-ynZ4w/nUUv5rrsR8UUGoe1VC9hZj6V5hU9Qw1HlMDJGEJw5S7TfTErWTjMys6M7vr0YWcPqs3qAr4ss0nDfP+A==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/agent-base": {
      "version": "7.1.4",
      "resolved": "https://registry.npmjs.org/agent-base/-/agent-base-7.1.4.tgz",
      "integrity": "sha512-MnA+YT8fwfJPgBx3m60MNqakm30XOkyIoH1y6huTQvC0PwZG7ki8NacLBcrPbNoo8vEZy7Jpuk7+jMO+CUovTQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 14"
      }
    },
    "node_modules/ajv": {
      "version": "6.12.6",
      "resolved": "https://registry.npmjs.org/ajv/-/ajv-6.12.6.tgz",
      "integrity": "sha512-j3fVLgvTo527anyYyJOGTYJbG+vnnQYvE0m5mmkc1TK+nxAppkCLMIL0aZ4dblVCNoGShhm+kzE4ZUykBoMg4g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "fast-deep-equal": "^3.1.1",
        "fast-json-stable-stringify": "^2.0.0",
        "json-schema-traverse": "^0.4.1",
        "uri-js": "^4.2.2"
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/epoberezkin"
      }
    },
    "node_modules/ansi-styles": {
      "version": "4.3.0",
      "resolved": "https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz",
      "integrity": "sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "color-convert": "^2.0.1"
      },
      "engines": {
        "node": ">=8"
      },
      "funding": {
        "url": "https://github.com/chalk/ansi-styles?sponsor=1"
      }
    },
    "node_modules/archiver": {
      "version": "5.3.2",
      "resolved": "https://registry.npmjs.org/archiver/-/archiver-5.3.2.tgz",
      "integrity": "sha512-+25nxyyznAXF7Nef3y0EbBeqmGZgeN/BxHX29Rs39djAfaFalmQ89SE6CWyDCHzGL0yt/ycBtNOmGTW0FyGWNw==",
      "license": "MIT",
      "dependencies": {
        "archiver-utils": "^2.1.0",
        "async": "^3.2.4",
        "buffer-crc32": "^0.2.1",
        "readable-stream": "^3.6.0",
        "readdir-glob": "^1.1.2",
        "tar-stream": "^2.2.0",
        "zip-stream": "^4.1.0"
      },
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/archiver-utils": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/archiver-utils/-/archiver-utils-2.1.0.tgz",
      "integrity": "sha512-bEL/yUb/fNNiNTuUz979Z0Yg5L+LzLxGJz8x79lYmR54fmTIb6ob/hNQgkQnIUDWIFjZVQwl9Xs356I6BAMHfw==",
      "license": "MIT",
      "dependencies": {
        "glob": "^7.1.4",
        "graceful-fs": "^4.2.0",
        "lazystream": "^1.0.0",
        "lodash.defaults": "^4.2.0",
        "lodash.difference": "^4.5.0",
        "lodash.flatten": "^4.4.0",
        "lodash.isplainobject": "^4.0.6",
        "lodash.union": "^4.6.0",
        "normalize-path": "^3.0.0",
        "readable-stream": "^2.0.0"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/archiver-utils/node_modules/isarray": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/isarray/-/isarray-1.0.0.tgz",
      "integrity": "sha512-VLghIWNM6ELQzo7zwmcg0NmTVyWKYjvIeM83yjp0wRDTmUnrM678fQbcKBo6n2CJEF0szoG//ytg+TKla89ALQ==",
      "license": "MIT"
    },
    "node_modules/archiver-utils/node_modules/readable-stream": {
      "version": "2.3.8",
      "resolved": "https://registry.npmjs.org/readable-stream/-/readable-stream-2.3.8.tgz",
      "integrity": "sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA==",
      "license": "MIT",
      "dependencies": {
        "core-util-is": "~1.0.0",
        "inherits": "~2.0.3",
        "isarray": "~1.0.0",
        "process-nextick-args": "~2.0.0",
        "safe-buffer": "~5.1.1",
        "string_decoder": "~1.1.1",
        "util-deprecate": "~1.0.1"
      }
    },
    "node_modules/archiver-utils/node_modules/safe-buffer": {
      "version": "5.1.2",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.1.2.tgz",
      "integrity": "sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==",
      "license": "MIT"
    },
    "node_modules/archiver-utils/node_modules/string_decoder": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/string_decoder/-/string_decoder-1.1.1.tgz",
      "integrity": "sha512-n/ShnvDi6FHbbVfviro+WojiFzv+s8MPMHBczVePfUpDJLwoLT0ht1l4YwBCbi8pJAveEEdnkHyPyTP/mzRfwg==",
      "license": "MIT",
      "dependencies": {
        "safe-buffer": "~5.1.0"
      }
    },
    "node_modules/argparse": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/argparse/-/argparse-2.0.1.tgz",
      "integrity": "sha512-8+9WqebbFzpX9OR+Wa6O29asIogeRMzcGtAINdpMHHyAg10f05aSFVBbcEqGf/PXw1EjAZ+q2/bEBg3DvurK3Q==",
      "dev": true,
      "license": "Python-2.0"
    },
    "node_modules/aria-hidden": {
      "version": "1.2.6",
      "resolved": "https://registry.npmjs.org/aria-hidden/-/aria-hidden-1.2.6.tgz",
      "integrity": "sha512-ik3ZgC9dY/lYVVM++OISsaYDeg1tb0VtP5uL3ouh1koGOaUMDPpbFIei4JkFimWUFPn90sbMNMXQAIVOlnYKJA==",
      "license": "MIT",
      "dependencies": {
        "tslib": "^2.0.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/aria-query": {
      "version": "5.3.2",
      "resolved": "https://registry.npmjs.org/aria-query/-/aria-query-5.3.2.tgz",
      "integrity": "sha512-COROpnaoap1E2F000S62r6A60uHZnmlvomhfyT2DlTcrY1OrBKn2UhH7qn5wTC9zMvD0AY7csdPSNwKP+7WiQw==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/array-buffer-byte-length": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/array-buffer-byte-length/-/array-buffer-byte-length-1.0.2.tgz",
      "integrity": "sha512-LHE+8BuR7RYGDKvnrmcuSq3tDcKv9OFEXQt/HpbZhY7V6h0zlUXutnAD82GiFx9rdieCMjkvtcsPqBwgUl1Iiw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "is-array-buffer": "^3.0.5"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/array-includes": {
      "version": "3.1.9",
      "resolved": "https://registry.npmjs.org/array-includes/-/array-includes-3.1.9.tgz",
      "integrity": "sha512-FmeCCAenzH0KH381SPT5FZmiA/TmpndpcaShhfgEN9eCVjnFBqq3l1xrI42y8+PPLI6hypzou4GXw00WHmPBLQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.4",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.24.0",
        "es-object-atoms": "^1.1.1",
        "get-intrinsic": "^1.3.0",
        "is-string": "^1.1.1",
        "math-intrinsics": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/array.prototype.findlast": {
      "version": "1.2.5",
      "resolved": "https://registry.npmjs.org/array.prototype.findlast/-/array.prototype.findlast-1.2.5.tgz",
      "integrity": "sha512-CVvd6FHg1Z3POpBLxO6E6zr+rSKEQ9L6rZHAaY7lLfhKsWYUBBOuMs0e9o24oopj6H+geRCX0YJ+TJLBK2eHyQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.2",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.0.0",
        "es-shim-unscopables": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/array.prototype.findlastindex": {
      "version": "1.2.6",
      "resolved": "https://registry.npmjs.org/array.prototype.findlastindex/-/array.prototype.findlastindex-1.2.6.tgz",
      "integrity": "sha512-F/TKATkzseUExPlfvmwQKGITM3DGTK+vkAsCZoDc5daVygbJBnjEUCbgkAvVFsgfXfX4YIqZ/27G3k3tdXrTxQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.4",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.9",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.1.1",
        "es-shim-unscopables": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/array.prototype.flat": {
      "version": "1.3.3",
      "resolved": "https://registry.npmjs.org/array.prototype.flat/-/array.prototype.flat-1.3.3.tgz",
      "integrity": "sha512-rwG/ja1neyLqCuGZ5YYrznA62D4mZXg0i1cIskIUKSiqF3Cje9/wXAls9B9s1Wa2fomMsIv8czB8jZcPmxCXFg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.5",
        "es-shim-unscopables": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/array.prototype.flatmap": {
      "version": "1.3.3",
      "resolved": "https://registry.npmjs.org/array.prototype.flatmap/-/array.prototype.flatmap-1.3.3.tgz",
      "integrity": "sha512-Y7Wt51eKJSyi80hFrJCePGGNo5ktJCslFuboqJsbf57CCPcm5zztluPlc4/aD8sWsKvlwatezpV4U1efk8kpjg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.5",
        "es-shim-unscopables": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/array.prototype.tosorted": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/array.prototype.tosorted/-/array.prototype.tosorted-1.1.4.tgz",
      "integrity": "sha512-p6Fx8B7b7ZhL/gmUsAy0D15WhvDccw3mnGNbZpi3pmeJdxtWsj2jEaI4Y6oo3XiHfzuSgPwKc04MYt6KgvC/wA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.3",
        "es-errors": "^1.3.0",
        "es-shim-unscopables": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/arraybuffer.prototype.slice": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/arraybuffer.prototype.slice/-/arraybuffer.prototype.slice-1.0.4.tgz",
      "integrity": "sha512-BNoCY6SXXPQ7gF2opIP4GBE+Xw7U+pHMYKuzjgCN3GwiaIR09UUeKfheyIry77QtrCBlC0KK0q5/TER/tYh3PQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "array-buffer-byte-length": "^1.0.1",
        "call-bind": "^1.0.8",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.5",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.6",
        "is-array-buffer": "^3.0.4"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/asn1.js": {
      "version": "5.4.1",
      "resolved": "https://registry.npmjs.org/asn1.js/-/asn1.js-5.4.1.tgz",
      "integrity": "sha512-+I//4cYPccV8LdmBLiX8CYvf9Sp3vQsrqu2QNXRcrbiWvcx/UdlFiqUJJzxRQxgsZmvhXhn4cSKeSmoFjVdupA==",
      "license": "MIT",
      "dependencies": {
        "bn.js": "^4.0.0",
        "inherits": "^2.0.1",
        "minimalistic-assert": "^1.0.0",
        "safer-buffer": "^2.1.0"
      }
    },
    "node_modules/ast-types-flow": {
      "version": "0.0.8",
      "resolved": "https://registry.npmjs.org/ast-types-flow/-/ast-types-flow-0.0.8.tgz",
      "integrity": "sha512-OH/2E5Fg20h2aPrbe+QL8JZQFko0YZaF+j4mnQ7BGhfavO7OpSLa8a0y9sBwomHdSbkhTS8TQNayBfnW5DwbvQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/async": {
      "version": "3.2.6",
      "resolved": "https://registry.npmjs.org/async/-/async-3.2.6.tgz",
      "integrity": "sha512-htCUDlxyyCLMgaM3xXg0C0LW2xqfuQ6p05pCEIsXuyQ+a1koYKTuBMzRNwmybfLgvJDMd0r1LTn4+E0Ti6C2AA==",
      "license": "MIT"
    },
    "node_modules/async-function": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/async-function/-/async-function-1.0.0.tgz",
      "integrity": "sha512-hsU18Ae8CDTR6Kgu9DYf0EbCr/a5iGL0rytQDobUcdpYOKokk8LEjVphnXkDkgpi0wYVsqrXuP0bZxJaTqdgoA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/available-typed-arrays": {
      "version": "1.0.7",
      "resolved": "https://registry.npmjs.org/available-typed-arrays/-/available-typed-arrays-1.0.7.tgz",
      "integrity": "sha512-wvUjBtSGN7+7SjNpq/9M2Tg350UZD3q62IFZLbRAR1bSMlCo1ZaeW+BJ+D090e4hIIZLBcTDWe4Mh4jvUDajzQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "possible-typed-array-names": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/axe-core": {
      "version": "4.10.3",
      "resolved": "https://registry.npmjs.org/axe-core/-/axe-core-4.10.3.tgz",
      "integrity": "sha512-Xm7bpRXnDSX2YE2YFfBk2FnF0ep6tmG7xPh8iHee8MIcrgq762Nkce856dYtJYLkuIoYZvGfTs/PbZhideTcEg==",
      "dev": true,
      "license": "MPL-2.0",
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/axobject-query": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/axobject-query/-/axobject-query-4.1.0.tgz",
      "integrity": "sha512-qIj0G9wZbMGNLjLmg1PT6v2mE9AH2zlnADJD/2tC6E00hgmhUOfEB6greHPAfLRSufHqROIUTkw6E+M3lH0PTQ==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/babel-plugin-macros": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/babel-plugin-macros/-/babel-plugin-macros-3.1.0.tgz",
      "integrity": "sha512-Cg7TFGpIr01vOQNODXOOaGz2NpCU5gl8x1qJFbb6hbZxR7XrcE2vtbAsTAbJ7/xwJtUuJEw8K8Zr/AE0LHlesg==",
      "license": "MIT",
      "dependencies": {
        "@babel/runtime": "^7.12.5",
        "cosmiconfig": "^7.0.0",
        "resolve": "^1.19.0"
      },
      "engines": {
        "node": ">=10",
        "npm": ">=6"
      }
    },
    "node_modules/balanced-match": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/balanced-match/-/balanced-match-1.0.2.tgz",
      "integrity": "sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==",
      "license": "MIT"
    },
    "node_modules/base64-js": {
      "version": "1.5.1",
      "resolved": "https://registry.npmjs.org/base64-js/-/base64-js-1.5.1.tgz",
      "integrity": "sha512-AKpaYlHn8t4SVbOHCy+b5+KKgvR4vrsD8vbvrbiQJps7fKDTkjkDry6ji0rUJjC0kzbNePLwzxq8iypo41qeWA==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT"
    },
    "node_modules/bcrypt": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/bcrypt/-/bcrypt-6.0.0.tgz",
      "integrity": "sha512-cU8v/EGSrnH+HnxV2z0J7/blxH8gq7Xh2JFT6Aroax7UohdmiJJlxApMxtKfuI7z68NvvVcmR78k2LbT6efhRg==",
      "hasInstallScript": true,
      "license": "MIT",
      "dependencies": {
        "node-addon-api": "^8.3.0",
        "node-gyp-build": "^4.8.4"
      },
      "engines": {
        "node": ">= 18"
      }
    },
    "node_modules/big-integer": {
      "version": "1.6.52",
      "resolved": "https://registry.npmjs.org/big-integer/-/big-integer-1.6.52.tgz",
      "integrity": "sha512-QxD8cf2eVqJOOz63z6JIN9BzvVs/dlySa5HGSBH5xtR8dPteIRQnBxxKqkNTiT6jbDTF6jAfrd4oMcND9RGbQg==",
      "license": "Unlicense",
      "engines": {
        "node": ">=0.6"
      }
    },
    "node_modules/bin-links": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/bin-links/-/bin-links-5.0.0.tgz",
      "integrity": "sha512-sdleLVfCjBtgO5cNjA2HVRvWBJAHs4zwenaCPMNJAJU0yNxpzj80IpjOIimkpkr+mhlA+how5poQtt53PygbHA==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "cmd-shim": "^7.0.0",
        "npm-normalize-package-bin": "^4.0.0",
        "proc-log": "^5.0.0",
        "read-cmd-shim": "^5.0.0",
        "write-file-atomic": "^6.0.0"
      },
      "engines": {
        "node": "^18.17.0 || >=20.5.0"
      }
    },
    "node_modules/binary": {
      "version": "0.3.0",
      "resolved": "https://registry.npmjs.org/binary/-/binary-0.3.0.tgz",
      "integrity": "sha512-D4H1y5KYwpJgK8wk1Cue5LLPgmwHKYSChkbspQg5JtVuR5ulGckxfR62H3AE9UDkdMC8yyXlqYihuz3Aqg2XZg==",
      "license": "MIT",
      "dependencies": {
        "buffers": "~0.1.1",
        "chainsaw": "~0.1.0"
      },
      "engines": {
        "node": "*"
      }
    },
    "node_modules/bl": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/bl/-/bl-4.1.0.tgz",
      "integrity": "sha512-1W07cM9gS6DcLperZfFSj+bWLtaPGSOHWhPiGzXmvVJbRLdG82sH/Kn8EtW1VqWVA54AKf2h5k5BbnIbwF3h6w==",
      "license": "MIT",
      "dependencies": {
        "buffer": "^5.5.0",
        "inherits": "^2.0.4",
        "readable-stream": "^3.4.0"
      }
    },
    "node_modules/bluebird": {
      "version": "3.4.7",
      "resolved": "https://registry.npmjs.org/bluebird/-/bluebird-3.4.7.tgz",
      "integrity": "sha512-iD3898SR7sWVRHbiQv+sHUtHnMvC1o3nW5rAcqnq3uOn07DSAppZYUkIGslDz6gXC7HfunPe7YVBgoEJASPcHA==",
      "license": "MIT"
    },
    "node_modules/bn.js": {
      "version": "4.12.2",
      "resolved": "https://registry.npmjs.org/bn.js/-/bn.js-4.12.2.tgz",
      "integrity": "sha512-n4DSx829VRTRByMRGdjQ9iqsN0Bh4OolPsFnaZBLcbi8iXcB+kJ9s7EnRt4wILZNV3kPLHkRVfOc/HvhC3ovDw==",
      "license": "MIT"
    },
    "node_modules/brace-expansion": {
      "version": "1.1.12",
      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-1.1.12.tgz",
      "integrity": "sha512-9T9UjW3r0UW5c1Q7GTwllptXwhvYmEzFhzMfZ9H7FQWt+uZePjZPjBP/W1ZEyZ1twGWom5/56TF4lPcqjnDHcg==",
      "license": "MIT",
      "dependencies": {
        "balanced-match": "^1.0.0",
        "concat-map": "0.0.1"
      }
    },
    "node_modules/braces": {
      "version": "3.0.3",
      "resolved": "https://registry.npmjs.org/braces/-/braces-3.0.3.tgz",
      "integrity": "sha512-yQbXgO/OSZVD2IsiLlro+7Hf6Q18EJrKSEsdoMzKePKXct3gvD8oLcOQdIzGupr5Fj+EDe8gO/lxc1BzfMpxvA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "fill-range": "^7.1.1"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/buffer": {
      "version": "5.7.1",
      "resolved": "https://registry.npmjs.org/buffer/-/buffer-5.7.1.tgz",
      "integrity": "sha512-EHcyIPBQ4BSGlvjB16k5KgAJ27CIsHY/2JBmCRReo48y9rQ3MaUzWX3KVlBa4U7MyX02HdVj0K7C3WaB3ju7FQ==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "base64-js": "^1.3.1",
        "ieee754": "^1.1.13"
      }
    },
    "node_modules/buffer-crc32": {
      "version": "0.2.13",
      "resolved": "https://registry.npmjs.org/buffer-crc32/-/buffer-crc32-0.2.13.tgz",
      "integrity": "sha512-VO9Ht/+p3SN7SKWqcrgEzjGbRSJYTx+Q1pTQC0wrWqHx0vpJraQ6GtHx8tvcg1rlK1byhU5gccxgOgj7B0TDkQ==",
      "license": "MIT",
      "engines": {
        "node": "*"
      }
    },
    "node_modules/buffer-equal-constant-time": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/buffer-equal-constant-time/-/buffer-equal-constant-time-1.0.1.tgz",
      "integrity": "sha512-zRpUiDwd/xk6ADqPMATG8vc9VPrkck7T07OIx0gnjmJAnHnTVXNQG3vfvWNuiZIkwu9KrKdA1iJKfsfTVxE6NA==",
      "license": "BSD-3-Clause"
    },
    "node_modules/buffer-indexof-polyfill": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/buffer-indexof-polyfill/-/buffer-indexof-polyfill-1.0.2.tgz",
      "integrity": "sha512-I7wzHwA3t1/lwXQh+A5PbNvJxgfo5r3xulgpYDB5zckTu/Z9oUK9biouBKQUjEqzaz3HnAT6TYoovmE+GqSf7A==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10"
      }
    },
    "node_modules/buffers": {
      "version": "0.1.1",
      "resolved": "https://registry.npmjs.org/buffers/-/buffers-0.1.1.tgz",
      "integrity": "sha512-9q/rDEGSb/Qsvv2qvzIzdluL5k7AaJOTrw23z9reQthrbF7is4CtlT0DXyO1oei2DCp4uojjzQ7igaSHp1kAEQ==",
      "engines": {
        "node": ">=0.2.0"
      }
    },
    "node_modules/call-bind": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/call-bind/-/call-bind-1.0.8.tgz",
      "integrity": "sha512-oKlSFMcMwpUg2ednkhQ454wfWiU/ul3CkJe/PEHcTKuiX6RpbehUiFMXu13HalGZxfUwCQzZG747YXBn1im9ww==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.0",
        "es-define-property": "^1.0.0",
        "get-intrinsic": "^1.2.4",
        "set-function-length": "^1.2.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/call-bind-apply-helpers": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/call-bind-apply-helpers/-/call-bind-apply-helpers-1.0.2.tgz",
      "integrity": "sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/call-bound": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/call-bound/-/call-bound-1.0.4.tgz",
      "integrity": "sha512-+ys997U96po4Kx/ABpBCqhA9EuxJaQWDQg7295H4hBphv3IZg0boBKuwYpt4YXp6MZ5AmZQnU/tyMTlRpaSejg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "get-intrinsic": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/callsites": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/callsites/-/callsites-3.1.0.tgz",
      "integrity": "sha512-P8BjAsXvZS+VIDUI11hHCQEv74YT67YUi5JJFNWIqL235sBmjX4+qx9Muvls5ivyNENctx46xQLQ3aTuE7ssaQ==",
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/caniuse-lite": {
      "version": "1.0.30001735",
      "resolved": "https://registry.npmjs.org/caniuse-lite/-/caniuse-lite-1.0.30001735.tgz",
      "integrity": "sha512-EV/laoX7Wq2J9TQlyIXRxTJqIw4sxfXS4OYgudGxBYRuTv0q7AM6yMEpU/Vo1I94thg9U6EZ2NfZx9GJq83u7w==",
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/browserslist"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/caniuse-lite"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "CC-BY-4.0"
    },
    "node_modules/cfb": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/cfb/-/cfb-1.2.2.tgz",
      "integrity": "sha512-KfdUZsSOw19/ObEWasvBP/Ac4reZvAGauZhs6S/gqNhXhI7cKwvlH7ulj+dOEYnca4bm4SGo8C1bTAQvnTjgQA==",
      "license": "Apache-2.0",
      "dependencies": {
        "adler-32": "~1.3.0",
        "crc-32": "~1.2.0"
      },
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/chainsaw": {
      "version": "0.1.0",
      "resolved": "https://registry.npmjs.org/chainsaw/-/chainsaw-0.1.0.tgz",
      "integrity": "sha512-75kWfWt6MEKNC8xYXIdRpDehRYY/tNSgwKaJq+dbbDcxORuVrrQ+SEHoWsniVn9XPYfP4gmdWIeDk/4YNp1rNQ==",
      "license": "MIT/X11",
      "dependencies": {
        "traverse": ">=0.3.0 <0.4"
      },
      "engines": {
        "node": "*"
      }
    },
    "node_modules/chalk": {
      "version": "4.1.2",
      "resolved": "https://registry.npmjs.org/chalk/-/chalk-4.1.2.tgz",
      "integrity": "sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ansi-styles": "^4.1.0",
        "supports-color": "^7.1.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/chalk/chalk?sponsor=1"
      }
    },
    "node_modules/chownr": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/chownr/-/chownr-3.0.0.tgz",
      "integrity": "sha512-+IxzY9BZOQd/XuYPRmrvEVjF/nqj5kgT4kEq7VofrDoM1MxoRjEWkrCC3EtLi59TVawxTAn+orJwFQcrqEN1+g==",
      "dev": true,
      "license": "BlueOak-1.0.0",
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/class-variance-authority": {
      "version": "0.7.1",
      "resolved": "https://registry.npmjs.org/class-variance-authority/-/class-variance-authority-0.7.1.tgz",
      "integrity": "sha512-Ka+9Trutv7G8M6WT6SeiRWz792K5qEqIGEGzXKhAE6xOWAY6pPH8U+9IY3oCMv6kqTmLsv7Xh/2w2RigkePMsg==",
      "license": "Apache-2.0",
      "dependencies": {
        "clsx": "^2.1.1"
      },
      "funding": {
        "url": "https://polar.sh/cva"
      }
    },
    "node_modules/classnames": {
      "version": "2.5.1",
      "resolved": "https://registry.npmjs.org/classnames/-/classnames-2.5.1.tgz",
      "integrity": "sha512-saHYOzhIQs6wy2sVxTM6bUDsQO4F50V9RQ22qBpEdCW+I+/Wmke2HOl6lS6dTpdxVhb88/I6+Hs+438c3lfUow==",
      "license": "MIT"
    },
    "node_modules/client-only": {
      "version": "0.0.1",
      "resolved": "https://registry.npmjs.org/client-only/-/client-only-0.0.1.tgz",
      "integrity": "sha512-IV3Ou0jSMzZrd3pZ48nLkT9DA7Ag1pnPzaiQhpW7c3RbcqqzvzzVu+L8gfqMp/8IM2MQtSiqaCxrrcfu8I8rMA==",
      "license": "MIT"
    },
    "node_modules/clsx": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/clsx/-/clsx-2.1.1.tgz",
      "integrity": "sha512-eYm0QWBtUrBWZWG0d386OGAw16Z995PiOVo2B7bjWSbHedGl5e0ZWaq65kOGgUSNesEIDkB9ISbTg/JK9dhCZA==",
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/cmd-shim": {
      "version": "7.0.0",
      "resolved": "https://registry.npmjs.org/cmd-shim/-/cmd-shim-7.0.0.tgz",
      "integrity": "sha512-rtpaCbr164TPPh+zFdkWpCyZuKkjpAzODfaZCf/SVJZzJN+4bHQb/LP3Jzq5/+84um3XXY8r548XiWKSborwVw==",
      "dev": true,
      "license": "ISC",
      "engines": {
        "node": "^18.17.0 || >=20.5.0"
      }
    },
    "node_modules/codepage": {
      "version": "1.15.0",
      "resolved": "https://registry.npmjs.org/codepage/-/codepage-1.15.0.tgz",
      "integrity": "sha512-3g6NUTPd/YtuuGrhMnOMRjFc+LJw/bnMp3+0r/Wcz3IXUuCosKRJvMphm5+Q+bvTVGcJJuRvVLuYba+WojaFaA==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/color": {
      "version": "4.2.3",
      "resolved": "https://registry.npmjs.org/color/-/color-4.2.3.tgz",
      "integrity": "sha512-1rXeuUUiGGrykh+CeBdu5Ie7OJwinCgQY0bc7GCRxy5xVHy+moaqkpL/jqQq0MtQOeYcrqEz4abc5f0KtU7W4A==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "color-convert": "^2.0.1",
        "color-string": "^1.9.0"
      },
      "engines": {
        "node": ">=12.5.0"
      }
    },
    "node_modules/color-convert": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/color-convert/-/color-convert-2.0.1.tgz",
      "integrity": "sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==",
      "devOptional": true,
      "license": "MIT",
      "dependencies": {
        "color-name": "~1.1.4"
      },
      "engines": {
        "node": ">=7.0.0"
      }
    },
    "node_modules/color-name": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/color-name/-/color-name-1.1.4.tgz",
      "integrity": "sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==",
      "devOptional": true,
      "license": "MIT"
    },
    "node_modules/color-string": {
      "version": "1.9.1",
      "resolved": "https://registry.npmjs.org/color-string/-/color-string-1.9.1.tgz",
      "integrity": "sha512-shrVawQFojnZv6xM40anx4CkoDP+fZsw/ZerEMsW/pyzsRbElpsL/DBVW7q3ExxwusdNXI3lXpuhEZkzs8p5Eg==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "color-name": "^1.0.0",
        "simple-swizzle": "^0.2.2"
      }
    },
    "node_modules/compress-commons": {
      "version": "4.1.2",
      "resolved": "https://registry.npmjs.org/compress-commons/-/compress-commons-4.1.2.tgz",
      "integrity": "sha512-D3uMHtGc/fcO1Gt1/L7i1e33VOvD4A9hfQLP+6ewd+BvG/gQ84Yh4oftEhAdjSMgBgwGL+jsppT7JYNpo6MHHg==",
      "license": "MIT",
      "dependencies": {
        "buffer-crc32": "^0.2.13",
        "crc32-stream": "^4.0.2",
        "normalize-path": "^3.0.0",
        "readable-stream": "^3.6.0"
      },
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/concat-map": {
      "version": "0.0.1",
      "resolved": "https://registry.npmjs.org/concat-map/-/concat-map-0.0.1.tgz",
      "integrity": "sha512-/Srv4dswyQNBfohGpz9o6Yb3Gz3SrUDqBH5rTuhGR7ahtlbYKnVxw2bCFMRljaA7EXHaXZ8wsHdodFvbkhKmqg==",
      "license": "MIT"
    },
    "node_modules/convert-source-map": {
      "version": "1.9.0",
      "resolved": "https://registry.npmjs.org/convert-source-map/-/convert-source-map-1.9.0.tgz",
      "integrity": "sha512-ASFBup0Mz1uyiIjANan1jzLQami9z1PoYSZCiiYW2FczPbenXc45FZdBZLzOT+r6+iciuEModtmCti+hjaAk0A==",
      "license": "MIT"
    },
    "node_modules/cookie": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/cookie/-/cookie-1.0.2.tgz",
      "integrity": "sha512-9Kr/j4O16ISv8zBBhJoi4bXOYNTkFLOqSL3UDB0njXxCXNezjeyVrJyGOWtgfs/q2km1gwBcfH8q1yEGoMYunA==",
      "license": "MIT",
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/core-js": {
      "version": "3.45.0",
      "resolved": "https://registry.npmjs.org/core-js/-/core-js-3.45.0.tgz",
      "integrity": "sha512-c2KZL9lP4DjkN3hk/an4pWn5b5ZefhRJnAc42n6LJ19kSnbeRbdQZE5dSeE2LBol1OwJD3X1BQvFTAsa8ReeDA==",
      "hasInstallScript": true,
      "license": "MIT",
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/core-js"
      }
    },
    "node_modules/core-util-is": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/core-util-is/-/core-util-is-1.0.3.tgz",
      "integrity": "sha512-ZQBvi1DcpJ4GDqanjucZ2Hj3wEO5pZDS89BWbkcrvdxksJorwUDDZamX9ldFkp9aw2lmBDLgkObEA4DWNJ9FYQ==",
      "license": "MIT"
    },
    "node_modules/cosmiconfig": {
      "version": "7.1.0",
      "resolved": "https://registry.npmjs.org/cosmiconfig/-/cosmiconfig-7.1.0.tgz",
      "integrity": "sha512-AdmX6xUzdNASswsFtmwSt7Vj8po9IuqXm0UXz7QKPuEUmPB4XyjGfaAr2PSuELMwkRMVH1EpIkX5bTZGRB3eCA==",
      "license": "MIT",
      "dependencies": {
        "@types/parse-json": "^4.0.0",
        "import-fresh": "^3.2.1",
        "parse-json": "^5.0.0",
        "path-type": "^4.0.0",
        "yaml": "^1.10.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/crc-32": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/crc-32/-/crc-32-1.2.2.tgz",
      "integrity": "sha512-ROmzCKrTnOwybPcJApAA6WBWij23HVfGVNKqqrZpuyZOHqK2CwHSvpGuyt/UNNvaIjEd8X5IFGp4Mh+Ie1IHJQ==",
      "license": "Apache-2.0",
      "bin": {
        "crc32": "bin/crc32.njs"
      },
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/crc32-stream": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/crc32-stream/-/crc32-stream-4.0.3.tgz",
      "integrity": "sha512-NT7w2JVU7DFroFdYkeq8cywxrgjPHWkdX1wjpRQXPX5Asews3tA+Ght6lddQO5Mkumffp3X7GEqku3epj2toIw==",
      "license": "MIT",
      "dependencies": {
        "crc-32": "^1.2.0",
        "readable-stream": "^3.4.0"
      },
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/cropperjs": {
      "version": "1.6.2",
      "resolved": "https://registry.npmjs.org/cropperjs/-/cropperjs-1.6.2.tgz",
      "integrity": "sha512-nhymn9GdnV3CqiEHJVai54TULFAE3VshJTXSqSJKa8yXAKyBKDWdhHarnlIPrshJ0WMFTGuFvG02YjLXfPiuOA==",
      "license": "MIT"
    },
    "node_modules/cross-spawn": {
      "version": "7.0.6",
      "resolved": "https://registry.npmjs.org/cross-spawn/-/cross-spawn-7.0.6.tgz",
      "integrity": "sha512-uV2QOWP2nWzsy2aMp8aRibhi9dlzF5Hgh5SHaB9OiTGEyDTiJJyx0uy51QXdyWbtAHNua4XJzUKca3OzKUd3vA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "path-key": "^3.1.0",
        "shebang-command": "^2.0.0",
        "which": "^2.0.1"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/csstype": {
      "version": "3.1.3",
      "resolved": "https://registry.npmjs.org/csstype/-/csstype-3.1.3.tgz",
      "integrity": "sha512-M1uQkMl8rQK/szD0LNhtqxIPLpimGm8sOBwU7lLnCpSbTyY3yeU1Vc7l4KT5zT4s/yOxHH5O7tIuuLOCnLADRw==",
      "license": "MIT"
    },
    "node_modules/damerau-levenshtein": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/damerau-levenshtein/-/damerau-levenshtein-1.0.8.tgz",
      "integrity": "sha512-sdQSFB7+llfUcQHUQO3+B8ERRj0Oa4w9POWMI/puGtuf7gFywGmkaLCElnudfTiKZV+NvHqL0ifzdrI8Ro7ESA==",
      "dev": true,
      "license": "BSD-2-Clause"
    },
    "node_modules/data-uri-to-buffer": {
      "version": "4.0.1",
      "resolved": "https://registry.npmjs.org/data-uri-to-buffer/-/data-uri-to-buffer-4.0.1.tgz",
      "integrity": "sha512-0R9ikRb668HB7QDxT1vkpuUBtqc53YyAwMwGeUFKRojY/NWKvdZ+9UYtRfGmhqNbRkTSVpMbmyhXipFFv2cb/A==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 12"
      }
    },
    "node_modules/data-view-buffer": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/data-view-buffer/-/data-view-buffer-1.0.2.tgz",
      "integrity": "sha512-EmKO5V3OLXh1rtK2wgXRansaK1/mtVdTUEiEI0W8RkvgT05kfxaH29PliLnpLP73yYO6142Q72QNa8Wx/A5CqQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "es-errors": "^1.3.0",
        "is-data-view": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/data-view-byte-length": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/data-view-byte-length/-/data-view-byte-length-1.0.2.tgz",
      "integrity": "sha512-tuhGbE6CfTM9+5ANGf+oQb72Ky/0+s3xKUpHvShfiz2RxMFgFPjsXuRLBVMtvMs15awe45SRb83D6wH4ew6wlQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "es-errors": "^1.3.0",
        "is-data-view": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/inspect-js"
      }
    },
    "node_modules/data-view-byte-offset": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/data-view-byte-offset/-/data-view-byte-offset-1.0.1.tgz",
      "integrity": "sha512-BS8PfmtDGnrgYdOonGZQdLZslWIeCGFP9tpan0hi1Co2Zr2NKADsvGYA8XxuG/4UWgJ6Cjtv+YJnB6MM69QGlQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "is-data-view": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/date-fns": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/date-fns/-/date-fns-4.1.0.tgz",
      "integrity": "sha512-Ukq0owbQXxa/U3EGtsdVBkR1w7KOQ5gIBqdH2hkvknzZPYvBxb/aa6E8L7tmjFtkwZBu3UXBbjIgPo/Ez4xaNg==",
      "license": "MIT",
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/kossnocorp"
      }
    },
    "node_modules/dayjs": {
      "version": "1.11.13",
      "resolved": "https://registry.npmjs.org/dayjs/-/dayjs-1.11.13.tgz",
      "integrity": "sha512-oaMBel6gjolK862uaPQOVTA7q3TZhuSvuMQAAglQDOWYO9A91IrAOUJEyKVlqJlHE0vq5p5UXxzdPfMH/x6xNg==",
      "license": "MIT"
    },
    "node_modules/debug": {
      "version": "4.4.1",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.1.tgz",
      "integrity": "sha512-KcKCqiftBJcZr++7ykoDIEwSa3XWowTfNPo92BYxjXiyYEVrUQh2aLyhxBCwww+heortUFxEJYcRzosstTEBYQ==",
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": ">=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/deep-is": {
      "version": "0.1.4",
      "resolved": "https://registry.npmjs.org/deep-is/-/deep-is-0.1.4.tgz",
      "integrity": "sha512-oIPzksmTg4/MriiaYGO+okXDT7ztn/w3Eptv/+gSIdMdKsJo0u4CfYNFJPy+4SKMuCqGw2wxnA+URMg3t8a/bQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/define-data-property": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/define-data-property/-/define-data-property-1.1.4.tgz",
      "integrity": "sha512-rBMvIzlpA8v6E+SJZoo++HAYqsLrkg7MSfIinMPFhmkorw7X+dOXVJQs+QT69zGkzMyfDnIMN2Wid1+NbL3T+A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-define-property": "^1.0.0",
        "es-errors": "^1.3.0",
        "gopd": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/define-properties": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/define-properties/-/define-properties-1.2.1.tgz",
      "integrity": "sha512-8QmQKqEASLd5nx0U1B1okLElbUuuttJ/AnYmRXbbbGDWh6uS208EjD4Xqq/I9wK7u0v6O08XhTWnt5XtEbR6Dg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "define-data-property": "^1.0.1",
        "has-property-descriptors": "^1.0.0",
        "object-keys": "^1.1.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/dequal": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/dequal/-/dequal-2.0.3.tgz",
      "integrity": "sha512-0je+qPKHEMohvfRTCEo3CrPG6cAzAYgmzKyxRiYSSDkS6eGJdyVJm7WaYA5ECaAD9wLB2T4EEeymA5aFVcYXCA==",
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/detect-libc": {
      "version": "2.0.4",
      "resolved": "https://registry.npmjs.org/detect-libc/-/detect-libc-2.0.4.tgz",
      "integrity": "sha512-3UDv+G9CsCKO1WKMGw9fwq/SWJYbI0c5Y7LU1AXYoDdbhE2AHQ6N6Nb34sG8Fj7T5APy8qXDCKuuIHd1BR0tVA==",
      "devOptional": true,
      "license": "Apache-2.0",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/detect-node-es": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/detect-node-es/-/detect-node-es-1.1.0.tgz",
      "integrity": "sha512-ypdmJU/TbBby2Dxibuv7ZLW3Bs1QEmM7nHjEANfohJLvE0XVujisn1qPJcZxg+qDucsr+bP6fLD1rPS3AhJ7EQ==",
      "license": "MIT"
    },
    "node_modules/doctrine": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/doctrine/-/doctrine-2.1.0.tgz",
      "integrity": "sha512-35mSku4ZXK0vfCuHEDAwt55dg2jNajHZ1odvF+8SSr82EsZY4QmXfuWso8oEd8zRhVObSN18aM0CjSdoBX7zIw==",
      "dev": true,
      "license": "Apache-2.0",
      "dependencies": {
        "esutils": "^2.0.2"
      },
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/dom-helpers": {
      "version": "5.2.1",
      "resolved": "https://registry.npmjs.org/dom-helpers/-/dom-helpers-5.2.1.tgz",
      "integrity": "sha512-nRCa7CK3VTrM2NmGkIy4cbK7IZlgBE/PYMn55rrXefr5xXDP0LdtfPnblFDoVdcAfslJ7or6iqAUnx0CCGIWQA==",
      "license": "MIT",
      "dependencies": {
        "@babel/runtime": "^7.8.7",
        "csstype": "^3.0.2"
      }
    },
    "node_modules/dotenv": {
      "version": "17.2.1",
      "resolved": "https://registry.npmjs.org/dotenv/-/dotenv-17.2.1.tgz",
      "integrity": "sha512-kQhDYKZecqnM0fCnzI5eIv5L4cAe/iRI+HqMbO/hbRdTAeXDG+M9FjipUxNfbARuEg4iHIbhnhs78BCHNbSxEQ==",
      "dev": true,
      "license": "BSD-2-Clause",
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://dotenvx.com"
      }
    },
    "node_modules/dotenv-cli": {
      "version": "10.0.0",
      "resolved": "https://registry.npmjs.org/dotenv-cli/-/dotenv-cli-10.0.0.tgz",
      "integrity": "sha512-lnOnttzfrzkRx2echxJHQRB6vOAMSCzzZg79IxpC00tU42wZPuZkQxNNrrwVAxaQZIIh001l4PxVlCrBxngBzA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "cross-spawn": "^7.0.6",
        "dotenv": "^17.1.0",
        "dotenv-expand": "^11.0.0",
        "minimist": "^1.2.6"
      },
      "bin": {
        "dotenv": "cli.js"
      }
    },
    "node_modules/dotenv-expand": {
      "version": "11.0.7",
      "resolved": "https://registry.npmjs.org/dotenv-expand/-/dotenv-expand-11.0.7.tgz",
      "integrity": "sha512-zIHwmZPRshsCdpMDyVsqGmgyP0yT8GAgXUnkdAoJisxvf33k7yO6OuoKmcTGuXPWSsm8Oh88nZicRLA9Y0rUeA==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "dotenv": "^16.4.5"
      },
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://dotenvx.com"
      }
    },
    "node_modules/dotenv-expand/node_modules/dotenv": {
      "version": "16.6.1",
      "resolved": "https://registry.npmjs.org/dotenv/-/dotenv-16.6.1.tgz",
      "integrity": "sha512-uBq4egWHTcTt33a72vpSG0z3HnPuIl6NqYcTrKEg2azoEyl2hpW0zqlxysq2pK9HlDIHyHyakeYaYnSAwd8bow==",
      "dev": true,
      "license": "BSD-2-Clause",
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://dotenvx.com"
      }
    },
    "node_modules/dunder-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/dunder-proto/-/dunder-proto-1.0.1.tgz",
      "integrity": "sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.1",
        "es-errors": "^1.3.0",
        "gopd": "^1.2.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/duplexer2": {
      "version": "0.1.4",
      "resolved": "https://registry.npmjs.org/duplexer2/-/duplexer2-0.1.4.tgz",
      "integrity": "sha512-asLFVfWWtJ90ZyOUHMqk7/S2w2guQKxUI2itj3d92ADHhxUSbCMGi1f1cBcJ7xM1To+pE/Khbwo1yuNbMEPKeA==",
      "license": "BSD-3-Clause",
      "dependencies": {
        "readable-stream": "^2.0.2"
      }
    },
    "node_modules/duplexer2/node_modules/isarray": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/isarray/-/isarray-1.0.0.tgz",
      "integrity": "sha512-VLghIWNM6ELQzo7zwmcg0NmTVyWKYjvIeM83yjp0wRDTmUnrM678fQbcKBo6n2CJEF0szoG//ytg+TKla89ALQ==",
      "license": "MIT"
    },
    "node_modules/duplexer2/node_modules/readable-stream": {
      "version": "2.3.8",
      "resolved": "https://registry.npmjs.org/readable-stream/-/readable-stream-2.3.8.tgz",
      "integrity": "sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA==",
      "license": "MIT",
      "dependencies": {
        "core-util-is": "~1.0.0",
        "inherits": "~2.0.3",
        "isarray": "~1.0.0",
        "process-nextick-args": "~2.0.0",
        "safe-buffer": "~5.1.1",
        "string_decoder": "~1.1.1",
        "util-deprecate": "~1.0.1"
      }
    },
    "node_modules/duplexer2/node_modules/safe-buffer": {
      "version": "5.1.2",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.1.2.tgz",
      "integrity": "sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==",
      "license": "MIT"
    },
    "node_modules/duplexer2/node_modules/string_decoder": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/string_decoder/-/string_decoder-1.1.1.tgz",
      "integrity": "sha512-n/ShnvDi6FHbbVfviro+WojiFzv+s8MPMHBczVePfUpDJLwoLT0ht1l4YwBCbi8pJAveEEdnkHyPyTP/mzRfwg==",
      "license": "MIT",
      "dependencies": {
        "safe-buffer": "~5.1.0"
      }
    },
    "node_modules/ecdsa-sig-formatter": {
      "version": "1.0.11",
      "resolved": "https://registry.npmjs.org/ecdsa-sig-formatter/-/ecdsa-sig-formatter-1.0.11.tgz",
      "integrity": "sha512-nagl3RYrbNv6kQkeJIpt6NJZy8twLB/2vtz6yN9Z4vRKHN4/QZJIEbqohALSgwKdnksuY3k5Addp5lg8sVoVcQ==",
      "license": "Apache-2.0",
      "dependencies": {
        "safe-buffer": "^5.0.1"
      }
    },
    "node_modules/emoji-regex": {
      "version": "9.2.2",
      "resolved": "https://registry.npmjs.org/emoji-regex/-/emoji-regex-9.2.2.tgz",
      "integrity": "sha512-L18DaJsXSUk2+42pv8mLs5jJT2hqFkFE4j21wOmgbUqsZ2hL72NsUU785g9RXgo3s0ZNgVl42TiHp3ZtOv/Vyg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/end-of-stream": {
      "version": "1.4.5",
      "resolved": "https://registry.npmjs.org/end-of-stream/-/end-of-stream-1.4.5.tgz",
      "integrity": "sha512-ooEGc6HP26xXq/N+GCGOT0JKCLDGrq2bQUZrQ7gyrJiZANJ/8YDTxTpQBXGMn+WbIQXNVpyWymm7KYVICQnyOg==",
      "license": "MIT",
      "dependencies": {
        "once": "^1.4.0"
      }
    },
    "node_modules/enhanced-resolve": {
      "version": "5.18.3",
      "resolved": "https://registry.npmjs.org/enhanced-resolve/-/enhanced-resolve-5.18.3.tgz",
      "integrity": "sha512-d4lC8xfavMeBjzGr2vECC3fsGXziXZQyJxD868h2M/mBI3PwAuODxAkLkq5HYuvrPYcUtiLzsTo8U3PgX3Ocww==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "graceful-fs": "^4.2.4",
        "tapable": "^2.2.0"
      },
      "engines": {
        "node": ">=10.13.0"
      }
    },
    "node_modules/error-ex": {
      "version": "1.3.2",
      "resolved": "https://registry.npmjs.org/error-ex/-/error-ex-1.3.2.tgz",
      "integrity": "sha512-7dFHNmqeFSEt2ZBsCriorKnn3Z2pj+fd9kmI6QoWw4//DL+icEBfc0U7qJCisqrTsKTjw4fNFy2pW9OqStD84g==",
      "license": "MIT",
      "dependencies": {
        "is-arrayish": "^0.2.1"
      }
    },
    "node_modules/error-ex/node_modules/is-arrayish": {
      "version": "0.2.1",
      "resolved": "https://registry.npmjs.org/is-arrayish/-/is-arrayish-0.2.1.tgz",
      "integrity": "sha512-zz06S8t0ozoDXMG+ube26zeCTNXcKIPJZJi8hBrF4idCLms4CG9QtK7qBl1boi5ODzFpjswb5JPmHCbMpjaYzg==",
      "license": "MIT"
    },
    "node_modules/es-abstract": {
      "version": "1.24.0",
      "resolved": "https://registry.npmjs.org/es-abstract/-/es-abstract-1.24.0.tgz",
      "integrity": "sha512-WSzPgsdLtTcQwm4CROfS5ju2Wa1QQcVeT37jFjYzdFz1r9ahadC8B8/a4qxJxM+09F18iumCdRmlr96ZYkQvEg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "array-buffer-byte-length": "^1.0.2",
        "arraybuffer.prototype.slice": "^1.0.4",
        "available-typed-arrays": "^1.0.7",
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.4",
        "data-view-buffer": "^1.0.2",
        "data-view-byte-length": "^1.0.2",
        "data-view-byte-offset": "^1.0.1",
        "es-define-property": "^1.0.1",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.1.1",
        "es-set-tostringtag": "^2.1.0",
        "es-to-primitive": "^1.3.0",
        "function.prototype.name": "^1.1.8",
        "get-intrinsic": "^1.3.0",
        "get-proto": "^1.0.1",
        "get-symbol-description": "^1.1.0",
        "globalthis": "^1.0.4",
        "gopd": "^1.2.0",
        "has-property-descriptors": "^1.0.2",
        "has-proto": "^1.2.0",
        "has-symbols": "^1.1.0",
        "hasown": "^2.0.2",
        "internal-slot": "^1.1.0",
        "is-array-buffer": "^3.0.5",
        "is-callable": "^1.2.7",
        "is-data-view": "^1.0.2",
        "is-negative-zero": "^2.0.3",
        "is-regex": "^1.2.1",
        "is-set": "^2.0.3",
        "is-shared-array-buffer": "^1.0.4",
        "is-string": "^1.1.1",
        "is-typed-array": "^1.1.15",
        "is-weakref": "^1.1.1",
        "math-intrinsics": "^1.1.0",
        "object-inspect": "^1.13.4",
        "object-keys": "^1.1.1",
        "object.assign": "^4.1.7",
        "own-keys": "^1.0.1",
        "regexp.prototype.flags": "^1.5.4",
        "safe-array-concat": "^1.1.3",
        "safe-push-apply": "^1.0.0",
        "safe-regex-test": "^1.1.0",
        "set-proto": "^1.0.0",
        "stop-iteration-iterator": "^1.1.0",
        "string.prototype.trim": "^1.2.10",
        "string.prototype.trimend": "^1.0.9",
        "string.prototype.trimstart": "^1.0.8",
        "typed-array-buffer": "^1.0.3",
        "typed-array-byte-length": "^1.0.3",
        "typed-array-byte-offset": "^1.0.4",
        "typed-array-length": "^1.0.7",
        "unbox-primitive": "^1.1.0",
        "which-typed-array": "^1.1.19"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/es-define-property": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/es-define-property/-/es-define-property-1.0.1.tgz",
      "integrity": "sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-errors": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/es-errors/-/es-errors-1.3.0.tgz",
      "integrity": "sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-iterator-helpers": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/es-iterator-helpers/-/es-iterator-helpers-1.2.1.tgz",
      "integrity": "sha512-uDn+FE1yrDzyC0pCo961B2IHbdM8y/ACZsKD4dG6WqrjV53BADjwa7D+1aom2rsNVfLyDgU/eigvlJGJ08OQ4w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.3",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.6",
        "es-errors": "^1.3.0",
        "es-set-tostringtag": "^2.0.3",
        "function-bind": "^1.1.2",
        "get-intrinsic": "^1.2.6",
        "globalthis": "^1.0.4",
        "gopd": "^1.2.0",
        "has-property-descriptors": "^1.0.2",
        "has-proto": "^1.2.0",
        "has-symbols": "^1.1.0",
        "internal-slot": "^1.1.0",
        "iterator.prototype": "^1.1.4",
        "safe-array-concat": "^1.1.3"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-object-atoms": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/es-object-atoms/-/es-object-atoms-1.1.1.tgz",
      "integrity": "sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-set-tostringtag": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/es-set-tostringtag/-/es-set-tostringtag-2.1.0.tgz",
      "integrity": "sha512-j6vWzfrGVfyXxge+O0x5sh6cvxAog0a/4Rdd2K36zCMV5eJ+/+tOAngRO8cODMNWbVRdVlmGZQL2YS3yR8bIUA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.6",
        "has-tostringtag": "^1.0.2",
        "hasown": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-shim-unscopables": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/es-shim-unscopables/-/es-shim-unscopables-1.1.0.tgz",
      "integrity": "sha512-d9T8ucsEhh8Bi1woXCf+TIKDIROLG5WCkxg8geBCbvk22kzwC5G2OnXVMO6FUsvQlgUUXQ2itephWDLqDzbeCw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "hasown": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-to-primitive": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/es-to-primitive/-/es-to-primitive-1.3.0.tgz",
      "integrity": "sha512-w+5mJ3GuFL+NjVtJlvydShqE1eN3h3PbI7/5LAsYJP/2qtuMXjfL2LpHSRqo4b4eSF5K/DH1JXKUAHSB2UW50g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-callable": "^1.2.7",
        "is-date-object": "^1.0.5",
        "is-symbol": "^1.0.4"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/escape-string-regexp": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/escape-string-regexp/-/escape-string-regexp-4.0.0.tgz",
      "integrity": "sha512-TtpcNJ3XAzx3Gq8sWRzJaVajRs0uVxA2YAkdb1jm2YkPz4G6egUFAyA3n5vtEIZefPk5Wa4UXbKuS5fKkJWdgA==",
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/eslint": {
      "version": "9.33.0",
      "resolved": "https://registry.npmjs.org/eslint/-/eslint-9.33.0.tgz",
      "integrity": "sha512-TS9bTNIryDzStCpJN93aC5VRSW3uTx9sClUn4B87pwiCaJh220otoI0X8mJKr+VcPtniMdN8GKjlwgWGUv5ZKA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@eslint-community/eslint-utils": "^4.2.0",
        "@eslint-community/regexpp": "^4.12.1",
        "@eslint/config-array": "^0.21.0",
        "@eslint/config-helpers": "^0.3.1",
        "@eslint/core": "^0.15.2",
        "@eslint/eslintrc": "^3.3.1",
        "@eslint/js": "9.33.0",
        "@eslint/plugin-kit": "^0.3.5",
        "@humanfs/node": "^0.16.6",
        "@humanwhocodes/module-importer": "^1.0.1",
        "@humanwhocodes/retry": "^0.4.2",
        "@types/estree": "^1.0.6",
        "@types/json-schema": "^7.0.15",
        "ajv": "^6.12.4",
        "chalk": "^4.0.0",
        "cross-spawn": "^7.0.6",
        "debug": "^4.3.2",
        "escape-string-regexp": "^4.0.0",
        "eslint-scope": "^8.4.0",
        "eslint-visitor-keys": "^4.2.1",
        "espree": "^10.4.0",
        "esquery": "^1.5.0",
        "esutils": "^2.0.2",
        "fast-deep-equal": "^3.1.3",
        "file-entry-cache": "^8.0.0",
        "find-up": "^5.0.0",
        "glob-parent": "^6.0.2",
        "ignore": "^5.2.0",
        "imurmurhash": "^0.1.4",
        "is-glob": "^4.0.0",
        "json-stable-stringify-without-jsonify": "^1.0.1",
        "lodash.merge": "^4.6.2",
        "minimatch": "^3.1.2",
        "natural-compare": "^1.4.0",
        "optionator": "^0.9.3"
      },
      "bin": {
        "eslint": "bin/eslint.js"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://eslint.org/donate"
      },
      "peerDependencies": {
        "jiti": "*"
      },
      "peerDependenciesMeta": {
        "jiti": {
          "optional": true
        }
      }
    },
    "node_modules/eslint-config-next": {
      "version": "15.4.4",
      "resolved": "https://registry.npmjs.org/eslint-config-next/-/eslint-config-next-15.4.4.tgz",
      "integrity": "sha512-sK/lWLUVF5om18O5w76Jt3F8uzu/LP5mVa6TprCMWkjWHUmByq80iHGHcdH7k1dLiJlj+DRIWf98d5piwRsSuA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@next/eslint-plugin-next": "15.4.4",
        "@rushstack/eslint-patch": "^1.10.3",
        "@typescript-eslint/eslint-plugin": "^5.4.2 || ^6.0.0 || ^7.0.0 || ^8.0.0",
        "@typescript-eslint/parser": "^5.4.2 || ^6.0.0 || ^7.0.0 || ^8.0.0",
        "eslint-import-resolver-node": "^0.3.6",
        "eslint-import-resolver-typescript": "^3.5.2",
        "eslint-plugin-import": "^2.31.0",
        "eslint-plugin-jsx-a11y": "^6.10.0",
        "eslint-plugin-react": "^7.37.0",
        "eslint-plugin-react-hooks": "^5.0.0"
      },
      "peerDependencies": {
        "eslint": "^7.23.0 || ^8.0.0 || ^9.0.0",
        "typescript": ">=3.3.1"
      },
      "peerDependenciesMeta": {
        "typescript": {
          "optional": true
        }
      }
    },
    "node_modules/eslint-import-resolver-node": {
      "version": "0.3.9",
      "resolved": "https://registry.npmjs.org/eslint-import-resolver-node/-/eslint-import-resolver-node-0.3.9.tgz",
      "integrity": "sha512-WFj2isz22JahUv+B788TlO3N6zL3nNJGU8CcZbPZvVEkBPaJdCV4vy5wyghty5ROFbCRnm132v8BScu5/1BQ8g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "debug": "^3.2.7",
        "is-core-module": "^2.13.0",
        "resolve": "^1.22.4"
      }
    },
    "node_modules/eslint-import-resolver-node/node_modules/debug": {
      "version": "3.2.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-3.2.7.tgz",
      "integrity": "sha512-CFjzYYAi4ThfiQvizrFQevTTXHtnCqWfe7x1AhgEscTz6ZbLbfoLRLPugTQyBth6f8ZERVUSyWHFD/7Wu4t1XQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.1"
      }
    },
    "node_modules/eslint-import-resolver-typescript": {
      "version": "3.10.1",
      "resolved": "https://registry.npmjs.org/eslint-import-resolver-typescript/-/eslint-import-resolver-typescript-3.10.1.tgz",
      "integrity": "sha512-A1rHYb06zjMGAxdLSkN2fXPBwuSaQ0iO5M/hdyS0Ajj1VBaRp0sPD3dn1FhME3c/JluGFbwSxyCfqdSbtQLAHQ==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "@nolyfill/is-core-module": "1.0.39",
        "debug": "^4.4.0",
        "get-tsconfig": "^4.10.0",
        "is-bun-module": "^2.0.0",
        "stable-hash": "^0.0.5",
        "tinyglobby": "^0.2.13",
        "unrs-resolver": "^1.6.2"
      },
      "engines": {
        "node": "^14.18.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint-import-resolver-typescript"
      },
      "peerDependencies": {
        "eslint": "*",
        "eslint-plugin-import": "*",
        "eslint-plugin-import-x": "*"
      },
      "peerDependenciesMeta": {
        "eslint-plugin-import": {
          "optional": true
        },
        "eslint-plugin-import-x": {
          "optional": true
        }
      }
    },
    "node_modules/eslint-module-utils": {
      "version": "2.12.1",
      "resolved": "https://registry.npmjs.org/eslint-module-utils/-/eslint-module-utils-2.12.1.tgz",
      "integrity": "sha512-L8jSWTze7K2mTg0vos/RuLRS5soomksDPoJLXIslC7c8Wmut3bx7CPpJijDcBZtxQ5lrbUdM+s0OlNbz0DCDNw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "debug": "^3.2.7"
      },
      "engines": {
        "node": ">=4"
      },
      "peerDependenciesMeta": {
        "eslint": {
          "optional": true
        }
      }
    },
    "node_modules/eslint-module-utils/node_modules/debug": {
      "version": "3.2.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-3.2.7.tgz",
      "integrity": "sha512-CFjzYYAi4ThfiQvizrFQevTTXHtnCqWfe7x1AhgEscTz6ZbLbfoLRLPugTQyBth6f8ZERVUSyWHFD/7Wu4t1XQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.1"
      }
    },
    "node_modules/eslint-plugin-import": {
      "version": "2.32.0",
      "resolved": "https://registry.npmjs.org/eslint-plugin-import/-/eslint-plugin-import-2.32.0.tgz",
      "integrity": "sha512-whOE1HFo/qJDyX4SnXzP4N6zOWn79WhnCUY/iDR0mPfQZO8wcYE4JClzI2oZrhBnnMUCBCHZhO6VQyoBU95mZA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@rtsao/scc": "^1.1.0",
        "array-includes": "^3.1.9",
        "array.prototype.findlastindex": "^1.2.6",
        "array.prototype.flat": "^1.3.3",
        "array.prototype.flatmap": "^1.3.3",
        "debug": "^3.2.7",
        "doctrine": "^2.1.0",
        "eslint-import-resolver-node": "^0.3.9",
        "eslint-module-utils": "^2.12.1",
        "hasown": "^2.0.2",
        "is-core-module": "^2.16.1",
        "is-glob": "^4.0.3",
        "minimatch": "^3.1.2",
        "object.fromentries": "^2.0.8",
        "object.groupby": "^1.0.3",
        "object.values": "^1.2.1",
        "semver": "^6.3.1",
        "string.prototype.trimend": "^1.0.9",
        "tsconfig-paths": "^3.15.0"
      },
      "engines": {
        "node": ">=4"
      },
      "peerDependencies": {
        "eslint": "^2 || ^3 || ^4 || ^5 || ^6 || ^7.2.0 || ^8 || ^9"
      }
    },
    "node_modules/eslint-plugin-import/node_modules/debug": {
      "version": "3.2.7",
      "resolved": "https://registry.npmjs.org/debug/-/debug-3.2.7.tgz",
      "integrity": "sha512-CFjzYYAi4ThfiQvizrFQevTTXHtnCqWfe7x1AhgEscTz6ZbLbfoLRLPugTQyBth6f8ZERVUSyWHFD/7Wu4t1XQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.1"
      }
    },
    "node_modules/eslint-plugin-import/node_modules/semver": {
      "version": "6.3.1",
      "resolved": "https://registry.npmjs.org/semver/-/semver-6.3.1.tgz",
      "integrity": "sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==",
      "dev": true,
      "license": "ISC",
      "bin": {
        "semver": "bin/semver.js"
      }
    },
    "node_modules/eslint-plugin-jsx-a11y": {
      "version": "6.10.2",
      "resolved": "https://registry.npmjs.org/eslint-plugin-jsx-a11y/-/eslint-plugin-jsx-a11y-6.10.2.tgz",
      "integrity": "sha512-scB3nz4WmG75pV8+3eRUQOHZlNSUhFNq37xnpgRkCCELU3XMvXAxLk1eqWWyE22Ki4Q01Fnsw9BA3cJHDPgn2Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "aria-query": "^5.3.2",
        "array-includes": "^3.1.8",
        "array.prototype.flatmap": "^1.3.2",
        "ast-types-flow": "^0.0.8",
        "axe-core": "^4.10.0",
        "axobject-query": "^4.1.0",
        "damerau-levenshtein": "^1.0.8",
        "emoji-regex": "^9.2.2",
        "hasown": "^2.0.2",
        "jsx-ast-utils": "^3.3.5",
        "language-tags": "^1.0.9",
        "minimatch": "^3.1.2",
        "object.fromentries": "^2.0.8",
        "safe-regex-test": "^1.0.3",
        "string.prototype.includes": "^2.0.1"
      },
      "engines": {
        "node": ">=4.0"
      },
      "peerDependencies": {
        "eslint": "^3 || ^4 || ^5 || ^6 || ^7 || ^8 || ^9"
      }
    },
    "node_modules/eslint-plugin-react": {
      "version": "7.37.5",
      "resolved": "https://registry.npmjs.org/eslint-plugin-react/-/eslint-plugin-react-7.37.5.tgz",
      "integrity": "sha512-Qteup0SqU15kdocexFNAJMvCJEfa2xUKNV4CC1xsVMrIIqEy3SQ/rqyxCWNzfrd3/ldy6HMlD2e0JDVpDg2qIA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "array-includes": "^3.1.8",
        "array.prototype.findlast": "^1.2.5",
        "array.prototype.flatmap": "^1.3.3",
        "array.prototype.tosorted": "^1.1.4",
        "doctrine": "^2.1.0",
        "es-iterator-helpers": "^1.2.1",
        "estraverse": "^5.3.0",
        "hasown": "^2.0.2",
        "jsx-ast-utils": "^2.4.1 || ^3.0.0",
        "minimatch": "^3.1.2",
        "object.entries": "^1.1.9",
        "object.fromentries": "^2.0.8",
        "object.values": "^1.2.1",
        "prop-types": "^15.8.1",
        "resolve": "^2.0.0-next.5",
        "semver": "^6.3.1",
        "string.prototype.matchall": "^4.0.12",
        "string.prototype.repeat": "^1.0.0"
      },
      "engines": {
        "node": ">=4"
      },
      "peerDependencies": {
        "eslint": "^3 || ^4 || ^5 || ^6 || ^7 || ^8 || ^9.7"
      }
    },
    "node_modules/eslint-plugin-react-hooks": {
      "version": "5.2.0",
      "resolved": "https://registry.npmjs.org/eslint-plugin-react-hooks/-/eslint-plugin-react-hooks-5.2.0.tgz",
      "integrity": "sha512-+f15FfK64YQwZdJNELETdn5ibXEUQmW1DZL6KXhNnc2heoy/sg9VJJeT7n8TlMWouzWqSWavFkIhHyIbIAEapg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "peerDependencies": {
        "eslint": "^3.0.0 || ^4.0.0 || ^5.0.0 || ^6.0.0 || ^7.0.0 || ^8.0.0-0 || ^9.0.0"
      }
    },
    "node_modules/eslint-plugin-react/node_modules/resolve": {
      "version": "2.0.0-next.5",
      "resolved": "https://registry.npmjs.org/resolve/-/resolve-2.0.0-next.5.tgz",
      "integrity": "sha512-U7WjGVG9sH8tvjW5SmGbQuui75FiyjAX72HX15DwBBwF9dNiQZRQAg9nnPhYy+TUnE0+VcrttuvNI8oSxZcocA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-core-module": "^2.13.0",
        "path-parse": "^1.0.7",
        "supports-preserve-symlinks-flag": "^1.0.0"
      },
      "bin": {
        "resolve": "bin/resolve"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/eslint-plugin-react/node_modules/semver": {
      "version": "6.3.1",
      "resolved": "https://registry.npmjs.org/semver/-/semver-6.3.1.tgz",
      "integrity": "sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==",
      "dev": true,
      "license": "ISC",
      "bin": {
        "semver": "bin/semver.js"
      }
    },
    "node_modules/eslint-scope": {
      "version": "8.4.0",
      "resolved": "https://registry.npmjs.org/eslint-scope/-/eslint-scope-8.4.0.tgz",
      "integrity": "sha512-sNXOfKCn74rt8RICKMvJS7XKV/Xk9kA7DyJr8mJik3S7Cwgy3qlkkmyS2uQB3jiJg6VNdZd/pDBJu0nvG2NlTg==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "esrecurse": "^4.3.0",
        "estraverse": "^5.2.0"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/eslint-visitor-keys": {
      "version": "4.2.1",
      "resolved": "https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-4.2.1.tgz",
      "integrity": "sha512-Uhdk5sfqcee/9H/rCOJikYz67o0a2Tw2hGRPOG2Y1R2dg7brRe1uG0yaNQDHu+TO/uQPF/5eCapvYSmHUjt7JQ==",
      "dev": true,
      "license": "Apache-2.0",
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/espree": {
      "version": "10.4.0",
      "resolved": "https://registry.npmjs.org/espree/-/espree-10.4.0.tgz",
      "integrity": "sha512-j6PAQ2uUr79PZhBjP5C5fhl8e39FmRnOjsD5lGnWrFU8i2G776tBK7+nP8KuQUTTyAZUwfQqXAgrVH5MbH9CYQ==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "acorn": "^8.15.0",
        "acorn-jsx": "^5.3.2",
        "eslint-visitor-keys": "^4.2.1"
      },
      "engines": {
        "node": "^18.18.0 || ^20.9.0 || >=21.1.0"
      },
      "funding": {
        "url": "https://opencollective.com/eslint"
      }
    },
    "node_modules/esquery": {
      "version": "1.6.0",
      "resolved": "https://registry.npmjs.org/esquery/-/esquery-1.6.0.tgz",
      "integrity": "sha512-ca9pw9fomFcKPvFLXhBKUK90ZvGibiGOvRJNbjljY7s7uq/5YO4BOzcYtJqExdx99rF6aAcnRxHmcUHcz6sQsg==",
      "dev": true,
      "license": "BSD-3-Clause",
      "dependencies": {
        "estraverse": "^5.1.0"
      },
      "engines": {
        "node": ">=0.10"
      }
    },
    "node_modules/esrecurse": {
      "version": "4.3.0",
      "resolved": "https://registry.npmjs.org/esrecurse/-/esrecurse-4.3.0.tgz",
      "integrity": "sha512-KmfKL3b6G+RXvP8N1vr3Tq1kL/oCFgn2NYXEtqP8/L3pKapUA4G8cFVaoF3SU323CD4XypR/ffioHmkti6/Tag==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "estraverse": "^5.2.0"
      },
      "engines": {
        "node": ">=4.0"
      }
    },
    "node_modules/estraverse": {
      "version": "5.3.0",
      "resolved": "https://registry.npmjs.org/estraverse/-/estraverse-5.3.0.tgz",
      "integrity": "sha512-MMdARuVEQziNTeJD8DgMqmhwR11BRQ/cBP+pLtYdSTnf3MIO8fFeiINEbX36ZdNlfU/7A9f3gUw49B3oQsvwBA==",
      "dev": true,
      "license": "BSD-2-Clause",
      "engines": {
        "node": ">=4.0"
      }
    },
    "node_modules/esutils": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/esutils/-/esutils-2.0.3.tgz",
      "integrity": "sha512-kVscqXk4OCp68SZ0dkgEKVi6/8ij300KBWTJq32P/dYeWTSwK41WyTxalN1eRmA5Z9UU/LX9D7FWSmV9SAYx6g==",
      "dev": true,
      "license": "BSD-2-Clause",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/eventemitter3": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/eventemitter3/-/eventemitter3-5.0.1.tgz",
      "integrity": "sha512-GWkBvjiSZK87ELrYOSESUYeVIc9mvLLf/nXalMOS5dYrgZq9o5OVkbZAVM06CVxYsCwH9BDZFPlQTlPA1j4ahA==",
      "license": "MIT"
    },
    "node_modules/exceljs": {
      "version": "4.4.0",
      "resolved": "https://registry.npmjs.org/exceljs/-/exceljs-4.4.0.tgz",
      "integrity": "sha512-XctvKaEMaj1Ii9oDOqbW/6e1gXknSY4g/aLCDicOXqBE4M0nRWkUu0PTp++UPNzoFY12BNHMfs/VadKIS6llvg==",
      "license": "MIT",
      "dependencies": {
        "archiver": "^5.0.0",
        "dayjs": "^1.8.34",
        "fast-csv": "^4.3.1",
        "jszip": "^3.10.1",
        "readable-stream": "^3.6.0",
        "saxes": "^5.0.1",
        "tmp": "^0.2.0",
        "unzipper": "^0.10.11",
        "uuid": "^8.3.0"
      },
      "engines": {
        "node": ">=8.3.0"
      }
    },
    "node_modules/exifr": {
      "version": "7.1.3",
      "resolved": "https://registry.npmjs.org/exifr/-/exifr-7.1.3.tgz",
      "integrity": "sha512-g/aje2noHivrRSLbAUtBPWFbxKdKhgj/xr1vATDdUXPOFYJlQ62Ft0oy+72V6XLIpDJfHs6gXLbBLAolqOXYRw==",
      "license": "MIT"
    },
    "node_modules/fast-csv": {
      "version": "4.3.6",
      "resolved": "https://registry.npmjs.org/fast-csv/-/fast-csv-4.3.6.tgz",
      "integrity": "sha512-2RNSpuwwsJGP0frGsOmTb9oUF+VkFSM4SyLTDgwf2ciHWTarN0lQTC+F2f/t5J9QjW+c65VFIAAu85GsvMIusw==",
      "license": "MIT",
      "dependencies": {
        "@fast-csv/format": "4.3.5",
        "@fast-csv/parse": "4.3.6"
      },
      "engines": {
        "node": ">=10.0.0"
      }
    },
    "node_modules/fast-deep-equal": {
      "version": "3.1.3",
      "resolved": "https://registry.npmjs.org/fast-deep-equal/-/fast-deep-equal-3.1.3.tgz",
      "integrity": "sha512-f3qQ9oQy9j2AhBe/H9VC91wLmKBCCU/gDOnKNAYG5hswO7BLKj09Hc5HYNz9cGI++xlpDCIgDaitVs03ATR84Q==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/fast-glob": {
      "version": "3.3.1",
      "resolved": "https://registry.npmjs.org/fast-glob/-/fast-glob-3.3.1.tgz",
      "integrity": "sha512-kNFPyjhh5cKjrUltxs+wFx+ZkbRaxxmZ+X0ZU31SOsxCEtP9VPgtq2teZw1DebupL5GmDaNQ6yKMMVcM41iqDg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@nodelib/fs.stat": "^2.0.2",
        "@nodelib/fs.walk": "^1.2.3",
        "glob-parent": "^5.1.2",
        "merge2": "^1.3.0",
        "micromatch": "^4.0.4"
      },
      "engines": {
        "node": ">=8.6.0"
      }
    },
    "node_modules/fast-glob/node_modules/glob-parent": {
      "version": "5.1.2",
      "resolved": "https://registry.npmjs.org/glob-parent/-/glob-parent-5.1.2.tgz",
      "integrity": "sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9/SrMyM5RPQrkGz4aS9Zow==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "is-glob": "^4.0.1"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/fast-json-stable-stringify": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/fast-json-stable-stringify/-/fast-json-stable-stringify-2.1.0.tgz",
      "integrity": "sha512-lhd/wF+Lk98HZoTCtlVraHtfh5XYijIjalXck7saUtuanSDyLMxnHhSXEDJqHxD7msR8D0uCmqlkwjCV8xvwHw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/fast-levenshtein": {
      "version": "2.0.6",
      "resolved": "https://registry.npmjs.org/fast-levenshtein/-/fast-levenshtein-2.0.6.tgz",
      "integrity": "sha512-DCXu6Ifhqcks7TZKY3Hxp3y6qphY5SJZmrWMDrKcERSOXWQdMhU9Ig/PYrzyw/ul9jOIyh0N4M0tbC5hodg8dw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/fastq": {
      "version": "1.19.1",
      "resolved": "https://registry.npmjs.org/fastq/-/fastq-1.19.1.tgz",
      "integrity": "sha512-GwLTyxkCXjXbxqIhTsMI2Nui8huMPtnxg7krajPJAjnEG/iiOS7i+zCtWGZR9G0NBKbXKh6X9m9UIsYX/N6vvQ==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "reusify": "^1.0.4"
      }
    },
    "node_modules/fetch-blob": {
      "version": "3.2.0",
      "resolved": "https://registry.npmjs.org/fetch-blob/-/fetch-blob-3.2.0.tgz",
      "integrity": "sha512-7yAQpD2UMJzLi1Dqv7qFYnPbaPx7ZfFK6PiIxQ4PfkGPyNyl2Ugx+a/umUonmKqjhM4DnfbMvdX6otXq83soQQ==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/jimmywarting"
        },
        {
          "type": "paypal",
          "url": "https://paypal.me/jimmywarting"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "node-domexception": "^1.0.0",
        "web-streams-polyfill": "^3.0.3"
      },
      "engines": {
        "node": "^12.20 || >= 14.13"
      }
    },
    "node_modules/file-entry-cache": {
      "version": "8.0.0",
      "resolved": "https://registry.npmjs.org/file-entry-cache/-/file-entry-cache-8.0.0.tgz",
      "integrity": "sha512-XXTUwCvisa5oacNGRP9SfNtYBNAMi+RPwBFmblZEF7N7swHYQS6/Zfk7SRwx4D5j3CH211YNRco1DEMNVfZCnQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "flat-cache": "^4.0.0"
      },
      "engines": {
        "node": ">=16.0.0"
      }
    },
    "node_modules/fill-range": {
      "version": "7.1.1",
      "resolved": "https://registry.npmjs.org/fill-range/-/fill-range-7.1.1.tgz",
      "integrity": "sha512-YsGpe3WHLK8ZYi4tWDg2Jy3ebRz2rXowDxnld4bkQB00cc/1Zw9AWnC0i9ztDJitivtQvaI9KaLyKrc+hBW0yg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "to-regex-range": "^5.0.1"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/find-root": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/find-root/-/find-root-1.1.0.tgz",
      "integrity": "sha512-NKfW6bec6GfKc0SGx1e07QZY9PE99u0Bft/0rzSD5k3sO/vwkVUpDUKVm5Gpp5Ue3YfShPFTX2070tDs5kB9Ng==",
      "license": "MIT"
    },
    "node_modules/find-up": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/find-up/-/find-up-5.0.0.tgz",
      "integrity": "sha512-78/PXT1wlLLDgTzDs7sjq9hzz0vXD+zn+7wypEe4fXQxCmdmqfGsEPQxmiCSQI3ajFV91bVSsvNtrJRiW6nGng==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "locate-path": "^6.0.0",
        "path-exists": "^4.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/flat-cache": {
      "version": "4.0.1",
      "resolved": "https://registry.npmjs.org/flat-cache/-/flat-cache-4.0.1.tgz",
      "integrity": "sha512-f7ccFPK3SXFHpx15UIGyRJ/FJQctuKZ0zVuN3frBo4HnK3cay9VEW0R6yPYFHC0AgqhukPzKjq22t5DmAyqGyw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "flatted": "^3.2.9",
        "keyv": "^4.5.4"
      },
      "engines": {
        "node": ">=16"
      }
    },
    "node_modules/flatted": {
      "version": "3.3.3",
      "resolved": "https://registry.npmjs.org/flatted/-/flatted-3.3.3.tgz",
      "integrity": "sha512-GX+ysw4PBCz0PzosHDepZGANEuFCMLrnRTiEy9McGjmkCQYwRq4A/X786G/fjM/+OjsWSU1ZrY5qyARZmO/uwg==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/for-each": {
      "version": "0.3.5",
      "resolved": "https://registry.npmjs.org/for-each/-/for-each-0.3.5.tgz",
      "integrity": "sha512-dKx12eRCVIzqCxFGplyFKJMPvLEWgmNtUrpTiJIR5u97zEhRG8ySrtboPHZXx7daLxQVrl643cTzbab2tkQjxg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-callable": "^1.2.7"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/formdata-polyfill": {
      "version": "4.0.10",
      "resolved": "https://registry.npmjs.org/formdata-polyfill/-/formdata-polyfill-4.0.10.tgz",
      "integrity": "sha512-buewHzMvYL29jdeQTVILecSaZKnt/RJWjoZCF5OW60Z67/GmSLBkOFM7qh1PI3zFNtJbaZL5eQu1vLfazOwj4g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "fetch-blob": "^3.1.2"
      },
      "engines": {
        "node": ">=12.20.0"
      }
    },
    "node_modules/frac": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/frac/-/frac-1.1.2.tgz",
      "integrity": "sha512-w/XBfkibaTl3YDqASwfDUqkna4Z2p9cFSr1aHDt0WoMTECnRfBOv2WArlZILlqgWlmdIlALXGpM2AOhEk5W3IA==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/framer-motion": {
      "version": "12.23.12",
      "resolved": "https://registry.npmjs.org/framer-motion/-/framer-motion-12.23.12.tgz",
      "integrity": "sha512-6e78rdVtnBvlEVgu6eFEAgG9v3wLnYEboM8I5O5EXvfKC8gxGQB8wXJdhkMy10iVcn05jl6CNw7/HTsTCfwcWg==",
      "license": "MIT",
      "dependencies": {
        "motion-dom": "^12.23.12",
        "motion-utils": "^12.23.6",
        "tslib": "^2.4.0"
      },
      "peerDependencies": {
        "@emotion/is-prop-valid": "*",
        "react": "^18.0.0 || ^19.0.0",
        "react-dom": "^18.0.0 || ^19.0.0"
      },
      "peerDependenciesMeta": {
        "@emotion/is-prop-valid": {
          "optional": true
        },
        "react": {
          "optional": true
        },
        "react-dom": {
          "optional": true
        }
      }
    },
    "node_modules/fs-constants": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/fs-constants/-/fs-constants-1.0.0.tgz",
      "integrity": "sha512-y6OAwoSIf7FyjMIv94u+b5rdheZEjzR63GTyZJm5qh4Bi+2YgwLCcI/fPFZkL5PSixOt6ZNKm+w+Hfp/Bciwow==",
      "license": "MIT"
    },
    "node_modules/fs.realpath": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/fs.realpath/-/fs.realpath-1.0.0.tgz",
      "integrity": "sha512-OO0pH2lK6a0hZnAdau5ItzHPI6pUlvI7jMVnxUQRtw4owF2wk8lOSabtGDCTP4Ggrg2MbGnWO9X8K1t4+fGMDw==",
      "license": "ISC"
    },
    "node_modules/fstream": {
      "version": "1.0.12",
      "resolved": "https://registry.npmjs.org/fstream/-/fstream-1.0.12.tgz",
      "integrity": "sha512-WvJ193OHa0GHPEL+AycEJgxvBEwyfRkN1vhjca23OaPVMCaLCXTd5qAu82AjTcgP1UJmytkOKb63Ypde7raDIg==",
      "deprecated": "This package is no longer supported.",
      "license": "ISC",
      "dependencies": {
        "graceful-fs": "^4.1.2",
        "inherits": "~2.0.0",
        "mkdirp": ">=0.5 0",
        "rimraf": "2"
      },
      "engines": {
        "node": ">=0.6"
      }
    },
    "node_modules/fstream/node_modules/mkdirp": {
      "version": "0.5.6",
      "resolved": "https://registry.npmjs.org/mkdirp/-/mkdirp-0.5.6.tgz",
      "integrity": "sha512-FP+p8RB8OWpF3YZBCrP5gtADmtXApB5AMLn+vdyA+PyxCjrCs00mjyUozssO33cwDeT3wNGdLxJ5M//YqtHAJw==",
      "license": "MIT",
      "dependencies": {
        "minimist": "^1.2.6"
      },
      "bin": {
        "mkdirp": "bin/cmd.js"
      }
    },
    "node_modules/function-bind": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/function-bind/-/function-bind-1.1.2.tgz",
      "integrity": "sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/function.prototype.name": {
      "version": "1.1.8",
      "resolved": "https://registry.npmjs.org/function.prototype.name/-/function.prototype.name-1.1.8.tgz",
      "integrity": "sha512-e5iwyodOHhbMr/yNrc7fDYG4qlbIvI5gajyzPnb5TCwyhjApznQh1BMFou9b30SevY43gCJKXycoCBjMbsuW0Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.3",
        "define-properties": "^1.2.1",
        "functions-have-names": "^1.2.3",
        "hasown": "^2.0.2",
        "is-callable": "^1.2.7"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/functions-have-names": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/functions-have-names/-/functions-have-names-1.2.3.tgz",
      "integrity": "sha512-xckBUXyTIqT97tq2x2AMb+g163b5JFysYk0x4qxNFwbfQkmNZoiRHb6sPzI9/QV33WeuvVYBUIiD4NzNIyqaRQ==",
      "dev": true,
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-intrinsic": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/get-intrinsic/-/get-intrinsic-1.3.0.tgz",
      "integrity": "sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "es-define-property": "^1.0.1",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.1.1",
        "function-bind": "^1.1.2",
        "get-proto": "^1.0.1",
        "gopd": "^1.2.0",
        "has-symbols": "^1.1.0",
        "hasown": "^2.0.2",
        "math-intrinsics": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-nonce": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/get-nonce/-/get-nonce-1.0.1.tgz",
      "integrity": "sha512-FJhYRoDaiatfEkUK8HKlicmu/3SGFD51q3itKDGoSTysQJBnfOcxU5GxnhE1E6soB76MbT0MBtnKJuXyAx+96Q==",
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/get-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/get-proto/-/get-proto-1.0.1.tgz",
      "integrity": "sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "dunder-proto": "^1.0.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/get-symbol-description": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/get-symbol-description/-/get-symbol-description-1.1.0.tgz",
      "integrity": "sha512-w9UMqWwJxHNOvoNzSJ2oPF5wvYcvP7jUvYzhp67yEhTi17ZDBBC1z9pTdGuzjD+EFIqLSYRweZjqfiPzQ06Ebg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.6"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-tsconfig": {
      "version": "4.10.1",
      "resolved": "https://registry.npmjs.org/get-tsconfig/-/get-tsconfig-4.10.1.tgz",
      "integrity": "sha512-auHyJ4AgMz7vgS8Hp3N6HXSmlMdUyhSUrfBF16w153rxtLIEOE+HGqaBppczZvnHLqQJfiHotCYpNhl0lUROFQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "resolve-pkg-maps": "^1.0.0"
      },
      "funding": {
        "url": "https://github.com/privatenumber/get-tsconfig?sponsor=1"
      }
    },
    "node_modules/glob": {
      "version": "7.2.3",
      "resolved": "https://registry.npmjs.org/glob/-/glob-7.2.3.tgz",
      "integrity": "sha512-nFR0zLpU2YCaRxwoCJvL6UvCH2JFyFVIvwTLsIf21AuHlMskA1hhTdk+LlYJtOlYt9v6dvszD2BGRqBL+iQK9Q==",
      "deprecated": "Glob versions prior to v9 are no longer supported",
      "license": "ISC",
      "dependencies": {
        "fs.realpath": "^1.0.0",
        "inflight": "^1.0.4",
        "inherits": "2",
        "minimatch": "^3.1.1",
        "once": "^1.3.0",
        "path-is-absolute": "^1.0.0"
      },
      "engines": {
        "node": "*"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      }
    },
    "node_modules/glob-parent": {
      "version": "6.0.2",
      "resolved": "https://registry.npmjs.org/glob-parent/-/glob-parent-6.0.2.tgz",
      "integrity": "sha512-XxwI8EOhVQgWp6iDL+3b0r86f4d6AX6zSU55HfB4ydCEuXLXc5FcYeOu+nnGftS4TEju/11rt4KJPTMgbfmv4A==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "is-glob": "^4.0.3"
      },
      "engines": {
        "node": ">=10.13.0"
      }
    },
    "node_modules/globals": {
      "version": "14.0.0",
      "resolved": "https://registry.npmjs.org/globals/-/globals-14.0.0.tgz",
      "integrity": "sha512-oahGvuMGQlPw/ivIYBjVSrWAfWLBeku5tpPE2fOPLi+WHffIWbuh2tCjhyQhTBPMf5E9jDEH4FOmTYgYwbKwtQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/globalthis": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/globalthis/-/globalthis-1.0.4.tgz",
      "integrity": "sha512-DpLKbNU4WylpxJykQujfCcwYWiV/Jhm50Goo0wrVILAv5jOr9d+H+UR3PhSCD2rCCEIg0uc+G+muBTwD54JhDQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "define-properties": "^1.2.1",
        "gopd": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/gopd": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/gopd/-/gopd-1.2.0.tgz",
      "integrity": "sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/graceful-fs": {
      "version": "4.2.11",
      "resolved": "https://registry.npmjs.org/graceful-fs/-/graceful-fs-4.2.11.tgz",
      "integrity": "sha512-RbJ5/jmFcNNCcDV5o9eTnBLJ/HszWV0P73bc+Ff4nS/rJj+YaS6IGyiOL0VoBYX+l1Wrl3k63h/KrH+nhJ0XvQ==",
      "license": "ISC"
    },
    "node_modules/graphemer": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/graphemer/-/graphemer-1.4.0.tgz",
      "integrity": "sha512-EtKwoO6kxCL9WO5xipiHTZlSzBm7WLT627TqC/uVRd0HKmq8NXyebnNYxDoBi7wt8eTWrUrKXCOVaFq9x1kgag==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/has-bigints": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/has-bigints/-/has-bigints-1.1.0.tgz",
      "integrity": "sha512-R3pbpkcIqv2Pm3dUwgjclDRVmWpTJW2DcMzcIhEXEx1oh/CEMObMm3KLmRJOdvhM7o4uQBnwr8pzRK2sJWIqfg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-flag": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/has-flag/-/has-flag-4.0.0.tgz",
      "integrity": "sha512-EykJT/Q1KjTWctppgIAgfSO0tKVuZUjhgMr17kqTumMl6Afv3EISleU7qZUzoXDFTAHTDC4NOoG/ZxU3EvlMPQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/has-property-descriptors": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/has-property-descriptors/-/has-property-descriptors-1.0.2.tgz",
      "integrity": "sha512-55JNKuIW+vq4Ke1BjOTjM2YctQIvCT7GFzHwmfZPGo5wnrgkid0YQtnAleFSqumZm4az3n2BS+erby5ipJdgrg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-define-property": "^1.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-proto": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/has-proto/-/has-proto-1.2.0.tgz",
      "integrity": "sha512-KIL7eQPfHQRC8+XluaIw7BHUwwqL19bQn4hzNgdr+1wXoU0KKj6rufu47lhY7KbJR2C6T6+PfyN0Ea7wkSS+qQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "dunder-proto": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-symbols": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/has-symbols/-/has-symbols-1.1.0.tgz",
      "integrity": "sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-tostringtag": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/has-tostringtag/-/has-tostringtag-1.0.2.tgz",
      "integrity": "sha512-NqADB8VjPFLM2V0VvHUewwwsw0ZWBaIdgo+ieHtK3hasLz4qeCRjYcqfB6AQrBggRKppKF8L52/VqdVsO47Dlw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "has-symbols": "^1.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/hasown": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/hasown/-/hasown-2.0.2.tgz",
      "integrity": "sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==",
      "license": "MIT",
      "dependencies": {
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/hoist-non-react-statics": {
      "version": "3.3.2",
      "resolved": "https://registry.npmjs.org/hoist-non-react-statics/-/hoist-non-react-statics-3.3.2.tgz",
      "integrity": "sha512-/gGivxi8JPKWNm/W0jSmzcMPpfpPLc3dY/6GxhX2hQ9iGj3aDfklV4ET7NjKpSinLpJ5vafa9iiGIEZg10SfBw==",
      "license": "BSD-3-Clause",
      "dependencies": {
        "react-is": "^16.7.0"
      }
    },
    "node_modules/http_ece": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/http_ece/-/http_ece-1.2.0.tgz",
      "integrity": "sha512-JrF8SSLVmcvc5NducxgyOrKXe3EsyHMgBFgSaIUGmArKe+rwr0uphRkRXvwiom3I+fpIfoItveHrfudL8/rxuA==",
      "license": "MIT",
      "engines": {
        "node": ">=16"
      }
    },
    "node_modules/https-proxy-agent": {
      "version": "7.0.6",
      "resolved": "https://registry.npmjs.org/https-proxy-agent/-/https-proxy-agent-7.0.6.tgz",
      "integrity": "sha512-vK9P5/iUfdl95AI+JVyUuIcVtd4ofvtrOr3HNtM2yxC9bnMbEdp3x01OhQNnjb8IJYi38VlTE3mBXwcfvywuSw==",
      "license": "MIT",
      "dependencies": {
        "agent-base": "^7.1.2",
        "debug": "4"
      },
      "engines": {
        "node": ">= 14"
      }
    },
    "node_modules/ieee754": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/ieee754/-/ieee754-1.2.1.tgz",
      "integrity": "sha512-dcyqhDvX1C46lXZcVqCpK+FtMRQVdIMN6/Df5js2zouUsqG7I6sFxitIC+7KYK29KdXOLHdu9zL4sFnoVQnqaA==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "BSD-3-Clause"
    },
    "node_modules/ignore": {
      "version": "5.3.2",
      "resolved": "https://registry.npmjs.org/ignore/-/ignore-5.3.2.tgz",
      "integrity": "sha512-hsBTNUqQTDwkWtcdYI2i06Y/nUBEsNEDJKjWdigLvegy8kDuJAS8uRlpkkcQpyEXL0Z/pjDy5HBmMjRCJ2gq+g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 4"
      }
    },
    "node_modules/immediate": {
      "version": "3.0.6",
      "resolved": "https://registry.npmjs.org/immediate/-/immediate-3.0.6.tgz",
      "integrity": "sha512-XXOFtyqDjNDAQxVfYxuF7g9Il/IbWmmlQg2MYKOH8ExIT1qg6xc4zyS3HaEEATgs1btfzxq15ciUiY7gjSXRGQ==",
      "license": "MIT"
    },
    "node_modules/import-fresh": {
      "version": "3.3.1",
      "resolved": "https://registry.npmjs.org/import-fresh/-/import-fresh-3.3.1.tgz",
      "integrity": "sha512-TR3KfrTZTYLPB6jUjfx6MF9WcWrHL9su5TObK4ZkYgBdWKPOFoSoQIdEuTuR82pmtxH2spWG9h6etwfr1pLBqQ==",
      "license": "MIT",
      "dependencies": {
        "parent-module": "^1.0.0",
        "resolve-from": "^4.0.0"
      },
      "engines": {
        "node": ">=6"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/imurmurhash": {
      "version": "0.1.4",
      "resolved": "https://registry.npmjs.org/imurmurhash/-/imurmurhash-0.1.4.tgz",
      "integrity": "sha512-JmXMZ6wuvDmLiHEml9ykzqO6lwFbof0GG4IkcGaENdCRDDmMVnny7s5HsIgHCbaq0w2MyPhDqkhTUgS2LU2PHA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.8.19"
      }
    },
    "node_modules/inflight": {
      "version": "1.0.6",
      "resolved": "https://registry.npmjs.org/inflight/-/inflight-1.0.6.tgz",
      "integrity": "sha512-k92I/b08q4wvFscXCLvqfsHCrjrF7yiXsQuIVvVE7N82W3+aqpzuUdBbfhWcy/FZR3/4IgflMgKLOsvPDrGCJA==",
      "deprecated": "This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.",
      "license": "ISC",
      "dependencies": {
        "once": "^1.3.0",
        "wrappy": "1"
      }
    },
    "node_modules/inherits": {
      "version": "2.0.4",
      "resolved": "https://registry.npmjs.org/inherits/-/inherits-2.0.4.tgz",
      "integrity": "sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==",
      "license": "ISC"
    },
    "node_modules/internal-slot": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/internal-slot/-/internal-slot-1.1.0.tgz",
      "integrity": "sha512-4gd7VpWNQNB4UKKCFFVcp1AVv+FMOgs9NKzjHKusc8jTMhd5eL1NqQqOpE0KzMds804/yHlglp3uxgluOqAPLw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "hasown": "^2.0.2",
        "side-channel": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/intersection-observer": {
      "version": "0.12.2",
      "resolved": "https://registry.npmjs.org/intersection-observer/-/intersection-observer-0.12.2.tgz",
      "integrity": "sha512-7m1vEcPCxXYI8HqnL8CKI6siDyD+eIWSwgB3DZA+ZTogxk9I4CDnj4wilt9x/+/QbHI4YG5YZNmC6458/e9Ktg==",
      "license": "Apache-2.0"
    },
    "node_modules/is-array-buffer": {
      "version": "3.0.5",
      "resolved": "https://registry.npmjs.org/is-array-buffer/-/is-array-buffer-3.0.5.tgz",
      "integrity": "sha512-DDfANUiiG2wC1qawP66qlTugJeL5HyzMpfr8lLK+jMQirGzNod0B12cFB/9q838Ru27sBwfw78/rdoU7RERz6A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.3",
        "get-intrinsic": "^1.2.6"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-arrayish": {
      "version": "0.3.2",
      "resolved": "https://registry.npmjs.org/is-arrayish/-/is-arrayish-0.3.2.tgz",
      "integrity": "sha512-eVRqCvVlZbuw3GrM63ovNSNAeA1K16kaR/LRY/92w0zxQ5/1YzwblUX652i4Xs9RwAGjW9d9y6X88t8OaAJfWQ==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/is-async-function": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/is-async-function/-/is-async-function-2.1.1.tgz",
      "integrity": "sha512-9dgM/cZBnNvjzaMYHVoxxfPj2QXt22Ev7SuuPrs+xav0ukGB0S6d4ydZdEiM48kLx5kDV+QBPrpVnFyefL8kkQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "async-function": "^1.0.0",
        "call-bound": "^1.0.3",
        "get-proto": "^1.0.1",
        "has-tostringtag": "^1.0.2",
        "safe-regex-test": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-bigint": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/is-bigint/-/is-bigint-1.1.0.tgz",
      "integrity": "sha512-n4ZT37wG78iz03xPRKJrHTdZbe3IicyucEtdRsV5yglwc3GyUfbAfpSeD0FJ41NbUNSt5wbhqfp1fS+BgnvDFQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "has-bigints": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-boolean-object": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/is-boolean-object/-/is-boolean-object-1.2.2.tgz",
      "integrity": "sha512-wa56o2/ElJMYqjCjGkXri7it5FbebW5usLw/nPmCMs5DeZ7eziSYZhSmPRn0txqeW4LnAmQQU7FgqLpsEFKM4A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "has-tostringtag": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-bun-module": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/is-bun-module/-/is-bun-module-2.0.0.tgz",
      "integrity": "sha512-gNCGbnnnnFAUGKeZ9PdbyeGYJqewpmc2aKHUEMO5nQPWU9lOmv7jcmQIv+qHD8fXW6W7qfuCwX4rY9LNRjXrkQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "semver": "^7.7.1"
      }
    },
    "node_modules/is-callable": {
      "version": "1.2.7",
      "resolved": "https://registry.npmjs.org/is-callable/-/is-callable-1.2.7.tgz",
      "integrity": "sha512-1BC0BVFhS/p0qtw6enp8e+8OD0UrK0oFLztSjNzhcKA3WDuJxxAPXzPuPtKkjEY9UUoEWlX/8fgKeu2S8i9JTA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-core-module": {
      "version": "2.16.1",
      "resolved": "https://registry.npmjs.org/is-core-module/-/is-core-module-2.16.1.tgz",
      "integrity": "sha512-UfoeMA6fIJ8wTYFEUjelnaGI67v6+N7qXJEvQuIGa99l4xsCruSYOVSQ0uPANn4dAzm8lkYPaKLrrijLq7x23w==",
      "license": "MIT",
      "dependencies": {
        "hasown": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-data-view": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/is-data-view/-/is-data-view-1.0.2.tgz",
      "integrity": "sha512-RKtWF8pGmS87i2D6gqQu/l7EYRlVdfzemCJN/P3UOs//x1QE7mfhvzHIApBTRf7axvT6DMGwSwBXYCT0nfB9xw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "get-intrinsic": "^1.2.6",
        "is-typed-array": "^1.1.13"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-date-object": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/is-date-object/-/is-date-object-1.1.0.tgz",
      "integrity": "sha512-PwwhEakHVKTdRNVOw+/Gyh0+MzlCl4R6qKvkhuvLtPMggI1WAHt9sOwZxQLSGpUaDnrdyDsomoRgNnCfKNSXXg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "has-tostringtag": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-extglob": {
      "version": "2.1.1",
      "resolved": "https://registry.npmjs.org/is-extglob/-/is-extglob-2.1.1.tgz",
      "integrity": "sha512-SbKbANkN603Vi4jEZv49LeVJMn4yGwsbzZworEoyEiutsN3nJYdbO36zfhGJ6QEDpOZIFkDtnq5JRxmvl3jsoQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/is-finalizationregistry": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/is-finalizationregistry/-/is-finalizationregistry-1.1.1.tgz",
      "integrity": "sha512-1pC6N8qWJbWoPtEjgcL2xyhQOP491EQjeUo3qTKcmV8YSDDJrOepfG8pcC7h/QgnQHYSv0mJ3Z/ZWxmatVrysg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-generator-function": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/is-generator-function/-/is-generator-function-1.1.0.tgz",
      "integrity": "sha512-nPUB5km40q9e8UfN/Zc24eLlzdSf9OfKByBw9CIdw4H1giPMeA0OIJvbchsCu4npfI2QcMVBsGEBHKZ7wLTWmQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "get-proto": "^1.0.0",
        "has-tostringtag": "^1.0.2",
        "safe-regex-test": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-glob": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/is-glob/-/is-glob-4.0.3.tgz",
      "integrity": "sha512-xelSayHH36ZgE7ZWhli7pW34hNbNl8Ojv5KVmkJD4hBdD3th8Tfk9vYasLM+mXWOZhFkgZfxhLSnrwRr4elSSg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-extglob": "^2.1.1"
      },
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/is-map": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/is-map/-/is-map-2.0.3.tgz",
      "integrity": "sha512-1Qed0/Hr2m+YqxnM09CjA2d/i6YZNfF6R2oRAOj36eUdS6qIV/huPJNSEpKbupewFs+ZsJlxsjjPbc0/afW6Lw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-mobile": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/is-mobile/-/is-mobile-4.0.0.tgz",
      "integrity": "sha512-mlcHZA84t1qLSuWkt2v0I2l61PYdyQDt4aG1mLIXF5FDMm4+haBCxCPYSr/uwqQNRk1MiTizn0ypEuRAOLRAew==",
      "license": "MIT"
    },
    "node_modules/is-negative-zero": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/is-negative-zero/-/is-negative-zero-2.0.3.tgz",
      "integrity": "sha512-5KoIu2Ngpyek75jXodFvnafB6DJgr3u8uuK0LEZJjrU19DrMD3EVERaR8sjz8CCGgpZvxPl9SuE1GMVPFHx1mw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-network-error": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/is-network-error/-/is-network-error-1.1.0.tgz",
      "integrity": "sha512-tUdRRAnhT+OtCZR/LxZelH/C7QtjtFrTu5tXCA8pl55eTUElUHT+GPYV8MBMBvea/j+NxQqVt3LbWMRir7Gx9g==",
      "license": "MIT",
      "engines": {
        "node": ">=16"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/is-number": {
      "version": "7.0.0",
      "resolved": "https://registry.npmjs.org/is-number/-/is-number-7.0.0.tgz",
      "integrity": "sha512-41Cifkg6e8TylSpdtTpeLVMqvSBEVzTttHvERD741+pnZ8ANv0004MRL43QKPDlK9cGvNp6NZWZUBlbGXYxxng==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.12.0"
      }
    },
    "node_modules/is-number-object": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/is-number-object/-/is-number-object-1.1.1.tgz",
      "integrity": "sha512-lZhclumE1G6VYD8VHe35wFaIif+CTy5SJIi5+3y4psDgWu4wPDoBhF8NxUOinEc7pHgiTsT6MaBb92rKhhD+Xw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "has-tostringtag": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-regex": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/is-regex/-/is-regex-1.2.1.tgz",
      "integrity": "sha512-MjYsKHO5O7mCsmRGxWcLWheFqN9DJ/2TmngvjKXihe6efViPqc274+Fx/4fYj/r03+ESvBdTXK0V6tA3rgez1g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "gopd": "^1.2.0",
        "has-tostringtag": "^1.0.2",
        "hasown": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-set": {
      "version": "2.0.3",
      "resolved": "https://registry.npmjs.org/is-set/-/is-set-2.0.3.tgz",
      "integrity": "sha512-iPAjerrse27/ygGLxw+EBR9agv9Y6uLeYVJMu+QNCoouJ1/1ri0mGrcWpfCqFZuzzx3WjtwxG098X+n4OuRkPg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-shared-array-buffer": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/is-shared-array-buffer/-/is-shared-array-buffer-1.0.4.tgz",
      "integrity": "sha512-ISWac8drv4ZGfwKl5slpHG9OwPNty4jOWPRIhBpxOoD+hqITiwuipOQ2bNthAzwA3B4fIjO4Nln74N0S9byq8A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-string": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/is-string/-/is-string-1.1.1.tgz",
      "integrity": "sha512-BtEeSsoaQjlSPBemMQIrY1MY0uM6vnS1g5fmufYOtnxLGUZM2178PKbhsk7Ffv58IX+ZtcvoGwccYsh0PglkAA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "has-tostringtag": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-symbol": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/is-symbol/-/is-symbol-1.1.1.tgz",
      "integrity": "sha512-9gGx6GTtCQM73BgmHQXfDmLtfjjTUDSyoxTCbp5WtoixAhfgsDirWIcVQ/IHpvI5Vgd5i/J5F7B9cN/WlVbC/w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "has-symbols": "^1.1.0",
        "safe-regex-test": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-typed-array": {
      "version": "1.1.15",
      "resolved": "https://registry.npmjs.org/is-typed-array/-/is-typed-array-1.1.15.tgz",
      "integrity": "sha512-p3EcsicXjit7SaskXHs1hA91QxgTw46Fv6EFKKGS5DRFLD8yKnohjF3hxoju94b/OcMZoQukzpPpBE9uLVKzgQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "which-typed-array": "^1.1.16"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-weakmap": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/is-weakmap/-/is-weakmap-2.0.2.tgz",
      "integrity": "sha512-K5pXYOm9wqY1RgjpL3YTkF39tni1XajUIkawTLUo9EZEVUFga5gSQJF8nNS7ZwJQ02y+1YCNYcMh+HIf1ZqE+w==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-weakref": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/is-weakref/-/is-weakref-1.1.1.tgz",
      "integrity": "sha512-6i9mGWSlqzNMEqpCp93KwRS1uUOodk2OJ6b+sq7ZPDSy2WuI5NFIxp/254TytR8ftefexkWn5xNiHUNpPOfSew==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/is-weakset": {
      "version": "2.0.4",
      "resolved": "https://registry.npmjs.org/is-weakset/-/is-weakset-2.0.4.tgz",
      "integrity": "sha512-mfcwb6IzQyOKTs84CQMrOwW4gQcaTOAWJ0zzJCl2WSPDrWk/OzDaImWFH3djXhb24g4eudZfLRozAvPGw4d9hQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "get-intrinsic": "^1.2.6"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/isarray": {
      "version": "2.0.5",
      "resolved": "https://registry.npmjs.org/isarray/-/isarray-2.0.5.tgz",
      "integrity": "sha512-xHjhDr3cNBK0BzdUJSPXZntQUx/mwMS5Rw4A7lPJ90XGAO6ISP/ePDNuo0vhqOZU+UD5JoodwCAAoZQd3FeAKw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/isexe": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/isexe/-/isexe-2.0.0.tgz",
      "integrity": "sha512-RHxMLp9lnKHGHRng9QFhRCMbYAcVpn69smSGcq3f36xjgVVWThj4qqLbTLlq7Ssj8B+fIQ1EuCEGI2lKsyQeIw==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/iterator.prototype": {
      "version": "1.1.5",
      "resolved": "https://registry.npmjs.org/iterator.prototype/-/iterator.prototype-1.1.5.tgz",
      "integrity": "sha512-H0dkQoCa3b2VEeKQBOxFph+JAbcrQdE7KC0UkqwpLmv2EC4P41QXP+rqo9wYodACiG5/WM5s9oDApTU8utwj9g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "define-data-property": "^1.1.4",
        "es-object-atoms": "^1.0.0",
        "get-intrinsic": "^1.2.6",
        "get-proto": "^1.0.0",
        "has-symbols": "^1.1.0",
        "set-function-name": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/jiti": {
      "version": "2.5.1",
      "resolved": "https://registry.npmjs.org/jiti/-/jiti-2.5.1.tgz",
      "integrity": "sha512-twQoecYPiVA5K/h6SxtORw/Bs3ar+mLUtoPSc7iMXzQzK8d7eJ/R09wmTwAjiamETn1cXYPGfNnu7DMoHgu12w==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "jiti": "lib/jiti-cli.mjs"
      }
    },
    "node_modules/js-tokens": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/js-tokens/-/js-tokens-4.0.0.tgz",
      "integrity": "sha512-RdJUflcE3cUzKiMqQgsCu06FPu9UdIJO0beYbPhHN4k6apgJtifcoCtT9bcxOpYBtpD2kCM6Sbzg4CausW/PKQ==",
      "license": "MIT"
    },
    "node_modules/js-yaml": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/js-yaml/-/js-yaml-4.1.0.tgz",
      "integrity": "sha512-wpxZs9NoxZaJESJGIZTyDEaYpl0FKSA+FB9aJiyemKhMwkxQg63h4T1KJgUGHpTqPDNRcmmYLugrRjJlBtWvRA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "argparse": "^2.0.1"
      },
      "bin": {
        "js-yaml": "bin/js-yaml.js"
      }
    },
    "node_modules/jsesc": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/jsesc/-/jsesc-3.1.0.tgz",
      "integrity": "sha512-/sM3dO2FOzXjKQhJuo0Q173wf2KOo8t4I8vHy6lF9poUp7bKT0/NHE8fPX23PwfhnykfqnC2xRxOnVw5XuGIaA==",
      "license": "MIT",
      "bin": {
        "jsesc": "bin/jsesc"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/json-buffer": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/json-buffer/-/json-buffer-3.0.1.tgz",
      "integrity": "sha512-4bV5BfR2mqfQTJm+V5tPPdf+ZpuhiIvTuAB5g8kcrXOZpTT/QwwVRWBywX1ozr6lEuPdbHxwaJlm9G6mI2sfSQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/json-parse-even-better-errors": {
      "version": "2.3.1",
      "resolved": "https://registry.npmjs.org/json-parse-even-better-errors/-/json-parse-even-better-errors-2.3.1.tgz",
      "integrity": "sha512-xyFwyhro/JEof6Ghe2iz2NcXoj2sloNsWr/XsERDK/oiPCfaNhl5ONfp+jQdAZRQQ0IJWNzH9zIZF7li91kh2w==",
      "license": "MIT"
    },
    "node_modules/json-schema-traverse": {
      "version": "0.4.1",
      "resolved": "https://registry.npmjs.org/json-schema-traverse/-/json-schema-traverse-0.4.1.tgz",
      "integrity": "sha512-xbbCH5dCYU5T8LcEhhuh7HJ88HXuW3qsI3Y0zOZFKfZEHcpWiHU/Jxzk629Brsab/mMiHQti9wMP+845RPe3Vg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/json-stable-stringify-without-jsonify": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/json-stable-stringify-without-jsonify/-/json-stable-stringify-without-jsonify-1.0.1.tgz",
      "integrity": "sha512-Bdboy+l7tA3OGW6FjyFHWkP5LuByj1Tk33Ljyq0axyzdk9//JSi2u3fP1QSmd1KNwq6VOKYGlAu87CisVir6Pw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/json5": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/json5/-/json5-1.0.2.tgz",
      "integrity": "sha512-g1MWMLBiz8FKi1e4w0UyVL3w+iJceWAFBAaBnnGKOpNa5f8TLktkbre1+s6oICydWAm+HRUGTmI+//xv2hvXYA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "minimist": "^1.2.0"
      },
      "bin": {
        "json5": "lib/cli.js"
      }
    },
    "node_modules/jsx-ast-utils": {
      "version": "3.3.5",
      "resolved": "https://registry.npmjs.org/jsx-ast-utils/-/jsx-ast-utils-3.3.5.tgz",
      "integrity": "sha512-ZZow9HBI5O6EPgSJLUb8n2NKgmVWTwCvHGwFuJlMjvLFqlGG6pjirPhtdsseaLZjSibD8eegzmYpUZwoIlj2cQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "array-includes": "^3.1.6",
        "array.prototype.flat": "^1.3.1",
        "object.assign": "^4.1.4",
        "object.values": "^1.1.6"
      },
      "engines": {
        "node": ">=4.0"
      }
    },
    "node_modules/jszip": {
      "version": "3.10.1",
      "resolved": "https://registry.npmjs.org/jszip/-/jszip-3.10.1.tgz",
      "integrity": "sha512-xXDvecyTpGLrqFrvkrUSoxxfJI5AH7U8zxxtVclpsUtMCq4JQ290LY8AW5c7Ggnr/Y/oK+bQMbqK2qmtk3pN4g==",
      "license": "(MIT OR GPL-3.0-or-later)",
      "dependencies": {
        "lie": "~3.3.0",
        "pako": "~1.0.2",
        "readable-stream": "~2.3.6",
        "setimmediate": "^1.0.5"
      }
    },
    "node_modules/jszip/node_modules/isarray": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/isarray/-/isarray-1.0.0.tgz",
      "integrity": "sha512-VLghIWNM6ELQzo7zwmcg0NmTVyWKYjvIeM83yjp0wRDTmUnrM678fQbcKBo6n2CJEF0szoG//ytg+TKla89ALQ==",
      "license": "MIT"
    },
    "node_modules/jszip/node_modules/readable-stream": {
      "version": "2.3.8",
      "resolved": "https://registry.npmjs.org/readable-stream/-/readable-stream-2.3.8.tgz",
      "integrity": "sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA==",
      "license": "MIT",
      "dependencies": {
        "core-util-is": "~1.0.0",
        "inherits": "~2.0.3",
        "isarray": "~1.0.0",
        "process-nextick-args": "~2.0.0",
        "safe-buffer": "~5.1.1",
        "string_decoder": "~1.1.1",
        "util-deprecate": "~1.0.1"
      }
    },
    "node_modules/jszip/node_modules/safe-buffer": {
      "version": "5.1.2",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.1.2.tgz",
      "integrity": "sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==",
      "license": "MIT"
    },
    "node_modules/jszip/node_modules/string_decoder": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/string_decoder/-/string_decoder-1.1.1.tgz",
      "integrity": "sha512-n/ShnvDi6FHbbVfviro+WojiFzv+s8MPMHBczVePfUpDJLwoLT0ht1l4YwBCbi8pJAveEEdnkHyPyTP/mzRfwg==",
      "license": "MIT",
      "dependencies": {
        "safe-buffer": "~5.1.0"
      }
    },
    "node_modules/jwa": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/jwa/-/jwa-2.0.1.tgz",
      "integrity": "sha512-hRF04fqJIP8Abbkq5NKGN0Bbr3JxlQ+qhZufXVr0DvujKy93ZCbXZMHDL4EOtodSbCWxOqR8MS1tXA5hwqCXDg==",
      "license": "MIT",
      "dependencies": {
        "buffer-equal-constant-time": "^1.0.1",
        "ecdsa-sig-formatter": "1.0.11",
        "safe-buffer": "^5.0.1"
      }
    },
    "node_modules/jws": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/jws/-/jws-4.0.0.tgz",
      "integrity": "sha512-KDncfTmOZoOMTFG4mBlG0qUIOlc03fmzH+ru6RgYVZhPkyiy/92Owlt/8UEN+a4TXR1FQetfIpJE8ApdvdVxTg==",
      "license": "MIT",
      "dependencies": {
        "jwa": "^2.0.0",
        "safe-buffer": "^5.0.1"
      }
    },
    "node_modules/keyv": {
      "version": "4.5.4",
      "resolved": "https://registry.npmjs.org/keyv/-/keyv-4.5.4.tgz",
      "integrity": "sha512-oxVHkHR/EJf2CNXnWxRLW6mg7JyCCUcG0DtEGmL2ctUo1PNTin1PUil+r/+4r5MpVgC/fn1kjsx7mjSujKqIpw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "json-buffer": "3.0.1"
      }
    },
    "node_modules/language-subtag-registry": {
      "version": "0.3.23",
      "resolved": "https://registry.npmjs.org/language-subtag-registry/-/language-subtag-registry-0.3.23.tgz",
      "integrity": "sha512-0K65Lea881pHotoGEa5gDlMxt3pctLi2RplBb7Ezh4rRdLEOtgi7n4EwK9lamnUCkKBqaeKRVebTq6BAxSkpXQ==",
      "dev": true,
      "license": "CC0-1.0"
    },
    "node_modules/language-tags": {
      "version": "1.0.9",
      "resolved": "https://registry.npmjs.org/language-tags/-/language-tags-1.0.9.tgz",
      "integrity": "sha512-MbjN408fEndfiQXbFQ1vnd+1NoLDsnQW41410oQBXiyXDMYH5z505juWa4KUE1LqxRC7DgOgZDbKLxHIwm27hA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "language-subtag-registry": "^0.3.20"
      },
      "engines": {
        "node": ">=0.10"
      }
    },
    "node_modules/lazystream": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/lazystream/-/lazystream-1.0.1.tgz",
      "integrity": "sha512-b94GiNHQNy6JNTrt5w6zNyffMrNkXZb3KTkCZJb2V1xaEGCk093vkZ2jk3tpaeP33/OiXC+WvK9AxUebnf5nbw==",
      "license": "MIT",
      "dependencies": {
        "readable-stream": "^2.0.5"
      },
      "engines": {
        "node": ">= 0.6.3"
      }
    },
    "node_modules/lazystream/node_modules/isarray": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/isarray/-/isarray-1.0.0.tgz",
      "integrity": "sha512-VLghIWNM6ELQzo7zwmcg0NmTVyWKYjvIeM83yjp0wRDTmUnrM678fQbcKBo6n2CJEF0szoG//ytg+TKla89ALQ==",
      "license": "MIT"
    },
    "node_modules/lazystream/node_modules/readable-stream": {
      "version": "2.3.8",
      "resolved": "https://registry.npmjs.org/readable-stream/-/readable-stream-2.3.8.tgz",
      "integrity": "sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA==",
      "license": "MIT",
      "dependencies": {
        "core-util-is": "~1.0.0",
        "inherits": "~2.0.3",
        "isarray": "~1.0.0",
        "process-nextick-args": "~2.0.0",
        "safe-buffer": "~5.1.1",
        "string_decoder": "~1.1.1",
        "util-deprecate": "~1.0.1"
      }
    },
    "node_modules/lazystream/node_modules/safe-buffer": {
      "version": "5.1.2",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.1.2.tgz",
      "integrity": "sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==",
      "license": "MIT"
    },
    "node_modules/lazystream/node_modules/string_decoder": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/string_decoder/-/string_decoder-1.1.1.tgz",
      "integrity": "sha512-n/ShnvDi6FHbbVfviro+WojiFzv+s8MPMHBczVePfUpDJLwoLT0ht1l4YwBCbi8pJAveEEdnkHyPyTP/mzRfwg==",
      "license": "MIT",
      "dependencies": {
        "safe-buffer": "~5.1.0"
      }
    },
    "node_modules/levn": {
      "version": "0.4.1",
      "resolved": "https://registry.npmjs.org/levn/-/levn-0.4.1.tgz",
      "integrity": "sha512-+bT2uH4E5LGE7h/n3evcS/sQlJXCpIp6ym8OWJ5eV6+67Dsql/LaaT7qJBAt2rzfoa/5QBGBhxDix1dMt2kQKQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "prelude-ls": "^1.2.1",
        "type-check": "~0.4.0"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/lie": {
      "version": "3.3.0",
      "resolved": "https://registry.npmjs.org/lie/-/lie-3.3.0.tgz",
      "integrity": "sha512-UaiMJzeWRlEujzAuw5LokY1L5ecNQYZKfmyZ9L7wDHb/p5etKaxXhohBcrw0EYby+G/NA52vRSN4N39dxHAIwQ==",
      "license": "MIT",
      "dependencies": {
        "immediate": "~3.0.5"
      }
    },
    "node_modules/lightningcss": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss/-/lightningcss-1.30.1.tgz",
      "integrity": "sha512-xi6IyHML+c9+Q3W0S4fCQJOym42pyurFiJUHEcEyHS0CeKzia4yZDEsLlqOFykxOdHpNy0NmvVO31vcSqAxJCg==",
      "dev": true,
      "license": "MPL-2.0",
      "dependencies": {
        "detect-libc": "^2.0.3"
      },
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      },
      "optionalDependencies": {
        "lightningcss-darwin-arm64": "1.30.1",
        "lightningcss-darwin-x64": "1.30.1",
        "lightningcss-freebsd-x64": "1.30.1",
        "lightningcss-linux-arm-gnueabihf": "1.30.1",
        "lightningcss-linux-arm64-gnu": "1.30.1",
        "lightningcss-linux-arm64-musl": "1.30.1",
        "lightningcss-linux-x64-gnu": "1.30.1",
        "lightningcss-linux-x64-musl": "1.30.1",
        "lightningcss-win32-arm64-msvc": "1.30.1",
        "lightningcss-win32-x64-msvc": "1.30.1"
      }
    },
    "node_modules/lightningcss-darwin-arm64": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-darwin-arm64/-/lightningcss-darwin-arm64-1.30.1.tgz",
      "integrity": "sha512-c8JK7hyE65X1MHMN+Viq9n11RRC7hgin3HhYKhrMyaXflk5GVplZ60IxyoVtzILeKr+xAJwg6zK6sjTBJ0FKYQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-darwin-x64": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-darwin-x64/-/lightningcss-darwin-x64-1.30.1.tgz",
      "integrity": "sha512-k1EvjakfumAQoTfcXUcHQZhSpLlkAuEkdMBsI/ivWw9hL+7FtilQc0Cy3hrx0AAQrVtQAbMI7YjCgYgvn37PzA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-freebsd-x64": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-freebsd-x64/-/lightningcss-freebsd-x64-1.30.1.tgz",
      "integrity": "sha512-kmW6UGCGg2PcyUE59K5r0kWfKPAVy4SltVeut+umLCFoJ53RdCUWxcRDzO1eTaxf/7Q2H7LTquFHPL5R+Gjyig==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-linux-arm-gnueabihf": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-linux-arm-gnueabihf/-/lightningcss-linux-arm-gnueabihf-1.30.1.tgz",
      "integrity": "sha512-MjxUShl1v8pit+6D/zSPq9S9dQ2NPFSQwGvxBCYaBYLPlCWuPh9/t1MRS8iUaR8i+a6w7aps+B4N0S1TYP/R+Q==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-linux-arm64-gnu": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-linux-arm64-gnu/-/lightningcss-linux-arm64-gnu-1.30.1.tgz",
      "integrity": "sha512-gB72maP8rmrKsnKYy8XUuXi/4OctJiuQjcuqWNlJQ6jZiWqtPvqFziskH3hnajfvKB27ynbVCucKSm2rkQp4Bw==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-linux-arm64-musl": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-linux-arm64-musl/-/lightningcss-linux-arm64-musl-1.30.1.tgz",
      "integrity": "sha512-jmUQVx4331m6LIX+0wUhBbmMX7TCfjF5FoOH6SD1CttzuYlGNVpA7QnrmLxrsub43ClTINfGSYyHe2HWeLl5CQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-linux-x64-gnu": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-linux-x64-gnu/-/lightningcss-linux-x64-gnu-1.30.1.tgz",
      "integrity": "sha512-piWx3z4wN8J8z3+O5kO74+yr6ze/dKmPnI7vLqfSqI8bccaTGY5xiSGVIJBDd5K5BHlvVLpUB3S2YCfelyJ1bw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-linux-x64-musl": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-linux-x64-musl/-/lightningcss-linux-x64-musl-1.30.1.tgz",
      "integrity": "sha512-rRomAK7eIkL+tHY0YPxbc5Dra2gXlI63HL+v1Pdi1a3sC+tJTcFrHX+E86sulgAXeI7rSzDYhPSeHHjqFhqfeQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-win32-arm64-msvc": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-win32-arm64-msvc/-/lightningcss-win32-arm64-msvc-1.30.1.tgz",
      "integrity": "sha512-mSL4rqPi4iXq5YVqzSsJgMVFENoa4nGTT/GjO2c0Yl9OuQfPsIfncvLrEW6RbbB24WtZ3xP/2CCmI3tNkNV4oA==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lightningcss-win32-x64-msvc": {
      "version": "1.30.1",
      "resolved": "https://registry.npmjs.org/lightningcss-win32-x64-msvc/-/lightningcss-win32-x64-msvc-1.30.1.tgz",
      "integrity": "sha512-PVqXh48wh4T53F/1CCu8PIPCxLzWyCnn/9T5W1Jpmdy5h9Cwd+0YQS6/LwhHXSafuc61/xg9Lv5OrCby6a++jg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MPL-2.0",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": ">= 12.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/parcel"
      }
    },
    "node_modules/lines-and-columns": {
      "version": "1.2.4",
      "resolved": "https://registry.npmjs.org/lines-and-columns/-/lines-and-columns-1.2.4.tgz",
      "integrity": "sha512-7ylylesZQ/PV29jhEDl3Ufjo6ZX7gCqJr5F7PKrqc93v7fzSymt1BpwEU8nAUXs8qzzvqhbjhK5QZg6Mt/HkBg==",
      "license": "MIT"
    },
    "node_modules/listenercount": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/listenercount/-/listenercount-1.0.1.tgz",
      "integrity": "sha512-3mk/Zag0+IJxeDrxSgaDPy4zZ3w05PRZeJNnlWhzFz5OkX49J4krc+A8X2d2M69vGMBEX0uyl8M+W+8gH+kBqQ==",
      "license": "ISC"
    },
    "node_modules/locate-path": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/locate-path/-/locate-path-6.0.0.tgz",
      "integrity": "sha512-iPZK6eYjbxRu3uB4/WZ3EsEIMJFMqAoopl3R+zuq0UjcAm/MO6KCweDgPfP3elTztoKP3KtnVHxTn2NHBSDVUw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "p-locate": "^5.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/lodash": {
      "version": "4.17.21",
      "resolved": "https://registry.npmjs.org/lodash/-/lodash-4.17.21.tgz",
      "integrity": "sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ+LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg==",
      "license": "MIT"
    },
    "node_modules/lodash.defaults": {
      "version": "4.2.0",
      "resolved": "https://registry.npmjs.org/lodash.defaults/-/lodash.defaults-4.2.0.tgz",
      "integrity": "sha512-qjxPLHd3r5DnsdGacqOMU6pb/avJzdh9tFX2ymgoZE27BmjXrNy/y4LoaiTeAb+O3gL8AfpJGtqfX/ae2leYYQ==",
      "license": "MIT"
    },
    "node_modules/lodash.difference": {
      "version": "4.5.0",
      "resolved": "https://registry.npmjs.org/lodash.difference/-/lodash.difference-4.5.0.tgz",
      "integrity": "sha512-dS2j+W26TQ7taQBGN8Lbbq04ssV3emRw4NY58WErlTO29pIqS0HmoT5aJ9+TUQ1N3G+JOZSji4eugsWwGp9yPA==",
      "license": "MIT"
    },
    "node_modules/lodash.escaperegexp": {
      "version": "4.1.2",
      "resolved": "https://registry.npmjs.org/lodash.escaperegexp/-/lodash.escaperegexp-4.1.2.tgz",
      "integrity": "sha512-TM9YBvyC84ZxE3rgfefxUWiQKLilstD6k7PTGt6wfbtXF8ixIJLOL3VYyV/z+ZiPLsVxAsKAFVwWlWeb2Y8Yyw==",
      "license": "MIT"
    },
    "node_modules/lodash.flatten": {
      "version": "4.4.0",
      "resolved": "https://registry.npmjs.org/lodash.flatten/-/lodash.flatten-4.4.0.tgz",
      "integrity": "sha512-C5N2Z3DgnnKr0LOpv/hKCgKdb7ZZwafIrsesve6lmzvZIRZRGaZ/l6Q8+2W7NaT+ZwO3fFlSCzCzrDCFdJfZ4g==",
      "license": "MIT"
    },
    "node_modules/lodash.groupby": {
      "version": "4.6.0",
      "resolved": "https://registry.npmjs.org/lodash.groupby/-/lodash.groupby-4.6.0.tgz",
      "integrity": "sha512-5dcWxm23+VAoz+awKmBaiBvzox8+RqMgFhi7UvX9DHZr2HdxHXM/Wrf8cfKpsW37RNrvtPn6hSwNqurSILbmJw==",
      "license": "MIT"
    },
    "node_modules/lodash.isboolean": {
      "version": "3.0.3",
      "resolved": "https://registry.npmjs.org/lodash.isboolean/-/lodash.isboolean-3.0.3.tgz",
      "integrity": "sha512-Bz5mupy2SVbPHURB98VAcw+aHh4vRV5IPNhILUCsOzRmsTmSQ17jIuqopAentWoehktxGd9e/hbIXq980/1QJg==",
      "license": "MIT"
    },
    "node_modules/lodash.isequal": {
      "version": "4.5.0",
      "resolved": "https://registry.npmjs.org/lodash.isequal/-/lodash.isequal-4.5.0.tgz",
      "integrity": "sha512-pDo3lu8Jhfjqls6GkMgpahsF9kCyayhgykjyLMNFTKWrpVdAQtYyB4muAMWozBB4ig/dtWAmsMxLEI8wuz+DYQ==",
      "deprecated": "This package is deprecated. Use require('node:util').isDeepStrictEqual instead.",
      "license": "MIT"
    },
    "node_modules/lodash.isfunction": {
      "version": "3.0.9",
      "resolved": "https://registry.npmjs.org/lodash.isfunction/-/lodash.isfunction-3.0.9.tgz",
      "integrity": "sha512-AirXNj15uRIMMPihnkInB4i3NHeb4iBtNg9WRWuK2o31S+ePwwNmDPaTL3o7dTJ+VXNZim7rFs4rxN4YU1oUJw==",
      "license": "MIT"
    },
    "node_modules/lodash.isnil": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/lodash.isnil/-/lodash.isnil-4.0.0.tgz",
      "integrity": "sha512-up2Mzq3545mwVnMhTDMdfoG1OurpA/s5t88JmQX809eH3C8491iu2sfKhTfhQtKY78oPNhiaHJUpT/dUDAAtng==",
      "license": "MIT"
    },
    "node_modules/lodash.isplainobject": {
      "version": "4.0.6",
      "resolved": "https://registry.npmjs.org/lodash.isplainobject/-/lodash.isplainobject-4.0.6.tgz",
      "integrity": "sha512-oSXzaWypCMHkPC3NvBEaPHf0KsA5mvPrOPgQWDsbg8n7orZ290M0BmC/jgRZ4vcJ6DTAhjrsSYgdsW/F+MFOBA==",
      "license": "MIT"
    },
    "node_modules/lodash.isundefined": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/lodash.isundefined/-/lodash.isundefined-3.0.1.tgz",
      "integrity": "sha512-MXB1is3s899/cD8jheYYE2V9qTHwKvt+npCwpD+1Sxm3Q3cECXCiYHjeHWXNwr6Q0SOBPrYUDxendrO6goVTEA==",
      "license": "MIT"
    },
    "node_modules/lodash.merge": {
      "version": "4.6.2",
      "resolved": "https://registry.npmjs.org/lodash.merge/-/lodash.merge-4.6.2.tgz",
      "integrity": "sha512-0KpjqXRVvrYyCsX1swR/XTK0va6VQkQM6MNo7PqW77ByjAhoARA8EfrP1N4+KlKj8YS0ZUCtRT/YUuhyYDujIQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/lodash.union": {
      "version": "4.6.0",
      "resolved": "https://registry.npmjs.org/lodash.union/-/lodash.union-4.6.0.tgz",
      "integrity": "sha512-c4pB2CdGrGdjMKYLA+XiRDO7Y0PRQbm/Gzg8qMj+QH+pFVAoTp5sBpO0odL3FjoPCGjK96p6qsP+yQoiLoOBcw==",
      "license": "MIT"
    },
    "node_modules/lodash.uniq": {
      "version": "4.5.0",
      "resolved": "https://registry.npmjs.org/lodash.uniq/-/lodash.uniq-4.5.0.tgz",
      "integrity": "sha512-xfBaXQd9ryd9dlSDvnvI0lvxfLJlYAZzXomUYzLKtUeOQvOP5piqAWuGtrhWeqaXK9hhoM/iyJc5AV+XfsX3HQ==",
      "license": "MIT"
    },
    "node_modules/loose-envify": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/loose-envify/-/loose-envify-1.4.0.tgz",
      "integrity": "sha512-lyuxPGr/Wfhrlem2CL/UcnUc1zcqKAImBDzukY7Y5F/yQiNdko6+fRLevlw1HgMySw7f611UIY408EtxRSoK3Q==",
      "license": "MIT",
      "dependencies": {
        "js-tokens": "^3.0.0 || ^4.0.0"
      },
      "bin": {
        "loose-envify": "cli.js"
      }
    },
    "node_modules/lucide-react": {
      "version": "0.541.0",
      "resolved": "https://registry.npmjs.org/lucide-react/-/lucide-react-0.541.0.tgz",
      "integrity": "sha512-s0Vircsu5WaGv2KoJZ5+SoxiAJ3UXV5KqEM3eIFDHaHkcLIFdIWgXtZ412+Gh02UsdS7Was+jvEpBvPCWQISlg==",
      "license": "ISC",
      "peerDependencies": {
        "react": "^16.5.1 || ^17.0.0 || ^18.0.0 || ^19.0.0"
      }
    },
    "node_modules/magic-string": {
      "version": "0.30.17",
      "resolved": "https://registry.npmjs.org/magic-string/-/magic-string-0.30.17.tgz",
      "integrity": "sha512-sNPKHvyjVf7gyjwS4xGTaW/mCnF8wnjtifKBEhxfZ7E/S8tQ0rssrwGNn6q8JH/ohItJfSQp9mBtQYuTlH5QnA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/sourcemap-codec": "^1.5.0"
      }
    },
    "node_modules/math-intrinsics": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz",
      "integrity": "sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/memoize-one": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/memoize-one/-/memoize-one-6.0.0.tgz",
      "integrity": "sha512-rkpe71W0N0c0Xz6QD0eJETuWAJGnJ9afsl1srmwPrI+yBCkge5EycXXbYRyvL29zZVUWQCY7InPRCv3GDXuZNw==",
      "license": "MIT"
    },
    "node_modules/merge2": {
      "version": "1.4.1",
      "resolved": "https://registry.npmjs.org/merge2/-/merge2-1.4.1.tgz",
      "integrity": "sha512-8q7VEgMJW4J8tcfVPy8g09NcQwZdbwFEqhe/WZkoIzjn/3TGDwtOCYtXGxA3O8tPzpczCCDgv+P2P5y00ZJOOg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/micromatch": {
      "version": "4.0.8",
      "resolved": "https://registry.npmjs.org/micromatch/-/micromatch-4.0.8.tgz",
      "integrity": "sha512-PXwfBhYu0hBCPw8Dn0E+WDYb7af3dSLVWKi3HGv84IdF4TyFoC0ysxFd0Goxw7nSv4T/PzEJQxsYsEiFCKo2BA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "braces": "^3.0.3",
        "picomatch": "^2.3.1"
      },
      "engines": {
        "node": ">=8.6"
      }
    },
    "node_modules/mime-match": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/mime-match/-/mime-match-1.0.2.tgz",
      "integrity": "sha512-VXp/ugGDVh3eCLOBCiHZMYWQaTNUHv2IJrut+yXA6+JbLPXHglHwfS/5A5L0ll+jkCY7fIzRJcH6OIunF+c6Cg==",
      "license": "ISC",
      "dependencies": {
        "wildcard": "^1.1.0"
      }
    },
    "node_modules/minimalistic-assert": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/minimalistic-assert/-/minimalistic-assert-1.0.1.tgz",
      "integrity": "sha512-UtJcAD4yEaGtjPezWuO9wC4nwUnVH/8/Im3yEHQP4b67cXlD/Qr9hdITCU1xDbSEXg2XKNaP8jsReV7vQd00/A==",
      "license": "ISC"
    },
    "node_modules/minimatch": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz",
      "integrity": "sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV/N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==",
      "license": "ISC",
      "dependencies": {
        "brace-expansion": "^1.1.7"
      },
      "engines": {
        "node": "*"
      }
    },
    "node_modules/minimist": {
      "version": "1.2.8",
      "resolved": "https://registry.npmjs.org/minimist/-/minimist-1.2.8.tgz",
      "integrity": "sha512-2yyAR8qBkN3YuheJanUpWC5U3bb5osDywNB8RzDVlDwDHbocAJveqqj1u8+SVD7jkWT4yvsHCpWqqWqAxb0zCA==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/minipass": {
      "version": "7.1.2",
      "resolved": "https://registry.npmjs.org/minipass/-/minipass-7.1.2.tgz",
      "integrity": "sha512-qOOzS1cBTWYF4BH8fVePDBOO9iptMnGUEZwNc/cMWnTV2nVLZ7VoNWEPHkYczZA0pdoA7dl6e7FL659nX9S2aw==",
      "dev": true,
      "license": "ISC",
      "engines": {
        "node": ">=16 || 14 >=14.17"
      }
    },
    "node_modules/minizlib": {
      "version": "3.0.2",
      "resolved": "https://registry.npmjs.org/minizlib/-/minizlib-3.0.2.tgz",
      "integrity": "sha512-oG62iEk+CYt5Xj2YqI5Xi9xWUeZhDI8jjQmC5oThVH5JGCTgIjr7ciJDzC7MBzYd//WvR1OTmP5Q38Q8ShQtVA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "minipass": "^7.1.2"
      },
      "engines": {
        "node": ">= 18"
      }
    },
    "node_modules/mkdirp": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/mkdirp/-/mkdirp-3.0.1.tgz",
      "integrity": "sha512-+NsyUUAZDmo6YVHzL/stxSu3t9YS1iljliy3BSDrXJ/dkn1KYdmtZODGGjLcc9XLgVVpH4KshHB8XmZgMhaBXg==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "mkdirp": "dist/cjs/src/bin.js"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      }
    },
    "node_modules/motion-dom": {
      "version": "12.23.12",
      "resolved": "https://registry.npmjs.org/motion-dom/-/motion-dom-12.23.12.tgz",
      "integrity": "sha512-RcR4fvMCTESQBD/uKQe49D5RUeDOokkGRmz4ceaJKDBgHYtZtntC/s2vLvY38gqGaytinij/yi3hMcWVcEF5Kw==",
      "license": "MIT",
      "dependencies": {
        "motion-utils": "^12.23.6"
      }
    },
    "node_modules/motion-utils": {
      "version": "12.23.6",
      "resolved": "https://registry.npmjs.org/motion-utils/-/motion-utils-12.23.6.tgz",
      "integrity": "sha512-eAWoPgr4eFEOFfg2WjIsMoqJTW6Z8MTUCgn/GZ3VRpClWBdnbjryiA3ZSNLyxCTmCQx4RmYX6jX1iWHbenUPNQ==",
      "license": "MIT"
    },
    "node_modules/ms": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
      "license": "MIT"
    },
    "node_modules/namespace-emitter": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/namespace-emitter/-/namespace-emitter-2.0.1.tgz",
      "integrity": "sha512-N/sMKHniSDJBjfrkbS/tpkPj4RAbvW3mr8UAzvlMHyun93XEm83IAvhWtJVHo+RHn/oO8Job5YN4b+wRjSVp5g==",
      "license": "MIT"
    },
    "node_modules/nanoid": {
      "version": "3.3.11",
      "resolved": "https://registry.npmjs.org/nanoid/-/nanoid-3.3.11.tgz",
      "integrity": "sha512-N8SpfPUnUp1bK+PMYW8qSWdl9U+wwNWI4QKxOYDy9JAro3WMX7p2OeVRF9v+347pnakNevPmiHhNmZ2HbFA76w==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "bin": {
        "nanoid": "bin/nanoid.cjs"
      },
      "engines": {
        "node": "^10 || ^12 || ^13.7 || ^14 || >=15.0.1"
      }
    },
    "node_modules/napi-postinstall": {
      "version": "0.3.3",
      "resolved": "https://registry.npmjs.org/napi-postinstall/-/napi-postinstall-0.3.3.tgz",
      "integrity": "sha512-uTp172LLXSxuSYHv/kou+f6KW3SMppU9ivthaVTXian9sOt3XM/zHYHpRZiLgQoxeWfYUnslNWQHF1+G71xcow==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "napi-postinstall": "lib/cli.js"
      },
      "engines": {
        "node": "^12.20.0 || ^14.18.0 || >=16.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/napi-postinstall"
      }
    },
    "node_modules/natural-compare": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/natural-compare/-/natural-compare-1.4.0.tgz",
      "integrity": "sha512-OWND8ei3VtNC9h7V60qff3SVobHr996CTwgxubgyQYEpg290h9J0buyECNNJexkFm5sOajh5G116RYA1c8ZMSw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/next": {
      "version": "15.4.4",
      "resolved": "https://registry.npmjs.org/next/-/next-15.4.4.tgz",
      "integrity": "sha512-kNcubvJjOL9yUOfwtZF3HfDhuhp+kVD+FM2A6Tyua1eI/xfmY4r/8ZS913MMz+oWKDlbps/dQOWdDricuIkXLw==",
      "license": "MIT",
      "dependencies": {
        "@next/env": "15.4.4",
        "@swc/helpers": "0.5.15",
        "caniuse-lite": "^1.0.30001579",
        "postcss": "8.4.31",
        "styled-jsx": "5.1.6"
      },
      "bin": {
        "next": "dist/bin/next"
      },
      "engines": {
        "node": "^18.18.0 || ^19.8.0 || >= 20.0.0"
      },
      "optionalDependencies": {
        "@next/swc-darwin-arm64": "15.4.4",
        "@next/swc-darwin-x64": "15.4.4",
        "@next/swc-linux-arm64-gnu": "15.4.4",
        "@next/swc-linux-arm64-musl": "15.4.4",
        "@next/swc-linux-x64-gnu": "15.4.4",
        "@next/swc-linux-x64-musl": "15.4.4",
        "@next/swc-win32-arm64-msvc": "15.4.4",
        "@next/swc-win32-x64-msvc": "15.4.4",
        "sharp": "^0.34.3"
      },
      "peerDependencies": {
        "@opentelemetry/api": "^1.1.0",
        "@playwright/test": "^1.51.1",
        "babel-plugin-react-compiler": "*",
        "react": "^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0",
        "react-dom": "^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ^19.0.0",
        "sass": "^1.3.0"
      },
      "peerDependenciesMeta": {
        "@opentelemetry/api": {
          "optional": true
        },
        "@playwright/test": {
          "optional": true
        },
        "babel-plugin-react-compiler": {
          "optional": true
        },
        "sass": {
          "optional": true
        }
      }
    },
    "node_modules/next/node_modules/postcss": {
      "version": "8.4.31",
      "resolved": "https://registry.npmjs.org/postcss/-/postcss-8.4.31.tgz",
      "integrity": "sha512-PS08Iboia9mts/2ygV3eLpY5ghnUcfLV/EXTOW1E2qYxJKGGBUtNjN76FYHnMs36RmARn41bC0AZmn+rR0OVpQ==",
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/postcss/"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/postcss"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "nanoid": "^3.3.6",
        "picocolors": "^1.0.0",
        "source-map-js": "^1.0.2"
      },
      "engines": {
        "node": "^10 || ^12 || >=14"
      }
    },
    "node_modules/node-addon-api": {
      "version": "8.5.0",
      "resolved": "https://registry.npmjs.org/node-addon-api/-/node-addon-api-8.5.0.tgz",
      "integrity": "sha512-/bRZty2mXUIFY/xU5HLvveNHlswNJej+RnxBjOMkidWfwZzgTbPG1E3K5TOxRLOR+5hX7bSofy8yf1hZevMS8A==",
      "license": "MIT",
      "engines": {
        "node": "^18 || ^20 || >= 21"
      }
    },
    "node_modules/node-domexception": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/node-domexception/-/node-domexception-1.0.0.tgz",
      "integrity": "sha512-/jKZoMpw0F8GRwl4/eLROPA3cfcXtLApP0QzLmUT/HuPCZWyB7IY9ZrMeKw2O/nFIqPQB3PVM9aYm0F312AXDQ==",
      "deprecated": "Use your platform's native DOMException instead",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/jimmywarting"
        },
        {
          "type": "github",
          "url": "https://paypal.me/jimmywarting"
        }
      ],
      "license": "MIT",
      "engines": {
        "node": ">=10.5.0"
      }
    },
    "node_modules/node-fetch": {
      "version": "3.3.2",
      "resolved": "https://registry.npmjs.org/node-fetch/-/node-fetch-3.3.2.tgz",
      "integrity": "sha512-dRB78srN/l6gqWulah9SrxeYnxeddIG30+GOqK/9OlLVyLg3HPnr6SqOWTWOXKRwC2eGYCkZ59NNuSgvSrpgOA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "data-uri-to-buffer": "^4.0.0",
        "fetch-blob": "^3.1.4",
        "formdata-polyfill": "^4.0.10"
      },
      "engines": {
        "node": "^12.20.0 || ^14.13.1 || >=16.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/node-fetch"
      }
    },
    "node_modules/node-gyp-build": {
      "version": "4.8.4",
      "resolved": "https://registry.npmjs.org/node-gyp-build/-/node-gyp-build-4.8.4.tgz",
      "integrity": "sha512-LA4ZjwlnUblHVgq0oBF3Jl/6h/Nvs5fzBLwdEF4nuxnFdsfajde4WfxtJr3CaiH+F6ewcIB/q4jQ4UzPyid+CQ==",
      "license": "MIT",
      "bin": {
        "node-gyp-build": "bin.js",
        "node-gyp-build-optional": "optional.js",
        "node-gyp-build-test": "build-test.js"
      }
    },
    "node_modules/normalize-path": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/normalize-path/-/normalize-path-3.0.0.tgz",
      "integrity": "sha512-6eZs5Ls3WtCisHWp9S2GUy8dqkpGi4BVSz3GaqiE6ezub0512ESztXUwUB6C6IKbQkY2Pnb/mD4WYojCRwcwLA==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/npm-normalize-package-bin": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/npm-normalize-package-bin/-/npm-normalize-package-bin-4.0.0.tgz",
      "integrity": "sha512-TZKxPvItzai9kN9H/TkmCtx/ZN/hvr3vUycjlfmH0ootY9yFBzNOpiXAdIn1Iteqsvk4lQn6B5PTrt+n6h8k/w==",
      "dev": true,
      "license": "ISC",
      "engines": {
        "node": "^18.17.0 || >=20.5.0"
      }
    },
    "node_modules/object-assign": {
      "version": "4.1.1",
      "resolved": "https://registry.npmjs.org/object-assign/-/object-assign-4.1.1.tgz",
      "integrity": "sha512-rJgTQnkUnH1sFw8yT6VSU3zD3sWmu6sZhIseY8VX+GRu3P6F7Fu+JNDoXfklElbLJSnc3FUQHVe4cU5hj+BcUg==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/object-inspect": {
      "version": "1.13.4",
      "resolved": "https://registry.npmjs.org/object-inspect/-/object-inspect-1.13.4.tgz",
      "integrity": "sha512-W67iLl4J2EXEGTbfeHCffrjDfitvLANg0UlX3wFUUSTx92KXRFegMHUVgSqE+wvhAbi4WqjGg9czysTV2Epbew==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/object-keys": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/object-keys/-/object-keys-1.1.1.tgz",
      "integrity": "sha512-NuAESUOUMrlIXOfHKzD6bpPu3tYt3xvjNdRIQ+FeT0lNb4K8WR70CaDxhuNguS2XG+GjkyMwOzsN5ZktImfhLA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/object.assign": {
      "version": "4.1.7",
      "resolved": "https://registry.npmjs.org/object.assign/-/object.assign-4.1.7.tgz",
      "integrity": "sha512-nK28WOo+QIjBkDduTINE4JkF/UJJKyf2EJxvJKfblDpyg0Q+pkOHNTL0Qwy6NP6FhE/EnzV73BxxqcJaXY9anw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.3",
        "define-properties": "^1.2.1",
        "es-object-atoms": "^1.0.0",
        "has-symbols": "^1.1.0",
        "object-keys": "^1.1.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/object.entries": {
      "version": "1.1.9",
      "resolved": "https://registry.npmjs.org/object.entries/-/object.entries-1.1.9.tgz",
      "integrity": "sha512-8u/hfXFRBD1O0hPUjioLhoWFHRmt6tKA4/vZPyckBr18l1KE9uHrFaFaUi8MDRTpi4uak2goyPTSNJLXX2k2Hw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.4",
        "define-properties": "^1.2.1",
        "es-object-atoms": "^1.1.1"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/object.fromentries": {
      "version": "2.0.8",
      "resolved": "https://registry.npmjs.org/object.fromentries/-/object.fromentries-2.0.8.tgz",
      "integrity": "sha512-k6E21FzySsSK5a21KRADBd/NGneRegFO5pLHfdQLpRDETUNJueLXs3WCzyQ3tFRDYgbq3KHGXfTbi2bs8WQ6rQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.2",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/object.groupby": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/object.groupby/-/object.groupby-1.0.3.tgz",
      "integrity": "sha512-+Lhy3TQTuzXI5hevh8sBGqbmurHbbIjAi0Z4S63nthVLmLxfbj4T54a4CfZrXIrt9iP4mVAPYMo/v99taj3wjQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/object.values": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/object.values/-/object.values-1.2.1.tgz",
      "integrity": "sha512-gXah6aZrcUxjWg2zR2MwouP2eHlCBzdV4pygudehaKXSGW4v2AsRQUK+lwwXhii6KFZcunEnmSUoYp5CXibxtA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.3",
        "define-properties": "^1.2.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/once": {
      "version": "1.4.0",
      "resolved": "https://registry.npmjs.org/once/-/once-1.4.0.tgz",
      "integrity": "sha512-lNaJgI+2Q5URQBkccEKHTQOPaXdUxnZZElQTZY0MFUAuaEqe1E+Nyvgdz/aIyNi6Z9MzO5dv1H8n58/GELp3+w==",
      "license": "ISC",
      "dependencies": {
        "wrappy": "1"
      }
    },
    "node_modules/optionator": {
      "version": "0.9.4",
      "resolved": "https://registry.npmjs.org/optionator/-/optionator-0.9.4.tgz",
      "integrity": "sha512-6IpQ7mKUxRcZNLIObR0hz7lxsapSSIYNZJwXPGeF0mTVqGKFIXj1DQcMoT22S3ROcLyY/rz0PWaWZ9ayWmad9g==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "deep-is": "^0.1.3",
        "fast-levenshtein": "^2.0.6",
        "levn": "^0.4.1",
        "prelude-ls": "^1.2.1",
        "type-check": "^0.4.0",
        "word-wrap": "^1.2.5"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/own-keys": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/own-keys/-/own-keys-1.0.1.tgz",
      "integrity": "sha512-qFOyK5PjiWZd+QQIh+1jhdb9LpxTF0qs7Pm8o5QHYZ0M3vKqSqzsZaEB6oWlxZ+q2sJBMI/Ktgd2N5ZwQoRHfg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "get-intrinsic": "^1.2.6",
        "object-keys": "^1.1.1",
        "safe-push-apply": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/p-limit": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/p-limit/-/p-limit-3.1.0.tgz",
      "integrity": "sha512-TYOanM3wGwNGsZN2cVTYPArw454xnXj5qmWF1bEoAc4+cU/ol7GVh7odevjp1FNHduHc3KZMcFduxU5Xc6uJRQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "yocto-queue": "^0.1.0"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/p-locate": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/p-locate/-/p-locate-5.0.0.tgz",
      "integrity": "sha512-LaNjtRWUBY++zB5nE/NwcaoMylSPk+S+ZHNB1TzdbMJMny6dynpAGt7X/tl/QYq3TIeE6nxHppbo2LGymrG5Pw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "p-limit": "^3.0.2"
      },
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/p-queue": {
      "version": "8.1.0",
      "resolved": "https://registry.npmjs.org/p-queue/-/p-queue-8.1.0.tgz",
      "integrity": "sha512-mxLDbbGIBEXTJL0zEx8JIylaj3xQ7Z/7eEVjcF9fJX4DBiH9oqe+oahYnlKKxm0Ci9TlWTyhSHgygxMxjIB2jw==",
      "license": "MIT",
      "dependencies": {
        "eventemitter3": "^5.0.1",
        "p-timeout": "^6.1.2"
      },
      "engines": {
        "node": ">=18"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/p-retry": {
      "version": "6.2.1",
      "resolved": "https://registry.npmjs.org/p-retry/-/p-retry-6.2.1.tgz",
      "integrity": "sha512-hEt02O4hUct5wtwg4H4KcWgDdm+l1bOaEy/hWzd8xtXB9BqxTWBBhb+2ImAtH4Cv4rPjV76xN3Zumqk3k3AhhQ==",
      "license": "MIT",
      "dependencies": {
        "@types/retry": "0.12.2",
        "is-network-error": "^1.0.0",
        "retry": "^0.13.1"
      },
      "engines": {
        "node": ">=16.17"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/p-timeout": {
      "version": "6.1.4",
      "resolved": "https://registry.npmjs.org/p-timeout/-/p-timeout-6.1.4.tgz",
      "integrity": "sha512-MyIV3ZA/PmyBN/ud8vV9XzwTrNtR4jFrObymZYnZqMmW0zA8Z17vnT0rBgFE/TlohB+YCHqXMgZzb3Csp49vqg==",
      "license": "MIT",
      "engines": {
        "node": ">=14.16"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/pako": {
      "version": "1.0.11",
      "resolved": "https://registry.npmjs.org/pako/-/pako-1.0.11.tgz",
      "integrity": "sha512-4hLB8Py4zZce5s4yd9XzopqwVv/yGNhV1Bl8NTmCq1763HeK2+EwVTv+leGeL13Dnh2wfbqowVPXCIO0z4taYw==",
      "license": "(MIT AND Zlib)"
    },
    "node_modules/papaparse": {
      "version": "5.5.3",
      "resolved": "https://registry.npmjs.org/papaparse/-/papaparse-5.5.3.tgz",
      "integrity": "sha512-5QvjGxYVjxO59MGU2lHVYpRWBBtKHnlIAcSe1uNFCkkptUh63NFRj0FJQm7nR67puEruUci/ZkjmEFrjCAyP4A==",
      "license": "MIT"
    },
    "node_modules/parent-module": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/parent-module/-/parent-module-1.0.1.tgz",
      "integrity": "sha512-GQ2EWRpQV8/o+Aw8YqtfZZPfNRWZYkbidE9k5rpl/hC3vtHHBfGm2Ifi6qWV+coDGkrUKZAxE3Lot5kcsRlh+g==",
      "license": "MIT",
      "dependencies": {
        "callsites": "^3.0.0"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/parse-json": {
      "version": "5.2.0",
      "resolved": "https://registry.npmjs.org/parse-json/-/parse-json-5.2.0.tgz",
      "integrity": "sha512-ayCKvm/phCGxOkYRSCM82iDwct8/EonSEgCSxWxD7ve6jHggsFl4fZVQBPRNgQoKiuV/odhFrGzQXZwbifC8Rg==",
      "license": "MIT",
      "dependencies": {
        "@babel/code-frame": "^7.0.0",
        "error-ex": "^1.3.1",
        "json-parse-even-better-errors": "^2.3.0",
        "lines-and-columns": "^1.1.6"
      },
      "engines": {
        "node": ">=8"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/path-exists": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/path-exists/-/path-exists-4.0.0.tgz",
      "integrity": "sha512-ak9Qy5Q7jYb2Wwcey5Fpvg2KoAc/ZIhLSLOSBmRmygPsGwkVVt0fZa0qrtMz+m6tJTAHfZQ8FnmB4MG4LWy7/w==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/path-is-absolute": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/path-is-absolute/-/path-is-absolute-1.0.1.tgz",
      "integrity": "sha512-AVbw3UJ2e9bq64vSaS9Am0fje1Pa8pbGqTTsmXfaIiMpnr5DlDhfJOuLj9Sf95ZPVDAUerDfEk88MPmPe7UCQg==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/path-key": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/path-key/-/path-key-3.1.1.tgz",
      "integrity": "sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/path-parse": {
      "version": "1.0.7",
      "resolved": "https://registry.npmjs.org/path-parse/-/path-parse-1.0.7.tgz",
      "integrity": "sha512-LDJzPVEEEPR+y48z93A0Ed0yXb8pAByGWo/k5YYdYgpY2/2EsOsksJrq7lOHxryrVOn1ejG6oAp8ahvOIQD8sw==",
      "license": "MIT"
    },
    "node_modules/path-type": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/path-type/-/path-type-4.0.0.tgz",
      "integrity": "sha512-gDKb8aZMDeD/tZWs9P6+q0J9Mwkdl6xMV8TjnGP3qJVJ06bdMgkbBlLU8IdfOsIsFz2BW1rNVT3XuNEl8zPAvw==",
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/pg": {
      "version": "8.16.3",
      "resolved": "https://registry.npmjs.org/pg/-/pg-8.16.3.tgz",
      "integrity": "sha512-enxc1h0jA/aq5oSDMvqyW3q89ra6XIIDZgCX9vkMrnz5DFTw/Ny3Li2lFQ+pt3L6MCgm/5o2o8HW9hiJji+xvw==",
      "license": "MIT",
      "dependencies": {
        "pg-connection-string": "^2.9.1",
        "pg-pool": "^3.10.1",
        "pg-protocol": "^1.10.3",
        "pg-types": "2.2.0",
        "pgpass": "1.0.5"
      },
      "engines": {
        "node": ">= 16.0.0"
      },
      "optionalDependencies": {
        "pg-cloudflare": "^1.2.7"
      },
      "peerDependencies": {
        "pg-native": ">=3.0.1"
      },
      "peerDependenciesMeta": {
        "pg-native": {
          "optional": true
        }
      }
    },
    "node_modules/pg-cloudflare": {
      "version": "1.2.7",
      "resolved": "https://registry.npmjs.org/pg-cloudflare/-/pg-cloudflare-1.2.7.tgz",
      "integrity": "sha512-YgCtzMH0ptvZJslLM1ffsY4EuGaU0cx4XSdXLRFae8bPP4dS5xL1tNB3k2o/N64cHJpwU7dxKli/nZ2lUa5fLg==",
      "license": "MIT",
      "optional": true
    },
    "node_modules/pg-connection-string": {
      "version": "2.9.1",
      "resolved": "https://registry.npmjs.org/pg-connection-string/-/pg-connection-string-2.9.1.tgz",
      "integrity": "sha512-nkc6NpDcvPVpZXxrreI/FOtX3XemeLl8E0qFr6F2Lrm/I8WOnaWNhIPK2Z7OHpw7gh5XJThi6j6ppgNoaT1w4w==",
      "license": "MIT"
    },
    "node_modules/pg-int8": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/pg-int8/-/pg-int8-1.0.1.tgz",
      "integrity": "sha512-WCtabS6t3c8SkpDBUlb1kjOs7l66xsGdKpIPZsg4wR+B3+u9UAum2odSsF9tnvxg80h4ZxLWMy4pRjOsFIqQpw==",
      "license": "ISC",
      "engines": {
        "node": ">=4.0.0"
      }
    },
    "node_modules/pg-pool": {
      "version": "3.10.1",
      "resolved": "https://registry.npmjs.org/pg-pool/-/pg-pool-3.10.1.tgz",
      "integrity": "sha512-Tu8jMlcX+9d8+QVzKIvM/uJtp07PKr82IUOYEphaWcoBhIYkoHpLXN3qO59nAI11ripznDsEzEv8nUxBVWajGg==",
      "license": "MIT",
      "peerDependencies": {
        "pg": ">=8.0"
      }
    },
    "node_modules/pg-protocol": {
      "version": "1.10.3",
      "resolved": "https://registry.npmjs.org/pg-protocol/-/pg-protocol-1.10.3.tgz",
      "integrity": "sha512-6DIBgBQaTKDJyxnXaLiLR8wBpQQcGWuAESkRBX/t6OwA8YsqP+iVSiond2EDy6Y/dsGk8rh/jtax3js5NeV7JQ==",
      "license": "MIT"
    },
    "node_modules/pg-types": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/pg-types/-/pg-types-2.2.0.tgz",
      "integrity": "sha512-qTAAlrEsl8s4OiEQY69wDvcMIdQN6wdz5ojQiOy6YRMuynxenON0O5oCpJI6lshc6scgAY8qvJ2On/p+CXY0GA==",
      "license": "MIT",
      "dependencies": {
        "pg-int8": "1.0.1",
        "postgres-array": "~2.0.0",
        "postgres-bytea": "~1.0.0",
        "postgres-date": "~1.0.4",
        "postgres-interval": "^1.1.0"
      },
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/pgpass": {
      "version": "1.0.5",
      "resolved": "https://registry.npmjs.org/pgpass/-/pgpass-1.0.5.tgz",
      "integrity": "sha512-FdW9r/jQZhSeohs1Z3sI1yxFQNFvMcnmfuj4WBMUTxOrAyLMaTcE1aAMBiTlbMNaXvBCQuVi0R7hd8udDSP7ug==",
      "license": "MIT",
      "dependencies": {
        "split2": "^4.1.0"
      }
    },
    "node_modules/picocolors": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/picocolors/-/picocolors-1.1.1.tgz",
      "integrity": "sha512-xceH2snhtb5M9liqDsmEw56le376mTZkEX/jEb/RxNFyegNul7eNslCXP9FDj/Lcu0X8KEyMceP2ntpaHrDEVA==",
      "license": "ISC"
    },
    "node_modules/picomatch": {
      "version": "2.3.1",
      "resolved": "https://registry.npmjs.org/picomatch/-/picomatch-2.3.1.tgz",
      "integrity": "sha512-JU3teHTNjmE2VCGFzuY8EXzCDVwEqB2a8fsIvwaStHhAWJEeVd1o1QD80CU6+ZdEXXSLbSsuLwJjkCBWqRQUVA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8.6"
      },
      "funding": {
        "url": "https://github.com/sponsors/jonschlinkert"
      }
    },
    "node_modules/possible-typed-array-names": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/possible-typed-array-names/-/possible-typed-array-names-1.1.0.tgz",
      "integrity": "sha512-/+5VFTchJDoVj3bhoqi6UeymcD00DAwb1nJwamzPvHEszJ4FpF6SNNbUbOS8yI56qHzdV8eK0qEfOSiodkTdxg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/postcss": {
      "version": "8.5.6",
      "resolved": "https://registry.npmjs.org/postcss/-/postcss-8.5.6.tgz",
      "integrity": "sha512-3Ybi1tAuwAP9s0r1UQ2J4n5Y0G05bJkpUIO0/bI9MhwmD70S5aTWbXGBwxHrelT+XM1k6dM0pk+SwNkpTRN7Pg==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/postcss/"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/postcss"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "nanoid": "^3.3.11",
        "picocolors": "^1.1.1",
        "source-map-js": "^1.2.1"
      },
      "engines": {
        "node": "^10 || ^12 || >=14"
      }
    },
    "node_modules/postgres-array": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/postgres-array/-/postgres-array-2.0.0.tgz",
      "integrity": "sha512-VpZrUqU5A69eQyW2c5CA1jtLecCsN2U/bD6VilrFDWq5+5UIEVO7nazS3TEcHf1zuPYO/sqGvUvW62g86RXZuA==",
      "license": "MIT",
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/postgres-bytea": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/postgres-bytea/-/postgres-bytea-1.0.0.tgz",
      "integrity": "sha512-xy3pmLuQqRBZBXDULy7KbaitYqLcmxigw14Q5sj8QBVLqEwXfeybIKVWiqAXTlcvdvb0+xkOtDbfQMOf4lST1w==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/postgres-date": {
      "version": "1.0.7",
      "resolved": "https://registry.npmjs.org/postgres-date/-/postgres-date-1.0.7.tgz",
      "integrity": "sha512-suDmjLVQg78nMK2UZ454hAG+OAW+HQPZ6n++TNDUX+L0+uUlLywnoxJKDou51Zm+zTCjrCl0Nq6J9C5hP9vK/Q==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/postgres-interval": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/postgres-interval/-/postgres-interval-1.2.0.tgz",
      "integrity": "sha512-9ZhXKM/rw350N1ovuWHbGxnGh/SNJ4cnxHiM0rxE4VN41wsg8P8zWn9hv/buK00RP4WvlOyr/RBDiptyxVbkZQ==",
      "license": "MIT",
      "dependencies": {
        "xtend": "^4.0.0"
      },
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/preact": {
      "version": "10.27.1",
      "resolved": "https://registry.npmjs.org/preact/-/preact-10.27.1.tgz",
      "integrity": "sha512-V79raXEWch/rbqoNc7nT9E4ep7lu+mI3+sBmfRD4i1M73R3WLYcCtdI0ibxGVf4eQL8ZIz2nFacqEC+rmnOORQ==",
      "license": "MIT",
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/preact"
      }
    },
    "node_modules/prelude-ls": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/prelude-ls/-/prelude-ls-1.2.1.tgz",
      "integrity": "sha512-vkcDPrRZo1QZLbn5RLGPpg/WmIQ65qoWWhcGKf/b5eplkkarX0m9z8ppCat4mlOqUsWpyNuYgO3VRyrYHSzX5g==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/pretty-bytes": {
      "version": "6.1.1",
      "resolved": "https://registry.npmjs.org/pretty-bytes/-/pretty-bytes-6.1.1.tgz",
      "integrity": "sha512-mQUvGU6aUFQ+rNvTIAcZuWGRT9a6f6Yrg9bHs4ImKF+HZCEK+plBvnAZYSIQztknZF2qnzNtr6F8s0+IuptdlQ==",
      "license": "MIT",
      "engines": {
        "node": "^14.13.1 || >=16.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/prism-react-renderer": {
      "version": "2.4.1",
      "resolved": "https://registry.npmjs.org/prism-react-renderer/-/prism-react-renderer-2.4.1.tgz",
      "integrity": "sha512-ey8Ls/+Di31eqzUxC46h8MksNuGx/n0AAC8uKpwFau4RPDYLuE3EXTp8N8G2vX2N7UC/+IXeNUnlWBGGcAG+Ig==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@types/prismjs": "^1.26.0",
        "clsx": "^2.0.0"
      },
      "peerDependencies": {
        "react": ">=16.0.0"
      }
    },
    "node_modules/proc-log": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/proc-log/-/proc-log-5.0.0.tgz",
      "integrity": "sha512-Azwzvl90HaF0aCz1JrDdXQykFakSSNPaPoiZ9fm5qJIMHioDZEi7OAdRwSm6rSoPtY3Qutnm3L7ogmg3dc+wbQ==",
      "dev": true,
      "license": "ISC",
      "engines": {
        "node": "^18.17.0 || >=20.5.0"
      }
    },
    "node_modules/process-nextick-args": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/process-nextick-args/-/process-nextick-args-2.0.1.tgz",
      "integrity": "sha512-3ouUOpQhtgrbOa17J7+uxOTpITYWaGP7/AhoR3+A+/1e9skrzelGi/dXzEYyvbxubEF6Wn2ypscTKiKJFFn1ag==",
      "license": "MIT"
    },
    "node_modules/prop-types": {
      "version": "15.8.1",
      "resolved": "https://registry.npmjs.org/prop-types/-/prop-types-15.8.1.tgz",
      "integrity": "sha512-oj87CgZICdulUohogVAR7AjlC0327U4el4L6eAvOqCeudMDVU0NThNaV+b9Df4dXgSP1gXMTnPdhfe/2qDH5cg==",
      "license": "MIT",
      "dependencies": {
        "loose-envify": "^1.4.0",
        "object-assign": "^4.1.1",
        "react-is": "^16.13.1"
      }
    },
    "node_modules/punycode": {
      "version": "2.3.1",
      "resolved": "https://registry.npmjs.org/punycode/-/punycode-2.3.1.tgz",
      "integrity": "sha512-vYt7UD1U9Wg6138shLtLOvdAu+8DsC/ilFtEVHcH+wydcSpNE20AfSOduf6MkRFahL5FY7X1oU7nKVZFtfq8Fg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/queue-microtask": {
      "version": "1.2.3",
      "resolved": "https://registry.npmjs.org/queue-microtask/-/queue-microtask-1.2.3.tgz",
      "integrity": "sha512-NuaNSa6flKT5JaSYQzJok04JzTL1CA6aGhv5rfLW3PgqA+M2ChpZQnAC8h8i4ZFkBS8X5RqkDBHA7r4hej3K9A==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT"
    },
    "node_modules/react": {
      "version": "19.1.0",
      "resolved": "https://registry.npmjs.org/react/-/react-19.1.0.tgz",
      "integrity": "sha512-FS+XFBNvn3GTAWq26joslQgWNoFu08F4kl0J4CgdNKADkdSGXQyTCnKteIAJy96Br6YbpEU1LSzV5dYtjMkMDg==",
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/react-datepicker": {
      "version": "8.7.0",
      "resolved": "https://registry.npmjs.org/react-datepicker/-/react-datepicker-8.7.0.tgz",
      "integrity": "sha512-r5OJbiLWc3YiVNy69Kau07/aVgVGsFVMA6+nlqCV7vyQ8q0FUOnJ+wAI4CgVxHejG3i5djAEiebrF8/Eip4rIw==",
      "license": "MIT",
      "dependencies": {
        "@floating-ui/react": "^0.27.15",
        "clsx": "^2.1.1",
        "date-fns": "^4.1.0"
      },
      "peerDependencies": {
        "react": "^16.9.0 || ^17 || ^18 || ^19 || ^19.0.0-rc",
        "react-dom": "^16.9.0 || ^17 || ^18 || ^19 || ^19.0.0-rc"
      }
    },
    "node_modules/react-dom": {
      "version": "19.1.0",
      "resolved": "https://registry.npmjs.org/react-dom/-/react-dom-19.1.0.tgz",
      "integrity": "sha512-Xs1hdnE+DyKgeHJeJznQmYMIBG3TKIHJJT95Q58nHLSrElKlGQqDTR2HQ9fx5CN/Gk6Vh/kupBTDLU11/nDk/g==",
      "license": "MIT",
      "dependencies": {
        "scheduler": "^0.26.0"
      },
      "peerDependencies": {
        "react": "^19.1.0"
      }
    },
    "node_modules/react-hook-form": {
      "version": "7.62.0",
      "resolved": "https://registry.npmjs.org/react-hook-form/-/react-hook-form-7.62.0.tgz",
      "integrity": "sha512-7KWFejc98xqG/F4bAxpL41NB3o1nnvQO1RWZT3TqRZYL8RryQETGfEdVnJN2fy1crCiBLLjkRBVK05j24FxJGA==",
      "license": "MIT",
      "engines": {
        "node": ">=18.0.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/react-hook-form"
      },
      "peerDependencies": {
        "react": "^16.8.0 || ^17 || ^18 || ^19"
      }
    },
    "node_modules/react-icons": {
      "version": "5.5.0",
      "resolved": "https://registry.npmjs.org/react-icons/-/react-icons-5.5.0.tgz",
      "integrity": "sha512-MEFcXdkP3dLo8uumGI5xN3lDFNsRtrjbOEKDLD7yv76v4wpnEq2Lt2qeHaQOr34I/wPN3s3+N08WkQ+CW37Xiw==",
      "license": "MIT",
      "peerDependencies": {
        "react": "*"
      }
    },
    "node_modules/react-is": {
      "version": "16.13.1",
      "resolved": "https://registry.npmjs.org/react-is/-/react-is-16.13.1.tgz",
      "integrity": "sha512-24e6ynE2H+OKt4kqsOvNd8kBpV65zoxbA4BVsEOB3ARVWQki/DHzaUoC5KuON/BiccDaCCTZBuOcfZs70kR8bQ==",
      "license": "MIT"
    },
    "node_modules/react-remove-scroll": {
      "version": "2.7.1",
      "resolved": "https://registry.npmjs.org/react-remove-scroll/-/react-remove-scroll-2.7.1.tgz",
      "integrity": "sha512-HpMh8+oahmIdOuS5aFKKY6Pyog+FNaZV/XyJOq7b4YFwsFHe5yYfdbIalI4k3vU2nSDql7YskmUseHsRrJqIPA==",
      "license": "MIT",
      "dependencies": {
        "react-remove-scroll-bar": "^2.3.7",
        "react-style-singleton": "^2.2.3",
        "tslib": "^2.1.0",
        "use-callback-ref": "^1.3.3",
        "use-sidecar": "^1.1.3"
      },
      "engines": {
        "node": ">=10"
      },
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/react-remove-scroll-bar": {
      "version": "2.3.8",
      "resolved": "https://registry.npmjs.org/react-remove-scroll-bar/-/react-remove-scroll-bar-2.3.8.tgz",
      "integrity": "sha512-9r+yi9+mgU33AKcj6IbT9oRCO78WriSj6t/cF8DWBZJ9aOGPOTEDvdUDz1FwKim7QXWwmHqtdHnRJfhAxEG46Q==",
      "license": "MIT",
      "dependencies": {
        "react-style-singleton": "^2.2.2",
        "tslib": "^2.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/react-select": {
      "version": "5.10.2",
      "resolved": "https://registry.npmjs.org/react-select/-/react-select-5.10.2.tgz",
      "integrity": "sha512-Z33nHdEFWq9tfnfVXaiM12rbJmk+QjFEztWLtmXqQhz6Al4UZZ9xc0wiatmGtUOCCnHN0WizL3tCMYRENX4rVQ==",
      "license": "MIT",
      "dependencies": {
        "@babel/runtime": "^7.12.0",
        "@emotion/cache": "^11.4.0",
        "@emotion/react": "^11.8.1",
        "@floating-ui/dom": "^1.0.1",
        "@types/react-transition-group": "^4.4.0",
        "memoize-one": "^6.0.0",
        "prop-types": "^15.6.0",
        "react-transition-group": "^4.3.0",
        "use-isomorphic-layout-effect": "^1.2.0"
      },
      "peerDependencies": {
        "react": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0",
        "react-dom": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0"
      }
    },
    "node_modules/react-style-singleton": {
      "version": "2.2.3",
      "resolved": "https://registry.npmjs.org/react-style-singleton/-/react-style-singleton-2.2.3.tgz",
      "integrity": "sha512-b6jSvxvVnyptAiLjbkWLE/lOnR4lfTtDAl+eUC7RZy+QQWc6wRzIV2CE6xBuMmDxc2qIihtDCZD5NPOFl7fRBQ==",
      "license": "MIT",
      "dependencies": {
        "get-nonce": "^1.0.0",
        "tslib": "^2.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/react-transition-group": {
      "version": "4.4.5",
      "resolved": "https://registry.npmjs.org/react-transition-group/-/react-transition-group-4.4.5.tgz",
      "integrity": "sha512-pZcd1MCJoiKiBR2NRxeCRg13uCXbydPnmB4EOeRrY7480qNWO8IIgQG6zlDkm6uRMsURXPuKq0GWtiM59a5Q6g==",
      "license": "BSD-3-Clause",
      "dependencies": {
        "@babel/runtime": "^7.5.5",
        "dom-helpers": "^5.0.1",
        "loose-envify": "^1.4.0",
        "prop-types": "^15.6.2"
      },
      "peerDependencies": {
        "react": ">=16.6.0",
        "react-dom": ">=16.6.0"
      }
    },
    "node_modules/read-cmd-shim": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/read-cmd-shim/-/read-cmd-shim-5.0.0.tgz",
      "integrity": "sha512-SEbJV7tohp3DAAILbEMPXavBjAnMN0tVnh4+9G8ihV4Pq3HYF9h8QNez9zkJ1ILkv9G2BjdzwctznGZXgu/HGw==",
      "dev": true,
      "license": "ISC",
      "engines": {
        "node": "^18.17.0 || >=20.5.0"
      }
    },
    "node_modules/readable-stream": {
      "version": "3.6.2",
      "resolved": "https://registry.npmjs.org/readable-stream/-/readable-stream-3.6.2.tgz",
      "integrity": "sha512-9u/sniCrY3D5WdsERHzHE4G2YCXqoG5FTHUiCC4SIbr6XcLZBY05ya9EKjYek9O5xOAwjGq+1JdGBAS7Q9ScoA==",
      "license": "MIT",
      "dependencies": {
        "inherits": "^2.0.3",
        "string_decoder": "^1.1.1",
        "util-deprecate": "^1.0.1"
      },
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/readdir-glob": {
      "version": "1.1.3",
      "resolved": "https://registry.npmjs.org/readdir-glob/-/readdir-glob-1.1.3.tgz",
      "integrity": "sha512-v05I2k7xN8zXvPD9N+z/uhXPaj0sUFCe2rcWZIpBsqxfP7xXFQ0tipAd/wjj1YxWyWtUS5IDJpOG82JKt2EAVA==",
      "license": "Apache-2.0",
      "dependencies": {
        "minimatch": "^5.1.0"
      }
    },
    "node_modules/readdir-glob/node_modules/brace-expansion": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/brace-expansion/-/brace-expansion-2.0.2.tgz",
      "integrity": "sha512-Jt0vHyM+jmUBqojB7E1NIYadt0vI0Qxjxd2TErW94wDz+E2LAm5vKMXXwg6ZZBTHPuUlDgQHKXvjGBdfcF1ZDQ==",
      "license": "MIT",
      "dependencies": {
        "balanced-match": "^1.0.0"
      }
    },
    "node_modules/readdir-glob/node_modules/minimatch": {
      "version": "5.1.6",
      "resolved": "https://registry.npmjs.org/minimatch/-/minimatch-5.1.6.tgz",
      "integrity": "sha512-lKwV/1brpG6mBUFHtb7NUmtABCb2WZZmm2wNiOA5hAb8VdCS4B3dtMWyvcoViccwAW/COERjXLt0zP1zXUN26g==",
      "license": "ISC",
      "dependencies": {
        "brace-expansion": "^2.0.1"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/reflect.getprototypeof": {
      "version": "1.0.10",
      "resolved": "https://registry.npmjs.org/reflect.getprototypeof/-/reflect.getprototypeof-1.0.10.tgz",
      "integrity": "sha512-00o4I+DVrefhv+nX0ulyi3biSHCPDe+yLv5o/p6d/UVlirijB8E16FtfwSAi4g3tcqrQ4lRAqQSoFEZJehYEcw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.9",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.0.0",
        "get-intrinsic": "^1.2.7",
        "get-proto": "^1.0.1",
        "which-builtin-type": "^1.2.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/regenerator-runtime": {
      "version": "0.14.1",
      "resolved": "https://registry.npmjs.org/regenerator-runtime/-/regenerator-runtime-0.14.1.tgz",
      "integrity": "sha512-dYnhHh0nJoMfnkZs6GmmhFknAGRrLznOu5nc9ML+EJxGvrx6H7teuevqVqCuPcPK//3eDrrjQhehXVx9cnkGdw==",
      "license": "MIT"
    },
    "node_modules/regexp.prototype.flags": {
      "version": "1.5.4",
      "resolved": "https://registry.npmjs.org/regexp.prototype.flags/-/regexp.prototype.flags-1.5.4.tgz",
      "integrity": "sha512-dYqgNSZbDwkaJ2ceRd9ojCGjBq+mOm9LmtXnAnEGyHhN/5R7iDW2TRw3h+o/jCFxus3P2LfWIIiwowAjANm7IA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "define-properties": "^1.2.1",
        "es-errors": "^1.3.0",
        "get-proto": "^1.0.1",
        "gopd": "^1.2.0",
        "set-function-name": "^2.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/resolve": {
      "version": "1.22.10",
      "resolved": "https://registry.npmjs.org/resolve/-/resolve-1.22.10.tgz",
      "integrity": "sha512-NPRy+/ncIMeDlTAsuqwKIiferiawhefFJtkNSW0qZJEqMEb+qBt/77B/jGeeek+F0uOeN05CDa6HXbbIgtVX4w==",
      "license": "MIT",
      "dependencies": {
        "is-core-module": "^2.16.0",
        "path-parse": "^1.0.7",
        "supports-preserve-symlinks-flag": "^1.0.0"
      },
      "bin": {
        "resolve": "bin/resolve"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/resolve-from": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/resolve-from/-/resolve-from-4.0.0.tgz",
      "integrity": "sha512-pb/MYmXstAkysRFx8piNI1tGFNQIFA3vkE3Gq4EuA1dF6gHp/+vgZqsCGJapvy8N3Q+4o7FwvquPJcnZ7RYy4g==",
      "license": "MIT",
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/resolve-pkg-maps": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/resolve-pkg-maps/-/resolve-pkg-maps-1.0.0.tgz",
      "integrity": "sha512-seS2Tj26TBVOC2NIc2rOe2y2ZO7efxITtLZcGSOnHHNOQ7CkiUBfw0Iw2ck6xkIhPwLhKNLS8BO+hEpngQlqzw==",
      "dev": true,
      "license": "MIT",
      "funding": {
        "url": "https://github.com/privatenumber/resolve-pkg-maps?sponsor=1"
      }
    },
    "node_modules/retry": {
      "version": "0.13.1",
      "resolved": "https://registry.npmjs.org/retry/-/retry-0.13.1.tgz",
      "integrity": "sha512-XQBQ3I8W1Cge0Seh+6gjj03LbmRFWuoszgK9ooCpwYIrhhoO80pfq4cUkU5DkknwfOfFteRwlZ56PYOGYyFWdg==",
      "license": "MIT",
      "engines": {
        "node": ">= 4"
      }
    },
    "node_modules/reusify": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/reusify/-/reusify-1.1.0.tgz",
      "integrity": "sha512-g6QUff04oZpHs0eG5p83rFLhHeV00ug/Yf9nZM6fLeUrPguBTkTQOdpAWWspMh55TZfVQDPaN3NQJfbVRAxdIw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "iojs": ">=1.0.0",
        "node": ">=0.10.0"
      }
    },
    "node_modules/rimraf": {
      "version": "2.7.1",
      "resolved": "https://registry.npmjs.org/rimraf/-/rimraf-2.7.1.tgz",
      "integrity": "sha512-uWjbaKIK3T1OSVptzX7Nl6PvQ3qAGtKEtVRjRuazjfL3Bx5eI409VZSqgND+4UNnmzLVdPj9FqFJNPqBZFve4w==",
      "deprecated": "Rimraf versions prior to v4 are no longer supported",
      "license": "ISC",
      "dependencies": {
        "glob": "^7.1.3"
      },
      "bin": {
        "rimraf": "bin.js"
      }
    },
    "node_modules/run-parallel": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/run-parallel/-/run-parallel-1.2.0.tgz",
      "integrity": "sha512-5l4VyZR86LZ/lDxZTR6jqL8AFE2S0IFLMP26AbjsLVADxHdhB/c0GUsH+y39UfCi3dzz8OlQuPmnaJOMoDHQBA==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "queue-microtask": "^1.2.2"
      }
    },
    "node_modules/safe-array-concat": {
      "version": "1.1.3",
      "resolved": "https://registry.npmjs.org/safe-array-concat/-/safe-array-concat-1.1.3.tgz",
      "integrity": "sha512-AURm5f0jYEOydBj7VQlVvDrjeFgthDdEF5H1dP+6mNpoXOMo1quQqJ4wvJDyRZ9+pO3kGWoOdmV08cSv2aJV6Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.2",
        "get-intrinsic": "^1.2.6",
        "has-symbols": "^1.1.0",
        "isarray": "^2.0.5"
      },
      "engines": {
        "node": ">=0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/safe-buffer": {
      "version": "5.2.1",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.2.1.tgz",
      "integrity": "sha512-rp3So07KcdmmKbGvgaNxQSJr7bGVSVk5S9Eq1F+ppbRo70+YeaDxkw5Dd8NPN+GD6bjnYm2VuPuCXmpuYvmCXQ==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT"
    },
    "node_modules/safe-push-apply": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/safe-push-apply/-/safe-push-apply-1.0.0.tgz",
      "integrity": "sha512-iKE9w/Z7xCzUMIZqdBsp6pEQvwuEebH4vdpjcDWnyzaI6yl6O9FHvVpmGelvEHNsoY6wGblkxR6Zty/h00WiSA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "isarray": "^2.0.5"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/safe-regex-test": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/safe-regex-test/-/safe-regex-test-1.1.0.tgz",
      "integrity": "sha512-x/+Cz4YrimQxQccJf5mKEbIa1NzeCRNI5Ecl/ekmlYaampdNLPalVyIcCZNNH3MvmqBugV5TMYZXv0ljslUlaw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "is-regex": "^1.2.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/safer-buffer": {
      "version": "2.1.2",
      "resolved": "https://registry.npmjs.org/safer-buffer/-/safer-buffer-2.1.2.tgz",
      "integrity": "sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==",
      "license": "MIT"
    },
    "node_modules/saxes": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/saxes/-/saxes-5.0.1.tgz",
      "integrity": "sha512-5LBh1Tls8c9xgGjw3QrMwETmTMVk0oFgvrFSvWx62llR2hcEInrKNZ2GZCCuuy2lvWrdl5jhbpeqc5hRYKFOcw==",
      "license": "ISC",
      "dependencies": {
        "xmlchars": "^2.2.0"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/scheduler": {
      "version": "0.26.0",
      "resolved": "https://registry.npmjs.org/scheduler/-/scheduler-0.26.0.tgz",
      "integrity": "sha512-NlHwttCI/l5gCPR3D1nNXtWABUmBwvZpEQiD4IXSbIDq8BzLIK/7Ir5gTFSGZDUu37K5cMNp0hFtzO38sC7gWA==",
      "license": "MIT"
    },
    "node_modules/semver": {
      "version": "7.7.2",
      "resolved": "https://registry.npmjs.org/semver/-/semver-7.7.2.tgz",
      "integrity": "sha512-RF0Fw+rO5AMf9MAyaRXI4AV0Ulj5lMHqVxxdSgiVbixSCXoEmmX/jk0CuJw4+3SqroYO9VoUh+HcuJivvtJemA==",
      "devOptional": true,
      "license": "ISC",
      "bin": {
        "semver": "bin/semver.js"
      },
      "engines": {
        "node": ">=10"
      }
    },
    "node_modules/set-function-length": {
      "version": "1.2.2",
      "resolved": "https://registry.npmjs.org/set-function-length/-/set-function-length-1.2.2.tgz",
      "integrity": "sha512-pgRc4hJ4/sNjWCSS9AmnS40x3bNMDTknHgL5UaMBTMyJnU90EgWh1Rz+MC9eFu4BuN/UwZjKQuY/1v3rM7HMfg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "define-data-property": "^1.1.4",
        "es-errors": "^1.3.0",
        "function-bind": "^1.1.2",
        "get-intrinsic": "^1.2.4",
        "gopd": "^1.0.1",
        "has-property-descriptors": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/set-function-name": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/set-function-name/-/set-function-name-2.0.2.tgz",
      "integrity": "sha512-7PGFlmtwsEADb0WYyvCMa1t+yke6daIG4Wirafur5kcf+MhUnPms1UeR0CKQdTZD81yESwMHbtn+TR+dMviakQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "define-data-property": "^1.1.4",
        "es-errors": "^1.3.0",
        "functions-have-names": "^1.2.3",
        "has-property-descriptors": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/set-proto": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/set-proto/-/set-proto-1.0.0.tgz",
      "integrity": "sha512-RJRdvCo6IAnPdsvP/7m6bsQqNnn1FCBX5ZNtFL98MmFF/4xAIJTIg1YbHW5DC2W5SKZanrC6i4HsJqlajw/dZw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "dunder-proto": "^1.0.1",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/setimmediate": {
      "version": "1.0.5",
      "resolved": "https://registry.npmjs.org/setimmediate/-/setimmediate-1.0.5.tgz",
      "integrity": "sha512-MATJdZp8sLqDl/68LfQmbP8zKPLQNV6BIZoIgrscFDQ+RsvK/BxeDQOgyxKKoh0y/8h3BqVFnCqQ/gd+reiIXA==",
      "license": "MIT"
    },
    "node_modules/shallow-equal": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/shallow-equal/-/shallow-equal-3.1.0.tgz",
      "integrity": "sha512-pfVOw8QZIXpMbhBWvzBISicvToTiM5WBF1EeAUZDDSb5Dt29yl4AYbyywbJFSEsRUMr7gJaxqCdr4L3tQf9wVg==",
      "license": "MIT"
    },
    "node_modules/sharp": {
      "version": "0.34.3",
      "resolved": "https://registry.npmjs.org/sharp/-/sharp-0.34.3.tgz",
      "integrity": "sha512-eX2IQ6nFohW4DbvHIOLRB3MHFpYqaqvXd3Tp5e/T/dSH83fxaNJQRvDMhASmkNTsNTVF2/OOopzRCt7xokgPfg==",
      "hasInstallScript": true,
      "license": "Apache-2.0",
      "optional": true,
      "dependencies": {
        "color": "^4.2.3",
        "detect-libc": "^2.0.4",
        "semver": "^7.7.2"
      },
      "engines": {
        "node": "^18.17.0 || ^20.3.0 || >=21.0.0"
      },
      "funding": {
        "url": "https://opencollective.com/libvips"
      },
      "optionalDependencies": {
        "@img/sharp-darwin-arm64": "0.34.3",
        "@img/sharp-darwin-x64": "0.34.3",
        "@img/sharp-libvips-darwin-arm64": "1.2.0",
        "@img/sharp-libvips-darwin-x64": "1.2.0",
        "@img/sharp-libvips-linux-arm": "1.2.0",
        "@img/sharp-libvips-linux-arm64": "1.2.0",
        "@img/sharp-libvips-linux-ppc64": "1.2.0",
        "@img/sharp-libvips-linux-s390x": "1.2.0",
        "@img/sharp-libvips-linux-x64": "1.2.0",
        "@img/sharp-libvips-linuxmusl-arm64": "1.2.0",
        "@img/sharp-libvips-linuxmusl-x64": "1.2.0",
        "@img/sharp-linux-arm": "0.34.3",
        "@img/sharp-linux-arm64": "0.34.3",
        "@img/sharp-linux-ppc64": "0.34.3",
        "@img/sharp-linux-s390x": "0.34.3",
        "@img/sharp-linux-x64": "0.34.3",
        "@img/sharp-linuxmusl-arm64": "0.34.3",
        "@img/sharp-linuxmusl-x64": "0.34.3",
        "@img/sharp-wasm32": "0.34.3",
        "@img/sharp-win32-arm64": "0.34.3",
        "@img/sharp-win32-ia32": "0.34.3",
        "@img/sharp-win32-x64": "0.34.3"
      }
    },
    "node_modules/shebang-command": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/shebang-command/-/shebang-command-2.0.0.tgz",
      "integrity": "sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "shebang-regex": "^3.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/shebang-regex": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/shebang-regex/-/shebang-regex-3.0.0.tgz",
      "integrity": "sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/side-channel": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/side-channel/-/side-channel-1.1.0.tgz",
      "integrity": "sha512-ZX99e6tRweoUXqR+VBrslhda51Nh5MTQwou5tnUDgbtyM0dBgmhEDtWGP/xbKn6hqfPRHujUNwz5fy/wbbhnpw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3",
        "side-channel-list": "^1.0.0",
        "side-channel-map": "^1.0.1",
        "side-channel-weakmap": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-list": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/side-channel-list/-/side-channel-list-1.0.0.tgz",
      "integrity": "sha512-FCLHtRD/gnpCiCHEiJLOwdmFP+wzCmDEkc9y7NsYxeF4u7Btsn1ZuwgwJGxImImHicJArLP4R0yX4c2KCrMrTA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-map": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/side-channel-map/-/side-channel-map-1.0.1.tgz",
      "integrity": "sha512-VCjCNfgMsby3tTdo02nbjtM/ewra6jPHmpThenkTYh8pG9ucZ/1P8So4u4FGBek/BjpOVsDCMoLA/iuBKIFXRA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-weakmap": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/side-channel-weakmap/-/side-channel-weakmap-1.0.2.tgz",
      "integrity": "sha512-WPS/HvHQTYnHisLo9McqBHOJk2FkHO/tlpvldyrnem4aeQp4hai3gythswg6p01oSoTl58rcpiFAjF2br2Ak2A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3",
        "side-channel-map": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/signal-exit": {
      "version": "4.1.0",
      "resolved": "https://registry.npmjs.org/signal-exit/-/signal-exit-4.1.0.tgz",
      "integrity": "sha512-bzyZ1e88w9O1iNJbKnOlvYTrWPDl46O1bG0D3XInv+9tkPrxrN8jUUTiFlDkkmKWgn1M6CfIA13SuGqOa9Korw==",
      "dev": true,
      "license": "ISC",
      "engines": {
        "node": ">=14"
      },
      "funding": {
        "url": "https://github.com/sponsors/isaacs"
      }
    },
    "node_modules/simple-swizzle": {
      "version": "0.2.2",
      "resolved": "https://registry.npmjs.org/simple-swizzle/-/simple-swizzle-0.2.2.tgz",
      "integrity": "sha512-JA//kQgZtbuY83m+xT+tXJkmJncGMTFT+C+g2h2R9uxkYIrE2yy9sgmcLhCnw57/WSD+Eh3J97FPEDFnbXnDUg==",
      "license": "MIT",
      "optional": true,
      "dependencies": {
        "is-arrayish": "^0.3.1"
      }
    },
    "node_modules/sonner": {
      "version": "2.0.7",
      "resolved": "https://registry.npmjs.org/sonner/-/sonner-2.0.7.tgz",
      "integrity": "sha512-W6ZN4p58k8aDKA4XPcx2hpIQXBRAgyiWVkYhT7CvK6D3iAu7xjvVyhQHg2/iaKJZ1XVJ4r7XuwGL+WGEK37i9w==",
      "license": "MIT",
      "peerDependencies": {
        "react": "^18.0.0 || ^19.0.0 || ^19.0.0-rc",
        "react-dom": "^18.0.0 || ^19.0.0 || ^19.0.0-rc"
      }
    },
    "node_modules/source-map": {
      "version": "0.5.7",
      "resolved": "https://registry.npmjs.org/source-map/-/source-map-0.5.7.tgz",
      "integrity": "sha512-LbrmJOMUSdEVxIKvdcJzQC+nQhe8FUZQTXQy6+I75skNgn3OoQ0DZA8YnFa7gp8tqtL3KPf1kmo0R5DoApeSGQ==",
      "license": "BSD-3-Clause",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/source-map-js": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/source-map-js/-/source-map-js-1.2.1.tgz",
      "integrity": "sha512-UXWMKhLOwVKb728IUtQPXxfYU+usdybtUrK/8uGE8CQMvrhOpwvzDBwj0QhSL7MQc7vIsISBG8VQ8+IDQxpfQA==",
      "license": "BSD-3-Clause",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/split2": {
      "version": "4.2.0",
      "resolved": "https://registry.npmjs.org/split2/-/split2-4.2.0.tgz",
      "integrity": "sha512-UcjcJOWknrNkF6PLX83qcHM6KHgVKNkV62Y8a5uYDVv9ydGQVwAHMKqHdJje1VTWpljG0WYpCDhrCdAOYH4TWg==",
      "license": "ISC",
      "engines": {
        "node": ">= 10.x"
      }
    },
    "node_modules/ssf": {
      "version": "0.11.2",
      "resolved": "https://registry.npmjs.org/ssf/-/ssf-0.11.2.tgz",
      "integrity": "sha512-+idbmIXoYET47hH+d7dfm2epdOMUDjqcB4648sTZ+t2JwoyBFL/insLfB/racrDmsKB3diwsDA696pZMieAC5g==",
      "license": "Apache-2.0",
      "dependencies": {
        "frac": "~1.1.2"
      },
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/stable-hash": {
      "version": "0.0.5",
      "resolved": "https://registry.npmjs.org/stable-hash/-/stable-hash-0.0.5.tgz",
      "integrity": "sha512-+L3ccpzibovGXFK+Ap/f8LOS0ahMrHTf3xu7mMLSpEGU0EO9ucaysSylKo9eRDFNhWve/y275iPmIZ4z39a9iA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/stop-iteration-iterator": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/stop-iteration-iterator/-/stop-iteration-iterator-1.1.0.tgz",
      "integrity": "sha512-eLoXW/DHyl62zxY4SCaIgnRhuMr6ri4juEYARS8E6sCEqzKpOiE521Ucofdx+KnDZl5xmvGYaaKCk5FEOxJCoQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "internal-slot": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/string_decoder": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/string_decoder/-/string_decoder-1.3.0.tgz",
      "integrity": "sha512-hkRX8U1WjJFd8LsDJ2yQ/wWWxaopEsABU1XfkM8A+j0+85JAGppt16cr1Whg6KIbb4okU6Mql6BOj+uup/wKeA==",
      "license": "MIT",
      "dependencies": {
        "safe-buffer": "~5.2.0"
      }
    },
    "node_modules/string.prototype.includes": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/string.prototype.includes/-/string.prototype.includes-2.0.1.tgz",
      "integrity": "sha512-o7+c9bW6zpAdJHTtujeePODAhkuicdAryFsfVKwA+wGw89wJ4GTY484WTucM9hLtDEOpOvI+aHnzqnC5lHp4Rg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.3"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/string.prototype.matchall": {
      "version": "4.0.12",
      "resolved": "https://registry.npmjs.org/string.prototype.matchall/-/string.prototype.matchall-4.0.12.tgz",
      "integrity": "sha512-6CC9uyBL+/48dYizRf7H7VAYCMCNTBeM78x/VTUe9bFEaxBepPJDa1Ow99LqI/1yF7kuy7Q3cQsYMrcjGUcskA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.3",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.6",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.0.0",
        "get-intrinsic": "^1.2.6",
        "gopd": "^1.2.0",
        "has-symbols": "^1.1.0",
        "internal-slot": "^1.1.0",
        "regexp.prototype.flags": "^1.5.3",
        "set-function-name": "^2.0.2",
        "side-channel": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/string.prototype.repeat": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/string.prototype.repeat/-/string.prototype.repeat-1.0.0.tgz",
      "integrity": "sha512-0u/TldDbKD8bFCQ/4f5+mNRrXwZ8hg2w7ZR8wa16e8z9XpePWl3eGEcUD0OXpEH/VJH/2G3gjUtR3ZOiBe2S/w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "define-properties": "^1.1.3",
        "es-abstract": "^1.17.5"
      }
    },
    "node_modules/string.prototype.trim": {
      "version": "1.2.10",
      "resolved": "https://registry.npmjs.org/string.prototype.trim/-/string.prototype.trim-1.2.10.tgz",
      "integrity": "sha512-Rs66F0P/1kedk5lyYyH9uBzuiI/kNRmwJAR9quK6VOtIpZ2G+hMZd+HQbbv25MgCA6gEffoMZYxlTod4WcdrKA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.2",
        "define-data-property": "^1.1.4",
        "define-properties": "^1.2.1",
        "es-abstract": "^1.23.5",
        "es-object-atoms": "^1.0.0",
        "has-property-descriptors": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/string.prototype.trimend": {
      "version": "1.0.9",
      "resolved": "https://registry.npmjs.org/string.prototype.trimend/-/string.prototype.trimend-1.0.9.tgz",
      "integrity": "sha512-G7Ok5C6E/j4SGfyLCloXTrngQIQU3PWtXGst3yM7Bea9FRURf1S42ZHlZZtsNque2FN2PoUhfZXYLNWwEr4dLQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.2",
        "define-properties": "^1.2.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/string.prototype.trimstart": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/string.prototype.trimstart/-/string.prototype.trimstart-1.0.8.tgz",
      "integrity": "sha512-UXSH262CSZY1tfu3G3Secr6uGLCFVPMhIqHjlgCUtCCcgihYc/xKs9djMTMUOb2j1mVSeU8EU6NWc/iQKU6Gfg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "define-properties": "^1.2.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/strip-bom": {
      "version": "3.0.0",
      "resolved": "https://registry.npmjs.org/strip-bom/-/strip-bom-3.0.0.tgz",
      "integrity": "sha512-vavAMRXOgBVNF6nyEEmL3DBK19iRpDcoIwW+swQ+CbGiu7lju6t+JklA1MHweoWtadgt4ISVUsXLyDq34ddcwA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/strip-json-comments": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/strip-json-comments/-/strip-json-comments-3.1.1.tgz",
      "integrity": "sha512-6fPc+R4ihwqP6N/aIv2f1gMH8lOVtWQHoqC4yK6oSDVVocumAsfCqjkXnqiYMhmMwS/mEHLp7Vehlt3ql6lEig==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=8"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/styled-jsx": {
      "version": "5.1.6",
      "resolved": "https://registry.npmjs.org/styled-jsx/-/styled-jsx-5.1.6.tgz",
      "integrity": "sha512-qSVyDTeMotdvQYoHWLNGwRFJHC+i+ZvdBRYosOFgC+Wg1vx4frN2/RG/NA7SYqqvKNLf39P2LSRA2pu6n0XYZA==",
      "license": "MIT",
      "dependencies": {
        "client-only": "0.0.1"
      },
      "engines": {
        "node": ">= 12.0.0"
      },
      "peerDependencies": {
        "react": ">= 16.8.0 || 17.x.x || ^18.0.0-0 || ^19.0.0-0"
      },
      "peerDependenciesMeta": {
        "@babel/core": {
          "optional": true
        },
        "babel-plugin-macros": {
          "optional": true
        }
      }
    },
    "node_modules/stylis": {
      "version": "4.2.0",
      "resolved": "https://registry.npmjs.org/stylis/-/stylis-4.2.0.tgz",
      "integrity": "sha512-Orov6g6BB1sDfYgzWfTHDOxamtX1bE/zo104Dh9e6fqJ3PooipYyfJ0pUmrZO2wAvO8YbEyeFrkV91XTsGMSrw==",
      "license": "MIT"
    },
    "node_modules/supabase": {
      "version": "2.39.2",
      "resolved": "https://registry.npmjs.org/supabase/-/supabase-2.39.2.tgz",
      "integrity": "sha512-/LDPMDIDmuDwj3UsKVw+wA+uHF7QhEF8xgJnKpnk1vqVdr+lA6xRSwWQzgaNuwPj5YPt6+78JKp+wzKziTsRVw==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "dependencies": {
        "bin-links": "^5.0.0",
        "https-proxy-agent": "^7.0.2",
        "node-fetch": "^3.3.2",
        "tar": "7.4.3"
      },
      "bin": {
        "supabase": "bin/supabase"
      },
      "engines": {
        "npm": ">=8"
      }
    },
    "node_modules/supports-color": {
      "version": "7.2.0",
      "resolved": "https://registry.npmjs.org/supports-color/-/supports-color-7.2.0.tgz",
      "integrity": "sha512-qpCAvRl9stuOHveKsn7HncJRvv501qIacKzQlO/+Lwxc9+0q2wLyv4Dfvt80/DPn2pqOBsJdDiogXGR9+OvwRw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "has-flag": "^4.0.0"
      },
      "engines": {
        "node": ">=8"
      }
    },
    "node_modules/supports-preserve-symlinks-flag": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/supports-preserve-symlinks-flag/-/supports-preserve-symlinks-flag-1.0.0.tgz",
      "integrity": "sha512-ot0WnXS9fgdkgIcePe6RHNk1WA8+muPa6cSjeR3V8K27q9BB1rTE3R1p7Hv0z1ZyAc8s6Vvv8DIyWf681MAt0w==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/tabbable": {
      "version": "6.2.0",
      "resolved": "https://registry.npmjs.org/tabbable/-/tabbable-6.2.0.tgz",
      "integrity": "sha512-Cat63mxsVJlzYvN51JmVXIgNoUokrIaT2zLclCXjRd8boZ0004U4KCs/sToJ75C6sdlByWxpYnb5Boif1VSFew==",
      "license": "MIT"
    },
    "node_modules/tailwind-merge": {
      "version": "3.3.1",
      "resolved": "https://registry.npmjs.org/tailwind-merge/-/tailwind-merge-3.3.1.tgz",
      "integrity": "sha512-gBXpgUm/3rp1lMZZrM/w7D8GKqshif0zAymAhbCyIt8KMe+0v9DQ7cdYLR4FHH/cKpdTXb+A/tKKU3eolfsI+g==",
      "license": "MIT",
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/dcastil"
      }
    },
    "node_modules/tailwindcss": {
      "version": "4.1.11",
      "resolved": "https://registry.npmjs.org/tailwindcss/-/tailwindcss-4.1.11.tgz",
      "integrity": "sha512-2E9TBm6MDD/xKYe+dvJZAmg3yxIEDNRc0jwlNyDg/4Fil2QcSLjFKGVff0lAf1jjeaArlG/M75Ey/EYr/OJtBA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/tapable": {
      "version": "2.2.2",
      "resolved": "https://registry.npmjs.org/tapable/-/tapable-2.2.2.tgz",
      "integrity": "sha512-Re10+NauLTMCudc7T5WLFLAwDhQ0JWdrMK+9B2M8zR5hRExKmsRDCBA7/aV/pNJFltmBFO5BAMlQFi/vq3nKOg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/tar": {
      "version": "7.4.3",
      "resolved": "https://registry.npmjs.org/tar/-/tar-7.4.3.tgz",
      "integrity": "sha512-5S7Va8hKfV7W5U6g3aYxXmlPoZVAwUMy9AOKyF2fVuZa2UD3qZjg578OrLRt8PcNN1PleVaL/5/yYATNL0ICUw==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "@isaacs/fs-minipass": "^4.0.0",
        "chownr": "^3.0.0",
        "minipass": "^7.1.2",
        "minizlib": "^3.0.1",
        "mkdirp": "^3.0.1",
        "yallist": "^5.0.0"
      },
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/tar-stream": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/tar-stream/-/tar-stream-2.2.0.tgz",
      "integrity": "sha512-ujeqbceABgwMZxEJnk2HDY2DlnUZ+9oEcb1KzTVfYHio0UE6dG71n60d8D2I4qNvleWrrXpmjpt7vZeF1LnMZQ==",
      "license": "MIT",
      "dependencies": {
        "bl": "^4.0.3",
        "end-of-stream": "^1.4.1",
        "fs-constants": "^1.0.0",
        "inherits": "^2.0.3",
        "readable-stream": "^3.1.1"
      },
      "engines": {
        "node": ">=6"
      }
    },
    "node_modules/tinyglobby": {
      "version": "0.2.14",
      "resolved": "https://registry.npmjs.org/tinyglobby/-/tinyglobby-0.2.14.tgz",
      "integrity": "sha512-tX5e7OM1HnYr2+a2C/4V0htOcSQcoSTH9KgJnVvNm5zm/cyEWKJ7j7YutsH9CxMdtOkkLFy2AHrMci9IM8IPZQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "fdir": "^6.4.4",
        "picomatch": "^4.0.2"
      },
      "engines": {
        "node": ">=12.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/SuperchupuDev"
      }
    },
    "node_modules/tinyglobby/node_modules/fdir": {
      "version": "6.4.6",
      "resolved": "https://registry.npmjs.org/fdir/-/fdir-6.4.6.tgz",
      "integrity": "sha512-hiFoqpyZcfNm1yc4u8oWCf9A2c4D3QjCrks3zmoVKVxpQRzmPNar1hUJcBG2RQHvEVGDN+Jm81ZheVLAQMK6+w==",
      "dev": true,
      "license": "MIT",
      "peerDependencies": {
        "picomatch": "^3 || ^4"
      },
      "peerDependenciesMeta": {
        "picomatch": {
          "optional": true
        }
      }
    },
    "node_modules/tinyglobby/node_modules/picomatch": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/picomatch/-/picomatch-4.0.3.tgz",
      "integrity": "sha512-5gTmgEY/sqK6gFXLIsQNH19lWb4ebPDLA4SdLP7dsWkIXHWlG66oPuVvXSGFPppYZz8ZDZq0dYYrbHfBCVUb1Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=12"
      },
      "funding": {
        "url": "https://github.com/sponsors/jonschlinkert"
      }
    },
    "node_modules/tmp": {
      "version": "0.2.5",
      "resolved": "https://registry.npmjs.org/tmp/-/tmp-0.2.5.tgz",
      "integrity": "sha512-voyz6MApa1rQGUxT3E+BK7/ROe8itEx7vD8/HEvt4xwXucvQ5G5oeEiHkmHZJuBO21RpOf+YYm9MOivj709jow==",
      "license": "MIT",
      "engines": {
        "node": ">=14.14"
      }
    },
    "node_modules/to-regex-range": {
      "version": "5.0.1",
      "resolved": "https://registry.npmjs.org/to-regex-range/-/to-regex-range-5.0.1.tgz",
      "integrity": "sha512-65P7iz6X5yEr1cwcgvQxbbIw7Uk3gOy5dIdtZ4rDveLqhrdJP+Li/Hx6tyK0NEb+2GCyneCMJiGqrADCSNk8sQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-number": "^7.0.0"
      },
      "engines": {
        "node": ">=8.0"
      }
    },
    "node_modules/tr46": {
      "version": "0.0.3",
      "resolved": "https://registry.npmjs.org/tr46/-/tr46-0.0.3.tgz",
      "integrity": "sha512-N3WMsuqV66lT30CrXNbEjx4GEwlow3v6rr4mCcv6prnfwhS01rkgyFdjPNBYd9br7LpXV1+Emh01fHnq2Gdgrw==",
      "license": "MIT"
    },
    "node_modules/traverse": {
      "version": "0.3.9",
      "resolved": "https://registry.npmjs.org/traverse/-/traverse-0.3.9.tgz",
      "integrity": "sha512-iawgk0hLP3SxGKDfnDJf8wTz4p2qImnyihM5Hh/sGvQ3K37dPi/w8sRhdNIxYA1TwFwc5mDhIJq+O0RsvXBKdQ==",
      "license": "MIT/X11",
      "engines": {
        "node": "*"
      }
    },
    "node_modules/ts-api-utils": {
      "version": "2.1.0",
      "resolved": "https://registry.npmjs.org/ts-api-utils/-/ts-api-utils-2.1.0.tgz",
      "integrity": "sha512-CUgTZL1irw8u29bzrOD/nH85jqyc74D6SshFgujOIA7osm2Rz7dYH77agkx7H4FBNxDq7Cjf+IjaX/8zwFW+ZQ==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=18.12"
      },
      "peerDependencies": {
        "typescript": ">=4.8.4"
      }
    },
    "node_modules/tsconfig-paths": {
      "version": "3.15.0",
      "resolved": "https://registry.npmjs.org/tsconfig-paths/-/tsconfig-paths-3.15.0.tgz",
      "integrity": "sha512-2Ac2RgzDe/cn48GvOe3M+o82pEFewD3UPbyoUHHdKasHwJKjds4fLXWf/Ux5kATBKN20oaFGu+jbElp1pos0mg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@types/json5": "^0.0.29",
        "json5": "^1.0.2",
        "minimist": "^1.2.6",
        "strip-bom": "^3.0.0"
      }
    },
    "node_modules/tslib": {
      "version": "2.8.1",
      "resolved": "https://registry.npmjs.org/tslib/-/tslib-2.8.1.tgz",
      "integrity": "sha512-oJFu94HQb+KVduSUQL7wnpmqnfmLsOA/nAh6b6EH0wCEoK0/mPeXU6c3wKDV83MkOuHPRHtSXKKU99IBazS/2w==",
      "license": "0BSD"
    },
    "node_modules/tw-animate-css": {
      "version": "1.3.7",
      "resolved": "https://registry.npmjs.org/tw-animate-css/-/tw-animate-css-1.3.7.tgz",
      "integrity": "sha512-lvLb3hTIpB5oGsk8JmLoAjeCHV58nKa2zHYn8yWOoG5JJusH3bhJlF2DLAZ/5NmJ+jyH3ssiAx/2KmbhavJy/A==",
      "dev": true,
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/Wombosvideo"
      }
    },
    "node_modules/type-check": {
      "version": "0.4.0",
      "resolved": "https://registry.npmjs.org/type-check/-/type-check-0.4.0.tgz",
      "integrity": "sha512-XleUoc9uwGXqjWwXaUTZAmzMcFZ5858QA2vvx1Ur5xIcixXIP+8LnFDgRplU30us6teqdlskFfu+ae4K79Ooew==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "prelude-ls": "^1.2.1"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/typed-array-buffer": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/typed-array-buffer/-/typed-array-buffer-1.0.3.tgz",
      "integrity": "sha512-nAYYwfY3qnzX30IkA6AQZjVbtK6duGontcQm1WSG1MD94YLqK0515GNApXkoxKOWMusVssAHWLh9SeaoefYFGw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "es-errors": "^1.3.0",
        "is-typed-array": "^1.1.14"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/typed-array-byte-length": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/typed-array-byte-length/-/typed-array-byte-length-1.0.3.tgz",
      "integrity": "sha512-BaXgOuIxz8n8pIq3e7Atg/7s+DpiYrxn4vdot3w9KbnBhcRQq6o3xemQdIfynqSeXeDrF32x+WvfzmOjPiY9lg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.8",
        "for-each": "^0.3.3",
        "gopd": "^1.2.0",
        "has-proto": "^1.2.0",
        "is-typed-array": "^1.1.14"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/typed-array-byte-offset": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/typed-array-byte-offset/-/typed-array-byte-offset-1.0.4.tgz",
      "integrity": "sha512-bTlAFB/FBYMcuX81gbL4OcpH5PmlFHqlCCpAl8AlEzMz5k53oNDvN8p1PNOWLEmI2x4orp3raOFB51tv9X+MFQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "available-typed-arrays": "^1.0.7",
        "call-bind": "^1.0.8",
        "for-each": "^0.3.3",
        "gopd": "^1.2.0",
        "has-proto": "^1.2.0",
        "is-typed-array": "^1.1.15",
        "reflect.getprototypeof": "^1.0.9"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/typed-array-length": {
      "version": "1.0.7",
      "resolved": "https://registry.npmjs.org/typed-array-length/-/typed-array-length-1.0.7.tgz",
      "integrity": "sha512-3KS2b+kL7fsuk/eJZ7EQdnEmQoaho/r6KUef7hxvltNA5DR8NAUM+8wJMbJyZ4G9/7i3v5zPBIMN5aybAh2/Jg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bind": "^1.0.7",
        "for-each": "^0.3.3",
        "gopd": "^1.0.1",
        "is-typed-array": "^1.1.13",
        "possible-typed-array-names": "^1.0.0",
        "reflect.getprototypeof": "^1.0.6"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/typescript": {
      "version": "5.9.2",
      "resolved": "https://registry.npmjs.org/typescript/-/typescript-5.9.2.tgz",
      "integrity": "sha512-CWBzXQrc/qOkhidw1OzBTQuYRbfyxDXJMVJ1XNwUHGROVmuaeiEm3OslpZ1RV96d7SKKjZKrSJu3+t/xlw3R9A==",
      "dev": true,
      "license": "Apache-2.0",
      "bin": {
        "tsc": "bin/tsc",
        "tsserver": "bin/tsserver"
      },
      "engines": {
        "node": ">=14.17"
      }
    },
    "node_modules/unbox-primitive": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/unbox-primitive/-/unbox-primitive-1.1.0.tgz",
      "integrity": "sha512-nWJ91DjeOkej/TA8pXQ3myruKpKEYgqvpw9lz4OPHj/NWFNluYrjbz9j01CJ8yKQd2g4jFoOkINCTW2I5LEEyw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.3",
        "has-bigints": "^1.0.2",
        "has-symbols": "^1.1.0",
        "which-boxed-primitive": "^1.1.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/undici-types": {
      "version": "6.21.0",
      "resolved": "https://registry.npmjs.org/undici-types/-/undici-types-6.21.0.tgz",
      "integrity": "sha512-iwDZqg0QAGrg9Rav5H4n0M64c3mkR59cJ6wQp+7C4nI0gsmExaedaYLNO44eT4AtBBwjbTiGPMlt2Md0T9H9JQ==",
      "license": "MIT"
    },
    "node_modules/unrs-resolver": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/unrs-resolver/-/unrs-resolver-1.11.1.tgz",
      "integrity": "sha512-bSjt9pjaEBnNiGgc9rUiHGKv5l4/TGzDmYw3RhnkJGtLhbnnA/5qJj7x3dNDCRx/PJxu774LlH8lCOlB4hEfKg==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "dependencies": {
        "napi-postinstall": "^0.3.0"
      },
      "funding": {
        "url": "https://opencollective.com/unrs-resolver"
      },
      "optionalDependencies": {
        "@unrs/resolver-binding-android-arm-eabi": "1.11.1",
        "@unrs/resolver-binding-android-arm64": "1.11.1",
        "@unrs/resolver-binding-darwin-arm64": "1.11.1",
        "@unrs/resolver-binding-darwin-x64": "1.11.1",
        "@unrs/resolver-binding-freebsd-x64": "1.11.1",
        "@unrs/resolver-binding-linux-arm-gnueabihf": "1.11.1",
        "@unrs/resolver-binding-linux-arm-musleabihf": "1.11.1",
        "@unrs/resolver-binding-linux-arm64-gnu": "1.11.1",
        "@unrs/resolver-binding-linux-arm64-musl": "1.11.1",
        "@unrs/resolver-binding-linux-ppc64-gnu": "1.11.1",
        "@unrs/resolver-binding-linux-riscv64-gnu": "1.11.1",
        "@unrs/resolver-binding-linux-riscv64-musl": "1.11.1",
        "@unrs/resolver-binding-linux-s390x-gnu": "1.11.1",
        "@unrs/resolver-binding-linux-x64-gnu": "1.11.1",
        "@unrs/resolver-binding-linux-x64-musl": "1.11.1",
        "@unrs/resolver-binding-wasm32-wasi": "1.11.1",
        "@unrs/resolver-binding-win32-arm64-msvc": "1.11.1",
        "@unrs/resolver-binding-win32-ia32-msvc": "1.11.1",
        "@unrs/resolver-binding-win32-x64-msvc": "1.11.1"
      }
    },
    "node_modules/unzipper": {
      "version": "0.10.14",
      "resolved": "https://registry.npmjs.org/unzipper/-/unzipper-0.10.14.tgz",
      "integrity": "sha512-ti4wZj+0bQTiX2KmKWuwj7lhV+2n//uXEotUmGuQqrbVZSEGFMbI68+c6JCQ8aAmUWYvtHEz2A8K6wXvueR/6g==",
      "license": "MIT",
      "dependencies": {
        "big-integer": "^1.6.17",
        "binary": "~0.3.0",
        "bluebird": "~3.4.1",
        "buffer-indexof-polyfill": "~1.0.0",
        "duplexer2": "~0.1.4",
        "fstream": "^1.0.12",
        "graceful-fs": "^4.2.2",
        "listenercount": "~1.0.1",
        "readable-stream": "~2.3.6",
        "setimmediate": "~1.0.4"
      }
    },
    "node_modules/unzipper/node_modules/isarray": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/isarray/-/isarray-1.0.0.tgz",
      "integrity": "sha512-VLghIWNM6ELQzo7zwmcg0NmTVyWKYjvIeM83yjp0wRDTmUnrM678fQbcKBo6n2CJEF0szoG//ytg+TKla89ALQ==",
      "license": "MIT"
    },
    "node_modules/unzipper/node_modules/readable-stream": {
      "version": "2.3.8",
      "resolved": "https://registry.npmjs.org/readable-stream/-/readable-stream-2.3.8.tgz",
      "integrity": "sha512-8p0AUk4XODgIewSi0l8Epjs+EVnWiK7NoDIEGU0HhE7+ZyY8D1IMY7odu5lRrFXGg71L15KG8QrPmum45RTtdA==",
      "license": "MIT",
      "dependencies": {
        "core-util-is": "~1.0.0",
        "inherits": "~2.0.3",
        "isarray": "~1.0.0",
        "process-nextick-args": "~2.0.0",
        "safe-buffer": "~5.1.1",
        "string_decoder": "~1.1.1",
        "util-deprecate": "~1.0.1"
      }
    },
    "node_modules/unzipper/node_modules/safe-buffer": {
      "version": "5.1.2",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.1.2.tgz",
      "integrity": "sha512-Gd2UZBJDkXlY7GbJxfsE8/nvKkUEU1G38c1siN6QP6a9PT9MmHB8GnpscSmMJSoF8LOIrt8ud/wPtojys4G6+g==",
      "license": "MIT"
    },
    "node_modules/unzipper/node_modules/string_decoder": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/string_decoder/-/string_decoder-1.1.1.tgz",
      "integrity": "sha512-n/ShnvDi6FHbbVfviro+WojiFzv+s8MPMHBczVePfUpDJLwoLT0ht1l4YwBCbi8pJAveEEdnkHyPyTP/mzRfwg==",
      "license": "MIT",
      "dependencies": {
        "safe-buffer": "~5.1.0"
      }
    },
    "node_modules/uri-js": {
      "version": "4.4.1",
      "resolved": "https://registry.npmjs.org/uri-js/-/uri-js-4.4.1.tgz",
      "integrity": "sha512-7rKUyy33Q1yc98pQ1DAmLtwX109F7TIfWlW1Ydo8Wl1ii1SeHieeh0HHfPeL2fMXK6z0s8ecKs9frCuLJvndBg==",
      "dev": true,
      "license": "BSD-2-Clause",
      "dependencies": {
        "punycode": "^2.1.0"
      }
    },
    "node_modules/url-polyfill": {
      "version": "1.1.13",
      "resolved": "https://registry.npmjs.org/url-polyfill/-/url-polyfill-1.1.13.tgz",
      "integrity": "sha512-tXzkojrv2SujumYthZ/WjF7jaSfNhSXlYMpE5AYdL2I3D7DCeo+mch8KtW2rUuKjDg+3VXODXHVgipt8yGY/eQ==",
      "license": "MIT"
    },
    "node_modules/use-callback-ref": {
      "version": "1.3.3",
      "resolved": "https://registry.npmjs.org/use-callback-ref/-/use-callback-ref-1.3.3.tgz",
      "integrity": "sha512-jQL3lRnocaFtu3V00JToYz/4QkNWswxijDaCVNZRiRTO3HQDLsdu1ZtmIUvV4yPp+rvWm5j0y0TG/S61cuijTg==",
      "license": "MIT",
      "dependencies": {
        "tslib": "^2.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/use-debounce": {
      "version": "10.0.5",
      "resolved": "https://registry.npmjs.org/use-debounce/-/use-debounce-10.0.5.tgz",
      "integrity": "sha512-Q76E3lnIV+4YT9AHcrHEHYmAd9LKwUAbPXDm7FlqVGDHiSOhX3RDjT8dm0AxbJup6WgOb1YEcKyCr11kBJR5KQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 16.0.0"
      },
      "peerDependencies": {
        "react": "*"
      }
    },
    "node_modules/use-isomorphic-layout-effect": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/use-isomorphic-layout-effect/-/use-isomorphic-layout-effect-1.2.1.tgz",
      "integrity": "sha512-tpZZ+EX0gaghDAiFR37hj5MgY6ZN55kLiPkJsKxBMZ6GZdOSPJXiOzPM984oPYZ5AnehYx5WQp1+ME8I/P/pRA==",
      "license": "MIT",
      "peerDependencies": {
        "react": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/use-sidecar": {
      "version": "1.1.3",
      "resolved": "https://registry.npmjs.org/use-sidecar/-/use-sidecar-1.1.3.tgz",
      "integrity": "sha512-Fedw0aZvkhynoPYlA5WXrMCAMm+nSWdZt6lzJQ7Ok8S6Q+VsHmHpRWndVRJ8Be0ZbkfPc5LRYH+5XrzXcEeLRQ==",
      "license": "MIT",
      "dependencies": {
        "detect-node-es": "^1.1.0",
        "tslib": "^2.0.0"
      },
      "engines": {
        "node": ">=10"
      },
      "peerDependencies": {
        "@types/react": "*",
        "react": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0 || ^19.0.0-rc"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        }
      }
    },
    "node_modules/use-sync-external-store": {
      "version": "1.5.0",
      "resolved": "https://registry.npmjs.org/use-sync-external-store/-/use-sync-external-store-1.5.0.tgz",
      "integrity": "sha512-Rb46I4cGGVBmjamjphe8L/UnvJD+uPPtTkNvX5mZgqdbavhI4EbgIWJiIHXJ8bc/i9EQGPRh4DwEURJ552Do0A==",
      "license": "MIT",
      "peerDependencies": {
        "react": "^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0"
      }
    },
    "node_modules/util-deprecate": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/util-deprecate/-/util-deprecate-1.0.2.tgz",
      "integrity": "sha512-EPD5q1uXyFxJpCrLnCc1nHnq3gOa6DZBocAIiI2TaSCA7VCJ1UJDMagCzIkXNsUYfD1daK//LTEQ8xiIbrHtcw==",
      "license": "MIT"
    },
    "node_modules/uuid": {
      "version": "8.3.2",
      "resolved": "https://registry.npmjs.org/uuid/-/uuid-8.3.2.tgz",
      "integrity": "sha512-+NYs2QeMWy+GWFOEm9xnn6HCDp0l7QBD7ml8zLUmJ+93Q5NF0NocErnwkTkXVFNiX3/fpC6afS8Dhb/gz7R7eg==",
      "license": "MIT",
      "bin": {
        "uuid": "dist/bin/uuid"
      }
    },
    "node_modules/web-push": {
      "version": "3.6.7",
      "resolved": "https://registry.npmjs.org/web-push/-/web-push-3.6.7.tgz",
      "integrity": "sha512-OpiIUe8cuGjrj3mMBFWY+e4MMIkW3SVT+7vEIjvD9kejGUypv8GPDf84JdPWskK8zMRIJ6xYGm+Kxr8YkPyA0A==",
      "license": "MPL-2.0",
      "dependencies": {
        "asn1.js": "^5.3.0",
        "http_ece": "1.2.0",
        "https-proxy-agent": "^7.0.0",
        "jws": "^4.0.0",
        "minimist": "^1.2.5"
      },
      "bin": {
        "web-push": "src/cli.js"
      },
      "engines": {
        "node": ">= 16"
      }
    },
    "node_modules/web-streams-polyfill": {
      "version": "3.3.3",
      "resolved": "https://registry.npmjs.org/web-streams-polyfill/-/web-streams-polyfill-3.3.3.tgz",
      "integrity": "sha512-d2JWLCivmZYTSIoge9MsgFCZrt571BikcWGYkjC1khllbTeDlGqZ2D8vD8E/lJa8WGWbb7Plm8/XJYV7IJHZZw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/webidl-conversions": {
      "version": "3.0.1",
      "resolved": "https://registry.npmjs.org/webidl-conversions/-/webidl-conversions-3.0.1.tgz",
      "integrity": "sha512-2JAn3z8AR6rjK8Sm8orRC0h/bcl/DqL7tRPdGZ4I1CjdF+EaMLmYxBHyXuKL849eucPFhvBoxMsflfOb8kxaeQ==",
      "license": "BSD-2-Clause"
    },
    "node_modules/whatwg-fetch": {
      "version": "3.6.20",
      "resolved": "https://registry.npmjs.org/whatwg-fetch/-/whatwg-fetch-3.6.20.tgz",
      "integrity": "sha512-EqhiFU6daOA8kpjOWTL0olhVOF3i7OrFzSYiGsEMB8GcXS+RrzauAERX65xMeNWVqxA6HXH2m69Z9LaKKdisfg==",
      "license": "MIT"
    },
    "node_modules/whatwg-url": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/whatwg-url/-/whatwg-url-5.0.0.tgz",
      "integrity": "sha512-saE57nupxk6v3HY35+jzBwYa0rKSy0XR8JSxZPwgLr7ys0IBzhGviA1/TUGJLmSVqs8pb9AnvICXEuOHLprYTw==",
      "license": "MIT",
      "dependencies": {
        "tr46": "~0.0.3",
        "webidl-conversions": "^3.0.0"
      }
    },
    "node_modules/which": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/which/-/which-2.0.2.tgz",
      "integrity": "sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "isexe": "^2.0.0"
      },
      "bin": {
        "node-which": "bin/node-which"
      },
      "engines": {
        "node": ">= 8"
      }
    },
    "node_modules/which-boxed-primitive": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/which-boxed-primitive/-/which-boxed-primitive-1.1.1.tgz",
      "integrity": "sha512-TbX3mj8n0odCBFVlY8AxkqcHASw3L60jIuF8jFP78az3C2YhmGvqbHBpAjTRH2/xqYunrJ9g1jSyjCjpoWzIAA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-bigint": "^1.1.0",
        "is-boolean-object": "^1.2.1",
        "is-number-object": "^1.1.1",
        "is-string": "^1.1.1",
        "is-symbol": "^1.1.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/which-builtin-type": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/which-builtin-type/-/which-builtin-type-1.2.1.tgz",
      "integrity": "sha512-6iBczoX+kDQ7a3+YJBnh3T+KZRxM/iYNPXicqk66/Qfm1b93iu+yOImkg0zHbj5LNOcNv1TEADiZ0xa34B4q6Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "function.prototype.name": "^1.1.6",
        "has-tostringtag": "^1.0.2",
        "is-async-function": "^2.0.0",
        "is-date-object": "^1.1.0",
        "is-finalizationregistry": "^1.1.0",
        "is-generator-function": "^1.0.10",
        "is-regex": "^1.2.1",
        "is-weakref": "^1.0.2",
        "isarray": "^2.0.5",
        "which-boxed-primitive": "^1.1.0",
        "which-collection": "^1.0.2",
        "which-typed-array": "^1.1.16"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/which-collection": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/which-collection/-/which-collection-1.0.2.tgz",
      "integrity": "sha512-K4jVyjnBdgvc86Y6BkaLZEN933SwYOuBFkdmBu9ZfkcAbdVbpITnDmjvZ/aQjRXQrv5EPkTnD1s39GiiqbngCw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "is-map": "^2.0.3",
        "is-set": "^2.0.3",
        "is-weakmap": "^2.0.2",
        "is-weakset": "^2.0.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/which-typed-array": {
      "version": "1.1.19",
      "resolved": "https://registry.npmjs.org/which-typed-array/-/which-typed-array-1.1.19.tgz",
      "integrity": "sha512-rEvr90Bck4WZt9HHFC4DJMsjvu7x+r6bImz0/BrbWb7A2djJ8hnZMrWnHo9F8ssv0OMErasDhftrfROTyqSDrw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "available-typed-arrays": "^1.0.7",
        "call-bind": "^1.0.8",
        "call-bound": "^1.0.4",
        "for-each": "^0.3.5",
        "get-proto": "^1.0.1",
        "gopd": "^1.2.0",
        "has-tostringtag": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/wildcard": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/wildcard/-/wildcard-1.1.2.tgz",
      "integrity": "sha512-DXukZJxpHA8LuotRwL0pP1+rS6CS7FF2qStDDE1C7DDg2rLud2PXRMuEDYIPhgEezwnlHNL4c+N6MfMTjCGTng==",
      "license": "MIT"
    },
    "node_modules/wmf": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/wmf/-/wmf-1.0.2.tgz",
      "integrity": "sha512-/p9K7bEh0Dj6WbXg4JG0xvLQmIadrner1bi45VMJTfnbVHsc7yIajZyoSoK60/dtVBs12Fm6WkUI5/3WAVsNMw==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/word": {
      "version": "0.3.0",
      "resolved": "https://registry.npmjs.org/word/-/word-0.3.0.tgz",
      "integrity": "sha512-OELeY0Q61OXpdUfTp+oweA/vtLVg5VDOXh+3he3PNzLGG/y0oylSOC1xRVj0+l4vQ3tj/bB1HVHv1ocXkQceFA==",
      "license": "Apache-2.0",
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/word-wrap": {
      "version": "1.2.5",
      "resolved": "https://registry.npmjs.org/word-wrap/-/word-wrap-1.2.5.tgz",
      "integrity": "sha512-BN22B5eaMMI9UMtjrGd5g5eCYPpCPDUy0FJXbYsaT5zYxjFOckS53SQDE3pWkVoWpHXVb3BrYcEN4Twa55B5cA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/wrappy": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/wrappy/-/wrappy-1.0.2.tgz",
      "integrity": "sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ==",
      "license": "ISC"
    },
    "node_modules/write-file-atomic": {
      "version": "6.0.0",
      "resolved": "https://registry.npmjs.org/write-file-atomic/-/write-file-atomic-6.0.0.tgz",
      "integrity": "sha512-GmqrO8WJ1NuzJ2DrziEI2o57jKAVIQNf8a18W3nCYU3H7PNWqCCVTeH6/NQE93CIllIgQS98rrmVkYgTX9fFJQ==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "imurmurhash": "^0.1.4",
        "signal-exit": "^4.0.1"
      },
      "engines": {
        "node": "^18.17.0 || >=20.5.0"
      }
    },
    "node_modules/ws": {
      "version": "8.18.3",
      "resolved": "https://registry.npmjs.org/ws/-/ws-8.18.3.tgz",
      "integrity": "sha512-PEIGCY5tSlUt50cqyMXfCzX+oOPqN0vuGqWzbcJ2xvnkzkq46oOpz7dQaTDBdfICb4N14+GARUDw2XV2N4tvzg==",
      "license": "MIT",
      "engines": {
        "node": ">=10.0.0"
      },
      "peerDependencies": {
        "bufferutil": "^4.0.1",
        "utf-8-validate": ">=5.0.2"
      },
      "peerDependenciesMeta": {
        "bufferutil": {
          "optional": true
        },
        "utf-8-validate": {
          "optional": true
        }
      }
    },
    "node_modules/xlsx": {
      "version": "0.18.5",
      "resolved": "https://registry.npmjs.org/xlsx/-/xlsx-0.18.5.tgz",
      "integrity": "sha512-dmg3LCjBPHZnQp5/F/+nnTa+miPJxUXB6vtk42YjBBKayDNagxGEeIdWApkYPOf3Z3pm3k62Knjzp7lMeTEtFQ==",
      "license": "Apache-2.0",
      "dependencies": {
        "adler-32": "~1.3.0",
        "cfb": "~1.2.1",
        "codepage": "~1.15.0",
        "crc-32": "~1.2.1",
        "ssf": "~0.11.2",
        "wmf": "~1.0.1",
        "word": "~0.3.0"
      },
      "bin": {
        "xlsx": "bin/xlsx.njs"
      },
      "engines": {
        "node": ">=0.8"
      }
    },
    "node_modules/xmlchars": {
      "version": "2.2.0",
      "resolved": "https://registry.npmjs.org/xmlchars/-/xmlchars-2.2.0.tgz",
      "integrity": "sha512-JZnDKK8B0RCDw84FNdDAIpZK+JuJw+s7Lz8nksI7SIuU3UXJJslUthsi+uWBUYOwPFwW7W7PRLRfUKpxjtjFCw==",
      "license": "MIT"
    },
    "node_modules/xtend": {
      "version": "4.0.2",
      "resolved": "https://registry.npmjs.org/xtend/-/xtend-4.0.2.tgz",
      "integrity": "sha512-LKYU1iAXJXUgAXn9URjiu+MWhyUXHsvfp7mcuYm9dSUKK0/CjtrUwFAxD82/mCWbtLsGjFIad0wIsod4zrTAEQ==",
      "license": "MIT",
      "engines": {
        "node": ">=0.4"
      }
    },
    "node_modules/yallist": {
      "version": "5.0.0",
      "resolved": "https://registry.npmjs.org/yallist/-/yallist-5.0.0.tgz",
      "integrity": "sha512-YgvUTfwqyc7UXVMrB+SImsVYSmTS8X/tSrtdNZMImM+n7+QTriRXyXim0mBrTXNeqzVF0KWGgHPeiyViFFrNDw==",
      "dev": true,
      "license": "BlueOak-1.0.0",
      "engines": {
        "node": ">=18"
      }
    },
    "node_modules/yaml": {
      "version": "1.10.2",
      "resolved": "https://registry.npmjs.org/yaml/-/yaml-1.10.2.tgz",
      "integrity": "sha512-r3vXyErRCYJ7wg28yvBY5VSoAF8ZvlcW9/BwUzEtUsjvX/DKs24dIkuwjtuprwJJHsbyUbLApepYTR1BN4uHrg==",
      "license": "ISC",
      "engines": {
        "node": ">= 6"
      }
    },
    "node_modules/yocto-queue": {
      "version": "0.1.0",
      "resolved": "https://registry.npmjs.org/yocto-queue/-/yocto-queue-0.1.0.tgz",
      "integrity": "sha512-rVksvsnNCdJ/ohGc6xgPwyN8eheCxsiLM8mxuE/t/mOVqJewPuO1miLpTHQiRgTKCLexL4MeAFVagts7HmNZ2Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": ">=10"
      },
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/zip-stream": {
      "version": "4.1.1",
      "resolved": "https://registry.npmjs.org/zip-stream/-/zip-stream-4.1.1.tgz",
      "integrity": "sha512-9qv4rlDiopXg4E69k+vMHjNN63YFMe9sZMrdlvKnCjlCRWeCBswPPMPUfx+ipsAWq1LXHe70RcbaHdJJpS6hyQ==",
      "license": "MIT",
      "dependencies": {
        "archiver-utils": "^3.0.4",
        "compress-commons": "^4.1.2",
        "readable-stream": "^3.6.0"
      },
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/zip-stream/node_modules/archiver-utils": {
      "version": "3.0.4",
      "resolved": "https://registry.npmjs.org/archiver-utils/-/archiver-utils-3.0.4.tgz",
      "integrity": "sha512-KVgf4XQVrTjhyWmx6cte4RxonPLR9onExufI1jhvw/MQ4BB6IsZD5gT8Lq+u/+pRkWna/6JoHpiQioaqFP5Rzw==",
      "license": "MIT",
      "dependencies": {
        "glob": "^7.2.3",
        "graceful-fs": "^4.2.0",
        "lazystream": "^1.0.0",
        "lodash.defaults": "^4.2.0",
        "lodash.difference": "^4.5.0",
        "lodash.flatten": "^4.4.0",
        "lodash.isplainobject": "^4.0.6",
        "lodash.union": "^4.6.0",
        "normalize-path": "^3.0.0",
        "readable-stream": "^3.6.0"
      },
      "engines": {
        "node": ">= 10"
      }
    },
    "node_modules/zod": {
      "version": "4.1.5",
      "resolved": "https://registry.npmjs.org/zod/-/zod-4.1.5.tgz",
      "integrity": "sha512-rcUUZqlLJgBC33IT3PNMgsCq6TzLQEG/Ei/KTCU0PedSWRMAXoOUN+4t/0H+Q8bdnLPdqUYnvboJT0bn/229qg==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/colinhacks"
      }
    },
    "node_modules/zustand": {
      "version": "5.0.7",
      "resolved": "https://registry.npmjs.org/zustand/-/zustand-5.0.7.tgz",
      "integrity": "sha512-Ot6uqHDW/O2VdYsKLLU8GQu8sCOM1LcoE8RwvLv9uuRT9s6SOHCKs0ZEOhxg+I1Ld+A1Q5lwx+UlKXXUoCZITg==",
      "license": "MIT",
      "engines": {
        "node": ">=12.20.0"
      },
      "peerDependencies": {
        "@types/react": ">=18.0.0",
        "immer": ">=9.0.6",
        "react": ">=18.0.0",
        "use-sync-external-store": ">=1.2.0"
      },
      "peerDependenciesMeta": {
        "@types/react": {
          "optional": true
        },
        "immer": {
          "optional": true
        },
        "react": {
          "optional": true
        },
        "use-sync-external-store": {
          "optional": true
        }
      }
    }
  }
}

```

<!-- path: hnvtx/middleware.ts -->
```typescript
import { type NextRequest } from "next/server";
import { updateSession } from "@/utils/supabase/middleware";

export async function middleware(request: NextRequest) {
  // update user's auth session
  return await updateSession(request);
}

export const config = {
  matcher: [
    /*
     * Match all request paths except the landing page `/`, `/login`, `/signup` and for the ones starting with:
     * - _next/static (static files)
     * - _next/image (image optimization files)
     * - favicon.ico (favicon file)
     * Feel free to modify this pattern to include more paths.
     */
    "/((?!_next/static|_next/image|favicon\\.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$|^$|^login$|^signup$).*)",
  ],
};

```

<!-- path: hnvtx/components/table/TableHeader.tsx -->
```typescript
// @/components/table/TableHeader.tsx
import React from "react";
import { FiArrowUp, FiArrowDown } from "react-icons/fi";
import { DataTableProps, SortConfig } from "@/components/table/datatable-types";
import { AuthTableOrViewName, Row } from "@/hooks/database";
import { Column } from "@/hooks/database/excel-queries/excel-helpers";
import { TruncateTooltip } from "@/components/common/TruncateTooltip";

interface TableHeaderProps<T extends AuthTableOrViewName>
  extends Pick<
    DataTableProps<T>,
    "columns" | "selectable" | "sortable" | "bordered" | "density" | "actions"
  > {
  visibleColumns: Column<Row<T>>[];
  hasActions: boolean;
  sortConfig: SortConfig<Row<T>> | null;
  onSort: (key: keyof Row<T> & string) => void;
  onSelectAll: (selected: boolean) => void;
  allSelected: boolean;
  hasData: boolean;
}


const densityClasses = {
  compact: "py-1 px-2 sm:px-3",
  default: "py-2 px-3 sm:py-3 sm:px-4",
  comfortable: "py-3 px-4 sm:py-4 sm:px-6",
};

function TableHeaderBase<
  T extends AuthTableOrViewName
>({
  visibleColumns,
  selectable,
  sortable,
  bordered,
  density,
  hasActions,
  sortConfig,
  onSort,
  onSelectAll,
  allSelected,
  hasData,
}: TableHeaderProps<T>) {
  return (
    <thead className="bg-gray-50 dark:bg-gray-700 sticky top-0 z-10">
      <tr>
        {selectable && (
          <th
            className={`w-12 px-2 sm:px-4 py-2 sm:py-3 text-left whitespace-nowrap overflow-hidden ${
              bordered
                ? "border-b border-r border-gray-200 dark:border-gray-700"
                : ""
            }`}
            style={{ width: 48, minWidth: 48, maxWidth: 48 }}
          >
            <input
              type="checkbox"
              checked={allSelected && hasData}
              onChange={(e) => onSelectAll(e.target.checked)}
              className="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
              aria-label="Select all rows"
            />
          </th>
        )}
        {hasActions && (
          <th
            className={`w-32 text-center whitespace-nowrap overflow-hidden ${
              densityClasses[density ?? "default"]
            } text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider ${
              bordered ? "border-b border-gray-200 dark:border-gray-700" : ""
            }`}
            style={{ width: 128, minWidth: 128, maxWidth: 128 }}
          >
            <span className="hidden sm:inline">Actions</span>
            <span className="sm:hidden">•••</span>
          </th>
        )}
        {visibleColumns.map((column, index) => (
          <th
            key={column.key}
            className={`${
              densityClasses[density ?? "default"]
            } text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap ${
              column.sortable && sortable
                ? "cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                : ""
            } ${
              column.align === "center"
                ? "text-center"
                : column.align === "right"
                ? "text-right"
                : ""
            } ${
              bordered
                ? `border-b ${
                    index < visibleColumns.length - 1 || hasActions
                      ? "border-r"
                      : ""
                  } border-gray-200 dark:border-gray-700`
                : ""
            }`}
            style={{
              width: column.width,
              minWidth: column.width ? undefined : "100px",
              maxWidth: "350px"
            }}
            onClick={() =>
              column.sortable &&
              sortable &&
              onSort(column.dataIndex as keyof Row<T> & string)
            }
          >
            <div className="flex items-center gap-1 sm:gap-2 min-w-0">
              <div className="min-w-0 flex-1">
                <TruncateTooltip
                  text={column.title}
                  id={`header-${column.key}`}
                  className="text-xs sm:text-sm"
                />
              </div>

              {column.sortable && sortable && (
                <div className="flex flex-col flex-shrink-0" aria-hidden="true">
                  <FiArrowUp
                    size={10}
                    className={`sm:size-3 ${
                      sortConfig?.key === column.dataIndex &&
                      sortConfig.direction === "asc"
                        ? "text-blue-600 dark:text-blue-400"
                        : "text-gray-300 dark:text-gray-600"
                    }`}
                  />
                  <FiArrowDown
                    size={10}
                    className={`-mt-0.5 sm:size-3 sm:-mt-1 ${
                      sortConfig?.key === column.dataIndex &&
                      sortConfig.direction === "desc"
                        ? "text-blue-600 dark:text-blue-400"
                        : "text-gray-300 dark:text-gray-600"
                    }`}
                  />
                </div>
              )}
            </div>
          </th>
        ))}
      </tr>
    </thead>
  );
}

export const TableHeader = React.memo(TableHeaderBase) as <T extends AuthTableOrViewName>(
  props: TableHeaderProps<T>
) => React.ReactElement;

```

<!-- path: hnvtx/components/table/index.ts -->
```typescript
export * from "./DataTable";
export * from "./TableHeader";
export * from "./TableBody";
export * from "./TablePagination";
export * from "./TableColumnSelector";
export * from "./TableFilterPanel";
export * from "./TableToolbar";
export * from "./datatable-types";
```

<!-- path: hnvtx/components/table/TableFilterPanel.tsx -->
```typescript
// @/components/table/TableFilterPanel.tsx
import React, { useState, useEffect } from "react";
import { Column } from "@/hooks/database/excel-queries/excel-helpers";
import { AuthTableOrViewName, Row, Filters } from "@/hooks/database";
import { useDebounce } from "@/hooks/useDebounce";
import { DEFAULTS } from "@/config/constants";

interface TableFilterPanelProps<T extends AuthTableOrViewName> {
  columns: Column<Row<T>>[];
  filters: Filters;
  setFilters: React.Dispatch<React.SetStateAction<Filters>>;
  showFilters: boolean;
  filterable: boolean;
}

const DebouncedInput = ({ value, onChange, placeholder, className }: { value: string; onChange: (value: string) => void; placeholder: string; className: string; }) => {
    const [internalValue, setInternalValue] = useState(value);
    const debouncedValue = useDebounce(internalValue, DEFAULTS.DEBOUNCE_DELAY);

    useEffect(() => {
        onChange(debouncedValue);
    }, [debouncedValue, onChange]);

    useEffect(() => {
        setInternalValue(value);
    }, [value]);

    return (
        <input
            type='text'
            value={internalValue}
            onChange={(e) => setInternalValue(e.target.value)}
            placeholder={placeholder}
            className={className}
        />
    );
};

export function TableFilterPanel<T extends AuthTableOrViewName>({
  columns,
  filters,
  setFilters,
  showFilters,
  filterable,
}: TableFilterPanelProps<T>) {
  if (!showFilters || !filterable) return null;

  return (
    <div className='mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg'>
      {columns
        .filter((col) => col.filterable)
        .map((column) => (
          <div key={column.key} className='flex flex-col gap-1'>
            <label className='text-xs font-medium text-gray-700 dark:text-gray-300'>{column.title}</label>
            {column.filterOptions ? (
              <select
                value={String(filters[column.dataIndex] ?? '')}
                onChange={(e) => setFilters({ ...filters, [column.dataIndex]: e.target.value })}
                className='px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white'
              >
                <option value=''>All</option>
                {column.filterOptions.map((option) => (
                  <option key={String(option.value)} value={String(option.value)}>
                    {option.label}
                  </option>
                ))}
              </select>
            ) : (
              <DebouncedInput
                value={typeof filters[column.dataIndex] === 'string' ? (filters[column.dataIndex] as string) : ''}
                onChange={(value) => setFilters(prev => ({ ...prev, [column.dataIndex]: value }))}
                placeholder={`Filter ${column.title.toLowerCase()}...`}
                className='px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400'
              />
            )}
          </div>
        ))}
      {Object.keys(filters).length > 0 && (
        <div className='flex items-end'>
          <button 
            onClick={() => setFilters({})} 
            className='px-3 py-1.5 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors'
          >
            Clear All
          </button>
        </div>
      )}
    </div>
  );
}
```

<!-- path: hnvtx/components/table/DataTable.tsx -->
```typescript
// @/components/table/DataTable.tsx
import React, { useMemo, useCallback, useEffect, useReducer } from 'react';
import { createClient } from '@/utils/supabase/client';
import {
  useTableExcelDownload,
  useRPCExcelDownload,
} from '@/hooks/database/excel-queries';
import {
  TableToolbar,
  TableHeader,
  TableBody,
  TablePagination,
  TableFilterPanel,
} from './';
import { DataTableProps, SortConfig } from '@/components/table/datatable-types';
import { AuthTableOrViewName, Row, Filters } from '@/hooks/database';
import {
  Column,
  DownloadOptions,
  RPCConfig,
} from '@/hooks/database/excel-queries/excel-helpers';
import { cn } from '@/lib/utils';

// Define a type for your row that guarantees a unique identifier
type DataRow<T extends AuthTableOrViewName> = Row<T> & { id: string | number };

// --- State Management with useReducer ---

type TableState<T extends AuthTableOrViewName> = {
  searchQuery: string;
  sortConfig: SortConfig<Row<T>> | null;
  filters: Filters;
  selectedRows: DataRow<T>[];
  visibleColumns: string[];
  editingCell: { rowIndex: number; columnKey: string } | null;
  editValue: string;
  showColumnSelector: boolean;
  showFilters: boolean;
};

// Base action type that works with any row type
type BaseTableAction<R> =
  | { type: 'SET_SEARCH_QUERY'; payload: string }
  | { type: 'SET_SELECTED_ROWS'; payload: R[] }
  | { type: 'SET_VISIBLE_COLUMNS'; payload: string[] }
  | {
      type: 'START_EDIT_CELL';
      payload: { rowIndex: number; columnKey: string; value: string };
    }
  | { type: 'SET_EDIT_VALUE'; payload: string }
  | { type: 'CANCEL_EDIT' }
  | { type: 'TOGGLE_COLUMN_SELECTOR'; payload?: boolean }
  | { type: 'TOGGLE_FILTERS'; payload?: boolean };

// Table-specific action type that extends the base with table-aware actions
type TableAction<T extends AuthTableOrViewName> =
  | BaseTableAction<DataRow<T>>
  | { type: 'SET_SORT_CONFIG'; payload: SortConfig<Row<T>> | null }
  | { type: 'SET_FILTERS'; payload: Filters };

function tableReducer<T extends AuthTableOrViewName>(
  state: TableState<T>,
  action: TableAction<T> | BaseTableAction<DataRow<T>>
): TableState<T> {
  switch (action.type) {
    case 'SET_SEARCH_QUERY':
      return { ...state, searchQuery: action.payload };
    case 'SET_SORT_CONFIG':
      return { ...state, sortConfig: action.payload };
    case 'SET_FILTERS':
      return { ...state, filters: action.payload };
    case 'SET_SELECTED_ROWS':
      return { ...state, selectedRows: action.payload };
    case 'SET_VISIBLE_COLUMNS':
      return { ...state, visibleColumns: action.payload };
    case 'START_EDIT_CELL':
      return {
        ...state,
        editingCell: {
          rowIndex: action.payload.rowIndex,
          columnKey: action.payload.columnKey,
        },
        editValue: action.payload.value,
      };
    case 'SET_EDIT_VALUE':
      return { ...state, editValue: action.payload };
    case 'CANCEL_EDIT':
      return { ...state, editingCell: null, editValue: '' };
    case 'TOGGLE_COLUMN_SELECTOR':
      return {
        ...state,
        showColumnSelector: action.payload ?? !state.showColumnSelector,
      };
    case 'TOGGLE_FILTERS':
      return { ...state, showFilters: action.payload ?? !state.showFilters };
    default:
      return state;
  }
}

export function DataTable<T extends AuthTableOrViewName>({
  data = [],
  tableName,
  columns,
  loading = false,
  pagination,
  actions = [],
  searchable = true,
  serverSearch = false,
  filterable = true,
  sortable = true,
  selectable = false,
  exportable = false,
  refreshable = false,
  density = 'default',
  bordered = true,
  striped = true,
  hoverable = true,
  className = '',
  emptyText = 'No data available',
  title,
  onRefresh,
  onExport,
  onRowSelect,
  onCellEdit,
  customToolbar,
  showColumnSelector: showColumnSelectorProp,
  showColumnsToggle,
  exportOptions,
  onSearchChange,
}: DataTableProps<T>): React.ReactElement {
  const initialState: TableState<T> = {
    searchQuery: '',
    sortConfig: null,
    filters: {},
    selectedRows: [],
    visibleColumns: columns.map((col) => col.key),
    editingCell: null,
    editValue: '',
    showColumnSelector: !!showColumnSelectorProp,
    showFilters: false,
  };

  const [state, dispatch] = useReducer(tableReducer, initialState);
  const {
    searchQuery,
    sortConfig,
    filters,
    selectedRows,
    visibleColumns,
    editingCell,
    editValue,
    showColumnSelector,
    showFilters,
  } = state;

  const supabase = createClient();

  useEffect(() => {
    if (typeof showColumnSelectorProp === 'boolean') {
      dispatch({
        type: 'TOGGLE_COLUMN_SELECTOR',
        payload: showColumnSelectorProp,
      });
    }
  }, [showColumnSelectorProp]);

  useEffect(() => {
    if (!filterable) {
      dispatch({ type: 'SET_FILTERS', payload: {} });
    }
  }, [filterable]);

  // (Excel download hooks remain the same)
  const tableExcelDownload = useTableExcelDownload<T>(supabase, tableName, {
    showToasts: true,
  });
  const rpcExcelDownload = useRPCExcelDownload<T>(supabase, {
    showToasts: true,
  });

  const processedData = useMemo(() => {
    let filteredData = [...data] as DataRow<T>[];

    if (searchQuery && searchable && !serverSearch) {
      const q = searchQuery.toLowerCase();
      filteredData = filteredData.filter((item) =>
        columns.some((column) => {
          if (column.searchable === false) return false;
          const value = item[column.dataIndex as keyof typeof item];
          return String(value ?? '')
            .toLowerCase()
            .includes(q);
        })
      );
    }

    if (filterable && Object.keys(filters).length > 0) {
      Object.entries(filters).forEach(([key, value]) => {
        if (value !== undefined && value !== '') {
          filteredData = filteredData.filter((item) =>
            String(item[key as keyof DataRow<T>] ?? '')
              .toLowerCase()
              .includes(String(value).toLowerCase())
          );
        }
      });
    }

    if (sortConfig && sortable) {
      filteredData.sort((a, b) => {
        const aValue = a[sortConfig.key];
        const bValue = b[sortConfig.key];
        if (aValue === null || aValue === undefined) return 1;
        if (bValue === null || bValue === undefined) return -1;
        if (typeof aValue === 'string' && typeof bValue === 'string') {
          return sortConfig.direction === 'asc'
            ? aValue.localeCompare(bValue)
            : bValue.localeCompare(aValue);
        }
        return sortConfig.direction === 'asc'
          ? aValue > bValue
            ? 1
            : -1
          : aValue < bValue
          ? 1
          : -1;
      });
    }

    return filteredData;
  }, [
    data,
    searchQuery,
    filters,
    sortConfig,
    columns,
    searchable,
    sortable,
    filterable,
    serverSearch,
  ]);

  const handleSort = useCallback(
    (columnKey: keyof Row<T> & string) => {
      if (!sortable) return;
      const direction =
        sortConfig?.key === columnKey && sortConfig.direction === 'asc'
          ? 'desc'
          : 'asc';
      if (sortConfig?.key === columnKey && sortConfig.direction === 'desc') {
        dispatch({ type: 'SET_SORT_CONFIG', payload: null });
      } else {
        dispatch({
          type: 'SET_SORT_CONFIG',
          payload: { key: columnKey, direction },
        });
      }
    },
    [sortable, sortConfig]
  );

  const handleRowSelect = useCallback(
    (record: DataRow<T>, selected: boolean) => {
      const newSelection = selected
        ? [...selectedRows, record]
        : selectedRows.filter((row) => row.id !== record.id);
      dispatch({ type: 'SET_SELECTED_ROWS', payload: newSelection });
      onRowSelect?.(newSelection);
    },
    [selectedRows, onRowSelect]
  );

  const handleSelectAll = useCallback(
    (selected: boolean) => {
      const newSelection = selected ? [...processedData] : [];
      dispatch({ type: 'SET_SELECTED_ROWS', payload: newSelection });
      onRowSelect?.(newSelection);
    },
    [processedData, onRowSelect]
  );

  const handleCellEdit = useCallback(
    (record: DataRow<T>, column: Column<Row<T>>, rowIndex: number) => {
      if (!column.editable) return;
      dispatch({
        type: 'START_EDIT_CELL',
        payload: {
          rowIndex,
          columnKey: column.key,
          value: String(record[column.dataIndex as keyof DataRow<T>] ?? ''),
        },
      });
    },
    []
  );

  const saveCellEdit = useCallback(() => {
    if (!editingCell) return;
    const record = processedData[editingCell.rowIndex];
    const column = columns.find((col) => col.key === editingCell.columnKey);
    if (column && onCellEdit) {
      onCellEdit(record, column, editValue);
    }
    dispatch({ type: 'CANCEL_EDIT' });
  }, [editingCell, processedData, columns, onCellEdit, editValue]);

  const cancelCellEdit = useCallback(
    () => dispatch({ type: 'CANCEL_EDIT' }),
    []
  );

  const visibleColumnsData = useMemo<Column<Row<T>>[]>(
    () =>
      columns.filter((col) => visibleColumns.includes(col.key) && !col.hidden),
    [columns, visibleColumns]
  );

  const setSearchQueryCb = useCallback((query: string) => {
    dispatch({ type: 'SET_SEARCH_QUERY', payload: query });
  }, []);

  const handleExport = useCallback(async () => {
    // 1) If a custom export handler is provided by the parent, use it
    if (onExport) {
      await onExport(
        processedData as Row<T>[],
        visibleColumnsData as Column<Row<T>>[]
      );
      return;
    }

    // 2) Build export options: prefer explicit options, else use current visible columns and filters
    const columnsToExport = (exportOptions?.columns ??
      visibleColumnsData) as Column<Row<T>>[];
    const mergedFilters = exportOptions?.includeFilters
      ? { ...filters, ...(exportOptions?.filters ?? {}) }
      : exportOptions?.filters;

    const baseOptions: Omit<DownloadOptions<T>, 'rpcConfig'> = {
      fileName: exportOptions?.fileName,
      sheetName: exportOptions?.sheetName,
      maxRows: exportOptions?.maxRows,
      customStyles: exportOptions?.customStyles,
      columns: columnsToExport,
      filters: mergedFilters,
    };

    try {
      // 3) Use RPC-based download if rpcConfig is provided; otherwise, table/view download
      if (exportOptions?.rpcConfig) {
        const rpcOptions: DownloadOptions<T> & { rpcConfig: RPCConfig } = {
          ...baseOptions,
          rpcConfig: exportOptions.rpcConfig,
        };
        await rpcExcelDownload.mutateAsync(rpcOptions);
      } else {
        await tableExcelDownload.mutateAsync(baseOptions);
      }
    } catch (err) {
      // 4) Optional CSV fallback using currently processed rows
      if (exportOptions?.fallbackToCsv) {
        try {
          const headers = columnsToExport.map((c) => c.title).join(',');
          const keys = columnsToExport.map(
            (c) => c.dataIndex as keyof Row<T> & string
          );
          const rows = (processedData as Row<T>[])?.map((r) =>
            keys
              .map((k) => {
                const v = (r as Row<T>)[k] as unknown;
                if (v === null || v === undefined) return '';
                const s = String(v).replace(/"/g, '""');
                return `"${s}"`;
              })
              .join(',')
          );
          const csv = [headers, ...(rows || [])].join('\n');
          const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
          const link = document.createElement('a');
          const csvName =
            (exportOptions?.fileName?.replace(/\.xlsx$/i, '') || 'export') +
            '.csv';
          link.href = URL.createObjectURL(blob);
          link.download = csvName;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(link.href);
        } catch {
          // If CSV fallback also fails, rethrow original error
          throw err;
        }
      } else {
        throw err;
      }
    }
  }, [
    onExport,
    processedData,
    visibleColumnsData,
    exportOptions,
    filters,
    tableExcelDownload,
    rpcExcelDownload,
  ]);
  const hasActions = actions.length > 0;
  const isExporting =
    tableExcelDownload.isPending || rpcExcelDownload.isPending;

  return (
    <div 
      className={cn(
        "flex flex-col bg-white dark:bg-gray-800 rounded-lg max-h-[calc(100vh-250px)]", 
        bordered ? "border border-gray-200 dark:border-gray-700" : "shadow-md", 
        className
      )}
    >
      {/* Section 1: Toolbar and Filters (Non-scrolling) */}
      <div className="flex-shrink-0">
      <TableToolbar
        title={title}
        searchable={searchable}
        filterable={filterable}
        exportable={exportable}
        refreshable={refreshable}
        customToolbar={customToolbar}
        searchQuery={searchQuery}
        setSearchQuery={setSearchQueryCb}
        onSearchChange={onSearchChange}
        showFilters={showFilters}
        setShowFilters={() => dispatch({ type: 'TOGGLE_FILTERS' })}
        showColumnSelector={showColumnSelector}
        setShowColumnSelector={(show) =>
          dispatch({ type: 'TOGGLE_COLUMN_SELECTOR', payload: show })
        }
        showColumnsToggle={showColumnsToggle}
        columns={columns}
        visibleColumns={visibleColumns}
        setVisibleColumns={(cols: string[]) =>
          dispatch({ type: 'SET_VISIBLE_COLUMNS', payload: cols })
        }
        onRefresh={onRefresh}
        onExport={handleExport}
        loading={loading}
        isExporting={isExporting}
      />

      <TableFilterPanel
        columns={columns}
        filters={filters}
        setFilters={(f) =>
          dispatch({
            type: 'SET_FILTERS',
            payload:
              typeof f === 'function'
                ? (f as (prev: Filters) => Filters)(filters)
                : f,
          })
        }
        showFilters={showFilters}
        filterable={filterable}
      />
      </div>

      {/* Section 2: Scrollable Table Area */}
      <div className='flex-1 w-full overflow-auto min-h-0'>
        <table className={`min-w-full  w-full table-auto sm:table-fixed ${bordered ? "border-separate border-spacing-0" : ""}`}>
            <TableHeader
              columns={columns}
              visibleColumns={visibleColumnsData}
              selectable={selectable}
              sortable={sortable}
              bordered={bordered}
              density={density}
              actions={actions}
              hasActions={hasActions}
              sortConfig={sortConfig}
              onSort={handleSort}
              onSelectAll={handleSelectAll}
              allSelected={
                processedData.length > 0 &&
                selectedRows.length === processedData.length
              }
              hasData={processedData.length > 0}
            />
            <TableBody
              columns={columns}
              processedData={processedData}
              visibleColumns={visibleColumnsData}
              selectable={selectable}
              bordered={bordered}
              density={density}
              actions={actions}
              hasActions={hasActions}
              striped={striped}
              hoverable={hoverable}
              loading={loading}
              emptyText={emptyText}
              selectedRows={selectedRows}
              editingCell={editingCell}
              editValue={editValue}
              setEditValue={(value) =>
                dispatch({ type: 'SET_EDIT_VALUE', payload: value })
              }
              onRowSelect={handleRowSelect}
              onCellEdit={handleCellEdit}
              saveCellEdit={saveCellEdit}
              cancelCellEdit={cancelCellEdit}
              isLoading={loading}
            />
          </table>
      </div>

      {/* Section 3: Pagination (Non-scrolling) */}
      <div className="flex-shrink-0">
        <TablePagination pagination={pagination} bordered={bordered} />
      </div>
    </div>
  );
}

```

<!-- path: hnvtx/components/table/datatable-types.ts -->
```typescript
// @/components/table/types.ts
import { AuthTableOrViewName, Row, Filters } from "@/hooks/database";
import { Column, RPCConfig, ExcelStyles } from "@/hooks/database/excel-queries/excel-helpers";

export interface TableAction<T extends AuthTableOrViewName> {
  key: string;
  label: string;
  icon?: React.ReactNode;
  getIcon?: (record: Row<T>) => React.ReactNode;
  onClick: (record: Row<T>, index?: number) => void;
  variant?: "primary" | "secondary" | "danger" | "success";
  disabled?: boolean | ((record: Row<T>) => boolean);
  hidden?: boolean | ((record: Row<T>) => boolean);
  [key: string]: unknown;
}

export interface DownloadOptions<T extends AuthTableOrViewName> {
  fileName?: string;
  filters?: Filters;
  columns?: Column<Row<T>>[];
  sheetName?: string;
  maxRows?: number;
  customStyles?: ExcelStyles;
  rpcConfig?: RPCConfig;
}

export interface DataTableProps<T extends AuthTableOrViewName> {
  data: Row<T>[];
  tableName: T;
  columns: Column<Row<T>>[];
  loading?: boolean;
  showColumnSelector?: boolean;
  // Controls visibility of the Columns toggle button in the toolbar
  showColumnsToggle?: boolean;
  pagination?: {
    current: number;
    pageSize: number;
    total: number;
    showSizeChanger?: boolean;
    pageSizeOptions?: number[];
    onChange: (page: number, pageSize: number) => void;
  };
  actions?: TableAction<T>[];
  searchable?: boolean;
  // If true, DataTable will not perform client-side search and will delegate to parent via onSearchChange
  serverSearch?: boolean;
  filterable?: boolean;
  sortable?: boolean;
  selectable?: boolean;
  exportable?: boolean;
  refreshable?: boolean;
  density?: "compact" | "default" | "comfortable";
  bordered?: boolean;
  striped?: boolean;
  hoverable?: boolean;
  className?: string;
  emptyText?: string;
  title?: string;
  onRefresh?: () => void;
  // Called when the search query changes; useful for server-side search or fetching more rows
  onSearchChange?: (query: string) => void;
  onExport?: (data: Row<T>[], columns: Column<Row<T>>[]) => void | Promise<void>;
  onRowSelect?: (selectedRows: Row<T>[]) => void;
  onCellEdit?: (record: Row<T>, column: Column<Row<T>>, newValue: string) => void;
  customToolbar?: React.ReactNode;
  exportOptions?: {
    fileName?: string;
    sheetName?: string;
    includeFilters?: boolean;
    maxRows?: number;
    rpcConfig?: RPCConfig;
    fallbackToCsv?: boolean;
  } & Omit<DownloadOptions<T>, "rpcConfig">;
}

export type SortDirection = "asc" | "desc";
export interface SortConfig<T> {
  key: keyof T & string;
  direction: SortDirection;
}

export type TablePaginationProps = Pick<DataTableProps<AuthTableOrViewName>, 'pagination' | 'bordered'>;

```

<!-- path: hnvtx/components/table/TablePagination.tsx -->
```typescript
// @/components/table/TablePagination.tsx
import React from "react";
import { FiChevronLeft, FiChevronRight, FiChevronsLeft, FiChevronsRight } from "react-icons/fi";
import { TablePaginationProps } from "@/components/table/datatable-types";
import { DEFAULTS } from "@/config/constants";



export function TablePagination({ pagination, bordered }: TablePaginationProps) {
  if (!pagination || pagination.total <= 0) return null;

  return (
    <div className={`px-4 py-3 ${bordered ? "border-t border-gray-200 dark:border-gray-700" : ""} flex flex-col sm:flex-row items-center justify-between gap-4`}>
      <div className='flex items-center gap-4 text-sm text-gray-700 dark:text-gray-300'>
        <span>
          Showing {(pagination.current - 1) * pagination.pageSize + 1} to {Math.min(pagination.current * pagination.pageSize, pagination.total)} of {pagination.total} results
        </span>
        {pagination.showSizeChanger && (
          <select
            value={pagination.pageSize}
            onChange={(e) => pagination.onChange(1, Number(e.target.value))}
            className='px-2 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700'
          >
            {(pagination.pageSizeOptions || DEFAULTS.PAGE_SIZE_OPTIONS).map((size) => (
              <option key={size} value={size}>
                {size} per page
              </option>
            ))}
          </select>
        )}
      </div>
      <div className='flex items-center gap-2'>
        <button
          onClick={() => pagination.onChange(1, pagination.pageSize)}
          disabled={pagination.current === 1}
          className='p-2 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed'
        >
          <FiChevronsLeft size={16} />
        </button>
        <button
          onClick={() => pagination.onChange(pagination.current - 1, pagination.pageSize)}
          disabled={pagination.current === 1}
          className='p-2 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed'
        >
          <FiChevronLeft size={16} />
        </button>
        <span className='px-4 py-2 text-sm text-gray-700 dark:text-gray-300'>
          Page {pagination.current} of {Math.ceil(pagination.total / pagination.pageSize)}
        </span>
        <button
          onClick={() => pagination.onChange(pagination.current + 1, pagination.pageSize)}
          disabled={pagination.current >= Math.ceil(pagination.total / pagination.pageSize)}
          className='p-2 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed'
        >
          <FiChevronRight size={16} />
        </button>
        <button
          onClick={() => pagination.onChange(Math.ceil(pagination.total / pagination.pageSize), pagination.pageSize)}
          disabled={pagination.current >= Math.ceil(pagination.total / pagination.pageSize)}
          className='p-2 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed'
        >
          <FiChevronsRight size={16} />
        </button>
      </div>
    </div>
  );
}
```

<!-- path: hnvtx/components/table/TableBody.tsx -->
```typescript
// @/components/table/TableBody.tsx
import React, { useRef, useEffect } from "react";
import { FiEdit3, FiCheck, FiX } from "react-icons/fi";
import { DataTableProps, TableAction } from "@/components/table/datatable-types";
import { AuthTableOrViewName, Row } from "@/hooks/database";
import { Column } from "@/hooks/database/excel-queries/excel-helpers";
import { TruncateTooltip } from "@/components/common/TruncateTooltip";
import { TableSkeleton } from "@/components/common/ui/table/TableSkeleton";
 

// Define a type for your row that guarantees a unique identifier
type DataRow<T extends AuthTableOrViewName> = Row<T> & { id: string | number };

interface TableBodyProps<T extends AuthTableOrViewName> extends Pick<DataTableProps<T>, "columns" | "selectable" | "bordered" | "density" | "striped" | "hoverable" | "loading" | "emptyText"> {
  actions?: TableAction<T>[];
  processedData: DataRow<T>[];
  visibleColumns: Column<Row<T>>[];
  hasActions: boolean;
  selectedRows: DataRow<T>[];
  editingCell: { rowIndex: number; columnKey: string } | null;
  editValue: string;
  setEditValue: (value: string) => void;
  onRowSelect: (record: DataRow<T>, selected: boolean) => void;
  onCellEdit: (record: DataRow<T>, column: Column<Row<T>>, rowIndex: number) => void;
  saveCellEdit: () => void;
  cancelCellEdit: () => void;
  isLoading: boolean;
}

interface TableRowProps<T extends AuthTableOrViewName> extends Omit<TableBodyProps<T>, 'processedData' | 'loading' | 'emptyText'> {
    record: DataRow<T>;
    rowIndex: number;
    isSelected: boolean;
}

const densityClasses = { compact: "py-1 px-3", default: "py-3 px-4", comfortable: "py-4 px-6" };

// Base Table Row component (generic). We'll memoize it below with a type assertion to preserve generics.
function TableRowBase<T extends AuthTableOrViewName>({
    record,
    rowIndex,
    isSelected,
    visibleColumns,
    selectable,
    bordered,
    density,
    actions,
    hasActions,
    striped,
    hoverable,
    selectedRows,
    editingCell,
    editValue,
    setEditValue,
    onRowSelect,
    onCellEdit,
    saveCellEdit,
    cancelCellEdit,
    // isLoading,
}: TableRowProps<T>) {
    const editInputRef = useRef<HTMLInputElement>(null);

    useEffect(() => {
        if (editingCell && editingCell.rowIndex === rowIndex) {
            editInputRef.current?.focus();
            editInputRef.current?.select();
        }
    }, [editingCell, rowIndex]);

    // Loading UI is handled at the TableBodyBase level.
    
    return (
        <tr
          className={`${striped && rowIndex % 2 === 1 ? "bg-gray-50/50 dark:bg-gray-700/25" : ""} ${hoverable ? "hover:bg-gray-50 dark:hover:bg-gray-700/50" : ""} ${
            isSelected ? "bg-blue-50 dark:bg-blue-900/20" : ""
          } transition-colors`}>
          {selectable && (
            <td className={`w-12 px-4 py-3 whitespace-nowrap overflow-hidden ${bordered ? `${rowIndex < selectedRows.length - 1 ? "border-b" : ""} border-r border-gray-200 dark:border-gray-700` : ""}`}
                style={{ width: 48, minWidth: 48, maxWidth: 48 }}>
              <input type='checkbox' checked={isSelected} onChange={(e) => onRowSelect(record, e.target.checked)} className='rounded border-gray-300 text-blue-600 focus:ring-blue-500' aria-label={`Select row ${rowIndex + 1}`} />
            </td>
          )}
          {hasActions && (
            <td className={`w-32 ${densityClasses[density ?? "default"]} text-right whitespace-nowrap overflow-hidden ${bordered ? `${rowIndex < selectedRows.length - 1 ? "border-b" : ""} border-gray-200 dark:border-gray-700` : ""}`}
                style={{ width: 128, minWidth: 128, maxWidth: 128 }}>
              <div className='flex items-center justify-end gap-1'>
                {actions?.map((action) => {
                  const isHidden = typeof action.hidden === 'function' ? action.hidden(record) : action.hidden;
                  if (isHidden) return null;
                  
                  const isDisabled = typeof action.disabled === 'function' ? action.disabled(record) : action.disabled;
                  const variants = {
                    primary: "text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",
                    secondary: "text-gray-600 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",
                    danger: "text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300",
                    success: "text-green-600 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",
                  };
                  
                  const icon = action.getIcon ? action.getIcon(record) : action.icon;
                  const variant = action.variant || 'secondary';
                  
                  return (
                    <button
                      key={action.key}
                      onClick={() => !isDisabled && action.onClick(record, rowIndex)}
                      disabled={isDisabled}
                      className={`p-1 rounded transition-colors ${isDisabled ? "opacity-50 cursor-not-allowed" : variants[variant]}`}
                      title={action.label}
                    >
                      {icon}
                    </button>
                  );
                })}
              </div>
            </td>
          )}
          {visibleColumns.map((column, colIndex) => (
            <td
              key={column.key}
              className={`${densityClasses[density ?? "default"]} text-sm text-gray-900 dark:text-white whitespace-nowrap ${column.align === "center" ? "text-center" : column.align === "right" ? "text-right" : ""} ${
                column.editable ? "cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600/50" : ""
              } ${bordered ? `${rowIndex < selectedRows.length - 1 ? "border-b" : ""} ${colIndex < visibleColumns.length - 1 || hasActions ? "border-r" : ""} border-gray-200 dark:border-gray-700` : ""} overflow-hidden`}
              style={{
                width: column.width,
                minWidth: column.width ? undefined : "100px",
                maxWidth: "350px"
              }}
              onClick={() => column.editable && onCellEdit(record, column, rowIndex)}>
              {editingCell?.rowIndex === rowIndex && editingCell?.columnKey === column.key ? (
                <div className='flex items-center gap-2'>
                  <input
                    ref={editInputRef}
                    type='text'
                    value={editValue}
                    onChange={(e) => setEditValue(e.target.value)}
                    onKeyDown={(e) => {
                      if (e.key === "Enter") saveCellEdit();
                      if (e.key === "Escape") cancelCellEdit();
                    }}
                    className='flex-1 px-2 py-1 text-sm border border-blue-500 rounded bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500'
                  />
                  <button onClick={saveCellEdit} className='p-1 text-green-600 hover:text-green-700' aria-label="Save cell edit">
                    <FiCheck size={14} />
                  </button>
                  <button onClick={cancelCellEdit} className='p-1 text-red-600 hover:text-red-700' aria-label="Cancel cell edit">
                    <FiX size={14} />
                  </button>
                </div>
              ) : (
                <div className='flex items-center gap-2 group min-w-0'>
                  {column.render ? (
                    column.render(
                      record[column.dataIndex as keyof DataRow<T>],
                      record,
                      rowIndex
                    )
                  ) : (
                    <TruncateTooltip
                      text={String(record[column.dataIndex as keyof DataRow<T>] ?? "—")}
                      className="text-sm"
                    />
                  )}
                  {column.editable && <FiEdit3 size={12} className='opacity-0 group-hover:opacity-50 text-gray-400' />}
                </div>
              )}
            </td>
          ))}
        </tr>
    );
}

// Memoized Table Row component for performance optimization (preserve generics via assertion)
const MemoizedTableRow = React.memo(TableRowBase) as <T extends AuthTableOrViewName>(
  props: TableRowProps<T>
) => React.ReactElement;

// Base TableBody component (generic). We'll memoize with a type assertion below to preserve generics.
function TableBodyBase<T extends AuthTableOrViewName>({
  processedData,
  visibleColumns,
  loading,
  emptyText,
  ...rest
}: TableBodyProps<T>) {

  if (loading) {
    return (
      <tbody>
        <tr>
          <td colSpan={visibleColumns.length + (rest.selectable ? 1 : 0) + (rest.hasActions ? 1 : 0)} className={rest.bordered ? "border-b border-gray-200 dark:border-gray-700" : ""}>
            <div className='py-6'>
              <TableSkeleton
                rows={processedData.length || 5}
                columns={visibleColumns.length + (rest.selectable ? 1 : 0) + (rest.hasActions ? 1 : 0)}
                showHeader={false}
              />
            </div>
          </td>
        </tr>
      </tbody>
    );
  }

  if (processedData.length === 0) {
    return (
      <tbody>
        <tr>
          <td colSpan={visibleColumns.length + (rest.selectable ? 1 : 0) + (rest.hasActions ? 1 : 0)} className={rest.bordered ? "border-b border-gray-200 dark:border-gray-700" : ""}>
            <div className='text-center py-12'>
              <div className='text-gray-400 dark:text-gray-500 text-lg mb-2'>📄</div>
              <p className='text-gray-500 dark:text-gray-400'>{emptyText}</p>
            </div>
          </td>
        </tr>
      </tbody>
    );
  }

  const selectedRowIds = new Set(rest.selectedRows.map(r => (r as DataRow<T>).id));

  return (
    <tbody className={`bg-white dark:bg-gray-800 ${rest.striped && !rest.bordered ? "divide-y divide-gray-200 dark:divide-gray-700" : ""}`}>
      {processedData.map((record, rowIndex) => (
        <MemoizedTableRow
            key={record.id} // IMPORTANT: Use a stable, unique ID
            record={record}
            rowIndex={rowIndex}
            visibleColumns={visibleColumns}
            isSelected={selectedRowIds.has(record.id)}
            {...rest}
        />
      ))}
    </tbody>
  );
}

export const TableBody = React.memo(TableBodyBase) as <T extends AuthTableOrViewName>(
  props: TableBodyProps<T>
) => React.ReactElement;
```

<!-- path: hnvtx/components/table/action-helpers.ts -->
```typescript
import React from "react";
import {
  FiEdit2,
  FiTrash2,
  FiToggleLeft,
  FiToggleRight,
  FiEye,
} from "react-icons/fi";
import { RecordWithId } from "@/hooks/useCrudManager";

type ActionableRecord = RecordWithId & {
  status?: boolean | string | null; // Allow both boolean and string status
};

// Define a flexible TableAction type that can work with any record type
export interface TableAction<T = unknown> {
  key: string;
  label: string;
  icon?: React.ReactNode;
  getIcon?: (record: T) => React.ReactNode;
  onClick: (record: T, index?: number) => void;
  variant?: 'primary' | 'secondary' | 'danger' | 'success';
  disabled?: boolean | ((record: T) => boolean);
  hidden?: boolean | ((record: T) => boolean);
  // Additional properties that might be used by the DataTable
  [key: string]: unknown;
}

// Defines the shape of the handlers that a page component will provide.
// The helper is now generic over `V`, which represents the data type in the table row (e.g., UserProfileData)
interface StandardActionHandlers<V extends ActionableRecord> {
  onView?: (record: V) => void;
  onEdit?: (record: V) => void;
  onToggleStatus?: (record: V) => void;
  onDelete?: (record: V) => void;

  canEdit?: (record: V) => boolean;
  canDelete?: (record: V) => boolean;
}
/**
 * Creates a standardized array of TableAction objects for CRUD operations.
 * This ensures all tables have consistent icons, labels, variants, and behaviors.
 * @param handlers - An object containing the onClick handlers and optional logic for the actions.
 * @returns An array of TableAction<T> objects.
 */
export function createStandardActions<V extends ActionableRecord>({
  onView,
  onEdit,
  onToggleStatus,
  onDelete,
  canEdit = () => true, // By default, all actions are enabled
  canDelete = () => true,
}: StandardActionHandlers<V>): TableAction<V>[] {
  const actions: TableAction<V>[] = [];

  // Narrower type guard: only treat records with a boolean `status` as toggle-able
  const hasBooleanStatus = (record: V): record is V & { status: boolean } =>
    typeof (record as unknown as V)?.status === "boolean";

  // --- Toggle Status Actions (Activate/Deactivate) ---
  if (onToggleStatus) {
    actions.push({
      key: "toggleStatus",
      label: "Toggle Status",
      getIcon: (record: V) => 
        React.createElement(record.status ? FiToggleRight : FiToggleLeft, { 
          className: `w-4 h-4 ${record.status ? 'text-green-500' : 'text-gray-400'}`,
          size: 20
        }),
      variant: 'secondary',
      onClick: (record) => onToggleStatus(record),
      hidden: (record) => !hasBooleanStatus(record)
    });
  }

  // --- View Action ---
  if (onView) {
    actions.push({
      key: "view",
      label: "View Details",
      icon: React.createElement(FiEye),
      onClick: (record) => onView(record),
      variant: "secondary",
    });
  }

  // --- Edit Action ---
  if (onEdit) {
    actions.push({
      key: "edit",
      label: "Edit",
      icon: React.createElement(FiEdit2),
      onClick: (record) => onEdit(record),
      variant: "primary",
      disabled: (record) => !canEdit(record),
    });
  }

  // --- Delete Action ---
  if (onDelete) {
    actions.push({
      key: "delete",
      label: "Delete",
      icon: React.createElement(FiTrash2),
      onClick: (record) => onDelete(record),
      variant: "danger",
      disabled: (record) => !canDelete(record),
    });
  }

  return actions;
}

```

<!-- path: hnvtx/components/table/TableColumnSelector.tsx -->
```typescript
// @/components/table/TableColumnSelector.tsx
import React, { useEffect, useRef } from "react";
import { Column } from "@/hooks/database/excel-queries/excel-helpers";
import { AuthTableOrViewName, Row } from "@/hooks/database";

interface TableColumnSelectorProps<T extends AuthTableOrViewName> {
  columns: Column<Row<T>>[];
  visibleColumns: string[];
  setVisibleColumns: (columns: string[]) => void;
  showColumnSelector: boolean;
  setShowColumnSelector: (show: boolean) => void;
}

export function TableColumnSelector<T extends AuthTableOrViewName>({
  columns,
  visibleColumns,
  setVisibleColumns,
  showColumnSelector,
  setShowColumnSelector,
}: TableColumnSelectorProps<T>) {
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    function handleClickOutside(e: MouseEvent) {
      const el = containerRef.current;
      if (el && !el.contains(e.target as Node)) {
        setShowColumnSelector(false);
      }
    }
    if (showColumnSelector) {
      document.addEventListener('mousedown', handleClickOutside, false);
    }
    return () => {
      document.removeEventListener('mousedown', handleClickOutside, false);
    };
  }, [showColumnSelector, setShowColumnSelector]);

  if (!showColumnSelector) return null;

  return (
    <>
      {/* Dropdown content; positioning handled by parent wrapper */}
      <div
        className='mt-2 w-64 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg'
        onClick={(e) => e.stopPropagation()}
        onMouseDown={(e) => e.stopPropagation()}
        onPointerDown={(e) => e.stopPropagation()}
        ref={containerRef}
      >
        <div className='p-3 border-b border-gray-200 dark:border-gray-700'>
          <h4 className='font-medium text-gray-900 dark:text-white'>Show/Hide Columns</h4>
        </div>
        <div className='p-2 max-h-64 overflow-y-auto'>
          {columns.map((column) => (
            <label
              key={column.key}
              className='flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer'
              onMouseDown={(e) => e.preventDefault()}
              onClick={(e) => e.stopPropagation()}
            >
              <input
                type='checkbox'
                checked={visibleColumns.includes(column.key)}
                onClick={(e) => e.stopPropagation()}
                onChange={(e) => {
                  setVisibleColumns(e.target.checked ? [...visibleColumns, column.key] : visibleColumns.filter((k) => k !== column.key));
                }}
                className='rounded border-gray-300 text-blue-600 focus:ring-blue-500'
              />
              <span className='text-sm text-gray-700 dark:text-gray-300'>{column.title}</span>
            </label>
          ))}
        </div>
      </div>
      {/* Click outside handled via document listener */}
    </>
  );
}
```

<!-- path: hnvtx/components/table/TableToolbar.tsx -->
```typescript
// @/components/table/TableToolbar.tsx
import React, { useState, useEffect, useRef } from "react";
import {
  FiSearch,
  FiFilter,
  FiDownload,
  FiRefreshCw,
  FiEye,
  FiChevronDown,
} from "react-icons/fi";
import { DataTableProps } from "@/components/table/datatable-types";
import { Column } from "@/hooks/database/excel-queries/excel-helpers";
import { Row } from "@/hooks/database";
import { TableColumnSelector } from "./TableColumnSelector";
import { AuthTableOrViewName } from "@/hooks/database";
import { useDebounce } from "@/hooks/useDebounce";
import { DEFAULTS } from "@/config/constants";

interface TableToolbarProps<T extends AuthTableOrViewName>
  extends Pick<
    DataTableProps<T>,
    | "searchable"
    | "filterable"
    | "exportable"
    | "refreshable"
    | "title"
    | "customToolbar"
    | "onRefresh"
    | "loading"
  > {
  searchQuery: string;
  setSearchQuery: (query: string) => void;
  onSearchChange?: (query: string) => void;
  showFilters: boolean;
  setShowFilters: (show: boolean) => void;
  showColumnSelector: boolean;
  setShowColumnSelector: (show: boolean) => void;
  showColumnsToggle?: boolean;
  columns: Column<Row<T>>[];
  visibleColumns: string[];
  setVisibleColumns: (cols: string[]) => void;
  onExport: () => void;
  isExporting: boolean;
}

export function TableToolbar<T extends AuthTableOrViewName>({
  title,
  searchable,
  filterable,
  exportable,
  refreshable,
  customToolbar,
  searchQuery,
  setSearchQuery,
  onSearchChange,
  showFilters,
  setShowFilters,
  showColumnSelector,
  setShowColumnSelector,
  showColumnsToggle,
  columns,
  visibleColumns,
  setVisibleColumns,
  onRefresh,
  onExport,
  loading,
  isExporting,
}: TableToolbarProps<T>) {
  const [internalSearchQuery, setInternalSearchQuery] = useState(searchQuery);
  const debouncedSearchQuery = useDebounce(internalSearchQuery, DEFAULTS.DEBOUNCE_DELAY);
  const setSearchQueryRef = useRef(setSearchQuery);
  const onSearchChangeRef = useRef(onSearchChange);

  // Keep refs in sync with latest props without retriggering the search effect
  useEffect(() => {
    setSearchQueryRef.current = setSearchQuery;
  }, [setSearchQuery]);
  useEffect(() => {
    onSearchChangeRef.current = onSearchChange;
  }, [onSearchChange]);

  // Only react to content changes, not function identity changes
  useEffect(() => {
    setSearchQueryRef.current(debouncedSearchQuery);
    onSearchChangeRef.current?.(debouncedSearchQuery);
  }, [debouncedSearchQuery]);

  useEffect(() => {
    setInternalSearchQuery(searchQuery);
  }, [searchQuery]);

  return (
    <div className="p-3 sm:p-4 border-b border-gray-200 dark:border-gray-700">
      {title && (
        <h3 className="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-3 sm:mb-4">
          {title}
        </h3>
      )}

      <div className="space-y-3 sm:space-y-0 sm:flex sm:justify-between sm:items-center">
        {customToolbar ? (
          <div className="w-full">{customToolbar}</div>
        ) : (
          <div className="flex flex-col gap-2 sm:gap-3 sm:flex-row sm:items-center sm:justify-between w-full">
            <div className="flex flex-col gap-2 sm:flex-row sm:items-center sm:flex-1 sm:gap-3">
              {searchable && (
                <div className="relative flex-1 sm:max-w-sm">
                  <FiSearch className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm sm:text-base" />
                  <input
                    type="text"
                    placeholder="Search..."
                    value={internalSearchQuery}
                    onChange={(e) => setInternalSearchQuery(e.target.value)}
                    className="w-full pl-9 sm:pl-10 pr-4 py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  />
                </div>
              )}
              {filterable && (
                <button
                  onClick={() => setShowFilters(!showFilters)}
                  className={`flex items-center justify-center gap-2 px-3 py-2 text-sm sm:text-base border rounded-lg transition-colors min-w-0 ${
                    showFilters
                      ? "border-blue-300 bg-blue-50 text-blue-700 dark:border-blue-600 dark:bg-blue-900/50 dark:text-blue-300"
                      : "border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"
                  }`}
                >
                  <FiFilter size={14} className="sm:w-4 sm:h-4" />
                  <span className="hidden sm:inline">Filters</span>
                  <span className="sm:hidden">Filter</span>
                </button>
              )}
            </div>
          </div>
        )}

        {/* Right-side controls should be available even when customToolbar is used */}
        <div className="flex w-full sm:w-auto sm:flex-none items-center gap-2 sm:gap-3 justify-end mt-1 sm:mt-0 ml-auto">
          {(showColumnsToggle || (!customToolbar && true)) && (
            <div className="relative">
              <button
                onClick={() => setShowColumnSelector(!showColumnSelector)}
                className="flex items-center justify-center gap-2 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300"
                aria-label="Show/Hide Columns"
              >
                <FiEye size={14} className="sm:w-4 sm:h-4" />
                <span className="hidden sm:inline">Columns</span>
                <FiChevronDown size={12} className="sm:w-3.5 sm:h-3.5" />
              </button>
              <div className="absolute right-0 top-full z-50">
                <TableColumnSelector
                  columns={columns.filter((c) => !c.hidden)}
                  visibleColumns={visibleColumns}
                  setVisibleColumns={setVisibleColumns}
                  showColumnSelector={showColumnSelector}
                  setShowColumnSelector={setShowColumnSelector}
                />
              </div>
            </div>
          )}

          {refreshable && onRefresh && (
            <button
              onClick={onRefresh}
              disabled={loading}
              className="p-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 disabled:opacity-50 flex-shrink-0"
              aria-label="Refresh data"
            >
              <FiRefreshCw
                size={14}
                className={`${loading ? "animate-spin" : ""}`}
              />
            </button>
          )}

          {exportable && (
            <button
              onClick={onExport}
              disabled={isExporting}
              className="flex items-center justify-center gap-2 px-3 py-2 text-sm bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white rounded-lg transition-colors"
            >
              <FiDownload size={14} />
              <span className="hidden sm:inline">
                {isExporting ? "Exporting..." : "Export"}
              </span>
            </button>
          )}
        </div>
      </div>
    </div>
  );
}

```

<!-- path: hnvtx/components/rings/RingModal.tsx -->
```typescript
"use client";

import React, { useCallback, useEffect, useMemo } from "react";
import { Modal } from "@/components/common/ui/Modal";
import { Option } from "@/components/common/ui/select/SearchableSelect";
import { createClient } from "@/utils/supabase/client";
import { Database, TablesInsert } from "@/types/supabase-types";
import { useTableInsert, useTableUpdate } from "@/hooks/database";
import { RingFormData, ringFormSchema } from "@/schemas";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { FormCard } from "@/components/common/form/FormCard";
import {
  FormInput,
  FormSearchableSelect,
  FormSwitch,
  FormTextarea,
} from "@/components/common/form/FormControls";

export type RingRow = Database["public"]["Tables"]["rings"]["Row"];
export type RingInsert = TablesInsert<"rings">;

interface RingModalProps {
  isOpen: boolean;
  onClose: () => void;
  editingRing?: RingRow | null;
  onCreated?: (ring: RingRow) => void;
  onUpdated?: (ring: RingRow) => void;
  ringTypes: Array<{ id: string; name: string; code: string | null }>;
  maintenanceAreas: Array<{ id: string; name: string; code: string | null }>;
}

export function RingModal({
  isOpen,
  onClose,
  editingRing,
  onCreated,
  onUpdated,
  ringTypes,
  maintenanceAreas,
}: RingModalProps) {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
    reset,
    control,
  } = useForm<RingFormData>({
    resolver: zodResolver(ringFormSchema),
    defaultValues: {
      name: "",
      description: null,
      ring_type_id: null,
      maintenance_terminal_id: null,
      status: true,
    },
  });

  const supabase = createClient();
  const { mutate: insertRing, isPending: creating } = useTableInsert(
    supabase,
    "rings"
  );
  const { mutate: updateRing, isPending: updating } = useTableUpdate(
    supabase,
    "rings"
  );

  const isEdit = useMemo(() => Boolean(editingRing), [editingRing]);

  // Memoized options for selects
  const ringTypeOptions: Option[] = useMemo(
    () =>
      (ringTypes || []).map(
        (rt) =>
          ({
            value: rt.id,
            label: `${rt.name}${rt.code ? ` (${rt.code})` : ""}`,
          } as Option)
      ),
    [ringTypes]
  );

  const maintenanceAreaOptions: Option[] = useMemo(
    () =>
      (maintenanceAreas || []).map(
        (a) =>
          ({
            value: a.id,
            label: `${a.name}${a.code ? ` (${a.code})` : ""}`,
          } as Option)
      ),
    [maintenanceAreas]
  );

  useEffect(() => {
    if (!isOpen) return;
    if (editingRing) {
      reset({
        name: editingRing.name ?? "",
        description: editingRing.description ?? null,
        status: editingRing.status ?? true,
        ring_type_id: editingRing.ring_type_id ?? null,
        maintenance_terminal_id: editingRing.maintenance_terminal_id ?? null,
      });
    } else {
      reset({
        name: "",
        description: null,
        status: true,
        ring_type_id: null,
        maintenance_terminal_id: null,
      });
    }
  }, [isOpen, editingRing, reset]);

  const handleClose = useCallback(() => {
    if (creating || updating) return;
    onClose();
  }, [creating, updating, onClose]);

  const onValidSubmit = useCallback(
    (formData: RingFormData) => {
      const submitData = {
        name: formData.name.trim(),
        description: formData.description,
        status: formData.status,
        ring_type_id: formData.ring_type_id,
        maintenance_terminal_id: formData.maintenance_terminal_id,
      };

      if (isEdit && editingRing) {
        updateRing(
          { id: editingRing.id, data: submitData as Partial<RingInsert> },
          {
            onSuccess: (data: unknown) => {
              onUpdated?.(Array.isArray(data) ? data[0] : data);
              onClose();
            },
          }
        );
      } else {
        insertRing(submitData as RingInsert, {
          onSuccess: (data: unknown) => {
            onCreated?.(Array.isArray(data) ? data[0] : data);
            onClose();
          },
        });
      }
    },
    [isEdit, editingRing, updateRing, insertRing, onUpdated, onCreated, onClose]
  );

  const submitting = creating || updating || isSubmitting;

  return (
    <Modal
      isOpen={isOpen}
      onClose={handleClose}
      title={isEdit ? "Edit Ring" : "Add Ring"}
      visible={false}
      className="h-screen w-screen transparent bg-gray-700 rounded-2xl"
    >
      <FormCard
        onSubmit={handleSubmit(onValidSubmit)}
        heightClass="min-h-calc(90vh - 200px)"
        title={isEdit ? "Edit Ring" : "Add Ring"}
        onCancel={handleClose}
        standalone
      >
        <FormInput
          name="name"
          label="Name"
          register={register}
          error={errors.name}
          disabled={submitting}
          placeholder="Enter ring name"
        />
        <FormSearchableSelect
          name="ring_type_id"
          label="Ring Type"
          control={control}
          error={errors.ring_type_id}
          disabled={submitting}
          placeholder="Select ring type"
          options={ringTypeOptions}
        />

        <FormSearchableSelect
          name="maintenance_terminal_id"
          label="Maintenance Terminal"
          control={control}
          error={errors.maintenance_terminal_id}
          disabled={submitting}
          placeholder="Select maintenance terminal"
          options={maintenanceAreaOptions}
        />

        <FormTextarea
          name="description"
          label="Description"
          control={control}
          error={errors.description}
          disabled={submitting}
          placeholder="Optional description"
        />
        <FormSwitch
          name="status"
          label="Status"
          control={control}
          error={errors.status}
          className="my-2"
        />
      </FormCard>
    </Modal>
  );
}

```

<!-- path: hnvtx/components/rings/RingsFilters.tsx -->
```typescript
import { FiSearch } from "react-icons/fi";

interface RingsFiltersProps {
  searchQuery: string;
  onSearchChange: (value: string) => void;
}

export function RingsFilters({ searchQuery, onSearchChange }: RingsFiltersProps) {
  return (
    <div className="w-full">
      <div className="flex-1 sm:max-w-md lg:max-w-xl">
        <div className="relative">
          <FiSearch className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4 sm:w-5 sm:h-5" />
          <input
            type="text"
            placeholder="Search rings..."
            value={searchQuery}
            onChange={(e) => onSearchChange(e.target.value)}
            className="w-full pl-9 sm:pl-10 pr-4 py-2.5 sm:py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
          />
        </div>
      </div>
    </div>
  );
}

export default RingsFilters;

```

<!-- path: hnvtx/components/navigation/sidebar-components/MobileSidebar.tsx -->
```typescript
"use client";

import { motion } from "framer-motion";
import { FiX } from "react-icons/fi";
import { NavItem } from "./NavItem";
import { QuickActions } from "./QuickActions";
import { mobileOverlayVariants, mobileSidebarVariants } from "./sidebar-types";
import { NavItem as NavItemType } from "./sidebar-types";

interface MobileSidebarProps {
  isCollapsed: boolean;
  setIsCollapsed: (collapsed: boolean) => void;
  navItems: NavItemType[];
  expandedItems: string[];
  toggleExpanded: (id: string) => void;
  setHoveredItem: (item: NavItemType | null) => void;
  pathname: string;
}

export const MobileSidebar = ({
  isCollapsed,
  setIsCollapsed,
  navItems,
  expandedItems,
  toggleExpanded,
  setHoveredItem,
  pathname,
}: MobileSidebarProps) => {
  const handleBackdropClick = () => {
    setIsCollapsed(true);
  };

  if (isCollapsed) return null;

  return (
    <>
      <motion.div 
        initial="hidden"
        animate="visible"
        exit="hidden"
        variants={mobileOverlayVariants}
        className="fixed inset-0 z-40 bg-black/50 backdrop-blur-sm" 
        aria-label="Sidebar backdrop" 
        onClick={handleBackdropClick}
      />
      <motion.aside
        initial="hidden"
        animate="visible"
        exit="hidden"
        variants={mobileSidebarVariants}
        transition={{ type: "spring", damping: 30, stiffness: 300 }}
        className="fixed top-0 left-0 z-50 flex h-full w-64 flex-col border-r border-gray-200 bg-white shadow-xl dark:border-gray-800 dark:bg-gray-900 dark:text-white"
      >
        <div className="flex h-16 items-center justify-between border-b border-gray-200 px-4 dark:border-gray-800">
          <h2 className="text-lg font-semibold text-gray-900 dark:text-gray-100">
            Navigation
          </h2>
          <button 
            onClick={() => setIsCollapsed(true)} 
            className="rounded-lg p-2 transition-colors hover:bg-gray-100 dark:hover:bg-gray-800" 
            aria-label="Close sidebar"
          >
            <FiX className="h-5 w-5" />
          </button>
        </div>
        
        <div className="flex-1 overflow-y-auto py-4">
          <nav className="space-y-1" role="navigation">
            {navItems.map((item) => (
              <NavItem
                key={item.id}
                item={item}
                isCollapsed={false}
                expandedItems={expandedItems}
                toggleExpanded={toggleExpanded}
                setHoveredItem={setHoveredItem}
              />
            ))}
          </nav>
          <QuickActions
            isCollapsed={false}
            pathname={pathname}
          />
        </div>
      </motion.aside>
    </>
  );
};
```

<!-- path: hnvtx/components/navigation/sidebar-components/sidebar-types.ts -->
```typescript
import { Database } from "@/types/supabase-types";
import { UserRole } from "@/types/user-roles";
import { ReactNode } from "react";

export type TableName = keyof Database["public"]["Tables"];

export interface SidebarProps {
  isCollapsed: boolean;
  setIsCollapsed: (collapsed: boolean) => void;
  showMenuFeatures: boolean;
}

export interface NavItem {
  id: string;
  label: string;
  icon: ReactNode;
  href?: string;
  children?: NavItem[];
  roles: UserRole[];
  external?: boolean;
}

// Animation variants
export const sidebarVariants = {
  expanded: { width: 260 },
  collapsed: { width: 64 }
};

export const mobileOverlayVariants = {
  hidden: { opacity: 0 },
  visible: { opacity: 1 }
};

export const mobileSidebarVariants = {
  hidden: { x: -260 },
  visible: { x: 0 }
};

export const contentVariants = {
  hidden: { opacity: 0, x: -10 },
  visible: { opacity: 1, x: 0 },
  exit: { opacity: 0, x: -10 }
};

export const submenuVariants = {
  hidden: { height: 0, opacity: 0 },
  visible: { height: "auto", opacity: 1 }
};
```

<!-- path: hnvtx/components/navigation/sidebar-components/NavItems.tsx -->
```typescript
import { UserRole } from "@/types/user-roles";
import { NavItem as NavItemType } from "@/components/navigation/sidebar-components/sidebar-types";
import { useMemo } from "react";
import {
  FiDatabase,
  FiHome,
  FiMap,
  FiUsers,
  FiServer,
  FiLayers,
  FiCpu,
  FiMapPin,
  FiList,
} from "react-icons/fi";
import { FaDiagramNext } from "react-icons/fa6";
import { BsPeople } from "react-icons/bs";
import { ImUserTie } from "react-icons/im";
import { GiLinkedRings } from "react-icons/gi";
import { AiFillMerge } from "react-icons/ai";

function NavItems() {
  const items: NavItemType[] = useMemo(
    () => [
      {
        id: "home",
        label: "Home",
        icon: <FiHome className="h-5 w-5" />,
        href: "/dashboard",
        roles: [
          UserRole.ADMIN,
          UserRole.VIEWER,
          UserRole.AUTHENTICATED,
          UserRole.CPANADMIN,
          UserRole.MAANADMIN,
          UserRole.SDHADMIN,
          UserRole.VMUXADMIN,
        ],
      },
      {
        id: "user-management",
        label: "User Management",
        icon: <FiUsers className="h-5 w-5" />,
        href: "/dashboard/users",
        roles: [],
      },
      {
        id: "employees",
        label: "Employees",
        icon: <BsPeople className="h-5 w-5" />,
        href: "/dashboard/employees",
        roles: [UserRole.ADMIN],
      },
      {
        id: "base-menu",
        label: "Base Structure",
        icon: <FiServer className="h-5 w-5" />,
        roles: [
          UserRole.ADMIN,
          UserRole.VIEWER,
          UserRole.AUTHENTICATED,
          UserRole.CPANADMIN,
          UserRole.MAANADMIN,
          UserRole.SDHADMIN,
          UserRole.VMUXADMIN,
        ],
        children: [
          {
            id: "designations",
            label: "Designations",
            icon: <ImUserTie className="h-5 w-5" />,
            href: "/dashboard/designations",
            roles: [],
          },
          {
            id: "categories",
            label: "Categories",
            icon: <FiLayers className="h-5 w-5" />,
            href: "/dashboard/categories",
            roles: [UserRole.ADMIN],
          },
          {
            id: "lookups",
            label: "Lookups",
            icon: <FiList className="h-5 w-5" />,
            href: "/dashboard/lookup",
            roles: [UserRole.ADMIN],
          },
          {
            id: "maintenance-areas",
            label: "Maintenance Areas",
            icon: <FiMapPin className="h-5 w-5" />,
            href: "/dashboard/maintenance-areas",
            roles: [UserRole.ADMIN],
          },
          {
            id: "rings",
            label: "Rings",
            icon: <GiLinkedRings className="h-5 w-5" />,
            href: "/dashboard/rings",
            roles: [UserRole.ADMIN],
          },
          {
            id: "nodes",
            label: "Nodes",
            icon: <FiCpu className="h-5 w-5" />,
            href: "/dashboard/nodes",
            roles: [UserRole.ADMIN],
          },
        ],
      },
      {
        id: "ofc-menu",
        label: "Optical Fiber Cable",
        href: "/dashboard/ofc",
        icon: <AiFillMerge className="h-5 w-5" />, // replaced non-existent TbCableData with a valid icon
        roles: [
          UserRole.ADMIN
        ]
      },
      {
        id: "systems",
        label: "Systems",
        icon: <FiDatabase className="h-5 w-5" />,
        href: "/dashboard/systems",
        roles: [UserRole.ADMIN],
      },
      {
        id: "diagrams",
        label: "Diagrams",
        icon: <FaDiagramNext className="h-5 w-5" />,
        href: "/dashboard/diagrams",
        roles: [UserRole.ADMIN],
      },
      {
        id: "map",
        label: "BTS Map",
        icon: <FiMap className="h-5 w-5" />,
        href: "https://www.google.com/maps/d/u/0/embed?mid=1dpO2c3Qt2EmLFxovZ14rcqkjrN6uqlvP&ehbc=2E312F&ll=22.485295672038035%2C88.3701163022461&z=14",
        roles: [
          UserRole.ADMIN,
          UserRole.VIEWER,
          UserRole.MAANADMIN,
          UserRole.SDHADMIN,
          UserRole.VMUXADMIN,
        ],
        external: true,
      },
    ],
    []
  );
  return items;
}

export default NavItems;

```

<!-- path: hnvtx/components/navigation/sidebar-components/NavItem.tsx -->
```typescript
"use client";

import { motion, AnimatePresence } from "framer-motion";
import { usePathname, useRouter } from "next/navigation";
import { FiChevronDown } from "react-icons/fi";
import { NavItem as NavItemType, submenuVariants } from "./sidebar-types";
import { useUserPermissions } from "@/hooks/useRoleFunctions";
import { toast } from "sonner";
import { UserRole } from "@/types/user-roles";
import { ButtonSpinner } from "@/components/common/ui/LoadingSpinner";
import { useState, useEffect } from "react";

interface NavItemProps {
  item: NavItemType;
  isCollapsed: boolean;
  depth?: number;
  expandedItems: string[];
  toggleExpanded: (id: string) => void;
  setHoveredItem: (item: NavItemType | null) => void;
}

export const NavItem = ({
  item,
  isCollapsed,
  depth = 0,
  expandedItems,
  toggleExpanded,
  setHoveredItem,
}: NavItemProps) => {
  const router = useRouter();
  const pathname = usePathname();
  const { isSuperAdmin, role } = useUserPermissions();
  const [isLoading, setIsLoading] = useState(false);
  const [navigatingTo, setNavigatingTo] = useState<string | null>(null);

  const hasPermission = (roles: UserRole[]) => {
    if (isSuperAdmin) return true;
    if (!roles || roles.length === 0) return false;
    return roles.includes(role as UserRole);
  };

  const isActive = () => {
    if (!item.href) return false;
    if (item.href === "/dashboard") {
      return pathname === "/dashboard";
    }
    return pathname.startsWith(item.href);
  };

  const handleItemClick = async (e: React.MouseEvent) => {
    if (!hasPermission(item.roles)) {
      e.preventDefault();
      toast.error("You are not authorized to access this section.");
      return;
    }
    
    if (item.children && item.children.length > 0) {
      e.preventDefault();
      toggleExpanded(item.id);
      return;
    }
    
    if (item.href) {
      try {
        setNavigatingTo(item.href);
        setIsLoading(true);
        if (item.external) {
          window.open(item.href, "_blank", "noopener,noreferrer");
          setIsLoading(false);
        } else {
          await router.push(item.href);
          // The loading state will be cleared by the effect below
        }
      } catch (error) {
        console.error("Navigation error:", error);
        toast.error("Failed to navigate. Please try again.");
        setIsLoading(false);
        setNavigatingTo(null);
      }
    }
  };

  // Clear loading state when the route changes
  useEffect(() => {
    if (pathname === navigatingTo) {
      setIsLoading(false);
      setNavigatingTo(null);
    }
  }, [pathname, navigatingTo]);

  if (!hasPermission(item.roles)) return null;

  const active = isActive();
  const hasChildren = item.children && item.children.length > 0;
  const isExpanded = expandedItems.includes(item.id);

  return (
    <div 
      key={item.id} 
      className="relative" 
      onMouseEnter={() => isCollapsed && hasChildren && setHoveredItem(item)} 
      onMouseLeave={() => isCollapsed && hasChildren && setHoveredItem(null)}
    >
      <div
        onClick={handleItemClick}
        className={`
          flex cursor-pointer items-center justify-between py-3 text-sm font-medium 
          transition-all duration-200 rounded-lg mx-2 mb-1
          ${active 
            ? "bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300 shadow-sm" 
            : "text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-800 hover:shadow-sm"
          } 
          ${isCollapsed ? "justify-center px-4" : `pr-4 ${depth > 0 ? "pl-8" : "pl-4"}`}
        `}
        role="button"
        tabIndex={0}
        onKeyDown={(e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            handleItemClick(e as unknown as React.MouseEvent);
          }
        }}
      >
        <div className="flex items-center space-x-3">
          <span className="flex-shrink-0">
            {isLoading && pathname !== item.href ? <ButtonSpinner size="xs" /> : item.icon}
          </span>
          {!isCollapsed && (
            <span className="truncate">
              {isLoading && pathname !== item.href ? 'Loading...' : item.label}
            </span>
          )}
        </div>
        {!isCollapsed && hasChildren && (
          <button
            onClick={(e) => {
              e.stopPropagation();
              toggleExpanded(item.id);
            }}
            className="p-1 rounded-md transition-colors hover:bg-gray-200 dark:hover:bg-gray-700"
            aria-label={isExpanded ? "Collapse" : "Expand"}
          >
            <motion.div 
              animate={{ rotate: isExpanded ? 0 : -90 }} 
              transition={{ duration: 0.2 }}
            >
              <FiChevronDown className="w-4 h-4" />
            </motion.div>
          </button>
        )}
      </div>
      
      {!isCollapsed && hasChildren && (
        <AnimatePresence initial={false}>
          {isExpanded && (
            <motion.div 
              initial="hidden"
              animate="visible"
              exit="hidden"
              variants={submenuVariants}
              transition={{ duration: 0.2 }}
              className="overflow-hidden"
            >
              <div className="ml-6 border-l-2 border-gray-200 dark:border-gray-700 pl-2">
                {item.children?.map((child) => (
                  <NavItem
                    key={child.id}
                    item={child}
                    isCollapsed={isCollapsed}
                    depth={depth + 1}
                    expandedItems={expandedItems}
                    toggleExpanded={toggleExpanded}
                    setHoveredItem={setHoveredItem}
                  />
                ))}
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      )}
    </div>
  );
};
```

<!-- path: hnvtx/components/navigation/sidebar-components/HoverMenu.tsx -->
```typescript
"use client";

import { motion, AnimatePresence } from "framer-motion";
import { NavItem as NavItemType } from "./sidebar-types";
import { useUserPermissions } from "@/hooks/useRoleFunctions";
import { useRouter } from "next/navigation";
import { toast } from "sonner";
import { UserRole } from "@/types/user-roles";

interface HoverMenuProps {
  hoveredItem: NavItemType | null;
  setHoveredItem: (item: NavItemType | null) => void;
}

export const HoverMenu = ({ hoveredItem, setHoveredItem }: HoverMenuProps) => {
  const router = useRouter();
  const { isSuperAdmin, role } = useUserPermissions();

  const hasPermission = (roles: UserRole[]) => {
    if (isSuperAdmin) return true;
    if (!roles || roles.length === 0) return false;
    return roles.includes(role as UserRole);
  };

  const handleChildClick = (e: React.MouseEvent, child: NavItemType) => {
    e.stopPropagation();
    if (!hasPermission(child.roles)) {
      toast.error("You are not authorized to access this section.");
      return;
    }
    if (child.href) {
      router.push(child.href);
      setHoveredItem(null);
    }
  };

  return (
    <AnimatePresence>
      {hoveredItem?.children && (
        <motion.div
          initial={{ opacity: 0, x: 10, scale: 0.95 }}
          animate={{ opacity: 1, x: 0, scale: 1 }}
          exit={{ opacity: 0, x: 10, scale: 0.95 }}
          transition={{ duration: 0.15 }}
          className="fixed left-16 z-[60] min-w-48 overflow-hidden rounded-lg bg-white shadow-xl ring-1 ring-black/5 dark:bg-gray-800 dark:ring-white/10"
          style={{
            top: `${Math.max(80, Math.min(window.innerHeight - 200, 160))}px`,
          }}
          onMouseEnter={() => setHoveredItem(hoveredItem)}
          onMouseLeave={() => setHoveredItem(null)}
        >
          <div className="py-2">
            {hoveredItem.children.map((child) => (
              <button
                key={child.id}
                onClick={(e) => handleChildClick(e, child)}
                disabled={!hasPermission(child.roles)}
                className={`
                  flex w-full items-center space-x-3 px-4 py-2 text-left text-sm transition-colors
                  ${hasPermission(child.roles) 
                    ? "text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700" 
                    : "text-gray-400 cursor-not-allowed dark:text-gray-600"
                  }
                `}
              >
                <span className="flex-shrink-0">{child.icon}</span>
                <span className="truncate">{child.label}</span>
              </button>
            ))}
          </div>
        </motion.div>
      )}
    </AnimatePresence>
  );
};
```

<!-- path: hnvtx/components/navigation/sidebar-components/QuickActions.tsx -->
```typescript
"use client";

import { motion, AnimatePresence } from "framer-motion";
import { FiChevronDown, FiSettings, FiUpload } from "react-icons/fi";
import { Input } from "@/components/common/ui/Input";
import { useRef, useState } from "react";
import { submenuVariants } from "./sidebar-types";
import { createClient } from "@/utils/supabase/client";
import { useUploadConfigStore } from "@/stores/useUploadConfigStore";
import { useExcelUpload } from "@/hooks/database/excel-queries";
import { toast } from "sonner";
import { TableName } from "@/hooks/database/queries-type-helpers";
import { useCurrentTableName } from "@/hooks/useCurrentTableName";

interface QuickActionsProps {
  isCollapsed: boolean;
  pathname: string;
}

export const QuickActions = ({ isCollapsed, pathname }: QuickActionsProps) => {
  const [showMenuSection, setShowMenuSection] = useState(true);
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  const [file, setFile] = useState<File | null>(null);
  const currentTableName = useCurrentTableName();

  // Don't show on dashboard or when collapsed
  const shouldHideFeatures =
    pathname === "/dashboard" || isCollapsed || !currentTableName;

  // Zustand integration
  const supabase = createClient();
  const fileInputRef = useRef<HTMLInputElement>(null);
  // const pageKey = currentTableName as string;

  // Get the config for this specific context from the store.
  const { configs } = useUploadConfigStore();
  const storeConfig = configs[currentTableName as string];
  // console.log("storeConfig", storeConfig);

  // Initialize the upload hook. Note that we don't know the table name here yet.
  const { mutate, isPending } = useExcelUpload(
    supabase,
    currentTableName as TableName,
    {
      onSuccess: (result) => {
        // ... success handler
        console.log("result", result);
        return result.successCount > 0
          ? toast.success(
              `Successfully uploaded ${result.successCount} of ${result.totalRows} records.`
            )
          : toast.error(`Failed to upload ${result.totalRows} records.`);
      },
      onError: (error) => {
        // ... error handler
        console.log(error);
      },
    }
  );

  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    const selectedFile = event.target.files?.[0];

    if (!selectedFile) {
      alert("Please select a file first!");
      return;
    }

    setFile(selectedFile);

    if (!storeConfig) {
      toast.error("Upload configuration is missing. Cannot proceed.");
      return;
    }

    mutate({
      file: selectedFile,
      columns: storeConfig.columnMapping,
      uploadType: storeConfig.uploadType,
      conflictColumn: storeConfig.conflictColumn,
    });

    if (fileInputRef.current) {
      fileInputRef.current.value = "";
    }
  };

  // Don't show on dashboard or when collapsed
  if (shouldHideFeatures) return null;

  return (
    <div className="mt-4 border-t border-gray-200 pt-4 dark:border-gray-700">
      <div
        onClick={() => setShowMenuSection(!showMenuSection)}
        className="flex cursor-pointer items-center justify-between py-2 px-4 mx-2 rounded-lg text-sm font-medium text-gray-700 transition-colors duration-200 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-800"
      >
        <div className="flex items-center space-x-3">
          <FiSettings className="h-5 w-5 flex-shrink-0" />
          <span>Quick Actions</span>
        </div>
        <motion.div
          animate={{ rotate: showMenuSection ? 0 : -90 }}
          transition={{ duration: 0.2 }}
        >
          <FiChevronDown className="h-4 w-4" />
        </motion.div>
      </div>

      <AnimatePresence initial={false}>
        {showMenuSection && storeConfig?.isUploadEnabled && (
          <motion.div
            initial="hidden"
            animate="visible"
            exit="hidden"
            variants={submenuVariants}
            transition={{ duration: 0.2 }}
            className="overflow-hidden"
          >
            <div className="space-y-3 px-4 py-3">
              <div className="space-y-2">
                <h4 className="px-2 text-xs font-medium uppercase tracking-wide text-gray-500 dark:text-gray-400">
                  Upload data for:
                  <div className="flex">
                    <div className="font-bold ml-1 lowercase px-2 ">
                      {currentTableName}{" "}
                    </div>
                    <div className="uppercase">table</div>
                  </div>
                </h4>

                {/* Upload Excel Button */}
                <>
                  <Input
                    type="file"
                    accept=".xlsx, .xls"
                    ref={fileInputRef}
                    onChange={handleFileChange}
                    className="hidden"
                  />
                  <button
                    onClick={() => fileInputRef.current?.click()}
                    disabled={isPending || !currentTableName}
                    className="flex w-full items-center gap-2 rounded-md border border-gray-300 p-2 text-left text-xs transition-colors hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:hover:bg-gray-800"
                  >
                    <FiUpload className="h-3 w-3" />
                    <span>{isPending ? "Uploading..." : "Upload Excel"}</span>
                  </button>
                </>
              </div>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
};

```

<!-- path: hnvtx/components/navigation/sidebar.tsx -->
```typescript
"use client";

import { AnimatePresence, motion } from "framer-motion";
import { usePathname } from "next/navigation";
import { memo, useState, useCallback, useEffect } from "react";
import useIsMobile from "@/hooks/useIsMobile";

import { NavItem } from "@/components/navigation/sidebar-components/NavItem";
import { QuickActions } from "@/components/navigation/sidebar-components/QuickActions";
import { HoverMenu } from "@/components/navigation/sidebar-components/HoverMenu";
import { MobileSidebar } from "@/components/navigation/sidebar-components/MobileSidebar";
import { SidebarProps, NavItem as NavItemType, sidebarVariants, contentVariants } from "@/components/navigation/sidebar-components/sidebar-types";
import NavItems from "./sidebar-components/NavItems";
import { FiMenu, FiX } from "react-icons/fi";

const Sidebar = memo(({ isCollapsed, setIsCollapsed, showMenuFeatures }: SidebarProps) => {
  const pathname = usePathname();
  const [expandedItems, setExpandedItems] = useState<string[]>([]);
  const [hoveredItem, setHoveredItem] = useState<NavItemType | null>(null);
  const isMobile = useIsMobile();

  // Close mobile sidebar on route changes
  useEffect(() => {
    if (isMobile) {
      setIsCollapsed(true);
    }
  }, [pathname, isMobile, setIsCollapsed]);

  // Close hover menu when sidebar expands
  useEffect(() => {
    if (!isCollapsed) {
      setHoveredItem(null);
    }
  }, [isCollapsed]);

  

  const toggleExpanded = useCallback((id: string) => {
    setExpandedItems((prev) => (prev.includes(id) ? prev.filter((item) => item !== id) : [...prev, id]));
  }, []);


  if (isMobile) {
    return (
      <MobileSidebar
        isCollapsed={isCollapsed}
        setIsCollapsed={setIsCollapsed}
        navItems={NavItems()}
        expandedItems={expandedItems}
        toggleExpanded={toggleExpanded}
        setHoveredItem={setHoveredItem}
        pathname={pathname}
      />
    );
  }

  return (
    <motion.aside
      initial={false}
      animate={isCollapsed ? "collapsed" : "expanded"}
      variants={sidebarVariants}
      transition={{ duration: 0.3, ease: "easeInOut" }}
      className='fixed top-0 left-0 z-50 flex h-full flex-col border-r border-gray-200 bg-white shadow-lg dark:border-gray-800 dark:bg-gray-900 dark:text-white'>
      <div className='flex h-16 items-center justify-between border-b border-gray-200 px-4 dark:border-gray-800'>
        <AnimatePresence mode='wait'>
          {!isCollapsed && (
            <motion.h2 initial='hidden' animate='visible' exit='exit' variants={contentVariants} transition={{ duration: 0.2 }} className='text-lg font-semibold text-gray-900 dark:text-gray-100'>
              Navigation
            </motion.h2>
          )}
        </AnimatePresence>

        <button onClick={() => setIsCollapsed(!isCollapsed)} className='rounded-lg p-2 transition-colors hover:bg-gray-100 dark:hover:bg-gray-800' aria-label={isCollapsed ? "Expand sidebar" : "Collapse sidebar"}>
          <motion.div animate={{ rotate: isCollapsed ? 180 : 0 }} transition={{ duration: 0.2 }}>
            {isCollapsed ? <FiMenu className='h-5 w-5' /> : <FiX className='h-5 w-5' />}
          </motion.div>
        </button>
      </div>

      <div className='flex-1 overflow-y-auto py-4'>
        <nav className='space-y-1' role='navigation'>
          {NavItems().map((item) => (
            <NavItem key={item.id} item={item} isCollapsed={isCollapsed} expandedItems={expandedItems} toggleExpanded={toggleExpanded} setHoveredItem={setHoveredItem} />
          ))}
        </nav>
        {showMenuFeatures && <QuickActions isCollapsed={isCollapsed} pathname={pathname} />}
      </div>

      <HoverMenu hoveredItem={hoveredItem} setHoveredItem={setHoveredItem} />
    </motion.aside>
  );
});

Sidebar.displayName = "Sidebar";
export default Sidebar;

```

<!-- path: hnvtx/components/ofc-details/OfcDetailsHeader.tsx -->
```typescript
import React from 'react';
import { motion, Variants } from 'framer-motion';
import { Cable, Calendar, MapPin, Settings, Hash, Route, LucideIcon } from 'lucide-react';
import { StatusBadge } from '@/components/common/ui/badges/StatusBadge';
import { Row } from '@/hooks/database';

interface OfcDetailsHeaderProps {
    cable: Row<'v_ofc_cables_complete'>;
}
  
  const OfcDetailsHeader: React.FC<OfcDetailsHeaderProps> = ({ cable }) => {
    const containerVariants: Variants = {
      hidden: { opacity: 0 },
      visible: {
        opacity: 1,
        transition: {
          staggerChildren: 0.1,
          delayChildren: 0.2
        }
      }
    };
  
    const cardVariants: Variants = {
      hidden: { 
        opacity: 0, 
        y: 20,
        scale: 0.95
      },
      visible: { 
        opacity: 1, 
        y: 0,
        scale: 1,
        transition: {
          type: "spring" as const,
          stiffness: 100,
          damping: 15
        }
      }
    };
  
    const itemVariants: Variants = {
      hidden: { opacity: 0, x: -10 },
      visible: { 
        opacity: 1, 
        x: 0,
        transition: {
          type: "spring" as const,
          stiffness: 150,
          damping: 20
        }
      }
    };
  
    interface InfoItemProps {
      icon: LucideIcon;
      label: string;
      value: string;
      delay?: number;
    }
  
    const InfoItem: React.FC<InfoItemProps> = ({ icon: Icon, label, value }) => (
      <motion.div 
        variants={itemVariants}
        className="flex items-center justify-between py-3 px-1 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors duration-200"
      >
        <div className="flex items-center gap-3">
          <div className="p-1.5 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400">
            <Icon size={16} />
          </div>
          <span className="text-gray-600 dark:text-gray-400 font-medium text-sm">
            {label}
          </span>
        </div>
        <span className="font-semibold text-gray-900 dark:text-gray-100 text-sm max-w-[60%] text-right truncate">
          {value}
        </span>
      </motion.div>
    );
  
    return (
      <motion.div 
        variants={containerVariants}
        initial="hidden"
        animate="visible"
        className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"
      >
        {/* Summary Card */}
        <motion.div 
          variants={cardVariants}
          whileHover={{ 
            y: -2,
            boxShadow: "0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"
          }}
          className="group relative overflow-hidden rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-sm hover:shadow-lg transition-all duration-300"
        >
          {/* Gradient Background */}
          <div className="absolute inset-0 bg-gradient-to-br from-blue-50/50 via-transparent to-indigo-50/30 dark:from-blue-900/10 dark:via-transparent dark:to-indigo-900/10" />
          
          {/* Decorative Element */}
          <div className="absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-blue-100/20 to-transparent dark:from-blue-800/10 rounded-bl-full" />
          
          <div className="relative p-6">
            <motion.div 
              className="flex items-center gap-3 mb-6"
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.3 }}
            >
              <div className="p-2.5 rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg">
                <Cable size={20} />
              </div>
              <h2 className="text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent">
                Summary
              </h2>
            </motion.div>
            
            <motion.div 
              variants={containerVariants}
              className="space-y-1"
            >
              <InfoItem 
                icon={Hash}
                label="Asset No."
                value={String(cable.asset_no ?? '-')}
              />
              <InfoItem 
                icon={Route}
                label="Route Name"
                value={String(cable.route_name ?? '-')}
              />
              <motion.div 
                variants={itemVariants}
                className="flex items-center justify-between py-3 px-1 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors duration-200"
              >
                <div className="flex items-center gap-3">
                  <div className="p-1.5 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400">
                    <Settings size={16} />
                  </div>
                  <span className="text-gray-600 dark:text-gray-400 font-medium text-sm">
                    Status
                  </span>
                </div>
                <StatusBadge status={cable.status || 'Unknown'} />
              </motion.div>
            </motion.div>
          </div>
        </motion.div>
  
        {/* Metadata Card */}
        <motion.div 
          variants={cardVariants}
          whileHover={{ 
            y: -2,
            boxShadow: "0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"
          }}
          className="group relative overflow-hidden rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-sm hover:shadow-lg transition-all duration-300"
        >
          {/* Gradient Background */}
          <div className="absolute inset-0 bg-gradient-to-br from-emerald-50/50 via-transparent to-teal-50/30 dark:from-emerald-900/10 dark:via-transparent dark:to-teal-900/10" />
          
          {/* Decorative Element */}
          <div className="absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-emerald-100/20 to-transparent dark:from-emerald-800/10 rounded-bl-full" />
          
          <div className="relative p-6">
            <motion.div 
              className="flex items-center gap-3 mb-6"
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.4 }}
            >
              <div className="p-2.5 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-600 text-white shadow-lg">
                <Settings size={20} />
              </div>
              <h2 className="text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 dark:from-gray-100 dark:to-gray-300 bg-clip-text text-transparent">
                Metadata
              </h2>
            </motion.div>
            
            <motion.div 
              variants={containerVariants}
              className="space-y-1"
            >
              <InfoItem 
                icon={Cable}
                label="OFC Type"
                value={cable?.ofc_type_name || '-'}
              />
              <InfoItem 
                icon={MapPin}
                label="Maintenance Area"
                value={cable?.maintenance_area_name || '-'}
              />
              <InfoItem 
                icon={Calendar}
                label="Commissioned On"
                value={
                  cable.commissioned_on
                    ? new Date(String(cable.commissioned_on)).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                      })
                    : '-'
                }
              />
            </motion.div>
          </div>
        </motion.div>
      </motion.div>
    );
  };
  
  export default OfcDetailsHeader;
```

<!-- path: hnvtx/components/ofc-details/CableNotFound.tsx -->
```typescript
import { ButtonSpinner } from '@/components/common/ui';
import { motion } from 'framer-motion';

// Define animation variants outside for better portability and to resolve TypeScript inference issues

const containerVariants = {
  hidden: { opacity: 0, y: -20 },
  visible: {
    opacity: 1,
    y: 0,
    transition: {
      duration: 0.5,
      staggerChildren: 0.1, // for seamless animation orchestration.
    },
  },
} as const; // Add 'as const' to enforce literal types and resolve TS errors, as variants are objects of arbitrary string keys

const bannerVariants = {
  hidden: { x: -100, opacity: 0 },
  visible: {
    x: 0,
    opacity: 1,
    transition: {
      duration: 0.6,
      delay: 0.2,
      type: 'spring', // Specify as string literal; TypeScript may infer 'string' without 'as const', but 'spring' with stiffness/damping ensures proper typing.
      stiffness: 300,
      damping: 30,
    },
  },
} as const;

const textVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: { duration: 0.8, delay: 0.4 },
  },
} as const;

const buttonVariants = {
  hidden: { scale: 0.8, opacity: 0 },
  visible: {
    scale: 1,
    opacity: 1,
    transition: {
      duration: 0.5,
      delay: 0.6,
      type: 'spring',
      stiffness: 400,
      damping: 25,
    },
  },
  hover: {
    scale: 1.05,
    transition: { duration: 0.2 },
  },
  tap: {
    scale: 0.95,
    transition: { duration: 0.1 },
  },
} as const;

const CableNotFound = ({
  id,
  handleBackToOfcList,
  isBackClicked,
}: {
  id: string;
  handleBackToOfcList: () => void;
  isBackClicked: boolean;
}) => {
  return (
    <motion.div
      className="p-6"
      variants={containerVariants}
      initial="hidden"
      animate="visible"
    >
      <motion.div
        className="bg-gradient-to-r from-red-50 to-red-100 border-l-4 border-red-400 p-4 rounded-lg shadow-lg"
        variants={bannerVariants}
        initial="hidden"
        animate="visible"
      >
        <div className="flex">
          <div className="flex-shrink-0">
            <motion.svg
              className="h-5 w-5 text-red-400"
              viewBox="0 0 20 20"
              fill="currentColor"
              variants={bannerVariants}
              whileHover={{
                scale: 1.1,
                rotate: 5,
              }}
              whileTap={{ scale: 0.9 }}
            >
              <path
                fillRule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z"
                clipRule="evenodd"
              />
            </motion.svg>
          </div>
          <div className="ml-3">
            <motion.p
              className="text-sm text-red-700 font-semibold"
              variants={textVariants}
              initial="hidden"
              animate="visible"
            >
              OFC cable with ID {id} not found.
            </motion.p>
            <motion.button
              onClick={handleBackToOfcList}
              className="mt-2 text-sm text-blue-600 hover:text-blue-800 transition-colors duration-200 flex items-center gap-2"
              variants={buttonVariants}
              initial="hidden"
              animate="visible"
              whileHover="hover"
              whileTap="tap"
            >
              {isBackClicked ? <ButtonSpinner /> : ' Back to OFC List'}
            </motion.button>
          </div>
        </div>
      </motion.div>
    </motion.div>
  );
};

export default CableNotFound;

```

<!-- path: hnvtx/components/pwa/offline-status.tsx -->
```typescript
'use client'
 
import { useState, useEffect } from 'react'
import { MdWifiOff, MdWifi } from 'react-icons/md'
 
export default function OfflineStatus() {
  const [isOnline, setIsOnline] = useState(true)
  const [wasOffline, setWasOffline] = useState(false)
 
  useEffect(() => {
    const handleOnline = () => {
      setIsOnline(true)
      if (wasOffline) {
        // Show "Back online" message briefly
        setTimeout(() => setWasOffline(false), 3000)
      }
    }
 
    const handleOffline = () => {
      setIsOnline(false)
      setWasOffline(true)
    }
 
    window.addEventListener('online', handleOnline)
    window.addEventListener('offline', handleOffline)
 
    // Check initial status
    setIsOnline(navigator.onLine)
 
    return () => {
      window.removeEventListener('online', handleOnline)
      window.removeEventListener('offline', handleOffline)
    }
  }, [wasOffline])
 
  // Show offline message
  if (!isOnline) {
    return (
      <div className="fixed top-4 left-4 right-4 bg-red-500 text-white p-3 rounded-lg shadow-lg z-50">
        <div className="flex items-center space-x-2">
          <MdWifiOff className="h-5 w-5" />
          <span className="text-sm font-medium">You&apos;re offline</span>
        </div>
      </div>
    )
  }
 
  // Show "back online" message briefly
  if (isOnline && wasOffline) {
    return (
      <div className="fixed top-4 left-4 right-4 bg-green-500 text-white p-3 rounded-lg shadow-lg z-50">
        <div className="flex items-center space-x-2">
          <MdWifi className="h-5 w-5" />
          <span className="text-sm font-medium">Back online</span>
        </div>
      </div>
    )
  }
 
  return null
}
```

<!-- path: hnvtx/components/pwa/pwa-install-prompt.tsx -->
```typescript
'use client'
 
import { useState, useEffect } from 'react'
import { MdClose, MdDownload } from 'react-icons/md'
import { Button } from '../common/ui/Button'
 
interface BeforeInstallPromptEvent extends Event {
  readonly platforms: string[]
  readonly userChoice: Promise<{
    outcome: 'accepted' | 'dismissed'
    platform: string
  }>
  prompt(): Promise<void>
}
 
export default function PWAInstallPrompt() {
  const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null)
  const [showInstallPrompt, setShowInstallPrompt] = useState(false)
  const [isInstalled, setIsInstalled] = useState(false)
 
  useEffect(() => {
    // Check if app is already installed
    if (window.matchMedia('(display-mode: standalone)').matches) {
      setIsInstalled(true)
      return
    }
 
    // Listen for beforeinstallprompt event
    const handler = (e: Event) => {
      e.preventDefault()
      setDeferredPrompt(e as BeforeInstallPromptEvent)
      setShowInstallPrompt(true)
    }
 
    window.addEventListener('beforeinstallprompt', handler)
 
    // Listen for app installed event
    window.addEventListener('appinstalled', () => {
      setIsInstalled(true)
      setShowInstallPrompt(false)
    })
 
    return () => {
      window.removeEventListener('beforeinstallprompt', handler)
    }
  }, [])
 
  const handleInstallClick = async () => {
    if (!deferredPrompt) return
 
    deferredPrompt.prompt()
    const { outcome } = await deferredPrompt.userChoice
    
    if (outcome === 'accepted') {
      setDeferredPrompt(null)
      setShowInstallPrompt(false)
    }
  }
 
  const handleDismiss = () => {
    setShowInstallPrompt(false)
    setDeferredPrompt(null)
  }
 
  if (isInstalled || !showInstallPrompt) return null
 
  return (
    <div className="fixed bottom-4 left-4 right-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4 z-50">
      <div className="flex items-center justify-between">
        <div className="flex items-center space-x-3">
          <MdDownload className="h-6 w-6 text-blue-600" />
          <div>
            <h3 className="font-semibold text-sm">Install App</h3>
            <p className="text-xs text-gray-600 dark:text-gray-400">
              Install this app for a better experience
            </p>
          </div>
        </div>
        <div className="flex items-center space-x-2">
          <Button
            size="sm"
            onClick={handleInstallClick}
            className="bg-blue-600 hover:bg-blue-700"
          >
            Install
          </Button>
          <Button
            size="sm"
            variant="ghost"
            onClick={handleDismiss}
          >
            <MdClose className="h-4 w-4" />
          </Button>
        </div>
      </div>
    </div>
  )
}
```

<!-- path: hnvtx/components/users/user-types.ts -->
```typescript
import { Database } from "@/types/supabase-types";
import { Row } from "@/hooks/database";

export type UserProfileRow = Row<"v_user_profiles_extended">;

// Define a type for the user data row directly from the auto-generated Supabase types.
// This ensures type safety and that the type is always in sync with the database view.
export type UserProfileData = Database["public"]["Views"]["v_user_profiles_extended"]["Row"];
```

<!-- path: hnvtx/components/users/UserCreateModal.tsx -->
```typescript
import React from 'react';
import { Button } from '@/components/common/ui/Button';
import { Input } from '@/components/common/ui/Input';
import { useForm, Controller, useFormContext, type FieldValues, type UseFormReturn } from 'react-hook-form';
import { z } from 'zod';
import { zodResolver } from '@hookform/resolvers/zod';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/common/ui/select/Select';
import { Modal } from '@/components/common/ui/Modal/Modal';
import { FormCard, FormInput } from '@/components/common/form';
import { v4 as uuidv4 } from 'uuid';

const userSchema = z.object({
  id: z.string().uuid().optional(),
  email: z.email('Please enter a valid email address'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
  first_name: z.string().min(1, 'First name is required'),
  last_name: z.string().min(1, 'Last name is required'),
  role: z.string().min(1, 'Role is required'),
  email_confirm: z.boolean().catch(false), // ✅ ensures boolean
});

type UserFormData = z.infer<typeof userSchema>;

interface UserCreateModalProps {
  isOpen: boolean;
  onClose: () => void;
  onCreate: (data: UserFormData) => Promise<void>;
  isLoading: boolean;
}

export function UserCreateModal({
  isOpen,
  onClose,
  onCreate,
  isLoading,
}: UserCreateModalProps) {
  const form = useForm<UserFormData>({
    resolver: zodResolver(userSchema),
    defaultValues: {
      id: '',
      email: '',
      password: '',
      first_name: '',
      last_name: '',
      role: 'viewer',
      email_confirm: false, // ✅ always boolean
    },
  });

  const {
    register,
    handleSubmit,
    control,
    formState: { errors, isDirty, isValid },
    reset,
  } = form;

  const onValidSubmit = async (data: UserFormData) => {
    try {
      // Auto-generate UUID if not provided
      const payload = {
        ...data,
        id: data.id && data.id.trim() !== '' ? data.id : uuidv4(),
      };

      await onCreate(payload);
      reset();
      onClose();
    } catch (error: any) {
      console.error('Error creating user:', error);
    }
  };

  return (
    <Modal isOpen={isOpen} onClose={onClose} title="Create New User" size="md">
      <FormCard
        title="Create New User"
        onCancel={onClose}
        onSubmit={handleSubmit(onValidSubmit)}
        isLoading={isLoading}
      >
        <div className="space-y-4">
          {/* Optional ID */}
          <FormInput
            name="id"
            label="User ID (optional)"
            placeholder="Leave blank to auto-generate"
            register={register}
            error={errors.id}
          />

          <div className="grid grid-cols-2 gap-4">
            <FormInput
              name="first_name"
              label="First Name"
              register={register}
              error={errors.first_name}
              required
            />
            <FormInput
              name="last_name"
              label="Last Name"
              register={register}
              error={errors.last_name}
              required
            />
          </div>

          <FormInput
            name="email"
            placeholder="user@example.com"
            label="Email"
            error={errors.email}
            register={register}
            required
          />

          <FormInput
            name="password"
            type="password"
            placeholder="••••••••"
            label="Password"
            error={errors.password}
            register={register}
            required
          />

          {/* Role Select with Controller */}
          <Controller
            control={control}
            name="role"
            defaultValue="viewer" // ✅ add this
            render={({ field }) => (
              <div>
                <label className="block text-sm font-medium mb-1">Role</label>
                <Select onValueChange={field.onChange} value={field.value}>
                  <SelectTrigger>
                    <SelectValue placeholder="Select a role" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="viewer">Viewer</SelectItem>
                    <SelectItem value="admin">Admin</SelectItem>
                    <SelectItem value="maan_admin">MAAN Admin</SelectItem>
                    <SelectItem value="sdh_admin">SDH Admin</SelectItem>
                    <SelectItem value="vmux_admin">VMUX Admin</SelectItem>
                    <SelectItem value="mng_admin">MNG Admin</SelectItem>
                  </SelectContent>
                </Select>
                {errors.role && (
                  <p className="text-sm text-red-500 mt-1">
                    {errors.role.message}
                  </p>
                )}
              </div>
            )}
          />

          {/* Email Confirm Checkbox */}
          <Controller
            control={control}
            name="email_confirm"
            defaultValue={false} // ✅ add this
            render={({ field }) => (
              <label className="flex items-center space-x-2">
                <input
                  type="checkbox"
                  checked={field.value}
                  onChange={(e) => field.onChange(e.target.checked)}
                  className="h-4 w-4"
                />
                <span className="text-sm">Confirm Email Immediately</span>
              </label>
            )}
          />
        </div>
      </FormCard>
    </Modal>
  );
}

```

<!-- path: hnvtx/components/users/UserProfileEditModal.tsx -->
```typescript
"use client";

import React, { useEffect } from "react";
import { FiShield } from "react-icons/fi";
import { useAdminUpdateUserProfile, useGetMyRole, useIsSuperAdmin } from "@/hooks/useAdminUsers";
import { toast } from "sonner";
import { UserRole } from "@/types/user-roles";
import Image from "next/image";
import { useForm, Resolver, FieldErrors, Controller } from "react-hook-form";
import { UserProfileFormData, userProfileFormSchema } from "@/schemas"; // Use the main schema and type
import { zodResolver } from "@hookform/resolvers/zod";
import { FormInput, FormDateInput } from "../common/form/FormControls"; // Import your new controls
import { Button, Input, Label, Modal } from "@/components/common/ui";
import { FormCard } from "@/components/common/form/FormCard";
import { Theme } from "@/stores/themeStore";

interface UserProfileEditProps {
  user: UserProfileFormData | null;
  onClose: () => void;
  onSave?: () => void; // Optional callback for when save is successful
  isOpen: boolean;
}

// Helper to safely parse JSON-like data
const toObject = (val: unknown): Record<string, unknown> => {
  if (!val) return {};
  if (typeof val === "object") return val as Record<string, unknown>;
  return {};
};

const UserProfileEditModal: React.FC<UserProfileEditProps> = ({ isOpen, user, onClose, onSave }) => {
  // === React Hook Form Setup ===
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting, isDirty },
    reset,
    control,
    watch,
  } = useForm<UserProfileFormData>({
    resolver: zodResolver(userProfileFormSchema) as Resolver<UserProfileFormData>,
    // Initialize with empty defaults. We will populate it with an effect.
    defaultValues: {
      first_name: user?.first_name || "",
      last_name: user?.last_name || "",
      avatar_url: user?.avatar_url || "",
      phone_number: user?.phone_number || "",
      date_of_birth: user?.date_of_birth ? new Date(user.date_of_birth) : null,
      address: user?.address ? toObject(user.address) : {},
      preferences: user?.preferences ? toObject(user.preferences) : {},
      role: (user?.role as "admin" | "viewer" | "cpan_admin" | "maan_admin" | "sdh_admin" | "vmux_admin" | "mng_admin") || UserRole.VIEWER,
      designation: user?.designation || "",
      status: (user?.status as "active" | "inactive" | "suspended") || "inactive",
    },
  });

  useEffect(() => {
    if (!isOpen) return;
    if (user) {
      reset({
        first_name: user?.first_name || "",
        last_name: user?.last_name || "",
        avatar_url: user?.avatar_url || "",
        phone_number: user?.phone_number || "",
        date_of_birth: user?.date_of_birth ? new Date(user.date_of_birth) : null,
        address: user?.address ? toObject(user.address) : {},
        preferences: user?.preferences ? toObject(user.preferences) : {},
        role: (user?.role as "admin" | "viewer" | "cpan_admin" | "maan_admin" | "sdh_admin" | "vmux_admin" | "mng_admin") || UserRole.VIEWER,
        designation: user?.designation || "",
        status: (user?.status as "active" | "inactive" | "suspended") || "inactive",
      });
    } else {
      // If the modal is opened for a new user, reset to blank fields
      reset({
        first_name: "",
        last_name: "",
        avatar_url: "",
        phone_number: "",
        date_of_birth: null,
        address: {},
        preferences: {},
        role: UserRole.VIEWER,
        designation: "",
        status: "inactive",
      });
    }
  }, [isOpen, reset, user]);

  // Watch the avatar_url for live preview
  const avatarUrl = watch("avatar_url");

  // === Data Fetching and Mutation Hooks ===
  const { data: currentUserRole } = useGetMyRole();
  const { data: isSuperAdmin } = useIsSuperAdmin();
  const updateProfile = useAdminUpdateUserProfile();

  // === Form Submission Handler ===
  const onValidSubmit = async (data: UserProfileFormData) => {
    if (!isDirty) {
      toast.info("No changes to save.");
      onClose();
      return;
    }

    // Create the update payload only with changed fields
    const updateParams: { user_id: string; [key: string]: unknown } = { user_id: user?.id || "" };

    (Object.keys(data) as Array<keyof UserProfileFormData>).forEach((key) => {
      if (JSON.stringify(data[key]) !== JSON.stringify((user as UserProfileFormData)[key])) {
        // Special handling for date to ensure correct format
        if (key === "date_of_birth" && data.date_of_birth) {
          updateParams[`update_${key}`] = data.date_of_birth.toISOString().split("T")[0];
        } else {
          updateParams[`update_${key}`] = data[key];
        }
      }
    });

    try {
      await updateProfile.mutateAsync(updateParams);
      onSave?.(); // Call the parent's onSave to trigger refetch
    } catch (error) {
      // The hook itself will show a toast error message
      console.error("Update failed:", error);
    }
    onClose();
  };

  const onInvalidSubmit = (formErrors: FieldErrors<UserProfileFormData>) => {
    console.error("Form validation errors:", formErrors);
    toast.error("Please correct the errors before saving.");
  };

  return (
    <Modal isOpen={isOpen} onClose={onClose} title='Edit User Profile'>
      <FormCard onSubmit={handleSubmit(onValidSubmit, onInvalidSubmit)} title='Edit User Profile' onCancel={onClose}>
        <div className='p-6 space-y-6'>
          {/* Profile Image & URL */}
          <div className='flex items-center gap-4'>
            <Image src={avatarUrl || "/default-avatar.png"} alt='Profile' width={64} height={64} className='w-16 h-16 rounded-full object-cover bg-gray-200' />
            <div className='flex-1'>
              <FormInput<UserProfileFormData> name='avatar_url' label='Avatar URL' register={register} error={errors.avatar_url} placeholder='https://example.com/avatar.jpg' />
            </div>
          </div>

          {/* Name */}
          <div className='grid grid-cols-1 md:grid-cols-2 gap-4'>
            <FormInput<UserProfileFormData> name='first_name' label='First Name' register={register} error={errors.first_name} required />
            <FormInput<UserProfileFormData> name='last_name' label='Last Name' register={register} error={errors.last_name} required />
          </div>

          {/* Contact */}
          <div className='grid grid-cols-1 md:grid-cols-2 gap-4'>
            <FormInput<UserProfileFormData> name='phone_number' label='Phone Number' register={register} error={errors.phone_number} type='tel' />
            <FormDateInput<UserProfileFormData>
              name='date_of_birth'
              label='Date of Birth'
              control={control}
              error={errors.date_of_birth}
              placeholder='YYYY-MM-DD'
              pickerProps={{
                maxDate: new Date(),
                dateFormat: "yyyy-MM-dd",
                showMonthDropdown: true,
                showYearDropdown: true,
                yearDropdownItemNumber: 100,
                scrollableYearDropdown: true,
                withPortal: true,
                popperPlacement: "bottom-start",
              }}
            />
          </div>

          {/* Designation */}
          <FormInput<UserProfileFormData> name='designation' label='Designation' register={register} error={errors.designation} placeholder='e.g., Senior Engineer' />

          {/* *** THE FIX IS HERE: Use Controller for Address Fields *** */}
          <div>
            <Label>Address</Label>
            <div className='grid grid-cols-1 md:grid-cols-2 gap-4 mt-1'>
              <Controller name='address.street' control={control} render={({ field }) => <Input {...field} value={field.value || ""} placeholder='Street Address' error={errors.address?.street?.message} />} />
              <Controller name='address.city' control={control} render={({ field }) => <Input {...field} value={field.value || ""} placeholder='City' error={errors.address?.city?.message} />} />
              <Controller name='address.state' control={control} render={({ field }) => <Input {...field} value={field.value || ""} placeholder='State/Province' error={errors.address?.state?.message} />} />
              <Controller name='address.zip_code' control={control} render={({ field }) => <Input {...field} value={field.value || ""} placeholder='ZIP/Postal Code' error={errors.address?.zip_code?.message} />} />
            </div>
          </div>
          {/* Users Preferences */}
          <div>
            <Label>Preferences</Label>
            <div className='grid grid-cols-1 md:grid-cols-2 gap-4 mt-1'>
              <Label>Language</Label>
              <select id='language' {...register("preferences.language")} className='w-full mt-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white'>
                <option value='en'>English</option>
              </select>
            </div>
          </div>

          {(isSuperAdmin || currentUserRole === "admin") && (
            <div className='border-t border-gray-200 dark:border-gray-700 pt-6'>
              <h3 className='text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center gap-2'>
                <FiShield className='text-orange-500' /> Administrative Settings
              </h3>
              <div className='grid grid-cols-1 md:grid-cols-2 gap-4'>
                <div>
                  <Label htmlFor='role' required>
                    Role
                  </Label>
                  <select id='role' {...register("role")} className='w-full mt-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white'>
                    {Object.values(UserRole).map((role) => (
                      <option key={role} value={role}>
                        {role.replace(/_/g, " ").toUpperCase()}
                      </option>
                    ))}
                  </select>
                </div>
                <div>
                  <Label htmlFor='status' required>
                    Status
                  </Label>
                  <select id='status' {...register("status")} className='w-full mt-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white'>
                    <option value='active'>Active</option>
                    <option value='inactive'>Inactive</option>
                    <option value='suspended'>Suspended</option>
                  </select>
                </div>
              </div>
            </div>
          )}
        </div>
      </FormCard>
    </Modal>
  );
};

export default UserProfileEditModal;

```

<!-- path: hnvtx/components/users/BulkActions.tsx -->
```typescript
import { motion } from "framer-motion";
import { FiTrash2 } from "react-icons/fi";
import { UserRole } from "@/types/user-roles";

interface BulkActionsProps {
  selectedCount: number;
  isSuperAdmin: boolean;
  isOperationLoading: boolean;
  onBulkDelete: () => void;
  onBulkUpdateRole: (role: string) => void;
  onBulkUpdateStatus: (status: string) => void;
  onClearSelection: () => void;
}

export function BulkActions({
  selectedCount,
  isSuperAdmin,
  isOperationLoading,
  onBulkDelete,
  onBulkUpdateRole,
  onBulkUpdateStatus,
  onClearSelection,
}: BulkActionsProps) {
  if (selectedCount === 0) return null;

  return (
    <motion.div 
      initial={{ opacity: 0, y: -8 }} 
      animate={{ opacity: 1, y: 0 }} 
      className="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-6"
    >
      <div className="flex items-center justify-between">
        <p className="text-blue-900 dark:text-blue-200">
          {selectedCount} user(s) selected
        </p>
        <div className="flex items-center gap-3">
          <select
            onChange={(e) => e.target.value && onBulkUpdateRole(e.target.value)}
            defaultValue=""
            className="text-sm border rounded px-2 py-1 bg-white dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200"
            disabled={isOperationLoading}
          >
            <option value="">Set Role</option>
            {Object.values(UserRole).map((role) => (
              <option key={role} value={role}>
                {role.replace("_", " ").toUpperCase()}
              </option>
            ))}
          </select>
          <select
            onChange={(e) => e.target.value && onBulkUpdateStatus(e.target.value)}
            defaultValue=""
            className="text-sm border rounded px-2 py-1 bg-white dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200"
            disabled={isOperationLoading}
          >
            <option value="">Set Status</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
            <option value="suspended">Suspended</option>
            <option value="pending">Pending</option>
          </select>
          {isSuperAdmin && (
            <button
              onClick={onBulkDelete}
              disabled={isOperationLoading}
              className="bg-red-600 dark:bg-red-700 text-white px-3 py-1 rounded hover:bg-red-700 dark:hover:bg-red-800 text-sm disabled:opacity-50"
            >
              <FiTrash2 className="inline mr-1" /> Delete
            </button>
          )}
          <button
            onClick={onClearSelection}
            className="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 text-sm"
          >
            Cancel
          </button>
        </div>
      </div>
    </motion.div>
  );
}
```

<!-- path: hnvtx/components/users/UserFilters.tsx -->
```typescript
import { motion } from "framer-motion";
import { FiSearch, FiX, FiFilter, FiChevronDown, FiChevronUp } from "react-icons/fi";
import { UserRole } from "@/types/user-roles";

interface UserFiltersProps {
  searchQuery: string;
  roleFilter: string;
  statusFilter: string;
  emailVerificationFilter: string;
  showFilters: boolean;
  onSearchChange: (value: string) => void;
  onRoleFilterChange: (value: string) => void;
  onStatusFilterChange: (value: string) => void;
  onEmailVerificationFilterChange: (value: string) => void;
  onToggleFilters: () => void;
  onClearFilters: () => void;
}

export function UserFilters({
  searchQuery,
  roleFilter,
  statusFilter,
  emailVerificationFilter,
  showFilters,
  onSearchChange,
  onRoleFilterChange,
  onStatusFilterChange,
  onEmailVerificationFilterChange,
  onToggleFilters,
  onClearFilters,
}: UserFiltersProps) {
  const hasActiveFilters = !!(searchQuery || roleFilter || statusFilter || emailVerificationFilter);
  const activeFilterCount = [roleFilter, statusFilter, emailVerificationFilter].filter(Boolean).length;

  return (
    <div className="space-y-3 sm:space-y-4 w-full">
      {/* Search and Controls Row */}
      <div className="flex flex-col space-y-3 sm:space-y-0 sm:flex-row sm:gap-3 sm:justify-between sm:items-center">
        {/* Search Input */}
        <div className="flex-1 sm:max-w-md lg:max-w-xl">
          <div className="relative">
            <FiSearch className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4 sm:w-5 sm:h-5" />
            <input
              type="text"
              placeholder="Search users..."
              value={searchQuery}
              onChange={(e) => onSearchChange(e.target.value)}
              className="w-full pl-9 sm:pl-10 pr-4 py-2.5 sm:py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
            />
          </div>
        </div>

        {/* Filter and Clear Buttons */}
        <div className="flex gap-2 sm:gap-3">
          <button
            onClick={onToggleFilters}
            className={`flex items-center gap-2 px-3 sm:px-4 py-2.5 sm:py-2 border rounded-lg font-medium text-sm sm:text-base transition-all duration-200 flex-1 sm:flex-none justify-center sm:justify-start ${
              showFilters || activeFilterCount > 0
                ? "border-blue-500 bg-blue-50 text-blue-700 dark:border-blue-400 dark:bg-blue-900/30 dark:text-blue-300 shadow-sm"
                : "border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-400"
            }`}
          >
            <FiFilter size={16} className="w-4 h-4 sm:w-4 sm:h-4" />
            <span className="hidden sm:inline">Filters</span>
            <span className="sm:hidden">Filter</span>
            {showFilters ? (
              <FiChevronUp size={14} className="w-3 h-3 sm:w-3.5 sm:h-3.5" />
            ) : (
              <FiChevronDown size={14} className="w-3 h-3 sm:w-3.5 sm:h-3.5" />
            )}
            {activeFilterCount > 0 && (
              <span className="bg-blue-600 text-white text-xs rounded-full px-1.5 sm:px-2 py-0.5 font-semibold min-w-[18px] sm:min-w-[20px] text-center leading-none">
                {activeFilterCount}
              </span>
            )}
          </button>

          {hasActiveFilters && (
            <button
              onClick={onClearFilters}
              className="flex items-center gap-2 px-3 sm:px-4 py-2.5 sm:py-2 text-sm sm:text-base text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors font-medium border border-transparent hover:border-red-200 flex-shrink-0"
            >
              <FiX className="w-4 h-4" />
              <span className="hidden sm:inline">Clear All</span>
              <span className="sm:hidden">Clear</span>
            </button>
          )}
        </div>
      </div>

      {/* Collapsible Filter Panel */}
      {showFilters && (
        <motion.div
          initial={{ opacity: 0, height: 0 }}
          animate={{ opacity: 1, height: "auto" }}
          exit={{ opacity: 0, height: 0 }}
          transition={{ duration: 0.2, ease: "easeInOut" }}
          className="overflow-hidden"
        >
          <div className="p-3 sm:p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-600">
            {/* Mobile: Stack all filters, Desktop: Grid layout */}
            <div className="space-y-4 sm:space-y-0 sm:grid sm:grid-cols-2 lg:grid-cols-3 sm:gap-4">
              {/* Role Filter */}
              <div className="space-y-2">
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">
                  Filter by Role
                </label>
                <select
                  value={roleFilter}
                  onChange={(e) => onRoleFilterChange(e.target.value)}
                  className="w-full px-3 py-2.5 sm:py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                >
                  <option value="">All Roles</option>
                  {Object.values(UserRole).map((role) => (
                    <option key={role} value={role}>
                      {role.replace(/_/g, " ").replace(/\b\w/g, (l) => l.toUpperCase())}
                    </option>
                  ))}
                </select>
              </div>

              {/* Status Filter */}
              <div className="space-y-2">
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">
                  Filter by Status
                </label>
                <select
                  value={statusFilter}
                  onChange={(e) => onStatusFilterChange(e.target.value)}
                  className="w-full px-3 py-2.5 sm:py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                >
                  <option value="">All Status</option>
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                  <option value="suspended">Suspended</option>
                  <option value="pending">Pending</option>
                </select>
              </div>

              {/* Email Verification Filter */}
              <div className="space-y-2">
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">
                  Email Status
                </label>
                <select
                  value={emailVerificationFilter}
                  onChange={(e) => onEmailVerificationFilterChange(e.target.value)}
                  className="w-full px-3 py-2.5 sm:py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
                >
                  <option value="">All</option>
                  <option value="verified">Verified</option>
                  <option value="unverified">Unverified</option>
                </select>
              </div>
            </div>

            {/* Mobile: Show clear filters button inside panel */}
            {hasActiveFilters && (
              <div className="mt-4 pt-3 border-t border-gray-200 dark:border-gray-600 sm:hidden">
                <button
                  onClick={onClearFilters}
                  className="w-full flex items-center justify-center gap-2 px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors font-medium border border-red-200 dark:border-red-800"
                >
                  <FiX className="w-4 h-4" />
                  Clear All Filters
                </button>
              </div>
            )}
          </div>
        </motion.div>
      )}
    </div>
  );
}
```

<!-- path: hnvtx/components/auth/UnauthorizedModal.tsx -->
```typescript
// components/auth/UnauthorizedModal.tsx
"use client"

import { useState, useEffect } from "react";
import { useRouter } from "next/navigation";
import { UserRole } from "@/types/user-roles";

interface UnauthorizedModalProps {
  allowedRoles: UserRole[];
  currentRole?: string | null;
}

export const UnauthorizedModal: React.FC<UnauthorizedModalProps> = ({ 
  allowedRoles, 
  currentRole 
}) => {
  const [isOpen, setIsOpen] = useState(true);
  const router = useRouter();

  // Auto-close modal and redirect after 5 seconds
  useEffect(() => {
    const timer = setTimeout(() => {
      handleClose();
    }, 5000);

    return () => clearTimeout(timer);
  // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  const handleClose = () => {
    setIsOpen(false);
    // Redirect to dashboard or home page
    router.push("/dashboard");
  };

  const handleGoBack = () => {
    router.back();
    setIsOpen(false);
  };

  if (!isOpen) return null;

  const formatRole = (role: UserRole) => {
    return role.replace(/_/g, " ").replace(/\b\w/g, l => l.toUpperCase());
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center">
      {/* Backdrop */}
      <div 
        className="absolute inset-0 bg-black bg-opacity-50 transition-opacity"
        onClick={handleClose}
      />
      
      {/* Modal */}
      <div className="relative bg-white rounded-lg shadow-xl max-w-md mx-4 p-6 z-10">
        {/* Icon */}
        <div className="flex items-center justify-center w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full">
          <svg 
            className="w-8 h-8 text-red-600" 
            fill="none" 
            stroke="currentColor" 
            viewBox="0 0 24 24"
          >
            <path 
              strokeLinecap="round" 
              strokeLinejoin="round" 
              strokeWidth={2} 
              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z" 
            />
          </svg>
        </div>

        {/* Title */}
        <h3 className="text-lg font-semibold text-gray-900 text-center mb-2">
          Access Denied
        </h3>

        {/* Message */}
        <div className="text-sm text-gray-600 text-center mb-6">
          <p className="mb-3">
            You don&apos;t have permission to access this page.
          </p>
          <div className="bg-gray-50 rounded-md p-3">
            <p className="font-medium text-gray-700 mb-1">Required roles:</p>
            <p className="text-gray-600">
              {allowedRoles.map(formatRole).join(", ")}
            </p>
            {currentRole && (
              <>
                <p className="font-medium text-gray-700 mt-2 mb-1">Your current role:</p>
                <p className="text-gray-600">{currentRole}</p>
              </>
            )}
          </div>
        </div>

        {/* Actions */}
        <div className="flex flex-col sm:flex-row gap-3">
          <button
            onClick={handleGoBack}
            className="flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors"
          >
            Go Back
          </button>
          <button
            onClick={handleClose}
            className="flex-1 px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
          >
            Go to Dashboard
          </button>
        </div>

        {/* Auto-close notice */}
        <p className="text-xs text-gray-500 text-center mt-4">
          This modal will auto-close in 5 seconds
        </p>
      </div>
    </div>
  );
};
```

<!-- path: hnvtx/components/auth/terms.tsx -->
```typescript
import React from "react";

const Terms = () => {
  return (
    <div className='bg-gray-100 dark:bg-gray-900 min-h-screen'>
      <div className='container mx-auto px-4 py-8'>
        <h1 className='text-4xl font-bold text-center text-gray-800 dark:text-white mb-8'>Terms of Service</h1>
        <div className='bg-white dark:bg-gray-800 rounded-lg shadow-md p-8'>
          <p className='mb-4 text-gray-700 dark:text-gray-300'>Welcome to Harinavi Transmission Maintenance. These terms and conditions outline the rules and regulations for the use of our website.</p>
          <p className='mb-4 text-gray-700 dark:text-gray-300'>
            By accessing this website, we assume you accept these terms and conditions. Do not continue to use Harinavi Transmission Maintenance if you do not agree to all of the terms and conditions stated on this page.
          </p>

          <h2 className='text-2xl font-bold text-gray-800 dark:text-white mt-6 mb-4'>Intellectual Property Rights</h2>
          <p className='mb-4 text-gray-700 dark:text-gray-300'>
            Other than the content you own, under these Terms, Harinavi Transmission Maintenance and/or its licensors own all the intellectual property rights and materials contained in this Website.
          </p>

          <h2 className='text-2xl font-bold text-gray-800 dark:text-white mt-6 mb-4'>Restrictions</h2>
          <p className='mb-4 text-gray-700 dark:text-gray-300'>You are specifically restricted from all of the following:</p>
          <ul className='list-disc list-inside mb-4 text-gray-700 dark:text-gray-300'>
            <li>Publishing any Website material in any other media.</li>
            <li>Selling, sublicensing and/or otherwise commercializing any Website material.</li>
            <li>Publicly performing and/or showing any Website material.</li>
            <li>Using this Website in any way that is or may be damaging to this Website.</li>
          </ul>

          <h2 className='text-2xl font-bold text-gray-800 dark:text-white mt-6 mb-4'>No Warranties</h2>
          <p className='mb-4 text-gray-700 dark:text-gray-300'>
            This Website is provided "as is," with all faults, and Harinavi Transmission Maintenance expresses no representations or warranties, of any kind related to this Website or the materials contained on this Website.
          </p>

          <h2 className='text-2xl font-bold text-gray-800 dark:text-white mt-6 mb-4'>Limitation of Liability</h2>
          <p className='mb-4 text-gray-700 dark:text-gray-300'>
            In no event shall Harinavi Transmission Maintenance, nor any of its officers, directors and employees, be held liable for anything arising out of or in any way connected with your use of this Website.
          </p>

          <h2 className='text-2xl font-bold text-gray-800 dark:text-white mt-6 mb-4'>Contact Us</h2>
          <p className='text-gray-700 dark:text-gray-300'>If you have any questions about these Terms, please contact us at support@harinavi.com.</p>
        </div>
      </div>
    </div>
  );
};

export default Terms;

```

<!-- path: hnvtx/components/auth/ForgotPasswordForm.tsx -->
```typescript
// components/auth/ForgotPasswordForm.tsx
"use client";

import { useState } from "react";
import { motion } from "framer-motion";
import { toast } from "sonner";
import { FiMail, FiArrowLeft, FiLoader, FiCheck } from "react-icons/fi";
import Link from "next/link";
import { useAuth } from "@/hooks/useAuth";
import { isValidEmail } from "@/utils/validationUtils";
import { ButtonSpinner } from "../common/ui/LoadingSpinner";
import { useRouter } from "next/navigation";

export default function ForgotPasswordForm() {
  const [email, setEmail] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState("");
  const { forgotPassword } = useAuth();
  const router = useRouter();

  const validateEmail = isValidEmail(email);

  // Check if reset email was already sent
  const resetEmail = localStorage.getItem("reset_email_sent");
  const isResetEmailSent = () => {
    return !!resetEmail;
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError("");

    if (!email) {
      setError("Email is required");
      return;
    }
    if (!validateEmail) {
      setError("Invalid email format");
      return;
    }

    setIsLoading(true);

    try {
      const response = await forgotPassword(email);

      if (response.error) {
        console.error("Password reset failed:", response.error);
        setError(response.error || "Failed to send reset email");
        toast.error(response.error || "Failed to send reset email");
      } else {
        localStorage.setItem("reset_email_sent", email);
        isResetEmailSent() ? toast.success("Password reset email sent again!") : toast.success("Password reset email sent!");
        setEmail("");
        setError("");
      }
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : "An error occurred";
      setError(errorMessage);
      toast.error(errorMessage);
    } finally {
      setIsLoading(false);
    }
  };

  const handleResendEmail = async () => {
    setIsLoading(true);
    setError("");
    try {
      const response = await forgotPassword(localStorage.getItem("reset_email_sent") || "");

      if (response.error) {
        setError(response.error || "Failed to resend email");
        toast.error(response.error || "Failed to resend email");
      } else {
        localStorage.setItem("reset_email_sent", localStorage.getItem("reset_email_sent") || "");
        toast.success("Reset email sent again!");
      }
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : "An error occurred";
      setError(errorMessage);
      toast.error(errorMessage);
    } finally {
      setIsLoading(false);
    }
  };

  const clearResetState = () => {
    localStorage.removeItem("reset_email_sent");
  };

  if (isResetEmailSent()) {
    return (
      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className='w-full max-w-md mx-auto'>
        <div className='bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8'>
          <div className='text-center'>
            <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ delay: 0.2, type: "spring", stiffness: 200 }} className='w-16 h-16 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto mb-4'>
              <FiCheck className='w-8 h-8 text-green-600 dark:text-green-400' />
            </motion.div>

            <h2 className='text-2xl font-bold text-gray-900 dark:text-white mb-2'>Check Your Email</h2>

            <p className='text-gray-600 dark:text-gray-400 mb-6'>
              We&apos;ve sent a password reset link to your email address.
            </p>

            <div className='space-y-4'>
              <p className='text-sm text-gray-500 dark:text-gray-400'>Didn&apos;t receive the email? Check your spam folder or click below to resend.</p>

              <motion.button
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
                onClick={handleResendEmail}
                disabled={isLoading}
                className='w-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed'>
                {isLoading ? (
                  <div className='flex items-center justify-center'>
                    <FiLoader className='animate-spin mr-2' />
                    Resending...
                  </div>
                ) : (
                  "Resend Email"
                )}
              </motion.button>

              <motion.button
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
                onClick={()=>{setEmail(""); clearResetState(); router.push("/forgot-password")}}
                disabled={isLoading}
                className='w-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium py-3 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed'>
                {isLoading ? (
                  <div className='flex items-center justify-center'>
                    <FiLoader className='animate-spin mr-2' />
                    Clearing...
                  </div>
                ) : (
                  "Send Reset to anotherEmail"
                )}
              </motion.button>

              <Link 
                href='/login' 
                className='inline-flex items-center justify-center w-full text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 font-medium transition-colors'
                onClick={clearResetState}
              >
                <FiArrowLeft className='mr-2' />
                Back to Login
              </Link>
            </div>
          </div>

          {error && (
            <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} className='mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md'>
              <p className='text-red-600 dark:text-red-400 text-sm'>{error}</p>
            </motion.div>
          )}
        </div>
      </motion.div>
    );
  }

  return (
    <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className='w-full max-w-md mx-auto'>
      <div className='bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8'>
        <div className='text-center mb-8'>
          <h2 className='text-3xl font-bold text-gray-900 dark:text-white'>Forgot Password?</h2>
          <p className='text-gray-600 dark:text-gray-400 mt-2'>Enter your email address and we&apos;ll send you a link to reset your password.</p>
        </div>

        {error && (
          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} className='mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md'>
            <p className='text-red-600 dark:text-red-400 text-sm'>{error}</p>
          </motion.div>
        )}

        <form onSubmit={handleSubmit} className='space-y-6'>
          <div>
            <label htmlFor='email' className='block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2'>
              Email Address
            </label>
            <div className='relative'>
              <FiMail className='absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500' />
              <input
                id='email'
                name='email'
                type='email'
                autoComplete='email'
                required
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                className='w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400'
                placeholder='Enter your email address'
              />
            </div>
          </div>

          <motion.button
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
            type='submit'
            disabled={isLoading}
            className='w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-medium py-3 px-4 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:cursor-not-allowed'>
            {isLoading ? (
              <ButtonSpinner />
            ) : (
              "Send Reset Email"
            )}
          </motion.button>
        </form>

        <div className='mt-8 text-center'>
          <Link 
            href='/login' 
            className='inline-flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 font-medium transition-colors'
            onClick={clearResetState}
          >
            <FiArrowLeft className='mr-2' />
            Back to Login
          </Link>
        </div>
      </div>
    </motion.div>
  );
}

```

<!-- path: hnvtx/components/auth/OAuthProviders.tsx -->
```typescript
// components/auth/OAuthProviders.tsx
'use client';

import { OAuthButton } from '@/components/auth/OAuthButton';

interface OAuthProvidersProps {
  variant?: 'login' | 'signup';
  redirectTo?: string;
  providers?: string[];
  className?: string;
  showDivider?: boolean;
  dividerText?: string;
}

const defaultProviders: string[] = ['google'];

export default function OAuthProviders({
  variant = 'login',
  providers = defaultProviders,
  className = '',
  showDivider = true,
  dividerText,
}: OAuthProvidersProps) {
  const defaultDividerText = variant === 'signup' 
    ? 'Or sign up with email' 
    : 'Or continue with email';

  return (
    <div className={`space-y-4 ${className}`}>
      <div className="space-y-3">
        {providers.map((provider) => (
          <OAuthButton
            key={provider}
            provider={provider}
            variant={variant}
          />
        ))}
      </div>

      {showDivider && (
        <div className="relative">
          <div className="absolute inset-0 flex items-center">
            <div className="w-full border-t border-gray-300" />
          </div>
          <div className="relative flex justify-center text-sm">
            <span className="px-2 bg-white text-gray-500">
              {dividerText || defaultDividerText}
            </span>
          </div>
        </div>
      )}
    </div>
  );
}
```

<!-- path: hnvtx/components/auth/authButton.tsx -->
```typescript
// components/auth/authButton.tsx
'use client'
 
import Link from 'next/link'
import { useAuth } from '@/hooks/useAuth'
import { useAuthStore } from '@/stores/authStore'
import { BiLogOut, BiUser } from 'react-icons/bi'
import { CiSettings } from 'react-icons/ci'
import Image from 'next/image'
 
export default function AuthButton() {
  const { logout } = useAuth()
  const user = useAuthStore((state) => state.user)
 
  if (!user) {
    return (
      <div className="h-9 w-24 bg-gray-100 dark:bg-gray-800 animate-pulse rounded-lg border border-gray-200 dark:border-gray-700"></div>
    )
  }
 
  if (user) {
    return (
      <div className="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm min-w-[220px]">
        {/* User Info Header */}
        <div className="px-4 py-3 border-b border-gray-100 dark:border-gray-800">
          <div className="flex items-center space-x-3">
            <div className="flex-shrink-0">
              {user.user_metadata?.avatar_url ? (
                <Image
                  src={user.user_metadata.avatar_url}
                  alt="Avatar"
                  className="h-8 w-8 rounded-full ring-2 ring-gray-100 dark:ring-gray-800"
                  width={32}
                  height={32}
                />
              ) : (
                <div className="h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center">
                  <BiUser className="h-4 w-4 text-white" />
                </div>
              )}
            </div>
            <div className="flex-1 min-w-0">
              <p className="text-sm font-semibold text-gray-900 dark:text-gray-100 truncate">
                {user.user_metadata?.name || user.email?.split('@')[0] || 'User'}
              </p>
              <p className="text-xs text-gray-500 dark:text-gray-400 truncate">
                {user.email}
              </p>
            </div>
          </div>
        </div>

        {/* Menu Items */}
        <div className="py-2">
          <Link
            href="/onboarding"
            className="flex items-center px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group"
          >
            <CiSettings className="h-4 w-4 mr-3 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300" />
            <span className="font-medium">Update Profile</span>
          </Link>
          
          <button
            onClick={logout}
            className="w-full flex items-center px-4 py-2.5 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors group"
          >
            <BiLogOut className="h-4 w-4 mr-3 text-red-500 group-hover:text-red-600 dark:group-hover:text-red-400" />
            <span className="font-medium">Sign Out</span>
          </button>
        </div>
      </div>
    )
  }
 
  return (
    <div className="flex items-center space-x-3 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg px-4 py-2 shadow-sm">
      <Link
        href="/login"
        className="text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
      >
        Sign In
      </Link>
      <div className="h-4 w-px bg-gray-300 dark:bg-gray-600"></div>
      <Link
        href="/signup"
        className="inline-flex items-center px-3 py-1.5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white text-sm font-medium rounded-md transition-all duration-200 shadow-sm hover:shadow-md"
      >
        Get Started
      </Link>
    </div>
  )
}
```

<!-- path: hnvtx/components/auth/Protected.tsx -->
```typescript
"use client";

import { useState, useEffect, useRef } from "react";
import { useRouter } from "next/navigation";
import { PageSpinner } from "../common/ui/LoadingSpinner";
import { useUserPermissionsExtended } from "@/hooks/useRoleFunctions";
import { UserRole } from "@/types/user-roles";
import { UnauthorizedModal } from "./UnauthorizedModal";
import { useAuthStore } from "@/stores/authStore";

interface ProtectedProps {
  children: React.ReactNode;
  allowedRoles?: UserRole[];
  redirectTo?: string;
  fallbackComponent?: React.ReactNode;
}

type AuthState = "loading" | "authenticated" | "unauthenticated" | "unauthorized";

export const Protected: React.FC<ProtectedProps> = ({ children, allowedRoles, redirectTo = "/login", fallbackComponent }) => {
  const { role, isSuperAdmin, isLoading: isLoadingRole, canAccess } = useUserPermissionsExtended();
  const authState = useAuthStore((state) => state.authState);
  const user = useAuthStore((state) => state.user);
  const setAuthState = useAuthStore((state) => state.setAuthState);
  const router = useRouter();
  
  const [authStateExtended, setAuthStateExtended] = useState<AuthState>("loading");
  const hasRedirected = useRef(false);
  const [loadingStartTime] = useState(Date.now());
  const isOAuthFlow = useRef(false);
  const recheckTimeout = useRef<NodeJS.Timeout | null>(null);

  // Clean up timeouts on unmount
  useEffect(() => {
    return () => {
      if (recheckTimeout.current) {
        clearTimeout(recheckTimeout.current);
      }
    };
  }, []);

  // Detect OAuth callback flow (runs only once)
  useEffect(() => {
    const urlParams = new URLSearchParams(window.location.search);
    const pathname = window.location.pathname;
    const hasOAuthCode = urlParams.has('code');
    const isCallbackPath = pathname.includes('/auth/callback');
    const hasOAuthState = urlParams.has('state');
    isOAuthFlow.current = hasOAuthCode || isCallbackPath || hasOAuthState;
  }, []);

  const handleUnauthenticated = () => {
    if (authState === "unauthenticated" && !hasRedirected.current) {
      // console.log("handleUnauthenticated redirecting");
      // check non blocking way after 2 seconds
      setTimeout(() => {
        // Get current auth state from store instead of closure
        const currentAuthState = useAuthStore.getState().authState;
        if (currentAuthState === "unauthenticated" && !hasRedirected.current) {
          hasRedirected.current = true;
          router.replace(redirectTo);
        }
      }, 1000)
    }
  };

  useEffect(() => {
    // console.log("🔍 Protection Logic Debug:", {
    //   authState,
    //   user,
    //   isLoadingRole,
    //   allowedRoles,
    //   hasRedirected: hasRedirected.current,
    //   isOAuthFlow: isOAuthFlow.current,
    //   "user === null": user === null,
    //   "authState === 'loading'": authState === "loading",
    //   "timeElapsed": Date.now() - loadingStartTime
    // });

    // Clear any pending timeout
    if (recheckTimeout.current) {
      clearTimeout(recheckTimeout.current);
      recheckTimeout.current = null;
    }

    // If auth is explicitly unauthenticated, handle it
    if (authState === "unauthenticated") {
      // Only update state if it's not already unauthenticated to prevent unnecessary re-renders
      if (authStateExtended !== "unauthenticated") {
        setAuthStateExtended("unauthenticated");
      }
      // Don't call handleUnauthenticated here - we'll handle the redirect in the render phase
      return;
    }

    // Enhanced timeout for loading state
    const timeElapsed = Date.now() - loadingStartTime;
    const maxTimeout = isOAuthFlow.current ? 4000 : 2000;

    if (authState === "loading" && user === null && timeElapsed > maxTimeout) {
      // console.log("🚨 TIMEOUT: Force setting unauthenticated after", maxTimeout, "ms");
      setAuthState("unauthenticated");
      return;
    }

    // Only wait for role loading if we have role restrictions AND auth is complete
    const shouldWaitForRole = allowedRoles && allowedRoles.length > 0 && isLoadingRole;
    
    if (authState === "loading" || shouldWaitForRole) {
      setAuthStateExtended("loading");
      return;
    }

    // If we reach here, auth should be resolved
    if (authState === "authenticated" && user) {
      // Reset hasRedirected when we successfully authenticate
      hasRedirected.current = false;
      
      // Check role-based permissions if roles are specified
      if (allowedRoles && allowedRoles.length > 0) {
        if (canAccess(allowedRoles) || isSuperAdmin) {
          setAuthStateExtended("authenticated");
        } else {
          setAuthStateExtended("unauthorized");
        }
      } else {
        // No role restrictions, just authenticated
        setAuthStateExtended("authenticated");
      }
    }
  }, [authState, allowedRoles, canAccess, user, setAuthState, router, redirectTo, isLoadingRole, loadingStartTime]);

  // Don't render anything until we've determined the auth state
  if (authStateExtended === "loading") {
    return null; // Or <PageSpinner /> if you prefer
  }

  // Handle unauthenticated state
  if (authStateExtended === "unauthenticated") {
    // Use a timeout to prevent flash of content
    const handleRedirect = () => {
      if (!hasRedirected.current) {
        hasRedirected.current = true;
        router.replace(redirectTo);
      }
    };
    
    // Queue the redirect to the next tick to ensure we don't block rendering
    setTimeout(handleRedirect, 0);
    return null; // Or <PageSpinner /> if you prefer
  }

  // Handle unauthorized state
  if (authStateExtended === "unauthorized") {
    return fallbackComponent || <UnauthorizedModal allowedRoles={allowedRoles || []} currentRole={role} />;
  }

  // If we get here, user is authenticated and authorized
  return <>{children}</>;
};
```

<!-- path: hnvtx/components/auth/privacy.tsx -->
```typescript
import React from "react";

const Privacy = () => {
  return (
    <div className='bg-gray-100 dark:bg-gray-900 min-h-screen'>
      <div className='container mx-auto px-4 py-8'>
        <h1 className='text-4xl font-bold text-center text-gray-800 dark:text-white mb-8'>Privacy Policy</h1>
        <div className='bg-white dark:bg-gray-800 rounded-lg shadow-md p-8'>
          <p className='mb-4 text-gray-700 dark:text-gray-300'>Your privacy is important to us. It is Harinavi Transmission Maintenance's policy to respect your privacy regarding any information we may collect from you across our website.</p>
          <p className='mb-4 text-gray-700 dark:text-gray-300'>
            We only ask for personal information when we truly need it to provide a service to you. We collect it by fair and lawful means, with your knowledge and consent. We also let you know why we’re collecting it and how it will be used.
          </p>

          <h2 className='text-2xl font-bold text-gray-800 dark:text-white mt-6 mb-4'>Information We Collect</h2>
          <p className='mb-4 text-gray-700 dark:text-gray-300'>
            We may collect personal identification information from Users in a variety of ways, including, but not limited to, when Users visit our site, register on the site, and in connection with other activities, services, features or resources
            we make available on our Site.
          </p>

          <h2 className='text-2xl font-bold text-gray-800 dark:text-white mt-6 mb-4'>How We Use Your Information</h2>
          <p className='mb-4 text-gray-700 dark:text-gray-300'>We may use the information we collect for various purposes, including to:</p>
          <ul className='list-disc list-inside mb-4 text-gray-700 dark:text-gray-300'>
            <li>Provide, operate, and maintain our website</li>
            <li>Improve, personalize, and expand our website</li>
            <li>Understand and analyze how you use our website</li>
            <li>Develop new products, services, features, and functionality</li>
          </ul>

          <h2 className='text-2xl font-bold text-gray-800 dark:text-white mt-6 mb-4'>Security</h2>
          <p className='mb-4 text-gray-700 dark:text-gray-300'>The security of your personal information is important to us, but remember that no method of transmission over the Internet, or method of electronic storage, is 100% secure.</p>

          <h2 className='text-2xl font-bold text-gray-800 dark:text-white mt-6 mb-4'>Contact Us</h2>
          <p className='text-gray-700 dark:text-gray-300'>If you have any questions about this Privacy Policy, please contact us at support@harinavi.com.</p>
        </div>
      </div>
    </div>
  );
};

export default Privacy;

```

<!-- path: hnvtx/components/auth/OAuthButton.tsx -->
```typescript
// components/auth/OAuthButton.tsx
"use client";

import { useState, useEffect, useCallback } from "react";
import { useAuth } from "@/hooks/useAuth";
import { FaGoogle } from "react-icons/fa";
import { LoadingSpinner } from "../common/ui/LoadingSpinner/LoadingSpinner";

// Debug helper
const debug = (...args: unknown[]) => {
  if (process.env.NODE_ENV === "development") {
    console.log("[OAuthButton]", ...args);
  }
};

interface OAuthButtonProps {
  provider: string;
  variant?: "login" | "signup";
  className?: string;
  disabled?: boolean;
}

const providerConfig = {
  google: {
    name: "Google",
    icon: FaGoogle,
    bgColor: "bg-white hover:bg-gray-50",
    textColor: "text-gray-800",
  },
} as const;

export function OAuthButton({
  provider,
  variant = "login",
  className = "",
  disabled = false,
}: OAuthButtonProps) {
  const { signInWithGoogle, authState } = useAuth();
  const [isLocalLoading, setIsLocalLoading] = useState(false);
  const [isOAuthInProgress, setIsOAuthInProgress] = useState(false);

  // Handle OAuth sign-in
  const handleGoogleSignIn = useCallback(async () => {
    debug("handleGoogleSignIn called");

    // Prevent multiple clicks during loading
    if (isLocalLoading || authState === "loading") {
      debug("Already loading, ignoring click");
      return;
    }

    try {
      debug("Setting loading state");
      setIsLocalLoading(true);
      setIsOAuthInProgress(true);
      sessionStorage.setItem("oauth_in_progress", "true");

      // Force a re-render to show loading state
      await new Promise((resolve) => setTimeout(resolve, 0));

      debug("Calling signInWithGoogle");
      await signInWithGoogle();
      debug("signInWithGoogle completed");
    } catch (error) {
      debug("OAuth error:", error);
      sessionStorage.removeItem("oauth_in_progress");
      setIsOAuthInProgress(false);
      throw error;
    } finally {
      debug("Cleaning up");
      setIsLocalLoading(false);
      sessionStorage.removeItem("oauth_in_progress");
    }
  }, [isLocalLoading, authState, signInWithGoogle]);

  // Check for OAuth in progress on mount
  useEffect(() => {
    const checkOAuthStatus = () => {
      const inProgress = sessionStorage.getItem("oauth_in_progress") === "true";
      setIsOAuthInProgress(inProgress);
    };

    // Check immediately
    checkOAuthStatus();

    // Set up storage event listener for cross-tab sync
    const handleStorageChange = (e: StorageEvent) => {
      if (e.key === "oauth_in_progress") {
        checkOAuthStatus();
      }
    };

    window.addEventListener("storage", handleStorageChange);
    return () => window.removeEventListener("storage", handleStorageChange);
  }, []);

  // Combine all loading states
  const isLoading =
    isLocalLoading || authState === "loading" || isOAuthInProgress;
  const isButtonDisabled = disabled || isLoading;
  const config = providerConfig[provider as keyof typeof providerConfig];

  debug("Rendering with state:", {
    isLocalLoading,
    authState,
    isOAuthInProgress,
    isLoading,
  });

  return (
    <button
      onClick={handleGoogleSignIn}
      disabled={isButtonDisabled}
      data-loading={isLoading}
      className={[
        // Base layout and spacing
        "relative flex items-center justify-center gap-3 w-full px-6 py-3 rounded-xl",
        "font-semibold text-sm tracking-wide overflow-hidden",

        // Enhanced transitions and animations
        "transition-all duration-300 ease-out transform-gpu",

        // Background with gradient and glassmorphism effect
        config.bgColor || "bg-white border-2 border-gray-200/50",

        // Text styling
        config.textColor || "text-gray-700",

        // Interactive states with improved feedback
        isButtonDisabled
          ? "opacity-60 cursor-not-allowed scale-100"
          : [
              "hover:shadow-2xl hover:shadow-blue-500/20",
              "hover:-translate-y-1 hover:scale-[1.02]",
              "active:translate-y-0 active:scale-[0.98]",
              "focus:outline-none focus:ring-4 focus:ring-blue-500/20 focus:ring-offset-2",
              "hover:border-blue-300/60",
            ].join(" "),

        // Loading state animation
        isLoading && "animate-pulse",

        className,
      ]
        .filter(Boolean)
        .join(" ")
        .trim()}
      style={{
        transition: "all 300ms cubic-bezier(0.4, 0, 0.2, 1)",
        transform: "translateZ(0)",
        backfaceVisibility: "hidden",
        WebkitFontSmoothing: "antialiased",
        // Subtle gradient overlay
        background: isButtonDisabled
          ? undefined
          : `linear-gradient(135deg, ${
              config.bgColor || "rgba(255, 255, 255, 0.95)"
            }, ${config.bgColor || "rgba(249, 250, 251, 0.95)"})`,
        // Subtle inset shadow for depth
        boxShadow: isButtonDisabled
          ? undefined
          : "inset 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05)",
      }}
    >
      {/* Shimmer effect overlay for loading state */}
      {isLoading && (
        <div
          className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-shimmer"
          style={{
            animation: "shimmer 1.5s infinite",
            background:
              "linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent)",
            backgroundSize: "200% 100%",
          }}
        />
      )}

      {/* Icon container with enhanced styling */}
      <div
        className={[
          "flex items-center justify-center min-w-[24px] h-6 relative z-10",
          "transition-transform duration-300 ease-out",
          isLoading ? "animate-spin" : "group-hover:scale-110",
        ].join(" ")}
      >
        {isLoading ? (
          <div className="relative">
            <LoadingSpinner
              size="sm"
              className="h-5 w-5 text-current opacity-80"
            />
            <div className="absolute inset-0 animate-ping">
              <div className="h-5 w-5 rounded-full bg-current opacity-20" />
            </div>
          </div>
        ) : (
          <config.icon className="h-5 w-5 transition-all duration-300 filter drop-shadow-sm" />
        )}
      </div>

      {/* Text with enhanced typography */}
      <span
        className={[
          "relative z-10 whitespace-nowrap select-none",
          "transition-all duration-300 ease-out",
          isLoading ? "tracking-wider" : "group-hover:tracking-wide",
        ].join(" ")}
      >
        {isLoading ? (
          <span className="flex items-center gap-2">
            Connecting
            <span className="flex gap-1">
              <span
                className="w-1 h-1 bg-current rounded-full animate-bounce"
                style={{ animationDelay: "0ms" }}
              />
              <span
                className="w-1 h-1 bg-current rounded-full animate-bounce"
                style={{ animationDelay: "150ms" }}
              />
              <span
                className="w-1 h-1 bg-current rounded-full animate-bounce"
                style={{ animationDelay: "300ms" }}
              />
            </span>
          </span>
        ) : (
          `${variant === "signup" ? "Sign up" : "Continue"} with ${config.name}`
        )}
      </span>

      {/* Subtle highlight effect */}
      {!isButtonDisabled && !isLoading && (
        <div className="absolute inset-0 rounded-xl bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
      )}
    </button>
  );
}
<style jsx>{`
  @keyframes shimmer {
    0% {
      background-position: -200% 0;
    }
    100% {
      background-position: 200% 0;
    }
  }

  @keyframes bounce {
    0%,
    80%,
    100% {
      transform: translateY(0);
    }
    40% {
      transform: translateY(-4px);
    }
  }
`}</style>;

```

<!-- path: hnvtx/components/lookup/lookup-hooks.ts -->
```typescript
import { useRouter, useSearchParams } from "next/navigation";
import { useCallback, useState } from "react";
import { toast } from "sonner";
import { createClient } from "@/utils/supabase/client";
import { useDeduplicated, useTableDelete, useTableQuery, useToggleStatus } from "@/hooks/database";
import { type LookupType } from "@/schemas";

export function useLookupTypes(initialCategory = "") {
  const router = useRouter();
  const searchParams = useSearchParams();
  const [selectedCategory, setSelectedCategory] = useState(initialCategory || searchParams.get("category") || "");
  const [isLookupModalOpen, setIsLookupModalOpen] = useState(false);
  const [searchTerm, setSearchTerm] = useState("");
  const [editingLookup, setEditingLookup] = useState<LookupType | null>(null);

  const supabase = createClient();

  // Database hooks
  const {
    data: categories = [],
    isLoading: categoriesLoading,
    error: categoriesError,
    refetch: refetchCategories
  } = useDeduplicated(supabase, "lookup_types", {
    columns: ["category"],
    orderBy: [{ column: "created_at", ascending: true }],
  });

  const {
    data: lookupTypes = [],
    isLoading: lookupLoading,
    error: lookupError,
    refetch: refetchLookups
  } = useTableQuery(supabase, "lookup_types", {
    orderBy: [{ column: "name", ascending: true }],
    filters: {
      name: { operator: "neq", value: "DEFAULT" },
      ...(selectedCategory && { 
        category: { operator: "eq", value: selectedCategory } 
      })
    }
  });

  const { mutate: toggleStatus } = useToggleStatus(supabase, "lookup_types");
  const { mutate: deleteRowsById } = useTableDelete(supabase, "lookup_types");

  // Derived state
  const hasCategories = categories.length > 0;
  const hasSelectedCategory = !!selectedCategory;
  const isLoading = categoriesLoading || lookupLoading;
  
  const filteredLookups = lookupTypes
    .filter(lookup => 
      lookup.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      lookup.code?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      lookup.description?.toLowerCase().includes(searchTerm.toLowerCase())
    );

  // Handlers
  const handleCategoryChange = useCallback((category: string) => {
    setSelectedCategory(category);
    setSearchTerm("");
    router.push(`/dashboard/lookup${category ? `?category=${category}` : ''}`);
  }, [router]);

  const handleRefresh = useCallback(async () => {
    try {
      await Promise.all([refetchCategories(), refetchLookups()]);
      toast.success("Data refreshed successfully");
    } catch (error) {
      console.log(error);
      toast.error("Failed to refresh data");
    }
  }, [refetchCategories, refetchLookups]);

  const handleAddNew = useCallback(() => {
    if (!hasSelectedCategory) {
      toast.error("Please select a category first");
      return;
    }
    setEditingLookup(null);
    setIsLookupModalOpen(true);
  }, [hasSelectedCategory]);

  const handleEdit = useCallback((lookup: LookupType) => {
    setEditingLookup(lookup);
    setIsLookupModalOpen(true);
  }, []);

  const handleDelete = useCallback((id: string) => {
    deleteRowsById([id], {
      onSuccess: () => {
        toast.success("Lookup type deleted successfully");
        refetchLookups();
      },
      onError: (error: Error) => {
        toast.error(`Failed to delete lookup type: ${error.message}`);
      }
    });
  }, [deleteRowsById, refetchLookups]);

  const handleToggleStatus = useCallback((id: string, currentStatus: boolean) => {
    toggleStatus({ id, status: !currentStatus }, {
      onSuccess: () => {
        toast.success(`Lookup type ${currentStatus ? 'deactivated' : 'activated'} successfully`);
        refetchLookups();
      },
      onError: (error: Error) => {
        toast.error(`Failed to toggle status: ${error.message}`);
      }
    });
  }, [toggleStatus, refetchLookups]);

  const handleModalClose = useCallback(() => {
    setIsLookupModalOpen(false);
    setEditingLookup(null);
  }, []);

  const handleLookupCreated = useCallback(() => {
    toast.success("Lookup type created successfully");
    refetchLookups();
    handleModalClose();
  }, [refetchLookups, handleModalClose]);

  const handleLookupUpdated = useCallback(() => {
    toast.success("Lookup type updated successfully");
    refetchLookups();
    handleModalClose();
  }, [refetchLookups, handleModalClose]);

  return {
    state: {
      selectedCategory,
      isLookupModalOpen,
      searchTerm,
      editingLookup,
      categories,
      lookupTypes: filteredLookups,
      isLoading,
      hasCategories,
      hasSelectedCategory,
      categoriesError,
      lookupError
    },
    handlers: {
      setSearchTerm,
      handleCategoryChange,
      handleRefresh,
      handleAddNew,
      handleEdit,
      handleDelete,
      handleToggleStatus,
      handleModalClose,
      handleLookupCreated,
      handleLookupUpdated
    }
  };
}
```

<!-- path: hnvtx/components/lookup/LookupTypesTable.tsx -->
```typescript
"use client";

import { Button } from "@/components/common/ui/Button";
import { FiEdit2, FiTrash2, FiChevronUp, FiChevronDown } from "react-icons/fi";
import { type LookupType } from "@/schemas";
import { useMemo } from "react";
import { SortDirection } from "@/hooks/useSorting";

interface LookupTypesTableProps {
  lookups: LookupType[];
  onEdit: (lookup: LookupType) => void;
  onDelete: (id: string) => void;
  onToggleStatus: (id: string, currentStatus: boolean) => void;
  selectedCategory: string;
  searchTerm: string;
  onSort?: (key: string) => void;
  getSortDirection?: (key: string) => SortDirection;
}

interface SortableHeaderProps {
  children: React.ReactNode;
  sortKey: string;
  onSort?: (key: string) => void;
  getSortDirection?: (key: string) => SortDirection;
  className?: string;
}

function SortableHeader({ 
  children, 
  sortKey, 
  onSort, 
  getSortDirection, 
  className = "" 
}: SortableHeaderProps) {
  const sortDirection = getSortDirection?.(sortKey);
  const isSortable = onSort && getSortDirection;

  const handleClick = () => {
    if (onSort) {
      onSort(sortKey);
    }
  };

  if (!isSortable) {
    return (
      <th className={`px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 dark:text-gray-400 uppercase ${className}`}>
        {children}
      </th>
    );
  }

  return (
    <th 
      className={`px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 dark:text-gray-400 uppercase cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors select-none ${className}`}
      onClick={handleClick}
      role="button"
      tabIndex={0}
      onKeyDown={(e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          handleClick();
        }
      }}
      title={`Sort by ${String(children).toLowerCase()}`}
    >
      <div className="flex items-center justify-between group">
        <span>{children}</span>
        <div className="flex flex-col ml-1">
          {sortDirection === 'asc' ? (
            <FiChevronUp className="h-3 w-3 text-blue-500" />
          ) : sortDirection === 'desc' ? (
            <FiChevronDown className="h-3 w-3 text-blue-500" />
          ) : (
            <div className="opacity-0 group-hover:opacity-50 transition-opacity">
              <FiChevronUp className="h-3 w-3" />
            </div>
          )}
        </div>
      </div>
    </th>
  );
}

export function LookupTypesTable({
  lookups,
  onEdit,
  onDelete,
  onToggleStatus,
  selectedCategory,
  searchTerm,
  onSort,
  getSortDirection
}: LookupTypesTableProps) {

  // Filter lookups based on search term (if not already filtered externally)
  const filteredLookups = useMemo(() => {
    if (!searchTerm.trim()) return lookups;
    
    const lowerSearchTerm = searchTerm.toLowerCase();
    return lookups.filter(lookup => 
      lookup.name?.toLowerCase().includes(lowerSearchTerm) ||
      lookup.code?.toLowerCase().includes(lowerSearchTerm) ||
      lookup.description?.toLowerCase().includes(lowerSearchTerm)
    );
  }, [lookups, searchTerm]);

  const displayedLookups = searchTerm ? filteredLookups : lookups;

  return (
    <div className="overflow-x-auto">
      <table className="w-full">
        <thead className="bg-gray-50 dark:bg-gray-800">
          <tr>
            <SortableHeader 
              sortKey="name" 
              onSort={onSort} 
              getSortDirection={getSortDirection}
            >
              Name
            </SortableHeader>
            <SortableHeader 
              sortKey="code" 
              onSort={onSort} 
              getSortDirection={getSortDirection}
            >
              Short Code
            </SortableHeader>
            <SortableHeader 
              sortKey="description" 
              onSort={onSort} 
              getSortDirection={getSortDirection}
            >
              Description
            </SortableHeader>
            <SortableHeader 
              sortKey="status" 
              onSort={onSort} 
              getSortDirection={getSortDirection}
            >
              Status
            </SortableHeader>
            <th className="px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 dark:text-gray-400 uppercase">
              Actions
            </th>
          </tr>
        </thead>
        <tbody className="divide-y divide-gray-200 dark:divide-gray-700 bg-white dark:bg-gray-900">
          {displayedLookups.map((lookup) => (
            <tr key={lookup.id} className="hover:bg-gray-50 dark:hover:bg-gray-800">
              <td className="px-6 py-4 text-sm font-medium text-gray-900 dark:text-gray-100 max-w-[150px] break-words">
                {lookup.name ?? "-"}
              </td>
              <td className="px-6 py-4 text-sm whitespace-nowrap text-gray-500 dark:text-gray-400">
                {lookup.code || "-"}
              </td>
              <td className="px-6 py-4 text-sm text-gray-500 dark:text-gray-400 max-w-xs break-words">
                {lookup.description || "-"}
              </td>
              <td className="px-6 py-4 whitespace-nowrap">
                <Button
                  variant="ghost"
                  onClick={() => onToggleStatus(lookup.id!, !!lookup.status)}
                  className={`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${
                    lookup.status
                      ? "bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-900/50"
                      : "bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-900/50"
                  }`}
                  disabled={!!lookup.is_system_default}
                >
                  {lookup.status ? "Active" : "Inactive"}
                </Button>
              </td>
              <td className="px-6 py-4 text-sm font-medium whitespace-nowrap">
                <div className="flex items-center gap-2">
                  <Button
                    size="sm"
                    variant="outline"
                    disabled={!!lookup.is_system_default}
                    onClick={() => onEdit(lookup)}
                    title={
                      lookup.is_system_default
                        ? "Cannot edit system default"
                        : "Edit"
                    }
                    className="hover:text-blue-600 dark:hover:text-blue-400"
                  >
                    <FiEdit2 className="h-4 w-4" />
                  </Button>
                  <Button
                    size="sm"
                    variant="outline"
                    onClick={() => {
                      if (confirm(`Are you sure you want to delete "${lookup.name}"?`)) {
                        onDelete(lookup.id!);
                      }
                    }}
                    className="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300"
                    disabled={!!lookup.is_system_default}
                    title={
                      lookup.is_system_default
                        ? "Cannot delete system default"
                        : "Delete"
                    }
                  >
                    <FiTrash2 className="h-4 w-4" />
                  </Button>
                </div>
              </td>
            </tr>
          ))}
        </tbody>
      </table>

      {displayedLookups.length === 0 && (
        <div className="py-8 text-center text-gray-500 dark:text-gray-400">
          {searchTerm
            ? `No lookup types found matching "${searchTerm}" in category "${selectedCategory}".`
            : `No lookup types found for category "${selectedCategory}".`}
        </div>
      )}

      {/* Optional: Show sorting/filtering info */}
      {(searchTerm || (getSortDirection && Object.values(['name', 'code', 'description', 'status']).some(key => getSortDirection(key)))) && (
        <div className="px-6 py-2 text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
          {searchTerm && (
            <span>Filtered by: &quot;{searchTerm}&quot; • </span>
          )}
          {getSortDirection && (() => {
            const sortedColumn = ['name', 'code', 'description', 'status'].find(key => getSortDirection(key));
            const sortDirection = sortedColumn ? getSortDirection(sortedColumn) : null;
            return sortedColumn && sortDirection ? (
              <span>Sorted by: {sortedColumn} ({sortDirection})</span>
            ) : null;
          })()}
        </div>
      )}
    </div>
  );
}
```

<!-- path: hnvtx/components/lookup/LookupTypesFilters.tsx -->
```typescript
"use client";

import { Input } from "@/components/common/ui/Input";
import { FiSearch } from "react-icons/fi";
import { snakeToTitleCase } from "@/utils/formatters";

interface LookupTypesFiltersProps {
  categories: Array<{ id: string; category: string }>;
  selectedCategory: string;
  onCategoryChange: (category: string) => void;
  searchTerm: string;
  onSearchTermChange: (term: string) => void;
  hasSelectedCategory: boolean;
}

export function LookupTypesFilters({
  categories,
  selectedCategory,
  onCategoryChange,
  searchTerm,
  onSearchTermChange,
  hasSelectedCategory
}: LookupTypesFiltersProps) {
  return (
    <div className="flex flex-col gap-4 sm:flex-row">
      <div className="flex-1">
        <label className="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
          Select Category
        </label>
        <select
          value={selectedCategory}
          onChange={(e) => onCategoryChange(e.target.value)}
          className="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-2 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:outline-none"
        >
          <option value="">Select a category</option>
          {categories.map((category) => (
            <option key={category.id} value={category.category}>
              {snakeToTitleCase(category.category)} ({category.category})
            </option>
          ))}
        </select>
      </div>

      <div className="flex-1">
        <label className="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
          Search
        </label>
        <div className="relative">
          <FiSearch className="absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 transform text-gray-400 dark:text-gray-500" />
          <Input
            type="text"
            placeholder="Search lookup types..."
            value={searchTerm}
            onChange={(e) => onSearchTermChange(e.target.value)}
            className="pl-10 dark:bg-gray-800 dark:text-gray-100"
            disabled={!hasSelectedCategory}
          />
        </div>
      </div>
    </div>
  );
}
```

<!-- path: hnvtx/components/lookup/LookupModal.tsx -->
```typescript
"use client";

import { Button } from "@/components/common/ui/Button";
import { Input } from "@/components/common/ui/Input";
import { Modal } from "@/components/common/ui/Modal";
import { useTableInsert, useTableUpdate } from "@/hooks/database";
import { type LookupType, lookupTypeSchema } from "@/schemas";
import { Database } from "@/types/supabase-types";
import { snakeToTitleCase } from "@/utils/formatters";
import { createClient } from "@/utils/supabase/client";
import { zodResolver } from "@hookform/resolvers/zod";
import { useCallback, useEffect } from "react";
import { useForm } from "react-hook-form";
import { toast } from "sonner";
import z from "zod";

type Categories = Database["public"]["Tables"]["lookup_types"]["Row"];

interface LookupModalProps {
  isOpen: boolean;
  onClose: () => void;
  onLookupCreated?: (lookupData: LookupType) => void;
  onLookupUpdated?: (lookupData: LookupType) => void;
  editingLookup?: LookupType | null;
  category?: string;
  categories?: Categories[];
}

// Add this function to extract unique categories
const getUniqueCategories = (data?: Categories[]) => {
  if (!data) return [];

  const categoriesSet = new Set<string>();
  data.forEach(item => {
    if (item.category) {
      categoriesSet.add(item.category);
    }
  });

  return Array.from(categoriesSet).sort();
};

export function LookupModal({
  isOpen,
  onClose,
  onLookupCreated,
  onLookupUpdated,
  editingLookup,
  category,
  categories,
}: LookupModalProps) {
  // Database hooks
  const supabase = createClient();
  const { mutate: createLookup } = useTableInsert(supabase, "lookup_types");
  const { mutate: updateLookup } = useTableUpdate(supabase, "lookup_types");

  // console.log("categories", categories);

  const isEditMode = Boolean(editingLookup);

  // Extract unique categories
  const uniqueCategories = getUniqueCategories(categories);
  // console.log("uniqueCategories", uniqueCategories);

  // Create a form-specific schema
  const lookupTypeFormSchema = lookupTypeSchema.pick({
    category: true,
    code: true,
    description: true,
    name: true,
    sort_order: true,
    is_system_default: true,
    status: true,
  });
  type LookupTypeFormData = z.infer<typeof lookupTypeFormSchema>;

  // react-hook-form setup with better default values
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
    reset,
    watch,
    setValue,
  } = useForm<LookupTypeFormData>({
    resolver: zodResolver(lookupTypeFormSchema),
    defaultValues: {
      category: "",
      code: "",
      description: "",
      name: "",
      sort_order: 0,
      is_system_default: false,
      status: true,
    },
  });

  // Reset form when modal opens/closes or editing changes
  useEffect(() => {
    if (isOpen) {
      const resetData: LookupTypeFormData = {
        category: editingLookup?.category || category || "",
        code: editingLookup?.code || "",
        description: editingLookup?.description || "",
        name: editingLookup?.name || "",
        sort_order: editingLookup?.sort_order || 0,
        is_system_default: editingLookup?.is_system_default || false,
        status: editingLookup?.status !== false,
      };

      reset(resetData);
    }
  }, [isOpen, editingLookup, category, reset]); // Ensure setValue is not in this array if you have it

  const onValidSubmit = useCallback(
    async (data: LookupTypeFormData) => {
      try {
        const submissionData: LookupTypeFormData = {
          ...data,
          code: data.code?.trim() || null,
          description: data.description?.trim() || null,
          name: data.name?.trim(),
          category: data.category?.trim(),
        };

        if (isEditMode && editingLookup?.id) {
          // Update existing lookup
          updateLookup(
            {
              id: editingLookup.id,
              data: submissionData,
            },
            {
              onSuccess: (updatedData) => {
                toast.success("Lookup type updated successfully");
                onLookupUpdated?.(updatedData as unknown as LookupType);
                onClose();
              },
              onError: (error) => {
                console.error("Error updating lookup type:", error);
                toast.error("Failed to update lookup type");
              },
            }
          );
        } else {
          // Create new lookup
          createLookup(submissionData, {
            onSuccess: (createdData) => {
              toast.success("Lookup type created successfully");
              onLookupCreated?.(createdData as unknown as LookupType);
              onClose();
            },
            onError: (error) => {
              console.error("Error creating lookup type:", error);
              toast.error("Failed to create lookup type");
            },
          });
        }
      } catch (error) {
        console.error("Error submitting lookup type:", error);
        toast.error("Failed to submit lookup type");
      }
    },
    [
      isEditMode,
      editingLookup,
      updateLookup,
      createLookup,
      onLookupUpdated,
      onLookupCreated,
      onClose,
    ]
  );

  const modalTitle = isEditMode ? "Edit Lookup Type" : "Add Lookup Type";
  const submitButtonText = isEditMode
    ? isSubmitting
      ? "Updating..."
      : "Update Lookup Type"
    : isSubmitting
    ? "Creating..."
    : "Create Lookup Type";

  const canSubmit = Boolean(
    watch("category")?.trim() && watch("name")?.trim() && !isSubmitting
  );

  // Watch values for debugging
  const watchedCategory = watch("category");
  const watchedName = watch("name");
  const watchedCode = watch("code");

  console.log("category prop:", category);
  console.log("editingLookup:", editingLookup);

  return (
    <Modal isOpen={isOpen} onClose={onClose} title={modalTitle}>
      <form onSubmit={handleSubmit(onValidSubmit)} className="space-y-4">
        <div className="grid grid-cols-1 gap-4 md:grid-cols-2">
          <div className="md:col-span-2">
            <label htmlFor="category" className="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
              Category <span className="text-red-500 dark:text-red-400">*</span>
            </label>

            {isEditMode || category ? (
              // Read-only category in edit mode or when category is provided
              <div className="space-y-1">
                <Input
                  type="text"
                  {...register("category")}
                  readOnly
                  className="bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 border-gray-300 dark:border-gray-600"
                  value={watchedCategory || ""}
                />
                {errors.category && (
                  <p className="text-xs text-red-500 dark:text-red-400 mt-1">
                    {errors.category.message}
                  </p>
                )}
                <p className="text-xs text-gray-500 dark:text-gray-400">
                  {isEditMode
                    ? "Category cannot be changed when editing"
                    : "Category is set from parent"}
                </p>
              </div>
            ) : (
              // Category selection for create mode
              <div className="space-y-2">
                <select
                  {...register("category")}
                  className={`w-full rounded-md border px-3 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:outline-none ${
                    errors.category
                      ? "border-red-300 dark:border-red-600"
                      : "border-gray-300 dark:border-gray-600"
                  }`}
                  disabled={isSubmitting}
                  value={watchedCategory || ""}
                  onChange={(e) => setValue("category", e.target.value)}
                >
                  <option value="">Select category...</option>
                  {uniqueCategories.map((cat) => (
                    <option key={cat} value={cat}>
                      {snakeToTitleCase(cat)}
                    </option>
                  ))}
                </select>

                {errors.category && (
                  <p className="text-xs text-red-500 dark:text-red-400 mt-1">
                    {errors.category.message}
                  </p>
                )}
              </div>
            )}
          </div>

          {/* Name Field */}
          <div className="md:col-span-2">
            <label htmlFor="name" className="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
              Name <span className="text-red-500 dark:text-red-400">*</span>
            </label>
            <Input
              type="text"
              {...register("name")}
              placeholder="Enter lookup name"
              disabled={isSubmitting}
              value={watchedName || ""}
              onChange={(e) => setValue("name", e.target.value)}
              className={`${
                errors.name ? "border-red-300 dark:border-red-600" : ""
              } dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:placeholder-gray-400`}
            />
            {errors.name && (
              <p className="text-xs text-red-500 dark:text-red-400 mt-1">
                {errors.name.message}
              </p>
            )}
          </div>

          {/* Code Field */}
          <div>
            <label htmlFor="code" className="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
              Code
            </label>
            <Input
              type="text"
              id="code"
              {...register("code")}
              placeholder="Enter code (optional)"
              value={watchedCode || ""}
              disabled={isSubmitting}
              onChange={(e) => setValue("code", e.target.value)}
              className={`${
                errors.code ? "border-red-300 dark:border-red-600" : ""
              } dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:placeholder-gray-400`}
            />
            {errors.code && (
              <p className="text-xs text-red-500 dark:text-red-400 mt-1">
                {errors.code.message}
              </p>
            )}
          </div>

          {/* Sort Order Field */}
          <div>
            <label htmlFor="sort_order" className="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
              Sort Order
            </label>
            <Input
              type="number"
              id="sort_order"
              {...register("sort_order", { valueAsNumber: true })}
              placeholder="0"
              disabled={isSubmitting}
              min="0"
              className={`${
                errors.sort_order ? "border-red-300 dark:border-red-600" : ""
              } dark:bg-gray-800 dark:border-gray-600 dark:text-white`}
            />
            {errors.sort_order && (
              <p className="text-xs text-red-500 dark:text-red-400 mt-1">
                {errors.sort_order.message}
              </p>
            )}
          </div>

          {/* Description Field */}
          <div className="md:col-span-2">
            <label htmlFor="description" className="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
              Description
            </label>
            <textarea
              className="w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:focus:border-blue-400 dark:focus:ring-blue-400"
              rows={3}
              {...register("description")}
              placeholder="Enter description (optional)"
              disabled={isSubmitting}
            />
            {errors.description && (
              <p className="text-xs text-red-500 dark:text-red-400 mt-1">
                {errors.description.message}
              </p>
            )}
          </div>

          {/* Checkboxes */}
          <div className="md:col-span-2 space-y-3">
            <div className="flex items-center">
              <input
                type="checkbox"
                id="is_system_default"
                {...register("is_system_default")}
                disabled={
                  isSubmitting ||
                  (isEditMode && !!editingLookup?.is_system_default)
                }
                className="h-4 w-4 rounded border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-blue-600 focus:ring-blue-500 dark:focus:ring-blue-400 dark:ring-offset-gray-800"
              />
              <label
                htmlFor="is_system_default"
                className="ml-2 text-sm text-gray-700 dark:text-gray-300"
              >
                System Default
                {isEditMode && editingLookup?.is_system_default && (
                  <span className="ml-1 text-xs text-gray-500 dark:text-gray-400">
                    (cannot be changed)
                  </span>
                )}
              </label>
            </div>

            <div className="flex items-center">
              <input
                type="checkbox"
                id="status"
                {...register("status")}
                disabled={isSubmitting}
                className="h-4 w-4 rounded border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-blue-600 focus:ring-blue-500 dark:focus:ring-blue-400 dark:ring-offset-gray-800"
              />
              <label
                htmlFor="status"
                className="ml-2 text-sm text-gray-700 dark:text-gray-300"
              >
                Active Status
              </label>
            </div>
          </div>
        </div>

        {/* Information Cards */}
        {isEditMode ? (
          <div className="rounded-md border border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20 p-3">
            <h4 className="mb-1 text-sm font-medium text-amber-900 dark:text-amber-200">
              Edit Mode Notes:
            </h4>
            <ul className="space-y-1 text-xs text-amber-800 dark:text-amber-200/80">
              <li>• Category field cannot be changed after creation</li>
              <li>• System default status cannot be removed once set</li>
              <li>• Updated timestamp will be set automatically</li>
            </ul>
          </div>
        ) : (
          <div className="rounded-md border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20 p-3">
            <h4 className="mb-1 text-sm font-medium text-blue-900 dark:text-blue-200">
              {category ? "Adding to Lookup" : "Creating New Lookup Type"}
            </h4>
            <ul className="space-y-1 text-xs text-blue-800 dark:text-blue-200/80">
              <li>• Timestamps will be set automatically</li>
              <li>• ID will be generated automatically</li>
              {!category && (
                <li>• Select an existing category or create a new one</li>
              )}
            </ul>
          </div>
        )}

        {/* Form Actions */}
        <div className="flex justify-end gap-2 pt-4">
          <Button
            type="button"
            variant="outline"
            onClick={onClose}
            disabled={isSubmitting}
            className="dark:border-gray-600 dark:hover:bg-gray-700"
          >
            Cancel
          </Button>
          <Button type="submit" disabled={!canSubmit}>
            {submitButtonText}
          </Button>
        </div>
      </form>
    </Modal>
  );
}

```

<!-- path: hnvtx/components/lookup/index.tsx -->
```typescript
export * from "./lookup-types";
export * from "./lookup-hooks";
export * from "./LookupModal";
export * from "./LookupTypesEmptyStates";
export * from "./LookupTypesFilters";
export * from "./LookupTypesHeader";

```

<!-- path: hnvtx/components/lookup/lookup-types.ts -->
```typescript
// export interface LookupType {
//     id: string;
//     category: string;
//     name: string;
//     code: string | null;
//     description: string | null;
//     sort_order: number | null;
//     status: boolean | null;
//     is_system_default: boolean | null;
//     created_at: string | null;
//     updated_at: string | null;
//   }
  
  export interface LookupTypesPageProps {
    initialCategory?: string;
  }
```

<!-- path: hnvtx/components/lookup/LookupTypesEmptyStates.tsx -->
```typescript
"use client";

import { Card } from "@/components/common/ui/Card";
import { Button } from "@/components/common/ui/Button";
import { FiPlus } from "react-icons/fi";
import { useRouter } from "next/navigation";
import { LoadingSpinner } from "@/components/common/ui/LoadingSpinner";

export function NoCategoriesState({ error, isLoading }: { error?: Error; isLoading: boolean }) {
  const router = useRouter();
  
  return (
    <Card className="p-8 text-center">
      <p className="mb-4 text-gray-500 dark:text-gray-400">
        {isLoading ? "Loading categories..." : "No categories found."}
      </p>
      {error && (
        <p className="mb-4 text-red-500 dark:text-red-400">
          Error: {error.message}
        </p>
      )}
      <Button onClick={() => router.push('/dashboard/categories')}>
        <FiPlus className="mr-2 h-4 w-4" />
        Manage Categories
      </Button>
    </Card>
  );
}

export function SelectCategoryPrompt() {
  return (
    <Card className="p-8 text-center dark:bg-gray-800">
      <p className="text-gray-500 dark:text-gray-400">
        Please select a category to view lookup types.
      </p>
    </Card>
  );
}

export function LoadingState({ selectedCategory }: { selectedCategory: string }) {
  return (
    <div className="flex justify-center py-8">
      <LoadingSpinner />
      <span className="ml-2 text-gray-600 dark:text-gray-400">
        Loading lookup types for {`"${selectedCategory}"`}...
      </span>
    </div>
  );
}

export function ErrorState({ error, onRetry }: { error: Error; onRetry: () => void }) {
  return (
    <Card className="border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20 p-4">
      <p className="text-red-600 dark:text-red-400">
        Error loading lookup types: {error.message}
      </p>
      <Button
        onClick={onRetry}
        variant="outline"
        className="mt-2"
      >
        Retry
      </Button>
    </Card>
  );
}
```

<!-- path: hnvtx/components/employee/employee-types.ts -->
```typescript
// app/dashboard/employees/types.ts
import { Tables } from "@/types/supabase-types";

export type EmployeeWithRelations = Tables<"employees"> & {
  maintenance_areas: Tables<"maintenance_areas"> | null;
  employee_designations: Tables<"employee_designations"> | null;
};

// export type EmployeeFilters = {
//   search: string;
//   designation: string;
//   status: "true" | "false" | "";
//   maintenanceTerminal: string;
// };


```

<!-- path: hnvtx/components/employee/BulkActions.tsx -->
```typescript
import { FiTrash2 } from "react-icons/fi";

interface BulkActionsProps {
  selectedCount: number;
  isOperationLoading?: boolean;
  onBulkDelete: () => void;
  onBulkUpdateStatus: (status: "active" | "inactive") => void;
  onClearSelection: () => void;
}

export function BulkActions({
  selectedCount,
  isOperationLoading = false,
  onBulkDelete,
  onBulkUpdateStatus,
  onClearSelection,
}: BulkActionsProps) {
  if (selectedCount === 0) return null;

  return (
    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 
                   dark:bg-blue-900/20 dark:border-blue-700/50">
      <div className="flex items-center justify-between flex-wrap gap-3">
        <p className="text-blue-900 dark:text-blue-100">
          {selectedCount} employee(s) selected
        </p>
        <div className="flex items-center gap-3">
          <select
            onChange={(e) => {
              const v = e.target.value as "active" | "inactive" | "";
              if (v) onBulkUpdateStatus(v);
            }}
            defaultValue=""
            className="text-sm border rounded px-2 py-1 
                      bg-white text-gray-900 border-gray-300
                      dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600
                      disabled:opacity-50"
            disabled={isOperationLoading}
          >
            <option value="">Set Status</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
          <button
            onClick={onBulkDelete}
            disabled={isOperationLoading}
            className="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 
                      dark:bg-red-700 dark:hover:bg-red-800
                      text-sm disabled:opacity-50"
          >
            <FiTrash2 className="inline mr-1" /> Delete
          </button>
          <button 
            onClick={onClearSelection} 
            className="text-gray-500 hover:text-gray-700 
                      dark:text-gray-400 dark:hover:text-gray-300
                      text-sm"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>
  );
}
```

<!-- path: hnvtx/components/employee/EmployeeTableColumns.tsx -->
```typescript
import { Column } from "@/hooks/database/excel-queries/excel-helpers";
import { Row } from "@/hooks/database";
import { StatusBadge } from "@/components/common/ui/badges/StatusBadge";

// Columns for employees table using DataTable component
// Note: We type columns against Row<"employees">; relation fields are accessed via custom render using any casts.
type LookupOptions = {
  designationMap?: Record<string, string>;
  areaMap?: Record<string, string>;
};

export const getEmployeeTableColumns = (
  options?: LookupOptions
): Column<Row<"employees">>[] => [
  {
    title: "Employee",
    dataIndex: "employee_name",
    key: "employee_name",
    width: 220,
    searchable: true,
    render: (_, record: Row<"employees">) => (
      <div className="min-w-[180px]">
        <div className="font-medium text-gray-900 dark:text-white">
          {record.employee_name || "—"}
        </div>
        {record.employee_pers_no && (
          <div className="text-xs text-gray-500 dark:text-gray-400">
            ID: {record.employee_pers_no}
          </div>
        )}
      </div>
    ),
  },
  {
    title: "Contact",
    dataIndex: "employee_contact",
    key: "contact",
    width: 220,
    searchable: true,
    render: (_, record: Row<"employees">) => (
      <div className="space-y-1">
        {record.employee_contact && (
          <div className="text-sm text-gray-700 dark:text-gray-300">
            {record.employee_contact}
          </div>
        )}
      </div>
    ),
  },
  {
    title: "Email",
    dataIndex: "employee_contact",
    key: "email",
    width: 220,
    searchable: true,
    render: (_, record: Row<"employees">) => (
      <div className="space-y-1">
        {record.employee_email && (
          <div className="text-sm text-gray-700 dark:text-gray-300">
            {record.employee_email}
          </div>
        )}
      </div>
    ),
  },
  {
    title: "Designation",
    dataIndex: "employee_designation_id",
    key: "designation",
    width: 180,
    render: (_, record: Row<"employees">) => {
      const id = record?.employee_designation_id as unknown as string | null;
      return (id && options?.designationMap?.[id]) || "Not set";
    },
  },
  {
    title: "Maintenance Area",
    dataIndex: "maintenance_terminal_id",
    key: "maintenance_area",
    width: 200,
    render: (_, record: Row<"employees">) => {
      const id = record?.maintenance_terminal_id as unknown as string | null;
      return (id && options?.areaMap?.[id]) || "Not set";
    },
  },
  {
    title: "Address",
    dataIndex: "employee_addr",
    key: "employee_addr",
    width: 300,
  },
  {
    title: "Status",
    dataIndex: "status",
    key: "status",
    width: 120,
    render: (value: boolean) => <StatusBadge status={!!value} />,
  },
  // {
  //   title: "Created",
  //   dataIndex: "created_at",
  //   key: "created_at",
  //   width: 180,
  //   render: (value: string | null) => (value ? formatDate(value, { format: "dd/mm/yyyy" }) : "—"),
  // },
  // {
  //   title: "Updated",
  //   dataIndex: "updated_at",
  //   key: "updated_at",
  //   width: 180,
  //   render: (value: string | null) => (value ? formatDate(value, { format: "dd/mm/yyyy" }) : "—"),
  // },
];

```

<!-- path: hnvtx/components/employee/EmployeeTableActions.tsx -->
```typescript
import { FiEdit, FiTrash2, FiToggleRight, FiEye } from "react-icons/fi";
import { TableAction } from "@/components/table/datatable-types";
import { Row } from "@/hooks/database";

interface EmployeeTableActionsProps {
  onView: (employeeId: string) => void;
  onEdit: (employeeId: string) => void;
  onToggleStatus: (record: Row<"employees">) => void;
  onDelete: (employeeId: string, displayName?: string) => void;
}

export const getEmployeeTableActions = ({
  onView,
  onEdit,
  onToggleStatus,
  onDelete,
}: EmployeeTableActionsProps): TableAction<"employees">[] => [
  {
    key: "view",
    label: "View",
    icon: <FiEye className='w-4 h-4' />,
    onClick: (record) => onView(record.id || ""),
    variant: "primary",
  },
  {
    key: "toggle",
    label: "Toggle Status",
    icon: <FiToggleRight className='w-4 h-4' />,
    onClick: (record) => onToggleStatus(record),
    variant: "secondary",
  },
  {
    key: "edit",
    label: "Edit",
    icon: <FiEdit className='w-4 h-4' />,
    onClick: (record) => onEdit(record.id || ""),
    variant: "primary",
  },
  {
    key: "delete",
    label: "Delete",
    icon: <FiTrash2 className='w-4 h-4' />,
    onClick: (record) => onDelete(record.id || "", String(record.employee_name || "this employee")),
    variant: "danger",
  },
];

```

<!-- path: hnvtx/components/employee/EmployeeStats.tsx -->
```typescript
// app/dashboard/employees/components/EmployeeStats.tsx
interface EmployeeStatsProps {
    total: number;
    active: number;
    inactive: number;
  }
  
  export const EmployeeStats = ({ total, active, inactive }: EmployeeStatsProps) => {
    return (
      <div className="mt-6 flex items-center justify-between text-sm text-gray-600 dark:text-gray-400">
        <span>
          Showing {total} employee{total !== 1 ? "s" : ""}
        </span>
        <span>
          {active} active, {inactive} inactive
        </span>
      </div>
    );
  };
```

<!-- path: hnvtx/components/employee/EmployeeForm.tsx -->
```typescript
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { EmployeeFormData, employeeFormSchema } from "@/schemas";
import { Tables } from "@/types/supabase-types";
import { Option } from "@/components/common/ui/select/SearchableSelect";
import { EmployeeWithRelations } from "./employee-types";
import {
  FormDateInput,
  FormInput,
  FormSearchableSelect,
  FormTextarea,
} from "@/components/common/form/FormControls";
import { Modal } from "@/components/common/ui";
import { FormCard } from "@/components/common/form";
import { useEffect } from "react";

interface EmployeeFormProps {
  isOpen: boolean;
  onClose: () => void;
  employee?: EmployeeWithRelations | null;
  onSubmit: (data: EmployeeFormData) => void;
  onCancel: () => void;
  isLoading: boolean;
  designations: Tables<"employee_designations">[];
  maintenanceAreas: Tables<"maintenance_areas">[];
}

const EmployeeForm = ({
  isOpen,
  onClose,
  employee,
  onSubmit,
  isLoading,
  designations,
  maintenanceAreas,
}: EmployeeFormProps) => {
  const {
    control,
    handleSubmit,
    register,
    formState: { errors },
    reset
  } = useForm<EmployeeFormData>({
    resolver: zodResolver(employeeFormSchema),
    defaultValues: {
      employee_name: employee?.employee_name || "",
      employee_pers_no: employee?.employee_pers_no || null,
      employee_designation_id: employee?.employee_designation_id || null,
      employee_contact: employee?.employee_contact || null,
      employee_email: employee?.employee_email || "",
      employee_dob: employee?.employee_dob
        ? new Date(employee.employee_dob)
        : null,
      employee_doj: employee?.employee_doj
        ? new Date(employee.employee_doj)
        : null,
      employee_addr: employee?.employee_addr || null,
      maintenance_terminal_id: employee?.maintenance_terminal_id || null,
      remark: employee?.remark || null,
    },
  });

  useEffect(() => {
    if (employee) {
        const defaultValues = {
          employee_name: employee?.employee_name || "",
          employee_pers_no: employee?.employee_pers_no || null,
          employee_designation_id: employee?.employee_designation_id || null,
          employee_contact: employee?.employee_contact || null,
          employee_email: employee?.employee_email || "",
          employee_dob: employee?.employee_dob
            ? new Date(employee.employee_dob)
            : null,
          employee_doj: employee?.employee_doj
            ? new Date(employee.employee_doj)
            : null,
          employee_addr: employee?.employee_addr || null,
          maintenance_terminal_id: employee?.maintenance_terminal_id || null,
          remark: employee?.remark || null,
      };
      reset(defaultValues);
    } else {
      reset({
        employee_name: "",
        employee_pers_no: null,
        employee_designation_id: null,
        employee_contact: null,
        employee_email: "",
        employee_dob: null,
        employee_doj: null,
        employee_addr: null,
        maintenance_terminal_id: null,
        remark: null,
      });
    }
  }, [employee, reset]);

  const designationOptions: Option[] = designations.map((d) => ({
    value: d.id,
    label: d.name,
  }));

  const maintenanceAreaOptions: Option[] = maintenanceAreas.map((area) => ({
    value: area.id,
    label: `${area.name}${area.code ? ` (${area.code})` : ""}`,
  }));

  const handleClose = () => {
    onClose();
  };

  const onValidFormSubmit = (data: EmployeeFormData) => {
    onSubmit(data);
  };

  const loading = isLoading;

  return (
    <Modal
          isOpen={isOpen}
          onClose={handleClose}
          title={""}
          size="full"
          visible={false}
          className="h-screen w-screen transparent bg-gray-700 rounded-2xl"
        >
      <FormCard
        title={employee ? "Edit Employee" : "Add New Employee"}
        onSubmit={handleSubmit(onValidFormSubmit)}
        onCancel={handleClose}
        isLoading={loading}
        disableSubmit={loading}
        standalone
      >
        <div className="space-y-4">
          <div className="grid grid-cols-1 gap-4 md:grid-cols-2">
            <FormInput
              name="employee_name"
              label="Employee Name"
              id="employee_name"
              register={register}
              error={errors.employee_name}
              required
              placeholder="Enter employee name"
            />
            <FormInput
              name="employee_pers_no"
              label="Personnel Number"
              id="employee_pers_no"
              register={register}
              error={errors.employee_pers_no}
              placeholder="Enter personnel number"
            />
            <FormSearchableSelect
              name="employee_designation_id"
              label="Designation"
              control={control}
              options={designationOptions}
              error={errors.employee_designation_id}
              placeholder="Select designation"
              searchPlaceholder="Search designations..."
            />
            <FormInput
              name="employee_contact"
              label="Contact Number"
              id="employee_contact"
              register={register}
              error={errors.employee_contact}
              type="tel"
              placeholder="Enter contact number"
            />
            <FormInput
              name="employee_email"
              label="Email Address"
              id="employee_email"
              register={register}
              error={errors.employee_email}
              type="email"
              placeholder="Enter email address"
            />
            <FormDateInput
              name="employee_dob"
              label="Date of Birth"
              control={control}
              error={errors.employee_dob}
              required
              placeholder="Select date of birth"
            />
            <FormDateInput
              name="employee_doj"
              label="Date of Joining"
              control={control}
              error={errors.employee_doj}
              required
              placeholder="Select date of joining"
            />
            <FormSearchableSelect
              name="maintenance_terminal_id"
              label="Maintenance Area"
              control={control}
              options={maintenanceAreaOptions}
              error={errors.maintenance_terminal_id}
              placeholder="Select maintenance area"
              searchPlaceholder="Search maintenance areas..."
            />
          </div>

          <FormTextarea
            name="employee_addr"
            label="Address"
            id="employee_addr"
            register={register}
            error={errors.employee_addr}
            rows={3}
            placeholder="Enter address"
          />

          <FormTextarea
            name="remark"
            label="Remarks"
            id="remark"
            register={register}
            error={errors.remark}
            rows={2}
            placeholder="Enter remarks"
          />
        </div>
      </FormCard>
    </Modal>
  );
};

export default EmployeeForm;
```

<!-- path: hnvtx/components/employee/EmployeeFilters.tsx -->
```typescript
"use client";

import React, { memo, useState, useEffect } from "react";
import { FiFilter, FiSearch } from "react-icons/fi";
import { SearchableSelect } from "@/components/common/ui/select/SearchableSelect";
import { Filters, Row } from "@/hooks/database";
import { useDebounce } from "use-debounce"; // <-- IMPORT useDebounce
import { DEFAULTS } from "@/config/constants";

interface EmployeeFiltersProps {
  searchQuery: string; // This prop is now used to set the initial value
  filters: Filters;
  showFilters: boolean;
  designations: Row<"employee_designations">[];
  maintenanceAreas: Row<"maintenance_areas">[];
  onSearchChange: (value: string) => void;
  onFilterToggle: () => void;
  onDesignationChange: (value: string) => void;
  onStatusChange: (value: "true" | "false" | "") => void;
  onMaintenanceAreaChange: (value: string) => void;
}

const EmployeeFiltersComponent = memo(({
  searchQuery,
  filters,
  showFilters,
  designations,
  maintenanceAreas,
  onSearchChange,
  onFilterToggle,
  onDesignationChange,
  onStatusChange,
  onMaintenanceAreaChange,
}: EmployeeFiltersProps) => {
  // --- DEBOUNCING LOGIC ---
  const [internalSearch, setInternalSearch] = useState(searchQuery);
  const [debouncedSearch] = useDebounce(internalSearch, DEFAULTS.DEBOUNCE_DELAY); 

  // Effect to call the parent's onSearchChange only when the debounced value changes
  useEffect(() => {
    onSearchChange(debouncedSearch);
  }, [debouncedSearch, onSearchChange]);

  // Effect to sync the internal state if the parent's state changes (e.g., from a "clear all" button)
  useEffect(() => {
    setInternalSearch(searchQuery);
  }, [searchQuery]);
  // --- END DEBOUNCING LOGIC ---

  return (
    <div className="mb-6 rounded-lg border bg-white p-4 shadow-sm dark:border-gray-700 dark:bg-gray-800">
      <div className="flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center">
        <div className="flex flex-1 flex-col gap-3 sm:flex-row">
          <div className="relative">
            <FiSearch className="absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 transform text-gray-400 dark:text-gray-500" />
            <input
              type="text"
              placeholder="Search employees..."
              value={internalSearch} // <-- Use internal state for immediate input feedback
              onChange={(e) => setInternalSearch(e.target.value)} // <-- Update internal state on every keystroke
              onKeyDown={(e) => e.stopPropagation()}
              className="w-full rounded-md border border-gray-300 py-2 pr-4 pl-10 focus:ring-2 focus:ring-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:focus:ring-blue-600 sm:w-80"
            />
          </div>
          <button
            type="button"
            onClick={onFilterToggle}
            className={`flex items-center gap-2 rounded-md border px-3 py-2 transition-colors ${
              showFilters
                ? "border-blue-200 bg-blue-50 text-blue-700 dark:border-blue-800 dark:bg-blue-900/50 dark:text-blue-200"
                : "border-gray-300 bg-white text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"
            }`}
          >
            <FiFilter className="h-4 w-4" />
            Filters
          </button>
        </div>
      </div>

      {showFilters && (
        <div className="mt-4 grid grid-cols-1 gap-3 border-t pt-4 dark:border-gray-700 sm:grid-cols-3">
          <SearchableSelect
            options={designations.map((d) => ({ value: d.id, label: d.name }))}
            value={filters.employee_designation_id as string}
            onChange={(v) => onDesignationChange(v ?? "")}
            placeholder="All Designations"
            searchPlaceholder="Search designations..."
            clearable={true}
          />
          <select
            value={filters.status as string}
            onChange={(e) => onStatusChange(e.target.value as "true" | "false")}
            className="rounded-md border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:focus:ring-blue-600"
          >
            <option value="">All Status</option>
            <option value="true">Active</option>
            <option value="false">Inactive</option>
          </select>
          <SearchableSelect
            options={maintenanceAreas.map((area) => ({ value: area.id, label: `${area.name}${area.code ? ` (${area.code})` : ""}` }))}
            value={filters.maintenance_terminal_id as string}
            onChange={(v) => onMaintenanceAreaChange(v ?? "")}
            placeholder="All Maintenance Areas"
            searchPlaceholder="Search areas..."
            clearable={true}
          />
        </div>
      )}
    </div>
  );
});

EmployeeFiltersComponent.displayName = "EmployeeFilters";
export default EmployeeFiltersComponent;
```

<!-- path: hnvtx/components/employee/EmployeeDetailsModal.tsx -->
```typescript
import { motion } from "framer-motion";
import { FiX, FiMail, FiPhone, FiUser, FiBriefcase, FiCalendar, FiEdit3 } from "react-icons/fi";
import { createClient } from "@/utils/supabase/client";
import { useTableRecord } from "@/hooks/database";
import { Row } from "@/hooks/database";

type Props = {
  employeeId: string;
  onClose: () => void;
  onEdit: () => void;
};

const formatDate = (dateString: string | null | undefined) => {
  if (!dateString) return "Not provided";
  try {
    return new Date(dateString).toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric",
    });
  } catch {
    return "Invalid date";
  }
};

const EmployeeDetailsModal = ({ employeeId, onClose, onEdit }: Props) => {
  const supabase = createClient();

  const { data: employee, isLoading, isError, error } = useTableRecord(
    supabase,
    "employees",
    employeeId,
    {
      columns: "*, employee_designations(name), maintenance_areas(name)",
    }
  );

  if (isLoading) {
    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div className="bg-white p-8 rounded-lg shadow-xl max-w-md w-full mx-4">
          <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4" />
          <p className="text-gray-700 text-center">Loading employee details...</p>
        </div>
      </div>
    );
  }

  if (isError || !employee) {
    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div className="bg-white p-8 rounded-lg shadow-xl max-w-md w-full mx-4 text-center">
          <div className="text-red-500 text-5xl mb-4">⚠️</div>
          <h3 className="text-lg font-medium text-gray-900 mb-2">
            {isError ? "Error Loading Employee" : "Employee Not Found"}
          </h3>
          {isError && error && (
            <p className="text-sm text-gray-600 mb-4">{error.message}</p>
          )}
          <button
            onClick={onClose}
            className="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors"
          >
            Close
          </button>
        </div>
      </div>
    );
  }

  const statusBadge = employee.status ? (
    <span className="rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-800">
      Active
    </span>
  ) : (
    <span className="rounded-full bg-red-100 px-2 py-0.5 text-xs font-medium text-red-800">
      Inactive
    </span>
  );

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <motion.div
        initial={{ opacity: 0, scale: 0.95 }}
        animate={{ opacity: 1, scale: 1 }}
        exit={{ opacity: 0, scale: 0.95 }}
        className="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden"
      >
        {/* Header */}
        <div className="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-900/30">
          <div>
            <h2 className="text-xl font-semibold text-gray-900 dark:text-white">
              {employee.employee_name || "Unnamed Employee"}
            </h2>
            <div className="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mt-1">
              {statusBadge}
              {employee.employee_pers_no && <span>• {employee.employee_pers_no}</span>}
            </div>
          </div>
          <button
            onClick={onClose}
            className="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            aria-label="Close modal"
          >
            <FiX size={20} />
          </button>
        </div>

        {/* Content */}
        <div className="p-6 overflow-y-auto max-h-[calc(90vh-140px)] space-y-6">
          {/* Contact Info */}
          <div>
            <h3 className="text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center gap-2">
              <FiUser className="text-blue-600" />
              Personal & Contact
            </h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="text-sm font-medium text-gray-500 dark:text-gray-400 block mb-1">Email</label>
                <div className="flex items-center gap-2 text-gray-900 dark:text-gray-100">
                  <FiMail className="text-gray-400" />
                  <span>{employee.employee_email || "Not provided"}</span>
                </div>
              </div>
              <div>
                <label className="text-sm font-medium text-gray-500 dark:text-gray-400 block mb-1">Phone</label>
                <div className="flex items-center gap-2 text-gray-900 dark:text-gray-100">
                  <FiPhone className="text-gray-400" />
                  <span>{employee.employee_contact || "Not provided"}</span>
                </div>
              </div>
            </div>
          </div>

          {/* Job Info */}
          <div>
            <h3 className="text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center gap-2">
              <FiBriefcase className="text-green-600" />
              Job Information
            </h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="text-sm font-medium text-gray-500 dark:text-gray-400 block mb-1">Designation</label>
                <div className="text-gray-900 dark:text-gray-100">{(employee as Row<'employees'> & { employee_designations: Row<'employee_designations'> })?.employee_designations?.name || "Not set"}</div>
              </div>
              <div>
                <label className="text-sm font-medium text-gray-500 dark:text-gray-400 block mb-1">Maintenance Area</label>
                <div className="text-gray-900 dark:text-gray-100">{(employee as Row<'employees'> & { maintenance_areas: Row<'maintenance_areas'> })?.maintenance_areas?.name || "Not set"}</div>
              </div>
            </div>
          </div>

          {/* Meta */}
          <div>
            <h3 className="text-lg font-medium text-gray-900 dark:text-white mb-3 flex items-center gap-2">
              <FiCalendar className="text-purple-600" />
              Dates
            </h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="text-sm font-medium text-gray-500 dark:text-gray-400 block mb-1">Created</label>
                <div className="text-gray-900 dark:text-gray-100">{formatDate(employee.created_at as unknown as string)}</div>
              </div>
              <div>
                <label className="text-sm font-medium text-gray-500 dark:text-gray-400 block mb-1">Updated</label>
                <div className="text-gray-900 dark:text-gray-100">{formatDate(employee.updated_at as unknown as string)}</div>
              </div>
            </div>
          </div>
        </div>

        {/* Footer */}
        <div className="px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex items-center justify-end gap-3 bg-gray-50 dark:bg-gray-900/30">
          <button
            onClick={onClose}
            className="px-4 py-2 text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
          >
            Close
          </button>
          <button
            onClick={onEdit}
            className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            <FiEdit3 size={16} />
            Edit Employee
          </button>
        </div>
      </motion.div>
    </div>
  );
};

export default EmployeeDetailsModal;

```

<!-- path: hnvtx/components/home/AnimatedBackground.tsx -->
```typescript
"use client"
import Image from "next/image";
import { motion, useScroll, useTransform } from "framer-motion";
import { useState, useEffect } from "react";
import HnvImg from "@/public/hnv.webp";
import HnvImgMobile from "@/public/hnvmobile.webp";
import useIsMobile from "@/hooks/useIsMobile";

export default function AnimatedBackground() {
  const { scrollY } = useScroll();
  const backgroundY = useTransform(scrollY, [0, 500], [0, 150]);
  const isMobile = useIsMobile();
  const [isDarkMode, setIsDarkMode] = useState(false);

  useEffect(() => {
    // Check for dark mode preference
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    setIsDarkMode(mediaQuery.matches);
    
    const handler = (e: MediaQueryListEvent) => setIsDarkMode(e.matches);
    mediaQuery.addEventListener('change', handler);
    
    return () => mediaQuery.removeEventListener('change', handler);
  }, []);

  return (
    <>
      {/* Dynamic gradient overlay that adjusts for dark mode */}
      <div className={`fixed inset-0 z-0 transition-opacity duration-500 ${
        isDarkMode 
          ? "bg-gradient-to-b from-black/70 via-black/40 to-black/70" 
          : "bg-gradient-to-b from-black/40 via-transparent to-black/40"
      }`} />
      
      <motion.div 
        className="fixed inset-0 -z-10" 
        style={{ y: backgroundY }}
      >
        <Image
          src={isMobile ? HnvImgMobile : HnvImg}
          alt="Harinavi Transmission Background"
          fill
          className={`transition-all duration-700 object-cover ${
            isDarkMode ? "opacity-50" : "opacity-80"
          }`}
          priority
          quality={90}
          sizes="100vw"
          placeholder="blur"
          blurDataURL="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAhEAACAQMDBQAAAAAAAAAAAAABAgMABAUGIWGRkqGx0f/EABUBAQEAAAAAAAAAAAAAAAAAAAMF/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAECEgMRkf/aAAwDAQACEQMRAD8AltJagyeH0AthI5xdrLcNM91BF5pX2HaH9bcfaSXWGaRmknyJckliyjqTzSlT54b6bk+h0R//2Q=="
        />
      </motion.div>
    </>
  );
}
```

<!-- path: hnvtx/components/home/StatsHighlights.tsx -->
```typescript
"use client"
import { motion } from "framer-motion";

export default function StatsHighlights() {
  const stats = [
    { number: "99.9%", label: "Uptime Guarantee", icon: "⚡" },
    { number: "256-bit", label: "AES Encryption", icon: "🔒" },
    { number: "Real-Time", label: "Data Insights", icon: "📈" }
  ];

  return (
    <motion.div
      initial={{ opacity: 0, y: 40 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.8, delay: 2.2 }}
      className="mt-8 sm:mt-16 grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 max-w-xs sm:max-w-4xl w-full px-4"
    >
      {stats.map((stat, index) => (
        <motion.div
          key={index}
          initial={{ opacity: 0, y: 20, scale: 0.9 }}
          animate={{ opacity: 1, y: 0, scale: 1 }}
          transition={{ 
            duration: 0.6, 
            delay: 2.5 + index * 0.15,
            type: "spring",
            stiffness: 100
          }}
          whileHover={{ 
            scale: 1.05, 
            y: -5,
            transition: { duration: 0.2 }
          }}
          className="group relative p-4 sm:p-6 rounded-2xl backdrop-blur-lg border bg-gradient-to-br from-white/10 to-white/5 dark:from-gray-800/40 dark:to-gray-900/20 border-white/20 dark:border-gray-600/30 shadow-xl hover:shadow-2xl transition-all duration-300"
        >
          {/* Background glow effect */}
          <div className="absolute inset-0 rounded-2xl bg-gradient-to-r from-red-500/10 to-purple-500/10 dark:from-blue-500/10 dark:to-cyan-500/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
          
          <div className="relative z-10 text-center">
            {/* Icon */}
            <motion.div
              initial={{ scale: 0, rotate: -180 }}
              animate={{ scale: 1, rotate: 0 }}
              transition={{ 
                duration: 0.6, 
                delay: 2.7 + index * 0.1,
                type: "spring",
                stiffness: 200
              }}
              className="text-2xl sm:text-3xl mb-2 sm:mb-3"
            >
              {stat.icon}
            </motion.div>
            
            {/* Number */}
            <motion.div
              initial={{ scale: 0 }}
              animate={{ scale: 1 }}
              transition={{ 
                duration: 0.5, 
                delay: 2.8 + index * 0.1, 
                type: "spring", 
                stiffness: 200 
              }}
              className="text-2xl sm:text-3xl md:text-4xl font-black bg-gradient-to-r from-red-400 to-orange-500 dark:from-blue-400 dark:to-cyan-400 bg-clip-text text-transparent mb-1 sm:mb-2"
            >
              {stat.number}
            </motion.div>
            
            {/* Label */}
            <div className="text-xs sm:text-sm font-semibold text-gray-200 dark:text-gray-300 tracking-wide">
              {stat.label}
            </div>
          </div>
        </motion.div>
      ))}
    </motion.div>
  );
}
```

<!-- path: hnvtx/components/home/ScrollIndicator.tsx -->
```typescript
"use client";
import { motion } from "framer-motion";
import { useEffect, useState } from "react";

export default function ScrollIndicator() {
  const [isDarkMode, setIsDarkMode] = useState(false);

  useEffect(() => {
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    setIsDarkMode(mediaQuery.matches);
    
    const handler = (e: MediaQueryListEvent) => setIsDarkMode(e.matches);
    mediaQuery.addEventListener('change', handler);
    
    return () => mediaQuery.removeEventListener('change', handler);
  }, []);

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ delay: 3.5, duration: 1 }}
      className="fixed bottom-4 left-1/2 z-30 hidden -translate-x-1/2 transform sm:bottom-8 md:block"
    >
      <motion.div
        animate={{ y: [0, 8, 0] }}
        transition={{
          duration: 2,
          repeat: Infinity,
          ease: "easeInOut",
        }}
        className="flex flex-col items-center space-y-2"
      >
        {/* Mouse indicator */}
        <div className={`
          relative flex justify-center rounded-full border-2 shadow-lg backdrop-blur-sm
          h-8 w-5 sm:h-10 sm:w-6
          ${isDarkMode 
            ? "border-gray-300/70 bg-gray-800/30" 
            : "border-white/70 bg-white/20"}
        `}>
          <motion.div
            animate={{ 
              y: [2, 10, 2], 
              opacity: [1, 0.3, 1] 
            }}
            transition={{
              duration: 2,
              repeat: Infinity,
              ease: "easeInOut",
            }}
            className={`
              mt-1 rounded-full shadow-sm
              h-2 w-0.5 sm:h-3 sm:w-1
              ${isDarkMode ? "bg-gray-300" : "bg-white"}
            `}
          />
        </div>
        
        {/* Scroll text */}
        <motion.span
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 4.5 }}
          className={`text-xs font-medium tracking-wider ${
            isDarkMode ? "text-gray-300/80" : "text-white/80"
          }`}
        >
          <small>Harinavi Transmission</small>
        </motion.span>
      </motion.div>
    </motion.div>
  );
}
```

<!-- path: hnvtx/components/home/variants.ts -->
```typescript
import { TargetAndTransition, Variants } from "framer-motion";

export const containerVariants: Variants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      duration: 0.8,
      staggerChildren: 0.3,
      ease: "easeOut"
    },
  },
};

export const titleVariants: Variants = {
  hidden: { 
    opacity: 0, 
    y: 60, 
    scale: 0.8 
  },
  visible: {
    opacity: 1,
    y: 0,
    scale: 1,
    transition: { 
      duration: 1.2,
      type: "spring",
      stiffness: 100,
      damping: 12
    },
  },
};

export const subtitleVariants: Variants = {
  hidden: { 
    opacity: 0, 
    y: 40 
  },
  visible: {
    opacity: 1,
    y: 0,
    transition: {
      duration: 0.8,
      delay: 0.2,
      ease: [0.25, 0.1, 0.25, 1] as [number, number, number, number],
    },
  },
};

export const highlightVariants: Variants = {
  hidden: { 
    opacity: 0,
    scaleX: 0,
    transformOrigin: "left"
  },
  visible: {
    opacity: 1,
    scaleX: 1,
    transition: {
      duration: 1.2,
      delay: 1.5,
      ease: [0.25, 0.1, 0.25, 1] as [number, number, number, number],
    },
  },
};

export const ctaVariants: Variants = {
  hidden: { 
    opacity: 0, 
    y: 30, 
    scale: 0.9 
  },
  visible: {
    opacity: 1,
    y: 0,
    scale: 1,
    transition: { 
      duration: 0.8, 
      delay: 0.5,
      type: "spring",
      stiffness: 120,
      damping: 10
    },
  },
};

export const floatingAnimation: TargetAndTransition = {
  y: [-8, 8, -8],
  rotate: [-1, 1, -1],
  transition: {
    duration: 6,
    repeat: Infinity,
    ease: "easeInOut",
  },
};
```

<!-- path: hnvtx/components/home/HeroContent.tsx -->
```typescript
import {
  motion,
  MotionValue,
  TargetAndTransition,
  Variants,
} from "framer-motion";
import { useRouter } from "next/navigation";
import { useState } from "react";
import { LoadingSpinner } from "../common/ui/LoadingSpinner";

interface HeroContentProps {
  variants: {
    containerVariants: Variants;
    titleVariants: Variants;
    subtitleVariants: Variants;
    highlightVariants: Variants;
    ctaVariants: Variants;
  };
  floatingAnimation: TargetAndTransition;
  textY: MotionValue<number>;
}

export default function HeroContent({
  variants,
  floatingAnimation,
  textY,
}: HeroContentProps) {
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  const handleGetStarted = (e: React.MouseEvent<HTMLButtonElement>) => {
    e.preventDefault();
    setLoading(true);
    router.push("/dashboard");
    // setTimeout(() => {
    //   router.push("/dashboard");
    // }, 1000); // Simulate loading for 1 second
  };
  return (
    <motion.div
      className="mx-auto flex max-w-6xl flex-col items-center justify-center px-4 text-center sm:px-6 overflow-hidden"
      style={{ y: textY }}
      variants={variants.containerVariants}
      initial="hidden"
      animate="visible"
    >
      {/* Floating badge */}
      <motion.div
        variants={variants.ctaVariants}
        animate={floatingAnimation}
        className="mb-6 rounded-full border border-red-400/40 bg-gradient-to-r from-red-500/20 to-purple-500/20 px-4 py-2 text-red-200 shadow-lg backdrop-blur-md sm:mb-8 sm:px-6 sm:py-3 dark:border-blue-400/40 dark:from-blue-500/20 dark:to-cyan-500/20 dark:text-blue-200"
      >
        <span className="text-xs font-semibold tracking-wide sm:text-sm">
          🚀 Advanced Database Management
        </span>
      </motion.div>

      {/* Title */}
      <motion.h1
        variants={variants.titleVariants}
        className="relative mb-4 text-3xl leading-tight font-black text-white sm:mb-6 sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl dark:text-gray-100"
      >
        <span className="mb-1 block text-2xl sm:mb-2 sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl">
          Welcome to
        </span>
        <span className="block bg-gradient-to-r from-red-400 via-red-500 to-orange-500 bg-clip-text text-3xl font-extrabold text-transparent sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl dark:from-blue-400 dark:via-purple-500 dark:to-cyan-400">
          Harinavi Transmission
        </span>
        <span className="mt-1 block text-2xl font-semibold text-gray-200 sm:mt-2 sm:text-3xl md:text-4xl lg:text-5xl xl:text-6xl dark:text-gray-300">
          Record Database
        </span>
      </motion.h1>

      {/* Subtitle */}
      <motion.p
        variants={variants.subtitleVariants}
        className="mb-6 max-w-xs px-2 text-base leading-relaxed text-gray-300 sm:mb-8 sm:max-w-2xl sm:px-0 sm:text-lg md:text-xl lg:max-w-3xl lg:text-2xl dark:text-gray-400"
      >
        Secure, reliable, and efficient database management for transmission
        records
      </motion.p>

      {/* CTA buttons */}
      <motion.div
        variants={variants.ctaVariants}
        className="mt-2 flex w-full max-w-xs flex-col gap-3 px-4 sm:mt-4 sm:max-w-md sm:flex-row sm:gap-4 sm:px-0"
      >
        <motion.button
          whileHover={{
            scale: 1.02,
            boxShadow: "0 10px 30px rgba(239, 68, 68, 0.3)",
          }}
          whileTap={{ scale: 0.98 }}
          className="flex w-full items-center justify-center gap-2 rounded-xl border border-red-400/30 bg-gradient-to-r from-red-500 to-red-600 px-6 py-3 text-base font-bold text-white shadow-xl transition-all hover:from-red-600 hover:to-red-700 sm:px-8 sm:py-4 sm:text-lg dark:from-red-600 dark:to-red-700 dark:hover:from-red-700 dark:hover:to-red-800"
          disabled={loading}
          onClick={handleGetStarted}
        >
          {loading ? (
            <LoadingSpinner size="sm" color="white" />
          ) : (
            "Get Started"
          )}
        </motion.button>
      </motion.div>
    </motion.div>
  );
}

```

<!-- path: hnvtx/components/home/ParticlesOverlay.tsx -->
```typescript
"use client"
import { motion } from "framer-motion";
import { useEffect, useState } from "react";

export default function ParticlesOverlay() {
  const [isDarkMode, setIsDarkMode] = useState(false);

  useEffect(() => {
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    setIsDarkMode(mediaQuery.matches);
    
    const handler = (e: MediaQueryListEvent) => setIsDarkMode(e.matches);
    mediaQuery.addEventListener('change', handler);
    
    return () => mediaQuery.removeEventListener('change', handler);
  }, []);

  // Colors that adapt to dark/light mode
  const colors = {
    red: isDarkMode 
      ? { gradient: 'rgba(239, 68, 68, 0.8)' } 
      : { gradient: 'rgba(220, 38, 38, 0.6)' },
    purple: isDarkMode 
      ? { gradient: 'rgba(168, 85, 247, 0.8)' } 
      : { gradient: 'rgba(147, 51, 234, 0.6)' },
    white: isDarkMode 
      ? { gradient: 'rgba(255, 255, 255, 0.4)' } 
      : { gradient: 'rgba(255, 255, 255, 0.2)' }
  };

  return (
    <div className="fixed inset-0 z-5 pointer-events-none">
      {/* Animated particles */}
      {[...Array(12)].map((_, i) => (
        <motion.div
          key={i}
          className="absolute rounded-full"
          style={{
            left: `${Math.random() * 100}%`,
            top: `${Math.random() * 100}%`,
            width: `${4 + Math.random() * 8}px`,
            height: `${4 + Math.random() * 8}px`,
            background: i % 3 === 0 
              ? `radial-gradient(circle, ${colors.red.gradient}, transparent 70%)`
              : i % 3 === 1
              ? `radial-gradient(circle, ${colors.purple.gradient}, transparent 70%)`
              : `radial-gradient(circle, ${colors.white.gradient}, transparent 70%)`,
            boxShadow: i % 3 === 0 
              ? `0 0 20px rgba(239, 68, 68, ${isDarkMode ? 0.6 : 0.4})`
              : i % 3 === 1
              ? `0 0 20px rgba(168, 85, 247, ${isDarkMode ? 0.6 : 0.4})`
              : `0 0 15px rgba(255, 255, 255, ${isDarkMode ? 0.5 : 0.3})`,
          }}
          animate={{
            scale: [1, 1.5, 1],
            opacity: [0.3, 0.8, 0.3],
            x: [0, Math.random() * 50 - 25, 0],
            y: [0, Math.random() * 50 - 25, 0],
          }}
          transition={{
            duration: 4 + Math.random() * 3,
            repeat: Infinity,
            delay: Math.random() * 2,
            ease: "easeInOut",
          }}
        />
      ))}
      
      {/* Floating geometric shapes */}
      {[...Array(6)].map((_, i) => (
        <motion.div
          key={`shape-${i}`}
          className="absolute"
          style={{
            left: `${20 + i * 12}%`,
            top: `${20 + (i % 3) * 20}%`,
            width: `${isDarkMode ? 3 : 2}px`,
            height: `${isDarkMode ? 3 : 2}px`,
          }}
          animate={{
            rotate: [0, 360],
            scale: [1, 1.5, 1],
            opacity: [0.2, 0.6, 0.2],
          }}
          transition={{
            duration: 8 + i,
            repeat: Infinity,
            delay: i * 0.5,
          }}
        >
          <div 
            className="w-full h-full rounded-full"
            style={{
              background: `radial-gradient(circle, ${colors.white.gradient}, transparent 70%)`,
              boxShadow: `0 0 ${isDarkMode ? 15 : 10}px ${colors.white.gradient}`
            }}
          />
        </motion.div>
      ))}
    </div>
  );
}
```

<!-- path: hnvtx/components/categories/CategorySearch.tsx -->
```typescript
import { FiSearch } from "react-icons/fi";
import { Input } from "@/components/common/ui/Input";

interface CategorySearchProps {
  searchTerm: string;
  onSearchChange: (value: string) => void;
}

export function CategorySearch({
  searchTerm,
  onSearchChange,
}: CategorySearchProps) {
  return (
    <div className="max-w-md">
      <label className="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
        Search Categories
      </label>
      <div className="relative">
        <FiSearch className="absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 transform text-gray-400" />
        <Input
          type="text"
          placeholder="Search unique categories..."
          value={searchTerm}
          onChange={(e) => onSearchChange(e.target.value)}
          className="pl-10 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:placeholder-gray-400"
        />
      </div>
    </div>
  );
}

```

<!-- path: hnvtx/components/categories/EmptyState.tsx -->
```typescript
import { FiPlus } from "react-icons/fi";
import { Button } from "@/components/common/ui/Button";
import { Card } from "@/components/common/ui/Card";

interface EmptyStateProps {
  onCreate: () => void;
}

export function EmptyState({ onCreate }: EmptyStateProps) {
  return (
    <Card className="p-8 text-center dark:border-gray-700 dark:bg-gray-800">
      <p className="mb-4 text-gray-500 dark:text-gray-400">
        No unique categories found.
      </p>
      <Button onClick={onCreate}>
        <FiPlus className="mr-2 h-4 w-4" />
        Create First Category
      </Button>
    </Card>
  );
}
```

<!-- path: hnvtx/components/categories/utils.ts -->
```typescript
import { Categories } from "@/components/categories/categories-types";

export function formatCategoryName(category: Categories): string {
  return category.category
    .split("_")
    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
    .join(" ");
}
```

<!-- path: hnvtx/components/categories/LoadingState.tsx -->
```typescript
import { LoadingSpinner } from "@/components/common/ui/LoadingSpinner";

export function LoadingState() {
  return (
    <div className="flex justify-center py-8">
      <LoadingSpinner />
      <span className="ml-2 dark:text-gray-400">Loading data...</span>
    </div>
  );
}
```

<!-- path: hnvtx/components/categories/CategoryModal.tsx -->
```typescript
"use client";

import { Button } from "@/components/common/ui/Button";
import { Input } from "@/components/common/ui/Input";
import { Modal } from "@/components/common/ui/Modal";
import { useTableInsert, useTableUpdate } from "@/hooks/database";
import { lookupTypeSchema } from "@/schemas";
import { Database } from "@/types/supabase-types";
import { snakeToTitleCase } from "@/utils/formatters";
import { createClient } from "@/utils/supabase/client";
import { zodResolver } from "@hookform/resolvers/zod";
import { PostgrestError } from "@supabase/supabase-js";
import { useCallback, useEffect, useRef } from "react";
import { useForm } from "react-hook-form";
import { toast } from "sonner";
import z from "zod";

type CategoryFormData = Database["public"]["Tables"]["lookup_types"]["Insert"];
type Categories = Database["public"]["Tables"]["lookup_types"]["Row"];
type GroupedLookupsByCategory = Record<string, Categories[]>;

interface CategoryModalProps {
  isOpen: boolean;
  onClose: () => void;
  onCategoryCreated?: (categoryData: CategoryFormData) => void;
  editingCategory?: string;
  categories?: Categories[];
  lookupsByCategory?: GroupedLookupsByCategory;
}

export function CategoryModal({
  isOpen,
  onClose,
  onCategoryCreated,
  editingCategory,
  categories,
  lookupsByCategory,
}: CategoryModalProps) {
  const categoryFormSchema = lookupTypeSchema.pick({
    category: true,
    code: true,
    description: true,
    name: true,
    sort_order: true,
    is_system_default: true,
    status: true,
  });
  type CategoryForm = z.infer<typeof categoryFormSchema>;

  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
    reset,
    watch,
  } = useForm<CategoryForm>({
    resolver: zodResolver(categoryFormSchema),
    defaultValues: {
      category: "",
      code: "default",
      description: "",
      name: "DEFAULT",
      sort_order: 0,
      is_system_default: true,
      status: true,
    },
  });

  const supabase = createClient();
  const submissionInProgress = useRef(false);
  const abortControllerRef = useRef<AbortController | null>(null);

  const { mutate: createCategory } = useTableInsert(supabase, "lookup_types");
  const { mutate: updateCategory } = useTableUpdate(supabase, "lookup_types");

// Only reset when editingCategory changes or when opening for creation
useEffect(() => {
  if (isOpen) {
    if (editingCategory) {
      const categoryLookups = lookupsByCategory?.[editingCategory] || [];
      if (categoryLookups.length > 0) {
        const template = categoryLookups[0];
        reset({
          category: template.category,
          code: template.code || "default",
          description: template.description || "",
          name: template.name || "DEFAULT",
          sort_order: template.sort_order || 0,
          is_system_default: template.is_system_default ?? true,
          status: template.status ?? true,
        });
      }
    } else {
      // New category: reset to defaults
      reset({
        category: "",
        code: "default",
        description: "",
        name: "DEFAULT",
        sort_order: 0,
        is_system_default: true,
        status: true,
      });
    }
  }
  // Do not reset on close, only on open
}, [isOpen, editingCategory, lookupsByCategory, reset]);

  const handleUpdateError = useCallback((error: unknown) => {
    const postgrestError = error as PostgrestError;
    if (
      postgrestError?.message?.includes("already exists") ||
      postgrestError?.code === "23505" ||
      postgrestError?.message?.includes("violates unique constraint")
    ) {
      toast.error("Category already exists");
    } else {
      toast.error(`Failed to update category: ${postgrestError?.message || "Unknown error"}`);
    }
  }, []);

  const handleCreateError = useCallback((error: unknown) => {
    const postgrestError = error as PostgrestError;
    if (
      postgrestError?.message?.includes("already exists") ||
      postgrestError?.code === "23505" ||
      postgrestError?.message?.includes("violates unique constraint")
    ) {
      toast.error("Category already exists");
    } else {
      toast.error(`Failed to create category: ${postgrestError?.message || "Unknown error"}`);
    }
  }, []);

  const onValidSubmit = useCallback(
    async (data: CategoryForm) => {
      const id = categories?.find((cat) => cat.category === editingCategory)?.id;
      if (submissionInProgress.current) return;

      if (!data.category.trim()) {
        toast.error("Category is required");
        return;
      }

      submissionInProgress.current = true;
      abortControllerRef.current = new AbortController();

      try {
        const formattedCategory = data.category
          .trim()
          .toUpperCase()
          .replace(/\s+/g, "_")
          .replace(/[^A-Z0-9_]/g, "");

        if (!formattedCategory) {
          toast.error("Please enter a valid category name");
          return;
        }

        const commonData = {
          ...data,
          category: formattedCategory,
          description: `Default entry for ${snakeToTitleCase(formattedCategory)} category`,
        };

        if (editingCategory) {
          updateCategory(
            { id: id!, data: commonData },
            {
              onSuccess: () => {
                if (abortControllerRef.current?.signal.aborted) return;
                toast.success(`Category renamed to "${formattedCategory}"`);
                onCategoryCreated?.(commonData);
                onClose();
              },
              onError: handleUpdateError,
              onSettled: () => {
                submissionInProgress.current = false;
              },
            }
          );
        } else {
          if (categories?.some((cat) => cat.category === formattedCategory)) {
            toast.error("Category already exists");
            submissionInProgress.current = false;
            return;
          }
          createCategory(commonData, {
            onSuccess: () => {
              if (abortControllerRef.current?.signal.aborted) return;
              onCategoryCreated?.(commonData);
              onClose();
            },
            onError: handleCreateError,
            onSettled: () => {
              submissionInProgress.current = false;
            },
          });
        }
      } catch (error) {
        console.error("Error saving category:", error);
        toast.error(`Failed to ${editingCategory ? "update" : "create"} category`);
        submissionInProgress.current = false;
      }
    },
    [categories, editingCategory, createCategory, updateCategory, onCategoryCreated, onClose, handleUpdateError, handleCreateError]
  );

  const handleClose = useCallback(() => {
    if (!isSubmitting && !submissionInProgress.current) {
      onClose();
    }
  }, [isSubmitting, onClose]);

  const categoryValue = watch("category") || "";
  const formattedPreview = categoryValue
    .trim()
    .toUpperCase()
    .replace(/\s+/g, "_")
    .replace(/[^A-Z0-9_]/g, "");

  const isEditing = !!editingCategory;

  return (
    <Modal isOpen={isOpen} onClose={handleClose} title={isEditing ? "Edit Category" : "Create New Category"}>
      <form onSubmit={handleSubmit(onValidSubmit)} className="space-y-4">
        <div className="grid grid-cols-1 gap-4 md:grid-cols-2">
          <div className="md:col-span-2">
            <label className="mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300">
              Category {isEditing ? "Name" : ""} <span className="text-red-500">*</span>
            </label>
            <Input
              type="text"
              {...register("category")}
              placeholder="Enter category (e.g., Node Type, System Type)"
              required
              disabled={isSubmitting || submissionInProgress.current}
              className="dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:placeholder-gray-400"
            />
            {formattedPreview && (
              <p className="mt-1 text-xs text-gray-500 dark:text-gray-400">
                Will be saved as:{" "}
                <code className="rounded bg-gray-100 px-1 py-0.5 dark:bg-gray-700 dark:text-gray-200">
                  {formattedPreview}
                </code>
              </p>
            )}
            {errors.category && (
              <p className="mt-1 text-xs text-red-500 dark:text-red-400">{errors.category.message}</p>
            )}
          </div>
        </div>

        <div
          className={`rounded-md border p-3 ${
            isEditing
              ? "border-yellow-200 bg-yellow-50 dark:border-yellow-800/50 dark:bg-yellow-900/20"
              : "border-blue-200 bg-blue-50 dark:border-blue-800/50 dark:bg-blue-900/20"
          }`}
        >
          <h4
            className={`mb-1 text-sm font-medium ${
              isEditing ? "text-yellow-900 dark:text-yellow-200" : "text-blue-900 dark:text-blue-200"
            }`}
          >
            {isEditing ? "Edit Category Notes:" : "Category Creation Notes:"}
          </h4>
          <ul
            className={`space-y-1 text-xs ${
              isEditing ? "text-yellow-800 dark:text-yellow-200/80" : "text-blue-800 dark:text-blue-200/80"
            }`}
          >
            {isEditing ? (
              <>
                <li>• This will update the category name for ALL lookup types in this category</li>
                <li>• Category name will be converted to uppercase with underscores</li>
                <li>• Special characters will be removed except letters, numbers, and underscores</li>
              </>
            ) : (
              <>
                <li>• Category field will be converted to uppercase with underscores</li>
                <li>• Special characters will be removed except letters, numbers, and underscores</li>
                <li>• Created and updated timestamps will be set automatically</li>
                <li>• ID will be generated automatically</li>
              </>
            )}
          </ul>
        </div>

        <div className="flex justify-end gap-2 pt-4">
          <Button
            type="button"
            variant="outline"
            onClick={handleClose}
            disabled={isSubmitting || submissionInProgress.current}
            className="dark:border-gray-700 dark:hover:bg-gray-800"
          >
            Cancel
          </Button>
          <Button
            type="submit"
            disabled={isSubmitting || submissionInProgress.current || !categoryValue.trim()}
          >
            {isSubmitting || submissionInProgress.current
              ? isEditing
                ? "Updating..."
                : "Creating..."
              : isEditing
              ? "Update Category"
              : "Create Category"}
          </Button>
        </div>
      </form>
    </Modal>
  );
}

```

<!-- path: hnvtx/components/categories/CategoriesTable.tsx -->
```typescript
import Link from "next/link";
import { FiEdit2, FiInfo } from "react-icons/fi";
import { Button } from "@/components/common/ui/Button";
import { Card } from "@/components/common/ui/Card";
import { formatCategoryName } from "@/components/categories/utils";
import { Categories, CategoryInfo } from "./categories-types";

interface CategoriesTableProps {
  categories: Categories[];
  categoryLookupCounts: Record<string, CategoryInfo>;
  totalCategories: number;
  onEdit: (categoryName: string) => void;
  onDelete: (categoryName: string) => void;
  isDeleting: boolean;
  searchTerm?: string;
}

export function CategoriesTable({
  categories,
  categoryLookupCounts,
  totalCategories,
  onEdit,
  onDelete,
  isDeleting,
  searchTerm,
}: CategoriesTableProps) {
  return (
    <Card className="overflow-hidden dark:border-gray-700 dark:bg-gray-800">
      <div className="border-b bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-700/50">
        <p className="text-sm text-gray-600 dark:text-gray-400">
          Showing {categories.length} of {totalCategories} unique categories
        </p>
      </div>

      {categories.length > 0 ? (
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50 dark:bg-gray-700/50">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-400">
                  Category Name
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-400">
                  Raw Value
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-400">
                  Lookup Types Count
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-400">
                  System Defaults
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase dark:text-gray-400">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-800">
              {categories.map((category) => {
                const categoryInfo = categoryLookupCounts[category.category];
                return (
                  <tr
                    key={category.id}
                    className="hover:bg-gray-50 dark:hover:bg-gray-700/50"
                  >
                    <td className="px-6 py-4 text-sm font-medium whitespace-nowrap text-gray-900 dark:text-white">
                      {formatCategoryName(category)}
                    </td>
                    <td className="px-6 py-4 font-mono text-sm whitespace-nowrap text-gray-500 dark:text-gray-400">
                      {category.category}
                    </td>
                    <td className="px-6 py-4 text-sm whitespace-nowrap text-gray-500 dark:text-gray-400">
                      <Link
                        href={`/dashboard/lookup?category=${category.category}`}
                      >
                        <span className="inline-flex items-center gap-1 hover:text-blue-600 dark:hover:text-blue-400">
                          {categoryInfo?.lookupCount ?? 0}
                          {categoryInfo?.lookupCount > 0 && (
                            <FiInfo
                              className="h-3 w-3 text-blue-500 dark:text-blue-400"
                              title="Click to view lookup types"
                            />
                          )}
                        </span>
                      </Link>
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap">
                      <span
                        className={`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${
                          categoryInfo?.hasSystemDefaults
                            ? "bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300"
                            : "bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"
                        }`}
                      >
                        {categoryInfo?.hasSystemDefaults ? "Yes" : "No"}
                      </span>
                    </td>
                    <td className="px-6 py-4 text-sm font-medium whitespace-nowrap">
                      <div className="flex items-center gap-2">
                        <Button
                          size="sm"
                          variant="outline"
                          onClick={() => onEdit(category.category)}
                          className="dark:border-gray-600 dark:hover:bg-gray-700"
                        >
                          <FiEdit2 className="h-4 w-4" />
                        </Button>
                        <Button
                          size="sm"
                          variant="outline"
                          onClick={() => onDelete(category.category)}
                          className="text-red-600 hover:text-red-800 dark:text-red-500 dark:hover:text-red-400 dark:border-gray-600 dark:hover:bg-gray-700"
                          disabled={isDeleting || categoryInfo?.hasSystemDefaults}
                          title={
                            isDeleting
                              ? "Deleting..."
                              : `Delete All "${category.category}" Categories`
                          }
                        >
                          {isDeleting
                            ? "Deleting..."
                            : `Delete All "${category.category}" Categories`}
                        </Button>
                      </div>
                    </td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      ) : (
        <div className="py-8 text-center text-gray-500 dark:text-gray-400">
          {searchTerm
            ? `No unique categories found matching "${searchTerm}".`
            : "No unique categories found."}
        </div>
      )}
    </Card>
  );
}
```

<!-- path: hnvtx/components/categories/categories-types.ts -->
```typescript
import { Database } from "@/types/supabase-types";

export type Categories = Database["public"]["Tables"]["lookup_types"]["Row"];
export type GroupedLookupsByCategory = Record<string, Categories[]>;

export interface CategoryInfo {
    name: string;
    lookupCount: number;
    hasSystemDefaults: boolean;
  }
```

<!-- path: hnvtx/components/nodes/index.ts -->
```typescript

```

<!-- path: hnvtx/components/nodes/NodesFilters.tsx -->
```typescript
"use client";

import { useState, useEffect, memo } from "react";
import { useDebounce } from "use-debounce";
import { FiSearch } from "react-icons/fi";
import { Input } from "@/components/common/ui/Input";
import { SearchableSelect, Option } from "@/components/common/ui/select/SearchableSelect";
import { DEFAULTS } from "@/config/constants";

interface NodesFiltersProps {
  searchQuery: string;
  onSearchChange: (value: string) => void;
  nodeTypes: Array<{ id: string; name: string }>;
  selectedNodeType?: string;
  onNodeTypeChange: (value: string | null) => void;
}

const NodesFiltersComponent = memo(({
  searchQuery,
  onSearchChange,
  nodeTypes,
  selectedNodeType = "",
  onNodeTypeChange
}: NodesFiltersProps) => {
  const [internalSearch, setInternalSearch] = useState(searchQuery);
  const [debouncedSearch] = useDebounce(internalSearch, DEFAULTS.DEBOUNCE_DELAY); 
  // Effect to call the parent's onSearchChange only when the debounced value changes
  useEffect(() => {
    onSearchChange(debouncedSearch);
  }, [debouncedSearch, onSearchChange]);

  // Effect to sync the internal state if the parent's state changes
  useEffect(() => {
    setInternalSearch(searchQuery);
  }, [searchQuery]);

  const nodeTypeOptions: Option[] = (nodeTypes || []).map((nt) => ({ value: nt.id, label: nt.name }));

  return (
    <div className='w-full'>
      <div className='flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-start'>
        <div className='relative flex-1 sm:max-w-md lg:max-w-xl'>
          <Input
            type='text'
            placeholder='Search nodes...'
            value={internalSearch} // Use internal state
            onChange={(e) => setInternalSearch(e.target.value)} // Update internal state
            leftIcon={<FiSearch className="text-gray-400 dark:text-gray-500" />}
            clearable={true}
            onClear={() => setInternalSearch("")} // Clear internal state
            className="dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:placeholder-gray-400"
          />
        </div>
        <div className='w-full sm:w-64'>
          <SearchableSelect
            options={nodeTypeOptions}
            value={selectedNodeType}
            onChange={(v) => onNodeTypeChange(v)}
            placeholder='Filter by node type'
            searchPlaceholder='Search node types...'
            clearable={true}
          />
        </div>
      </div>
    </div>
  );
});

NodesFiltersComponent.displayName = "NodesFilters";
export const NodesFilters = NodesFiltersComponent;
```

<!-- path: hnvtx/components/nodes/NodeFormModal.tsx -->
```typescript
"use client";

import React, { useCallback, useEffect, useMemo } from "react";
import { Modal } from "@/components/common/ui/Modal";
import { createClient } from "@/utils/supabase/client";
import { Database, TablesInsert } from "@/types/supabase-types";
import {
  useTableInsert,
  useTableUpdate,
  useTableQuery,
} from "@/hooks/database";
import { nodeFormSchema, type NodeFormData } from "@/schemas";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { FormCard } from "@/components/common/form/FormCard";
import {
  FormInput,
  FormSearchableSelect,
  FormTextarea,
} from "@/components/common/form/FormControls";
import { Option } from "@/components/common/ui/select/SearchableSelect";

export type NodeRow = Database["public"]["Tables"]["nodes"]["Row"];
export type NodeInsert = TablesInsert<"nodes">;

interface NodeFormModalProps {
  isOpen: boolean;
  onClose: () => void;
  editingNode?: NodeRow | null;
  onCreated?: (node: NodeRow) => void;
  onUpdated?: (node: NodeRow) => void;
}

export function NodeFormModal({
  isOpen,
  onClose,
  editingNode,
  onCreated,
  onUpdated,
}: NodeFormModalProps) {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
    reset,
    control,
  } = useForm({
    resolver: zodResolver(nodeFormSchema),
    defaultValues: {
      name: "",
      node_type_id: null,
      latitude: 0.0,
      longitude: 0.0,
      maintenance_terminal_id: null,
      remark: null,
      status: true,
    },
  });

  const supabase = createClient();
  const { mutate: insertNode, isPending: creating } = useTableInsert(
    supabase,
    "nodes"
  );
  const { mutate: updateNode, isPending: updating } = useTableUpdate(
    supabase,
    "nodes"
  );

  const isEdit = useMemo(() => Boolean(editingNode), [editingNode]);

  // Fetch node types, rings, and maintenance areas
  const { data: nodeTypes = [] } = useTableQuery(
    supabase,
    "lookup_types",
    {
      filters: {
        category: { operator: "eq", value: "NODE_TYPES" },
        name: { operator: "neq", value: "DEFAULT" },
      },
      orderBy: [{ column: "name", ascending: true }],
    }
  );
  const { data: maintenanceAreas = [] } =
    useTableQuery(supabase, "maintenance_areas", {
      filters: { status: { operator: "eq", value: true } },
      orderBy: [{ column: "name", ascending: true }],
    });

  useEffect(() => {
    if (!isOpen) return;
    if (editingNode) {
      reset({
        name: editingNode.name ?? "",
        node_type_id: editingNode.node_type_id ?? null,
        latitude: editingNode.latitude ?? 0.0,
        longitude: editingNode.longitude ?? 0.0,
        maintenance_terminal_id: editingNode.maintenance_terminal_id ?? null,
        remark:
          typeof editingNode.remark === "string" ? editingNode.remark : null,
        status: editingNode.status ?? true,
      });
    } else {
      reset({
        name: "",
        node_type_id: null,
        latitude: 0.0,
        longitude: 0.0,
        maintenance_terminal_id: null,
        remark: null,
        status: true,
      });
    }
  }, [isOpen, editingNode, reset]);

  const handleClose = useCallback(() => {
    if (creating || updating) return;
    onClose();
  }, [creating, updating, onClose]);

  const onValidSubmit = useCallback(
    (formData: NodeFormData) => {
      const submitData = {
        name: formData.name.trim(),
        node_type_id: formData.node_type_id,
        latitude: formData.latitude,
        longitude: formData.longitude,
        maintenance_terminal_id: formData.maintenance_terminal_id,
        remark: formData.remark,
        status: formData.status,
      };

      if (isEdit && editingNode) {
        updateNode(
          { id: editingNode.id, data: submitData as Partial<NodeInsert> },
          {
            onSuccess: (data: unknown) => {
              onUpdated?.(Array.isArray(data) ? data[0] : data);
              onClose();
            },
          }
        );
      } else {
        insertNode(submitData as NodeInsert, {
          onSuccess: (data: unknown) => {
            onCreated?.(Array.isArray(data) ? data[0] : data);
            onClose();
          },
        });
      }
    },
    [isEdit, editingNode, updateNode, insertNode, onUpdated, onCreated, onClose]
  );

  const submitting = creating || updating || isSubmitting;

  return (
    <Modal
      isOpen={isOpen}
      onClose={handleClose}
      title={""}
      size="full"
      visible={false}
      className="h-screen w-screen transparent bg-gray-700 rounded-2xl"
    >
      <FormCard
        title={isEdit ? "Edit Node" : "Add Node"}
        onSubmit={handleSubmit(onValidSubmit)}
        onCancel={handleClose}
        standalone
      >
        {/* Name */}
        <FormInput
          name="name"
          label="Node Name"
          register={register}
          error={errors.name}
          disabled={submitting}
          className="dark:bg-gray-900 dark:text-gray-100"
        />


        {/* Node Type */}
        <FormSearchableSelect
          name="node_type_id"
          label="Node Type"
          control={control}
          options={nodeTypes.map(
            (type) =>
              ({
                value: type.id,
                label: type.name,
              } as Option)
          )}
          error={errors.node_type_id}
          disabled={submitting}
          className="dark:bg-gray-900 dark:text-gray-100"
        />

        {/* Maintenance Terminal */}
        <FormSearchableSelect
          name="maintenance_terminal_id"
          label="Maintenance Terminal"
          control={control}
          options={maintenanceAreas.map(
            (mt) =>
              ({
                value: mt.id,
                label: mt.name,
              } as Option)
          )}
          error={errors.maintenance_terminal_id}
          disabled={submitting}
          className="dark:bg-gray-900 dark:text-gray-100"
        />


        {/* Coordinates */}
        <FormInput
          name="latitude"
          label="Latitude"
          register={register}
          error={errors.latitude}
          disabled={submitting}
          className="dark:bg-gray-900 dark:text-gray-100"
        />

        <FormInput
          name="longitude"
          label="Longitude"
          register={register}
          error={errors.longitude}
          disabled={submitting}
          className="dark:bg-gray-900 dark:text-gray-100"
        />


        {/* Remark */}
        <FormTextarea
          name="remark"
          label="Remark"
          control={control}
          error={errors.remark}
          disabled={submitting}
          className="dark:bg-gray-900 dark:text-gray-100"
        />

        {/* Status */}
        <FormInput
          name="status"
          label="Status"
          register={register}
          error={errors.status}
          disabled={submitting}
          className="dark:bg-gray-900 dark:text-gray-100"
        />
      </FormCard>
    </Modal>
  );
}

```

<!-- path: hnvtx/components/nodes/nodes_types.ts -->
```typescript
import { Database, TablesInsert } from "@/types/supabase-types";

// Base Node type from database
export type Node = Database["public"]["Tables"]["nodes"]["Row"];
export type NodeInsert = TablesInsert<"nodes">;

// Node with relations for display purposes
export interface NodeWithRelations extends Node {
  node_type: NodeType | null;
  ring?: Ring | null;
  maintenance_terminal?: MaintenanceTerminal | null;
}

// Supporting types
export interface NodeType {
  id: string;
  name: string;
  category: string;
  code?: string | null;
}

export interface Ring {
  id: string;
  name: string;
  code?: string | null;
}

export interface MaintenanceTerminal {
  id: string;
  name: string;
  code?: string | null;
}

export interface NodesFilters {
  status?: string;
  nodeType?: string;
}

export interface NodesPagination {
  current: number;
  pageSize: number;
  total: number;
}

```

<!-- path: hnvtx/components/systems/system-modal.tsx -->
```typescript
'use client';

import { FC, useCallback, useEffect, useMemo, useState } from 'react';
import { toast } from 'sonner';
import {
  useGetLookupTypesByCategory,
  useTableQuery,
  useTableInsert,
  useTableUpdate,
} from '@/hooks/database';
import { createClient } from '@/utils/supabase/client';
import { SystemFormData, systemFormSchema } from '@/schemas';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import z from 'zod';
import { Modal } from '@/components/common/ui';
import {
  FormCard,
  FormDateInput,
  FormInput,
  FormSearchableSelect,
  FormSwitch,
  FormTextarea,
} from '@/components/common/form';
import IPAddressInput from '@/components/common/form/IPAddressInput';
import { Option } from '@/components/common/ui/select/SearchableSelect';
import { SystemRowsWithCountWithRelations } from '@/types/view-row-types';

interface SystemModalProps {
  isOpen: boolean;
  onClose: () => void;
  rowData: SystemRowsWithCountWithRelations | null;
  refetch: () => void;
}

export const SystemModal: FC<SystemModalProps> = ({
  isOpen,
  onClose,
  rowData,
  refetch,
}) => {
  const supabase = createClient();
  const [ipv4Value, setIPv4Value] = useState<string>('');
  const [isProcessing, setIsProcessing] = useState(false);

  // Fetch data for dropdowns
  const { data: systemTypes = [], isLoading: isLoadingSystemTypes } =
    useGetLookupTypesByCategory(supabase, 'SYSTEM_TYPES');

  // Filter out DEFAULT system type
  const filteredSystemTypes = useMemo(() => {
    return systemTypes.filter((type) => type.name !== 'DEFAULT');
  }, [systemTypes]);

  const { data: nodes = [], isLoading: isLoadingNodes } = useTableQuery(
    supabase,
    'nodes',
    {
      columns: 'id, name',
      orderBy: [{ column: 'name' }],
    }
  );

  const {
    data: maintenanceTerminals = [],
    isLoading: isLoadingMaintenanceTerminals,
  } = useTableQuery(supabase, 'maintenance_areas', {
    columns: 'id, name',
    orderBy: [{ column: 'name' }],
  });
  const isLoading =
    isLoadingSystemTypes || isLoadingNodes || isLoadingMaintenanceTerminals;
  const systemTypesOptions: Option[] = useMemo(
    () =>
      filteredSystemTypes.map((t) => ({ value: String(t.id), label: t.code })),
    [filteredSystemTypes]
  );

  const nodesOptions: Option[] = useMemo(
    () => nodes.map((n) => ({ value: String(n.id), label: n.name })),
    [nodes]
  );

  const maintenanceTerminalsOptions: Option[] = useMemo(
    () =>
      maintenanceTerminals.map((t) => ({ value: String(t.id), label: t.name })),
    [maintenanceTerminals]
  );

  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
    reset,
    control,
    setValue,
  } = useForm<SystemFormData>({
    resolver: zodResolver(systemFormSchema),
    defaultValues: {
      system_name: null,
      system_type_id: '',
      node_id: '',
      maintenance_terminal_id: null,
      ip_address: '',
      commissioned_on: null,
      remark: null,
      status: true,
    },
  });

  // Reset form when modal opens or rowData changes
  useEffect(() => {
    if (!isOpen) {
      // Reset form when closing
      reset({
        system_name: null,
        system_type_id: '',
        node_id: '',
        maintenance_terminal_id: null,
        s_no: null,
        ip_address: '',
        commissioned_on: null,
        remark: null,
        status: true,
      });
      setIPv4Value('');
      return;
    }

    // Wait for options to load before populating
    if (isLoading) {
      return;
    }

    if (rowData) {
      console.log('Raw rowData:', rowData); // Debug log

      // Cast rowData to access the joined fields that aren't in the base type
      const extendedRowData = rowData as SystemRowsWithCountWithRelations;

      // Set IP address first
      const ipAddress = rowData.ip_address?.toString() || '';
      setIPv4Value(ipAddress);

      // Find IDs by matching names/codes from the related data
      const findSystemTypeId = () => {
        if (rowData.system_type_id) return String(rowData.system_type_id);
        if (extendedRowData.system_type_code) {
          const matchedType = systemTypesOptions.find(
            (option) => option.label === extendedRowData.system_type_code
          );
          return matchedType ? matchedType.value : '';
        }
        return '';
      };

      const findNodeId = () => {
        if (rowData.node_id) return String(rowData.node_id);
        if (extendedRowData.node_name) {
          const matchedNode = nodesOptions.find(
            (option) => option.label === extendedRowData.node_name
          );
          return matchedNode ? matchedNode.value : '';
        }
        return '';
      };

      const findMaintenanceTerminalId = () => {
        if (rowData.maintenance_terminal_id)
          return String(rowData.maintenance_terminal_id);
        if (extendedRowData.system_maintenance_terminal_name) {
          const matchedTerminal = maintenanceTerminalsOptions.find(
            (option) =>
              option.label === extendedRowData.system_maintenance_terminal_name
          );
          return matchedTerminal ? matchedTerminal.value : '';
        }
        return '';
      };

      // Prepare form values - ensure all IDs are strings and handle null/undefined
      const formValues = {
        system_name: rowData.system_name || null,
        system_type_id: findSystemTypeId(),
        node_id: findNodeId(),
        maintenance_terminal_id: findMaintenanceTerminalId(),
        s_no: rowData.s_no || null,
        ip_address: ipAddress,
        commissioned_on: rowData.commissioned_on
          ? new Date(rowData.commissioned_on)
          : null,
        remark: rowData.remark || null,
        status: rowData.status ?? true,
      };

      console.log('Populating form with:', formValues);
      console.log('Available options:', {
        systemTypesOptions,
        nodesOptions,
        maintenanceTerminalsOptions,
      });

      // Reset form with values
      reset(formValues);

      // Also set IP address in form
      setValue('ip_address', ipAddress, { shouldValidate: true });
    } else {
      // Reset to default values for new record
      reset({
        system_name: null,
        system_type_id: '',
        node_id: '',
        maintenance_terminal_id: null,
        s_no: null,
        ip_address: '',
        commissioned_on: null,
        remark: null,
        status: true,
      });
      setIPv4Value('');
    }
  // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [isOpen, rowData, reset, setValue, isLoading]);

  // Data mutations
  const onMutationSuccess = () => {
    refetch();
    onClose();
  };

  const createSystemMutation = useTableInsert(supabase, 'systems', {
    onSuccess: onMutationSuccess,
  });
  const updateSystemMutation = useTableUpdate(supabase, 'systems', {
    onSuccess: onMutationSuccess,
  });

  // Handle IP address changes
  const handleIPAddressChange = useCallback(
    (value: string, validation: { isValid: boolean | null }) => {
      setIPv4Value(value);
      if (validation.isValid === true || value === '') {
        setValue('ip_address', value, { shouldValidate: true });
      }
    },
    [setValue]
  );

  // FIXED: Simplified onValidSubmit - removed nested onSuccess callbacks
  const onValidSubmit = useCallback(
    async (formData: SystemFormData) => {
      if (isProcessing) return; // Prevent multiple submissions

      setIsProcessing(true);
      try {
        // Transform the form data according to the schema
        const transformedData = systemFormSchema.safeParse(formData);

        if (!transformedData.success) {
          console.error('Form validation error:', transformedData.error);
          toast.error('Validation failed. Please check the form for errors.');
          return;
        }

        // Ensure we're passing a plain object, not an array
        const dataToSubmit = { ...transformedData.data };

        if (rowData) {
          // For updates
          updateSystemMutation.mutate({
            id: rowData.id as string,
            data: dataToSubmit,
          });
        } else {
          // For new records - ensure we're passing a single object, not an array
          createSystemMutation.mutate(dataToSubmit);
        }
      } catch (error) {
        console.error('Form validation error:', error);
        if (error instanceof z.ZodError) {
          toast.error('Validation failed. Please check the form for errors.');
        } else {
          toast.error('An unexpected error occurred. Please try again.');
        }
      } finally {
        setIsProcessing(false);
      }
    },
    [isProcessing, rowData, updateSystemMutation, createSystemMutation]
  );

  const submitting =
    createSystemMutation.isPending ||
    updateSystemMutation.isPending ||
    isSubmitting;

  if (!isOpen) {
    return null;
  }

  return (
    <Modal
      isOpen={isOpen}
      onClose={onClose}
      title={rowData ? 'Edit System' : 'Add System'}
      visible={false}
      className="h-screen w-screen transparent bg-gray-700 rounded-2xl"
    >
      {/* Form */}
      <FormCard
        onSubmit={handleSubmit(onValidSubmit)}
        heightClass="min-h-calc(90vh - 200px)"
        title={rowData ? 'Edit System' : 'Add System'}
        onCancel={onClose}
        isLoading={isLoading}
        disableSubmit={submitting}
        standalone
      >
        <FormInput
          name="system_name"
          label="System Name"
          type="text"
          required
          register={register}
          error={errors.system_name}
        />

        <div className="form-group">
          <label className="block text-sm font-medium text-gray-700 mb-1">
            System Type <span className="text-red-500">*</span>
          </label>
          <FormSearchableSelect
            name="system_type_id"
            label=""
            control={control}
            options={systemTypesOptions}
            required
            error={errors.system_type_id}
          />
        </div>

        <div className="form-group">
          <label className="block text-sm font-medium text-gray-700 mb-1">
            Node / Location <span className="text-red-500">*</span>
          </label>
          <FormSearchableSelect
            name="node_id"
            label=""
            control={control}
            options={nodesOptions}
            required
            error={errors.node_id}
          />
        </div>

        <FormDateInput
          name="commissioned_on"
          label="Commissioned On"
          control={control}
          error={errors.commissioned_on}
        />

        <IPAddressInput
          value={ipv4Value}
          label="IP Address"
          onChange={handleIPAddressChange}
          placeholder="Enter IPv4 address (e.g., 192.168.1.1)"
          allowIPv4={true}
          allowIPv6={false}
        />

        <FormInput
          name="s_no"
          label="Serial Number"
          type="text"
          required
          register={register}
          error={errors.s_no}
        />

        <div className="form-group">
          <label className="block text-sm font-medium text-gray-700 mb-1">
            Maintenance Terminal <span className="text-red-500">*</span>
          </label>
          <FormSearchableSelect
            name="maintenance_terminal_id"
            label=""
            control={control}
            options={maintenanceTerminalsOptions}
            required
            error={errors.maintenance_terminal_id}
          />
        </div>

        <FormSwitch
          name="status"
          label="Status"
          control={control}
          error={errors.status}
          className="my-2"
        />

        <FormTextarea
          name="remark"
          label="Remark"
          control={control}
          error={errors.remark}
        />
      </FormCard>
    </Modal>
  );
};

```

<!-- path: hnvtx/components/maintenance-areas/index.ts -->
```typescript
export * from "./AreaFormModal";
export * from "./useMaintenanceAreasMutations";


```

<!-- path: hnvtx/components/maintenance-areas/useMaintenanceAreasMutations.ts -->
```typescript
// components/maintenance-areas/useMaintenanceAreasMutations.ts
import { createClient } from "@/utils/supabase/client";
import { useTableInsert, useTableUpdate, useToggleStatus } from "@/hooks/database";
import { TablesInsert, TablesUpdate } from "@/types/supabase-types";

export function useMaintenanceAreasMutations(
  supabase: ReturnType<typeof createClient>,
  onSuccess: () => void
) {
  const createAreaMutation = useTableInsert(supabase, "maintenance_areas", { onSuccess });
  const updateAreaMutation = useTableUpdate(supabase, "maintenance_areas", { onSuccess });
  const toggleStatusMutation = useToggleStatus(supabase, "maintenance_areas", { onSuccess });

  const handleFormSubmit = (
    data: TablesInsert<"maintenance_areas">,
    editingArea?: { id: string } | null
  ) => {
    if (editingArea?.id) {
      updateAreaMutation.mutate({ id: editingArea.id, data: data as TablesUpdate<"maintenance_areas"> });
    } else {
      createAreaMutation.mutate(data);
    }
  };

  return {
    createAreaMutation,
    updateAreaMutation,
    toggleStatusMutation,
    handleFormSubmit: (data: TablesInsert<"maintenance_areas">, editingArea?: { id: string } | null) => handleFormSubmit(data, editingArea)
  };
}
```

<!-- path: hnvtx/components/maintenance-areas/AreaFormModal.tsx -->
```typescript
// components/AreaFormModal.tsx
"use client";

import { useEffect, useMemo, useState } from "react";
import { MaintenanceArea, AreaFormModalProps } from "@/config/areas";
import { MaintenanceAreaFormData, maintenanceAreaFormSchema } from "@/schemas";
import { zodResolver } from "@hookform/resolvers/zod";
import { FormCard } from "../common/form/FormCard";
import { FormInput, FormSearchableSelect, FormSwitch, FormTextarea } from "@/components/common/form/FormControls";
import { useForm } from "react-hook-form";

export function AreaFormModal({
  isOpen,
  onClose,
  onSubmit,
  area,
  allAreas,
  areaTypes,
  isLoading
}: AreaFormModalProps) {

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
    control,
  } = useForm<MaintenanceAreaFormData>({
    resolver: zodResolver(maintenanceAreaFormSchema),
    defaultValues: {
      name: "",
      code: "",
      area_type_id: "",
      parent_id: null,
      contact_person: "",
      contact_number: "",
      email: "",
      address: "",
      latitude: null,
      longitude: null,
      status: true
    },
  });

  const [isInitialized, setIsInitialized] = useState(false);

  // Initialize form data when modal opens or area changes
  useEffect(() => {
    if (isOpen && !isInitialized) {
      if (area) {
        reset({
          name: area.name || "",
          code: area.code || "",
          area_type_id: area.area_type_id || "",
          parent_id: area.parent_id || null,
          contact_person: area.contact_person || "",
          contact_number: area.contact_number || "",
          email: area.email || "",
          address: area.address || "",
          latitude: area.latitude || null,
          longitude: area.longitude || null,
          status: area.status ?? true
        });
      } else {
        reset({
          name: "",
          code: "",
          area_type_id: "",
          parent_id: null,
          contact_person: "",
          contact_number: "",
          email: "",
          address: "",
          latitude: null,
          longitude: null,
          status: true
        });
      }
      setIsInitialized(true);
    }
  }, [area, isOpen, isInitialized, reset]);

  // Reset initialization when modal closes
  useEffect(() => {
    if (!isOpen) {
      setIsInitialized(false);
    }
  }, [isOpen]);

  const availableParents = useMemo(() => {
    if (!area) return allAreas;
    
    const getDescendantIds = (areaId: string, areas: MaintenanceArea[]): Set<string> => {
      const descendants = new Set<string>([areaId]);
      const children = areas.filter(a => a.parent_id === areaId);
      children.forEach(child => {
        const childDescendants = getDescendantIds(child.id, areas);
        childDescendants.forEach(id => descendants.add(id));
      });
      return descendants;
    };
    
    const excludeIds = getDescendantIds(area.id, allAreas);
    return allAreas.filter(a => !excludeIds.has(a.id));
  }, [area, allAreas]);

  const onValidSubmit = (data: MaintenanceAreaFormData) => {
    onSubmit(data);
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
      <div className="max-h-[90vh] w-full max-w-md overflow-y-auto rounded-lg bg-white p-6 dark:bg-gray-800">
        <div className="mb-4 flex items-center justify-between">
          <h2 className="text-lg font-semibold text-gray-900 dark:text-white">
            {area ? "Edit Area" : "Add New Area"}
          </h2>
          <button 
            onClick={onClose} 
            className="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
            disabled={isLoading}
            aria-label="Close modal"
          >
            ×
          </button>
        </div>
        
        <FormCard 
          onSubmit={handleSubmit(onValidSubmit)} 
          title={area ? "Edit Area" : "Add New Area"} 
          onCancel={onClose}
          isLoading={isLoading}
          heightClass="max-h-[calc(90vh-140px)]"
        >
          {/* Name Field */}
          <FormInput
            name="name"
            label="Area Name"
            register={register}
            error={errors.name}
            required
            disabled={isLoading}
          />
          
          {/* Code Field */}
          <FormInput
            name="code"
            label="Area Code"
            register={register}
            error={errors.code}
            disabled={isLoading}
          />
          
          {/* Area Type Field */}
          <FormSearchableSelect
            name="area_type_id"
            label="Area Type"
            control={control}
            error={errors.area_type_id}
            disabled={isLoading}
            options={areaTypes
              .filter(type => type.name !== "DEFAULT")
              .map(type => ({ value: type.id, label: type.name }))
            }
          />
          
          {/* Parent Area Field */}
          <FormSearchableSelect
            name="parent_id"
            label="Parent Area"
            control={control}
            error={errors.parent_id}
            disabled={isLoading}
            options={availableParents.map(a => ({ value: a.id, label: a.name }))}
          />
          
          {/* Contact Person Field */}
          <FormInput
            name="contact_person"
            label="Contact Person"
            register={register}
            error={errors.contact_person}
            disabled={isLoading}
          />
          
          {/* Contact Number Field */}
          <FormInput
            name="contact_number"
            label="Contact Number"
            register={register}
            error={errors.contact_number}
            disabled={isLoading}
          />
          
          {/* Email Field */}
          <FormInput
            name="email"
            label="Email Address"
            register={register}
            error={errors.email}
            disabled={isLoading}
          />
          
          {/* Address Field */}
          <FormTextarea
            name="address"
            label="Address"
            control={control}
            error={errors.address}
            disabled={isLoading}
          />
          
          {/* Coordinates Fields */}
          <FormInput
            name="latitude"
            label="Latitude"
            register={register}
            error={errors.latitude}
            disabled={isLoading}
          />
          <FormInput
            name="longitude"
            label="Longitude"
            register={register}
            error={errors.longitude}
            disabled={isLoading}
          />
          
          {/* Status Field */}
          <FormSwitch
            name="status"
            label="Active"
            control={control}
            error={errors.status}
            className="mt-2"
          />
        </FormCard>
      </div>
    </div>
  );
}
```

<!-- path: hnvtx/components/designations/DesignationFormModal.tsx -->
```typescript
import { useEffect, useMemo } from "react";
import { EmployeeDesignation, DesignationWithRelations } from "@/config/designations";
import { useForm } from "react-hook-form";
import { employeeDesignationSchema } from "@/schemas";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { FormCard } from "../common/form/FormCard";
import { FormInput, FormSearchableSelect, FormSwitch } from "@/components/common/form/FormControls";

interface DesignationFormModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSubmit: (data: EmployeeDesignation) => void;
  designation: DesignationWithRelations | null;
  allDesignations: EmployeeDesignation[];
  isLoading: boolean;
}

export function DesignationFormModal({ isOpen, onClose, onSubmit, designation, allDesignations, isLoading }: DesignationFormModalProps) {
  // === React Hook Form Setup ===
  // Create a form-specific schema that excludes timestamp fields to avoid Date vs string/null mismatches
  const designationFormSchema = employeeDesignationSchema.pick({ id: true, name: true, parent_id: true, status: true });
  type DesignationForm = z.infer<typeof designationFormSchema>;

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
    control,
  } = useForm<DesignationForm>({
    resolver: zodResolver(designationFormSchema),
    defaultValues: {
      name: "",
      parent_id: null,
      status: true,
    },
  });

  const availableParents = useMemo(() => {
    if (!designation) return allDesignations;

    const getDescendantIds = (designationId: string, designations: EmployeeDesignation[]): Set<string> => {
      const descendants = new Set<string>([designationId]);
      const children = designations.filter((d) => d.parent_id === designationId);
      children.forEach((child) => {
        const childDescendants = getDescendantIds(child.id, designations);
        childDescendants.forEach((id) => descendants.add(id));
      });
      return descendants;
    };

    const excludeIds = getDescendantIds(designation.id, allDesignations);
    return allDesignations.filter((d) => !excludeIds.has(d.id));
  }, [designation, allDesignations]);

  // Reset form when designation changes (to pre-fill the form when editing)
  useEffect(() => {
    if (designation) {
      reset({
        id: designation.id,
        name: designation.name,
        parent_id: designation.parent_id ?? null,
        status: designation.status ?? true,
      });
    }
  }, [designation, reset]);

  const onValidSubmit = (data: DesignationForm) => {
    // Forward only the fields we collect; backend/consumer can add timestamps as needed
    const parsedData = {
      ...data,
    };
    onSubmit(parsedData as unknown as EmployeeDesignation);
  };

  if (!isOpen) return null;

  return (
    <div className='fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50'>
      <div className='max-h-[90vh] w-full max-w-md overflow-y-auto rounded-lg bg-white p-6 dark:bg-gray-800'>
        <div className='mb-4 flex items-center justify-between'>
          <h2 className='text-lg font-semibold text-gray-900 dark:text-white'>{designation ? "Edit Designation" : "Add New Designation"}</h2>
          <button onClick={onClose} className='text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'>
            ×
          </button>
        </div>
        <FormCard onSubmit={handleSubmit(onValidSubmit)} title={designation ? "Edit Designation" : "Add New Designation"} onCancel={onClose} heightClass="h-[calc(90vh-140px)]">
          <FormInput name='name' label='Designation Name' register={register} error={errors.name} required />
          <FormSearchableSelect name='parent_id' label='Parent Designation' control={control} error={errors.parent_id} required options={availableParents.map((d) => ({ value: d.id, label: d.name }))} />
          <FormSwitch name='status' label='Status' control={control} error={errors.status} className="mt-4" />
        </FormCard>
      </div>
    </div>
  );
}

```

<!-- path: hnvtx/components/outdated/OutdatedBrowserModal.tsx -->
```typescript

// components/outdated/OutdatedBrowserModal.tsx
import React from 'react'

interface OutdatedBrowserModalProps {
  handleCloseModal: () => void;
}

const OutdatedBrowserModal: React.FC<OutdatedBrowserModalProps> = ({ handleCloseModal }) => {
  return (
    <>
    <div className="modal-overlay" id="browserModal">
          <div className="modal-content">
            <h2 className="modal-title">⚠️ Outdated or Unsupported Browser</h2>
            <p className="modal-text">
              Your browser is outdated or missing critical features. Some
              functionality may not work properly.
            </p>

            <div className="recommendation-box">
              <h3 className="recommendation-title">Recommended browsers:</h3>
              <ul className="browser-list">
                <li>Google Chrome 110+</li>
                <li>Mozilla Firefox 100+</li>
                <li>Microsoft Edge 110+</li>
                <li>Safari 15+</li>
              </ul>
            </div>

            <div className="button-container">
              <a
                href="https://www.google.com/chrome/"
                target="_blank"
                rel="noopener noreferrer"
                className="download-button chrome-button"
              >
                Download Chrome
              </a>
              <a
                href="https://www.mozilla.org/firefox/new/"
                target="_blank"
                rel="noopener noreferrer"
                className="download-button firefox-button"
              >
                Download Firefox
              </a>
              <button onClick={handleCloseModal} className="continue-button">
                Continue Anyway
              </button>
            </div>
          </div>
        </div>
    </>
  )
}

export default OutdatedBrowserModal
```

<!-- path: hnvtx/components/common/filters/SearchAndFilters.tsx -->
```typescript
import { motion } from "framer-motion";
import { FiSearch, FiX, FiFilter, FiChevronDown, FiChevronUp } from "react-icons/fi";

interface SearchAndFiltersProps {
  searchTerm: string;
  onSearchChange: (value: string) => void;
  showFilters: boolean;
  onToggleFilters: () => void;
  onClearFilters: () => void;
  hasActiveFilters: boolean;
  activeFilterCount: number; // More descriptive than a boolean
  searchPlaceholder?: string;
  children: React.ReactNode;
}

export function SearchAndFilters({
  searchTerm,
  onSearchChange,
  showFilters,
  onToggleFilters,
  onClearFilters,
  hasActiveFilters,
  activeFilterCount,
  searchPlaceholder = "Search...",
  children,
}: SearchAndFiltersProps) {
  return (
    <div className="space-y-3 sm:space-y-4 w-full p-4 border-b border-gray-200 dark:border-gray-700">
      {/* Search and Controls Row */}
      <div className="flex flex-col space-y-3 sm:space-y-0 sm:flex-row sm:gap-3 sm:justify-between sm:items-center">
        {/* Search Input */}
        <div className="flex-1 sm:max-w-md lg:max-w-xl">
          <div className="relative">
            <FiSearch className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4 sm:w-5 sm:h-5" />
            <input
              type="text"
              placeholder={searchPlaceholder}
              value={searchTerm}
              onChange={(e) => onSearchChange(e.target.value)}
              className="w-full pl-9 sm:pl-10 pr-4 py-2.5 sm:py-2 text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
            />
          </div>
        </div>

        {/* Filter and Clear Buttons */}
        <div className="flex gap-2 sm:gap-3">
          <button
            onClick={onToggleFilters}
            className={`flex items-center gap-2 px-3 sm:px-4 py-2.5 sm:py-2 border rounded-lg font-medium text-sm sm:text-base transition-all duration-200 flex-1 sm:flex-none justify-center sm:justify-start ${
              showFilters || activeFilterCount > 0
                ? "border-blue-500 bg-blue-50 text-blue-700 dark:border-blue-400 dark:bg-blue-900/30 dark:text-blue-300 shadow-sm"
                : "border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-400"
            }`}
          >
            <FiFilter size={16} className="w-4 h-4 sm:w-4 sm:h-4" />
            <span className="hidden sm:inline">Filters</span>
            <span className="sm:hidden">Filter</span>
            {showFilters ? <FiChevronUp size={14} /> : <FiChevronDown size={14} />}
            {activeFilterCount > 0 && (
              <span className="bg-blue-600 text-white text-xs rounded-full px-1.5 sm:px-2 py-0.5 font-semibold min-w-[18px] sm:min-w-[20px] text-center leading-none">
                {activeFilterCount}
              </span>
            )}
          </button>

          {hasActiveFilters && (
            <button
              onClick={onClearFilters}
              className="flex items-center gap-2 px-3 sm:px-4 py-2.5 sm:py-2 text-sm sm:text-base text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors font-medium border border-transparent hover:border-red-200 flex-shrink-0"
            >
              <FiX className="w-4 h-4" />
              <span className="hidden sm:inline">Clear All</span>
              <span className="sm:hidden">Clear</span>
            </button>
          )}
        </div>
      </div>

      {/* Collapsible Filter Panel */}
      {showFilters && (
        <motion.div
          initial={{ opacity: 0, height: 0 }}
          animate={{ opacity: 1, height: "auto" }}
          exit={{ opacity: 0, height: 0 }}
          transition={{ duration: 0.2, ease: "easeInOut" }}
          className="overflow-hidden"
        >
          <div className="pt-3 sm:pt-4">
            <div className="p-3 sm:p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700">
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                {children}
              </div>
            </div>
          </div>
        </motion.div>
      )}
    </div>
  );
}
```

<!-- path: hnvtx/components/common/filters/FilterInputs.tsx -->
```typescript
import { SearchableSelect, Option } from '@/components/common/ui/select/SearchableSelect';
import { Input } from '@/components/common/ui/Input';
import { Filters } from '@/hooks/database';
import React from 'react';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '../ui/select/Select';

// --- TYPE DEFINITIONS ---

interface FilterWrapperProps {
  label: string;
}

interface SelectFilterProps extends FilterWrapperProps {
  filterKey: string; // The key to modify in the filters object
  filters: Filters;
  setFilters: React.Dispatch<React.SetStateAction<Filters>>;
  options: Option[];
  placeholder?: string;
}

interface InputFilterProps extends FilterWrapperProps {
  filterKey: string;
  filters: Filters;
  setFilters: React.Dispatch<React.SetStateAction<Filters>>;
  placeholder?: string;
}

// --- COMPONENTS ---

export const SelectFilter: React.FC<SelectFilterProps> = ({
  label,
  filterKey,
  filters,
  setFilters,
  options,
  placeholder,
}) => {
  // Safely extract the current value, ensuring it's a string for the component.
  const currentValue = filters[filterKey];
  const valueAsString =
    typeof currentValue === 'string' || typeof currentValue === 'number'
      ? String(currentValue)
      : '';

  const handleChange = (newValue: string | null) => {
    setFilters((prevFilters) => {
      const newFilters = { ...prevFilters };
      if (newValue === null || newValue === '') {
        // When cleared, remove the key entirely for a cleaner state.
        delete newFilters[filterKey];
      } else {
        newFilters[filterKey] = newValue;
      }
      return newFilters;
    });
  };

  return (
    <div className="space-y-2">
      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">
        {label}
      </label>
      <SearchableSelect
        options={options}
        value={valueAsString}
        onChange={handleChange}
        placeholder={placeholder || `All ${label}s`}
        clearable
      />
      {/* <Select
        value={(valueAsString as string) ?? ''}
        onValueChange={(value) => handleChange(value)}
      >
        <SelectTrigger className="w-full">
          <SelectValue placeholder={placeholder ?? 'Select'} />
        </SelectTrigger>
        <SelectContent>
          {options.map((option) => (
            <SelectItem
              key={option.value}
              value={option.value}
              disabled={option.disabled}
            >
              {option.label}
            </SelectItem>
          ))}
        </SelectContent>
      </Select> */}
    </div>
  );
};

export const InputFilter: React.FC<InputFilterProps> = ({
  label,
  filterKey,
  filters,
  setFilters,
  placeholder,
}) => {
  // Safely extract the current value
  const currentValue = filters[filterKey];
  const valueAsString =
    typeof currentValue === 'string' || typeof currentValue === 'number'
      ? String(currentValue)
      : '';

  const handleChange = (newValue: string) => {
    setFilters((prevFilters) => {
      const newFilters = { ...prevFilters };
      if (newValue === '') {
        delete newFilters[filterKey];
      } else {
        newFilters[filterKey] = newValue;
      }
      return newFilters;
    });
  };

  return (
    <div className="space-y-2">
      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">
        {label}
      </label>
      <Input
        type="text"
        value={valueAsString}
        onChange={(e) => handleChange(e.target.value)}
        placeholder={placeholder || `Filter by ${label}...`}
      />
    </div>
  );
};

```

<!-- path: hnvtx/components/common/PageHeader.tsx -->
```typescript
'use client';

import React, { ReactNode, useCallback, useMemo, useState } from 'react';
import { FiDownload, FiPlus, FiRefreshCw, FiChevronDown } from 'react-icons/fi';
import { toast } from 'sonner';
import { createClient } from '@/utils/supabase/client';
import { Filters, TableOrViewName, Row } from '@/hooks/database';
import { useDynamicColumnConfig } from '@/hooks/useColumnConfig';
import { Button, ButtonProps } from '@/components/common/ui/Button/Button';
import { useTableExcelDownload } from '@/hooks/database/excel-queries';
import { formatDate } from '@/utils/formatters';
import { cn } from '@/lib/utils';
import { CardSkeleton } from '@/components/common/ui/table/TableSkeleton';

// --- TYPE DEFINITIONS ---

interface ExportFilterOption {
  label: string;
  filters?: Filters;
  fileName?: string;
}

interface ExportConfig<T extends TableOrViewName> {
  tableName: T;
  maxRows?: number;
  columns?: (keyof Row<T> & string)[]; // Allow specifying a subset of columns for export
  filterOptions?: ExportFilterOption[]; // New: array of filter options
  // Deprecated: keeping for backward compatibility
  filters?: Filters;
  fileName?: string;
}

export interface ActionButton extends ButtonProps {
  label: string;
  hideOnMobile?: boolean;
  hideTextOnMobile?: boolean;
  priority?: 'high' | 'medium' | 'low'; // For mobile button ordering
  isDropdown?: boolean; // New: indicates if this is a dropdown button
  dropdownoptions?: Array<{
    label: string;
    onClick: () => void;
    disabled?: boolean;
  }>;
}

interface StatProps {
  value: string | number;
  label: string;
  icon?: ReactNode;
  color?: 'primary' | 'success' | 'warning' | 'danger' | 'default';
}

export interface PageHeaderProps {
  title: string;
  description?: string;
  icon?: ReactNode;
  stats?: StatProps[];
  actions?: ActionButton[];
  isLoading?: boolean;
  className?: string;
}

// --- SUB-COMPONENTS ---

const StatCard: React.FC<StatProps> = ({
  value,
  label,
  icon,
  color = 'default',
}) => {
  const statColors = {
    primary: 'text-blue-600 dark:text-blue-400',
    success: 'text-green-600 dark:text-green-400',
    warning: 'text-yellow-600 dark:text-yellow-400',
    danger: 'text-red-600 dark:text-red-400',
    default: 'text-gray-900 dark:text-white',
  };
  return (
    <div className="rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-900 flex items-start gap-4">
      {icon && (
        <div className={`flex-shrink-0 text-2xl ${statColors[color]}`}>
          {icon}
        </div>
      )}
      <div>
        <div className={`text-2xl font-bold ${statColors[color]}`}>{value}</div>
        <div className="text-sm text-gray-600 dark:text-gray-400">{label}</div>
      </div>
    </div>
  );
};

const DropdownButton: React.FC<ActionButton> = ({
  label,
  dropdownoptions = [],
  disabled,
  variant = 'outline',
  leftIcon,
  className,
  ...props
}) => {
  const [isOpen, setIsOpen] = useState(false);

  return (
    <div className="relative">
      <Button
        {...props}
        variant={variant}
        disabled={disabled}
        onClick={() => setIsOpen(!isOpen)}
        className={cn('flex items-center gap-2', className)}
        leftIcon={leftIcon}
        rightIcon={
          <FiChevronDown
            className={`transition-transform ${isOpen ? 'rotate-180' : ''}`}
          />
        }
      >
        {label}
      </Button>

      {isOpen && (
        <>
          {/* Backdrop */}
          <div
            className="fixed inset-0 z-10"
            onClick={() => setIsOpen(false)}
          />
          {/* Dropdown Menu */}
          <div className="absolute right-0 top-full z-20 mt-1 min-w-[200px] rounded-md border border-gray-200 bg-white py-1 shadow-lg dark:border-gray-700 dark:bg-gray-800">
            {dropdownoptions.map((option, index) => (
              <button
                key={index}
                onClick={() => {
                  option.onClick();
                  setIsOpen(false);
                }}
                disabled={option.disabled}
                className="block w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50 dark:text-gray-300 dark:hover:bg-gray-700"
              >
                {option.label}
              </button>
            ))}
          </div>
        </>
      )}
    </div>
  );
};

// --- MAIN COMPONENT ---

export function PageHeader({
  title,
  description,
  icon,
  stats,
  actions = [],
  isLoading = false,
  className,
}: PageHeaderProps) {
  return (
    <>
      {isLoading ? (
        <CardSkeleton />
      ) : (
        <div
          className={cn(
            'space-y-4 sm:space-y-6',
            isLoading && 'opacity-50',
            className
          )}
        >
          {/* Header Section */}
          <div className="flex flex-col space-y-4 lg:space-y-0 lg:flex-row lg:items-start lg:justify-between">
            <div className="flex-1 space-y-2 sm:space-y-3 min-w-0">
              <div className="flex flex-col space-y-2 sm:space-y-0 sm:flex-row sm:items-center sm:gap-3">
                {icon && (
                  <div className="text-2xl sm:text-3xl text-blue-600 dark:text-blue-400">
                    {icon}
                  </div>
                )}
                <h1 className="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white leading-tight">
                  {title}
                </h1>
              </div>
              {description && (
                <p className="text-gray-600 dark:text-gray-400 text-base sm:text-lg leading-relaxed">
                  {description}
                </p>
              )}
            </div>

            {/* Desktop Action Buttons */}
            <div className="hidden lg:flex items-center gap-2 flex-shrink-0 ml-4">
              {actions.map((action, index) =>
                action.isDropdown ? (
                  <DropdownButton
                    key={`desktop-dropdown-${index}`}
                    {...action}
                    disabled={action.disabled || isLoading}
                  />
                ) : (
                  <Button
                    key={`desktop-action-${index}`}
                    {...action}
                    disabled={action.disabled || isLoading}
                  >
                    {action.label}
                  </Button>
                )
              )}
            </div>
          </div>

          {/* Stats and Mobile Actions Row */}
          <div className="flex flex-col space-y-4 sm:space-y-0 sm:flex-row sm:items-center sm:justify-between sm:gap-4">
            {/* Stats Grid */}
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 flex-grow">
              {isLoading
                ? Array.from({ length: stats?.length || 2 }).map((_, i) => (
                    <div
                      key={`stat-skeleton-${i}`}
                      className="rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-900 animate-pulse"
                    >
                      <div className="h-8 w-1/2 rounded-md bg-gray-200 dark:bg-gray-700 mb-2"></div>
                      <div className="h-4 w-3/4 rounded-md bg-gray-200 dark:bg-gray-700"></div>
                    </div>
                  ))
                : stats?.map((stat) => <StatCard key={stat.label} {...stat} />)}
            </div>

            {/* Mobile/Tablet Action Buttons */}
            <div className="flex lg:hidden items-center gap-2 w-full sm:w-auto sm:flex-shrink-0">
              {actions.map((action, index) =>
                action.isDropdown ? (
                  <DropdownButton
                    key={`mobile-dropdown-${index}`}
                    {...action}
                    className={`flex-1 sm:flex-none ${
                      action.hideOnMobile ? 'hidden sm:flex' : ''
                    }`}
                    disabled={action.disabled || isLoading}
                  />
                ) : (
                  <Button
                    key={`mobile-action-${index}`}
                    {...action}
                    className={`flex-1 sm:flex-none ${
                      action.hideOnMobile ? 'hidden sm:flex' : ''
                    }`}
                    disabled={action.disabled || isLoading}
                  >
                    {action.hideTextOnMobile ? '' : action.label}
                  </Button>
                )
              )}
            </div>
          </div>
        </div>
      )}
    </>
  );
}

// --- HOOK FOR CREATING STANDARD ACTIONS ---

interface StandardActionsConfig<T extends TableOrViewName> {
  onRefresh?: () => void;
  onAddNew?: () => void;
  exportConfig?: ExportConfig<T>;
  isLoading?: boolean;
  data?: Row<T>[];
}

export function useStandardHeaderActions<T extends TableOrViewName>({
  onRefresh,
  onAddNew,
  exportConfig,
  isLoading,
  data,
}: StandardActionsConfig<T>): ActionButton[] {
  const supabase = useMemo(() => createClient(), []);
  const columns = useDynamicColumnConfig(exportConfig?.tableName as T, {
    data: data,
  });

  const tableExcelDownload = useTableExcelDownload(
    supabase,
    exportConfig?.tableName as T,
    {
      onSuccess: () => toast.success('Export successful!'),
      onError: (err) => toast.error(`Export failed: ${err.message}`),
    }
  );

  const handleExport = useCallback(
    (filterOption?: ExportFilterOption) => {
      if (!exportConfig?.tableName) {
        toast.error('Export failed: Table name not configured.');
        return;
      }

      // Use filterOption filters if provided, otherwise fall back to exportConfig filters
      const filters = filterOption?.filters || exportConfig.filters;

      // Determine the file and sheet name
      let fileName: string;
      let sheetName: string;

      if (filterOption) {
        // If it's a filter option, use custom fileName or append label to table name
        if (filterOption.fileName) {
          fileName = filterOption.fileName;
          sheetName = filterOption.fileName;
        } else {
          // Append filter label to table name
          fileName = `${exportConfig.tableName}-${filterOption.label
            .toLowerCase()
            .replace(/\s+/g, '-')}`;
          sheetName = `${exportConfig.tableName}-${filterOption.label}`;
        }
      } else {
        // No filter option - use default table name or custom fileName
        fileName = exportConfig.fileName || exportConfig.tableName;
        sheetName = exportConfig.fileName || exportConfig.tableName;
      }

      tableExcelDownload.mutate({
        fileName: `${formatDate(new Date(), {
          format: 'dd-mm-yyyy',
        })}-${fileName}.xlsx`,
        sheetName: sheetName,
        filters: filters,
        columns: columns.filter((c) =>
          exportConfig.columns
            ? exportConfig.columns.includes(c.key as keyof Row<T> & string)
            : true
        ),
        maxRows: exportConfig.maxRows,
      });
    },
    [exportConfig, columns, tableExcelDownload]
  );

  return useMemo(() => {
    const actions: ActionButton[] = [];

    if (onRefresh) {
      actions.push({
        label: 'Refresh',
        onClick: onRefresh,
        variant: 'outline',
        leftIcon: <FiRefreshCw className={isLoading ? 'animate-spin' : ''} />,
        disabled: isLoading,
      });
    }

    if (exportConfig) {
      // Check if we have multiple filter options
      if (exportConfig.filterOptions && exportConfig.filterOptions.length > 0) {
        // Create dropdown with filter options
        const dropdownoptions = [
          {
            label: 'Export All (No Filters)',
            onClick: () =>
              handleExport({
                label: 'All',
                filters: undefined,
                fileName: undefined,
              }),
            disabled: tableExcelDownload.isPending,
          },
          ...exportConfig.filterOptions.map((option) => ({
            label: `Export ${option.label}`,
            onClick: () => handleExport(option),
            disabled: tableExcelDownload.isPending,
          })),
        ];

        actions.push({
          label: tableExcelDownload.isPending ? 'Exporting...' : 'Export',
          variant: 'outline',
          leftIcon: <FiDownload />,
          disabled: isLoading || tableExcelDownload.isPending,
          isDropdown: true,
          dropdownoptions: dropdownoptions,
        });
      } else {
        // Single export button (backward compatibility)
        actions.push({
          label: tableExcelDownload.isPending ? 'Exporting...' : 'Export',
          onClick: () => handleExport(),
          variant: 'outline',
          leftIcon: <FiDownload />,
          disabled: isLoading || tableExcelDownload.isPending,
        });
      }
    }

    if (onAddNew) {
      actions.push({
        label: 'Add New',
        onClick: onAddNew,
        variant: 'primary',
        leftIcon: <FiPlus />,
        disabled: isLoading,
      });
    }

    return actions;
  }, [
    onRefresh,
    onAddNew,
    exportConfig,
    isLoading,
    handleExport,
    tableExcelDownload.isPending,
  ]);
}

```

<!-- path: hnvtx/components/common/entity-management/DetailItem.tsx -->
```typescript
import React from 'react';
import { BaseEntity } from '@/components/common/entity-management/types';

interface DetailItemProps<T extends BaseEntity> {
  label: string;
  value: any;
  type: 'text' | 'status' | 'parent' | 'date' | 'custom';
  entity: T;
  render?: (value: any, entity: T) => React.ReactNode;
}

export function DetailItem<T extends BaseEntity>({
  label,
  value,
  type,
  entity,
  render,
}: DetailItemProps<T>) {
  if (!value && type !== 'status') return null;

  const renderValue = () => {
    if (render) {
      return render(value, entity);
    }

    switch (type) {
      case 'status':
        return (
          <span
            className={`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${
              value
                ? "bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200"
                : "bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200"
            }`}
          >
            {value ? "Active" : "Inactive"}
          </span>
        );
      case 'parent':
        return value?.name || 'No parent';
      case 'date':
        return value ? new Date(value).toLocaleDateString() : 'N/A';
      case 'text':
      default:
        return String(value);
    }
  };

  return (
    <div className="py-2">
      <dt className="text-sm font-medium text-gray-500 dark:text-gray-400">{label}</dt>
      <dd className="mt-1 text-sm text-gray-900 dark:text-gray-100">{renderValue()}</dd>
    </div>
  );
}
```

<!-- path: hnvtx/components/common/entity-management/types.ts -->
```typescript
// components/common/entity-management/types.ts
import { UseQueryResult } from '@tanstack/react-query';

export interface BaseEntity {
  id: string;
  name: string;
  status: boolean | null;
  created_at?: string | null;
  updated_at?: string | null;
}

export interface HierarchicalEntity extends BaseEntity {
  parent_id?: string | null;
  parent?: HierarchicalEntity | null;
}

// Utility type for entities with computed children
export type EntityWithChildren<T extends BaseEntity> = T & {
  children: EntityWithChildren<T>[];
};

// Type guard functions
export function isHierarchicalEntity<T extends BaseEntity>(
  entity: T
): entity is T & HierarchicalEntity {
  return 'parent_id' in entity || 'parent' in entity;
}

export interface EntityConfig<T extends BaseEntity> {
  entityName: string;
  entityDisplayName: string;
  entityPluralName: string;
  parentField?: keyof T;
  icon: React.ComponentType<{ className?: string }>;
  isHierarchical: boolean;
  searchFields: (keyof T)[];
  detailFields: Array<{
    key: keyof T;
    label: string;
    type: 'text' | 'status' | 'parent' | 'date' | 'custom';
    render?: (value: any, entity: T) => React.ReactNode;
  }>;
  filterOptions: Array<{
    key: string;
    label: string;
    type: 'select' | 'text' | 'date';
    options?: Array<{ value: string; label: string }>;
  }>;
}

// Interface for the hook props
export interface UseEntityManagementProps<T extends BaseEntity> {
  entitiesQuery: UseQueryResult<T[], Error>;
  config: EntityConfig<T>;
  onEdit: (entity: T) => void;
  onDelete: (entity: { id: string; name: string }) => void;
  onToggleStatus: (e: React.MouseEvent, entity: T) => void;
  onCreateNew: () => void;
}

// Updated component interfaces
export interface EntityTreeItemProps<T extends BaseEntity> {
    entity: EntityWithChildren<T>;
    config: EntityConfig<T>;
    level: number;
    selectedEntityId: string | null;
    expandedEntities: Set<string>;
    onSelect: (id: string) => void;
    onToggleExpand: (id: string) => void;
    onToggleStatus: (e: React.MouseEvent, entity: T) => void;
    isLoading: boolean;
  }


```

<!-- path: hnvtx/components/common/entity-management/SearchAndFilters.tsx -->
```typescript
import { MdFilterList as Filter, MdSearch as Search, MdClear as Clear } from 'react-icons/md';
import { BaseEntity, EntityConfig } from '@/components/common/entity-management/types';

interface SearchAndFiltersProps<T extends BaseEntity> {
  searchTerm: string;
  onSearchChange: (term: string) => void;
  showFilters: boolean;
  onToggleFilters: () => void;
  filters: Record<string, string>;
  onFilterChange: (filters: Record<string, string>) => void;
  onClearFilters: () => void;
  config: EntityConfig<T>;
}

export function SearchAndFilters<T extends BaseEntity>({
  searchTerm,
  onSearchChange,
  showFilters,
  onToggleFilters,
  filters,
  onFilterChange,
  onClearFilters,
  config,
}: SearchAndFiltersProps<T>) {
  return (
    <div className="border-b border-gray-200 dark:border-gray-700 p-4">
      <div className="mb-4 flex items-center gap-4">
        <div className="relative flex-1">
          <Search className="absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 transform text-gray-400 dark:text-gray-500" />
          <input
            type="text"
            placeholder={`Search ${config.entityPluralName.toLowerCase()}...`}
            value={searchTerm}
            onChange={(e) => onSearchChange(e.target.value)}
            className="w-full rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white py-2 pr-4 pl-10 focus:border-transparent focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-600"
          />
          {searchTerm && (
            <button
              onClick={() => onSearchChange("")}
              className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
            >
              <Clear className="h-4 w-4" />
            </button>
          )}
        </div>
        <button
          onClick={onToggleFilters}
          className="flex items-center gap-2 rounded-lg border border-gray-300 dark:border-gray-600 px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700"
        >
          <Filter className="h-4 w-4" />
          Filters
        </button>
      </div>
      {showFilters && (
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 rounded-lg bg-gray-50 dark:bg-gray-700 p-4">
          {config.filterOptions.map((filterOption) => (
            <div key={filterOption.key}>
              <label className="mb-1 block text-sm font-medium text-gray-700 dark:text-gray-300">
                {filterOption.label}
              </label>
              {filterOption.type === 'select' ? (
                <select
                  value={filters[filterOption.key] || ''}
                  onChange={(e) => onFilterChange({ ...filters, [filterOption.key]: e.target.value })}
                  className="w-full rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:focus:ring-blue-600"
                >
                  {filterOption.options?.map((option) => (
                    <option key={option.value} value={option.value}>
                      {option.label}
                    </option>
                  ))}
                </select>
              ) : filterOption.type === 'text' ? (
                <input
                  type="text"
                  value={filters[filterOption.key] || ''}
                  onChange={(e) => onFilterChange({ ...filters, [filterOption.key]: e.target.value })}
                  className="w-full rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:focus:ring-blue-600"
                />
              ) : filterOption.type === 'date' ? (
                <input
                  type="date"
                  value={filters[filterOption.key] || ''}
                  onChange={(e) => onFilterChange({ ...filters, [filterOption.key]: e.target.value })}
                  className="w-full rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:focus:ring-blue-600"
                />
              ) : null}
            </div>
          ))}
          <div className="flex items-end">
            <button
              onClick={onClearFilters}
              className="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200"
            >
              Clear Filters
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
```

<!-- path: hnvtx/components/common/entity-management/EntityListItem.tsx -->
```typescript
import React from 'react';
import { BiToggleLeft, BiToggleRight } from 'react-icons/bi';
import { BaseEntity, EntityConfig, HierarchicalEntity, isHierarchicalEntity } from '@/components/common/entity-management/types';

interface EntityListItemProps<T extends BaseEntity> {
  entity: T;
  config: EntityConfig<T>;
  isSelected: boolean;
  onSelect: (id: string) => void;
  onToggleStatus: (e: React.MouseEvent, entity: T) => void;
  isLoading: boolean;
}

export function EntityListItem<T extends BaseEntity>({
  entity,
  config,
  isSelected,
  onSelect,
  onToggleStatus,
  isLoading,
}: EntityListItemProps<T>) {
  const IconComponent = config.icon;

  // Function to get parent name using the configured parent field
  const getParentName = (entity: T): string | null => {
    if (!config.isHierarchical || !config.parentField) return null;
    
    const parentObject = entity[config.parentField] as any;
    if (parentObject?.name) {
      return parentObject.name;
    }
    
    return null;
  };

  const parentName = getParentName(entity);

  return (
    <div
      className={`cursor-pointer border-b border-gray-100 dark:border-gray-700 p-4 hover:bg-gray-50 dark:hover:bg-gray-800 ${
        isSelected
          ? "border-l-4 border-l-blue-500 bg-blue-50 dark:bg-gray-800"
          : "border-l-4 border-l-transparent"
      }`}
      onClick={() => onSelect(entity.id)}
    >
      <div className="flex items-center justify-between">
        <div className="flex-1">
          <div className="mb-2 flex items-center gap-2">
            <IconComponent className="h-5 w-5 text-gray-400 dark:text-gray-500" />
            <h3 className="font-medium text-gray-900 dark:text-gray-100">{entity.name}</h3>
          </div>
          {config.isHierarchical && isHierarchicalEntity(entity) && parentName && (
            <span className="text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 px-2 py-1 rounded">
              Child of: {parentName}
            </span>
          )}
        </div>
        <button
          onClick={(e) => {
            // IMPROVEMENT: Stop the click from bubbling up to the parent div.
            e.stopPropagation(); 
            onToggleStatus(e, entity);
          }}
          disabled={isLoading}
          className="ml-2"
        >
          {entity.status ? (
            <BiToggleRight className="h-5 w-5 text-green-500 dark:text-green-400" />
          ) : (
            <BiToggleLeft className="h-5 w-5 text-gray-400 dark:text-gray-500" />
          )}
        </button>
      </div>
    </div>
  );
}
```

<!-- path: hnvtx/components/common/entity-management/EntityTreeItem.tsx -->
```typescript
import { BaseEntity, EntityTreeItemProps } from "@/components/common/entity-management/types";
import { FiChevronDown, FiChevronRight, FiToggleLeft, FiToggleRight } from "react-icons/fi";

export function EntityTreeItem<T extends BaseEntity>({
    entity,
    config,
    level,
    selectedEntityId,
    expandedEntities,
    onSelect,
    onToggleExpand,
    onToggleStatus,
    isLoading,
  }: EntityTreeItemProps<T>) {
    const IconComponent = config.icon;
    const hasChildren = entity.children.length > 0;
    const isSelected = entity.id === selectedEntityId;
    const isExpanded = expandedEntities.has(entity.id);
  
    return (
      <div className="border-b border-gray-100 dark:border-gray-700 last:border-b-0">
        <div
          className={`flex cursor-pointer items-center p-4 hover:bg-gray-50 dark:hover:bg-gray-800 ${
            isSelected
              ? "border-l-4 border-l-blue-500 bg-blue-50 dark:bg-gray-800"
              : "border-l-4 border-l-transparent"
          }`}
          style={{ paddingLeft: `${16 + level * 24}px` }}
          onClick={() => onSelect(entity.id)}
        >
          <div className="flex flex-1 items-center gap-2 truncate">
            {hasChildren ? (
              <button
                onClick={(e) => {
                  e.stopPropagation();
                  onToggleExpand(entity.id);
                }}
                className="rounded p-1 hover:bg-gray-200 dark:hover:bg-gray-700"
              >
                {isExpanded ? (
                  <FiChevronDown className="h-4 w-4 text-gray-400 dark:text-gray-500" />
                ) : (
                  <FiChevronRight className="h-4 w-4 text-gray-400 dark:text-gray-500" />
                )}
              </button>
            ) : (
              <div className="w-6" />
            )}
            <IconComponent className="h-5 w-5 flex-shrink-0 text-gray-400 dark:text-gray-500" />
            <div className="flex-1 truncate">
              <h3 className="font-medium text-gray-900 dark:text-gray-100 truncate">{entity.name}</h3>
            </div>
          </div>
          <button
            onClick={(e) => onToggleStatus(e, entity)}
            disabled={isLoading}
            className="ml-auto"
          >
            {entity.status ? (
              <FiToggleRight className="h-5 w-5 text-green-500 dark:text-green-400" />
            ) : (
              <FiToggleLeft className="h-5 w-5 text-gray-400 dark:text-gray-500" />
            )}
          </button>
        </div>
        {isExpanded && hasChildren && (
          <div>
            {entity.children.map((child) => (
              <EntityTreeItem
                key={child.id}
                entity={child}
                config={config}
                level={level + 1}
                selectedEntityId={selectedEntityId}
                expandedEntities={expandedEntities}
                onSelect={onSelect}
                onToggleExpand={onToggleExpand}
                onToggleStatus={onToggleStatus}
                isLoading={isLoading}
              />
            ))}
          </div>
        )}
      </div>
    );
  }
  
```

<!-- path: hnvtx/components/common/entity-management/EntityDetailsPanel.tsx -->
```typescript
import React from 'react';
import { FiEdit3, FiTrash2 } from 'react-icons/fi';
import { BaseEntity, EntityConfig } from '@/components/common/entity-management/types';
import { DetailItem } from '@/components/common/entity-management/DetailItem';

interface EntityDetailsPanelProps<T extends BaseEntity> {
  entity: T | null;
  config: EntityConfig<T>;
  onEdit: () => void;
  onDelete: (entity: { id: string; name: string }) => void;
}

export function EntityDetailsPanel<T extends BaseEntity>({
  entity,
  config,
  onEdit,
  onDelete,
}: EntityDetailsPanelProps<T>) {
  if (!entity) {
    const IconComponent = config.icon;
    return (
      <div className="p-8 text-center text-gray-500 dark:text-gray-400">
        <IconComponent className="mx-auto mb-3 h-12 w-12 text-gray-300 dark:text-gray-600" />
        <p>Select a {config.entityDisplayName.toLowerCase()} to view details</p>
      </div>
    );
  }

  return (
    <div className="p-4 space-y-4">
      <div className="mb-2 flex items-start justify-between">
        <h3 className="text-xl font-bold text-gray-900 dark:text-white">{entity.name}</h3>
        <span
          className={`rounded-full px-2 py-1 text-xs ${
            entity.status
              ? "bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200"
              : "bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200"
          }`}
        >
          {entity.status ? "Active" : "Inactive"}
        </span>
      </div>

      {config.detailFields.map((field) => (
        <DetailItem
          key={String(field.key)}
          label={field.label}
          value={entity[field.key]}
          type={field.type}
          entity={entity}
          render={field.render}
        />
      ))}

      <div className="border-t border-gray-200 dark:border-gray-700 pt-4">
        <div className="flex gap-2">
          <button
            onClick={onEdit}
            className="flex flex-1 items-center justify-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800"
          >
            <FiEdit3 className="h-4 w-4" /> Edit
          </button>
          <button
            onClick={() => onDelete({ id: entity.id, name: entity.name })}
            className="flex items-center justify-center gap-2 rounded-lg border border-red-300 dark:border-red-700 px-4 py-2 text-red-700 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30"
          >
            <FiTrash2 className="h-4 w-4" /> Delete
          </button>
        </div>
      </div>
    </div>
  );
}
```

<!-- path: hnvtx/components/common/entity-management/EntityManagementComponent.tsx -->
```typescript
import { EntityDetailsPanel } from "@/components/common/entity-management/EntityDetailsPanel";
import { EntityListItem } from "@/components/common/entity-management/EntityListItem";
import { EntityTreeItem } from "@/components/common/entity-management/EntityTreeItem";
import { SearchAndFilters } from "@/components/common/entity-management/SearchAndFilters";
import { BaseEntity, EntityConfig } from "@/components/common/entity-management/types";
import { ViewModeToggle } from "@/components/common/entity-management/ViewModeToggle";
import { useEntityManagement } from "@/hooks/useEntityManagement";
import { FiInfo, FiPlus } from "react-icons/fi";


interface EntityManagementComponentProps<T extends BaseEntity> {
  config: EntityConfig<T>;
  entitiesQuery: any;
  toggleStatusMutation: any;
  onEdit: (entity: T) => void;
  onDelete: (entity: { id: string; name: string }) => void;
  onCreateNew: () => void;
}

export function EntityManagementComponent<T extends BaseEntity>({
  config,
  entitiesQuery,
  toggleStatusMutation,
  onEdit,
  onDelete,
  onCreateNew,
}: EntityManagementComponentProps<T>) {
  const {
    searchTerm,
    viewMode,
    showFilters,
    filters,
    showDetailsPanel,
    expandedEntities,
    filteredEntities,
    hierarchicalEntities,
    selectedEntity,
    setSearchTerm,
    setViewMode,
    setShowFilters,
    setFilters,
    setShowDetailsPanel,
    handleEntitySelect,
    toggleExpanded,
    handleOpenCreateForm,
    handleOpenEditForm,
    onToggleStatus, // This is the handler returned by the hook
  } = useEntityManagement({
    entitiesQuery,
    config,
    onEdit,
    onDelete,
    // It accepts both arguments but only uses the `entity` to trigger the mutation.
    onToggleStatus: (e, entity) => {
      toggleStatusMutation.mutate(entity);
    },
    onCreateNew,
  });

  const IconComponent = config.icon;

  return (
    <div className="h-screen flex flex-col bg-gray-50 dark:bg-gray-900">
      {/* Header */}
      <div className="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4">
        <div className="flex items-center justify-between">
          <div className="flex items-center space-x-3">
            <IconComponent className="h-6 w-6 text-gray-600 dark:text-gray-400" />
            <h1 className="text-2xl font-semibold text-gray-900 dark:text-white">
              {config.entityPluralName}
            </h1>
          </div>
          <button
            onClick={handleOpenCreateForm}
            className="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800"
          >
            <FiPlus className="h-4 w-4 mr-2" />
            Add {config.entityDisplayName}
          </button>
        </div>
      </div>

      {/* Main Content */}
      <div className="flex flex-col lg:flex-row lg:h-[calc(100vh-80px)]">
        {/* Left Panel - List */}
        <div className={`flex-1 flex flex-col ${showDetailsPanel ? "hidden lg:flex" : "flex"} lg:border-r lg:border-gray-200 lg:dark:border-gray-700`}>
          <div className="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
            <SearchAndFilters
              searchTerm={searchTerm}
              onSearchChange={setSearchTerm}
              showFilters={showFilters}
              onToggleFilters={() => setShowFilters(p => !p)}
              filters={filters}
              onFilterChange={setFilters}
              onClearFilters={() => setFilters({})}
              config={config}
            />
            {config.isHierarchical && (
              <ViewModeToggle
                viewMode={viewMode}
                onChange={setViewMode}
              />
            )}
          </div>

          <div className="flex-1 overflow-y-auto bg-white dark:bg-gray-800">
            {entitiesQuery.isLoading ? (
              <div className="flex items-center justify-center py-12">
                <div className="text-center">
                  <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"></div>
                  <p className="text-gray-600 dark:text-gray-400">
                    Loading {config.entityPluralName}...
                  </p>
                </div>
              </div>
            ) : entitiesQuery.isError ? (
              <div className="flex items-center justify-center py-12">
                <div className="text-center">
                  <div className="rounded-full bg-red-100 dark:bg-red-900/20 p-3 inline-block mb-4">
                    <svg className="h-6 w-6 text-red-600 dark:text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                  <p className="text-red-600 dark:text-red-400">
                    Error loading {config.entityPluralName}
                  </p>
                </div>
              </div>
            ) : filteredEntities.length === 0 ? (
              <div className="flex items-center justify-center py-12">
                <div className="text-center">
                  <IconComponent className="h-12 w-12 text-gray-300 dark:text-gray-600 mx-auto mb-4" />
                  <p className="text-gray-500 dark:text-gray-400">
                    No {config.entityPluralName} found.
                  </p>
                  <button
                    onClick={handleOpenCreateForm}
                    className="mt-4 inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100 dark:bg-blue-900/20 dark:text-blue-400 dark:hover:bg-blue-900/30"
                  >
                    <FiPlus className="h-4 w-4 mr-2" />
                    Add First {config.entityDisplayName}
                  </button>
                </div>
              </div>
            ) : config.isHierarchical && viewMode === "tree" ? (
              <div className="divide-y divide-gray-100 dark:divide-gray-700">
                {hierarchicalEntities.map((entity) => (
                  <EntityTreeItem
                    key={entity.id}
                    entity={entity}
                    config={config}
                    level={0}
                    selectedEntityId={selectedEntity?.id ?? null}
                    expandedEntities={expandedEntities}
                    onSelect={handleEntitySelect}
                    onToggleExpand={toggleExpanded}
                    onToggleStatus={onToggleStatus}
                    isLoading={toggleStatusMutation.isPending}
                  />
                ))}
              </div>
            ) : (
              <div className="divide-y divide-gray-100 dark:divide-gray-700">
                {filteredEntities.map((entity) => (
                  <EntityListItem
                    key={entity.id}
                    entity={entity}
                    config={config}
                    isSelected={entity.id === selectedEntity?.id}
                    onSelect={handleEntitySelect}
                    onToggleStatus={onToggleStatus}
                    isLoading={toggleStatusMutation.isPending}
                  />
                ))}
              </div>
            )}
          </div>
        </div>

        {/* Right Panel - Details */}
        <div className={`${showDetailsPanel ? "flex" : "hidden lg:flex"} flex-col w-full lg:w-96 xl:w-1/3 bg-white dark:bg-gray-800 border-t lg:border-t-0 border-gray-200 dark:border-gray-700`}>
          {/* Mobile Details Header */}
          <div className="sticky top-0 z-10 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3 lg:hidden">
            <div className="flex items-center justify-between">
              <h2 className="text-lg font-medium text-gray-900 dark:text-white">Details</h2>
              <button
                onClick={() => setShowDetailsPanel(false)}
                className="p-2 rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
              >
                <svg className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>

          {/* Desktop Details Header */}
          <div className="hidden lg:block border-b border-gray-200 dark:border-gray-700 px-4 py-3">
            <h2 className="text-lg font-medium text-gray-900 dark:text-white">
              {config.entityDisplayName} Details
            </h2>
          </div>

          <div className="flex-1 overflow-y-auto">
            {selectedEntity ? (
              <EntityDetailsPanel
                entity={selectedEntity}
                config={config}
                onEdit={handleOpenEditForm}
                onDelete={onDelete}
              />
            ) : (
              <div className="flex items-center justify-center h-full p-8">
                <div className="text-center">
                  <FiInfo className="h-12 w-12 text-gray-300 dark:text-gray-600 mx-auto mb-4" />
                  <p className="text-gray-500 dark:text-gray-400">
                    Select a {config.entityDisplayName.toLowerCase()} to view details
                  </p>
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
```

<!-- path: hnvtx/components/common/entity-management/ViewModeToggle.tsx -->
```typescript
interface ViewModeToggleProps {
    viewMode: "tree" | "list";
    onChange: (mode: "tree" | "list") => void;
  }
  
  export function ViewModeToggle({ viewMode, onChange }: ViewModeToggleProps) {
    return (
      <div className="p-4 border-b border-gray-200 dark:border-gray-700">
        <div className="flex items-center gap-2">
          <button
            onClick={() => onChange("tree")}
            className={`px-3 py-2 rounded-lg text-sm font-medium ${
              viewMode === "tree"
                ? "bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"
                : "text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700"
            }`}
          >
            Tree
          </button>
          <button
            onClick={() => onChange("list")}
            className={`px-3 py-2 rounded-lg text-sm font-medium ${
              viewMode === "list"
                ? "bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"
                : "text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700"
            }`}
          >
            List
          </button>
        </div>
      </div>
    );
  }
```

<!-- path: hnvtx/components/common/TruncateTooltip.tsx -->
```typescript
// @/components/common/TruncateTooltip.tsx
import React, { useEffect, useRef, useState } from "react";

export interface TruncateTooltipProps {
  text: string;
  className?: string;
  /**
   * Optional id suffix for ARIA. If omitted, a random id will be generated.
   */
  id?: string;
  /**
   * Optional: control max width of tooltip in px. Default 320.
   */
  maxWidth?: number;
}

/**
 * Renders truncated single-line text and shows a custom tooltip on hover/focus
 * only when the content is visually truncated.
 */
export const TruncateTooltip: React.FC<TruncateTooltipProps> = ({
  text,
  className,
  id,
  maxWidth = 320,
}) => {
  const [isOverflowing, setIsOverflowing] = useState(false);
  const [showTooltip, setShowTooltip] = useState(false);
  const [pos, setPos] = useState<{ top: number; left: number }>({ top: 0, left: 0 });
  const textRef = useRef<HTMLSpanElement>(null);
  const tooltipId = `tt-${id ?? Math.random().toString(36).slice(2)}`;

  const checkOverflow = () => {
    const el = textRef.current;
    if (!el) return false;
    // Compare scrollWidth vs clientWidth on the measured element itself
    const overflow = el.scrollWidth > el.clientWidth;
    setIsOverflowing(overflow);
    return overflow;
  };

  useEffect(() => {
    const el = textRef.current;
    if (!el) return;
    checkOverflow();
    const ro = new ResizeObserver(() => checkOverflow());
    ro.observe(el);
    const onWin = () => checkOverflow();
    window.addEventListener("resize", onWin);
    return () => {
      ro.disconnect();
      window.removeEventListener("resize", onWin);
    };
  }, []);

  const show = () => {
    if (checkOverflow()) {
      const el = textRef.current!;
      const rect = el.getBoundingClientRect();
      // Clamp tooltip within viewport horizontally
      const left = Math.min(Math.max(8, rect.left), window.innerWidth - maxWidth - 8);
      setPos({ top: rect.bottom + 8, left });
      setShowTooltip(true);
    }
  };
  const hide = () => setShowTooltip(false);

  return (
    <>
      <span
        ref={textRef}
        className={`truncate block max-w-full overflow-hidden min-w-0 flex-1 ${className ?? ""}`}
        onMouseEnter={show}
        onMouseLeave={hide}
        onFocus={show}
        onBlur={hide}
        tabIndex={isOverflowing ? 0 : -1}
        title={isOverflowing ? text : undefined}
        aria-describedby={showTooltip && isOverflowing ? tooltipId : undefined}
      >
        {text}
      </span>
      {showTooltip && isOverflowing && (
        <div
          id={tooltipId}
          role="tooltip"
          className="fixed px-3 py-2 text-sm text-white bg-gray-900 dark:bg-gray-100 dark:text-gray-900 rounded-lg shadow-xl border border-gray-200 dark:border-gray-300 whitespace-normal break-words pointer-events-none z-[9999]"
          style={{ top: pos.top, left: pos.left, maxWidth }}
        >
          {text}
        </div>
      )}
    </>
  );
};

export default TruncateTooltip;

```

<!-- path: hnvtx/components/common/BulkActions.tsx -->
```typescript
// BulkActions Component (Enhanced version)
import { FiTrash2, FiCheck, FiX } from "react-icons/fi";

interface BulkActionsProps {
  selectedCount: number;
  isOperationLoading?: boolean;
  onBulkDelete: () => void;
  onBulkUpdateStatus: (status: "active" | "inactive") => void;
  onClearSelection: () => void;
  entityName?: string;
  showStatusUpdate?: boolean;
  canDelete?: () => boolean;
  customActions?: Array<{
    label: string;
    icon?: React.ComponentType<{ className?: string }>;
    onClick: () => void;
    variant?: 'primary' | 'secondary' | 'danger';
    disabled?: boolean;
  }>;
}

export function BulkActions({
  selectedCount,
  isOperationLoading = false,
  onBulkDelete,
  onBulkUpdateStatus,
  onClearSelection,
  entityName = "item",
  showStatusUpdate = true,
  canDelete = () => true,
  customActions = [],
}: BulkActionsProps) {
  if (selectedCount === 0) return null;

  const handleStatusChange = (e: React.ChangeEvent<HTMLSelectElement>) => {
    const value = e.target.value as "active" | "inactive" | "";
    if (value) {
      onBulkUpdateStatus(value);
      // Reset select to default
      e.target.value = "";
    }
  };

  const getButtonClasses = (variant: 'primary' | 'secondary' | 'danger' = 'primary') => {
    const baseClasses = "px-3 py-1 rounded text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1";
    
    switch (variant) {
      case 'danger':
        return `${baseClasses} bg-red-600 text-white hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800`;
      case 'secondary':
        return `${baseClasses} bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600`;
      default:
        return `${baseClasses} bg-blue-600 text-white hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800`;
    }
  };

  return (
    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 dark:bg-blue-900/20 dark:border-blue-700/50 transition-all duration-200">
      <div className="flex items-center justify-between flex-wrap gap-3">
        <div className="flex items-center gap-2">
          <FiCheck className="w-4 h-4 text-blue-600 dark:text-blue-400" />
          <p className="text-blue-900 dark:text-blue-100 font-medium">
            {selectedCount} {entityName}{selectedCount !== 1 ? 's' : ''} selected
          </p>
        </div>
        
        <div className="flex items-center gap-2 flex-wrap">
          {/* Status Update Dropdown */}
          {showStatusUpdate && (
            <select
              onChange={handleStatusChange}
              defaultValue=""
              className="text-sm border rounded px-2 py-1 min-w-[100px]
                        bg-white text-gray-900 border-gray-300
                        dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600
                        disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-blue-500"
              disabled={isOperationLoading}
            >
              <option value="">Set Status</option>
              <option value="active">✅ Active</option>
              <option value="inactive">❌ Inactive</option>
            </select>
          )}

          {/* Custom Actions */}
          {customActions.map((action, index) => (
            <button
              key={index}
              onClick={action.onClick}
              disabled={isOperationLoading || action.disabled}
              className={getButtonClasses(action.variant)}
            >
              {action.icon && <action.icon className="w-4 h-4" />}
              {action.label}
            </button>
          ))}
          
          {/* Delete Button */}
          <button
            onClick={onBulkDelete}
            disabled={isOperationLoading || !canDelete()}
            className={getButtonClasses('danger')}
            title={`Delete ${selectedCount} selected ${entityName}${selectedCount !== 1 ? 's' : ''}`}
          >
            <FiTrash2 className="w-4 h-4" />
            Delete {selectedCount > 1 && `(${selectedCount})`}
          </button>
          
          {/* Clear Selection Button */}
          <button
            onClick={onClearSelection}
            disabled={isOperationLoading}
            className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 
                      text-sm px-2 py-1 rounded transition-colors flex items-center gap-1"
            title="Clear selection"
          >
            <FiX className="w-4 h-4" />
            Clear
          </button>
        </div>
      </div>

      {/* Loading Indicator */}
      {isOperationLoading && (
        <div className="mt-3 flex items-center gap-2 text-sm text-blue-700 dark:text-blue-300">
          <div className="w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
          Processing {selectedCount} {entityName}{selectedCount !== 1 ? 's' : ''}...
        </div>
      )}
    </div>
  );
}


```

<!-- path: hnvtx/components/common/DataListView.tsx -->
```typescript
import React, { useState } from 'react';
import { 
  FiSearch, 
  FiFilter, 
  FiGrid, 
  FiList, 
  FiInfo, 
  FiPlus, 
  FiX,
  FiAlertCircle 
} from 'react-icons/fi';
interface DataItem {
    id: string | number;  // Adjust the type based on your actual ID type
    name: string;
    description?: string;
    status?: boolean;
    title?: string;
    // Add other properties that your data items have
  }
interface DataListViewProps {
    data: DataItem[];
    isLoading: boolean;
    error: unknown;
    searchTerm: string;
    onSearchChange: (value: string) => void;
    searchPlaceholder: string;
    showFilters: boolean;
    onToggleFilters: () => void;
    filters: unknown;
    onFilterChange: (newFilters: unknown) => void;
    onClearFilters: () => void;
    viewMode: string;
    onViewModeChange: (mode: string) => void;
    showViewModeToggle: boolean;
    selectedItemId: string | null;
    showDetailsPanel: boolean;
    setShowDetailsPanel: (value: boolean) => void;
    detailsTitle: string;
    onCreateNew: () => void;
    createButtonText: string;
    createButtonIcon: React.ReactNode;
    onItemSelect: (item: DataItem) => void;
    renderListItem: (item: DataItem, isSelected: boolean, onSelect: () => void) => React.ReactNode;
    renderGridItem: (item: DataItem, isSelected: boolean, onSelect: () => void) => React.ReactNode;
    renderTreeItem: (item: DataItem, level: number, isSelected: boolean, isExpanded: boolean, onSelect: () => void, onToggleExpand: () => void) => React.ReactNode;
    renderDetailsPanel: (selectedItem: DataItem) => React.ReactNode;
    renderFilters: (filters: unknown, onFilterChange: (newFilters: unknown) => void, onClearFilters: () => void) => React.ReactNode;
    emptyStateIcon: React.ComponentType<{ className?: string }>;
    createIcon: React.ComponentType<{ className?: string }>;
    emptyStateTitle: string;
    emptyStateDescription: string;
    showCreateOnEmpty: boolean;
    loadingText: string;
    errorTitle: string;
    className: string;
    listClassName: string;
    detailsClassName: string;
}

/**
 * A reusable data list view component with search, filters, and details panel
 * @param {Object} props - Component props
 */
const DataListView = (props: DataListViewProps) => {
  // Destructure props with defaults
  const {
    data = [],
    isLoading = false,
    error = null,
    searchTerm = '',
    onSearchChange,
    searchPlaceholder = 'Search...',
    showFilters = false,
    onToggleFilters,
    filters = {},
    onFilterChange,
    onClearFilters,
    viewMode = 'list',
    onViewModeChange,
    showViewModeToggle = true,
    selectedItemId = null,
    onItemSelect,
    showDetailsPanel = false,
    setShowDetailsPanel,
    detailsTitle = 'Details',
    onCreateNew,
    createButtonText = 'Add New',
    renderListItem,
    renderTreeItem,
    renderGridItem,
    renderDetailsPanel,
    renderFilters,
    emptyStateIcon = FiInfo,
    emptyStateTitle = 'No items found',
    emptyStateDescription = 'No items match your criteria.',
    showCreateOnEmpty = true,
    loadingText = 'Loading...',
    errorTitle = 'Error loading data',
    className = '',
    listClassName = '',
    detailsClassName = '',
  } = props;

  const [internalShowDetailsPanel, setInternalShowDetailsPanel] = useState(false);
  
  // Use external state if provided, otherwise use internal state
  const detailsPanelVisible = showDetailsPanel !== undefined ? showDetailsPanel : internalShowDetailsPanel;
  const setDetailsPanelVisible = setShowDetailsPanel || setInternalShowDetailsPanel;

  const selectedItem = data.find((item) => (item as unknown as { id: string }).id === selectedItemId);

  const handleItemSelect = (item: DataItem) => {
    if (onItemSelect) {
      onItemSelect(item);
    }
    // Auto-show details panel on mobile when item is selected
    if (window.innerWidth < 1024) {
      setDetailsPanelVisible(true);
    }
  };

  const ViewModeToggle = () => {
    if (!showViewModeToggle) return null;
    
    return (
      <div className="flex items-center space-x-1 px-4 py-2 border-t border-gray-200 dark:border-gray-700">
        <button
          onClick={() => onViewModeChange && onViewModeChange('list')}
          className={`p-2 rounded-md ${
            viewMode === 'list'
              ? 'bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400'
              : 'text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'
          }`}
        >
          <FiList className="h-4 w-4" />
        </button>
        <button
          onClick={() => onViewModeChange && onViewModeChange('grid')}
          className={`p-2 rounded-md ${
            viewMode === 'grid'
              ? 'bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400'
              : 'text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'
          }`}
        >
          <FiGrid className="h-4 w-4" />
        </button>
      </div>
    );
  };

  const SearchAndFiltersSection = () => (
    <div className="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
      <div className="px-4 py-3">
        <div className="flex items-center space-x-3">
          <div className="flex-1 relative">
            <FiSearch className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" />
            <input
              type="text"
              placeholder={searchPlaceholder}
              value={searchTerm}
              onChange={(e) => onSearchChange && onSearchChange(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
            />
          </div>
          {onToggleFilters && (
            <button
              onClick={onToggleFilters}
              className={`p-2 rounded-md ${
                showFilters
                  ? 'bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400'
                  : 'text-gray-400 hover:text-gray-600 dark:hover:text-gray-300'
              }`}
            >
              <FiFilter className="h-4 w-4" />
            </button>
          )}
        </div>
      </div>
      
      {showFilters && renderFilters && (
        <div className="px-4 pb-3 border-t border-gray-200 dark:border-gray-700">
          {renderFilters(filters, onFilterChange, onClearFilters)}
        </div>
      )}
      
      <ViewModeToggle />
    </div>
  );

  const LoadingState = () => (
    <div className="flex items-center justify-center py-12">
      <div className="text-center">
        <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"></div>
        <p className="text-gray-600 dark:text-gray-400">{loadingText}</p>
      </div>
    </div>
  );

  const ErrorState = () => {
    const ErrorIcon = FiAlertCircle;
    return (
      <div className="flex items-center justify-center py-12">
        <div className="text-center">
          <div className="rounded-full bg-red-100 dark:bg-red-900/20 p-3 inline-block mb-4">
            <ErrorIcon className="h-6 w-6 text-red-600 dark:text-red-400" />
          </div>
          <p className="text-red-600 dark:text-red-400">
            {errorTitle}: {(error as Error)?.message || String(error)}
          </p>
        </div>
      </div>
    );
  };

  const EmptyState = () => {
    
    return (
      <div className="flex items-center justify-center py-12">
        <div className="text-center">
          {React.createElement(emptyStateIcon, { 
            className: "h-12 w-12 text-gray-300 dark:text-gray-600 mx-auto mb-4" 
          })}
          <p className="text-gray-900 dark:text-white font-medium mb-2">
            {emptyStateTitle}
          </p>
          <p className="text-gray-500 dark:text-gray-400 mb-4">
            {emptyStateDescription}
          </p>
          {showCreateOnEmpty && onCreateNew && (
            <button
              onClick={onCreateNew}
              className="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100 dark:bg-blue-900/20 dark:text-blue-400 dark:hover:bg-blue-900/30"
            >
              <FiPlus className="h-4 w-4 mr-2" />
              {createButtonText}
            </button>
          )}
        </div>
      </div>
    );
  };

  const renderContent = () => {
    if (isLoading) return <LoadingState />;
    if (error) return <ErrorState />;
    if (data.length === 0) return <EmptyState />;

    const contentClass = viewMode === 'grid' 
      ? "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4"
      : "divide-y divide-gray-100 dark:divide-gray-700";

    return (
      <div className={contentClass}>
        {data.map((item) => {
          const isSelected = selectedItemId === item.id;
          
          if (viewMode === 'grid' && renderGridItem) {
            return renderGridItem(item, isSelected, () => handleItemSelect(item));
          } else if (viewMode === 'tree' && renderTreeItem) {
            return renderTreeItem(item, 0, isSelected, false, () => handleItemSelect(item), () => {});
          } else if (renderListItem) {
            return renderListItem(item, isSelected, () => handleItemSelect(item));
          }
          
          // Fallback default rendering
          return (
            <div
              key={item.id}
              onClick={() => handleItemSelect(item)}
              className={`p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 ${
                isSelected ? 'bg-blue-50 dark:bg-blue-900/20' : ''
              }`}
            >
              <div className="font-medium text-gray-900 dark:text-white">
                {item.name || item.title || item.id}
              </div>
              {item.description && (
                <div className="text-sm text-gray-500 dark:text-gray-400 mt-1">
                  {item.description}
                </div>
              )}
            </div>
          );
        })}
      </div>
    );
  };

  return (
    <div className={`flex flex-col lg:flex-row lg:h-[calc(100vh-80px)] ${className}`}>
      {/* Left Panel - List */}
      <div
        className={`flex-1 flex flex-col ${
          detailsPanelVisible ? "hidden lg:flex" : "flex"
        } lg:border-r lg:border-gray-200 lg:dark:border-gray-700 ${listClassName}`}
      >
        <SearchAndFiltersSection />
        
        <div className="flex-1 overflow-y-auto bg-white dark:bg-gray-800">
          {renderContent()}
        </div>
      </div>

      {/* Right Panel - Details */}
      <div
        className={`${
          detailsPanelVisible ? "flex" : "hidden lg:flex"
        } flex-col w-full lg:w-96 xl:w-1/3 bg-white dark:bg-gray-800 border-t lg:border-t-0 border-gray-200 dark:border-gray-700 ${detailsClassName}`}
      >
        {/* Mobile Details Header */}
        <div className="sticky top-0 z-10 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3 lg:hidden">
          <div className="flex items-center justify-between">
            <h2 className="text-lg font-medium text-gray-900 dark:text-white">
              {detailsTitle}
            </h2>
            <button
              onClick={() => setDetailsPanelVisible(false)}
              className="p-2 rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
            >
              <FiX className="h-5 w-5" />
            </button>
          </div>
        </div>

        {/* Desktop Details Header */}
        <div className="hidden lg:block border-b border-gray-200 dark:border-gray-700 px-4 py-3">
          <h2 className="text-lg font-medium text-gray-900 dark:text-white">
            {detailsTitle}
          </h2>
        </div>

        <div className="flex-1 overflow-y-auto">
          {selectedItem && renderDetailsPanel ? (
            renderDetailsPanel(selectedItem)
          ) : (
            <div className="flex items-center justify-center h-full p-8">
              <div className="text-center">
                <FiInfo className="h-12 w-12 text-gray-300 dark:text-gray-600 mx-auto mb-4" />
                <p className="text-gray-500 dark:text-gray-400">
                  Select an item to view details
                </p>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default DataListView;


// // Example usage component
// const ExampleUsage = () => {
//   const [searchTerm, setSearchTerm] = useState('');
//   const [selectedId, setSelectedId] = useState(null);
//   const [viewMode, setViewMode] = useState('list');
//   const [showFilters, setShowFilters] = useState(false);
//   const [filters, setFilters] = useState({});

//   // Mock data
//   const sampleData = [
//     { id: '1', name: 'Software Engineer', description: 'Develops applications', department: 'Engineering', status: 'active' },
//     { id: '2', name: 'Product Manager', description: 'Manages product roadmap', department: 'Product', status: 'active' },
//     { id: '3', name: 'UX Designer', description: 'Designs user experiences', department: 'Design', status: 'inactive' },
//     { id: '4', name: 'Data Analyst', description: 'Analyzes business data', department: 'Analytics', status: 'active' },
//   ];

//   const filteredData = sampleData.filter((item) => {
//     const matchesSearch = item.name.toLowerCase().includes(searchTerm.toLowerCase());
//     const matchesStatus = !filters.status || item.status === filters.status;
//     const matchesDepartment = !filters.department || item.department === filters.department;
//     return matchesSearch && matchesStatus && matchesDepartment;
//   });

//   const handleFilterChange = (newFilters) => {
//     setFilters({ ...filters, ...newFilters });
//   };

//   const handleClearFilters = () => {
//     setFilters({});
//   };

//   const handleItemSelect = (item) => {
//     setSelectedId(item.id);
//   };

//   const handleCreateNew = () => {
//     alert('Create new position');
//   };

//   const handleSearchChange = (value) => {
//     setSearchTerm(value);
//   };

//   const handleToggleFilters = () => {
//     setShowFilters(!showFilters);
//   };

//   const handleViewModeChange = (mode) => {
//     setViewMode(mode);
//   };

//   const renderListItem = (item, isSelected, onSelect) => (
//     <div
//       key={item.id}
//       onClick={onSelect}
//       className={`p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 ${
//         isSelected ? 'bg-blue-50 dark:bg-blue-900/20 border-r-2 border-blue-600' : ''
//       }`}
//     >
//       <div className="flex justify-between items-start">
//         <div>
//           <h3 className="font-medium text-gray-900 dark:text-white">
//             {item.name}
//           </h3>
//           <p className="text-sm text-gray-500 dark:text-gray-400 mt-1">
//             {item.description}
//           </p>
//         </div>
//         <div className="flex flex-col items-end space-y-1">
//           <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200">
//             {item.department}
//           </span>
//           <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
//             item.status === 'active' 
//               ? 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400'
//               : 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400'
//           }`}>
//             {item.status}
//           </span>
//         </div>
//       </div>
//     </div>
//   );

//   const renderFiltersComponent = (currentFilters, onFilterChange, onClearFilters) => (
//     <div className="pt-3 space-y-3">
//       <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
//         <div>
//           <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
//             Status
//           </label>
//           <select
//             value={currentFilters.status || ''}
//             onChange={(e) => onFilterChange({ status: e.target.value || undefined })}
//             className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
//           >
//             <option value="">All Status</option>
//             <option value="active">Active</option>
//             <option value="inactive">Inactive</option>
//           </select>
//         </div>
//         <div>
//           <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
//             Department
//           </label>
//           <select
//             value={currentFilters.department || ''}
//             onChange={(e) => onFilterChange({ department: e.target.value || undefined })}
//             className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
//           >
//             <option value="">All Departments</option>
//             <option value="Engineering">Engineering</option>
//             <option value="Product">Product</option>
//             <option value="Design">Design</option>
//             <option value="Analytics">Analytics</option>
//           </select>
//         </div>
//       </div>
//       <div className="flex justify-end">
//         <button
//           onClick={onClearFilters}
//           className="px-3 py-1 text-sm text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200"
//         >
//           Clear Filters
//         </button>
//       </div>
//     </div>
//   );

//   const renderDetailsPanelComponent = (item) => (
//     <div className="p-6">
//       <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4">
//         {item.name}
//       </h3>
//       <div className="space-y-4">
//         <div>
//           <label className="text-sm font-medium text-gray-500 dark:text-gray-400">
//             Description
//           </label>
//           <p className="text-gray-900 dark:text-white mt-1">
//             {item.description}
//           </p>
//         </div>
//         <div>
//           <label className="text-sm font-medium text-gray-500 dark:text-gray-400">
//             Department
//           </label>
//           <p className="text-gray-900 dark:text-white mt-1">
//             {item.department}
//           </p>
//         </div>
//         <div>
//           <label className="text-sm font-medium text-gray-500 dark:text-gray-400">
//             Status
//           </label>
//           <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium mt-1 ${
//             item.status === 'active' 
//               ? 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400'
//               : 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400'
//           }`}>
//             {item.status}
//           </span>
//         </div>
//       </div>
//       <div className="mt-6 flex space-x-3">
//         <button className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
//           Edit
//         </button>
//         <button className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
//           Delete
//         </button>
//       </div>
//     </div>
//   );

//   return (
//     <div className="h-screen bg-gray-50 dark:bg-gray-900">
//       <DataListView
//         data={filteredData}
//         searchTerm={searchTerm}
//         onSearchChange={handleSearchChange}
//         searchPlaceholder="Search positions..."
//         showFilters={showFilters}
//         onToggleFilters={handleToggleFilters}
//         filters={filters}
//         onFilterChange={handleFilterChange}
//         onClearFilters={handleClearFilters}
//         selectedItemId={selectedId}
//         onItemSelect={handleItemSelect}
//         viewMode={viewMode}
//         onViewModeChange={handleViewModeChange}
//         detailsTitle="Position Details"
//         emptyStateTitle="No positions found"
//         emptyStateDescription="Try adjusting your search criteria."
//         createButtonText="Add Position"
//         onCreateNew={handleCreateNew}
//         renderListItem={renderListItem}
//         renderFilters={renderFiltersComponent}
//         renderDetailsPanel={renderDetailsPanelComponent}
//       />
//     </div>
//   );
// };

// export default ExampleUsage;
```

<!-- path: hnvtx/components/common/ui/index.ts -->
```typescript
export { Button } from './Button';
export { Card } from './Card';
export { CardHeader } from './Card';
export { CardBody } from './Card';
export { CardFooter } from './Card';
export { Input } from './Input';
export { LoadingSpinner } from './LoadingSpinner';
export { ProgressBar } from './ProgressBar';
export { PhoneInputWithCountry } from './phoneInput';
export { Modal } from './Modal';
export { ChangePasswordModal } from './Modal';
export { Label } from './label/Label';
export { Switch } from './switch/Switch';
export { Textarea } from './textarea/Textarea';
export { ButtonSpinner } from './LoadingSpinner';
export { ConfirmModal } from './Modal';
export { ErrorDisplay } from './error/ErrorDisplay';
export { RoleBadge } from './badges/RoleBadge';
export { StatusBadge } from './badges/StatusBadge';




```

<!-- path: hnvtx/components/common/ui/table/TableSkeleton.tsx -->
```typescript
import React from 'react';

interface SkeletonProps {
  className?: string;
  variant?: 'text' | 'rect' | 'circle' | 'rounded';
  width?: string | number;
  height?: string | number;
  animation?: 'pulse' | 'wave' | 'none';
}

const Skeleton: React.FC<SkeletonProps> = ({
  className = '',
  variant = 'text',
  width,
  height,
  animation = 'pulse',
}) => {
  const getVariantClasses = () => {
    switch (variant) {
      case 'text':
        return 'h-4 rounded';
      case 'rect':
        return 'rounded';
      case 'circle':
        return 'rounded-full';
      case 'rounded':
        return 'rounded-lg';
      default:
        return 'h-4 rounded';
    }
  };

  const getAnimationClasses = () => {
    switch (animation) {
      case 'pulse':
        return 'animate-pulse';
      case 'wave':
        return 'animate-wave';
      case 'none':
        return '';
      default:
        return 'animate-pulse';
    }
  };

  const style: React.CSSProperties = {
    width: width || '100%',
    height: height || (variant === 'text' ? '1rem' : '2rem'),
  };

  return (
    <div
      className={`bg-gray-300 dark:bg-gray-700 ${getVariantClasses()} ${getAnimationClasses()} ${className}`}
      style={style}
    />
  );
};

// Compound components for common patterns
interface TableSkeletonProps {
  rows?: number;
  columns?: number;
  showHeader?: boolean;
  className?: string;
}

export const TableSkeleton: React.FC<TableSkeletonProps> = ({
  rows = 5,
  columns = 6,
  showHeader = true,
  className = '',
}) => {
  return (
    <div className={`w-full ${className}`}>
      {showHeader && (
        <div className="mb-4 flex gap-4 border-b border-gray-200 pb-4 dark:border-gray-700">
          {Array.from({ length: columns }, (_, i) => (
            <Skeleton key={`header-${i}`} variant="text" width="100%" height="1.5rem" />
          ))}
        </div>
      )}
      <div className="space-y-3">
        {Array.from({ length: rows }, (_, rowIndex) => (
          <div key={`row-${rowIndex}`} className="flex gap-4">
            {Array.from({ length: columns }, (_, colIndex) => (
              <Skeleton
                key={`cell-${rowIndex}-${colIndex}`}
                variant="text"
                width="100%"
                height="2.5rem"
              />
            ))}
          </div>
        ))}
      </div>
    </div>
  );
};

interface CardSkeletonProps {
  showImage?: boolean;
  showTitle?: boolean;
  showDescription?: boolean;
  lines?: number;
  className?: string;
}

export const CardSkeleton: React.FC<CardSkeletonProps> = ({
  showImage = true,
  showTitle = true,
  showDescription = true,
  lines = 3,
  className = '',
}) => {
  return (
    <div className={`rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-800 ${className}`}>
      {showImage && (
        <Skeleton variant="rounded" width="100%" height="12rem" className="mb-4" />
      )}
      {showTitle && (
        <Skeleton variant="text" width="60%" height="1.5rem" className="mb-2" />
      )}
      {showDescription && (
        <div className="space-y-2">
          {Array.from({ length: lines }, (_, i) => (
            <Skeleton
              key={i}
              variant="text"
              width={i === lines - 1 ? '80%' : '100%'}
              height="1rem"
            />
          ))}
        </div>
      )}
    </div>
  );
};

interface StatsSkeletonProps {
  count?: number;
  className?: string;
}

export const StatsCardsSkeleton: React.FC<StatsSkeletonProps> = ({
  count = 4,
  className = '',
}) => {
  return (
    <div className={`grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-4 ${className}`}>
      {Array.from({ length: count }, (_, i) => (
        <div
          key={i}
          className="rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-800"
        >
          <Skeleton variant="text" width="60%" height="2.5rem" className="mb-2" />
          <Skeleton variant="text" width="80%" height="1rem" />
        </div>
      ))}
    </div>
  );
};

interface PageSkeletonProps {
  showHeader?: boolean;
  showStats?: boolean;
  showFilters?: boolean;
  showTable?: boolean;
  statsCount?: number;
  tableRows?: number;
  tableColumns?: number;
  className?: string;
}

export const PageSkeleton: React.FC<PageSkeletonProps> = ({
  showHeader = true,
  showStats = true,
  showFilters = true,
  showTable = true,
  statsCount = 4,
  tableRows = 10,
  tableColumns = 6,
  className = '',
}) => {
  return (
    <div className={`min-h-screen bg-gray-50 p-6 dark:bg-gray-900 ${className}`}>
      <div className="mx-auto">
        {/* Header Skeleton */}
        {showHeader && (
          <div className="mb-6">
            <div className="mb-4 flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center">
              <div className="flex-1">
                <Skeleton variant="text" width="200px" height="2rem" className="mb-2" />
                <Skeleton variant="text" width="300px" height="1rem" />
              </div>
              <Skeleton variant="rounded" width="150px" height="40px" />
            </div>
          </div>
        )}

        {/* Stats Skeleton */}
        {showStats && <StatsCardsSkeleton count={statsCount} className="mb-6" />}

        {/* Filters Skeleton */}
        {showFilters && (
          <div className="mb-6 flex flex-wrap gap-4 rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-800">
            <Skeleton variant="rounded" width="200px" height="40px" />
            <Skeleton variant="rounded" width="150px" height="40px" />
            <Skeleton variant="rounded" width="150px" height="40px" />
            <Skeleton variant="rounded" width="100px" height="40px" />
          </div>
        )}

        {/* Table Skeleton */}
        {showTable && (
          <div className="rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-800">
            <TableSkeleton rows={tableRows} columns={tableColumns} />
            {/* Pagination Skeleton */}
            <div className="mt-4 flex items-center justify-between border-t border-gray-200 pt-4 dark:border-gray-700">
              <Skeleton variant="text" width="150px" height="1rem" />
              <div className="flex gap-2">
                {Array.from({ length: 5 }, (_, i) => (
                  <Skeleton key={i} variant="rounded" width="40px" height="40px" />
                ))}
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default Skeleton;
```

<!-- path: hnvtx/components/common/ui/Button/index.ts -->
```typescript
export { Button } from './Button';
```

<!-- path: hnvtx/components/common/ui/Button/Button.tsx -->
```typescript
// src/components/common/Button/Button.tsx
import { forwardRef, type ButtonHTMLAttributes } from 'react';
import { cn } from '@/utils/classNames';
import { ButtonSpinner } from '../LoadingSpinner';

export interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'success' | 'warning' | 'danger' | 'ghost' | 'outline';
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl';
  loading?: boolean;
  loadingText?: string;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
  fullWidth?: boolean;
  rounded?: 'none' | 'sm' | 'md' | 'lg' | 'full';
}

const variants = {
  primary: 'bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 disabled:bg-blue-300',
  secondary: 'bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500 disabled:bg-gray-300',
  success: 'bg-green-600 text-white hover:bg-green-700 focus:ring-green-500 disabled:bg-green-300',
  warning: 'bg-yellow-600 text-white hover:bg-yellow-700 focus:ring-yellow-500 disabled:bg-yellow-300',
  danger: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500 disabled:bg-red-300',
  ghost: 'text-gray-700 hover:bg-gray-100 focus:ring-gray-500 disabled:text-gray-400',
  outline: 'border border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-gray-500 disabled:text-gray-400 disabled:border-gray-200',
};

const sizes = {
  xs: 'px-2 py-1 text-xs',
  sm: 'px-3 py-1.5 text-sm',
  md: 'px-4 py-2 text-sm',
  lg: 'px-5 py-2.5 text-base',
  xl: 'px-6 py-3 text-lg',
};

const roundedOptions = {
  none: 'rounded-none',
  sm: 'rounded-sm',
  md: 'rounded-md',
  lg: 'rounded-lg',
  full: 'rounded-full',
};

export const Button = forwardRef<HTMLButtonElement, ButtonProps>(
  (
    {
      variant = 'primary',
      size = 'md',
      loading = false,
      loadingText,
      leftIcon,
      rightIcon,
      fullWidth = false,
      rounded = 'md',
      disabled,
      children,
      className,
      ...props
    },
    ref
  ) => {
    const isDisabled = disabled || loading;

    return (
      <button
        ref={ref}
        disabled={isDisabled}
        className={cn(
          // Base styles
          'inline-flex items-center justify-center font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2',
          // Variant styles
          variants[variant],
          // Size styles
          sizes[size],
          // Rounded styles
          roundedOptions[rounded],
          // Full width
          fullWidth && 'w-full',
          // Disabled cursor
          isDisabled && 'cursor-not-allowed',
          // Custom className
          className
        )}
        {...props}
      >
        {/* Loading spinner */}
        {loading && (
          <ButtonSpinner
            size={size === 'xs' ? 'xs' : size === 'sm' ? 'sm' : 'sm'}
          />
        )}

        {/* Left icon */}
        {!loading && leftIcon && (
          <span className="mr-2 flex items-center">
            {leftIcon}
          </span>
        )}

        {/* Button content */}
        <span>
          {loading && loadingText ? loadingText : children}
        </span>

        {/* Right icon */}
        {!loading && rightIcon && (
          <span className="ml-2 flex items-center">
            {rightIcon}
          </span>
        )}
      </button>
    );
  }
);

Button.displayName = 'Button';

// Icon button variant
interface IconButtonProps extends Omit<ButtonProps, 'leftIcon' | 'rightIcon'> {
  icon: React.ReactNode;
  label?: string; // For accessibility
}

export const IconButton = forwardRef<HTMLButtonElement, IconButtonProps>(
  ({ icon, label, size = 'md', className, ...props }, ref) => {
    const iconSizes = {
      xs: 'h-3 w-3',
      sm: 'h-4 w-4',
      md: 'h-5 w-5',
      lg: 'h-6 w-6',
      xl: 'h-7 w-7',
    };

    return (
      <Button
        ref={ref}
        size={size}
        className={cn(
          'aspect-square !p-0',
          className
        )}
        aria-label={label}
        {...props}
      >
        <span className={iconSizes[size]}>
          {icon}
        </span>
      </Button>
    );
  }
);

IconButton.displayName = 'IconButton';

// Button group component
interface ButtonGroupProps {
  children: React.ReactNode;
  orientation?: 'horizontal' | 'vertical';
  attached?: boolean;
  className?: string;
}

export const ButtonGroup: React.FC<ButtonGroupProps> = ({
  children,
  orientation = 'horizontal',
  attached = false,
  className,
}) => {
  return (
    <div
      className={cn(
        'inline-flex',
        orientation === 'horizontal' ? 'flex-row' : 'flex-col',
        attached && orientation === 'horizontal' && '[&>*:not(:first-child)]:ml-0 [&>*:not(:first-child)]:rounded-l-none [&>*:not(:last-child)]:rounded-r-none [&>*]:border-r-0 [&>*:last-child]:border-r',
        attached && orientation === 'vertical' && '[&>*:not(:first-child)]:mt-0 [&>*:not(:first-child)]:rounded-t-none [&>*:not(:last-child)]:rounded-b-none [&>*]:border-b-0 [&>*:last-child]:border-b',
        !attached && orientation === 'horizontal' && 'space-x-2',
        !attached && orientation === 'vertical' && 'space-y-2',
        className
      )}
    >
      {children}
    </div>
  );
};

// Floating Action Button
interface FABProps extends Omit<ButtonProps, 'size' | 'variant'> {
  size?: 'md' | 'lg';
  position?: 'bottom-right' | 'bottom-left' | 'top-right' | 'top-left';
  icon?: React.ReactNode;
}

export const FloatingActionButton: React.FC<FABProps> = ({
  size = 'lg',
  position = 'bottom-right',
  icon,
  children,
  className,
  ...props
}) => {
  const positions = {
    'bottom-right': 'fixed bottom-6 right-6',
    'bottom-left': 'fixed bottom-6 left-6',
    'top-right': 'fixed top-6 right-6',
    'top-left': 'fixed top-6 left-6',
  };

  const fabSizes = {
    md: 'h-12 w-12',
    lg: 'h-14 w-14',
  };

  return (
    <Button
      variant="primary"
      rounded="full"
      className={cn(
        positions[position],
        fabSizes[size],
        'shadow-lg hover:shadow-xl z-50 !p-0',
        className
      )}
      {...props}
    >
      {icon || children}
    </Button>
  );
};

// Specialized exam buttons
export const SubmitButton: React.FC<Omit<ButtonProps, 'variant'>> = (props) => (
  <Button variant="success" {...props} />
);

export const CancelButton: React.FC<Omit<ButtonProps, 'variant'>> = (props) => (
  <Button variant="outline" {...props} />
);

export const DeleteButton: React.FC<Omit<ButtonProps, 'variant'>> = (props) => (
  <Button variant="danger" {...props} />
);

export const NextButton: React.FC<Omit<ButtonProps, 'variant' | 'rightIcon'>> = (props) => (
  <Button
    variant="primary"
    rightIcon={
      <svg className="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
      </svg>
    }
    {...props}
  />
);

export const PreviousButton: React.FC<Omit<ButtonProps, 'variant' | 'leftIcon'>> = (props) => (
  <Button
    variant="secondary"
    leftIcon={
      <svg className="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
      </svg>
    }
    {...props}
  />
);
```

<!-- path: hnvtx/components/common/ui/phoneInput/index.ts -->
```typescript
export { default as PhoneInputWithCountry } from './PhoneInputWithCountry';
```

<!-- path: hnvtx/components/common/ui/phoneInput/PhoneInputWithCountry.tsx -->
```typescript
"use client";

import { useState } from "react";
import { FaChevronDown } from "react-icons/fa";

interface Country {
  name: string;
  code: string;
  dialCode: string;
  flag: string;
}

// Full country list: name, code, dialCode, flag
const countries: Country[] = [
  { name: "India", code: "IN", dialCode: "+91", flag: "🇮🇳" },
  { name: "Afghanistan", code: "AF", dialCode: "+93", flag: "🇦🇫" },
  { name: "Åland Islands", code: "AX", dialCode: "+358", flag: "🇦🇽" },
  { name: "Albania", code: "AL", dialCode: "+355", flag: "🇦🇱" },
  { name: "Algeria", code: "DZ", dialCode: "+213", flag: "🇩🇿" },
  { name: "American Samoa", code: "AS", dialCode: "+1684", flag: "🇦🇸" },
  { name: "Andorra", code: "AD", dialCode: "+376", flag: "🇦🇩" },
  { name: "Angola", code: "AO", dialCode: "+244", flag: "🇦🇴" },
  { name: "Anguilla", code: "AI", dialCode: "+1264", flag: "🇦🇮" },
  { name: "Antarctica", code: "AQ", dialCode: "+672", flag: "🇦🇶" },
  { name: "Antigua and Barbuda", code: "AG", dialCode: "+1268", flag: "🇦🇬" },
  { name: "Argentina", code: "AR", dialCode: "+54", flag: "🇦🇷" },
  { name: "Armenia", code: "AM", dialCode: "+374", flag: "🇦🇲" },
  { name: "Aruba", code: "AW", dialCode: "+297", flag: "🇦🇼" },
  { name: "Australia", code: "AU", dialCode: "+61", flag: "🇦🇺" },
  { name: "Austria", code: "AT", dialCode: "+43", flag: "🇦🇹" },
  { name: "Azerbaijan", code: "AZ", dialCode: "+994", flag: "🇦🇿" },
  { name: "Bahamas", code: "BS", dialCode: "+1242", flag: "🇧🇸" },
  { name: "Bahrain", code: "BH", dialCode: "+973", flag: "🇧🇭" },
  { name: "Bangladesh", code: "BD", dialCode: "+880", flag: "🇧🇩" },
  { name: "Barbados", code: "BB", dialCode: "+1246", flag: "🇧🇧" },
  { name: "Belarus", code: "BY", dialCode: "+375", flag: "🇧🇾" },
  { name: "Belgium", code: "BE", dialCode: "+32", flag: "🇧🇪" },
  { name: "Belize", code: "BZ", dialCode: "+501", flag: "🇧🇿" },
  { name: "Benin", code: "BJ", dialCode: "+229", flag: "🇧🇯" },
  { name: "Bermuda", code: "BM", dialCode: "+1441", flag: "🇧🇲" },
  { name: "Bhutan", code: "BT", dialCode: "+975", flag: "🇧🇹" },
  { name: "Bolivia", code: "BO", dialCode: "+591", flag: "🇧🇴" },
  { name: "Bosnia and Herzegovina", code: "BA", dialCode: "+387", flag: "🇧🇦" },
  { name: "Botswana", code: "BW", dialCode: "+267", flag: "🇧🇼" },
  { name: "Brazil", code: "BR", dialCode: "+55", flag: "🇧🇷" },
  {
    name: "British Indian Ocean Territory",
    code: "IO",
    dialCode: "+246",
    flag: "🇮🇴",
  },
  { name: "Brunei Darussalam", code: "BN", dialCode: "+673", flag: "🇧🇳" },
  { name: "Bulgaria", code: "BG", dialCode: "+359", flag: "🇧🇬" },
  { name: "Burkina Faso", code: "BF", dialCode: "+226", flag: "🇧🇫" },
  { name: "Burundi", code: "BI", dialCode: "+257", flag: "🇧🇮" },
  { name: "Cambodia", code: "KH", dialCode: "+855", flag: "🇰🇭" },
  { name: "Cameroon", code: "CM", dialCode: "+237", flag: "🇨🇲" },
  { name: "Canada", code: "CA", dialCode: "+1", flag: "🇨🇦" },
  { name: "Cape Verde", code: "CV", dialCode: "+238", flag: "🇨🇻" },
  { name: "Cayman Islands", code: "KY", dialCode: "+1345", flag: "🇰🇾" },
  {
    name: "Central African Republic",
    code: "CF",
    dialCode: "+236",
    flag: "🇨🇫",
  },
  { name: "Chad", code: "TD", dialCode: "+235", flag: "🇹🇩" },
  { name: "Chile", code: "CL", dialCode: "+56", flag: "🇨🇱" },
  { name: "China", code: "CN", dialCode: "+86", flag: "🇨🇳" },
  { name: "Christmas Island", code: "CX", dialCode: "+61", flag: "🇨🇽" },
  { name: "Cocos (Keeling) Islands", code: "CC", dialCode: "+61", flag: "🇨🇨" },
  { name: "Colombia", code: "CO", dialCode: "+57", flag: "🇨🇴" },
  { name: "Comoros", code: "KM", dialCode: "+269", flag: "🇰🇲" },
  { name: "Congo", code: "CG", dialCode: "+242", flag: "🇨🇬" },
  {
    name: "Congo, The Democratic Republic of the",
    code: "CD",
    dialCode: "+243",
    flag: "🇨🇩",
  },
  { name: "Cook Islands", code: "CK", dialCode: "+682", flag: "🇨🇰" },
  { name: "Costa Rica", code: "CR", dialCode: "+506", flag: "🇨🇷" },
  { name: "Côte d'Ivoire", code: "CI", dialCode: "+225", flag: "🇨🇮" },
  { name: "Croatia", code: "HR", dialCode: "+385", flag: "🇭🇷" },
  { name: "Cuba", code: "CU", dialCode: "+53", flag: "🇨🇺" },
  { name: "Curaçao", code: "CW", dialCode: "+599", flag: "🇨🇼" },
  { name: "Cyprus", code: "CY", dialCode: "+357", flag: "🇨🇾" },
  { name: "Czech Republic", code: "CZ", dialCode: "+420", flag: "🇨🇿" },
  { name: "Denmark", code: "DK", dialCode: "+45", flag: "🇩🇰" },
  { name: "Djibouti", code: "DJ", dialCode: "+253", flag: "🇩🇯" },
  { name: "Dominica", code: "DM", dialCode: "+1767", flag: "🇩🇲" },
  { name: "Dominican Republic", code: "DO", dialCode: "+1809", flag: "🇩🇴" },
  { name: "Ecuador", code: "EC", dialCode: "+593", flag: "🇪🇨" },
  { name: "Egypt", code: "EG", dialCode: "+20", flag: "🇪🇬" },
  { name: "El Salvador", code: "SV", dialCode: "+503", flag: "🇸🇻" },
  { name: "Equatorial Guinea", code: "GQ", dialCode: "+240", flag: "🇬🇶" },
  { name: "Eritrea", code: "ER", dialCode: "+291", flag: "🇪🇷" },
  { name: "Estonia", code: "EE", dialCode: "+372", flag: "🇪🇪" },
  { name: "Ethiopia", code: "ET", dialCode: "+251", flag: "🇪🇹" },
  {
    name: "Falkland Islands (Malvinas)",
    code: "FK",
    dialCode: "+500",
    flag: "🇫🇰",
  },
  { name: "Faroe Islands", code: "FO", dialCode: "+298", flag: "🇫🇴" },
  { name: "Fiji", code: "FJ", dialCode: "+679", flag: "🇫🇯" },
  { name: "Finland", code: "FI", dialCode: "+358", flag: "🇫🇮" },
  { name: "France", code: "FR", dialCode: "+33", flag: "🇫🇷" },
  { name: "French Guiana", code: "GF", dialCode: "+594", flag: "🇬🇫" },
  { name: "French Polynesia", code: "PF", dialCode: "+689", flag: "🇵🇫" },
  { name: "Gabon", code: "GA", dialCode: "+241", flag: "🇬🇦" },
  { name: "Gambia", code: "GM", dialCode: "+220", flag: "🇬🇲" },
  { name: "Georgia", code: "GE", dialCode: "+995", flag: "🇬🇪" },
  { name: "Germany", code: "DE", dialCode: "+49", flag: "🇩🇪" },
  { name: "Ghana", code: "GH", dialCode: "+233", flag: "🇬🇭" },
  { name: "Gibraltar", code: "GI", dialCode: "+350", flag: "🇬🇮" },
  { name: "Greece", code: "GR", dialCode: "+30", flag: "🇬🇷" },
  { name: "Greenland", code: "GL", dialCode: "+299", flag: "🇬🇱" },
  { name: "Grenada", code: "GD", dialCode: "+1473", flag: "🇬🇩" },
  { name: "Guadeloupe", code: "GP", dialCode: "+590", flag: "🇬🇵" },
  { name: "Guam", code: "GU", dialCode: "+1671", flag: "🇬🇺" },
  { name: "Guatemala", code: "GT", dialCode: "+502", flag: "🇬🇹" },
  { name: "Guernsey", code: "GG", dialCode: "+44", flag: "🇬🇬" },
  { name: "Guinea", code: "GN", dialCode: "+224", flag: "🇬🇳" },
  { name: "Guinea-Bissau", code: "GW", dialCode: "+245", flag: "🇬🇼" },
  { name: "Guyana", code: "GY", dialCode: "+592", flag: "🇬🇾" },
  { name: "Haiti", code: "HT", dialCode: "+509", flag: "🇭🇹" },
  { name: "Honduras", code: "HN", dialCode: "+504", flag: "🇭🇳" },
  { name: "Hong Kong", code: "HK", dialCode: "+852", flag: "🇭🇰" },
  { name: "Hungary", code: "HU", dialCode: "+36", flag: "🇭🇺" },
  { name: "Iceland", code: "IS", dialCode: "+354", flag: "🇮🇸" },
  { name: "Indonesia", code: "ID", dialCode: "+62", flag: "🇮🇩" },
  {
    name: "Iran, Islamic Republic of",
    code: "IR",
    dialCode: "+98",
    flag: "🇮🇷",
  },
  { name: "Iraq", code: "IQ", dialCode: "+964", flag: "🇮🇶" },
  { name: "Ireland", code: "IE", dialCode: "+353", flag: "🇮🇪" },
  { name: "Isle of Man", code: "IM", dialCode: "+44", flag: "🇮🇲" },
  { name: "Israel", code: "IL", dialCode: "+972", flag: "🇮🇱" },
  { name: "Italy", code: "IT", dialCode: "+39", flag: "🇮🇹" },
  { name: "Jamaica", code: "JM", dialCode: "+1876", flag: "🇯🇲" },
  { name: "Japan", code: "JP", dialCode: "+81", flag: "🇯🇵" },
  { name: "Jersey", code: "JE", dialCode: "+44", flag: "🇯🇪" },
  { name: "Jordan", code: "JO", dialCode: "+962", flag: "🇯🇴" },
  { name: "Kazakhstan", code: "KZ", dialCode: "+7", flag: "🇰🇿" },
  { name: "Kenya", code: "KE", dialCode: "+254", flag: "🇰🇪" },
  { name: "Kiribati", code: "KI", dialCode: "+686", flag: "🇰🇮" },
  {
    name: "Korea, Democratic People's Republic of",
    code: "KP",
    dialCode: "+850",
    flag: "🇰🇵",
  },
  { name: "Korea, Republic of", code: "KR", dialCode: "+82", flag: "🇰🇷" },
  { name: "Kuwait", code: "KW", dialCode: "+965", flag: "🇰🇼" },
  { name: "Kyrgyzstan", code: "KG", dialCode: "+996", flag: "🇰🇬" },
  {
    name: "Lao People's Democratic Republic",
    code: "LA",
    dialCode: "+856",
    flag: "🇱🇦",
  },
  { name: "Latvia", code: "LV", dialCode: "+371", flag: "🇱🇻" },
  { name: "Lebanon", code: "LB", dialCode: "+961", flag: "🇱🇧" },
  { name: "Lesotho", code: "LS", dialCode: "+266", flag: "🇱🇸" },
  { name: "Liberia", code: "LR", dialCode: "+231", flag: "🇱🇷" },
  { name: "Libya", code: "LY", dialCode: "+218", flag: "🇱🇾" },
  { name: "Liechtenstein", code: "LI", dialCode: "+423", flag: "🇱🇮" },
  { name: "Lithuania", code: "LT", dialCode: "+370", flag: "🇱🇹" },
  { name: "Luxembourg", code: "LU", dialCode: "+352", flag: "🇱🇺" },
  { name: "Macao", code: "MO", dialCode: "+853", flag: "🇲🇴" },
  {
    name: "Macedonia, The Former Yugoslav Republic of",
    code: "MK",
    dialCode: "+389",
    flag: "🇲🇰",
  },
  { name: "Madagascar", code: "MG", dialCode: "+261", flag: "🇲🇬" },
  { name: "Malawi", code: "MW", dialCode: "+265", flag: "🇲🇼" },
  { name: "Malaysia", code: "MY", dialCode: "+60", flag: "🇲🇾" },
  { name: "Maldives", code: "MV", dialCode: "+960", flag: "🇲🇻" },
  { name: "Mali", code: "ML", dialCode: "+223", flag: "🇲🇱" },
  { name: "Malta", code: "MT", dialCode: "+356", flag: "🇲🇹" },
  { name: "Marshall Islands", code: "MH", dialCode: "+692", flag: "🇲🇭" },
  { name: "Martinique", code: "MQ", dialCode: "+596", flag: "🇲🇶" },
  { name: "Mauritania", code: "MR", dialCode: "+222", flag: "🇲🇷" },
  { name: "Mauritius", code: "MU", dialCode: "+230", flag: "🇲🇺" },
  { name: "Mayotte", code: "YT", dialCode: "+262", flag: "🇾🇹" },
  { name: "Mexico", code: "MX", dialCode: "+52", flag: "🇲🇽" },
  {
    name: "Micronesia, Federated States of",
    code: "FM",
    dialCode: "+691",
    flag: "🇫🇲",
  },
  { name: "Moldova, Republic of", code: "MD", dialCode: "+373", flag: "🇲🇩" },
  { name: "Monaco", code: "MC", dialCode: "+377", flag: "🇲🇨" },
  { name: "Mongolia", code: "MN", dialCode: "+976", flag: "🇲🇳" },
  { name: "Montenegro", code: "ME", dialCode: "+382", flag: "🇲🇪" },
  { name: "Montserrat", code: "MS", dialCode: "+1664", flag: "🇲🇸" },
  { name: "Morocco", code: "MA", dialCode: "+212", flag: "🇲🇦" },
  { name: "Mozambique", code: "MZ", dialCode: "+258", flag: "🇲🇿" },
  { name: "Myanmar", code: "MM", dialCode: "+95", flag: "🇲🇲" },
  { name: "Namibia", code: "NA", dialCode: "+264", flag: "🇳🇦" },
  { name: "Nauru", code: "NR", dialCode: "+674", flag: "🇳🇷" },
  { name: "Nepal", code: "NP", dialCode: "+977", flag: "🇳🇵" },
  { name: "Netherlands", code: "NL", dialCode: "+31", flag: "🇳🇱" },
  { name: "New Caledonia", code: "NC", dialCode: "+687", flag: "🇳🇨" },
  { name: "New Zealand", code: "NZ", dialCode: "+64", flag: "🇳🇿" },
  { name: "Nicaragua", code: "NI", dialCode: "+505", flag: "🇳🇮" },
  { name: "Niger", code: "NE", dialCode: "+227", flag: "🇳🇪" },
  { name: "Nigeria", code: "NG", dialCode: "+234", flag: "🇳🇬" },
  { name: "Niue", code: "NU", dialCode: "+683", flag: "🇳🇺" },
  { name: "Norfolk Island", code: "NF", dialCode: "+672", flag: "🇳🇫" },
  {
    name: "Northern Mariana Islands",
    code: "MP",
    dialCode: "+1670",
    flag: "🇲🇵",
  },
  { name: "Norway", code: "NO", dialCode: "+47", flag: "🇳🇴" },
  { name: "Oman", code: "OM", dialCode: "+968", flag: "🇴🇲" },
  { name: "Pakistan", code: "PK", dialCode: "+92", flag: "🇵🇰" },
  { name: "Palau", code: "PW", dialCode: "+680", flag: "🇵🇼" },
  { name: "Palestine, State of", code: "PS", dialCode: "+970", flag: "🇵🇸" },
  { name: "Panama", code: "PA", dialCode: "+507", flag: "🇵🇦" },
  { name: "Papua New Guinea", code: "PG", dialCode: "+675", flag: "🇵🇬" },
  { name: "Paraguay", code: "PY", dialCode: "+595", flag: "🇵🇾" },
  { name: "Peru", code: "PE", dialCode: "+51", flag: "🇵🇪" },
  { name: "Philippines", code: "PH", dialCode: "+63", flag: "🇵🇭" },
  { name: "Pitcairn", code: "PN", dialCode: "+870", flag: "🇵🇳" },
  { name: "Poland", code: "PL", dialCode: "+48", flag: "🇵🇱" },
  { name: "Portugal", code: "PT", dialCode: "+351", flag: "🇵🇹" },
  { name: "Puerto Rico", code: "PR", dialCode: "+1", flag: "🇵🇷" },
  { name: "Qatar", code: "QA", dialCode: "+974", flag: "🇶🇦" },
  { name: "Réunion", code: "RE", dialCode: "+262", flag: "🇷🇪" },
  { name: "Romania", code: "RO", dialCode: "+40", flag: "🇷🇴" },
  { name: "Russia", code: "RU", dialCode: "+7", flag: "🇷🇺" },
  { name: "Rwanda", code: "RW", dialCode: "+250", flag: "🇷🇼" },
  { name: "Saint Barthélemy", code: "BL", dialCode: "+590", flag: "🇧🇱" },
  { name: "Saint Helena", code: "SH", dialCode: "+290", flag: "🇸🇭" },
  { name: "Saint Kitts and Nevis", code: "KN", dialCode: "+1869", flag: "🇰🇳" },
  { name: "Saint Lucia", code: "LC", dialCode: "+1758", flag: "🇱🇨" },
  {
    name: "Saint Martin (French part)",
    code: "MF",
    dialCode: "+590",
    flag: "🇲🇫",
  },
  {
    name: "Saint Pierre and Miquelon",
    code: "PM",
    dialCode: "+508",
    flag: "🇵🇲",
  },
  {
    name: "Saint Vincent and the Grenadines",
    code: "VC",
    dialCode: "+1784",
    flag: "🇻🇨",
  },
  { name: "Samoa", code: "WS", dialCode: "+685", flag: "🇼🇸" },
  { name: "San Marino", code: "SM", dialCode: "+378", flag: "🇸🇲" },
  { name: "Sao Tome and Principe", code: "ST", dialCode: "+239", flag: "🇸🇹" },
  { name: "Saudi Arabia", code: "SA", dialCode: "+966", flag: "🇸🇦" },
  { name: "Senegal", code: "SN", dialCode: "+221", flag: "🇸🇳" },
  { name: "Serbia", code: "RS", dialCode: "+381", flag: "🇷🇸" },
  { name: "Seychelles", code: "SC", dialCode: "+248", flag: "🇸🇨" },
  { name: "Sierra Leone", code: "SL", dialCode: "+232", flag: "🇸🇱" },
  { name: "Singapore", code: "SG", dialCode: "+65", flag: "🇸🇬" },
  {
    name: "Sint Maarten (Dutch part)",
    code: "SX",
    dialCode: "+1721",
    flag: "🇸🇽",
  },
  { name: "Slovakia", code: "SK", dialCode: "+421", flag: "🇸🇰" },
  { name: "Slovenia", code: "SI", dialCode: "+386", flag: "🇸🇮" },
  { name: "Solomon Islands", code: "SB", dialCode: "+677", flag: "🇸🇧" },
  { name: "Somalia", code: "SO", dialCode: "+252", flag: "🇸🇴" },
  { name: "South Africa", code: "ZA", dialCode: "+27", flag: "🇿🇦" },
  { name: "South Sudan", code: "SS", dialCode: "+211", flag: "🇸🇸" },
  { name: "Spain", code: "ES", dialCode: "+34", flag: "🇪🇸" },
  { name: "Sri Lanka", code: "LK", dialCode: "+94", flag: "🇱🇰" },
  { name: "Sudan", code: "SD", dialCode: "+249", flag: "🇸🇩" },
  { name: "Suriname", code: "SR", dialCode: "+597", flag: "🇸🇷" },
  { name: "Svalbard and Jan Mayen", code: "SJ", dialCode: "+47", flag: "🇸🇯" },
  { name: "Swaziland", code: "SZ", dialCode: "+268", flag: "🇸🇿" },
  { name: "Sweden", code: "SE", dialCode: "+46", flag: "🇸🇪" },
  { name: "Switzerland", code: "CH", dialCode: "+41", flag: "🇨🇭" },
  { name: "Syrian Arab Republic", code: "SY", dialCode: "+963", flag: "🇸🇾" },
  { name: "Taiwan", code: "TW", dialCode: "+886", flag: "🇹🇼" },
  { name: "Tajikistan", code: "TJ", dialCode: "+992", flag: "🇹🇯" },
  {
    name: "Tanzania, United Republic of",
    code: "TZ",
    dialCode: "+255",
    flag: "🇹🇿",
  },
  { name: "Thailand", code: "TH", dialCode: "+66", flag: "🇹🇭" },
  { name: "Timor-Leste", code: "TL", dialCode: "+670", flag: "🇹🇱" },
  { name: "Togo", code: "TG", dialCode: "+228", flag: "🇹🇬" },
  { name: "Tokelau", code: "TK", dialCode: "+690", flag: "🇹🇰" },
  { name: "Tonga", code: "TO", dialCode: "+676", flag: "🇹🇴" },
  { name: "Trinidad and Tobago", code: "TT", dialCode: "+1868", flag: "🇹🇹" },
  { name: "Tunisia", code: "TN", dialCode: "+216", flag: "🇹🇳" },
  { name: "Turkey", code: "TR", dialCode: "+90", flag: "🇹🇷" },
  { name: "Turkmenistan", code: "TM", dialCode: "+993", flag: "🇹🇲" },
  {
    name: "Turks and Caicos Islands",
    code: "TC",
    dialCode: "+1649",
    flag: "🇹🇨",
  },
  { name: "Tuvalu", code: "TV", dialCode: "+688", flag: "🇹🇻" },
  { name: "Uganda", code: "UG", dialCode: "+256", flag: "🇺🇬" },
  { name: "Ukraine", code: "UA", dialCode: "+380", flag: "🇺🇦" },
  { name: "United Arab Emirates", code: "AE", dialCode: "+971", flag: "🇦🇪" },
  { name: "United Kingdom", code: "GB", dialCode: "+44", flag: "🇬🇧" },
  { name: "United States", code: "US", dialCode: "+1", flag: "🇺🇸" },
  { name: "Uruguay", code: "UY", dialCode: "+598", flag: "🇺🇾" },
  { name: "Uzbekistan", code: "UZ", dialCode: "+998", flag: "🇺🇿" },
  { name: "Vanuatu", code: "VU", dialCode: "+678", flag: "🇻🇺" },
  { name: "Venezuela", code: "VE", dialCode: "+58", flag: "🇻🇪" },
  { name: "Vietnam", code: "VN", dialCode: "+84", flag: "🇻🇳" },
  {
    name: "Virgin Islands, British",
    code: "VG",
    dialCode: "+1284",
    flag: "🇻🇬",
  },
  { name: "Virgin Islands, U.S.", code: "VI", dialCode: "+1340", flag: "🇻🇮" },
  { name: "Wallis and Futuna", code: "WF", dialCode: "+681", flag: "🇼🇫" },
  { name: "Western Sahara", code: "EH", dialCode: "+212", flag: "🇪🇭" },
  { name: "Yemen", code: "YE", dialCode: "+967", flag: "🇾🇪" },
  { name: "Zambia", code: "ZM", dialCode: "+260", flag: "🇿🇲" },
  { name: "Zimbabwe", code: "ZW", dialCode: "+263", flag: "🇿🇼" },
];
interface PhoneInputWithCountryProps {
  value: string | null;
  onChange: (value: string) => void;
}

export default function PhoneInputWithCountry({
  value,
  onChange,
}: PhoneInputWithCountryProps) {
  const [selectedCountry, setSelectedCountry] = useState<Country>(countries[0]);

  const handleNumberChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const number = e.target.value.replace(/\D/g, "");
    onChange(`${selectedCountry.dialCode}${number}`);
  };

  const handleCountryChange = (e: React.ChangeEvent<HTMLSelectElement>) => {
    const country = countries.find((c) => c.code === e.target.value);
    if (country) {
      setSelectedCountry(country);
      const currentNumber = (value ?? "").replace(/^\+\d+/, "");
      const newValue = `${country.dialCode}${currentNumber}`;
      if (newValue !== value) {
        onChange(newValue);
      }
    }
  };

  return (
    <div className="flex flex-col gap-2">
      <label className="text-sm font-medium text-gray-700 dark:text-gray-300">
        Phone Number
      </label>
      <div className="flex gap-2">
        <div className="relative w-44">
          <select
            value={selectedCountry.code}
            onChange={handleCountryChange}
            className="w-full cursor-pointer appearance-none rounded-lg border border-gray-300 bg-white py-2 pr-8 pl-3 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-800 dark:text-white"
          >
            {countries.map((country) => (
              <option key={country.code} value={country.code}>
                {country.flag} {country.dialCode}
              </option>
            ))}
          </select>
          <FaChevronDown className="pointer-events-none absolute top-3 right-2 text-gray-500" />
        </div>

        <input
          type="tel"
          placeholder="Enter phone number"
          value={(value ?? "").replace(selectedCountry.dialCode, "")}
          onChange={handleNumberChange}
          className="flex-1 rounded-lg border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none dark:border-gray-600 dark:bg-gray-800 dark:text-white"
        />
      </div>
      <p className="text-xs text-gray-500 dark:text-gray-400">
        Full Contact Number: <span className="font-medium">{value}</span>
      </p>
    </div>
  );
}

```

<!-- path: hnvtx/components/common/ui/textarea/Textarea.tsx -->
```typescript
/* eslint-disable @typescript-eslint/no-unused-vars */
import { useState, ChangeEvent, FocusEvent } from "react";
import { Label } from "@/components/common/ui/label/Label";

// Type definitions
type TextareaResize = "none" | "both" | "horizontal" | "vertical";
type TextareaVariant = "default" | "filled" | "outlined";

interface TextareaProps extends Omit<React.TextareaHTMLAttributes<HTMLTextAreaElement>, "onChange"> {
  value?: string;
  onChange?: (e: ChangeEvent<HTMLTextAreaElement>, value: string) => void;
  placeholder?: string;
  disabled?: boolean;
  required?: boolean;
  error?: boolean;
  errorMessage?: string;
  label?: string;
  helperText?: string;
  rows?: number;
  maxLength?: number;
  resize?: TextareaResize;
  variant?: TextareaVariant;
  className?: string;
  id?: string;
  showCharCount?: boolean;
  fullWidth?: boolean;
}

// Textarea Component
export const Textarea: React.FC<TextareaProps> = ({
  value = "",
  onChange = (e: ChangeEvent<HTMLTextAreaElement>, value: string) => {},
  placeholder = "",
  disabled = false,
  required = false,
  error = false,
  errorMessage = "",
  label,
  helperText,
  rows = 4,
  maxLength,
  resize = "vertical",
  variant = "default",
  className = "",
  id,
  showCharCount = true,
  fullWidth = true,
  ...props
}) => {
  const [focused, setFocused] = useState<boolean>(false);
  const [charCount, setCharCount] = useState<number>(value.length);
  const hasValue = String(value ?? '').length > 0;

  const handleChange = (e: ChangeEvent<HTMLTextAreaElement>) => {
    const newValue = e.target.value;
    setCharCount(newValue.length);
    onChange(e, newValue);
  };

  const handleFocus = (e: FocusEvent<HTMLTextAreaElement>) => {
    setFocused(true);
    props.onFocus?.(e);
  };

  const handleBlur = (e: FocusEvent<HTMLTextAreaElement>) => {
    setFocused(false);
    props.onBlur?.(e);
  };

  const resizeClasses: Record<TextareaResize, string> = {
    none: "resize-none",
    both: "resize",
    horizontal: "resize-x",
    vertical: "resize-y",
  };

  const variantClasses: Record<TextareaVariant, string> = {
    default: "border shadow-sm",
    filled: "border-b-2 bg-gray-50 dark:bg-gray-900",
    outlined: "border-2"
  };

  const uniqueId = id || `textarea-${Math.random().toString(36).substr(2, 9)}`;

  return (
    <div className={`${fullWidth ? "w-full" : "w-fit"} ${className}`}>
      {label && (
        <Label
          htmlFor={uniqueId}
          required={required}
          disabled={disabled}
          className="mb-2"
        >
          {label}
        </Label>
      )}

      <div className="relative">
        <textarea
          id={uniqueId}
          value={value}
          onChange={handleChange}
          onFocus={handleFocus}
          onBlur={handleBlur}
          placeholder={placeholder}
          disabled={disabled}
          required={required}
          rows={rows}
          maxLength={maxLength}
          className={`
            ${fullWidth ? "w-full" : "w-fit"} 
            px-3 py-2 rounded-lg transition-all duration-200
            ${resizeClasses[resize]}
            ${variantClasses[variant]}
            ${
              error
                ? "border-red-300 focus:border-red-500 focus:ring-red-500 dark:border-red-500 dark:focus:border-red-600"
                : focused
                ? "border-blue-500 ring-2 ring-blue-500 ring-opacity-20 dark:border-blue-400 dark:ring-blue-400"
                : "border-gray-300 hover:border-gray-400 dark:border-gray-600 dark:hover:border-gray-500"
            }
            ${
              disabled
                ? "bg-gray-50 text-gray-400 cursor-not-allowed dark:bg-gray-900 dark:text-gray-500"
                : hasValue
                  ? "bg-gray-100 text-gray-900 dark:bg-gray-800 dark:text-gray-100"
                  : "bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100"
            }
            focus:outline-none placeholder-gray-400 dark:placeholder-gray-500
          `}
          {...props}
        />

        {maxLength && showCharCount && (
          <div className="absolute bottom-2 right-2 text-xs text-gray-400 dark:text-gray-400 bg-white dark:bg-gray-900 px-1 rounded">
            {charCount}/{maxLength}
          </div>
        )}
      </div>

      {(errorMessage || helperText) && (
        <div className="mt-1">
          {error && errorMessage && (
            <p className="text-sm text-red-600 dark:text-red-400 flex items-center">
              <svg
                className="w-4 h-4 mr-1"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  fillRule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                  clipRule="evenodd"
                />
              </svg>
              {errorMessage}
            </p>
          )}
          {!error && helperText && (
            <p className="text-sm text-gray-500 dark:text-gray-400">{helperText}</p>
          )}
        </div>
      )}
    </div>
  );
};
```

<!-- path: hnvtx/components/common/ui/label/Label.tsx -->
```typescript
// Type definitions
type LabelSize = "xs" | "sm" | "md" | "lg" | "xl";
type LabelWeight = "normal" | "medium" | "semibold" | "bold";

interface LabelProps extends React.LabelHTMLAttributes<HTMLLabelElement> {
  children: React.ReactNode;
  htmlFor?: string;
  required?: boolean;
  disabled?: boolean;
  size?: LabelSize;
  weight?: LabelWeight;
  className?: string;
  showRequiredSymbol?: boolean;
  tooltip?: string;
}

// Label Component  
export const Label: React.FC<LabelProps> = ({ 
  children, 
  htmlFor, 
  required = false, 
  disabled = false,
  size = "md",
  weight = "medium",
  className = "",
  showRequiredSymbol = true,
  tooltip,
  ...props 
}) => {
  const sizeClasses: Record<LabelSize, string> = {
    xs: "text-xs",
    sm: "text-sm",
    md: "text-base", 
    lg: "text-lg",
    xl: "text-xl"
  };

  const weightClasses: Record<LabelWeight, string> = {
    normal: "font-normal",
    medium: "font-medium",
    semibold: "font-semibold",
    bold: "font-bold"
  };

  return (
    <label
      htmlFor={htmlFor}
      className={`
        ${sizeClasses[size]} 
        ${weightClasses[weight]} 
        block text-gray-900 dark:text-gray-100
        ${disabled ? 'text-gray-400 dark:text-gray-500 cursor-not-allowed' : 'cursor-pointer'}
        ${className}
        relative
      `}
      aria-disabled={disabled}
      data-tooltip={tooltip}
      {...props}
    >
      {children}
      {required && showRequiredSymbol && (
        <span className="text-red-500 dark:text-red-400 ml-1">*</span>
      )}
      {tooltip && (
        <span className="ml-2 text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-400">
          <svg 
            xmlns="http://www.w3.org/2000/svg" 
            className="h-4 w-4 inline" 
            fill="none" 
            viewBox="0 0 24 24" 
            stroke="currentColor"
          >
            <path 
              strokeLinecap="round" 
              strokeLinejoin="round" 
              strokeWidth={2} 
              d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" 
            />
          </svg>
        </span>
      )}
    </label>
  );
};


// // Usage
// // Basic usage
// <Label htmlFor="email">Email Address</Label>

// // With required field
// <Label htmlFor="password" required>Password</Label>

// // With tooltip
// <Label htmlFor="api-key" tooltip="Your unique API identifier">API Key</Label>

// // Custom size and weight
// <Label htmlFor="name" size="lg" weight="bold">Full Name</Label>

// // Disabled state
// <Label htmlFor="readonly" disabled>Read-only Field</Label>
```

<!-- path: hnvtx/components/common/ui/ProgressBar/index.ts -->
```typescript
export { ProgressBar } from './ProgressBar';
```

<!-- path: hnvtx/components/common/ui/ProgressBar/ProgressBar.tsx -->
```typescript
// src/components/common/ProgressBar/ProgressBar.tsx
import { motion } from 'framer-motion';
import { cn } from '@/utils/classNames';
import { type ReactNode } from 'react';

// Common types
export type Variant = 'default' | 'success' | 'warning' | 'danger' | 'info';

const sizeClasses = {
  xs: 'h-1',
  sm: 'h-2',
  md: 'h-3',
  lg: 'h-4',
};

const variantClasses: Record<Variant, string> = {
  default: 'bg-blue-500 dark:bg-blue-400',
  success: 'bg-green-500 dark:bg-green-400',
  warning: 'bg-yellow-500 dark:bg-yellow-400',
  danger: 'bg-red-500 dark:bg-red-400',
  info: 'bg-cyan-500 dark:bg-cyan-400',
};

const backgroundClasses: Record<Variant, string> = {
  default: 'bg-blue-100 dark:bg-blue-900',
  success: 'bg-green-100 dark:bg-green-900',
  warning: 'bg-yellow-100 dark:bg-yellow-900',
  danger: 'bg-red-100 dark:bg-red-900',
  info: 'bg-cyan-100 dark:bg-cyan-900',
};

// Linear ProgressBar
interface ProgressBarProps {
  value: number;
  max?: number;
  size?: keyof typeof sizeClasses;
  variant?: Variant;
  showLabel?: boolean;
  label?: string;
  showPercentage?: boolean;
  animated?: boolean;
  striped?: boolean;
  className?: string;
  barClassName?: string;
}

export const ProgressBar: React.FC<ProgressBarProps> = ({
  value,
  max = 100,
  size = 'md',
  variant = 'default',
  showLabel = false,
  label,
  showPercentage = true,
  animated = true,
  striped = false,
  className,
  barClassName,
}) => {
  const percentage = Math.min(Math.max((value / max) * 100, 0), 100);

  return (
    <div className={cn('w-full', className)}>
      {(showLabel || showPercentage) && (
        <div className="mb-2 flex items-center justify-between text-sm">
          {showLabel && <span className="font-medium text-gray-700 dark:text-gray-200">{label || 'Progress'}</span>}
          {showPercentage && <span className="text-gray-600 dark:text-gray-300">{Math.round(percentage)}%</span>}
        </div>
      )}

      <div className={cn('overflow-hidden rounded-full', sizeClasses[size], backgroundClasses[variant])}>
        <motion.div
          className={cn(
            'h-full rounded-full transition-all duration-300 ease-in-out',
            variantClasses[variant],
            striped && 'bg-stripes',
            striped && animated && 'animate-stripes',
            barClassName
          )}
          initial={{ width: 0 }}
          animate={{ width: `${percentage}%` }}
          transition={{ duration: animated ? 0.8 : 0, ease: 'easeOut' }}
        />
      </div>
    </div>
  );
};

// Stacked Progress Bars
interface StackedProgressBarProps {
  segments: { value: number; variant?: Variant }[];
  max?: number;
  size?: keyof typeof sizeClasses;
  animated?: boolean;
  className?: string;
}

export const StackedProgressBar: React.FC<StackedProgressBarProps> = ({
  segments,
  max = 100,
  size = 'md',
  animated = true,
  className,
}) => {
  return (
    <div className={cn('flex w-full overflow-hidden rounded-full', sizeClasses[size], className)}>
      {segments.map((seg, idx) => {
        const width = `${(seg.value / max) * 100}%`;
        const color = variantClasses[seg.variant || 'default'];
        return (
          <motion.div
            key={idx}
            className={cn('h-full', color)}
            initial={{ width: 0 }}
            animate={{ width }}
            transition={{ duration: animated ? 0.8 : 0, ease: 'easeOut' }}
          />
        );
      })}
    </div>
  );
};

// Step Progress Bar with icons
interface StepProgressProps {
  steps: Array<{
    id: string;
    label: string;
    description?: string;
    icon?: ReactNode;
  }>;
  currentStep: number;
  orientation?: 'horizontal' | 'vertical';
  className?: string;
}

export const StepProgress: React.FC<StepProgressProps> = ({
  steps,
  currentStep,
  orientation = 'horizontal',
  className,
}) => {
  const isHorizontal = orientation === 'horizontal';

  return (
    <div className={cn('flex', isHorizontal ? 'items-center space-x-4' : 'flex-col space-y-4', className)}>
      {steps.map((step, index) => {
        const isActive = index === currentStep;
        const isCompleted = index < currentStep;
        const isUpcoming = index > currentStep;

        return (
          <div key={step.id} className={cn('flex items-center', isHorizontal ? 'flex-row' : 'flex-col')}>
            <div className="flex items-center">
              <div
                className={cn(
                  'flex h-8 w-8 items-center justify-center rounded-full text-sm font-medium',
                  isCompleted && 'bg-green-500 text-white',
                  isActive && 'bg-blue-500 text-white',
                  isUpcoming && 'bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-300'
                )}
              >
                {step.icon || (isCompleted ? (
                  <svg className="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      fillRule="evenodd"
                      d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                      clipRule="evenodd"
                    />
                  </svg>
                ) : (
                  index + 1
                ))}
              </div>
              {index < steps.length - 1 && (
                <div
                  className={cn(
                    isHorizontal ? 'h-0.5 w-12' : 'h-12 w-0.5',
                    isCompleted ? 'bg-green-500' : 'bg-gray-200 dark:bg-gray-700'
                  )}
                />
              )}
            </div>
            <div className={cn('ml-3', !isHorizontal && 'ml-0 mt-2')}>
              <p
                className={cn(
                  'text-sm font-medium',
                  isActive && 'text-blue-600 dark:text-blue-400',
                  isCompleted && 'text-green-600 dark:text-green-400',
                  isUpcoming && 'text-gray-500 dark:text-gray-400'
                )}
              >
                {step.label}
              </p>
              {step.description && <p className="text-xs text-gray-500 dark:text-gray-400">{step.description}</p>}
            </div>
          </div>
        );
      })}
    </div>
  );
};

```

<!-- path: hnvtx/components/common/ui/LoadingSpinner/index.ts -->
```typescript
export { LoadingSpinner } from './LoadingSpinner';
export { ButtonSpinner, PageSpinner, CardSpinner, LoadingSkeleton, LoadingCard } from './LoadingSpinner';
```

<!-- path: hnvtx/components/common/ui/LoadingSpinner/AdvancedLoader.tsx -->
```typescript
"use client";

import React, { useState, useEffect } from "react";

const AdvancedLoader: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [loadingProgress, setLoadingProgress] = useState(0);
  const [isLoading, setIsLoading] = useState(true);
  const [loadingText, setLoadingText] = useState("Initializing...");

  useEffect(() => {
    const loadingSteps = [
      { progress: 20, text: "Loading assets..." },
      { progress: 40, text: "Connecting to server..." },
      { progress: 60, text: "Fetching data..." },
      { progress: 80, text: "Preparing interface..." },
      { progress: 100, text: "Almost ready..." },
    ];

    let currentStep = 0;
    const interval = setInterval(() => {
      if (currentStep < loadingSteps.length) {
        const step = loadingSteps[currentStep];
        setLoadingProgress(step.progress);
        setLoadingText(step.text);
        currentStep++;
      } else {
        clearInterval(interval);
        setTimeout(() => {
          setIsLoading(false);
        }, 500);
      }
    }, 600);

    return () => clearInterval(interval);
  }, []);

  if (isLoading) {
    return (
      <div className='fixed inset-0 bg-gradient-to-r from-indigo-900 via-purple-900 to-pink-900 flex items-center justify-center'>
        <div className='text-center max-w-md mx-auto px-6'>
          {/* Logo or Brand */}
          <div className='mb-8'>
            <div className='w-16 h-16 mx-auto bg-white bg-opacity-20 rounded-full flex items-center justify-center'>
              <div className='w-8 h-8 bg-white rounded-sm'></div>
            </div>
          </div>

          {/* Main Loader */}
          <div className='relative mb-8'>
            <div className='w-32 h-32 mx-auto relative'>
              <svg className='w-32 h-32 transform -rotate-90' viewBox='0 0 100 100'>
                <circle cx='50' cy='50' r='40' stroke='rgba(255,255,255,0.2)' strokeWidth='8' fill='none' />
                <circle
                  cx='50'
                  cy='50'
                  r='40'
                  stroke='white'
                  strokeWidth='8'
                  fill='none'
                  strokeLinecap='round'
                  strokeDasharray={`${2 * Math.PI * 40}`}
                  strokeDashoffset={`${2 * Math.PI * 40 * (1 - loadingProgress / 100)}`}
                  className='transition-all duration-500 ease-out'
                />
              </svg>
              <div className='absolute inset-0 flex items-center justify-center'>
                <span className='text-white text-2xl font-bold'>{loadingProgress}%</span>
              </div>
            </div>
          </div>

          {/* Loading Text */}
          <div className='mb-6'>
            <p className='text-white text-lg font-medium'>{loadingText}</p>
          </div>

          {/* Progress Bar */}
          <div className='w-full bg-white bg-opacity-20 rounded-full h-2 mb-4'>
            <div className='bg-white rounded-full h-2 transition-all duration-500 ease-out' style={{ width: `${loadingProgress}%` }}></div>
          </div>

          {/* Dots Animation */}
          <div className='flex justify-center space-x-2'>
            {[0, 1, 2].map((i) => (
              <div
                key={i}
                className='w-2 h-2 bg-white rounded-full animate-pulse'
                style={{
                  animationDelay: `${i * 0.2}s`,
                  animationDuration: "1s",
                }}></div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  return <>{children}</>;
};

export default AdvancedLoader;

```

<!-- path: hnvtx/components/common/ui/LoadingSpinner/LoadingSpinner.tsx -->
```typescript
// components/common/ui/LoadingSpinner/LoadingSpinner.tsx
import { cn } from '@/utils/classNames';

interface LoadingSpinnerProps {
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl';
  color?: 'primary' | 'secondary' | 'white' | 'gray';
  className?: string;
  text?: string;
  overlay?: boolean;
}

const sizeClasses = {
  xs: 'h-3 w-3',
  sm: 'h-4 w-4',
  md: 'h-6 w-6',
  lg: 'h-8 w-8',
  xl: 'h-12 w-12',
};

const colorClasses = {
  primary: 'text-blue-600 dark:text-blue-400',
  secondary: 'text-gray-600 dark:text-gray-400',
  white: 'text-white dark:text-white',
  gray: 'text-gray-400 dark:text-gray-500',
};

const textSizeClasses = {
  xs: 'text-xs',
  sm: 'text-sm',
  md: 'text-base',
  lg: 'text-lg',
  xl: 'text-xl',
};

export const LoadingSpinner: React.FC<LoadingSpinnerProps> = ({
  size = 'md',
  color = 'primary',
  className,
  text,
  overlay = false,
}) => {
  const spinnerContent = (
    <div className={cn('flex flex-col items-center justify-center gap-3', className)}>
      <svg
        className={cn(
          'animate-spin',
          sizeClasses[size],
          colorClasses[color]
        )}
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle
          className="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          strokeWidth="4"
        />
        <path
          className="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 0 1 8-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 0 1 4 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
        />
      </svg>
      
      {text && (
        <p className={cn(
          'font-medium text-gray-600 dark:text-gray-300',
          textSizeClasses[size]
        )}>
          {text}
        </p>
      )}
    </div>
  );

  if (overlay) {
    return (
      <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-25 dark:bg-black dark:bg-opacity-40 backdrop-blur-sm">
        <div className="rounded-lg bg-white dark:bg-gray-800 p-6 shadow-lg">
          {spinnerContent}
        </div>
      </div>
    );
  }

  return spinnerContent;
};

// Variants for specific use cases
export const ButtonSpinner: React.FC<{ size?: 'xs' | 'sm' | 'md' }> = ({ 
  size = 'sm' 
}) => (
  <LoadingSpinner size={size} color="primary" className="inline-flex" />
);

export const PageSpinner: React.FC<{ text?: string }> = ({ 
  text = 'Loading...' 
}) => (
  <div className="flex min-h-screen items-center justify-center">
    <LoadingSpinner size="lg" text={text} />
  </div>
);

export const CardSpinner: React.FC<{ text?: string }> = ({ 
  text 
}) => (
  <div className="flex items-center justify-center py-12">
    <LoadingSpinner size="md" text={text} />
  </div>
);

// Loading skeleton components
export const LoadingSkeleton: React.FC<{
  className?: string;
  rows?: number;
}> = ({ className, rows = 1 }) => (
  <div className={cn('animate-pulse space-y-3', className)}>
    {Array.from({ length: rows }).map((_, index) => (
      <div
        key={index}
        className="h-4 rounded bg-gray-200 dark:bg-gray-700"
        style={{
          width: `${Math.random() * 40 + 60}%`,
        }}
      />
    ))}
  </div>
);

export const LoadingCard: React.FC<{
  className?: string;
}> = ({ className }) => (
  <div className={cn('animate-pulse rounded-lg border border-gray-200 dark:border-gray-700 p-6', className)}>
    <div className="space-y-4">
      <div className="h-6 w-3/4 rounded bg-gray-200 dark:bg-gray-700" />
      <div className="space-y-2">
        <div className="h-4 rounded bg-gray-200 dark:bg-gray-700" />
        <div className="h-4 w-5/6 rounded bg-gray-200 dark:bg-gray-700" />
      </div>
      <div className="h-10 w-24 rounded bg-gray-200 dark:bg-gray-700" />
    </div>
  </div>
);
```

<!-- path: hnvtx/components/common/ui/Input/index.ts -->
```typescript
export { default as Input } from './Input';

```

<!-- path: hnvtx/components/common/ui/Input/Input.tsx -->
```typescript
"use client";

import React, { forwardRef, useEffect, useId, useRef, useState } from 'react';
import { clsx } from 'clsx';
import { FiX } from 'react-icons/fi';

interface InputProps extends Omit<React.InputHTMLAttributes<HTMLInputElement>, 'size'> {
  error?: string;
  leftIcon?: React.ReactNode;
  isLoading?: boolean;
  fullWidth?: boolean;
  clearable?: boolean;
  onClear?: () => void;
}

const Input = forwardRef<HTMLInputElement, InputProps>(
  (
    {
      className,
      type = 'text',
      error,
      leftIcon,
      isLoading = false,
      disabled,
      fullWidth = true,
      clearable = false,
      onClear,
      id,
      value,
      ...props
    },
    ref
  ) => {
    const generatedId = useId();
    const inputId = id || generatedId;
    const innerRef = useRef<HTMLInputElement | null>(null);
    const [liveHasValue, setLiveHasValue] = useState<boolean>(false);

    // Merge forwarded ref with local ref
    const setRefs = (el: HTMLInputElement | null) => {
      innerRef.current = el;
      if (typeof ref === 'function') ref(el);
      else if (ref && 'current' in ref) (ref as React.MutableRefObject<HTMLInputElement | null>).current = el;
    };

    // Initialize hasValue on mount and when value/defaultValue changes
    useEffect(() => {
      const dv = (props as { defaultValue?: string | number })?.defaultValue;
      const raw = value ?? dv ?? innerRef.current?.value ?? '';
      setLiveHasValue(String(raw).length > 0);
      // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [value, (props as { defaultValue?: string | number })?.defaultValue]);

    // Handle clear action
    const handleClear = () => {
      // Create a synthetic event that react-hook-form can understand
      const syntheticEvent = {
        target: { value: '' },
        currentTarget: { value: '' },
      } as React.ChangeEvent<HTMLInputElement>;
      
      // If an onChange is passed from register, call it with an empty value
      props.onChange?.(syntheticEvent);
      
      onClear?.();
      
      // Focus the input
      if (ref && 'current' in ref && ref.current) {
        ref.current.focus();
      }
    };
    
    const shouldShowClear = clearable && !disabled && !isLoading && (String((value as any) || '').length > 0 || liveHasValue);
    const defaultValue = (props as { defaultValue?: string | number })?.defaultValue;
    const rawVal = value ?? defaultValue ?? '';
    const hasValue = liveHasValue || String(rawVal).length > 0;

    const inputClasses = clsx(
      'rounded-lg border transition-all duration-200 font-medium w-full',
      'focus:outline-none focus:ring-2 focus:border-transparent',
      'placeholder:text-gray-400 dark:placeholder-gray-500',
      'px-4 py-2.5 text-base', // Standard size
      leftIcon && 'pl-11',
      shouldShowClear && 'pr-11',
      // Place external classes earlier so our bg utilities later will override
      className,
      error ? 'border-red-500 focus:ring-red-500 dark:border-red-600' : 'border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500 focus:ring-blue-500',
      // Disabled style
      (disabled || isLoading) && 'bg-gray-100 dark:bg-gray-900 text-gray-500 cursor-not-allowed',
      // Active background: apply bg-gray-100 in normal mode and dark:bg-gray-800 in dark mode when input has value
      !(disabled || isLoading) && hasValue && 'bg-gray-50 dark:bg-gray-800!',
      // Default background when no value
      !(disabled || isLoading) && !hasValue && 'bg-white dark:bg-gray-900',
      // Text colors
      !(disabled || isLoading) && 'text-gray-900 dark:text-gray-100'
    );
    
    return (
      <div className={clsx('relative', fullWidth && 'w-full')}>
        {leftIcon && <div className="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400">{leftIcon}</div>}
        <input
          id={inputId}
          ref={setRefs}
          type={type}
          className={inputClasses}
          disabled={disabled || isLoading}
          value={value as any}
          onChange={(e) => {
            setLiveHasValue(e.currentTarget.value.length > 0);
            props.onChange?.(e);
          }}
          aria-invalid={!!error}
          {...props}
        />
        {shouldShowClear && (
          <button type="button" onClick={handleClear} className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
            <FiX />
          </button>
        )}
        {error && <p className="mt-1.5 text-sm text-red-600">{error}</p>}
      </div>
    );
  }
);

Input.displayName = 'Input';
export default Input;
```

<!-- path: hnvtx/components/common/ui/badges/RoleBadge.tsx -->
```typescript
// components/users/RoleBadge.tsx
import { UserRole } from "@/types/user-roles";

export const RoleBadge = ({ role }: { role: UserRole }) => {
  const getRoleConfig = (role: UserRole) => {
    switch (role) {
      case UserRole.ADMIN:
        return { 
          bg: "bg-gradient-to-r from-red-500/20 to-pink-500/20 dark:from-red-500/30 dark:to-pink-500/30", 
          text: "text-red-700 dark:text-red-300",
          border: "border-red-200/60 dark:border-red-500/40",
          shadow: "shadow-red-500/20 dark:shadow-red-500/30",
          icon: "👑"
        };
      case UserRole.MAANADMIN:
        return { 
          bg: "bg-gradient-to-r from-indigo-500/20 to-purple-500/20 dark:from-indigo-500/30 dark:to-purple-500/30", 
          text: "text-indigo-700 dark:text-indigo-300",
          border: "border-indigo-200/60 dark:border-indigo-500/40",
          shadow: "shadow-indigo-500/20 dark:shadow-indigo-500/30",
          icon: "⭐"
        };
      case UserRole.SDHADMIN:
        return { 
          bg: "bg-gradient-to-r from-emerald-500/20 to-teal-500/20 dark:from-emerald-500/30 dark:to-teal-500/30", 
          text: "text-emerald-700 dark:text-emerald-300",
          border: "border-emerald-200/60 dark:border-emerald-500/40",
          shadow: "shadow-emerald-500/20 dark:shadow-emerald-500/30",
          icon: "🚀"
        };
      case UserRole.VMUXADMIN:
        return { 
          bg: "bg-gradient-to-r from-slate-500/20 to-gray-500/20 dark:from-slate-500/30 dark:to-gray-500/30", 
          text: "text-slate-700 dark:text-slate-300",
          border: "border-slate-200/60 dark:border-slate-500/40",
          shadow: "shadow-slate-500/20 dark:shadow-slate-500/30",
          icon: "⚙️"
        };
      case UserRole.MNGADMIN:
        return { 
          bg: "bg-gradient-to-r from-amber-500/20 to-orange-500/20 dark:from-amber-500/30 dark:to-orange-500/30", 
          text: "text-amber-700 dark:text-amber-300",
          border: "border-amber-200/60 dark:border-amber-500/40",
          shadow: "shadow-amber-500/20 dark:shadow-amber-500/30",
          icon: "📊"
        };
      case UserRole.VIEWER:
        return { 
          bg: "bg-gradient-to-r from-gray-400/15 to-slate-400/15 dark:from-gray-500/25 dark:to-slate-500/25", 
          text: "text-gray-600 dark:text-gray-400",
          border: "border-gray-200/50 dark:border-gray-600/40",
          shadow: "shadow-gray-500/10 dark:shadow-gray-500/20",
          icon: "👁️"
        };
      case UserRole.AUTHENTICATED:
        return { 
          bg: "bg-gradient-to-r from-sky-500/20 to-blue-500/20 dark:from-sky-500/30 dark:to-blue-500/30", 
          text: "text-sky-700 dark:text-sky-300",
          border: "border-sky-200/60 dark:border-sky-500/40",
          shadow: "shadow-sky-500/20 dark:shadow-sky-500/30",
          icon: "✅"
        };
      case UserRole.ANON:
        return { 
          bg: "bg-gradient-to-r from-zinc-400/15 to-stone-400/15 dark:from-zinc-500/25 dark:to-stone-500/25", 
          text: "text-zinc-600 dark:text-zinc-400",
          border: "border-zinc-200/50 dark:border-zinc-600/40",
          shadow: "shadow-zinc-500/10 dark:shadow-zinc-500/20",
          icon: "❓"
        };
      default:
        return { 
          bg: "bg-gradient-to-r from-neutral-400/15 to-gray-400/15 dark:from-neutral-500/25 dark:to-gray-500/25", 
          text: "text-neutral-600 dark:text-neutral-400",
          border: "border-neutral-200/50 dark:border-neutral-600/40",
          shadow: "shadow-neutral-500/10 dark:shadow-neutral-500/20",
          icon: "🔸"
        };
    }
  };

  const { bg, text, border, shadow, icon } = getRoleConfig(role);
  const displayText = role.replace("_", " ").toLowerCase().replace(/\b\w/g, l => l.toUpperCase());

  return (
    <span
      className={`
        inline-flex items-center gap-1.5 px-3 py-1.5 
        rounded-full text-xs font-semibold tracking-wide
        border backdrop-blur-sm
        transition-all duration-300 ease-out
        hover:scale-105 hover:shadow-lg hover:-translate-y-0.5
        cursor-default select-none
        ${bg} ${text} ${border} ${shadow}
        dark:shadow-lg
      `}
    >
      <span className="text-[10px] leading-none" role="img" aria-hidden="true">
        {icon}
      </span>
      <span className="font-medium">
        {displayText}
      </span>
    </span>
  );
};

```

<!-- path: hnvtx/components/common/ui/badges/StatusBadge.tsx -->
```typescript
// components/users/StatusBadge.tsx

export const StatusBadge = ({ status }: { status: string | boolean | null }) => {
  const getStatusConfig = (status: string | boolean | null) => {
    // Handle null/undefined cases first
    if (status === null || status === undefined) {
      return { 
        bg: "bg-gradient-to-r from-gray-400/15 to-slate-400/15 dark:from-gray-500/25 dark:to-slate-500/25",
        text: "text-gray-600 dark:text-gray-400",
        border: "border-gray-200/50 dark:border-gray-600/40",
        shadow: "shadow-gray-500/10 dark:shadow-gray-500/20",
        dot: "bg-gray-500 dark:bg-gray-400",
        dotShadow: "shadow-gray-500/30",
        label: "Unknown",
        pulse: false
      };
    }

    // Handle boolean cases
    if (typeof status === 'boolean') {
      return status
        ? {
            bg: "bg-gradient-to-r from-green-500/20 to-emerald-500/20 dark:from-green-500/30 dark:to-emerald-500/30",
            text: "text-green-700 dark:text-green-300",
            border: "border-green-200/60 dark:border-green-500/40",
            shadow: "shadow-green-500/20 dark:shadow-green-500/30",
            dot: "bg-green-500 dark:bg-green-400",
            dotShadow: "shadow-green-500/40",
            label: "Active",
            pulse: true
          }
        : {
            bg: "bg-gradient-to-r from-red-500/20 to-rose-500/20 dark:from-red-500/30 dark:to-rose-500/30",
            text: "text-red-700 dark:text-red-300",
            border: "border-red-200/60 dark:border-red-500/40",
            shadow: "shadow-red-500/20 dark:shadow-red-500/30",
            dot: "bg-red-500 dark:bg-red-400",
            dotShadow: "shadow-red-500/40",
            label: "Inactive",
            pulse: false
          };
    }

    // Handle string cases
    switch (status.toLowerCase()) {
      case "active":
        return {
          bg: "bg-gradient-to-r from-green-500/20 to-emerald-500/20 dark:from-green-500/30 dark:to-emerald-500/30",
          text: "text-green-700 dark:text-green-300",
          border: "border-green-200/60 dark:border-green-500/40",
          shadow: "shadow-green-500/20 dark:shadow-green-500/30",
          dot: "bg-green-500 dark:bg-green-400",
          dotShadow: "shadow-green-500/40",
          label: "Active",
          pulse: true
        };
      case "inactive":
        return { 
          bg: "bg-gradient-to-r from-gray-400/15 to-slate-400/15 dark:from-gray-500/25 dark:to-slate-500/25",
          text: "text-gray-600 dark:text-gray-400",
          border: "border-gray-200/50 dark:border-gray-600/40",
          shadow: "shadow-gray-500/10 dark:shadow-gray-500/20",
          dot: "bg-gray-500 dark:bg-gray-400",
          dotShadow: "shadow-gray-500/30",
          label: "Inactive",
          pulse: false
        };
      case "suspended":
        return { 
          bg: "bg-gradient-to-r from-red-500/20 to-orange-500/20 dark:from-red-500/30 dark:to-orange-500/30",
          text: "text-red-700 dark:text-red-300",
          border: "border-red-200/60 dark:border-red-500/40",
          shadow: "shadow-red-500/20 dark:shadow-red-500/30",
          dot: "bg-red-500 dark:bg-red-400",
          dotShadow: "shadow-red-500/40",
          label: "Suspended",
          pulse: false
        };
      case "pending":
        return {
          bg: "bg-gradient-to-r from-amber-500/20 to-yellow-500/20 dark:from-amber-500/30 dark:to-yellow-500/30",
          text: "text-amber-700 dark:text-amber-300",
          border: "border-amber-200/60 dark:border-amber-500/40",
          shadow: "shadow-amber-500/20 dark:shadow-amber-500/30",
          dot: "bg-amber-500 dark:bg-amber-400",
          dotShadow: "shadow-amber-500/40",
          label: "Pending",
          pulse: true
        };
      case "verified":
        return {
          bg: "bg-gradient-to-r from-blue-500/20 to-cyan-500/20 dark:from-blue-500/30 dark:to-cyan-500/30",
          text: "text-blue-700 dark:text-blue-300",
          border: "border-blue-200/60 dark:border-blue-500/40",
          shadow: "shadow-blue-500/20 dark:shadow-blue-500/30",
          dot: "bg-blue-500 dark:bg-blue-400",
          dotShadow: "shadow-blue-500/40",
          label: "Verified",
          pulse: false
        };
      case "banned":
        return {
          bg: "bg-gradient-to-r from-red-600/25 to-red-800/25 dark:from-red-600/35 dark:to-red-800/35",
          text: "text-red-800 dark:text-red-200",
          border: "border-red-300/70 dark:border-red-400/50",
          shadow: "shadow-red-600/25 dark:shadow-red-600/35",
          dot: "bg-red-600 dark:bg-red-500",
          dotShadow: "shadow-red-600/50",
          label: "Banned",
          pulse: false
        };
      case "online":
        return {
          bg: "bg-gradient-to-r from-green-400/25 to-green-600/25 dark:from-green-400/35 dark:to-green-600/35",
          text: "text-green-800 dark:text-green-200",
          border: "border-green-300/70 dark:border-green-400/50",
          shadow: "shadow-green-500/25 dark:shadow-green-500/35",
          dot: "bg-green-500 dark:bg-green-400",
          dotShadow: "shadow-green-500/50",
          label: "Online",
          pulse: true
        };
      case "offline":
        return {
          bg: "bg-gradient-to-r from-slate-400/15 to-gray-500/15 dark:from-slate-500/25 dark:to-gray-600/25",
          text: "text-slate-600 dark:text-slate-400",
          border: "border-slate-200/50 dark:border-slate-600/40",
          shadow: "shadow-slate-500/10 dark:shadow-slate-500/20",
          dot: "bg-slate-500 dark:bg-slate-400",
          dotShadow: "shadow-slate-500/30",
          label: "Offline",
          pulse: false
        };
      default:
        return { 
          bg: "bg-gradient-to-r from-gray-400/15 to-slate-400/15 dark:from-gray-500/25 dark:to-slate-500/25",
          text: "text-gray-600 dark:text-gray-400",
          border: "border-gray-200/50 dark:border-gray-600/40",
          shadow: "shadow-gray-500/10 dark:shadow-gray-500/20",
          dot: "bg-gray-500 dark:bg-gray-400",
          dotShadow: "shadow-gray-500/30",
          label: typeof status === 'string' ? status.charAt(0).toUpperCase() + status.slice(1) : "Unknown",
          pulse: false
        };
    }
  };

  const config = getStatusConfig(status);

  return (
    <span
      className={`
        inline-flex items-center gap-2 px-3 py-1.5
        rounded-full text-xs font-semibold tracking-wide
        border backdrop-blur-sm
        transition-all duration-300 ease-out
        hover:scale-105 hover:shadow-lg hover:-translate-y-0.5
        cursor-default select-none
        ${config.bg} ${config.text} ${config.border} ${config.shadow}
        dark:shadow-lg
      `}
    >
      <span 
        className={`
          relative w-2 h-2 rounded-full shadow-sm
          ${config.dot} ${config.dotShadow}
          ${config.pulse ? 'animate-pulse' : ''}
        `}
      >
        {config.pulse && (
          <span 
            className={`
              absolute inset-0 w-2 h-2 rounded-full opacity-75
              animate-ping
              ${config.dot}
            `}
          />
        )}
      </span>
      <span className="font-medium">
        {config.label}
      </span>
    </span>
  );
};
```

<!-- path: hnvtx/components/common/ui/Modal/index.ts -->
```typescript
// Base Modal Component
export { Modal } from './Modal';

// Confirm Modal Components
export { ConfirmModal, useConfirmModal } from './confirmModal';

// ChangePasswordModal Components
export { ChangePasswordModal } from './ChangePasswordModal';

```

<!-- path: hnvtx/components/common/ui/Modal/Modal.tsx -->
```typescript
import { AnimatePresence, motion } from "framer-motion";
import { type ReactNode, useEffect } from "react";
import { IoClose } from "react-icons/io5";
import { cn } from "@/utils/classNames";

interface ModalProps {
  isOpen: boolean;
  onClose: () => void;
  title?: string;
  children: ReactNode;
  size?: "sm" | "md" | "lg" | "xl" | "full";
  showCloseButton?: boolean;
  closeOnOverlayClick?: boolean;
  closeOnEscape?: boolean;
  className?: string;
  visible?: boolean;
}

export const Modal = ({
  isOpen,
  onClose,
  title,
  children,
  size = "md",
  showCloseButton = true,
  closeOnOverlayClick = true,
  closeOnEscape = true,
  className,
  visible = true,
}: ModalProps) => {
  // Handle escape key
  useEffect(() => {
    if (!closeOnEscape || !isOpen) return;

    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === "Escape") {
        onClose();
      }
    };

    document.addEventListener("keydown", handleEscape);
    return () => document.removeEventListener("keydown", handleEscape);
  }, [isOpen, closeOnEscape, onClose]);

  // Prevent body scroll when modal is open
  useEffect(() => {
    if (isOpen) {
      document.body.style.overflow = "hidden";
    } else {
      document.body.style.overflow = "unset";
    }

    return () => {
      document.body.style.overflow = "unset";
    };
  }, [isOpen]);

  const sizeClasses = {
    sm: "max-w-md",
    md: "max-w-lg",
    lg: "max-w-2xl",
    xl: "max-w-4xl",
    full: "max-w-[95vw] max-h-[95vh]",
  };

  const handleOverlayClick = (e: React.MouseEvent) => {
    if (closeOnOverlayClick && e.target === e.currentTarget) {
      onClose();
    }
  };

  return (
    <AnimatePresence>
      {isOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          {/* Backdrop */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="absolute inset-0 bg-black/50 backdrop-blur-sm"
            onClick={handleOverlayClick}
          />

          {/* Modal */}
          <motion.div
            initial={{ opacity: 0, scale: 0.95, y: 20 }}
            animate={{ opacity: 1, scale: 1, y: 0 }}
            exit={{ opacity: 0, scale: 0.95, y: 20 }}
            transition={{ type: "spring", duration: 0.3 }}
            className={cn(
              "relative max-h-screen w-full overflow-y-auto rounded-lg bg-white shadow-xl",
              "dark:bg-gray-900 dark:border dark:border-gray-700 dark:shadow-lg dark:shadow-gray-900/50",
              sizeClasses[size],
              className,
            )}
          >
            {/* Header */}
            {(title || showCloseButton) && visible && (
              <div className="flex items-center justify-between border-b border-gray-200 p-6">
                {title && (
                  <h2 className="text-xl font-semibold text-gray-900">
                    {title}
                  </h2>
                )}
                {showCloseButton && (
                  <button
                    onClick={onClose}
                    className="rounded-full p-2 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600"
                    aria-label="Close modal"
                  >
                    <IoClose size={20} />
                  </button>
                )}
              </div>
            )}

            {/* Content */}
            <div className="p-6">{children}</div>
          </motion.div>
        </div>
      )}
    </AnimatePresence>
  );
};

```

<!-- path: hnvtx/components/common/ui/Modal/DtailsModal.tsx -->
```typescript
import { motion, AnimatePresence } from "framer-motion";
import { FiX } from "react-icons/fi";
import Image from "next/image";
import { Modal } from "@/components/common/ui";
import { CardSpinner } from "@/components/common/ui/LoadingSpinner";
import { ReactNode } from "react";

// Generic field configuration interface
interface FieldConfig {
  key: string;
  label: string;
  icon?: ReactNode;
  formatter?: (value: any) => ReactNode;
  condition?: (data: any) => boolean;
  className?: string;
}

// Section configuration interface
interface SectionConfig {
  title: string;
  icon?: ReactNode;
  fields: FieldConfig[];
  condition?: (data: any) => boolean;
  className?: string;
  renderCustom?: (data: any) => ReactNode;
}

// Header configuration interface
interface HeaderConfig {
  title: (data: any) => string;
  subtitle?: (data: any) => string;
  avatar?: {
    urlKey: string;
    fallbackText: (data: any) => string;
  };
  badges?: Array<{
    key: string;
    component: (value: any) => ReactNode;
  }>;
}

// Main props interface
interface DetailsModalProps<T = any> {
  data: T | null;
  onClose: () => void;
  isOpen: boolean;
  config: {
    header: HeaderConfig;
    sections: SectionConfig[];
  };
  loading?: boolean;
  className?: string;
}

// Default formatters
const defaultFormatters = {
  date: (dateString: string | null | undefined) => {
    if (!dateString) return "Not provided";
    try {
      return new Date(dateString).toLocaleDateString("en-US", {
        year: "numeric",
        month: "long",
        day: "numeric",
      });
    } catch {
      return "Invalid date";
    }
  },
  
  dateTime: (dateString: string | null | undefined) => {
    if (!dateString) return "Never";
    try {
      return new Date(dateString).toLocaleString("en-US", {
        year: "numeric",
        month: "short",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
      });
    } catch {
      return "Invalid date";
    }
  },
  
  address: (address: any) => {
    if (!address || typeof address !== 'object') return null;
    const parts = [
      address.street,
      address.city,
      address.state,
      address.zip_code || address.zipCode,
      address.country,
    ].filter(Boolean);
    return parts.length > 0 ? parts.join(", ") : null;
  },
  
  json: (value: any) => {
    if (!value) return "Not provided";
    return (
      <pre className="text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap font-mono leading-relaxed overflow-x-auto">
        {JSON.stringify(value, null, 2)}
      </pre>
    );
  },
  
  boolean: (value: boolean) => (
    <span
      className={`text-xs px-3 py-1 rounded-full font-semibold ${
        value
          ? "bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"
          : "bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"
      }`}
    >
      {value ? "✓ Yes" : "✗ No"}
    </span>
  ),
  
  email: (email: string, isVerified?: boolean) => (
    <div className="flex items-center justify-between">
      <span className="text-gray-900 dark:text-white font-medium flex-1">{email}</span>
      {typeof isVerified === 'boolean' && (
        <span
          className={`text-xs px-3 py-1 rounded-full font-semibold ml-3 ${
            isVerified
              ? "bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"
              : "bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"
          }`}
        >
          {isVerified ? "✓ Verified" : "✗ Unverified"}
        </span>
      )}
    </div>
  )
};

// Helper function to get nested value
const getNestedValue = (obj: any, key: string): any => {
  return key.split('.').reduce((current, prop) => current?.[prop], obj);
};

const DetailsModal = <T extends Record<string, any>>({
  data,
  onClose,
  isOpen,
  config,
  loading = false,
  className = ""
}: DetailsModalProps<T>) => {
  const containerVariants = {
    hidden: { opacity: 0 },
    visible: { 
      opacity: 1,
      transition: {
        duration: 0.3,
        staggerChildren: 0.1
      }
    },
    exit: { 
      opacity: 0,
      transition: {
        duration: 0.2
      }
    }
  };

  const modalVariants = {
    hidden: { 
      opacity: 0, 
      scale: 0.8,
      y: 50
    },
    visible: { 
      opacity: 1, 
      scale: 1,
      y: 0,
      transition: {
        type: "spring" as const,
        damping: 25,
        stiffness: 300
      }
    },
    exit: { 
      opacity: 0, 
      scale: 0.9,
      y: 30,
      transition: {
        duration: 0.2
      }
    }
  };

  const sectionVariants = {
    hidden: { opacity: 0, y: 20 },
    visible: { 
      opacity: 1, 
      y: 0,
      transition: {
        duration: 0.4,
        ease: "easeOut" as const
      }
    }
  };

  const fieldVariants = {
    hidden: { opacity: 0, x: -10 },
    visible: { 
      opacity: 1, 
      x: 0,
      transition: {
        duration: 0.3
      }
    }
  };

  const renderField = (field: FieldConfig, data: T) => {
    if (field.condition && !field.condition(data)) return null;
    
    const value = getNestedValue(data, field.key);
    const formattedValue = field.formatter ? field.formatter(value) : (value || "Not provided");

    return (
      <motion.div
        key={field.key}
        className={`group ${field.className || ""}`}
        variants={fieldVariants}
        whileHover={{ x: 4 }}
        transition={{ type: "spring", stiffness: 300 }}
      >
        <label className="text-sm font-semibold text-gray-500 dark:text-gray-400 block mb-2 uppercase tracking-wider">
          {field.label}
        </label>
        <div className="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 group-hover:border-blue-300 dark:group-hover:border-blue-600 transition-colors">
          <div className="flex items-center gap-3">
            {field.icon && (
              <div className="text-gray-400 flex-shrink-0">
                {field.icon}
              </div>
            )}
            <div className="flex-1">
              {typeof formattedValue === 'string' ? (
                <p className="text-gray-900 dark:text-white font-medium">{formattedValue}</p>
              ) : (
                formattedValue
              )}
            </div>
          </div>
        </div>
      </motion.div>
    );
  };

  const renderSection = (section: SectionConfig, data: T) => {
    if (section.condition && !section.condition(data)) return null;

    return (
      <motion.div
        key={section.title}
        className={`space-y-6 ${section.className || ""}`}
        variants={sectionVariants}
      >
        <div className="flex items-center gap-3 pb-3 border-b border-gray-200 dark:border-gray-700">
          {section.icon && (
            <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
              {section.icon}
            </div>
          )}
          <h3 className="text-xl font-semibold text-gray-900 dark:text-white">
            {section.title}
          </h3>
        </div>

        {section.renderCustom ? (
          section.renderCustom(data)
        ) : (
          <div className="space-y-5">
            {section.fields.map(field => renderField(field, data))}
          </div>
        )}
      </motion.div>
    );
  };

  const renderHeader = (data: T) => {
    const { header } = config;
    const title = header.title(data);
    const subtitle = header.subtitle ? header.subtitle(data) : null;

    return (
      <div className="relative px-8 py-6 bg-gradient-to-r from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-800 dark:via-gray-850 dark:to-gray-900 border-b border-gray-200/50 dark:border-gray-700/50">
        <div className="flex items-center justify-between">
          <motion.div 
            className="flex items-center gap-4"
            variants={fieldVariants}
          >
            {header.avatar && (
              <motion.div 
                className="flex-shrink-0 relative"
                whileHover={{ scale: 1.05 }}
                transition={{ type: "spring", stiffness: 300 }}
              >
                {getNestedValue(data, header.avatar.urlKey) ? (
                  <div className="relative">
                    <Image
                      className="h-16 w-16 rounded-full object-cover border-4 border-white shadow-lg ring-2 ring-blue-500/20"
                      src={getNestedValue(data, header.avatar.urlKey)}
                      alt={title}
                      width={64}
                      height={64}
                      onError={(e) => {
                        e.currentTarget.style.display = "none";
                        e.currentTarget.nextElementSibling?.classList.remove("hidden");
                      }}
                    />
                    <div className="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 border-2 border-white rounded-full"></div>
                  </div>
                ) : null}
                <div
                  className={`h-16 w-16 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg ring-2 ring-blue-500/20 ${
                    getNestedValue(data, header.avatar.urlKey) ? "hidden" : ""
                  }`}
                >
                  <span className="text-xl font-bold text-white">
                    {header.avatar.fallbackText(data)}
                  </span>
                  <div className="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 border-2 border-white rounded-full"></div>
                </div>
              </motion.div>
            )}
            <div className="space-y-1">
              <motion.h2 
                className="text-2xl font-bold text-gray-900 dark:text-white"
                variants={fieldVariants}
              >
                {title}
              </motion.h2>
              {subtitle && (
                <motion.p 
                  className="text-gray-600 dark:text-gray-300 font-medium"
                  variants={fieldVariants}
                >
                  {subtitle}
                </motion.p>
              )}
              {header.badges && (
                <motion.div 
                  className="flex items-center gap-2 flex-wrap"
                  variants={fieldVariants}
                >
                  {header.badges.map((badge, index) => (
                    <div key={`${badge.key}-${index}`}>
                      {badge.component(getNestedValue(data, badge.key))}
                    </div>
                  ))}
                </motion.div>
              )}
            </div>
          </motion.div>
          <motion.button
            onClick={onClose}
            className="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 p-3 rounded-xl hover:bg-white/50 dark:hover:bg-gray-800/50 transition-all duration-200 backdrop-blur-sm"
            aria-label="Close modal"
            whileHover={{ scale: 1.1, rotate: 90 }}
            whileTap={{ scale: 0.95 }}
            transition={{ type: "spring", stiffness: 300 }}
          >
            <FiX size={24} />
          </motion.button>
        </div>
      </div>
    );
  };

  return (
    <AnimatePresence mode="wait">
      {isOpen && (
        <Modal isOpen={isOpen} onClose={onClose}>
          {loading ? (
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50"
            >
              <CardSpinner />
            </motion.div>
          ) : data ? (
            <motion.div
              variants={containerVariants}
              initial="hidden"
              animate="visible"
              exit="exit"
              className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4"
            >
              <motion.div
                variants={modalVariants}
                className={`bg-white dark:bg-gray-900 rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden border border-gray-200/50 dark:border-gray-700/50 ${className}`}
              >
                {renderHeader(data)}
                
                <div className="p-8 overflow-y-auto max-h-[calc(90vh-160px)] custom-scrollbar">
                  <div className="grid grid-cols-1 xl:grid-cols-2 gap-8">
                    {config.sections.map(section => renderSection(section, data))}
                  </div>
                </div>
              </motion.div>
            </motion.div>
          ) : null}
        </Modal>
      )}
    </AnimatePresence>
  );
};

// Export the component and formatters for reuse
export { DetailsModal, defaultFormatters, type FieldConfig, type SectionConfig, type HeaderConfig, type DetailsModalProps };
```

<!-- path: hnvtx/components/common/ui/Modal/confirmModal.tsx -->
```typescript
import React, { useState, useEffect, useCallback, useRef } from 'react';

// Icon components with proper TypeScript support
interface IconProps {
  className?: string;
}

const icons = {
  Warning: ({ className = "w-6 h-6" }: IconProps) => (
    <svg className={className} fill="currentColor" viewBox="0 0 20 20">
      <path fillRule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
    </svg>
  ),
  Close: ({ className = "w-5 h-5" }: IconProps) => (
    <svg className={className} fill="currentColor" viewBox="0 0 20 20">
      <path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd" />
    </svg>
  ),
  Check: ({ className = "w-6 h-6" }: IconProps) => (
    <svg className={className} fill="currentColor" viewBox="0 0 20 20">
      <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
    </svg>
  ),
  Error: ({ className = "w-6 h-6" }: IconProps) => (
    <svg className={className} fill="currentColor" viewBox="0 0 20 20">
      <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
    </svg>
  ),
  Info: ({ className = "w-6 h-6" }: IconProps) => (
    <svg className={className} fill="currentColor" viewBox="0 0 20 20">
      <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clipRule="evenodd" />
    </svg>
  ),
  Help: ({ className = "w-6 h-6" }: IconProps) => (
    <svg className={className} fill="currentColor" viewBox="0 0 20 20">
      <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clipRule="evenodd" />
    </svg>
  ),
};

type ModalType = 'default' | 'danger' | 'warning' | 'info' | 'success';

interface ConfirmModalProps {
  isOpen: boolean;
  onConfirm: () => void | Promise<void>;
  onCancel: () => void;
  title?: string;
  message?: string | React.ReactNode;
  confirmText?: string;
  cancelText?: string;
  type?: ModalType;
  showIcon?: boolean;
  closeOnBackdrop?: boolean;
  closeOnEscape?: boolean;
  loading?: boolean;
  size?: 'sm' | 'md' | 'lg';
  className?: string;
  confirmButtonProps?: React.ButtonHTMLAttributes<HTMLButtonElement>;
  cancelButtonProps?: React.ButtonHTMLAttributes<HTMLButtonElement>;
}

const LoadingSpinner: React.FC<{ size?: 'sm' | 'md' }> = ({ size = 'md' }) => (
  <div
    className={`border-2 border-current border-t-transparent rounded-full animate-spin ${
      size === 'sm' ? 'w-4 h-4' : 'w-5 h-5'
    }`}
    aria-hidden="true"
  />
);

export const ConfirmModal: React.FC<ConfirmModalProps> = ({
  isOpen,
  onConfirm,
  onCancel,
  title = 'Confirm Action',
  message = 'Are you sure you want to proceed?',
  confirmText = 'Confirm',
  cancelText = 'Cancel',
  type = 'default',
  showIcon = true,
  closeOnBackdrop = true,
  closeOnEscape = true,
  loading = false,
  size = 'md',
  className,
  confirmButtonProps = {},
  cancelButtonProps = {},
}) => {
  const [isVisible, setIsVisible] = useState(false);
  const [isAnimating, setIsAnimating] = useState(false);
  const modalRef = useRef<HTMLDivElement>(null);
  const confirmButtonRef = useRef<HTMLButtonElement>(null);
  const cancelButtonRef = useRef<HTMLButtonElement>(null);
  const previousActiveElement = useRef<HTMLElement | null>(null);

  // Handle modal opening/closing
  useEffect(() => {
    if (isOpen) {
      // Store previously focused element
      previousActiveElement.current = document.activeElement as HTMLElement;
      
      setIsVisible(true);
      // Use requestAnimationFrame for smoother animations
      requestAnimationFrame(() => {
        setIsAnimating(true);
      });

      // Prevent body scroll
      document.body.style.overflow = 'hidden';
      document.body.style.paddingRight = `${window.innerWidth - document.documentElement.clientWidth}px`;
    } else {
      setIsAnimating(false);
      const timer = setTimeout(() => {
        setIsVisible(false);
        // Restore body scroll
        document.body.style.overflow = '';
        document.body.style.paddingRight = '';
        
        // Restore focus to previously active element
        if (previousActiveElement.current) {
          previousActiveElement.current.focus();
        }
      }, 200);

      return () => clearTimeout(timer);
    }
  }, [isOpen]);

  // Handle escape key
  const handleKeyDown = useCallback(
    (e: KeyboardEvent) => {
      if (!isOpen) return;

      if (e.key === 'Escape' && closeOnEscape && !loading) {
        onCancel();
        return;
      }

      // Handle tab navigation within modal
      if (e.key === 'Tab') {
        const focusableElements = modalRef.current?.querySelectorAll(
          'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        );

        if (!focusableElements?.length) return;

        const firstElement = focusableElements[0] as HTMLElement;
        const lastElement = focusableElements[focusableElements.length - 1] as HTMLElement;

        if (e.shiftKey) {
          // Shift + Tab
          if (document.activeElement === firstElement) {
            e.preventDefault();
            lastElement.focus();
          }
        } else {
          // Tab
          if (document.activeElement === lastElement) {
            e.preventDefault();
            firstElement.focus();
          }
        }
      }
    },
    [isOpen, closeOnEscape, loading, onCancel]
  );

  useEffect(() => {
    document.addEventListener('keydown', handleKeyDown);
    return () => document.removeEventListener('keydown', handleKeyDown);
  }, [handleKeyDown]);

  // Focus management
  useEffect(() => {
    if (isOpen && isAnimating) {
      // Focus the cancel button by default (safer option)
      setTimeout(() => {
        cancelButtonRef.current?.focus();
      }, 100);
    }
  }, [isOpen, isAnimating]);

  const handleBackdropClick = (e: React.MouseEvent) => {
    if (e.target === e.currentTarget && closeOnBackdrop && !loading) {
      onCancel();
    }
  };

  const handleConfirm = async () => {
    if (loading) return;
    
    try {
      await onConfirm();
    } catch (error) {
      console.error('Confirm action failed:', error);
    }
  };

  const getIcon = () => {
    const className = `w-6 h-6 ${getIconColor()}`;
    
    switch (type) {
      case 'danger':
        return <icons.Error className={className} />;
      case 'warning':
        return <icons.Warning className={className} />;
      case 'info':
        return <icons.Info className={className} />;
      case 'success':
        return <icons.Check className={className} />;
      default:
        return <icons.Help className={className} />;
    }
  };

  const getIconColor = () => {
    switch (type) {
      case 'danger':
        return 'text-red-500 dark:text-red-400';
      case 'warning':
        return 'text-yellow-500 dark:text-yellow-400';
      case 'info':
        return 'text-blue-500 dark:text-blue-400';
      case 'success':
        return 'text-green-500 dark:text-green-400';
      default:
        return 'text-gray-500 dark:text-gray-400';
    }
  };

  const getButtonStyles = () => {
    const baseConfirm = 'text-white font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed';
    const baseCancel = 'font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed';

    switch (type) {
      case 'danger':
        return {
          confirm: `${baseConfirm} bg-red-600 hover:bg-red-700 focus:ring-red-500 active:bg-red-800 dark:bg-red-700 dark:hover:bg-red-800 dark:focus:ring-red-600 dark:active:bg-red-900`,
          cancel: `${baseCancel} bg-gray-100 hover:bg-gray-200 text-gray-900 focus:ring-gray-500 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-100 dark:focus:ring-gray-500`,
        };
      case 'warning':
        return {
          confirm: `${baseConfirm} bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500 active:bg-yellow-800 dark:bg-yellow-700 dark:hover:bg-yellow-800 dark:focus:ring-yellow-600 dark:active:bg-yellow-900`,
          cancel: `${baseCancel} bg-gray-100 hover:bg-gray-200 text-gray-900 focus:ring-gray-500 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-100 dark:focus:ring-gray-500`,
        };
      case 'success':
        return {
          confirm: `${baseConfirm} bg-green-600 hover:bg-green-700 focus:ring-green-500 active:bg-green-800 dark:bg-green-700 dark:hover:bg-green-800 dark:focus:ring-green-600 dark:active:bg-green-900`,
          cancel: `${baseCancel} bg-gray-100 hover:bg-gray-200 text-gray-900 focus:ring-gray-500 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-100 dark:focus:ring-gray-500`,
        };
      case 'info':
        return {
          confirm: `${baseConfirm} bg-blue-600 hover:bg-blue-700 focus:ring-blue-500 active:bg-blue-800 dark:bg-blue-700 dark:hover:bg-blue-800 dark:focus:ring-blue-600 dark:active:bg-blue-900`,
          cancel: `${baseCancel} bg-gray-100 hover:bg-gray-200 text-gray-900 focus:ring-gray-500 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-100 dark:focus:ring-gray-500`,
        };
      default:
        return {
          confirm: `${baseConfirm} bg-gray-900 hover:bg-gray-800 focus:ring-gray-700 active:bg-gray-950 dark:bg-gray-800 dark:hover:bg-gray-700 dark:focus:ring-gray-600 dark:active:bg-gray-900`,
          cancel: `${baseCancel} bg-gray-100 hover:bg-gray-200 text-gray-900 focus:ring-gray-500 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-100 dark:focus:ring-gray-500`,
        };
    }
  };

  const getSizeClasses = () => {
    switch (size) {
      case 'sm':
        return 'max-w-sm';
      case 'lg':
        return 'max-w-lg';
      default:
        return 'max-w-md';
    }
  };

  const buttonStyles = getButtonStyles();

  if (!isVisible) return null;

  return (
    <div
      className={`fixed inset-0 z-50 flex items-center justify-center p-4 transition-all duration-200 ${
        isAnimating ? 'bg-black/50 dark:bg-black/70 backdrop-blur-sm' : 'bg-black/0'
      }`}
      onClick={handleBackdropClick}
      role="presentation"
    >
      <div
        ref={modalRef}
        className={`bg-white dark:bg-gray-900 rounded-xl shadow-2xl w-full transform transition-all duration-200 ${getSizeClasses()} ${
          isAnimating ? 'scale-100 opacity-100 translate-y-0' : 'scale-95 opacity-0 translate-y-4'
        } ${className || ''}`}
        role="dialog"
        aria-modal="true"
        aria-labelledby="modal-title"
        aria-describedby="modal-description"
      >
        {/* Header */}
        <div className="px-6 py-5 border-b border-gray-200 dark:border-gray-700">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-3">
              {showIcon && (
                <div className="flex-shrink-0" aria-hidden="true">
                  {getIcon()}
                </div>
              )}
              <h3 
                id="modal-title" 
                className="text-lg font-semibold text-gray-900 dark:text-gray-100 leading-6"
              >
                {title}
              </h3>
            </div>
            <button
              onClick={onCancel}
              disabled={loading}
              className="flex-shrink-0 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed"
              aria-label="Close modal"
              type="button"
            >
              <icons.Close />
            </button>
          </div>
        </div>

        {/* Body */}
        <div className="px-6 py-5">
          <div id="modal-description" className="text-gray-600 dark:text-gray-300 leading-relaxed">
            {typeof message === 'string' ? (
              <p>{message}</p>
            ) : (
              message
            )}
          </div>
        </div>

        {/* Footer */}
        <div className="px-6 py-4 bg-gray-50 dark:bg-gray-800 rounded-b-xl flex justify-end space-x-3">
          <button
            ref={cancelButtonRef}
            onClick={onCancel}
            disabled={loading}
            className={`px-5 py-2.5 rounded-lg ${buttonStyles.cancel}`}
            type="button"
            {...cancelButtonProps}
          >
            {cancelText}
          </button>
          <button
            ref={confirmButtonRef}
            onClick={handleConfirm}
            disabled={loading}
            className={`px-5 py-2.5 rounded-lg ${buttonStyles.confirm} ${
              loading ? 'cursor-wait' : ''
            }`}
            type="button"
            {...confirmButtonProps}
          >
            {loading ? (
              <div className="flex items-center space-x-2" aria-label="Loading">
                <LoadingSpinner size="sm" />
                <span>Loading...</span>
              </div>
            ) : (
              confirmText
            )}
          </button>
        </div>
      </div>
    </div>
  );
};

// Hook for easier modal management
export const useConfirmModal = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [loading, setLoading] = useState(false);
  const resolveRef = useRef<((value: boolean) => void) | null>(null);

  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  const confirm = useCallback((options?: Partial<ConfirmModalProps>): Promise<boolean> => {
    return new Promise((resolve) => {
      resolveRef.current = resolve;
      setIsOpen(true);
    });
  }, []);

  const handleConfirm = useCallback(async () => {
    if (resolveRef.current) {
      resolveRef.current(true);
      resolveRef.current = null;
    }
    setIsOpen(false);
    setLoading(false);
  }, []);

  const handleCancel = useCallback(() => {
    if (resolveRef.current) {
      resolveRef.current(false);
      resolveRef.current = null;
    }
    setIsOpen(false);
    setLoading(false);
  }, []);

  return {
    isOpen,
    loading,
    setLoading,
    confirm,
    handleConfirm,
    handleCancel,
  };
};

// Demo component
export const ConfirmModalDemo: React.FC = () => {
  const [modals, setModals] = useState({
    default: false,
    danger: false,
    warning: false,
    info: false,
    success: false,
    loading: false,
  });
  const [isLoading, setIsLoading] = useState(false);

  const openModal = (type: keyof typeof modals) => {
    setModals(prev => ({ ...prev, [type]: true }));
  };

  const closeModal = (type: keyof typeof modals) => {
    setModals(prev => ({ ...prev, [type]: false }));
    setIsLoading(false);
  };

  const handleConfirm = async (type: keyof typeof modals) => {
    if (type === 'loading') {
      setIsLoading(true);
      // Simulate async operation
      await new Promise(resolve => setTimeout(resolve, 2000));
      closeModal(type);
      alert('Action completed!');
    } else {
      closeModal(type);
      alert(`${type} action confirmed!`);
    }
  };

  return (
    <div className="p-8 bg-gray-100 dark:bg-gray-900 min-h-screen">
      <div className="max-w-4xl mx-auto">
        <h1 className="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-8 text-center">
          Improved ConfirmModal Demo
        </h1>
        
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8">
          <h2 className="text-xl font-semibold mb-4 dark:text-gray-200">Modal Types</h2>
          <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
            {Object.keys(modals).map((type) => (
              <button
                key={type}
                onClick={() => openModal(type as keyof typeof modals)}
                className={`p-3 text-white rounded-md transition-colors font-medium ${
                  type === 'default' ? 'bg-gray-800 hover:bg-gray-900 dark:bg-gray-700 dark:hover:bg-gray-600' :
                  type === 'danger' ? 'bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800' :
                  type === 'warning' ? 'bg-yellow-600 hover:bg-yellow-700 dark:bg-yellow-700 dark:hover:bg-yellow-800' :
                  type === 'info' ? 'bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800' :
                  type === 'success' ? 'bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800' :
                  'bg-purple-600 hover:bg-purple-700 dark:bg-purple-700 dark:hover:bg-purple-800'
                }`}
              >
                {type.charAt(0).toUpperCase() + type.slice(1)} Modal
              </button>
            ))}
          </div>
        </div>

        {/* Modals */}
        <ConfirmModal
          isOpen={modals.default}
          onConfirm={() => handleConfirm('default')}
          onCancel={() => closeModal('default')}
          title="Confirm Action"
          message="This is a default confirmation modal. Are you sure you want to proceed?"
        />

        <ConfirmModal
          isOpen={modals.danger}
          onConfirm={() => handleConfirm('danger')}
          onCancel={() => closeModal('danger')}
          title="Delete Item"
          message="This action cannot be undone. Are you sure you want to delete this item permanently?"
          confirmText="Delete"
          cancelText="Keep"
          type="danger"
        />

        <ConfirmModal
          isOpen={modals.warning}
          onConfirm={() => handleConfirm('warning')}
          onCancel={() => closeModal('warning')}
          title="Unsaved Changes"
          message="You have unsaved changes that will be lost. Do you want to continue without saving?"
          confirmText="Continue"
          cancelText="Save First"
          type="warning"
        />

        <ConfirmModal
          isOpen={modals.info}
          onConfirm={() => handleConfirm('info')}
          onCancel={() => closeModal('info')}
          title="Information Required"
          message="Before proceeding, please confirm that you have read and understood the terms and conditions."
          confirmText="I Understand"
          cancelText="Cancel"
          type="info"
        />

        <ConfirmModal
          isOpen={modals.success}
          onConfirm={() => handleConfirm('success')}
          onCancel={() => closeModal('success')}
          title="Complete Setup"
          message="Your account setup is almost complete. Would you like to finish the configuration now?"
          confirmText="Complete Setup"
          cancelText="Later"
          type="success"
        />

        <ConfirmModal
          isOpen={modals.loading}
          onConfirm={() => handleConfirm('loading')}
          onCancel={() => closeModal('loading')}
          title="Process Data"
          message="This will process all selected items. This action may take a few moments to complete."
          confirmText="Process"
          cancelText="Cancel"
          type="default"
          loading={isLoading}
        />
      </div>
    </div>
  );
};
```

<!-- path: hnvtx/components/common/ui/Modal/ChangePasswordModal.tsx -->
```typescript
// components/common/Modal/ChangePasswordModal.tsx
import { useState } from "react";
import { FiEye, FiEyeOff } from "react-icons/fi";
import { toast } from "sonner";
import { LoadingSpinner } from "../LoadingSpinner";
import { Modal } from "./Modal"; // Make sure your Modal component is correctly imported

// --- MODIFIED Type Definition ---
export interface ChangePasswordData {
  newPassword: string;
  // currentPassword is no longer needed for the API call
}

interface ChangePasswordModalProps {
  onClose: () => void;
  // This function signature now matches our store
  changePassword: (data: ChangePasswordData) => Promise<boolean>;
  isLoading: boolean;
  isOpen: boolean;
}

export const ChangePasswordModal = ({
  isOpen,
  onClose,
  changePassword,
  isLoading,
}: ChangePasswordModalProps) => {
  // --- REMOVED currentPassword state ---
  const [newPassword, setNewPassword] = useState("");
  const [confirmPassword, setConfirmPassword] = useState("");
  const [showNewPassword, setShowNewPassword] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (newPassword.length < 8) {
      toast.error("Password must be at least 8 characters long.");
      return;
    }
    if (newPassword !== confirmPassword) {
      toast.error("New passwords do not match.");
      return;
    }

    // --- MODIFIED: Call the function with the new data shape ---
    const success = await changePassword({ newPassword });

    if (success) {
      toast.success("Password updated successfully!");
      onClose();
    }
  };

  return (
    <Modal isOpen={isOpen} onClose={onClose}>
      <form onSubmit={handleSubmit} className="p-6">
        <div className="flex items-start justify-between">
          <h3 className="text-lg font-medium text-gray-900 dark:text-white">
            Change Password
          </h3>
        </div>
        <div className="mt-4 space-y-4">
          {/* --- REMOVED Current Password Input Block --- */}

          <div className="relative">
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">
              New Password
            </label>
            <input
              type={showNewPassword ? "text" : "password"}
              value={newPassword}
              onChange={(e) => setNewPassword(e.target.value)}
              required
              className="mt-1 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 shadow-sm focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
            />
            <button
              type="button"
              onClick={() => setShowNewPassword(!showNewPassword)}
              className="absolute right-0 bottom-2.5 flex items-center px-3 text-gray-400"
            >
              {showNewPassword ? <FiEyeOff /> : <FiEye />}
            </button>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">
              Confirm New Password
            </label>
            <input
              type={showNewPassword ? "text" : "password"}
              value={confirmPassword}
              onChange={(e) => setConfirmPassword(e.target.value)}
              required
              className="mt-1 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 shadow-sm focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
            />
          </div>
        </div>
        <div className="mt-6 flex justify-end space-x-3">
          <button
            type="button"
            onClick={onClose}
            className="rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700"
          >
            Cancel
          </button>
          <button
            type="submit"
            disabled={isLoading}
            className="inline-flex w-[120px] items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50"
          >
            {isLoading ? <LoadingSpinner size="sm" /> : "Save Changes"}
          </button>
        </div>
      </form>
    </Modal>
  );
};
```

<!-- path: hnvtx/components/common/ui/switch/Switch.tsx -->
```typescript
import { MouseEvent } from "react";
import { Label } from "@/components/common/ui/label/Label";

// Type definitions
type SwitchSize = "sm" | "md" | "lg";
type SwitchColor = "primary" | "secondary" | "success" | "danger" | "warning";

// Omit the onChange from ButtonHTMLAttributes since we're using our own
interface SwitchProps
  extends Omit<React.ButtonHTMLAttributes<HTMLButtonElement>, "onChange"> {
  checked?: boolean;
  onChange?: (checked: boolean) => void;
  disabled?: boolean;
  size?: SwitchSize;
  color?: SwitchColor;
  label?: string;
  labelPosition?: "left" | "right";
  id?: string;
  className?: string;
  showStatusText?: boolean;
  showIcons?: boolean;
}

// Color classes for light and dark modes
const colorClasses: Record<SwitchColor, { light: string; dark: string }> = {
  primary: {
    light: "bg-blue-600",
    dark: "bg-blue-500",
  },
  secondary: {
    light: "bg-gray-600",
    dark: "bg-gray-500",
  },
  success: {
    light: "bg-green-600",
    dark: "bg-green-500",
  },
  danger: {
    light: "bg-red-600",
    dark: "bg-red-500",
  },
  warning: {
    light: "bg-yellow-600",
    dark: "bg-yellow-500",
  },
};

// Switch Component
export const Switch: React.FC<SwitchProps> = ({
  checked = false,
  onChange = () => {},
  disabled = false,
  size = "md",
  color = "primary",
  label,
  labelPosition = "right",
  id,
  className = "",
  showStatusText = false,
  showIcons = false,
  ...props
}) => {
  // Size classes
  const sizeClasses: Record<SwitchSize, { container: string; thumb: string }> =
    {
      sm: {
        container: "h-5 w-9",
        thumb: "h-4 w-4",
      },
      md: {
        container: "h-6 w-11",
        thumb: "h-5 w-5",
      },
      lg: {
        container: "h-7 w-14",
        thumb: "h-6 w-6",
      },
    };

  // Position classes based on checked state
  const translateClasses: Record<SwitchSize, string> = {
    sm: checked ? "translate-x-4" : "translate-x-0",
    md: checked ? "translate-x-5" : "translate-x-0",
    lg: checked ? "translate-x-7" : "translate-x-0",
  };

  const handleClick = (event: MouseEvent<HTMLButtonElement>) => {
    event.preventDefault(); // Prevent form submission if inside a form
    if (!disabled) {
      onChange(!checked);
    }
  };

  return (
    <div className={`inline-flex items-center gap-3 ${className}`}>
      {label && labelPosition === "left" && (
        <Label
          id={id ? `${id}-label` : undefined}
          htmlFor={id}
          className={`${labelPosition === "left" ? "order-first" : ""} ${
            disabled ? "cursor-not-allowed" : "cursor-pointer"
          }`}
          disabled={disabled}
        >
          {label}
        </Label>
      )}

      <div className="flex items-center gap-2">
        {showStatusText && (
          <span
            className={`text-sm ${
              disabled
                ? "text-gray-400 dark:text-gray-500"
                : "text-gray-600 dark:text-gray-300"
            }`}
          >
            {checked ? "On" : "Off"}
          </span>
        )}

        <button
          type="button"
          role="switch"
          aria-checked={checked}
          aria-labelledby={label && id ? `${id}-label` : undefined}
          disabled={disabled}
          onClick={handleClick}
          className={`
            ${
              sizeClasses[size].container
            } relative inline-flex shrink-0 cursor-pointer rounded-full border-2 border-transparent 
            transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
            ${
              checked
                ? colorClasses[color].light
                : "bg-gray-200 dark:bg-gray-600"
            }
            ${disabled ? "opacity-50 cursor-not-allowed" : "hover:opacity-90"}
            dark:${checked ? colorClasses[color].dark : "bg-gray-600"}
          `}
          {...props}
        >
          <span
            className={`
              ${sizeClasses[size].thumb} ${translateClasses[size]} pointer-events-none 
              rounded-full bg-white shadow-lg transform ring-0 transition duration-200 ease-in-out
              flex items-center justify-center
            `}
          >
            {showIcons && (
              <>
                {checked ? (
                  <svg
                    className="h-3 w-3 text-blue-600 dark:text-blue-500"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      fillRule="evenodd"
                      d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                      clipRule="evenodd"
                    />
                  </svg>
                ) : (
                  <svg
                    className="h-3 w-3 text-gray-400 dark:text-gray-500"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      fillRule="evenodd"
                      d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                      clipRule="evenodd"
                    />
                  </svg>
                )}
              </>
            )}
          </span>
        </button>
      </div>

      {label && labelPosition === "right" && (
        <Label
          id={id ? `${id}-label` : undefined}
          htmlFor={id}
          className={`${disabled ? "cursor-not-allowed" : "cursor-pointer"}`}
          disabled={disabled}
        >
          {label}
        </Label>
      )}
    </div>
  );
};

// // Basic usage
// <Switch checked={isActive} onChange={setIsActive} />

// // With label on left
// <Switch 
//   label="Dark Mode" 
//   labelPosition="left" 
//   checked={darkMode} 
//   onChange={setDarkMode} 
// />

// // With color and status text
// <Switch
//   color="success"
//   showStatusText
//   checked={isEnabled}
//   onChange={setIsEnabled}
// />

// // With icons and custom size
// <Switch
//   size="lg"
//   showIcons
//   checked={notifications}
//   onChange={setNotifications}
// />

// // Disabled switch
// <Switch
//   disabled
//   label="Read-only"
//   checked={false}
// />

```

<!-- path: hnvtx/components/common/ui/theme/ThemeToggle.tsx -->
```typescript
"use client";

import { useThemeStore, Theme } from "@/stores/themeStore";
import { useState, useRef, useEffect } from "react";
import { FiChevronDown, FiMonitor, FiMoon, FiSun } from "react-icons/fi";

export default function ThemeToggle() {
  const { theme, setTheme, hydrated } = useThemeStore();
  const [isOpen, setIsOpen] = useState(false);
  const dropdownRef = useRef<HTMLDivElement>(null);
  const timeoutRef = useRef<NodeJS.Timeout | null>(null);

  const options = [
    { value: "light" as Theme, icon: <FiSun size={16} />, label: "Light" },
    { value: "dark" as Theme, icon: <FiMoon size={16} />, label: "Dark" },
    { value: "system" as Theme, icon: <FiMonitor size={16} />, label: "System" },
  ];

  const currentOption = options.find((opt) => opt.value === theme);

  useEffect(() => {
    return () => {
      if (timeoutRef.current) {
        clearTimeout(timeoutRef.current);
      }
    };
  }, []);

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (
        dropdownRef.current &&
        !dropdownRef.current.contains(event.target as Node)
      ) {
        setIsOpen(false);
      }
    };

    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  const handleMouseEnter = () => {
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }
    setIsOpen(true);
  };

  const handleMouseLeave = () => {
    timeoutRef.current = setTimeout(() => {
      setIsOpen(false);
    }, 300);
  };

  const handleOptionClick = (value: Theme) => {
    setTheme(value);
    setIsOpen(false);
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }
  };

  // Show loading state until hydrated
  if (!hydrated) {
    return (
      <div className="h-10 w-32 animate-pulse rounded-lg bg-gray-200 dark:bg-gray-700" />
    );
  }

  return (
    <div
      ref={dropdownRef}
      className="relative"
      onMouseEnter={handleMouseEnter}
      onMouseLeave={handleMouseLeave}
    >
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-2 rounded-lg bg-gray-200 px-3 py-2 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600"
        aria-expanded={isOpen}
      >
        {currentOption?.icon}
        <span className="text-sm">{currentOption?.label}</span>
        <FiChevronDown
          size={16}
          className={`transition-transform ${isOpen ? "rotate-180" : ""}`}
        />
      </button>

      {isOpen && (
        <div
          className="absolute z-10 mt-1 w-full rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-700 dark:bg-gray-800"
          onMouseEnter={handleMouseEnter}
          onMouseLeave={handleMouseLeave}
        >
          {options.map((opt) => (
            <button
              key={opt.value}
              onClick={() => handleOptionClick(opt.value)}
              className={`flex w-full items-center gap-2 px-3 py-2 text-left text-gray-700 dark:text-white ${
                theme === opt.value
                  ? "bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300"
                  : "hover:bg-gray-100 dark:hover:bg-gray-700"
              }`}
            >
              {opt.icon}
              <span>{opt.label}</span>
            </button>
          ))}
        </div>
      )}
    </div>
  );
}
```

<!-- path: hnvtx/components/common/ui/select/Select.tsx -->
```typescript
"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: "sm" | "default"
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive flex w-full items-center justify-between gap-2 rounded-md border px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        // Align with SearchableSelect visuals
        "bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500 focus-visible:ring-2 focus-visible:ring-blue-500",
        className
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  )
}

function SelectContent({
  className,
  children,
  position = "popper",
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-lg",
          // Align with SearchableSelect visuals
          "bg-white dark:bg-gray-700 text-gray-900 dark:text-white border-gray-300 dark:border-gray-600",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className
        )}
        position={position}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  )
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props}
    />
  )
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        // Disabled
        "data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
        // Base text colors
        "text-gray-900 dark:text-white [&_svg:not([class*='text-'])]:text-gray-400",
        // Hover/focus and selected states to mirror SearchableSelect
        "hover:bg-gray-100 dark:hover:bg-gray-600",
        "data-[highlighted]:bg-blue-100 dark:data-[highlighted]:bg-blue-900/50 data-[highlighted]:text-blue-900 dark:data-[highlighted]:text-blue-200",
        "data-[state=checked]:bg-blue-50 dark:data-[state=checked]:bg-blue-900/30 data-[state=checked]:text-blue-700 dark:data-[state=checked]:text-blue-300 font-medium",
        className
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  )
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  )
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  )
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
}

```

<!-- path: hnvtx/components/common/ui/select/SearchableSelect.tsx -->
```typescript
"use client";

import { useState, useRef, useEffect, useMemo, useLayoutEffect } from "react";
import { createPortal } from "react-dom";
import { FiChevronDown, FiX, FiSearch } from "react-icons/fi";

// The Option interface remains the same
interface Option {
  value: string;
  label: string;
  disabled?: boolean;
}

export type { Option };

// The props interface remains the same
interface SearchableSelectProps {
  options: Option[];
  value?: string;
  onChange: (value: string | null) => void;
  placeholder?: string;
  searchPlaceholder?: string;
  className?: string;
  disabled?: boolean;
  clearable?: boolean;
  maxHeight?: number;
  noOptionsMessage?: string;
  loading?: boolean;
  required?: boolean;
  error?: boolean;
  sortOptions?: boolean;
}

export const SearchableSelect: React.FC<SearchableSelectProps> = ({
  options = [],
  value = "",
  onChange,
  placeholder = "Select an option",
  searchPlaceholder = "Search options...",
  className = "",
  disabled = false,
  clearable = true,
  maxHeight = 200,
  noOptionsMessage = "No options found",
  loading = false,
  required = false,
  error = false,
  sortOptions = true,
}) => {
  const [isOpen, setIsOpen] = useState(false);
  const [searchTerm, setSearchTerm] = useState("");
  const [focusedIndex, setFocusedIndex] = useState(-1);
  
  // NEW: State for the dropdown's calculated position
  const [dropdownStyle, setDropdownStyle] = useState<React.CSSProperties>({});

  // Refs for the trigger, the dropdown itself, and the list items
  const triggerRef = useRef<HTMLDivElement>(null);
  const dropdownRef = useRef<HTMLDivElement>(null);
  const searchInputRef = useRef<HTMLInputElement>(null);
  const optionRefs = useRef<(HTMLDivElement | null)[]>([]);

  // Memoized filtering and sorting logic (no changes needed here)
  const filteredOptions = useMemo(() => {
    let processedOptions = [...options];
    if (sortOptions) {
      processedOptions.sort((a, b) => a.label.localeCompare(b.label, undefined, { sensitivity: 'base', numeric: true }));
    }
    if (!searchTerm.trim()) return processedOptions;
    return processedOptions.filter(option =>
      option.label.toLowerCase().includes(searchTerm.toLowerCase())
    );
  }, [options, searchTerm, sortOptions]);

  const selectedOption = options.find(option => option.value === value);
  const selectedLabel = selectedOption?.label || "";
  const hasValue = selectedLabel.length > 0;

  // NEW: Effect to calculate dropdown position using useLayoutEffect for precision
  useLayoutEffect(() => {
    if (isOpen && triggerRef.current) {
      const rect = triggerRef.current.getBoundingClientRect();
      setDropdownStyle({
        // Position fixed relative to the viewport
        position: 'fixed', 
        top: `${rect.bottom + 4}px`, // 4px gap below the trigger
        left: `${rect.left}px`,
        width: `${rect.width}px`, // Match the trigger's width
      });
    }
  }, [isOpen]);

  // Updated Effect to handle clicks outside both the trigger and the dropdown
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (
        triggerRef.current && !triggerRef.current.contains(event.target as Node) &&
        dropdownRef.current && !dropdownRef.current.contains(event.target as Node)
      ) {
        setIsOpen(false);
        setSearchTerm("");
        setFocusedIndex(-1);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  // Effect to focus search input when dropdown opens
  useEffect(() => {
    if (isOpen && searchInputRef.current) {
      // Small timeout to allow the portal to render and be focusable
      setTimeout(() => searchInputRef.current?.focus(), 0);
    }
  }, [isOpen]);
  
  // Keyboard navigation logic (no changes needed here)
  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (disabled) return;
    switch (e.key) {
      case "Enter":
        e.preventDefault();
        if (!isOpen) setIsOpen(true);
        else if (focusedIndex >= 0 && filteredOptions[focusedIndex]) {
          handleOptionSelect(filteredOptions[focusedIndex].value);
        }
        break;
      case "Escape":
        setIsOpen(false);
        setSearchTerm("");
        setFocusedIndex(-1);
        break;
      case "ArrowDown":
        e.preventDefault();
        if (!isOpen) setIsOpen(true);
        else setFocusedIndex(prev => prev < filteredOptions.length - 1 ? prev + 1 : 0);
        break;
      case "ArrowUp":
        e.preventDefault();
        if (isOpen) setFocusedIndex(prev => prev > 0 ? prev - 1 : filteredOptions.length - 1);
        break;
      case "Tab":
        setIsOpen(false);
        setSearchTerm("");
        setFocusedIndex(-1);
        break;
    }
  };

  // Scroll focused option into view (no changes needed here)
  useEffect(() => {
    if (focusedIndex >= 0 && optionRefs.current[focusedIndex]) {
      optionRefs.current[focusedIndex]?.scrollIntoView({ block: "nearest", behavior: "smooth" });
    }
  }, [focusedIndex]);

  // Handlers (no changes needed here)
  const handleOptionSelect = (optionValue: string) => {
    onChange(optionValue);
    setIsOpen(false);
    setSearchTerm("");
    setFocusedIndex(-1);
  };

  const handleClear = (e: React.MouseEvent) => {
    e.stopPropagation();
    onChange(null);
  };

  const toggleDropdown = () => {
    if (!disabled) {
      setIsOpen(!isOpen);
      if (!isOpen) {
        setSearchTerm("");
        setFocusedIndex(-1);
      }
    }
  };
  
  const baseClasses = `relative w-full rounded-md border px-3 py-2 focus-within:ring-2 focus-within:ring-blue-500 focus-within:outline-none transition-colors cursor-pointer ${error ? "border-red-300 dark:border-red-600" : "border-gray-300 dark:border-gray-600"} ${disabled ? "bg-gray-100 cursor-not-allowed dark:bg-gray-600" : `${hasValue ? "bg-gray-50 dark:bg-gray-800" : "bg-white dark:bg-gray-900"} hover:border-gray-400 dark:hover:border-gray-500`} dark:text-white dark:focus-within:ring-blue-600`;

  // Extracted Dropdown JSX to be used in the portal
  const DropdownContent = (
    <div
      ref={dropdownRef}
      style={dropdownStyle}
      className="z-[999] bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg"
    >
      <div className="p-2 border-b border-gray-200 dark:border-gray-600">
        <div className="relative">
          <FiSearch className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 dark:text-gray-500" />
          <input
            ref={searchInputRef}
            type="text"
            placeholder={searchPlaceholder}
            value={searchTerm}
            onChange={(e) => {
              setSearchTerm(e.target.value);
              setFocusedIndex(-1);
            }}
            onKeyDown={handleKeyDown}
            className="w-full pl-10 pr-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none bg-white dark:bg-gray-900 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"
          />
        </div>
      </div>
      <div
        className="overflow-y-auto"
        style={{ maxHeight: `${maxHeight}px` }}
        role="listbox"
      >
        {loading ? (
          <div className="px-3 py-2 text-sm text-gray-500 dark:text-gray-400 text-center">Loading...</div>
        ) : filteredOptions.length === 0 ? (
          <div className="px-3 py-2 text-sm text-gray-500 dark:text-gray-400 text-center">{noOptionsMessage}</div>
        ) : (
          filteredOptions.map((option, index) => (
            <div
              key={option.value}
              ref={(el) => { optionRefs.current[index] = el; }}
              className={`px-3 py-2 text-sm cursor-pointer transition-colors ${option.disabled ? "text-gray-400 dark:text-gray-500 cursor-not-allowed" : "text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-600"} ${index === focusedIndex ? "bg-blue-100 dark:bg-blue-900/50 text-blue-900 dark:text-blue-200" : ""} ${option.value === value ? "bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium" : ""}`}
              onClick={() => !option.disabled && handleOptionSelect(option.value)}
              role="option"
              aria-selected={option.value === value}
            >
              {option.label}
            </div>
          ))
        )}
      </div>
    </div>
  );

  return (
    <div ref={triggerRef} className={`relative ${className}`}>
      {/* The trigger element remains in its original position */}
      <div
        className={`${baseClasses.trim()} ${isOpen ? "ring-2 ring-blue-500 dark:ring-blue-600" : ""}`}
        onClick={toggleDropdown}
        onKeyDown={handleKeyDown}
        tabIndex={disabled ? -1 : 0}
        role="combobox"
        aria-controls="options-list"
        aria-expanded={isOpen}
        aria-haspopup="listbox"
        aria-required={required}
      >
        <div className="flex items-center justify-between">
          <span className={`block truncate ${!selectedLabel ? "text-gray-500 dark:text-gray-400" : ""}`}>
            {selectedLabel || placeholder}
          </span>
          <div className="flex items-center gap-1">
            {clearable && value && !disabled && (
              <button type="button" onClick={handleClear} className="flex items-center justify-center w-4 h-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300" tabIndex={-1}>
                <FiX className="w-3 h-3" />
              </button>
            )}
            <FiChevronDown className={`w-4 h-4 text-gray-400 transition-transform ${isOpen ? "rotate-180" : ""}`} />
          </div>
        </div>
      </div>

      {/* RENDER THE DROPDOWN IN A PORTAL */}
      {isOpen && typeof document !== 'undefined' && createPortal(DropdownContent, document.body)}
    </div>
  );
};
```

<!-- path: hnvtx/components/common/ui/error/ErrorDisplay.tsx -->
```typescript
import React, { useState, MouseEvent } from "react";

interface ErrorDisplayProps {
  error?: string | string[] | null;
  variant?: "inline" | "alert" | "toast" | "banner";
  severity?: "error" | "warning" | "info";
  size?: "sm" | "md" | "lg";
  showIcon?: boolean;
  dismissible?: boolean;
  onDismiss?: () => void;
  className?: string;
  id?: string;
  title?: string;
  actions?: Array<{
    label: string;
    onClick: () => void;
    variant?: "primary" | "secondary";
  }>;
}

export const ErrorDisplay: React.FC<ErrorDisplayProps> = ({
  error,
  variant = "inline",
  severity = "error",
  size = "md",
  showIcon = true,
  dismissible = false,
  onDismiss,
  className = "",
  id,
  title,
  actions = []
}) => {
  const [dismissed, setDismissed] = useState(false);

  if (!error || dismissed) return null;

  const errorArray = Array.isArray(error) ? error : [error];
  const hasMultipleErrors = errorArray.length > 1;

  const iconConfig = {
    error: {
      icon: (
        <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path
            fillRule="evenodd"
            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 
            11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 
            102 0V6a1 1 0 00-1-1z"
            clipRule="evenodd"
          />
        </svg>
      ),
      colorClass: "text-red-600"
    },
    warning: {
      icon: (
        <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path
            fillRule="evenodd"
            d="M8.257 3.099c.765-1.36 2.722-1.36 
            3.486 0l5.58 9.92c.75 1.334-.213 
            2.98-1.742 2.98H4.42c-1.53 
            0-2.493-1.646-1.743-2.98l5.58-9.92zM11 
            13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 
            00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
            clipRule="evenodd"
          />
        </svg>
      ),
      colorClass: "text-yellow-600"
    },
    info: {
      icon: (
        <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path
            fillRule="evenodd"
            d="M18 10a8 8 0 11-16 0 8 8 0 
            0116 0zm-7-4a1 1 0 11-2 0 1 1 
            0 012 0zM9 9a1 1 0 000 2v3a1 1 
            0 001 1h1a1 1 0 100-2v-3a1 1 0 
            00-1-1H9z"
            clipRule="evenodd"
          />
        </svg>
      ),
      colorClass: "text-blue-600"
    }
  } as const;

  const sizeConfig = {
    sm: { text: "text-sm", padding: "p-3", iconSize: "w-4 h-4" },
    md: { text: "text-base", padding: "p-4", iconSize: "w-5 h-5" },
    lg: { text: "text-lg", padding: "p-5", iconSize: "w-6 h-6" }
  };

  const variantConfig = {
    inline: {
      container: "inline-flex items-start space-x-2",
      background: "",
      border: ""
    },
    alert: {
      container: "rounded-lg border",
      background:
        severity === "error"
          ? "bg-red-50"
          : severity === "warning"
          ? "bg-yellow-50"
          : "bg-blue-50",
      border:
        severity === "error"
          ? "border-red-200"
          : severity === "warning"
          ? "border-yellow-200"
          : "border-blue-200"
    },
    toast: {
      container: "rounded-lg border shadow-lg",
      background: "bg-white",
      border:
        severity === "error"
          ? "border-red-400"
          : severity === "warning"
          ? "border-yellow-400"
          : "border-blue-400"
    },
    banner: {
      container: "border-l-4",
      background:
        severity === "error"
          ? "bg-red-50"
          : severity === "warning"
          ? "bg-yellow-50"
          : "bg-blue-50",
      border:
        severity === "error"
          ? "border-l-red-400"
          : severity === "warning"
          ? "border-l-yellow-400"
          : "border-l-blue-400"
    }
  };

  const currentIcon = iconConfig[severity];
  const currentSize = sizeConfig[size];
  const currentVariant = variantConfig[variant];

  const handleDismiss = () => {
    setDismissed(true);
    onDismiss?.();
  };

  const handleActionClick =
    (actionOnClick: () => void) => (event: MouseEvent<HTMLButtonElement>) => {
      event.preventDefault();
      actionOnClick();
    };

  return (
    <div
      id={id}
      className={`${currentVariant.container} ${currentVariant.background} ${currentVariant.border} ${
        variant !== "inline" ? currentSize.padding : ""
      } ${className}`}
      role="alert"
      aria-live="polite"
    >
      {showIcon && variant !== "inline" && (
        <div className={`flex-shrink-0 ${currentIcon.colorClass}`}>
          <div className={currentSize.iconSize}>{currentIcon.icon}</div>
        </div>
      )}

      <div className={`flex-1 ${variant !== "inline" && showIcon ? "ml-3" : ""}`}>
        {title && (
          <h3
            className={`font-medium ${currentIcon.colorClass} ${currentSize.text} mb-1`}
          >
            {title}
          </h3>
        )}

        <div
          className={`${currentSize.text} ${
            variant === "inline" ? "inline-flex items-center space-x-2" : ""
          }`}
        >
          {variant === "inline" && showIcon && (
            <div className={`flex-shrink-0 ${currentIcon.colorClass}`}>
              <div className={currentSize.iconSize}>{currentIcon.icon}</div>
            </div>
          )}

          <div className={currentIcon.colorClass}>
            {hasMultipleErrors ? (
              <ul
                className={
                  variant === "inline"
                    ? "inline"
                    : "list-disc list-inside space-y-1"
                }
              >
                {errorArray.map((errorItem, index) => (
                  <li key={index}>
                    {variant === "inline" && index > 0 && ", "}
                    {errorItem}
                  </li>
                ))}
              </ul>
            ) : (
              <span>{errorArray[0]}</span>
            )}
          </div>
        </div>

        {actions.length > 0 && variant !== "inline" && (
          <div className="mt-3 flex space-x-2">
            {actions.map((action, index) => (
              <button
                key={index}
                type="button"
                onClick={handleActionClick(action.onClick)}
                className={`px-3 py-1 rounded text-sm font-medium transition-colors duration-200 ${
                  action.variant === "primary"
                    ? `${
                        severity === "error"
                          ? "bg-red-600 hover:bg-red-700"
                          : severity === "warning"
                          ? "bg-yellow-600 hover:bg-yellow-700"
                          : "bg-blue-600 hover:bg-blue-700"
                      } text-white`
                    : `${
                        severity === "error"
                          ? "text-red-600 hover:text-red-800 hover:bg-red-100"
                          : severity === "warning"
                          ? "text-yellow-600 hover:text-yellow-800 hover:bg-yellow-100"
                          : "text-blue-600 hover:text-blue-800 hover:bg-blue-100"
                      } border ${
                        severity === "error"
                          ? "border-red-300"
                          : severity === "warning"
                          ? "border-yellow-300"
                          : "border-blue-300"
                      }`
                }`}
              >
                {action.label}
              </button>
            ))}
          </div>
        )}
      </div>

      {dismissible && (
        <div className="ml-auto pl-3">
          <button
            type="button"
            onClick={handleDismiss}
            className={`inline-flex rounded-md p-1.5 focus:outline-none focus:ring-2 focus:ring-offset-2 ${currentIcon.colorClass} hover:bg-gray-100 focus:ring-gray-500`}
            aria-label="Dismiss"
          >
            <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path
                fillRule="evenodd"
                d="M4.293 4.293a1 1 0 011.414 0L10 
                8.586l4.293-4.293a1 1 0 
                111.414 1.414L11.414 10l4.293 
                4.293a1 1 0 01-1.414 1.414L10 
                11.414l-4.293 4.293a1 1 0 
                01-1.414-1.414L8.586 10 4.293 
                5.707a1 1 0 010-1.414z"
                clipRule="evenodd"
              />
            </svg>
          </button>
        </div>
      )}
    </div>
  );
};

```

<!-- path: hnvtx/components/common/ui/Card/index.ts -->
```typescript
export { Card } from './Card';
export { CardHeader } from './Card';
export { CardBody } from './Card';
export { CardFooter } from './Card';
```

<!-- path: hnvtx/components/common/ui/Card/Card.tsx -->
```typescript
import { type ReactNode, forwardRef } from 'react';
import { motion } from 'framer-motion';
import { cn } from '@/utils/classNames';

interface CardProps {
  children: ReactNode;
  className?: string;
  variant?: 'default' | 'outlined' | 'elevated' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  hover?: boolean;
  clickable?: boolean;
  onClick?: () => void;
  padding?: 'none' | 'sm' | 'md' | 'lg';
  rounded?: 'none' | 'sm' | 'md' | 'lg' | 'xl';
}

interface CardHeaderProps {
  children: ReactNode;
  className?: string;
}

interface CardBodyProps {
  children: ReactNode;
  className?: string;
}

interface CardFooterProps {
  children: ReactNode;
  className?: string;
}

const Card = forwardRef<HTMLDivElement, CardProps>(
  ({
    children,
    className,
    variant = 'default',
    size = 'md',
    hover = false,
    clickable = false,
    onClick,
    padding = 'md',
    rounded = 'lg',
    ...props
  }, ref) => {
    const variantClasses = {
      default: 'bg-white border border-gray-200 shadow-sm',
      outlined: 'bg-white border-2 border-gray-300',
      elevated: 'bg-white shadow-lg border border-gray-100',
      ghost: 'bg-transparent'
    };

    const sizeClasses = {
      sm: 'text-sm',
      md: 'text-base',
      lg: 'text-lg'
    };

    const paddingClasses = {
      none: '',
      sm: 'p-3',
      md: 'p-4',
      lg: 'p-6'
    };

    const roundedClasses = {
      none: '',
      sm: 'rounded-sm',
      md: 'rounded-md',
      lg: 'rounded-lg',
      xl: 'rounded-xl'
    };

    const Component = clickable || onClick ? motion.div : 'div';
    const motionProps = clickable || onClick ? {
      whileHover: hover ? { y: -2, scale: 1.02 } : undefined,
      whileTap: { scale: 0.98 },
      transition: { type: "spring" as const, stiffness: 400, damping: 25 }
    } : {};

    return (
      <Component
        ref={ref}
        className={cn(
          'transition-all duration-200',
          variantClasses[variant],
          sizeClasses[size],
          paddingClasses[padding],
          roundedClasses[rounded],
          clickable || onClick ? 'cursor-pointer' : '',
          hover && (clickable || onClick) ? 'hover:shadow-md hover:border-gray-300' : '',
          className
        )}
        onClick={onClick}
        {...motionProps}
        {...props}
      >
        {children}
      </Component>
    );
  }
);

Card.displayName = 'Card';

const CardHeader = ({ children, className }: CardHeaderProps) => (
  <div className={cn('border-b border-gray-200 pb-3 mb-4', className)}>
    {children}
  </div>
);

const CardBody = ({ children, className }: CardBodyProps) => (
  <div className={cn('flex-1', className)}>
    {children}
  </div>
);

const CardFooter = ({ children, className }: CardFooterProps) => (
  <div className={cn('border-t border-gray-200 pt-3 mt-4', className)}>
    {children}
  </div>
);

export { Card, CardHeader, CardBody, CardFooter };
```

<!-- path: hnvtx/components/common/PageHeader copy.tsx -->
```typescript
"use client";

import React, { ReactNode, useCallback, useMemo } from "react";
import { FiDownload, FiPlus, FiRefreshCw } from "react-icons/fi";
import { toast } from "sonner";
import { createClient } from "@/utils/supabase/client";
import { Filters, TableOrViewName, Row } from "@/hooks/database";
import { useDynamicColumnConfig } from "@/hooks/useColumnConfig";
import { Button, ButtonProps } from "@/components/common/ui/Button/Button";
import { useTableExcelDownload } from "@/hooks/database/excel-queries";
import { formatDate } from "@/utils/formatters";
import { cn } from "@/lib/utils";

// --- TYPE DEFINITIONS ---

interface ExportConfig<T extends TableOrViewName> {
  tableName: T;
  filters?: Filters;
  maxRows?: number;
  columns?: (keyof Row<T> & string)[]; // Allow specifying a subset of columns for export
  fileName?: string;
}

export interface ActionButton extends ButtonProps {
  label: string;
  hideOnMobile?: boolean;
  hideTextOnMobile?: boolean;
  priority?: 'high' | 'medium' | 'low'; // For mobile button ordering
}

interface StatProps {
  value: string | number;
  label: string;
  icon?: ReactNode;
  color?: 'primary' | 'success' | 'warning' | 'danger' | 'default';
}

export interface PageHeaderProps {
  title: string;
  description?: string;
  icon?: ReactNode;
  stats?: StatProps[];
  actions?: ActionButton[];
  isLoading?: boolean;
  className?: string;
}

// --- SUB-COMPONENTS ---

const StatCard: React.FC<StatProps> = ({ value, label, icon, color = 'default' }) => {
    const statColors = {
      primary: 'text-blue-600 dark:text-blue-400',
      success: 'text-green-600 dark:text-green-400',
      warning: 'text-yellow-600 dark:text-yellow-400',
      danger: 'text-red-600 dark:text-red-400',
      default: 'text-gray-900 dark:text-white',
    };
    return (
      <div className="rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-900 flex items-start gap-4">
        {icon && <div className={`flex-shrink-0 text-2xl ${statColors[color]}`}>{icon}</div>}
        <div>
          <div className={`text-2xl font-bold ${statColors[color]}`}>{value}</div>
          <div className="text-sm text-gray-600 dark:text-gray-400">{label}</div>
        </div>
      </div>
    );
};

// --- MAIN COMPONENT ---

export function PageHeader({
  title,
  description,
  icon,
  stats,
  actions = [],
  isLoading = false,
  className,
}: PageHeaderProps) {
  
  return (
    <div className={cn("space-y-4 sm:space-y-6", isLoading && "opacity-50",className)}>
      {/* Header Section */}
      <div className="flex flex-col space-y-4 lg:space-y-0 lg:flex-row lg:items-start lg:justify-between">
        <div className="flex-1 space-y-2 sm:space-y-3 min-w-0">
          <div className="flex flex-col space-y-2 sm:space-y-0 sm:flex-row sm:items-center sm:gap-3">
            {icon && <div className="text-2xl sm:text-3xl text-blue-600 dark:text-blue-400">{icon}</div>}
            <h1 className="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white leading-tight">
              {title}
            </h1>
          </div>
          {description && (
            <p className="text-gray-600 dark:text-gray-400 text-base sm:text-lg leading-relaxed">
              {description}
            </p>
          )}
        </div>
        
        {/* Desktop Action Buttons */}
        <div className="hidden lg:flex items-center gap-2 flex-shrink-0 ml-4">
          {actions.map((action, index) => (
            <Button
              key={`desktop-action-${index}`}
              {...action}
              disabled={action.disabled || isLoading}
            >
              {action.label}
            </Button>
          ))}
        </div>
      </div>

      {/* Stats and Mobile Actions Row */}
      <div className="flex flex-col space-y-4 sm:space-y-0 sm:flex-row sm:items-center sm:justify-between sm:gap-4">
        {/* Stats Grid */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 flex-grow">
          {isLoading ? (
            Array.from({ length: stats?.length || 2 }).map((_, i) => (
              <div key={`stat-skeleton-${i}`} className="rounded-lg border border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-900 animate-pulse">
                <div className="h-8 w-1/2 rounded-md bg-gray-200 dark:bg-gray-700 mb-2"></div>
                <div className="h-4 w-3/4 rounded-md bg-gray-200 dark:bg-gray-700"></div>
              </div>
            ))
          ) : (
            stats?.map(stat => <StatCard key={stat.label} {...stat} />)
          )}
        </div>

        {/* Mobile/Tablet Action Buttons */}
        <div className="flex lg:hidden items-center gap-2 w-full sm:w-auto sm:flex-shrink-0">
          {actions.map((action, index) => (
            <Button
              key={`mobile-action-${index}`}
              {...action}
              className={`flex-1 sm:flex-none ${action.hideOnMobile ? 'hidden sm:flex' : ''}`}
              disabled={action.disabled || isLoading}
            >
              {action.hideTextOnMobile ? '' : action.label}
            </Button>
          ))}
        </div>
      </div>
    </div>
  );
}

// --- HOOK FOR CREATING STANDARD ACTIONS ---

interface StandardActionsConfig<T extends TableOrViewName> {
  onRefresh?: () => void;
  onAddNew?: () => void;
  exportConfig?: ExportConfig<T>;
  isLoading?: boolean;
  data?: Row<T>[];
}

export function useStandardHeaderActions<T extends TableOrViewName>({
  onRefresh,
  onAddNew,
  exportConfig,
  isLoading,
  data
}: StandardActionsConfig<T>): ActionButton[] {
  const supabase = useMemo(() => createClient(), []);
  const columns = useDynamicColumnConfig(exportConfig?.tableName as T,{data: data});

  const tableExcelDownload = useTableExcelDownload(
    supabase,
    exportConfig?.tableName as T,
    { onSuccess: () => toast.success("Export successful!"), onError: (err) => toast.error(`Export failed: ${err.message}`) },
  );

  const handleExport = useCallback(() => {
    if (!exportConfig?.tableName) {
      toast.error("Export failed: Table name not configured.");
      return;
    }
    tableExcelDownload.mutate({
      fileName: `${formatDate(new Date(), { format: "dd-mm-yyyy" })}-${exportConfig.fileName ? exportConfig.fileName : exportConfig.tableName}.xlsx`,
      sheetName: exportConfig.fileName ? exportConfig.fileName : exportConfig.tableName,
      filters: exportConfig.filters,
      columns: columns.filter(c => exportConfig.columns ? exportConfig.columns.includes(c.key as keyof Row<T> & string) : true),
      maxRows: exportConfig.maxRows
    });
  }, [exportConfig, columns, tableExcelDownload]);

  return useMemo(() => {
    const actions: ActionButton[] = [];

    if (onRefresh) {
      actions.push({
        label: "Refresh",
        onClick: onRefresh,
        variant: "outline",
        leftIcon: <FiRefreshCw className={isLoading ? "animate-spin" : ""} />,
        disabled: isLoading,
      });
    }

    if (exportConfig) {
      actions.push({
        label: tableExcelDownload.isPending ? 'Exporting...' : 'Export',
        onClick: handleExport,
        variant: "outline",
        leftIcon: <FiDownload />,
        disabled: isLoading || tableExcelDownload.isPending,
      });
    }

    if (onAddNew) {
      actions.push({
        label: "Add New",
        onClick: onAddNew,
        variant: "primary",
        leftIcon: <FiPlus />,
        disabled: isLoading,
      });
    }

    return actions;
  }, [onRefresh, onAddNew, exportConfig, isLoading, handleExport, tableExcelDownload.isPending]);
}
```

<!-- path: hnvtx/components/common/form/index.ts -->
```typescript
export * from './FormCard';
export * from './FormControls';
export * from './SectionCard';
export * from './IPAddressInput';


```

<!-- path: hnvtx/components/common/form/FormCard.tsx -->
```typescript
import React from "react";
import { cn } from "@/utils/classNames";

interface FormCardProps {
  title: string;
  subtitle?: string;
  isLoading?: boolean;
  onCancel: () => void;
  onSubmit?: React.FormEventHandler<HTMLFormElement>;
  submitText?: string;
  cancelText?: string;
  children: React.ReactNode;
  footerContent?: React.ReactNode;
  widthClass?: string;
  disableSubmit?: boolean;
  heightClass?: string;
  standalone?: boolean; // New prop to control backdrop behavior
}

export const FormCard: React.FC<FormCardProps> = ({
  title,
  subtitle,
  isLoading = false,
  onCancel,
  onSubmit,
  submitText = "Submit",
  cancelText = "Cancel",
  children,
  footerContent,
  widthClass = "max-w-3xl",
  heightClass = "max-h-[90vh]",
  disableSubmit = false,
  standalone = false, // Default to false - no backdrop
}) => {
  const modalContent = (
    <div
      className={cn(
        "w-full overflow-hidden rounded-xl bg-white shadow-2xl dark:bg-gray-900 dark:border dark:border-gray-700 flex flex-col transform mx-auto",
        widthClass,
        heightClass
      )}
      style={{
        animation: "slideInScale 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)",
        boxShadow: "0 25px 50px -12px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.05)"
      }}
      onClick={(e) => e.stopPropagation()}
    >
      {/* Header */}
      <div 
        className="flex-shrink-0 px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between"
        style={{
          animation: "slideDown 0.5s ease-out 0.1s both"
        }}
      >
        <div>
          <h2 
            className="text-2xl font-bold text-gray-900 dark:text-white"
            style={{
              animation: "fadeInUp 0.6s ease-out 0.2s both"
            }}
          >
            {title}
          </h2>
          {subtitle && (
            <p 
              className="text-gray-600 dark:text-gray-400 text-sm mt-1"
              style={{
                animation: "fadeInUp 0.6s ease-out 0.3s both"
              }}
            >
              {subtitle}
            </p>
          )}
        </div>
        <button
          onClick={onCancel}
          disabled={isLoading}
          className="text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full p-2 transition-all duration-300 hover:scale-110 hover:rotate-90"
          style={{
            animation: "fadeInRotate 0.5s ease-out 0.2s both"
          }}
        >
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      {/* Form Body + Footer */}
      <form onSubmit={onSubmit} className="flex flex-col flex-1 min-h-0">
        {/* Body */}
        <div 
          className="flex-1 overflow-y-auto relative min-h-0"
          style={{
            animation: "fadeInUp 0.6s ease-out 0.3s both"
          }}
        >
          {isLoading && (
            <div 
              className="absolute inset-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm flex items-center justify-center z-10"
              style={{
                animation: "fadeIn 0.3s ease-out"
              }}
            >
              <div className="flex items-center space-x-2">
                <div 
                  className="w-4 h-4 bg-blue-600 rounded-full"
                  style={{
                    animation: "bounce 1.4s ease-in-out infinite both"
                  }}
                ></div>
                <div 
                  className="w-4 h-4 bg-blue-600 rounded-full"
                  style={{
                    animation: "bounce 1.4s ease-in-out 0.16s infinite both"
                  }}
                ></div>
                <div 
                  className="w-4 h-4 bg-blue-600 rounded-full"
                  style={{
                    animation: "bounce 1.4s ease-in-out 0.32s infinite both"
                  }}
                ></div>
                <span className="text-gray-600 dark:text-gray-300 ml-3">Loading...</span>
              </div>
            </div>
          )}
          <div className="p-6">{children}</div>
        </div>

        {/* Footer */}
        <div 
          className="flex-shrink-0 px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800/50"
          style={{
            animation: "slideUp 0.5s ease-out 0.4s both"
          }}
        >
          {footerContent ? (
            footerContent
          ) : (
            <div className="flex justify-end space-x-3 w-full">
              <button
                type="button"
                onClick={onCancel}
                disabled={isLoading}
                className="px-6 py-2 border rounded-md dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700 transition-all duration-300 hover:scale-105 hover:shadow-lg transform"
                style={{
                  animation: "fadeInLeft 0.5s ease-out 0.5s both"
                }}
              >
                {cancelText}
              </button>
              {onSubmit && (
                <button
                  type="submit"
                  disabled={isLoading || disableSubmit}
                  className="px-8 py-2 bg-blue-600 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-700 text-white shadow-lg hover:shadow-xl transform hover:-translate-y-1 hover:scale-105 transition-all duration-300 rounded-md"
                  style={{
                    animation: "fadeInRight 0.5s ease-out 0.6s both",
                    background: "linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%)"
                  }}
                >
                  {submitText}
                </button>
              )}
            </div>
          )}
        </div>
      </form>

      <style jsx>{`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }

        @keyframes slideInScale {
          0% {
            opacity: 0;
            transform: translateY(20px) scale(0.95);
          }
          100% {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }

        @keyframes slideDown {
          from {
            opacity: 0;
            transform: translateY(-20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        @keyframes fadeInUp {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        @keyframes fadeInLeft {
          from {
            opacity: 0;
            transform: translateX(-10px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }

        @keyframes fadeInRight {
          from {
            opacity: 0;
            transform: translateX(10px);
          }
          to {
            opacity: 1;
            transform: translateX(0);
          }
        }

        @keyframes fadeInRotate {
          from {
            opacity: 0;
            transform: rotate(-90deg) scale(0.8);
          }
          to {
            opacity: 1;
            transform: rotate(0deg) scale(1);
          }
        }

        @keyframes bounce {
          0%, 80%, 100% {
            transform: scale(0);
            opacity: 0.5;
          }
          40% {
            transform: scale(1);
            opacity: 1;
          }
        }
      `}</style>
    </div>
  );

  // If standalone, wrap with backdrop, otherwise return just the modal content
  if (standalone) {
    return (
      <div 
        className="fixed inset-0 z-[9999] flex items-center justify-center p-4"
        style={{
          background: "rgba(0, 0, 0, 0.6)",
          animation: "fadeIn 0.3s ease-out"
        }}
        onClick={(e) => {
          if (e.target === e.currentTarget) {
            onCancel();
          }
        }}
      >
        {modalContent}
      </div>
    );
  }

  // Return just the modal content without backdrop (for use within existing modals)
  return (
    <div className="flex items-center justify-center p-4 w-full">
      {modalContent}
    </div>
  );
};
```

<!-- path: hnvtx/components/common/form/FormControls.tsx -->
```typescript
/* eslint-disable @typescript-eslint/no-explicit-any */
"use client";

import { Control, Controller, FieldError, FieldErrorsImpl, Merge, UseFormRegister, Path, FieldValues } from "react-hook-form";
import { SearchableSelect, Option } from "@/components/common/ui/select/SearchableSelect";
import { Input } from "@/components/common/ui/Input";
import { Textarea } from "@/components/common/ui/textarea/Textarea";
import { Label, Switch } from "@/components/common/ui";
import { forwardRef } from "react";
import DatePicker, { type DatePickerProps } from "react-datepicker";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/common/ui/select/Select";

// --- TYPE DEFINITIONS for Generic Components ---

type BaseProps<T extends FieldValues> = {
  name: Path<T>;
  label: string;
  error?: FieldError | Merge<FieldError, FieldErrorsImpl<any>>;
  required?: boolean;
  className?: string;
  labelClassName?: string;
};

// --- FORM INPUT COMPONENT ---

interface FormInputProps<T extends FieldValues> extends BaseProps<T>, Omit<React.InputHTMLAttributes<HTMLInputElement>, 'name' | 'size'> {
  register: UseFormRegister<T>;
}

export function FormInput<T extends FieldValues>({
  name,
  register,
  label,
  error,
  type = 'text',
  className,
  labelClassName,
  ...props
}: FormInputProps<T>) {
  return (
    <div className={className}>
      <Label htmlFor={name} required={props.required} className={labelClassName}>{label}</Label>
      <Input
        id={name}
        type={type}
        error={typeof error?.message === 'string' ? error.message : undefined}
        {...props}
        {...register(name, {
            ...(type === 'number' && { valueAsNumber: true }),
            ...(type === 'date' && {
              setValueAs: (v) => (v ? new Date(v) : null),
            }),
        })}
      />
    </div>
  );
}

// --- FORM TEXTAREA COMPONENT ---

interface FormTextareaProps<T extends FieldValues> extends BaseProps<T>, Omit<React.TextareaHTMLAttributes<HTMLTextAreaElement>, 'name' | 'value' | 'onChange'> {
  register?: UseFormRegister<T>;
  control?: Control<T>;
}

export function FormTextarea<T extends FieldValues>({ name, control, label, error, className, labelClassName, ...props }: FormTextareaProps<T>) {
  return (
    <div className={className}>
      <Label htmlFor={name} required={props.required} className={labelClassName}>{label}</Label>
      {control ? (
        <Controller
          name={name}
          control={control}
          render={({ field }) => (
            <Textarea
              id={name}
              value={(field.value as string) ?? ''}
              onChange={(_e, val) => field.onChange(val)}
              onBlur={field.onBlur}
              error={!!error}
              errorMessage={typeof error?.message === 'string' ? error.message : undefined}
              {...props}
            />
          )}
        />
      ) : (
        <Textarea
          id={name}
          error={!!error}
          errorMessage={typeof error?.message === 'string' ? error.message : undefined}
          {...props}
        />
      )}
    </div>
  );
}

// --- FORM SEARCHABLE SELECT COMPONENT ---

interface FormSearchableSelectProps<T extends FieldValues> extends BaseProps<T> {
  control: Control<T>;
  options: Option[];
  placeholder?: string;
  searchPlaceholder?: string;
  disabled?: boolean;
  clearable?: boolean;
}

export function FormSearchableSelect<T extends FieldValues>({
  name,
  control,
  label,
  options,
  error,
  className,
  labelClassName,
  ...props
}: FormSearchableSelectProps<T>) {
  return (
    <div className={className}>
      <Label htmlFor={name} required={props.required} className={labelClassName}>{label}</Label>
      <Controller
        name={name}
        control={control}
        render={({ field }) => (
          <SearchableSelect
            {...props}
            value={field.value as string ?? ""}
            onChange={(value) => field.onChange(value === "" ? null : value)}
            options={options}
            error={!!error}
          />
        )}
      />
      {error && (
        <p className='mt-1 text-sm text-red-500'>
          {typeof error?.message === 'string' ? error.message : null}
        </p>
      )}
    </div>
  );
}

// --- FORM SELECT COMPONENT ---

interface FormSelectProps<T extends FieldValues> extends BaseProps<T> {
  control: Control<T>;
  options: Option[];
  placeholder?: string;
  searchPlaceholder?: string;
  disabled?: boolean;
  clearable?: boolean;
}

export function FormSelect<T extends FieldValues>({
  name,
  control,
  label,
  options,
  error,
  className,
  labelClassName,
  ...props
}: FormSelectProps<T>) {
  return (
    <div className={className}>
      <Label htmlFor={name} required={props.required} className={labelClassName}>{label}</Label>
      <Controller
        name={name}
        control={control}
        render={({ field }) => (
          <Select
            {...props}
            value={(field.value as string ) ?? ""}
            onValueChange={(value) => field.onChange(value)}
          >
            <SelectTrigger className="w-full" aria-invalid={!!error}>
              <SelectValue placeholder={props.placeholder ?? "Select"} />
            </SelectTrigger>
            <SelectContent>
              {options.map((option) => (
                <SelectItem key={option.value} value={option.value} disabled={option.disabled}>
                  {option.label}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        )}
      />
      {error && (
        <p className='mt-1 text-sm text-red-500'>
          {typeof error?.message === 'string' ? error.message : null}
        </p>
      )}
    </div>
  );
}

// --- FORM DATE INPUT COMPONENT ---

// Keep your original prop intent; allow passing datepicker props safely
export interface FormDateInputProps<T extends FieldValues>
  extends BaseProps<T>,
    Omit<React.InputHTMLAttributes<HTMLInputElement>, "name" | "type" | "size"> {
  control: Control<T>;
  // Optional passthrough for DatePicker props (minDate, maxDate, showTimeSelect, etc.)
  pickerProps?: Partial<
    Omit<
      DatePickerProps,
      // Keep single-date mode: exclude props that change `onChange` signature
      | "selected"
      | "onChange"
      | "customInput"
      | "onBlur"
      | "onSelect"
      | "selectsRange"
      | "selectsMultiple"
      | "startDate"
      | "endDate"
    >
  >;
}

/** A styled input used as ReactDatePicker's customInput to control theme + icon */
const DateTextInput = forwardRef<HTMLInputElement, React.InputHTMLAttributes<HTMLInputElement> & { errorText?: string }>(
  ({ className, errorText, ...rest }, ref) => {
    return (
      <div className="relative">
        <input
          ref={ref}
          {...rest}
          className={[
            "w-full rounded-md border bg-white text-gray-900",
            "dark:bg-gray-900 dark:text-gray-100 dark:border-gray-700",
            "px-10 py-2 outline-none",
            "focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
            errorText ? "border-red-500 focus:ring-red-500 focus:border-red-500" : "border-gray-300",
            className ?? "",
          ].join(" ")}
          readOnly // recommended with customInput to avoid parsing issues
        />
        {/* Calendar icon (theme-aware via currentColor) */}
        <svg
          className="pointer-events-none absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-500 dark:text-gray-300"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          aria-hidden="true"
        >
          <rect x="3" y="4" width="18" height="18" rx="2" />
          <line x1="16" y1="2" x2="16" y2="6" />
          <line x1="8" y1="2" x2="8" y2="6" />
          <line x1="3" y1="10" x2="21" y2="10" />
        </svg>
        {errorText ? (
          <p className="mt-1 text-sm text-red-600">{errorText}</p>
        ) : null}
      </div>
    );
  }
);
DateTextInput.displayName = "DateTextInput";

export function FormDateInput<T extends FieldValues>({
  name,
  control,
  label,
  error,
  className,
  labelClassName,
  pickerProps,
  required,
  ...inputProps
}: FormDateInputProps<T>) {
  return (
    <div className={className}>
      {label ? (
        <Label htmlFor={name} className={labelClassName}>
          {label}
          {required ? <span className="ml-0.5 text-red-600">*</span> : null}
        </Label>
      ) : null}

      <Controller
        name={name}
        control={control}
        render={({ field }) => {
          // Normalize value to Date | null
          const raw = field.value as unknown;
          const selected: Date | null =
            raw == null || (raw as any) === ""
              ? null
              : (typeof raw === "object" && raw !== null && "getTime" in (raw as object))
              ? (raw as Date)
              : new Date(raw as any);

          return (
            // @ts-expect-error react-datepicker's prop union sometimes misinfers to multi-select variant.
            // We intentionally use single-date mode: `selected: Date | null` and `onChange(date | null)`.
            <DatePicker
              id={name}
              // --- recommended defaults for date-only fields ---
              selected={selected}
              onChange={(d: Date | null) => field.onChange(d)}
              onBlur={field.onBlur}
              // Keep keyboard nav and accessibility
              // Use a date-only format; adjust as you like
              dateFormat={(pickerProps as any)?.dateFormat ?? "yyyy-MM-dd"}
              // Show clear button by default; optional
              isClearable
              // Enable year and month dropdowns
              showMonthDropdown
              showYearDropdown
              dropdownMode="select" // Makes dropdowns selectable instead of scrollable
              // You can also set year range if needed
              yearDropdownItemNumber={15} // Shows 15 years in dropdown
              // Render portal into Next.js root so it appears above modals/overflows
              portalId="__next"
              // Custom input so we fully control theme + icon
              customInput={
                <DateTextInput
                  errorText={typeof error?.message === "string" ? error.message : undefined}
                  placeholder={inputProps.placeholder ?? "Select date"}
                />
              }
              // Pass through any extra ReactDatePicker props (minDate, maxDate, showTimeSelect, etc.)
              {...pickerProps}
            />
          );
        }}
      />
    </div>
  );
}

// --- FORM SWITCH COMPONENT ---

interface FormSwitchProps<T extends FieldValues> extends BaseProps<T> {
    control: Control<T>;
    description?: string;
}

export function FormSwitch<T extends FieldValues>({ name, control, label, error, description, className }: FormSwitchProps<T>) {
  return (
    <div className={className}>
       <Controller
        name={name}
        control={control}
        render={({ field }) => (
            <div className="flex items-center space-x-2">
                <Switch
                    id={name}
                    checked={!!field.value}
                    onChange={(checked: boolean) => field.onChange(checked)}
                />
                <div>
                    <Label htmlFor={name}>{label}</Label>
                    {description && <p className="text-xs text-gray-500">{description}</p>}
                </div>
            </div>
        )}
      />
      {error && <p className='mt-1 text-sm text-red-500'>{typeof error?.message === 'string' ? error.message : null}</p>}
    </div>
  );
}
```

<!-- path: hnvtx/components/common/form/IPAddressInput.tsx -->
```typescript
import React, { useState, useCallback } from 'react';
import { AlertCircle, CheckCircle2, Globe } from 'lucide-react';
import { Label } from '@/components/common/ui';

interface ValidationState {
  isValid: boolean | null;
  type: 'IPv4' | 'IPv6' | null;
  error: string | null;
}

interface IPAddressInputProps {
  value?: string;
  onChange?: (value: string, validation: ValidationState) => void;
  placeholder?: string;
  allowIPv4?: boolean;
  allowIPv6?: boolean;
  className?: string;
  label?: string;
}

const IPAddressInput: React.FC<IPAddressInputProps> = ({ 
  value = '', 
  onChange = () => {}, 
  placeholder = 'Enter IP address',
  allowIPv4 = true,
  allowIPv6 = true,
  className = '',
  label = '',
}) => {
  const [inputValue, setInputValue] = useState<string>(value);
  const [validationState, setValidationState] = useState<ValidationState>({ isValid: null, type: null, error: null });

  // IPv4 validation
  const isValidIPv4 = useCallback((ip: string): boolean => {
    const ipv4Regex = /^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/;
    const match = ip.match(ipv4Regex);
    if (!match) return false;
    
    return match.slice(1).every(octet => {
      const num = parseInt(octet, 10);
      return num >= 0 && num <= 255 && octet === num.toString();
    });
  }, []);

  const isValidIPv6Basic = useCallback((ip: string): boolean => {
    // Normalize the IPv6 address
    const normalized = ip.toLowerCase();
    
    // Handle :: compression
    if (normalized.includes('::')) {
      const parts = normalized.split('::');
      if (parts.length > 2) return false; // More than one ::
      
      const leftParts = parts[0] ? parts[0].split(':') : [];
      const rightParts = parts[1] ? parts[1].split(':') : [];
      const totalParts = leftParts.length + rightParts.length;
      
      if (totalParts > 8) return false;
    } else {
      // No compression, should have exactly 8 parts
      const parts = normalized.split(':');
      if (parts.length !== 8) return false;
    }
    
    // Validate each hexadecimal group
    const hexGroups = normalized.split('::').join(':').split(':').filter(part => part !== '');
    return hexGroups.every(group => {
      if (group.length === 0 || group.length > 4) return false;
      return /^[0-9a-f]+$/i.test(group);
    });
  }, []);

   // IPv6 validation
   const isValidIPv6 = useCallback((ip: string): boolean => {
    // Handle IPv6 with embedded IPv4
    const ipv6WithIPv4Regex = /^([0-9a-fA-F:]+):(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})$/;
    if (ipv6WithIPv4Regex.test(ip)) {
      const parts = ip.split(':');
      const ipv4Part = parts[parts.length - 1];
      const ipv6Part = parts.slice(0, -1).join(':') + ':';
      return isValidIPv4(ipv4Part) && isValidIPv6Basic(ipv6Part.slice(0, -1));
    }
    
    return isValidIPv6Basic(ip);
  }, [isValidIPv4, isValidIPv6Basic]);

  const validateIP = useCallback((ip: string): ValidationState => {
    if (!ip.trim()) {
      return { isValid: null, type: null, error: null };
    }

    let isIPv4Valid = false;
    let isIPv6Valid = false;

    if (allowIPv4) {
      isIPv4Valid = isValidIPv4(ip);
    }

    if (allowIPv6) {
      isIPv6Valid = isValidIPv6(ip);
    }

    if (isIPv4Valid) {
      return { isValid: true, type: 'IPv4', error: null };
    } else if (isIPv6Valid) {
      return { isValid: true, type: 'IPv6', error: null };
    } else {
      let error = 'Invalid IP address format';
      if (!allowIPv4 && !allowIPv6) {
        error = 'IP address input is disabled';
      } else if (!allowIPv4) {
        error = 'Only IPv6 addresses are allowed';
      } else if (!allowIPv6) {
        error = 'Only IPv4 addresses are allowed';
      }
      return { isValid: false, type: null, error };
    }
  }, [allowIPv4, allowIPv6, isValidIPv4, isValidIPv6]);

  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>): void => {
    const newValue = e.target.value;
    setInputValue(newValue);
    
    const validation = validateIP(newValue);
    setValidationState(validation);
    
    onChange(newValue, validation);
  };

  const formatIPv6 = (ip: string): string => {
    // Basic IPv6 formatting - expand compressed notation for display
    if (!ip.includes('::')) return ip;
    
    const parts = ip.split('::');
    const leftParts = parts[0] ? parts[0].split(':') : [];
    const rightParts = parts[1] ? parts[1].split(':') : [];
    const missingParts = 8 - leftParts.length - rightParts.length;
    
    const expanded = [
      ...leftParts,
      ...Array(missingParts).fill('0000'),
      ...rightParts
    ];
    
    return expanded.map(part => part.padStart(4, '0')).join(':');
  };

  const getInputClass = (): string => {
    let baseClass = `w-full px-4 py-3 border rounded-lg transition-all duration-200 font-mono text-sm ${className}`;
    
    if (validationState.isValid === true) {
      baseClass += ' border-green-500 bg-green-50 focus:border-green-600 focus:ring-2 focus:ring-green-200 dark:bg-green-900/20 dark:border-green-600 dark:focus:border-green-500 dark:focus:ring-green-500/20';
    } else if (validationState.isValid === false) {
      baseClass += ' border-red-500 bg-red-50 focus:border-red-600 focus:ring-2 focus:ring-red-200 dark:bg-red-900/20 dark:border-red-600 dark:focus:border-red-500 dark:focus:ring-red-500/20';
    } else {
      baseClass += ' border-gray-300 bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:focus:border-blue-400 dark:focus:ring-blue-400/20';
    }
    
    return baseClass;
  };

  return (
    <div className="w-full max-w-md">
      <div className="relative">
        {label && (
          <Label className="dark:text-gray-300">{label}</Label>
        )}
        <input
          type="text"
          value={inputValue}
          onChange={handleInputChange}
          placeholder={placeholder}
          className={getInputClass()}
          autoComplete="off"
          spellCheck="false"
        />
        
        {/* Status icon */}
        <div className="absolute right-3 top-1/2 transform -translate-y-1/2">
          {validationState.isValid === true && (
            <CheckCircle2 className="w-5 h-5 text-green-500 dark:text-green-400" />
          )}
          {validationState.isValid === false && (
            <AlertCircle className="w-5 h-5 text-red-500 dark:text-red-400" />
          )}
          {validationState.isValid === null && inputValue && (
            <Globe className="w-5 h-5 text-gray-400 dark:text-gray-500" />
          )}
        </div>
      </div>

      {/* Validation feedback */}
      <div className="mt-2 min-h-[1.5rem]">
        {validationState.isValid === true && (
          <div className="flex items-center gap-2 text-sm text-green-600 dark:text-green-400">
            <CheckCircle2 className="w-4 h-4" />
            <span>Valid {validationState.type} address</span>
          </div>
        )}
        
        {validationState.isValid === false && (
          <div className="flex items-center gap-2 text-sm text-red-600 dark:text-red-400">
            <AlertCircle className="w-4 h-4" />
            <span>{validationState.error}</span>
          </div>
        )}
        
        {validationState.isValid === true && validationState.type === 'IPv6' && (
          <div className="mt-1 text-xs text-gray-500 dark:text-gray-400 font-mono break-all">
            Expanded: {formatIPv6(inputValue)}
          </div>
        )}
      </div>
    </div>
  );
};

export default IPAddressInput;

// // Demo component showing usage examples
// const IPAddressDemo = () => {
//   const [ipv4Value, setIPv4Value] = useState('');
//   const [ipv6Value, setIPv6Value] = useState('');
//   const [anyValue, setAnyValue] = useState('');

//   const handleIPChange = (value: string, validation: ValidationState, setter: (value: string) => void): void => {
//     setter(value);
//     console.log('IP changed:', { value, validation });
//   };

//   return (
//     <div className="p-6 bg-gray-50 min-h-screen">
//       <div className="max-w-2xl mx-auto space-y-8">
//         <div className="text-center">
//           <h1 className="text-3xl font-bold text-gray-900 mb-2">IP Address Input Component</h1>
//           <p className="text-gray-600">Supports IPv4 and IPv6 with real-time validation</p>
//         </div>

//         <div className="space-y-6">
//           {/* IPv4 Only */}
//           <div className="bg-white p-6 rounded-lg shadow-sm border">
//             <h2 className="text-lg font-semibold text-gray-800 mb-3">IPv4 Only</h2>
//             <IPAddressInput
//               value={ipv4Value}
//               onChange={(value, validation) => handleIPChange(value, validation, setIPv4Value)}
//               placeholder="Enter IPv4 address (e.g., 192.168.1.1)"
//               allowIPv4={true}
//               allowIPv6={false}
//             />
//             <div className="mt-2 text-sm text-gray-500">
//               Current value: <code className="bg-gray-100 px-1 rounded">{ipv4Value || 'empty'}</code>
//             </div>
//           </div>

//           {/* IPv6 Only */}
//           <div className="bg-white p-6 rounded-lg shadow-sm border">
//             <h2 className="text-lg font-semibold text-gray-800 mb-3">IPv6 Only</h2>
//             <IPAddressInput
//               value={ipv6Value}
//               onChange={(value, validation) => handleIPChange(value, validation, setIPv6Value)}
//               placeholder="Enter IPv6 address (e.g., 2001:db8::1)"
//               allowIPv4={false}
//               allowIPv6={true}
//             />
//             <div className="mt-2 text-sm text-gray-500">
//               Current value: <code className="bg-gray-100 px-1 rounded">{ipv6Value || 'empty'}</code>
//             </div>
//           </div>

//           {/* Both IPv4 and IPv6 */}
//           <div className="bg-white p-6 rounded-lg shadow-sm border">
//             <h2 className="text-lg font-semibold text-gray-800 mb-3">IPv4 or IPv6</h2>
//             <IPAddressInput
//               value={anyValue}
//               onChange={(value, validation) => handleIPChange(value, validation, setAnyValue)}
//               placeholder="Enter any IP address"
//               allowIPv4={true}
//               allowIPv6={true}
//             />
//             <div className="mt-2 text-sm text-gray-500">
//               Current value: <code className="bg-gray-100 px-1 rounded">{anyValue || 'empty'}</code>
//             </div>
//           </div>
//         </div>

//         {/* Example values for testing */}
//         <div className="bg-white p-6 rounded-lg shadow-sm border">
//           <h3 className="text-lg font-semibold text-gray-800 mb-3">Test Examples</h3>
//           <div className="space-y-2 text-sm">
//             <div>
//               <strong>Valid IPv4:</strong>
//               <ul className="ml-4 mt-1 space-y-1 text-gray-600">
//                 <li><code className="bg-gray-100 px-1 rounded">192.168.1.1</code></li>
//                 <li><code className="bg-gray-100 px-1 rounded">10.0.0.1</code></li>
//                 <li><code className="bg-gray-100 px-1 rounded">127.0.0.1</code></li>
//               </ul>
//             </div>
//             <div>
//               <strong>Valid IPv6:</strong>
//               <ul className="ml-4 mt-1 space-y-1 text-gray-600">
//                 <li><code className="bg-gray-100 px-1 rounded">2001:db8::1</code></li>
//                 <li><code className="bg-gray-100 px-1 rounded">::1</code></li>
//                 <li><code className="bg-gray-100 px-1 rounded">fe80::1%lo0</code> (with zone ID)</li>
//                 <li><code className="bg-gray-100 px-1 rounded">2001:db8:85a3::8a2e:370:7334</code></li>
//               </ul>
//             </div>
//           </div>
//         </div>
//       </div>
//     </div>
//   );
// };



```

<!-- path: hnvtx/components/common/form/SectionCard.tsx -->
```typescript
import { ReactNode } from "react";
import { cn } from "@/utils/classNames";

interface SectionCardProps {
  title: string;
  icon?: ReactNode;
  children: ReactNode;
  className?: string;
}

export default function SectionCard({
  title,
  icon,
  children,
  className,
}: SectionCardProps) {
  return (
    <div
      className={cn(
        "border rounded-xl p-4 space-y-4 bg-white shadow-sm",
        "transition-all duration-200 hover:shadow-md",
        className
      )}
    >
      <div className="flex items-center space-x-2 border-b pb-2">
        {icon && <span className="text-xl text-primary">{icon}</span>}
        <h3 className="font-semibold text-gray-800 text-base">{title}</h3>
      </div>
      <div className="grid gap-4">{children}</div>
    </div>
  );
}

```

<!-- path: hnvtx/components/ofc/hooks/index.ts -->
```typescript
export * from "./useNodesPageState";
export * from "./useNodesTableActions";

```

<!-- path: hnvtx/components/ofc/hooks/useNodesTableActions.ts -->
```typescript
import { FiEdit2 } from "react-icons/fi";
// hooks/useNodesTableActions.ts
import { useMemo, createElement } from "react";
import { Row } from "@/hooks/database";
import { NodeWithRelations } from "@/components/nodes/nodes_types";
import { FiToggleRight, FiToggleLeft, FiTrash2 } from "react-icons/fi";

interface UseNodesTableActionsProps {
  onEdit: (node: NodeWithRelations) => void;
  onToggleStatus: (id: string, status: boolean) => void;
  onDelete: (id: string, name: string) => void;
}

export const useNodesTableActions = ({ onEdit, onToggleStatus, onDelete }: UseNodesTableActionsProps) => {
  return useMemo(
    () => [
      {
        key: "edit",
        label: "Edit",
        onClick: (record: Row<"nodes">) => onEdit(record as NodeWithRelations),
        icon: createElement(FiEdit2),
      },
      {
        key: "activate",
        label: "Activate",
        hidden: (r: Row<"nodes">) => Boolean((r as any).status) === true,
        onClick: (r: Row<"nodes">) => onToggleStatus((r as any).id, true),
        icon: createElement(FiToggleRight),
      },
      {
        key: "deactivate",
        label: "Deactivate",
        hidden: (r: Row<"nodes">) => Boolean((r as any).status) === false,
        onClick: (r: Row<"nodes">) => onToggleStatus((r as any).id, false),
        icon: createElement(FiToggleLeft),
      },
      {
        key: "delete",
        label: "Delete",
        variant: "danger" as const,
        onClick: (r: Row<"nodes">) => onDelete((r as any).id, String((r as any).name ?? "this node")),
        icon: createElement(FiTrash2),
      },
    ],
    [onEdit, onToggleStatus, onDelete]
  );
};

```

<!-- path: hnvtx/components/ofc/hooks/useNodesPageState.ts -->
```typescript
// hooks/useNodesPageState.ts
import { useState, useCallback } from 'react';
import { NodeWithRelations } from '@/components/nodes/nodes_types';
import { NodesFilters } from '@/components/nodes/nodes_types';
import { DEFAULTS } from '@/config/constants';

export const useNodesPageState = () => {
  const [searchTerm, setSearchTerm] = useState("");
  const [currentPage, setCurrentPage] = useState(1);
  const [pageLimit, setPageLimit] = useState(DEFAULTS.PAGE_SIZE);
  const [filters, setFilters] = useState<NodesFilters>({});
  const [isFormOpen, setFormOpen] = useState(false);
  const [editingNode, setEditingNode] = useState<NodeWithRelations | null>(null);

  const resetPagination = useCallback(() => setCurrentPage(1), []);

  const openCreateForm = useCallback(() => {
    setEditingNode(null);
    setFormOpen(true);
  }, []);

  const openEditForm = useCallback((node: NodeWithRelations) => {
    setEditingNode(node);
    setFormOpen(true);
  }, []);

  const closeForm = useCallback(() => {
    setFormOpen(false);
    setEditingNode(null);
  }, []);

  const updateFilters = useCallback((newFilters: Partial<NodesFilters>) => {
    setFilters(prev => ({ ...prev, ...newFilters }));
    resetPagination();
  }, [resetPagination]);

  const updatePagination = useCallback((page: number, pageSize: number) => {
    setCurrentPage(page);
    setPageLimit(pageSize);
  }, []);

  return {
    // State
    searchTerm,
    currentPage,
    pageLimit,
    filters,
    isFormOpen,
    editingNode,
    
    // Actions
    setSearchTerm,
    resetPagination,
    openCreateForm,
    openEditForm,
    closeForm,
    updateFilters,
    updatePagination,
  };
};
```

<!-- path: hnvtx/components/ofc/ofc-types.ts -->
```typescript
import { Database } from "@/types/supabase-types";

export interface OfcCablesFilters {
  search: string;
  ofc_type_id: string;
  status: "true" | "false" | "";
  maintenance_terminal_id: string;
}

// FIX: This type now correctly includes the optional 'total_count' field 
// which is added by the useTableQuery hook when `includeCount` is true.
export type OfcCablesWithRelations = 
  Database["public"]["Views"]["v_ofc_cables_complete"]["Row"] & {
  total_count?: number;
  active_count?: number;
  inactive_count?: number;
  // NOTE: These fields exist on the base table `ofc_cables` and are used by
  // `OfcForm` for initializing edit state, but they are not present in the
  // generated View Row type. Keep them optional to avoid lying about what the
  // view guarantees while allowing the component to reference them safely.
  sn_id?: string | null;
  en_id?: string | null;
  ofc_type: {
    id: string;
    name: string;
  } | null;
  maintenance_area: {
    id: string;
    name: string;
  } | null;
};


```

<!-- path: hnvtx/components/ofc/RouteEvolutionManager.tsx -->
```typescript
import { useState, useEffect } from 'react';

interface ExistingRoute {
  id: string;
  route_name: string;
  capacity: number;
  start_node: string;
  end_node: string;
  current_rkm: number;
  status: boolean;
  // New fields for evolution tracking
  evolution_status: 'simple' | 'with_jcs' | 'fully_segmented';
  has_active_segments: boolean;
}

interface JunctionClosure {
  id: string;
  name: string;
  latitude: number;
  longitude: number;
  jc_type: 'inline' | 'branching' | 'terminal';
  capacity: number;
  parent_route_id: string;
  position_on_route: number; // 0-100%
  status: boolean;
}

interface CableSegment {
  id: string;
  original_route_id: string;
  segment_order: number;
  start_point_id: string;
  end_point_id: string;
  start_point_type: 'node' | 'jc';
  end_point_type: 'node' | 'jc';
  fiber_count: number;
  distance_km: number;
  is_active: boolean;
}

interface FiberSplice {
  id: string;
  jc_id: string;
  incoming_segment_id: string;
  incoming_fiber_number: number;
  outgoing_segment_id: string;
  outgoing_fiber_number: number;
  splice_type: 'through' | 'tap' | 'split';
  splice_date: string;
  loss_db: number;
  status: 'active' | 'spare' | 'faulty';
}

const RouteEvolutionManager = () => {
  const [selectedRoute, setSelectedRoute] = useState<ExistingRoute | null>(null);
  const [evolutionMode, setEvolutionMode] = useState<'view' | 'add_jc' | 'configure_splices' | 'commit'>('view');
  const [jcsOnRoute, setJcsOnRoute] = useState<JunctionClosure[]>([]);
  const [projectedSegments, setProjectedSegments] = useState<CableSegment[]>([]);
  const [projectedSplices, setProjectedSplices] = useState<FiberSplice[]>([]);
  
  // Mock existing routes with evolution status
  const [existingRoutes] = useState<ExistingRoute[]>([
    {
      id: 'route-1',
      route_name: 'NodeA ⇔ NodeB _ 1',
      capacity: 24,
      start_node: 'NodeA',
      end_node: 'NodeB',
      current_rkm: 15.5,
      status: true,
      evolution_status: 'simple',
      has_active_segments: false
    },
    {
      id: 'route-2', 
      route_name: 'NodeC ⇔ NodeD _ 1',
      capacity: 48,
      start_node: 'NodeC',
      end_node: 'NodeD', 
      current_rkm: 22.3,
      status: true,
      evolution_status: 'with_jcs',
      has_active_segments: false
    },
    {
      id: 'route-3',
      route_name: 'NodeE ⇔ NodeF _ 1',
      capacity: 96,
      start_node: 'NodeE',
      end_node: 'NodeF',
      current_rkm: 8.7,
      status: true,
      evolution_status: 'fully_segmented',
      has_active_segments: true
    }
  ]);

  const [newJC, setNewJC] = useState({
    name: '',
    latitude: 0,
    longitude: 0,
    jc_type: 'inline' as const,
    capacity: 24,
    position_on_route: 50
  });

  // Load existing JCs for selected route
  useEffect(() => {
    if (!selectedRoute) {
      setJcsOnRoute([]);
      return;
    }

    // Mock loading existing JCs for the route
    if (selectedRoute.evolution_status === 'with_jcs' || selectedRoute.evolution_status === 'fully_segmented') {
      // This would be a real API call: loadJCsForRoute(selectedRoute.id)
      const mockExistingJCs: JunctionClosure[] = [
        {
          id: 'jc-existing-1',
          name: 'JC-001',
          latitude: 23.5254,
          longitude: 87.2926,
          jc_type: 'inline',
          capacity: 24,
          parent_route_id: selectedRoute.id,
          position_on_route: 33,
          status: true
        }
      ];
      setJcsOnRoute(selectedRoute.id === 'route-2' ? mockExistingJCs : []);
    } else {
      setJcsOnRoute([]);
    }
  }, [selectedRoute]);

  // Generate projected segments when JCs change
  useEffect(() => {
    if (!selectedRoute) {
      setProjectedSegments([]);
      return;
    }

    // Sort JCs by position on route
    const sortedJCs = [...jcsOnRoute]
      .filter(jc => jc.status)
      .sort((a, b) => a.position_on_route - b.position_on_route);
    
    const segments: CableSegment[] = [];
    let segmentOrder = 1;

    // Create all route points (start node → JCs → end node)
    const allPoints = [
      { 
        id: selectedRoute.start_node, 
        type: 'node' as const, 
        name: selectedRoute.start_node,
        position: 0 
      },
      ...sortedJCs.map(jc => ({ 
        id: jc.id, 
        type: 'jc' as const, 
        name: jc.name,
        position: jc.position_on_route 
      })),
      { 
        id: selectedRoute.end_node, 
        type: 'node' as const, 
        name: selectedRoute.end_node,
        position: 100 
      }
    ];

    // Generate segments between consecutive points
    for (let i = 0; i < allPoints.length - 1; i++) {
      const startPoint = allPoints[i];
      const endPoint = allPoints[i + 1];
      const segmentDistance = selectedRoute.current_rkm * (endPoint.position - startPoint.position) / 100;

      segments.push({
        id: `segment-${selectedRoute.id}-${segmentOrder}`,
        original_route_id: selectedRoute.id,
        segment_order: segmentOrder,
        start_point_id: startPoint.id,
        end_point_id: endPoint.id,
        start_point_type: startPoint.type,
        end_point_type: endPoint.type,
        fiber_count: selectedRoute.capacity,
        distance_km: Math.round(segmentDistance * 100) / 100,
        is_active: true
      });
      segmentOrder++;
    }

    setProjectedSegments(segments);
  }, [selectedRoute, jcsOnRoute]);

  const addJCToRoute = () => {
    if (!newJC.name || !selectedRoute) return;

    const jc: JunctionClosure = {
      id: `jc-${Date.now()}`,
      name: newJC.name,
      latitude: newJC.latitude,
      longitude: newJC.longitude,
      jc_type: newJC.jc_type,
      capacity: newJC.capacity,
      parent_route_id: selectedRoute.id,
      position_on_route: newJC.position_on_route,
      status: true
    };

    setJcsOnRoute([...jcsOnRoute, jc]);
    
    // Reset form
    setNewJC({
      name: '',
      latitude: 0,
      longitude: 0,
      jc_type: 'inline',
      capacity: 24,
      position_on_route: 50
    });
  };

  const removeJC = (jcId: string) => {
    setJcsOnRoute(jcsOnRoute.filter(jc => jc.id !== jcId));
  };

  const generateDefaultSplices = () => {
    const splices: FiberSplice[] = [];
    
    projectedSegments.forEach((segment, segIndex) => {
      if (segment.end_point_type === 'jc') {
        const nextSegment = projectedSegments[segIndex + 1];
        if (nextSegment) {
          // Create through splices for all fibers by default
          for (let fiberNum = 1; fiberNum <= segment.fiber_count; fiberNum++) {
            splices.push({
              id: `splice-${segment.id}-${nextSegment.id}-${fiberNum}`,
              jc_id: segment.end_point_id,
              incoming_segment_id: segment.id,
              incoming_fiber_number: fiberNum,
              outgoing_segment_id: nextSegment.id,
              outgoing_fiber_number: fiberNum,
              splice_type: 'through',
              splice_date: new Date().toISOString().split('T')[0],
              loss_db: 0.1,
              status: 'active'
            });
          }
        }
      }
    });

    setProjectedSplices(splices);
  };

  const commitEvolution = async () => {
    if (!selectedRoute || jcsOnRoute.length === 0) return;

    const evolutionData = {
      originalRoute: selectedRoute,
      junctionClosures: jcsOnRoute,
      cableSegments: projectedSegments,
      fiberSplices: projectedSplices,
      evolutionType: 'add_jc_and_segment',
      notes: `Added ${jcsOnRoute.length} JCs and split into ${projectedSegments.length} segments`
    };

    // This would be your actual API calls:
    // await createJunctionClosures(jcsOnRoute);
    // await createCableSegments(projectedSegments);
    // await createFiberSplices(projectedSplices);
    // await logRouteEvolution(evolutionData);
    // await updateRouteStatus(selectedRoute.id, { evolution_status: 'fully_segmented' });
    
    console.log('Evolution data to commit:', evolutionData);
    alert('Route evolution committed! Check console for details.');
    
    // Reset form
    setSelectedRoute(null);
    setJcsOnRoute([]);
    setEvolutionMode('view');
  };

  const getEvolutionStatusColor = (status: string) => {
    switch (status) {
      case 'simple': return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200';
      case 'with_jcs': return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200';
      case 'fully_segmented': return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
      default: return 'bg-gray-100 text-gray-800';
    }
  };

  return (
    <div className="max-w-7xl mx-auto p-6 bg-white dark:bg-gray-900">
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-2">
          Route Evolution Manager v2
        </h1>
        <p className="text-gray-600 dark:text-gray-400">
          Evolve simple routes by adding Junction Closures and creating cable segments
        </p>
      </div>

      {/* Route Selection */}
      <div className="mb-6">
        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          Select Route to Evolve
        </label>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {existingRoutes.map(route => (
            <div
              key={route.id}
              onClick={() => {
                setSelectedRoute(route);
                setEvolutionMode('view');
              }}
              className={`p-4 border-2 rounded-lg cursor-pointer transition-all ${
                selectedRoute?.id === route.id
                  ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'
                  : 'border-gray-200 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-700'
              }`}
            >
              <div className="font-medium text-gray-900 dark:text-white mb-2">
                {route.route_name}
              </div>
              <div className="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                <div>{route.capacity} fibers • {route.current_rkm} km</div>
                <div className="flex justify-between items-center">
                  <span>{route.start_node} → {route.end_node}</span>
                  <span className={`px-2 py-1 rounded text-xs ${getEvolutionStatusColor(route.evolution_status)}`}>
                    {route.evolution_status.replace('_', ' ')}
                  </span>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      {selectedRoute && (
        <div className="grid grid-cols-1 xl:grid-cols-3 gap-6">
          {/* Left Panel - Route Info & Actions */}
          <div className="space-y-6">
            <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
              <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-3">
                Route Details
              </h3>
              <div className="space-y-2 text-sm">
                <div className="flex justify-between">
                  <span className="text-gray-600 dark:text-gray-400">ID:</span>
                  <span className="text-gray-900 dark:text-white font-mono text-xs">{selectedRoute.id}</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-gray-600 dark:text-gray-400">Name:</span>
                  <span className="text-gray-900 dark:text-white font-mono">{selectedRoute.route_name}</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-gray-600 dark:text-gray-400">Capacity:</span>
                  <span className="text-gray-900 dark:text-white">{selectedRoute.capacity} fibers</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-gray-600 dark:text-gray-400">Distance:</span>
                  <span className="text-gray-900 dark:text-white">{selectedRoute.current_rkm} km</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-gray-600 dark:text-gray-400">Status:</span>
                  <span className={`px-2 py-1 rounded text-xs ${getEvolutionStatusColor(selectedRoute.evolution_status)}`}>
                    {selectedRoute.evolution_status.replace('_', ' ')}
                  </span>
                </div>
              </div>
            </div>

            {/* Evolution Actions */}
            <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
              <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-3">
                Evolution Actions
              </h3>
              <div className="space-y-2">
                <button
                  onClick={() => setEvolutionMode('add_jc')}
                  disabled={selectedRoute.evolution_status === 'fully_segmented'}
                  className={`w-full p-2 rounded-md text-left text-sm ${
                    evolutionMode === 'add_jc' 
                      ? 'bg-blue-500 text-white' 
                      : 'bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed'
                  }`}
                >
                  📍 Add Junction Closure
                </button>
                <button
                  onClick={() => {
                    generateDefaultSplices();
                    setEvolutionMode('configure_splices');
                  }}
                  disabled={jcsOnRoute.length === 0}
                  className={`w-full p-2 rounded-md text-left text-sm ${
                    evolutionMode === 'configure_splices' 
                      ? 'bg-blue-500 text-white' 
                      : 'bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed'
                  }`}
                >
                  🔌 Configure Splices
                </button>
                <button
                  onClick={() => setEvolutionMode('commit')}
                  disabled={jcsOnRoute.length === 0 || projectedSegments.length === 0}
                  className={`w-full p-2 rounded-md text-left text-sm ${
                    evolutionMode === 'commit' 
                      ? 'bg-purple-500 text-white' 
                      : 'bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed'
                  }`}
                >
                  ✅ Review & Commit
                </button>
              </div>
            </div>

            {/* Add JC Form */}
            {evolutionMode === 'add_jc' && (
              <div className="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800">
                <h4 className="font-semibold text-gray-900 dark:text-white mb-3">Add New Junction Closure</h4>
                <div className="space-y-3">
                  <div>
                    <label className="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
                      JC Name *
                    </label>
                    <input
                      type="text"
                      value={newJC.name}
                      onChange={(e) => setNewJC({...newJC, name: e.target.value})}
                      placeholder="JC-ABC-001"
                      className="w-full p-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                    />
                  </div>
                  
                  <div className="grid grid-cols-2 gap-2">
                    <div>
                      <label className="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
                        Latitude
                      </label>
                      <input
                        type="number"
                        step="0.000001"
                        value={newJC.latitude || ''}
                        onChange={(e) => setNewJC({...newJC, latitude: Number(e.target.value)})}
                        className="w-full p-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                      />
                    </div>
                    <div>
                      <label className="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
                        Longitude
                      </label>
                      <input
                        type="number"
                        step="0.000001"
                        value={newJC.longitude || ''}
                        onChange={(e) => setNewJC({...newJC, longitude: Number(e.target.value)})}
                        className="w-full p-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                      />
                    </div>
                  </div>

                  <div>
                    <label className="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
                      Position on Route: {newJC.position_on_route}%
                    </label>
                    <input
                      type="range"
                      min="5"
                      max="95"
                      value={newJC.position_on_route}
                      onChange={(e) => setNewJC({...newJC, position_on_route: Number(e.target.value)})}
                      className="w-full"
                    />
                    <div className="text-xs text-gray-500 dark:text-gray-400 text-center">
                      ~{(selectedRoute.current_rkm * newJC.position_on_route / 100).toFixed(1)} km from {selectedRoute.start_node}
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-2">
                    <div>
                      <label className="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
                        JC Type
                      </label>
                      <select
                        value={newJC.jc_type}
                        onChange={(e) => setNewJC({...newJC, jc_type: e.target.value as any})}
                        className="w-full p-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                      >
                        <option value="inline">Inline</option>
                        <option value="branching">Branching</option>
                        <option value="terminal">Terminal</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
                        Splice Capacity
                      </label>
                      <select
                        value={newJC.capacity}
                        onChange={(e) => setNewJC({...newJC, capacity: Number(e.target.value)})}
                        className="w-full p-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                      >
                        <option value={24}>24 splice</option>
                        <option value={48}>48 splice</option>
                        <option value={96}>96 splice</option>
                        <option value={144}>144 splice</option>
                      </select>
                    </div>
                  </div>

                  <button
                    onClick={addJCToRoute}
                    disabled={!newJC.name || newJC.latitude === 0 || newJC.longitude === 0}
                    className="w-full p-2 bg-green-500 text-white rounded-md hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-sm"
                  >
                    Add JC to Route
                  </button>
                </div>
              </div>
            )}
          </div>

          {/* Middle Panel - Route Visualization */}
          <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
            <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4">
              Route Visualization
            </h3>
            
            {selectedRoute && (
              <div className="space-y-4">
                {/* Route Path Diagram */}
                <div className="relative">
                  <div className="flex items-center space-x-2 overflow-x-auto pb-4">
                    {/* Start Node */}
                    <div className="flex-shrink-0 text-center">
                      <div className="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-xs">
                        N
                      </div>
                      <div className="text-xs mt-1 text-gray-600 dark:text-gray-400 max-w-16 truncate">
                        {selectedRoute.start_node}
                      </div>
                      <div className="text-xs text-gray-500">0%</div>
                    </div>

                    {/* JCs along the route */}
                    {jcsOnRoute
                      .filter(jc => jc.status)
                      .sort((a, b) => a.position_on_route - b.position_on_route)
                      .map((jc) => (
                        <div key={jc.id} className="flex items-center">
                          <div className="w-16 h-0.5 bg-gray-400"></div>
                          <div className="flex-shrink-0 text-center relative">
                            <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white text-xs font-bold ${
                              jc.jc_type === 'branching' ? 'bg-orange-500' : 
                              jc.jc_type === 'terminal' ? 'bg-red-500' : 'bg-green-500'
                            }`}>
                              JC
                            </div>
                            <div className="text-xs mt-1 text-gray-600 dark:text-gray-400 max-w-16 truncate">
                              {jc.name}
                            </div>
                            <div className="text-xs text-gray-500">{jc.position_on_route}%</div>
                            {evolutionMode === 'add_jc' && (
                              <button
                                onClick={() => removeJC(jc.id)}
                                className="absolute -top-2 -right-2 w-4 h-4 bg-red-500 text-white rounded-full text-xs hover:bg-red-600"
                              >
                                ×
                              </button>
                            )}
                          </div>
                        </div>
                      ))}

                    {/* End Node */}
                    <div className="flex items-center">
                      <div className="w-16 h-0.5 bg-gray-400"></div>
                      <div className="flex-shrink-0 text-center">
                        <div className="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-xs">
                          N
                        </div>
                        <div className="text-xs mt-1 text-gray-600 dark:text-gray-400 max-w-16 truncate">
                          {selectedRoute.end_node}
                        </div>
                        <div className="text-xs text-gray-500">100%</div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* JCs Summary */}
                {jcsOnRoute.length > 0 && (
                  <div className="space-y-2">
                    <div className="text-sm font-medium text-gray-700 dark:text-gray-300">
                      Junction Closures on Route:
                    </div>
                    {jcsOnRoute.map((jc) => (
                      <div key={jc.id} className="flex justify-between items-center text-xs p-2 bg-white dark:bg-gray-700 rounded">
                        <span className="font-medium">{jc.name}</span>
                        <div className="flex items-center space-x-2">
                          <span className={`px-2 py-1 rounded ${
                            jc.jc_type === 'branching' ? 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200' : 
                            jc.jc_type === 'terminal' ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200' : 
                            'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'
                          }`}>
                            {jc.jc_type}
                          </span>
                          <span className="text-gray-500">{jc.capacity}f</span>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}
          </div>

          {/* Right Panel - Projected Segments */}
          <div className="xl:col-span-2 space-y-4">
            <div className="flex justify-between items-center">
              <h3 className="text-lg font-semibold text-gray-900 dark:text-white">
                {evolutionMode === 'configure_splices' ? 'Splice Configuration' : 'Projected Cable Segments'}
              </h3>
              {evolutionMode === 'commit' && (
                <button
                  onClick={commitEvolution}
                  className="px-6 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 font-medium"
                >
                  Commit Evolution
                </button>
              )}
            </div>

            {evolutionMode === 'configure_splices' && projectedSplices.length > 0 ? (
              <div className="space-y-4">
                <div className="text-sm text-gray-600 dark:text-gray-400 mb-4">
                  Configure fiber splicing at each Junction Closure. Default: all fibers pass through.
                </div>
                {/* Splice Configuration Table */}
<div className="overflow-x-auto">
  <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
    <thead className="bg-gray-50 dark:bg-gray-800">
      <tr>
        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">JC</th>
        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Incoming Segment</th>
        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Outgoing Segment</th>
        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Fiber</th>
        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Splice Type</th>
        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
      </tr>
    </thead>
    <tbody className="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">
      {projectedSplices.map((splice) => {
        const jc = jcsOnRoute.find(j => j.id === splice.jc_id);
        const incomingSegment = projectedSegments.find(s => s.id === splice.incoming_segment_id);
        const outgoingSegment = projectedSegments.find(s => s.id === splice.outgoing_segment_id);
        
        return (
          <tr key={splice.id} className="hover:bg-gray-50 dark:hover:bg-gray-800">
            <td className="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">
              {jc?.name || 'Unknown JC'}
            </td>
            <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              {incomingSegment?.start_point_id} → {incomingSegment?.end_point_id}
            </td>
            <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              {outgoingSegment?.start_point_id} → {outgoingSegment?.end_point_id}
            </td>
            <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              #{splice.incoming_fiber_number} → #{splice.outgoing_fiber_number}
            </td>
            <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              <select
                value={splice.splice_type}
                onChange={(e) => {
                  const updatedSplices = projectedSplices.map(s => 
                    s.id === splice.id ? {...s, splice_type: e.target.value as any} : s
                  );
                  setProjectedSplices(updatedSplices);
                }}
                className="border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white p-1 text-xs"
              >
                <option value="through">Through</option>
                <option value="tap">Tap</option>
                <option value="split">Split</option>
              </select>
            </td>
            <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
              <select
                value={splice.status}
                onChange={(e) => {
                  const updatedSplices = projectedSplices.map(s => 
                    s.id === splice.id ? {...s, status: e.target.value as any} : s
                  );
                  setProjectedSplices(updatedSplices);
                }}
                className="border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white p-1 text-xs"
              >
                <option value="active">Active</option>
                <option value="spare">Spare</option>
                <option value="faulty">Faulty</option>
              </select>
            </td>
          </tr>
        );
      })}
    </tbody>
  </table>
</div>

<div className="flex justify-end space-x-3 mt-4">
  <button
    onClick={() => setEvolutionMode('add_jc')}
    className="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"
  >
    Back to JCs
  </button>
  <button
    onClick={() => setEvolutionMode('commit')}
    className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
  >
    Review & Continue
  </button>
</div>
</div>
) : evolutionMode === 'commit' ? (
<div className="space-y-4">
  <div className="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800">
    <h4 className="font-semibold text-blue-800 dark:text-blue-200 mb-2">Ready to Commit</h4>
    <p className="text-sm text-blue-700 dark:text-blue-300">
      This will permanently update the route structure with {jcsOnRoute.length} new junction closures and {projectedSegments.length} cable segments.
    </p>
  </div>

  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div className="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
      <h4 className="font-semibold text-gray-900 dark:text-white mb-3">Junction Closures</h4>
      <ul className="space-y-2">
        {jcsOnRoute.map(jc => (
          <li key={jc.id} className="flex justify-between text-sm">
            <span className="font-medium">{jc.name}</span>
            <span className="text-gray-600 dark:text-gray-400">{jc.position_on_route}% position</span>
          </li>
        ))}
      </ul>
    </div>

    <div className="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
      <h4 className="font-semibold text-gray-900 dark:text-white mb-3">Cable Segments</h4>
      <ul className="space-y-2">
        {projectedSegments.map(segment => (
          <li key={segment.id} className="flex justify-between text-sm">
            <span>
              {segment.start_point_type === 'node' ? 'N' : 'JC'}-{segment.start_point_id} → 
              {segment.end_point_type === 'node' ? 'N' : 'JC'}-{segment.end_point_id}
            </span>
            <span className="text-gray-600 dark:text-gray-400">{segment.distance_km} km</span>
          </li>
        ))}
      </ul>
    </div>
  </div>

  {projectedSplices.length > 0 && (
    <div className="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
      <h4 className="font-semibold text-gray-900 dark:text-white mb-3">Splice Summary</h4>
      <div className="grid grid-cols-3 gap-4 text-sm">
        <div className="text-center">
          <div className="text-2xl font-bold text-green-600 dark:text-green-400">
            {projectedSplices.filter(s => s.status === 'active').length}
          </div>
          <div className="text-gray-600 dark:text-gray-400">Active</div>
        </div>
        <div className="text-center">
          <div className="text-2xl font-bold text-blue-600 dark:text-blue-400">
            {projectedSplices.filter(s => s.status === 'spare').length}
          </div>
          <div className="text-gray-600 dark:text-gray-400">Spare</div>
        </div>
        <div className="text-center">
          <div className="text-2xl font-bold text-red-600 dark:text-red-400">
            {projectedSplices.filter(s => s.status === 'faulty').length}
          </div>
          <div className="text-gray-600 dark:text-gray-400">Faulty</div>
        </div>
      </div>
    </div>
  )}
</div>
) : projectedSegments.length > 0 ? (
<div className="overflow-x-auto">
  <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
    <thead className="bg-gray-50 dark:bg-gray-800">
      <tr>
        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Segment</th>
        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Path</th>
        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Distance</th>
        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Fibers</th>
        <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
      </tr>
    </thead>
    <tbody className="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">
      {projectedSegments.map((segment) => (
        <tr key={segment.id} className="hover:bg-gray-50 dark:hover:bg-gray-800">
          <td className="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">
            #{segment.segment_order}
          </td>
          <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
            {segment.start_point_type === 'node' ? 'N' : 'JC'}-{segment.start_point_id} → 
            {segment.end_point_type === 'node' ? 'N' : 'JC'}-{segment.end_point_id}
          </td>
          <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
            {segment.distance_km} km
          </td>
          <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
            {segment.fiber_count}f
          </td>
          <td className="px-4 py-3 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
            <span className={`px-2 py-1 rounded text-xs ${
              segment.is_active ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200'
            }`}>
              {segment.is_active ? 'Active' : 'Inactive'}
            </span>
          </td>
        </tr>
      ))}
    </tbody>
  </table>
</div>
) : (
<div className="bg-gray-50 dark:bg-gray-800 p-8 rounded-lg text-center">
  <div className="text-gray-500 dark:text-gray-400 mb-4">
    <svg className="mx-auto h-12 w-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
  </div>
  <h4 className="text-lg font-medium text-gray-900 dark:text-white mb-1">
    No Segments Projected
  </h4>
  <p className="text-sm text-gray-500 dark:text-gray-400">
    Add junction closures to the route to generate cable segments.
  </p>
</div>
)}
</div>
</div>
)}
</div>
);
};

export default RouteEvolutionManager;
```

<!-- path: hnvtx/components/ofc/DRY-guide-ofc.md -->
```markdown
# DRY Guide: Building Data Pages (based on Rings & Employees)

This guide outlines patterns from `app/dashboard/rings/page.tsx` and `app/dashboard/employees/page.tsx` to help build future CRUD/data pages with minimal duplication.

## Core Building Blocks

- __Data access hooks__ (`@/hooks/database`):
  - `useTableQuery()` for simple tables.
  - `useTableWithRelations()` when joining related tables (e.g., rings with lookup types and maintenance areas).
  - Mutations: `useTableInsert()`, `useTableUpdate()`, `useTableDelete()`, `useToggleStatus()`.
- __Table layer__ (`@/components/table/DataTable`):
  - Supports pagination, actions, selection, custom toolbar, export.
  - Columns defined separately per entity.
- __Columns__:
  - Employees: `components/employee/EmployeeTableColumns.tsx` via `getEmployeeTableColumns()`.
- __Filters UI__:
  - Employees: `components/employee/EmployeeFilters.tsx` (search + dropdowns), typed by `components/employee/employee-types.ts`.
- __Modals / Forms__:
  - Employees: `components/employee/EmployeeForm.tsx` and `EmployeeDetailsModal.tsx`.

## Page Skeleton Template

1) __State__

- Pagination: `currentPage`, `pageLimit`.
- Filters: local UI state -> derived server filters (memoized).
- Debounced search: `useDebounce`/`useDebouncedCallback`.
- Selection (optional): selected IDs.
- Modal state: add/edit/view flags.

2) __Filters -> Server Filters__

- Keep a small UI type, e.g. `EmployeeFilters` with string fields.
- Derive DB filters with `useMemo`, convert empty to undefined.
- Example: employees maps `status` string to boolean.

3) __Data Fetch__

- Prefer `useTableQuery` for single-table lists.
- Use `useTableWithRelations` for joined displays (e.g., rings shows related `lookup_types` and `maintenance_areas`).
- Always pass `orderBy`, `limit`, `offset`.

4) __Total Count Strategy__

- If your hooks provide window `total_count`, read it.
- Fallback to HEAD count: `supabase.from(table).select("id", { count: "exact", head: true })`.
- Use max(windowCount, headCount, pageLen) to avoid undercount.

5) __Columns__

- Define per-entity `getXTableColumns()` function in a colocated `components/<entity>/` file.
- Use `Row<"table">` for types; for relations, use custom `render` functions casting as needed.
- Centralize formatting (e.g., `formatDate`) in `@/utils/formatters`.

6) __Actions__

- Build an array of row actions with keys, labels, icons, and `hidden` predicates.
- Use shared mutation hooks (toggle status, delete) and wrap confirmations in a generic modal (`ConfirmModal`).

7) __Toolbar__

- Compose filters component into a `customToolbar` for the `DataTable`.
- Leave `searchable=false` and `filterable=false` on `DataTable` if filtering handled externally.

8) __Modals / Forms__

- Add/Edit: open with `editingRecord` or `null` for create.
- On success, `refetch()` and close modal.

## Suggested Abstractions to Reuse

- __ListPageTemplate__ (optional HOC or component):
  - Props: `tableName`, `columns`, `queryHook`, `filtersUI`, `rowActions`, `header`, `exportOptions?`.
  - Internally handle pagination, debounced search, count calculation, and render `DataTable` with `customToolbar`.
- __FilterBuilder__ helpers:
  - Map UI filters to DB filters (e.g., `status: "true" | "false" | "" -> boolean | undefined`).
- __Lookup maps__ utilities:
  - `toIdNameMap(rows)` for fast rendering of related names in tables.

## Minimal Step-by-Step for a New Page

1. __Create columns__ in `components/<entity>/<Entity>TableColumns.ts(x)`.
2. __Create filters UI__ in `components/<entity>/<Entity>Filters.tsx` if needed.
3. __Create form/modal__ for add/edit if page is editable.
4. __Implement page__ `app/dashboard/<entity>/page.tsx`:
   - Local state: pagination, filters, modal flags.
   - Derive server filters via `useMemo`.
   - Fetch data with `useTableQuery` or `useTableWithRelations`.
   - Compute `totalCount` using window count + HEAD fallback.
   - Assemble `columns`, `actions`, and `customToolbar`.
   - Render `DataTable` with pagination handlers.
5. __Wire mutations__ via `useTableInsert`, `useTableUpdate`, `useTableDelete`, `useToggleStatus`.
6. __Test__ pagination, filtering, create/update/delete, toggling status.

## Example References

- Employees Page: `app/dashboard/employees/page.tsx`
  - Filters: `components/employee/EmployeeFilters.tsx`
  - Columns: `components/employee/EmployeeTableColumns.tsx`
  - Form/Details: `components/employee/EmployeeForm.tsx`, `EmployeeDetailsModal.tsx`

## Conventions

- Keep entity-specific code under `components/<entity>/`.
- Keep page logic under `app/dashboard/<entity>/page.tsx`.
- Use Tailwind utilities consistently; encapsulate repeated UI in shared components.
- Keep icons in page/components, not mixed into hooks.

## Checklist

- [X] Columns defined and typed
- [X] Filters UI working and mapped to DB
- [ ] Pagination state + handlers
- [ ] Accurate total count
- [ ] Row actions wired
- [ ] Modals open/close, refetch on success
- [ ] No duplicate logic (extract helpers if repeated)

```

<!-- path: hnvtx/components/ofc/OfcStats.tsx -->
```typescript
// app/dashboard/employees/components/EmployeeStats.tsx
interface OfcStatsProps {
    total: number;
    active: number;
    inactive: number;
  }
  
  export const OfcStats = ({ total, active, inactive }: OfcStatsProps) => {
    return (
      <div className="mt-6 flex items-center justify-between text-sm text-gray-600 dark:text-gray-400">
        <span>
          Showing {total} ofc cable{total !== 1 ? "s" : ""}
        </span>
        <span>
          {active} active, {inactive} inactive
        </span>
      </div>
    );
  };
```

<!-- path: hnvtx/components/ofc/OfcForm/RouteConfigurationSection.tsx -->
```typescript
// components/OfcForm/RouteConfigurationSection.tsx
import React from "react";
import { Zap } from "lucide-react";
import { Control, FieldErrors } from "react-hook-form";
import { FormSearchableSelect } from "@/components/common/form/FormControls";
import { Label } from "@/components/common/ui/label/Label";
import { Option } from "@/components/common/ui/select/SearchableSelect";
import { OfcCableFormData } from "@/schemas";
import FormSection from "./FormSection";

interface RouteConfigurationSectionProps {
  control: Control<OfcCableFormData>;
  errors: FieldErrors<OfcCableFormData>;
  startingNodeOptions: Option[];
  endingNodeOptions: Option[];
  routeName: string;
}

const RouteConfigurationSection: React.FC<RouteConfigurationSectionProps> = ({
  control,
  errors,
  startingNodeOptions,
  endingNodeOptions,
  routeName,
}) => (
  <FormSection title="Route Configuration" icon={Zap} iconColor="text-blue-600">
    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
      <FormSearchableSelect
        name="sn_id"
        label="Starting Node"
        control={control}
        options={startingNodeOptions}
        error={errors.sn_id}
        placeholder="Select starting node"
        searchPlaceholder="Search starting nodes..."
        aria-describedby="sn-id-help"
      />
      <div id="sn-id-help" className="sr-only">
        Select the starting point for this fiber optic cable route
      </div>

      <FormSearchableSelect
        name="en_id"
        label="Ending Node"
        control={control}
        options={endingNodeOptions}
        error={errors.en_id}
        placeholder="Select ending node"
        searchPlaceholder="Search ending nodes..."
        aria-describedby="en-id-help"
      />
      <div id="en-id-help" className="sr-only">
        Select the ending point for this fiber optic cable route
      </div>
    </div>

    {routeName && (
      <div className="mt-6 space-y-2">
        <Label className="text-gray-700 dark:text-gray-300 font-medium">
          Generated Route Name
        </Label>
        <div className="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-md px-3 py-2">
          <span className="text-blue-900 dark:text-blue-100 font-mono text-sm">
            {routeName}
          </span>
        </div>
      </div>
    )}
  </FormSection>
);

export default RouteConfigurationSection;
```

<!-- path: hnvtx/components/ofc/OfcForm/ExistingRoutesAlert.tsx -->
```typescript
// components/OfcForm/ExistingRoutesAlert.tsx
import React from "react";
import { AlertTriangle } from "lucide-react";

interface ExistingRoutesAlertProps {
  routes: string[];
}

const ExistingRoutesAlert: React.FC<ExistingRoutesAlertProps> = ({ routes }) => {
  if (!routes.length) return null;

  return (
    <div className="mb-6 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700 rounded-lg p-4">
      <div className="flex items-start space-x-3">
        <AlertTriangle className="w-5 h-5 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0" />
        <div className="flex-1">
          <h4 className="text-sm font-medium text-amber-800 dark:text-amber-200">
            Existing Routes Found
          </h4>
          <p className="text-sm text-amber-700 dark:text-amber-300 mt-1">
            {routes.length} cable route{routes.length > 1 ? "s" : ""} already exist between these nodes:
          </p>
          <ul className="mt-2 space-y-1 max-h-20 overflow-y-auto">
            {routes.map((route, index) => (
              <li
                key={index}
                className="text-sm text-amber-700 dark:text-amber-300 flex items-center space-x-2"
              >
                <span className="w-1.5 h-1.5 bg-amber-400 rounded-full flex-shrink-0" />
                <span className="font-mono truncate">{route}</span>
              </li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  );
};

export default ExistingRoutesAlert;
```

<!-- path: hnvtx/components/ofc/OfcForm/types/ofcForm.types.ts -->
```typescript
// types/ofcForm.types.ts
export interface FormLoadingState {
    nodes: boolean;
    ofcTypes: boolean;
    maintenanceTerminals: boolean;
    routeGeneration: boolean;
    form: boolean;
  }
  
  export interface NodeOption {
    id: string;
    name: string;
    nodeType: string;
    status: boolean;
  }
  
  export interface ValidationResult {
    isValid: boolean;
    errors: Record<string, string>;
    warnings?: Record<string, string>;
  }
```

<!-- path: hnvtx/components/ofc/OfcForm/constants/ofcFormConfig.ts -->
```typescript
// components/ofc/OfcForm/constants/ofcFormConfig.ts
export const OFC_FORM_CONFIG = {
  CAPACITY_OPTIONS: [
    { value: "2", label: "2" },
    { value: "4", label: "4" },
    { value: "6", label: "6" },
    { value: "12", label: "12" },
    { value: "24", label: "24" },
    { value: "48", label: "48" },
    { value: "96", label: "96" },
    { value: "144", label: "144" },
    { value: "288", label: "288" },
    { value: "576", label: "576" },
    { value: "864", label: "864" },
    { value: "1728", label: "1728" },
  ],

  ALLOWED_NODE_TYPES: [
    "Terminal Node",
    "Joint / Splice Point",
    "Base Transceiver Station",
    "Backhaul Hub / Block HQ",
    "Customer Premises",
    "Gram Panchayat",
  ],

  NODES_FETCH_LIMIT: 1000,
  CACHE_TIME: 5 * 60 * 1000, // 5 minutes
} as const;

```

<!-- path: hnvtx/components/ofc/OfcForm/hooks/useOfcFormData.ts -->
```typescript
"use client"

// components/ofc/OfcForm/hooks/useOfcFormData.ts
import { useEffect, useMemo, useRef } from "react";
import { useForm, type Resolver } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { OfcCableFormData, ofcCableFormSchema } from "@/schemas";
import { OfcCablesWithRelations } from "@/components/ofc/ofc-types";
import isEqual from "lodash.isequal";

export const useOfcFormData = (ofcCable?: OfcCablesWithRelations | null) => {
  const isEdit = Boolean(ofcCable);
  
  const defaultValues = useMemo(() => ({
    sn_id: undefined,
    en_id: undefined,
    route_name: "",
    ofc_type_id: "",
    capacity: 0,
    current_rkm: 0,
    transnet_rkm: 0,
    transnet_id: "",
    asset_no: "",
    maintenance_terminal_id: "",
    remark: "",
    status: true,
  }), []);

  const form = useForm<OfcCableFormData>({
    resolver: zodResolver(ofcCableFormSchema) as Resolver<OfcCableFormData>,
    mode: "onChange",
    defaultValues,
  });

  // Reset form when ofcCable changes or when switching from edit to create mode
useEffect(() => {
  if (isEdit && ofcCable) {
    form.reset({
      sn_id: ofcCable.sn_id ? String(ofcCable.sn_id) : undefined,
      en_id: ofcCable.en_id ? String(ofcCable.en_id) : undefined,
      route_name: ofcCable.route_name || "",
      ofc_type_id: ofcCable.ofc_type_id || "",
      capacity: ofcCable.capacity || 0,
      current_rkm: ofcCable.current_rkm || 0,
      transnet_rkm: ofcCable.transnet_rkm || 0,
      transnet_id: ofcCable.transnet_id || "",
      asset_no: ofcCable.asset_no || "",
      maintenance_terminal_id: ofcCable.maintenance_terminal_id || "",
      remark: ofcCable.remark || "",
      status: ofcCable.status ?? true,
    });
  } else if (!isEdit) {
    // Reset to default values when not in edit mode
    form.reset(defaultValues);
  }
}, [isEdit, ofcCable, form, defaultValues]);

  // Create a stable reference to the ofcCable data
  const ofcCableData = useMemo(() => {
    if (!isEdit || !ofcCable) return null;
    const data = {
      sn_id: ofcCable.sn_id ? String(ofcCable.sn_id) : undefined,
      en_id: ofcCable.en_id ? String(ofcCable.en_id) : undefined,
      route_name: ofcCable.route_name || "",
      ofc_type_id: ofcCable.ofc_type_id || "",
      capacity: ofcCable.capacity || 0,
      current_rkm: ofcCable.current_rkm || 0,
      transnet_rkm: ofcCable.transnet_rkm || 0,
      transnet_id: ofcCable.transnet_id || "",
      asset_no: ofcCable.asset_no || "",
      maintenance_terminal_id: ofcCable.maintenance_terminal_id || "",
      remark: ofcCable.remark || "",
      status: ofcCable.status ?? true,
    };
    return data;
  }, [isEdit, ofcCable]);

  // Track previous data to prevent unnecessary resets
  const prevOfcCableData = useRef(ofcCableData);
  const prevDefaultValues = useRef(defaultValues);
  const isInitialMount = useRef(true);

  // Reset form when ofcCable changes
  useEffect(() => {
    // Skip if this is the initial mount and we're in edit mode
    if (isInitialMount.current && isEdit) {
      isInitialMount.current = false;
      return;
    }

    // Skip if nothing has changed
    if (isEqual(prevOfcCableData.current, ofcCableData) && 
        isEqual(prevDefaultValues.current, defaultValues)) {
      return;
    }

    // Update refs
    prevOfcCableData.current = ofcCableData;
    prevDefaultValues.current = defaultValues;

    if (ofcCableData) {
      // In edit mode, use the existing data
      form.reset({
        ...ofcCableData,
        route_name: ofcCable?.route_name || ""
      }, {
        keepDirty: true,
        keepErrors: true,
      });
    } else {
      // In add mode, use default values
      form.reset({
        ...defaultValues,
        route_name: ""
      }, {
        keepDirty: true,
        keepErrors: true,
      });
    }
  }, [ofcCableData, form, defaultValues, ofcCable?.route_name, isEdit]);

  return { form, isEdit };
};
```

<!-- path: hnvtx/components/ofc/OfcForm/hooks/useRouteGeneration.ts -->
```typescript
"use client"

// components/ofc/OfcForm/hooks/useRouteGeneration.ts
import { useEffect, useMemo, useRef } from "react";
import { useTableQuery } from "@/hooks/database";
import { createClient } from "@/utils/supabase/client";
import { UseFormSetValue, FieldValues, Path, PathValue } from "react-hook-form";

interface UseRouteGenerationProps<T extends FieldValues> {
    startingNodeId: string | null;
    endingNodeId: string | null;
    nodesData: Array<{ id: string; name: string }> | undefined;
    isEdit: boolean;
    setValue: UseFormSetValue<T>;
}

export const useRouteGeneration = <T extends FieldValues>({
  startingNodeId,
  endingNodeId,
  nodesData,
  isEdit,
  setValue,
}: UseRouteGenerationProps<T>) => {
  // Use refs to track previous values and prevent unnecessary updates
  const prevStartingNodeId = useRef<string | null>(null);
  const prevEndingNodeId = useRef<string | null>(null);
  const prevIsEdit = useRef<boolean>(isEdit);
  const isInitialMount = useRef(true);
  const supabase = createClient();
  
  // Fetch existing routes between selected nodes
  const { data: existingRoutes, isLoading: existingRoutesLoading } = useTableQuery(
    supabase,
    "ofc_cables",
    {
      filters: startingNodeId && endingNodeId ? {
        $or: {
          operator: "or",
          value: `and(sn_id.eq.${startingNodeId},en_id.eq.${endingNodeId}),and(sn_id.eq.${endingNodeId},en_id.eq.${startingNodeId})`,
        },
      } : {},
      columns: "id, route_name",
      includeCount: true,
      enabled: Boolean(startingNodeId && endingNodeId),
      staleTime: 30000, // 30 seconds cache
    }
  );

  const routeData = useMemo(() => {
    const routes = existingRoutes || [];
    const routeCount = Array.isArray(routes) ? routes.length : 0;
    const nextRouteNumber = routeCount + 1;
    
    return {
      existingRoutes: routes.map((route: unknown) => (route as { route_name: string }).route_name),
      routeCount,
      nextRouteNumber,
    };
  }, [existingRoutes]);

  // Auto-generate route name for new cables
  useEffect(() => {
    // Skip if this is the initial mount and we're in edit mode
    if (isInitialMount.current) {
      if (isEdit) {
        isInitialMount.current = false;
        return;
      }
      isInitialMount.current = false;
    }

    // Skip if nothing has changed
    if (
      startingNodeId === prevStartingNodeId.current &&
      endingNodeId === prevEndingNodeId.current &&
      isEdit === prevIsEdit.current
    ) {
      return;
    }

    // Get current values before updating refs
    const prevStart = prevStartingNodeId.current;
    const prevEnd = prevEndingNodeId.current;
    const prevEdit = prevIsEdit.current;
    
    // Update refs with current values
    prevStartingNodeId.current = startingNodeId;
    prevEndingNodeId.current = endingNodeId;
    prevIsEdit.current = isEdit;

    // Skip if we're in edit mode and the route name is already set
    if (isEdit && startingNodeId && endingNodeId) {
      return;
    }

    // Only proceed if we have both nodes selected and we're not in edit mode
    if (!startingNodeId || !endingNodeId || isEdit) {
      // Only clear if we're not in the middle of a node change
      if ((!startingNodeId || !endingNodeId) && !existingRoutesLoading) {
        setValue("route_name" as Path<T>, "" as PathValue<T, Path<T>>, {
          shouldValidate: true,
          shouldDirty: true,
        });
      }
      return;
    }

    const startingNodeName = nodesData?.find(node => node.id === startingNodeId)?.name;
    const endingNodeName = nodesData?.find(node => node.id === endingNodeId)?.name;

    if (startingNodeName && endingNodeName) {
      // Only update if the nodes have actually changed
      if (prevStart !== startingNodeId || prevEnd !== endingNodeId || prevEdit !== isEdit) {
        const routeName = `${startingNodeName}⇔${endingNodeName}_${routeData.nextRouteNumber}`;
        setValue("route_name" as Path<T>, routeName as PathValue<T, Path<T>>, { 
          shouldValidate: true,
          shouldDirty: true,
        });
      }
    } else if (!existingRoutesLoading) {
      setValue("route_name" as Path<T>, "" as PathValue<T, Path<T>>, {
        shouldValidate: true,
        shouldDirty: true,
      });
    }  
  }, [
    startingNodeId, 
    endingNodeId, 
    routeData.nextRouteNumber, 
    isEdit, 
    setValue, 
    nodesData, 
    existingRoutesLoading
  ]);

  return {
    ...routeData,
    isLoading: existingRoutesLoading,
  };
};
```

<!-- path: hnvtx/components/ofc/OfcForm/hooks/useCapacityInference.ts -->
```typescript
"use client"

// components/ofc/OfcForm/hooks/useCapacityInference.ts
import { useEffect, useRef, useState } from "react";
import { Option } from "@/components/common/ui/select/SearchableSelect";
import { UseFormSetValue, Path, PathValue } from "react-hook-form";
import { OfcCableFormData } from "@/schemas";

interface UseCapacityInferenceProps<T extends OfcCableFormData> {
  currentOfcTypeId: string;
  ofcTypeOptions: Option[];
  setValue: UseFormSetValue<T>;
}

export const useCapacityInference = <T extends OfcCableFormData>({
  currentOfcTypeId,
  ofcTypeOptions,
  setValue,
}: UseCapacityInferenceProps<T>) => {
  const [isCapacityLocked, setIsCapacityLocked] = useState(false);
  const lastProcessedTypeId = useRef<string | null>(null);

  useEffect(() => {
    // Skip if we've already processed this OFC type ID
    if (lastProcessedTypeId.current === currentOfcTypeId) {
      return;
    }

    if (!currentOfcTypeId) {
      setIsCapacityLocked(false);
      lastProcessedTypeId.current = null;
      return;
    }

    const selectedOption = ofcTypeOptions.find(opt => opt.value === currentOfcTypeId);
    if (!selectedOption) {
      setIsCapacityLocked(false);
      lastProcessedTypeId.current = null;
      return;
    }

    const match = selectedOption.label.match(/(\d+)\s*F/i);
    if (match) {
      const inferredCapacity = parseInt(match[1], 10);
      // Only update if the value has changed
      setValue("capacity" as Path<T>, inferredCapacity as unknown as PathValue<T, Path<T>>, { 
        shouldValidate: true,
        shouldDirty: true,
        shouldTouch: true
      });
      setIsCapacityLocked(true);
      lastProcessedTypeId.current = currentOfcTypeId;
    } else {
      setIsCapacityLocked(false);
      lastProcessedTypeId.current = null;
    }
  }, [currentOfcTypeId, ofcTypeOptions, setValue]);

  return { isCapacityLocked };
};
```

<!-- path: hnvtx/components/ofc/OfcForm/CableSpecificationsSection.tsx -->
```typescript
// components/OfcForm/CableSpecificationsSection.tsx
import React from 'react';
import { FileText } from 'lucide-react';
import {
  Control,
  FieldErrors,
  UseFormRegister,
  UseFormSetValue,
  UseFormWatch,
} from 'react-hook-form';
import {
  FormInput,
  FormSearchableSelect,
  FormDateInput,
} from '@/components/common/form/FormControls';
import { Switch } from '@/components/common/ui/switch/Switch';
import { Label } from '@/components/common/ui/label/Label';
import { Option } from '@/components/common/ui/select/SearchableSelect';
import { OfcCableFormData } from '@/schemas';
import { OFC_FORM_CONFIG } from '@/components/ofc/OfcForm/constants/ofcFormConfig';
import FormSection from './FormSection';

interface CableSpecificationsSectionProps {
  control: Control<OfcCableFormData>;
  register: UseFormRegister<OfcCableFormData>;
  errors: FieldErrors<OfcCableFormData>;
  setValue: UseFormSetValue<OfcCableFormData>;
  watch: UseFormWatch<OfcCableFormData>;
  ofcTypeOptions: Option[];
  isCapacityLocked: boolean;
}

const CableSpecificationsSection: React.FC<CableSpecificationsSectionProps> = ({
  control,
  register,
  errors,
  setValue,
  watch,
  ofcTypeOptions,
  isCapacityLocked,
}) => {
  const currentStatus = watch('status');

  return (
    <FormSection
      title="Cable Specifications"
      icon={FileText}
      iconColor="text-green-600"
    >
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <FormInput
          name="asset_no"
          label="Asset Number"
          register={register}
          error={errors.asset_no}
          placeholder="Enter asset number"
        />

        <FormSearchableSelect
          name="ofc_type_id"
          label="OFC Type"
          control={control}
          options={ofcTypeOptions}
          error={errors.ofc_type_id}
          placeholder="Select OFC type"
          searchPlaceholder="Search OFC types..."
        />

        <div className="space-y-2">
          {isCapacityLocked ? (
            <FormInput
              name="capacity"
              label="Capacity"
              register={register}
              error={errors.capacity}
              placeholder="Capacity will be set from OFC type"
              type="number"
              disabled
            />
          ) : (
            <FormSearchableSelect
              name="capacity"
              control={control}
              label="Capacity"
              error={errors.capacity}
              placeholder="Select capacity"
              searchPlaceholder="Search capacities..."
              options={OFC_FORM_CONFIG.CAPACITY_OPTIONS as unknown as Option[]}
            />
          )}
          {isCapacityLocked && (
            <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
              Capacity inferred from selected OFC type and locked.
            </p>
          )}
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
        <FormInput
          name="current_rkm"
          label="Current RKM (km)"
          register={register}
          error={errors.current_rkm}
          placeholder="Enter current RKM"
          type="number"
          step="0.01"
        />

        <FormInput
          name="transnet_rkm"
          label="Transnet RKM (km)"
          register={register}
          error={errors.transnet_rkm}
          placeholder="Enter transnet RKM"
          type="number"
          step="0.01"
        />
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
        <FormInput
          name="transnet_id"
          label="Transnet ID"
          register={register}
          error={errors.transnet_id}
          placeholder="Enter transnet ID"
        />

        <FormDateInput
          name="commissioned_on"
          label="Commissioned Date"
          control={control}
          error={errors.commissioned_on}
          placeholder="Select commissioned date"
        />
      </div>

      <div className="flex items-center space-x-3 pt-6">
        <Switch
          id="status"
          checked={currentStatus ?? true}
          onChange={(checked: boolean) => setValue('status', checked)}
          className="dark:bg-gray-600"
        />
        <Label
          htmlFor="status"
          className="text-gray-700 dark:text-gray-300 font-medium"
        >
          <span
            className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
              currentStatus
                ? 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300'
                : 'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300'
            }`}
          >
            {currentStatus ? 'Active' : 'Inactive'}
          </span>
        </Label>
      </div>
    </FormSection>
  );
};

export default CableSpecificationsSection;

```

<!-- path: hnvtx/components/ofc/OfcForm/OfcForm.tsx -->
```typescript
// Main OfcForm component
import React, { useMemo } from "react";
import { TablesInsert } from "@/types/supabase-types";
import { Option } from "@/components/common/ui/select/SearchableSelect";
import { OfcCablesWithRelations } from "@/components/ofc/ofc-types";
import { usePagedNodesComplete, useTableQuery } from "@/hooks/database";
import { createClient } from "@/utils/supabase/client";
import { Modal } from "@/components/common/ui";
import { FormCard } from "@/components/common/form/FormCard";
import { useOfcFormData } from "./hooks/useOfcFormData";
import { OFC_FORM_CONFIG } from "@/components/ofc/OfcForm/constants/ofcFormConfig";
import { useRouteGeneration } from "@/components/ofc/OfcForm/hooks/useRouteGeneration";
import { useCapacityInference } from "@/components/ofc/OfcForm/hooks/useCapacityInference";
import { OfcCableFormData } from "@/schemas";
import LoadingOverlay from "@/components/ofc/OfcForm/LoadingOverlay";
import ExistingRoutesAlert from "@/components/ofc/OfcForm/ExistingRoutesAlert";
import RouteConfigurationSection from "@/components/ofc/OfcForm/RouteConfigurationSection";
import CableSpecificationsSection from "@/components/ofc/OfcForm/CableSpecificationsSection";
import MaintenanceSection from "@/components/ofc/OfcForm/MaintenanceSection";
import { PathValue } from "react-hook-form";


interface OfcFormProps {
  ofcCable?: OfcCablesWithRelations | null;
  onSubmit: (data: TablesInsert<"ofc_cables">) => void;
  onClose: () => void;
  pageLoading: boolean;
  isOpen: boolean;
}

const OfcForm: React.FC<OfcFormProps> = ({
  ofcCable,
  onSubmit,
  onClose,
  pageLoading,
  isOpen,
}) => {
  const supabase = createClient();
  const { form, isEdit } = useOfcFormData(ofcCable);
  const {
    handleSubmit,
    control,
    register,
    setValue,
    watch,
    formState: { errors },
  } = form;

  // Watch critical form values
  const startingNodeId = watch("sn_id") || null;
  const endingNodeId = watch("en_id") || null;
  const routeName = watch("route_name") || "";
  const currentOfcTypeId = watch("ofc_type_id") || "";

  // Data fetching with optimized queries
  const { data: nodesData, isLoading: nodesLoading } = usePagedNodesComplete(
    supabase,
    {
      filters: {
        status: true,
        or: [
          `node_type_name IN ('${OFC_FORM_CONFIG.ALLOWED_NODE_TYPES.join(
            "','"
          )}')`,
        ],
      },
      limit: OFC_FORM_CONFIG.NODES_FETCH_LIMIT,
    }
  );

  const { data: ofcTypesData, isLoading: ofcTypesLoading } = useTableQuery(
    supabase,
    "lookup_types",
    {
      filters: {
        category: { operator: "eq", value: "OFC_TYPES" },
        name: { operator: "neq", value: "DEFAULT" },
      },
      orderBy: [{ column: "name", ascending: true }],
      columns: "id, name",
      staleTime: OFC_FORM_CONFIG.CACHE_TIME,
    }
  );

  const {
    data: maintenanceTerminalsData,
    isLoading: maintenanceTerminalsLoading,
  } = useTableQuery(supabase, "maintenance_areas", {
    filters: { status: true },
    orderBy: [{ column: "name", ascending: true }],
    columns: "id, name",
    staleTime: OFC_FORM_CONFIG.CACHE_TIME,
  });

  // Custom hooks for complex logic
  // Create a type-safe wrapper for setValue
  const setValueWithType = <K extends keyof OfcCableFormData>(
    name: K,
    value: OfcCableFormData[K],
    options?: { shouldValidate?: boolean }
  ) => {
    setValue(name, value as PathValue<OfcCableFormData, K>, options);
  };

  const { existingRoutes, isLoading: routeGenerationLoading } =
    useRouteGeneration<OfcCableFormData>({
      startingNodeId,
      endingNodeId,
      nodesData: nodesData ?? undefined,
      isEdit,
      setValue: setValueWithType,
    });

  const { isCapacityLocked } = useCapacityInference<OfcCableFormData>({
    currentOfcTypeId,
    ofcTypeOptions:
      ofcTypesData?.map((type) => ({ value: type.id, label: type.name })) || [],
    setValue: setValueWithType,
  });

  // Memoized options to prevent unnecessary re-renders
  const nodeOptions = useMemo(
    (): Option[] =>
      nodesData?.map((node) => ({
        value: String(node.id),
        label: node.name,
      })) || [],
    [nodesData]
  );

  const startingNodeOptions = useMemo(
    () => nodeOptions.filter((option) => option.value !== endingNodeId),
    [nodeOptions, endingNodeId]
  );

  const endingNodeOptions = useMemo(
    () => nodeOptions.filter((option) => option.value !== startingNodeId),
    [nodeOptions, startingNodeId]
  );

  const ofcTypeOptions = useMemo(
    (): Option[] =>
      ofcTypesData?.map((type) => ({ value: type.id, label: type.name })) || [],
    [ofcTypesData]
  );

  const maintenanceTerminalOptions = useMemo(
    (): Option[] =>
      maintenanceTerminalsData?.map((terminal) => ({
        value: terminal.id,
        label: terminal.name,
      })) || [],
    [maintenanceTerminalsData]
  );

  // Loading state aggregation
  const isLoading =
    nodesLoading ||
    ofcTypesLoading ||
    maintenanceTerminalsLoading ||
    pageLoading ||
    routeGenerationLoading;

  const onValidSubmit = (data: OfcCableFormData) => {
    onSubmit(data as TablesInsert<"ofc_cables">);
  };

  return (
    <Modal
      isOpen={isOpen}
      onClose={onClose}
      visible={false}
      className="h-screen w-screen transparent bg-gray-700 rounded-2xl"
    >
      <FormCard
        key={isEdit ? ofcCable?.id ?? "edit" : "new"}
        title={isEdit ? "Edit Optical Fiber Cable" : "Add Optical Fiber Cable"}
        subtitle={
          isEdit
            ? "Update the cable details below"
            : "Fill in the Optical Fiber Cable details below"
        }
        isLoading={isLoading}
        onCancel={onClose}
        onSubmit={handleSubmit(onValidSubmit)}
        submitText={
          isEdit ? "Update Optical Fiber Cable" : "Create Optical Fiber Cable"
        }
        standalone
      >
        <div className="p-6 relative">
          {isLoading && <LoadingOverlay />}

          <ExistingRoutesAlert routes={existingRoutes} />

          <div className="space-y-8">
            <RouteConfigurationSection
              control={control}
              errors={errors}
              startingNodeOptions={startingNodeOptions}
              endingNodeOptions={endingNodeOptions}
              routeName={routeName}
            />

            <CableSpecificationsSection
              control={control}
              register={register}
              errors={errors}
              setValue={setValue}
              watch={watch}
              ofcTypeOptions={ofcTypeOptions}
              isCapacityLocked={isCapacityLocked}
            />

            <MaintenanceSection
              control={control}
              errors={errors}
              maintenanceTerminalOptions={maintenanceTerminalOptions}
            />
          </div>
        </div>
      </FormCard>
    </Modal>
  );
};

export default OfcForm;

```

<!-- path: hnvtx/components/ofc/OfcForm/LoadingOverlay.tsx -->
```typescript

// components/OfcForm/LoadingOverlay.tsx
import React from "react";
import { ButtonSpinner } from "@/components/common/ui/LoadingSpinner";

interface LoadingOverlayProps {
  message?: string;
}

const LoadingOverlay: React.FC<LoadingOverlayProps> = ({ 
  message = "Loading form data..." 
}) => (
  <div className="absolute inset-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm flex items-center justify-center z-10 rounded-lg">
    <div className="flex items-center space-x-3 bg-white dark:bg-gray-800 rounded-lg px-6 py-4 shadow-lg border dark:border-gray-700">
      <ButtonSpinner size="sm" />
      <span className="text-gray-600 dark:text-gray-300">
        {message}
      </span>
    </div>
  </div>
);

export default LoadingOverlay;
```

<!-- path: hnvtx/components/ofc/OfcForm/FormSection.tsx -->
```typescript
// components/OfcForm/FormSection.tsx
import React from "react";
import { LucideIcon } from "lucide-react";

interface FormSectionProps {
  title: string;
  icon: LucideIcon;
  iconColor: string;
  children: React.ReactNode;
}

const FormSection: React.FC<FormSectionProps> = ({
  title,
  icon: Icon,
  iconColor,
  children,
}) => (
  <div className="bg-gray-50 dark:bg-gray-800/50 rounded-lg p-6 border dark:border-gray-700">
    <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center space-x-2">
      <Icon className={`w-5 h-5 ${iconColor}`} />
      <span>{title}</span>
    </h3>
    {children}
  </div>
);

export default FormSection;
```

<!-- path: hnvtx/components/ofc/OfcForm/MaintenanceSection.tsx -->
```typescript
// components/OfcForm/MaintenanceSection.tsx
import React from "react";
import { Settings } from "lucide-react";
import { Control, FieldErrors } from "react-hook-form";
import { FormSearchableSelect, FormTextarea } from "@/components/common/form/FormControls";
import { Option } from "@/components/common/ui/select/SearchableSelect";
import { OfcCableFormData } from "@/schemas";
import FormSection from "./FormSection";

interface MaintenanceSectionProps {
  control: Control<OfcCableFormData>;
  errors: FieldErrors<OfcCableFormData>;
  maintenanceTerminalOptions: Option[];
}

const MaintenanceSection: React.FC<MaintenanceSectionProps> = ({
  control,
  errors,
  maintenanceTerminalOptions,
}) => (
  <FormSection title="Maintenance Information" icon={Settings} iconColor="text-orange-600">
    <div className="grid grid-cols-1 gap-6">
      <FormSearchableSelect
        name="maintenance_terminal_id"
        label="Maintenance Terminal"
        control={control}
        options={maintenanceTerminalOptions}
        error={errors.maintenance_terminal_id}
        placeholder="Select maintenance terminal"
        searchPlaceholder="Search maintenance terminals..."
      />

      <FormTextarea
        name="remark"
        label="Additional Notes"
        control={control}
        error={errors.remark}
        placeholder="Enter any maintenance notes, installation details, or other relevant information..."
      />
    </div>
  </FormSection>
);

export default MaintenanceSection;
```

<!-- path: hnvtx/components/dashboard/DashboardContent.tsx -->
```typescript
import { ReactNode } from "react";
import ColumnManagementProvider from "./ColumnManagementProvider";
import DashboardHeader from "./DashboardHeader";
import Sidebar from "../navigation/sidebar";


interface DashboardContentProps {
  children: ReactNode | ReactNode[] | Record<string, unknown>[] | null;
  isCollapsed: boolean;
  setIsCollapsed: (collapsed: boolean) => void;
  isMobile: boolean;
  showColumnManagement: boolean;
}

function DashboardContent({
  children,
  isCollapsed,
  setIsCollapsed,
  isMobile,
  showColumnManagement,
}: DashboardContentProps) {
  return (
      <ColumnManagementProvider
        data={children as Record<string, unknown>[] | null}
      >
        {/* Sidebar */}
        <Sidebar 
          isCollapsed={isCollapsed} 
          setIsCollapsed={setIsCollapsed}
          showMenuFeatures={showColumnManagement}
        />

        {/* Main Content Area */}
        <div
          className={`transition-all duration-300 min-h-screen${
            isMobile ? "" : isCollapsed ? " ml-16" : " ml-64"
            // isMobile ? "" : isCollapsed ? " " : " "
          }`}
        >
          {/* Header */}
          <DashboardHeader onMenuClick={() => setIsCollapsed(false)} />

          {/* Main Content */}
          <main className="p-6">
            <div className="mx-auto max-w-full">
              {children as ReactNode}
            </div>
          </main>
        </div>
      </ColumnManagementProvider>
  );
}

export default DashboardContent;

```

<!-- path: hnvtx/components/dashboard/ColumnManagementProvider.tsx -->
```typescript
"use client";

import { createContext, useContext, useState, useEffect, useMemo, ReactNode } from "react";
import { toast } from "sonner";

interface ColumnOption {
  label: string;
  value: string;
}

interface ColumnManagementContextType {
  visibleColumns: string[];
  setVisibleColumns: (columns: string[]) => void;
  isDeleteVisible: boolean;
  setIsDeleteVisible: (visible: boolean) => void;
  columnOptions: ColumnOption[];
  toggleDelete: () => void;
  resetColumnsToDefault: () => void;
}

const ColumnManagementContext =
  createContext<ColumnManagementContextType | null>(null);

export function useColumnManagement() {
  const context = useContext(ColumnManagementContext);
  if (!context) {
    throw new Error(
      "useColumnManagement must be used within a ColumnManagementProvider"
    );
  }
  return context;
}

interface ColumnManagementProviderProps {
  children: ReactNode;
  data: ReactNode | ReactNode[] | Record<string, unknown>[] | null; // The data to generate column options from
  excludeColumns?: string[];
}

export default function ColumnManagementProvider({
  children,
  data,
  excludeColumns = ["password_hash", "internal_id"],
}: ColumnManagementProviderProps) {
  const [visibleColumns, setVisibleColumns] = useState<string[]>([]);
  const [isDeleteVisible, setIsDeleteVisible] = useState(false);

  // Generate column options from data
  const columnOptions = useMemo(() => {
    if (!data || (data as Record<string, unknown>[]).length === 0) return [];

    // Get keys from first item in data array
    const firstItem = data as Record<string, unknown>[];
    if (!firstItem || typeof firstItem !== "object") return [];

    const keys = Object.keys(firstItem);

    return keys
      .filter((key) => !excludeColumns.includes(key))
      .map((key) => ({
        label: key.replace(/_/g, " ").replace(/\b\w/g, (l) => l.toUpperCase()),
        value: key,
      }));
  }, [data, excludeColumns]);

  // Initialize visible columns when column options change
  useEffect(() => {
    if (columnOptions.length > 0 && visibleColumns.length === 0) {
      setVisibleColumns(columnOptions.map((col) => col.value));
    }
  }, [columnOptions, visibleColumns.length]);

  // Toggle delete visibility
  const toggleDelete = () => {
    setIsDeleteVisible((prev) => {
      const newState = !prev;
      toast.info(newState ? "Delete options shown" : "Delete options hidden");
      return newState;
    });
  };

  // Reset columns to default
  const resetColumnsToDefault = () => {
    if (columnOptions.length > 0) {
      setVisibleColumns(columnOptions.map((col) => col.value));
      toast.success("Columns reset to default");
    } else {
      toast.warning("No columns available to reset");
    }
  };

  const contextValue: ColumnManagementContextType = {
    visibleColumns,
    setVisibleColumns,
    isDeleteVisible,
    setIsDeleteVisible,
    columnOptions,
    toggleDelete,
    resetColumnsToDefault,
  };

  return (
    <ColumnManagementContext.Provider value={contextValue}>
      {children}
    </ColumnManagementContext.Provider>
  );
}

```

<!-- path: hnvtx/components/dashboard/MenuButton.tsx -->
```typescript
"use client";
import { FiMenu } from "react-icons/fi";

interface MenuButtonProps {
  onClick: () => void;
}

export default function MenuButton({ onClick }: MenuButtonProps) {
  return (
    <button
      onClick={onClick}
      className="block md:hidden p-2 rounded-lg text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500"
      aria-label="Open sidebar menu"
      type="button"
    >
      <FiMenu className="h-6 w-6" />
    </button>
  );
}

```

<!-- path: hnvtx/components/dashboard/DashboardHeader.tsx -->
```typescript
"use client";

import AuthButton from "@/components/auth/authButton";
import Link from "next/link";
import MenuButton from "./MenuButton";
import { useAuthStore } from "@/stores/authStore";
import Image from "next/image";
import ThemeToggle from "../common/ui/theme/ThemeToggle";

interface DashboardHeaderProps {
  onMenuClick: () => void;
  title?: string;
}

export default function DashboardHeader({
  onMenuClick,
  title = "Dashboard",
}: DashboardHeaderProps) {
  const user = useAuthStore((state) => state.user);

  return (
    <header className="sticky top-0 z-40 border-b border-gray-200 bg-white shadow-sm dark:border-gray-700 dark:bg-gray-800">
      <div className="mx-auto max-w-full px-4 sm:px-6 lg:px-8">
        <div className="flex h-16 items-center justify-between">
          <div className="flex items-center">
            {/* Mobile menu button */}
            <MenuButton onClick={onMenuClick} />
            <h1 className="hidden text-2xl font-bold text-gray-900 md:block dark:text-white">
              {title}
            </h1>
          </div>

          <div className="space-x-4 relative flex items-center">
            {user && (
              <div className="group">
                <Link
                  href="/onboarding"
                  className="flex items-center space-x-2 transition-colors hover:opacity-80"
                >
                  {user.user_metadata?.avatar_url ? (
                    <Image
                      src={user.user_metadata?.avatar_url}
                      alt="User Avatar"
                      className="h-8 w-8 rounded-full"
                      width={32}
                      height={32}
                    />
                  ) : (
                    <div className="flex h-8 w-8 items-center justify-center rounded-full bg-blue-500">
                      <span className="text-sm font-medium text-white">
                        {user.user_metadata?.name?.[0] || "U"}
                      </span>
                    </div>
                  )}
                  <span className="text-sm font-medium text-gray-700 dark:text-gray-300">
                    {user.user_metadata?.name || "User"}
                  </span>
                </Link>

                {/* Dropdown AuthButton - Responsive positioning */}
                <div
                  className="absolute top-full right-0 mt-2 mr-4 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 
                    sm:left-0 sm:right-auto"
                >
                  <div
                    className="bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-2 
                      w-auto min-w-64 sm:w-auto"
                  >
                    <AuthButton />
                  </div>
                </div>
              </div>
            )}
            <ThemeToggle />
          </div>
        </div>
      </div>
    </header>
  );
}

```

<!-- path: hnvtx/components/polyfills/PolyfillLoader.tsx -->
```typescript
"use client";
 
import { useEffect } from "react";
 
export default function PolyfillLoader() {
  useEffect(() => {
    const needsPolyfills = !("fetch" in window) || !("IntersectionObserver" in window);
 
    if (needsPolyfills) {
      import("core-js/stable");
      import("regenerator-runtime/runtime");
      import("whatwg-fetch");
      import("intersection-observer");
      import("url-polyfill");
    }
  }, []);
 
  return null; // No UI needed
}
```

<!-- path: hnvtx/components/diagrams/uploader-components/ErrorDisplay.tsx -->
```typescript
// components/diagrams/uploader-components/ErrorDisplay.tsx
import React, { useEffect } from "react";
import { toast } from "sonner";

interface ErrorDisplayProps {
  error: string | null;
  cameraError: string | null;
}

const ErrorDisplay: React.FC<ErrorDisplayProps> = ({
  error,
  cameraError,
}) => {
  useEffect(() => {
    if (error) {
      toast.error(error, {
        position: "top-right",
        duration: 5000,
      });
    }
  }, [error]);

  useEffect(() => {
    if (cameraError) {
      toast.warning(`Camera Error: ${cameraError}`, {
        position: "top-right",
        duration: 5000,
      });
    }
  }, [cameraError]);

  return null; // Toasts are handled globally
};

export default ErrorDisplay;

```

<!-- path: hnvtx/components/diagrams/uploader-components/FolderManagement.tsx -->
```typescript
// components/diagrams/uploader-components/FolderManagement.tsx
import React from "react";

interface FolderManagementProps {
  newFolderName: string;
  setNewFolderName: (value: string) => void;
  handleCreateFolder: () => void;
  folders: any[];
  folderId: string | null;
  setFolderId: (value: string | null) => void;
}

const FolderManagement: React.FC<FolderManagementProps> = ({
  newFolderName,
  setNewFolderName,
  handleCreateFolder,
  folders,
  folderId,
  setFolderId,
}) => {
  // Sort folders alphabetically by name
  const sortedFolders = [...folders].sort((a, b) => 
    a.name.localeCompare(b.name, undefined, { sensitivity: 'base' })
  );

  return (
    <>
      <div className="flex gap-2">
        <input
          type="text"
          placeholder="New folder name"
          value={newFolderName}
          onChange={(e) => setNewFolderName(e.target.value)}
          className={`flex-1 rounded border px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400`}
          onKeyPress={(e) => e.key === "Enter" && handleCreateFolder()}
        />
        <button
          onClick={handleCreateFolder}
          disabled={!newFolderName.trim()}
          className={`rounded px-4 py-2 font-medium transition-colors dark:bg-green-700 dark:hover:bg-green-600 dark:disabled:bg-gray-600 bg-green-600 hover:bg-green-500 disabled:bg-gray-400 text-white disabled:cursor-not-allowed`}
        >
          Create
        </button>
      </div>

      <div>
        <label
          className={`mb-2 block text-sm font-medium dark:text-gray-200 text-gray-700`}
        >
          Select Destination Folder
        </label>
        <select
          className={`w-full rounded border px-3 py-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white`}
          value={folderId || ""}
          onChange={(e) => setFolderId(e.target.value || null)}
        >
          <option value="">Select Folder</option>
          {sortedFolders.map((folder) => (
            <option key={folder.id} value={folder.id}>
              {folder.name}
            </option>
          ))}
        </select>
      </div>
    </>
  );
};

export default FolderManagement;
```

<!-- path: hnvtx/components/diagrams/uploader-components/RecentlyUploaded.tsx -->
```typescript
// components/diagrams/uploader-components/RecentlyUploaded.tsx
import React from "react";
import Image from "next/image";
import { Eye, Download } from "lucide-react";

interface RecentlyUploadedProps {
  uploadedFiles: any[];
}

const RecentlyUploaded: React.FC<RecentlyUploadedProps> = ({
  uploadedFiles,
}) => {
  return (
    <div className="space-y-4">
      <h3
        className={`text-lg font-semibold dark:text-white text-black`}
      >
        Recently Uploaded
      </h3>
      <div className="grid grid-cols-2 gap-4 md:grid-cols-4">
        {uploadedFiles.slice(-4).map((file, index) => (
          <div
            key={index}
            className={`group relative overflow-hidden rounded border p-2 dark:border-gray-600 dark:bg-gray-700 dark:text-white`}
          >
            {file.secure_url &&
            file.secure_url.match(/\.(jpg|jpeg|png|gif|webp|bmp|svg)$/i) ? (
              <Image
                src={file.secure_url}
                alt="Uploaded file"
                className="h-24 w-full rounded object-cover"
                width={300}
                height={96}
                style={{ objectFit: "cover" }}
              />
            ) : (
              <div className="flex h-24 w-full items-center justify-center rounded bg-gray-100">
                <div className="text-center">
                  <div className="mb-1 text-xl">📄</div>
                  <p className="text-xs text-gray-600">
                    {file.format?.toUpperCase() || "FILE"}
                  </p>
                </div>
              </div>
            )}

            <div className="absolute top-2 right-2 flex gap-1 opacity-0 transition-opacity group-hover:opacity-100">
              <button
                onClick={() => window.open(file.secure_url, "_blank")}
                title="View"
                className="bg-opacity-60 hover:bg-opacity-80 rounded bg-black p-1 text-white transition-all"
              >
                <Eye className="h-3 w-3" />
              </button>
              <a
                href={file.secure_url}
                download
                title="Download"
                className="bg-opacity-60 hover:bg-opacity-80 rounded bg-black p-1 text-white transition-all"
              >
                <Download className="h-3 w-3" />
              </a>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

export default RecentlyUploaded;
```

<!-- path: hnvtx/components/diagrams/uploader-components/UploadModeToggle.tsx -->
```typescript
// components/diagrams/uploader-components/UploadModeToggle.tsx
import React from "react";

interface UploadModeToggleProps {
  showDashboard: boolean;
  setShowDashboard: (value: boolean) => void;
  folderId: string | null;
}

const UploadModeToggle: React.FC<UploadModeToggleProps> = ({
  showDashboard,
  setShowDashboard,
  folderId,
}) => {
  return (
    <div className="flex gap-2">
      <button
        onClick={() => setShowDashboard(true)}
        disabled={!folderId}
        className={`flex-1 rounded px-4 py-2 font-medium transition-colors ${
          showDashboard
            ? "dark:bg-blue-700 bg-blue-600"
            : "dark:bg-gray-600 dark:hover:bg-gray-500 bg-gray-400 hover:bg-gray-500"
        } text-white disabled:cursor-not-allowed disabled:opacity-50`}
      >
        Advanced Upload
      </button>
      <button
        onClick={() => setShowDashboard(false)}
        className={`flex-1 rounded px-4 py-2 font-medium transition-colors ${
          !showDashboard
            ? "dark:bg-blue-700 bg-blue-600"
            : "dark:bg-gray-600 dark:hover:bg-gray-500 bg-gray-400 hover:bg-gray-500"
        } text-white`}
      >
        Simple Upload
      </button>
    </div>
  );
};

export default UploadModeToggle;
```

<!-- path: hnvtx/components/diagrams/uploader-components/AdvancedUpload.tsx -->
```typescript


"use client";

import React, { useRef } from "react";
import { Dashboard } from "@uppy/react";
import { Camera, CameraOff, Camera as CameraIcon, SwitchCamera } from "lucide-react";
import Uppy from "@uppy/core";

interface AdvancedUploadProps {
  uppyRef: React.RefObject<Uppy | null>;
  isCameraActive: boolean;
  toggleCameraActive: () => void;
  facingMode: "user" | "environment";
  toggleCamera: () => void;
}

const AdvancedUpload: React.FC<AdvancedUploadProps> = ({
  uppyRef,
  isCameraActive,
  toggleCameraActive,
  facingMode,
  toggleCamera,
}) => {
  const fileInputRef = useRef<HTMLInputElement | null>(null);

  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.files && e.target.files[0] && uppyRef.current) {
      const file = e.target.files[0];
      uppyRef.current.addFile({
        name: file.name,
        type: file.type,
        data: file,
        source: "Camera",
      });
    }
  };

  const openNativeCamera = () => {
    fileInputRef.current?.click();
  };

  return (
    <div className={`uppy-dashboard-container rounded-lg dark:uppy-dark uppy-light`}>
      {/* Native camera file input (hidden) */}
      <input
        ref={fileInputRef}
        type="file"
        accept="image/*"
        capture={facingMode}
        onChange={handleFileChange}
        className="hidden"
      />

      {/* Action Buttons */}
      <div className="mb-2 flex flex-wrap gap-2 justify-between items-center">
        <div className="flex gap-2">
          {/* <button
            onClick={toggleCameraActive}
            className={`flex items-center gap-2 rounded px-3 py-1 text-sm ${
              isNightMode
                ? "bg-gray-600 text-white hover:bg-gray-500"
                : "bg-gray-200 text-black hover:bg-gray-300"
            }`}
          >
            {isCameraActive ? (
              <>
                <CameraOff size={16} /> Stop Camera
              </>
            ) : (
              <>
                <Camera size={16} /> Start Camera
              </>
            )}
          </button> */}

          <button
            onClick={toggleCamera}
            className={`flex items-center gap-2 rounded px-3 py-1 text-sm dark:bg-gray-600 dark:text-white dark:hover:bg-gray-500 bg-gray-200 text-black hover:bg-gray-300`}
          >
            <SwitchCamera size={16} />
            Switch ({facingMode === "user" ? "Front" : "Back"})
          </button>
        </div>

        <button
          onClick={openNativeCamera}
          className="flex items-center gap-2 rounded px-3 py-1 text-sm bg-blue-600 text-white hover:bg-blue-700"
        >
          <CameraIcon size={16} /> Open Camera
        </button>
      </div>

      {/* Uppy Dashboard */}
      {uppyRef.current && (
        <div className="relative overflow-hidden rounded-lg">
          <Dashboard
            uppy={uppyRef.current}
            plugins={isCameraActive ? ["Webcam"] : []}
            height={400}
            width="100%"
            hideProgressDetails={true}
            showSelectedFiles={true}
            showRemoveButtonAfterComplete={true}
            disableStatusBar={false}
            disableInformer={false}
            disableThumbnailGenerator={false}
            proudlyDisplayPoweredByUppy={false}
            note="Select files to upload or drag and drop them here"
            locale={{
              strings: {
                uploading: "Uploading...",
                complete: "Complete",
                uploadFailed: "Upload failed",
                paused: "Paused",
                retry: "Retry",
                cancel: "Cancel",
                pause: "Pause",
                resume: "Resume",
                done: "Done",
                filesUploadedOfTotal: {
                  0: "%{complete} of %{smart_count} file uploaded",
                  1: "%{complete} of %{smart_count} files uploaded",
                },
                dataUploadedOfTotal: "%{complete} of %{total}",
                dataUploadedOfUnknown: "%{complete} uploaded",
                xTimeLeft: "%{time} left",
                uploadXFiles: {
                  0: "Upload %{smart_count} file",
                  1: "Upload %{smart_count} files",
                },
                uploadXNewFiles: {
                  0: "Upload %{smart_count} new file",
                  1: "Upload %{smart_count} new files",
                },
                upload: "Upload",
                retryUpload: "Retry upload",
                xMoreFilesAdded: {
                  0: "%{numFiles} more file added",
                  1: "%{numFiles} more files added",
                },
                showErrorDetails: "Show error details",
              },
            }}
          />
        </div>
      )}
    </div>
  );
};

export default AdvancedUpload;

```

<!-- path: hnvtx/components/diagrams/uploader-components/SimpleUpload.tsx -->
```typescript
// components/diagrams/uploader-components/SimpleUpload.tsx
import React from "react";
import { Loader2 } from "lucide-react";

interface SimpleUploadProps {
  uppyRef: React.RefObject<any>;
  fileInputRef: React.RefObject<HTMLInputElement | null>;
  handleFileInputChange: (event: React.ChangeEvent<HTMLInputElement>) => void;
  triggerFileInput: () => void;
  selectedFiles: any[];
  handleRemoveFile: (fileId: string) => void;
  isUploading: boolean;
  handleStartUpload: () => void;
//   FileItemComponent?: ({ file }: { file: any }) => React.JSX.Element;
}

const formatFileSize = (bytes: number) => {
  if (bytes === 0) return "0 Bytes";
  const k = 1024;
  const sizes = ["Bytes", "KB", "MB", "GB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
};

const SimpleUpload: React.FC<SimpleUploadProps> = ({
  uppyRef,
  fileInputRef,
  handleFileInputChange,
  triggerFileInput,
  selectedFiles,
  handleRemoveFile,
  isUploading,
  handleStartUpload,
}) => {
  return (
    <div className="space-y-4">
      <div
        id="uppy-drag-drop"
        onClick={triggerFileInput}
        className={`cursor-pointer rounded-lg border-2 border-dashed p-8 text-center transition-colors dark:border-gray-600 dark:bg-gray-750 dark:hover:border-gray-500`}
      >
        <input
          ref={fileInputRef}
          type="file"
          multiple
          accept="image/*,application/pdf,.doc,.docx,.txt,.rtf,video/*,audio/*"
          onChange={handleFileInputChange}
          className="hidden"
        />
        <div>
          <p className="text-lg font-medium">Drag files here or click to browse</p>
          <p className="mt-2 text-sm opacity-70">
            Supports images, PDFs, documents, audio, and video files
          </p>
        </div>
      </div>

      <div id="uppy-progress" className="w-full"></div>

      {selectedFiles.length > 0 && (
        <div
          className={`rounded-lg border p-4 dark:border-gray-600 dark:bg-gray-700`}
        >
          <h4
            className={`mb-3 text-sm font-medium dark:text-gray-200 text-gray-700`}
          >
            Selected Files ({selectedFiles.length})
          </h4>
          <div className="max-h-40 space-y-2 overflow-y-auto">
            {selectedFiles.map((file) => (
              <div
                key={file.id}
                className={`flex items-center justify-between rounded p-2 dark:hover:bg-gray-600 dark:bg-gray-650 border dark:border-gray-500`}
              >
                <div className="flex min-w-0 flex-1 items-center space-x-3">
                  <div className="flex-shrink-0">
                    {file.type?.startsWith("image/") ? (
                      <div className="flex h-8 w-8 items-center justify-center rounded bg-green-100">
                        <span className="text-xs text-green-600">🖼️</span>
                      </div>
                    ) : file.type?.includes("pdf") ? (
                      <div className="flex h-8 w-8 items-center justify-center rounded bg-red-100">
                        <span className="text-xs text-red-600">📄</span>
                      </div>
                    ) : file.type?.startsWith("video/") ? (
                      <div className="flex h-8 w-8 items-center justify-center rounded bg-blue-100">
                        <span className="text-xs text-blue-600">🎥</span>
                      </div>
                    ) : file.type?.startsWith("audio/") ? (
                      <div className="flex h-8 w-8 items-center justify-center rounded bg-purple-100">
                        <span className="text-xs text-purple-600">🎵</span>
                      </div>
                    ) : (
                      <div className="flex h-8 w-8 items-center justify-center rounded bg-gray-100">
                        <span className="text-xs text-gray-600">📁</span>
                      </div>
                    )}
                  </div>
                  <div className="min-w-0 flex-1">
                    <p
                      className={`truncate text-sm font-medium dark:text-white text-gray-900`}
                    >
                      {file.name}
                    </p>
                    <p
                      className={`text-xs dark:text-gray-400 text-gray-500`}
                    >
                      {formatFileSize(file.size)}
                    </p>
                  </div>
                </div>
                <button
                  onClick={() => handleRemoveFile(file.id)}
                  className={`ml-2 flex-shrink-0 rounded-full p-1 transition-colors dark:text-gray-400 dark:hover:bg-red-500 dark:hover:text-red-400 text-gray-500 hover:bg-red-500 hover:text-red`}
                  title="Remove file"
                >
                  <svg
                    className="h-4 w-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M6 18L18 6M6 6l12 12"
                    />
                  </svg>
                </button>
              </div>
            ))}
          </div>
        </div>
      )}

      <button
        onClick={handleStartUpload}
        disabled={selectedFiles.length === 0 || isUploading}
        className={`flex w-full items-center justify-center gap-2 rounded px-4 py-2 transition-colors disabled:cursor-not-allowed disabled:opacity-50 dark:bg-blue-700 dark:hover:bg-blue-800 dark:disabled:bg-gray-600 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white`}
      >
        {isUploading && <Loader2 className="h-4 w-4 animate-spin" />}
        {isUploading
          ? "Uploading..."
          : selectedFiles.length > 0
            ? `Upload ${selectedFiles.length} File${selectedFiles.length > 1 ? "s" : ""}`
            : "Start Upload"}
      </button>
    </div>
  );
};

export default SimpleUpload;
```

<!-- path: hnvtx/components/diagrams/types/storage.ts -->
```typescript
export interface StoredFile {
  name: string;
  size: number;
  type: string;
  url: string;
  path?: string;
  uploadedAt: string;
}

export interface UploadProgress {
  [key: number]: number;
}

export interface StorageManagerProps {
  bucketName?: string;
  maxFileSize?: number;
  allowedFileTypes?: string[];
  onUploadComplete?: (files: StoredFile[]) => void;
  onError?: (error: string) => void;
}

export interface SupabaseStorageError {
  error: string;
  message: string;
  statusCode?: string;
}


```

<!-- path: hnvtx/components/diagrams/FileTable.tsx -->
```typescript
"use client";

import { useState, useMemo, useEffect, useCallback } from "react";
import { Eye, Download, Trash2, Search, Filter, Grid, List, X } from "lucide-react";
import { useFiles, useDeleteFile } from "@/hooks/database/file-queries";
import "../../app/customuppy.css"; // Custom styles for Uppy

// Define file type for better type safety
interface FileType {
  id: string;
  file_name: string;
  file_type: string;
  file_url: string;
  uploaded_at: string;
  [key: string]: any;
}

interface FileTableProps {
  folders: Array<{ id: string; name: string }>;
  onFileDelete?: () => void;
  folderId?: string | null;
  onFolderSelect?: (id: string | null) => void;
  isLoading?: boolean;
}

export function FileTable({ folders, onFileDelete }: FileTableProps) {
  const [selectedFolder, setSelectedFolder] = useState<string | null>(null);
  const [folderSearchTerm, setFolderSearchTerm] = useState<string>("");
  const [fileSearchTerm, setFileSearchTerm] = useState<string>("");
  const [sortBy, setSortBy] = useState<"name" | "date" | "type">("date");
  const [sortOrder, setSortOrder] = useState<"asc" | "desc">("desc");
  const [fileTypeFilter, setFileTypeFilter] = useState<string>("all");
  const [viewMode, setViewMode] = useState<"grid" | "list">("list");
  const [deletingFile, setDeletingFile] = useState<string | null>(null);

  // Use React Query to fetch files
  const { data: files = [], isLoading, refetch } = useFiles(selectedFolder || undefined);
  const loading = isLoading; // Use loading state from React Query
  const { mutate: deleteFile } = useDeleteFile();

  // Filter folders based on folder search term and sort alphabetically in ascending order
  const filteredFolders = useMemo(() => 
    folders
      .filter(folder =>
        folder.name.toLowerCase().includes(folderSearchTerm.toLowerCase())
      )
      .sort((a, b) => a.name.toLowerCase().localeCompare(b.name.toLowerCase())),
    [folders, folderSearchTerm]
  );

  // Reset selected folder when it's not in filtered results
  useEffect(() => {
    if (selectedFolder && folderSearchTerm) {
      const isFolderVisible = filteredFolders.some(folder => folder.id === selectedFolder);
      if (!isFolderVisible) {
        setSelectedFolder(null);
      }
    }
  }, [selectedFolder, folderSearchTerm, filteredFolders]);


  // Sort and filter files based on user preferences
  const processedFiles = useMemo(() => {
    return (files as FileType[])
      .filter((file) => {
        const matchesSearch = file.file_name.toLowerCase().includes(fileSearchTerm.toLowerCase());
        const matchesType = fileTypeFilter === "all" || file.file_type?.includes(fileTypeFilter);
        return matchesSearch && matchesType;
      })
      .sort((a, b) => {
        let comparison = 0;
        
        if (sortBy === "name") {
          comparison = a.file_name.localeCompare(b.file_name);
        } else if (sortBy === "type") {
          comparison = (a.file_type || "").localeCompare(b.file_type || "");
        } else {
          // Sort by date
          const dateA = new Date(a.uploaded_at || 0).getTime();
          const dateB = new Date(b.uploaded_at || 0).getTime();
          comparison = dateA - dateB;
        }
        
        return sortOrder === "asc" ? comparison : -comparison;
      });
  }, [files, fileSearchTerm, fileTypeFilter, sortBy, sortOrder]);

  const handleView = (file: FileType) => {
    if (file.file_type === "application/pdf") {
      const googleViewerUrl = `https://docs.google.com/gview?url=${encodeURIComponent(file.file_url)}&embedded=true`;
      window.open(googleViewerUrl, '_blank');
    } else {
      window.open(file.file_url, '_blank');
    }
  };

  const handleDelete = (file: FileType) => {
    if (!confirm(`Are you sure you want to delete "${file.file_name}"?`)) {
      return;
    }

    setDeletingFile(file.id);
    deleteFile(
      { id: file.id, folderId: selectedFolder },
      {
        onSuccess: () => {
          onFileDelete?.();
          refetch();
        },
        onError: (error) => {
          console.error("Delete error:", error);
          alert("Failed to delete file");
        },
        onSettled: () => {
          setDeletingFile(null);
        }
      }
    );
  };

  const getDownloadUrl = (file: FileType) => {
    if (file.file_type === "application/pdf") {
      return file.file_url.replace("/upload/", "/upload/fl_attachment/");
    }
    return file.file_url;
  };

  const getFileIcon = (fileType: string = '') => {
    if (fileType.startsWith("image/")) return "🖼️";
    if (fileType === "application/pdf") return "📄";
    if (fileType.startsWith("video/")) return "🎥";
    if (fileType.startsWith("audio/")) return "🎵";
    if (fileType.includes("document") || fileType.includes("word")) return "📝";
    if (fileType.includes("spreadsheet") || fileType.includes("excel")) return "📊";
    if (fileType.includes("presentation") || fileType.includes("powerpoint")) return "📈";
    return "📎";
  };

  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString("en-US", {
      year: "numeric",
      month: "short",
      day: "numeric",
      hour: "2-digit",
      minute: "2-digit",
    });
  };

  // Helper function to truncate folder names with ellipsis
  const truncateFolderName = (name: string, maxLength: number = 20) => {
    if (name.length <= maxLength) return name;
    return name.substring(0, maxLength) + "...";
  };

  // Clear search functions
  const clearFolderSearch = useCallback(() => {
    setFolderSearchTerm("");
  }, []);

  const clearFileSearch = useCallback(() => {
    setFileSearchTerm("");
  }, []);

  // Filter and sort files
  const filteredAndSortedFiles = useMemo(() => {
    return (files as FileType[])
      .filter((file) => {
        const matchesSearch = file.file_name.toLowerCase().includes(fileSearchTerm.toLowerCase());
        const matchesType = fileTypeFilter === "all" || file.file_type.startsWith(fileTypeFilter);
        return matchesSearch && matchesType;
      })
      .sort((a, b) => {
        let aValue: string | Date;
        let bValue: string | Date;
        
        switch (sortBy) {
          case "name":
            aValue = a.file_name.toLowerCase();
            bValue = b.file_name.toLowerCase();
            break;
          case "type":
            aValue = a.file_type || '';
            bValue = b.file_type || '';
            break;
          case "date":
          default:
            aValue = new Date(a.uploaded_at || 0);
            bValue = new Date(b.uploaded_at || 0);
            break;
        }
        
        const comparison = aValue > bValue ? 1 : aValue < bValue ? -1 : 0;
        return sortOrder === "asc" ? comparison : -comparison;
      });
  }, [files, fileSearchTerm, fileTypeFilter, sortBy, sortOrder]);

  const getFileTypeOptions = () => {
    const types = [...new Set((files as FileType[]).map(file => file.file_type.split("/")[0]))];
    return types.map(type => ({
      value: type,
      label: type ? type.charAt(0).toUpperCase() + type.slice(1) : 'Unknown',
    }));
  };

  return (
    <div className="mt-8 space-y-6">
      <h2
        className={`text-xl font-semibold dark:text-white text-black`}
      >
        UPLOADED DIAGRAMS
      </h2>
      {/* Files Display */}
      {selectedFolder && (
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <h3 className={`text-lg font-medium dark:text-white text-black`}>
              Files ({filteredAndSortedFiles.length})
            </h3>
            {loading && (
              <div className="text-sm text-gray-500">Loading files...</div>
            )}
          </div>

          {/* File Search */}
          <div className="relative max-w-md">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" />
            <input
              type="text"
              placeholder="Search files..."
              value={fileSearchTerm}
              onChange={(e) => setFileSearchTerm(e.target.value)}
              className={`w-full pl-10 pr-10 py-2 rounded border text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 border-gray-300 bg-white text-black placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500`}
            />
            {fileSearchTerm && (
              <button
                onClick={clearFileSearch}
                className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors"
                title="Clear search"
              >
                <X className="h-4 w-4" />
              </button>
            )}
          </div>

          {loading ? (
            <div className="flex justify-center py-8">
              <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
            </div>
          ) : filteredAndSortedFiles.length > 0 ? (
            viewMode === "grid" ? (
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                {filteredAndSortedFiles.map((file) => (
                  <div
                    key={file.id}
                    className={`group relative overflow-hidden rounded-lg border p-3 transition-all hover:shadow-lg dark:border-gray-600 dark:bg-gray-700 dark:hover:bg-gray-600 border-gray-200 bg-white hover:bg-gray-50`}
                  >
                    {/* File Preview */}
                    <div className="aspect-square mb-3 overflow-hidden rounded">
                      {file.file_type.includes("image") ? (
                        <img
                          src={file.file_url}
                          alt={file.file_name}
                          className="h-full w-full object-cover transition-transform group-hover:scale-105"
                        />
                      ) : (
                        <div className={`flex h-full w-full items-center justify-center dark:bg-gray-600 bg-gray-100`}>
                          <div className="text-center">
                            <div className="mb-2 text-3xl">{getFileIcon(file.file_type)}</div>
                            <p className="text-xs text-gray-500 uppercase">
                              {file.file_type.split("/")[1] || "FILE"}
                            </p>
                          </div>
                        </div>
                      )}
                    </div>

                    {/* File Info */}
                    <div className="space-y-1">
                      <p
                        className={`truncate text-sm font-medium dark:text-white text-black`}
                        title={file.file_name}
                      >
                        {file.file_name}
                      </p>
                      <p className="text-xs text-gray-500">
                        {formatDate(file.uploaded_at)}
                      </p>
                    </div>

                    {/* Action buttons */}
                    <div className="absolute top-2 right-2 flex gap-1 opacity-0 transition-opacity group-hover:opacity-100">
                      <button
                        onClick={() => handleView(file)}
                        title="View"
                        className="bg-opacity-80 hover:bg-opacity-100 rounded bg-black p-1.5 text-white transition-all"
                      >
                        <Eye className="h-3 w-3" />
                      </button>
                      <a
                        href={getDownloadUrl(file)}
                        download={file.file_name}
                        title="Download"
                        className="bg-opacity-80 hover:bg-opacity-100 rounded bg-black p-1.5 text-white transition-all"
                      >
                        <Download className="h-3 w-3" />
                      </a>
                      <button
                        onClick={() => handleDelete(file)}
                        disabled={deletingFile === file.id}
                        title="Delete"
                        className="bg-opacity-80 hover:bg-opacity-100 rounded bg-red-600 p-1.5 text-white transition-all disabled:opacity-50"
                      >
                        {deletingFile === file.id ? (
                          <div className="h-3 w-3 animate-spin rounded-full border border-white border-t-transparent"></div>
                        ) : (
                          <Trash2 className="h-3 w-3" />
                        )}
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div className="overflow-hidden rounded-lg border">
                <div className={`dark:bg-gray-700 bg-gray-50 px-4 py-2 border-b`}>
                  <div className="grid grid-cols-12 gap-4 text-xs font-medium uppercase tracking-wide text-gray-500">
                    <div className="col-span-5">Name</div>
                    <div className="col-span-2">Type</div>
                    <div className="col-span-2">Date</div>
                    <div className="col-span-1">Actions</div>
                  </div>
                </div>
                <div className={`divide-y dark:divide-gray-600 divide-gray-200`}>
                  {filteredAndSortedFiles.map((file) => (
                    <div
                      key={file.id}
                      className={`group px-4 py-3 transition-colors hover:bg-gray-50`}
                    >
                      <div className="grid grid-cols-12 gap-4 items-center">
                        <div className="col-span-5 flex items-center gap-3">
                          <span className="text-lg">{getFileIcon(file.file_type)}</span>
                          <span
                            className={`truncate text-sm dark:text-white text-black`}
                            title={file.file_name}
                          >
                            {file.file_name}
                          </span>
                        </div>
                        <div className="col-span-2 text-xs text-gray-500 uppercase">
                          {file.file_type.split("/")[1] || "Unknown"}
                        </div>
                        <div className="col-span-2 text-xs text-gray-500">
                          {formatDate(file.uploaded_at)}
                        </div>
                        <div className="col-span-1 flex gap-1">
                          <button
                            onClick={() => handleView(file)}
                            title="View"
                            className={`p-1 text-gray-400 hover:text-blue-500 transition-colors`}
                          >
                            <Eye className="h-4 w-4" />
                          </button>
                          <a
                            href={getDownloadUrl(file)}
                            download={file.file_name}
                            title="Download"
                            className={`p-1 text-gray-400 hover:text-green-500 transition-colors`}
                          >
                            <Download className="h-4 w-4" />
                          </a>
                          <button
                            onClick={() => handleDelete(file)}
                            disabled={deletingFile === file.id}
                            title="Delete"
                            className={`p-1 text-gray-400 hover:text-red-500 transition-colors disabled:opacity-50`}
                          >
                            {deletingFile === file.id ? (
                              <div className="h-4 w-4 animate-spin rounded-full border border-gray-400 border-t-transparent"></div>
                            ) : (
                              <Trash2 className="h-4 w-4" />
                            )}
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )
          ) : (
            <div className={`text-center py-12 dark:text-gray-400 text-gray-500`}>
              <div className="text-4xl mb-4">📭</div>
              <p className="text-lg font-medium">No files found</p>
              <p className="text-sm">
                {fileSearchTerm || fileTypeFilter !== "all"
                  ? "Try adjusting your search or filter criteria."
                  : "Upload some files to get started."}
              </p>
            </div>
          )}
        </div>
      )}
      {/* Search and Filter Controls */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        {/* Folder Search */}
        <div className="relative">
          <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" />
          <input
            type="text"
            placeholder="Search folders..."
            value={folderSearchTerm}
            onChange={(e) => setFolderSearchTerm(e.target.value)}
            className={`w-full pl-10 pr-10 py-2 rounded border text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 border-gray-300 bg-white text-black placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500`}
          />
          {folderSearchTerm && (
            <button
              onClick={clearFolderSearch}
              className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors"
              title="Clear search"
            >
              <X className="h-4 w-4" />
            </button>
          )}
        </div>

        {/* View Mode Toggle */}
        <div className="flex rounded border overflow-hidden">
          <button
            onClick={(e) => { e.stopPropagation(); setViewMode("grid"); }}
            className={`flex-1 px-3 py-2 text-sm transition-colors ${
              viewMode === "grid"
                ? "dark:bg-blue-700 dark:text-white bg-blue-600 text-white"
                : "dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 bg-gray-100 text-gray-700 hover:bg-gray-200"
            }`}
          >
            <Grid className="h-4 w-4 mx-auto" />
          </button>
          <button
            onClick={(e) => { e.stopPropagation(); setViewMode("list"); }}
            className={`flex-1 px-3 py-2 text-sm transition-colors ${
              viewMode === "list"
                ? "dark:bg-blue-700 dark:text-white bg-blue-600 text-white"
                : "dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 bg-gray-100 text-gray-700 hover:bg-gray-200"
            }`}
          >
            <List className="h-4 w-4 mx-auto" />
          </button>
        </div>
      </div>

      {/* File Type Filter */}
      {files.length > 0 && (
        <div className="flex gap-2 flex-wrap">
          <button
            onClick={() => setFileTypeFilter("all")}
            className={`px-3 py-1 rounded text-sm transition-colors ${
              fileTypeFilter === "all"
                ? "dark:bg-blue-700 dark:text-white bg-blue-600 text-white"
                : "dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 bg-gray-200 text-gray-700 hover:bg-gray-300"
            }`}
          >
            All Files ({files.length})
          </button>
          {getFileTypeOptions().map((option) => {
            const count = files.filter(file => file.file_type.startsWith(option.value)).length;
            // console.log(`File type: ${option.value}, Count: ${count}`, "label:", option.label);
            
            return (
              <button
                key={option.value}
                onClick={() => setFileTypeFilter(option.value)}
                className={`px-3 py-1 rounded text-sm transition-colors ${
                  fileTypeFilter === option.value
                    ? "dark:bg-blue-700 dark:text-white bg-blue-600 text-white"
                    : "dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 bg-gray-200 text-gray-700 hover:bg-gray-300"
                }`}
              >
                {option.label === "Application" ? "Pdf" : option.label} ({count})
              </button>
            );
          })}
        </div>
      )}

      {/* Folder Selection */}
      <div className="space-y-4">
        <h3 className={`text-lg font-medium dark:text-white text-black`}>
          Select Folder to View Files
        </h3>
        
        {filteredFolders.length > 0 ? (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-3">
            {filteredFolders.map((folder) => (
              <div key={folder.id} className="group relative">
                <button
                  className={`w-full p-4 rounded border text-left transition-all hover:shadow-md ${
                    selectedFolder === folder.id
                      ? "dark:border-blue-500 dark:bg-blue-900 shadow-lg"
                      : "dark:border-gray-600 dark:bg-gray-700 dark:hover:bg-gray-600 border-gray-200 bg-white hover:bg-gray-50"
                  } dark:text-white text-black`}
                  onClick={() => setSelectedFolder(folder.id)}
                  title={folder.name} // Show full name on hover
                >
                  <div className="flex items-center justify-between min-w-0">
                    <div className="flex items-center gap-2 min-w-0 flex-1">
                      <span className="text-lg flex-shrink-0">📁</span>
                      <span className="font-medium text-sm leading-tight break-words line-clamp-2 min-w-0">
                        {folder.name}
                      </span>
                    </div>
                    {selectedFolder === folder.id && (
                      <span className="text-xs bg-blue-500 text-white px-2 py-1 rounded flex-shrink-0 ml-2">
                        Selected
                      </span>
                    )}
                  </div>
                </button>
                
                {/* Tooltip for long folder names */}
                {folder.name.length > 25 && (
                  <div className="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-black text-white text-sm rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10 max-w-xs text-center">
                    {folder.name}
                    <div className="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-black"></div>
                  </div>
                )}
              </div>
            ))}
          </div>
        ) : (
          <div className={`text-center py-8 dark:text-gray-400 text-gray-500`}>
            {folderSearchTerm ? "No folders found matching your search." : "No folders available."}
          </div>
        )}
      </div>


    </div>
  );
}
```

<!-- path: hnvtx/components/diagrams/hooks/useUppyUploader.ts -->
```typescript
// hooks/useUppyUploader.ts
import { useRef, useState, useEffect } from 'react';
import Uppy from '@uppy/core';
import XHRUpload from '@uppy/xhr-upload';
import Webcam from '@uppy/webcam';
import { createClient } from "@/utils/supabase/client";
import { createOptimizedUppy } from "@/utils/imageOptimization";
import { smartCompress, convertToWebP, createProgressiveJPEG } from "@/utils/imageOptimization";
import { useUploadFile } from "@/hooks/database/file-queries";


interface UploadedFile {
  public_id: string;
  secure_url: string;
  // Add other properties as needed
}

interface SelectedFile {
  id: string;
  name: string;
  type: string;
  size: number;
}

interface UseUppyUploaderProps {
  folderId: string | null;
  // refresh: boolean;
  setRefresh: React.Dispatch<React.SetStateAction<boolean>>;
  // error?: string | null;
  setError: React.Dispatch<React.SetStateAction<string | null>>;
}

interface UseUppyUploaderReturn {
  uppyRef: React.RefObject<Uppy | null>;
  uploadedFiles: UploadedFile[];
  selectedFiles: SelectedFile[];
  isUploading: boolean;
  processedFiles: Set<string>;
  handleStartUpload: () => void;
  toggleCamera: () => void;
  toggleCameraActive: () => void;
  facingMode: 'user' | 'environment';
  isCameraActive: boolean;
  cameraError: string | null;
}

export function useUppyUploader({
  folderId,
  setRefresh,
  setError,
}: UseUppyUploaderProps): UseUppyUploaderReturn {
  const { mutate: uploadFile } = useUploadFile();
  const supabase = createClient();
  const uppyRef = useRef<Uppy<any, Record<string, never>> | null>(null);
  const [uploadedFiles, setUploadedFiles] = useState<any[]>([]);
  const [selectedFiles, setSelectedFiles] = useState<any[]>([]);
  const [isUploading, setIsUploading] = useState(false);
  const [facingMode, setFacingMode] = useState<'user' | 'environment'>(
    (localStorage.getItem("preferredCamera") as 'user' | 'environment') || 'environment'
  );
  const [isCameraActive, setIsCameraActive] = useState(false);
  const [cameraError, setCameraError] = useState<string | null>(null);
  const [processedFiles, setProcessedFiles] = useState<Set<string>>(new Set());


  // Initialize Uppy
  useEffect(() => {
    const uppy = createOptimizedUppy({ folderId });

    uppy.use(XHRUpload, {
      endpoint: "/api/upload",
      method: "POST",
      formData: true,
      fieldName: "file",
      bundle: false,
      headers: {
        "x-folder-id": folderId || "",
      },
      limit: 14,
    });

    // Configure Webcam
    const webcamPlugin = uppy.use(Webcam, {
      onBeforeSnapshot: () => Promise.resolve(),
      countdown: false,
      modes: ["video-audio", "video-only", "audio-only", "picture"],
      mirror: facingMode === "user",
      videoConstraints: {
        facingMode: facingMode,
        width: { min: 720, ideal: 1280, max: 1920 },
        height: { min: 480, ideal: 720, max: 1080 },
      },
      showVideoSourceDropdown: true,
    });

    if (webcamPlugin && typeof webcamPlugin.on === "function") {
      webcamPlugin.on("error", (error: any) => {
        const errorMsg = `Camera error: ${error.message}`;
        setCameraError(errorMsg);
       console.error("Webcam error:", error);
      });
    }

    // Add optimization preprocessor
    uppy.addPreProcessor(async (fileIDs) => {
      const optimizationPromises = fileIDs.map(async (fileID) => {
        const file = uppy.getFile(fileID);

        if (file?.type?.startsWith("image/")) {
          try {
            let optimizedFile = await smartCompress(file.data as File);
            if (!optimizedFile || optimizedFile.size === 0) {
              console.warn("Optimization failed for", file.name, "- using original");
              return;
            }

            const webpFile = await convertToWebP(optimizedFile);
            if (webpFile.size < optimizedFile.size) {
              optimizedFile = webpFile;
            }

            if (optimizedFile.type === "image/jpeg") {
              optimizedFile = await createProgressiveJPEG(optimizedFile);
            }

            if (optimizedFile.size > 0) {
              uppy.setFileState(fileID, {
                data: optimizedFile,
                size: optimizedFile.size,
              });

              console.log(
                `Optimized ${file.name}: ${((file.size ?? 0) / 1024 / 1024).toFixed(2)}MB → ${(optimizedFile.size / 1024 / 1024).toFixed(2)}MB`,
              );
            }
          } catch (error) {
            console.warn(`Failed to optimize ${file.name}:`, error);
            uppy.setFileState(fileID, {
              data: file.data,
              size: file.size,
            });
          }
        }
      });

      await Promise.all(optimizationPromises);
    });

    // Event handlers
    uppy.on("upload", () => {
      setIsUploading(true);
      setCameraError(null);
    });

    uppy.on("upload-success", async (file, response) => {
      try {
       if (!file || processedFiles.has(file.id)) return;
        setProcessedFiles((prev) => new Set([...prev, file.id]));

        const { data: userData, error: userError } = await supabase.auth.getUser();
        if (userError || !userData?.user) {
          throw new Error("User not authenticated");
        }

        if (!response.body?.public_id) {
          console.error("Missing public_id in response:", {
            file: file.name,
            response: response.body,
          });
          setError("Upload response is missing public_id.");
          return;
        }

        if (!file.name) {
          throw new Error("File name is required");
        }

        const fileData = {
          user_id: userData.user.id,
          file_name: file.name,
          file_type: file.type || 'application/octet-stream',
          file_size: file.size?.toString() || '0', // Convert to string
          file_route: response.body.public_id,
          file_url: response.body.secure_url || "",
          folder_id: folderId || null,
        };

        try {
          await uploadFile(fileData);
          setUploadedFiles((prev) => [...prev, response.body]);
          setRefresh((prev) => !prev);
        } catch (error) {
          console.error("Error saving file to database:", error);
          setError(`Database error: ${error instanceof Error ? error.message : 'Unknown error'}`);
          setProcessedFiles((prev) => {
            const newSet = new Set(prev);
            newSet.delete(file.id);
            return newSet;
          });
        }
      } catch (err: any) {
        console.error("Upload success handler error:", err);
        setError(err.message);
        if (file) {
          setProcessedFiles((prev) => {
            const newSet = new Set(prev);
            newSet.delete(file.id);
            return newSet;
          });
        }
      }
    });

    uppy.on("upload-error", (file, error) => {
     console.error("Upload error:", error);
      setError(`Upload failed: ${error.message}`);
      setIsUploading(false);
    });

   uppy.on("complete", (result) => {
      console.log("Upload complete:", result);
      setIsUploading(false);
      if ((result.successful ?? []).length > 0) {
        setError(null);
        setSelectedFiles([]);
        setTimeout(() => setProcessedFiles(new Set()), 1000);
      }
    });

    uppy.on("file-added", (file) => {
      uppy.setFileMeta(file.id, { folderId });
      setSelectedFiles(prev => [
        ...prev.filter(f => f.id !== file.id),
        {
          id: file.id,
          name: file.name,
          type: file.type,
          size: file.size,
        },
      ]);
    });

    uppy.on("file-removed", (file) => {
      setSelectedFiles((prev) => prev.filter((f) => f.id !== file.id));
    });

    uppyRef.current = uppy;

    return () => {
      uppy.destroy();
      uppyRef.current = null;
    };
  }, [folderId, supabase, facingMode, processedFiles]);



  const handleStartUpload = () => {
    if (!folderId) {
      setError("Please select a folder first.");
      return;
    }

    if (!selectedFiles.length) {
      setError("Please select files to upload first.");
      return;
    }

    uppyRef.current?.upload();
  };

  const toggleCamera = () => {
    const newMode = facingMode === "user" ? "environment" : "user";
    setFacingMode(newMode);
    localStorage.setItem("preferredCamera", newMode);

    if (uppyRef.current) {
      const webcamPlugin = uppyRef.current.getPlugin("Webcam");
      if (webcamPlugin) {
        webcamPlugin.setOptions({
          mirror: newMode === "user",
          facingMode: newMode,
        });
      }
    }
  };

  const toggleCameraActive = () => {
    setIsCameraActive(!isCameraActive);
  };

  return {
    uppyRef,
    uploadedFiles,
    selectedFiles,
    isUploading,
    processedFiles,
    handleStartUpload,
    toggleCamera,
    toggleCameraActive,
    facingMode,
    isCameraActive,
    cameraError
  };
}
```

<!-- path: hnvtx/components/diagrams/hooks/useFolders.ts -->
```typescript
// hooks/useFolders.ts
"use client";

import { useState, useCallback } from 'react';
import { createClient } from "@/utils/supabase/client";
import { useMutation, useQuery, useQueryClient } from "@tanstack/react-query";

interface Folder {
  id: string;
  name: string;
  user_id: string;
  uploaded_at: string;
}

interface UseFoldersReturn {
  folders: Folder[];
  folderId: string | null;
  setFolderId: (id: string | null) => void;
  newFolderName: string;
  setNewFolderName: (name: string) => void;
  handleCreateFolder: () => void;
  refreshFolders: () => Promise<void>;
  isCreatingFolder: boolean;
  isLoading: boolean;
}

interface UseFoldersProps {
  onError?: (error: string) => void;
  onSuccess?: () => void;
}

export function useFolders({
  onError,
  onSuccess
}: UseFoldersProps = {}): UseFoldersReturn {
  const supabase = createClient();
  const [folderId, setFolderId] = useState<string | null>(null);
  const [newFolderName, setNewFolderName] = useState("");
  const queryClient = useQueryClient();

  // Fetch folders
  const { data: folders = [], isLoading } = useQuery<Folder[]>({
    queryKey: ['folders'],
    queryFn: async () => {
      const { data: { user }, error: authError } = await supabase.auth.getUser();
      if (authError || !user) return [];

      const { data, error } = await supabase
        .from("folders")
        .select("*");
        // .eq("user_id", user.id);

      if (error) {
        console.error("Fetch folders error:", error);
        onError?.("Failed to load folders");
        return [];
      }
      
      return data || [];
    }
  });

  // Create folder mutation
  const { mutate: createFolder, isPending: isCreating } = useMutation({
    mutationFn: async (name: string) => {
      const { data: { user }, error: authError } = await supabase.auth.getUser();
      if (authError || !user) throw new Error("Not authenticated");
      if (!name.trim()) throw new Error("Folder name cannot be empty");

      const { data, error } = await supabase
        .from("folders")
        .insert({
          user_id: user.id,
          name: name.trim(),
        })
        .select()
        .single();

      if (error) throw error;
      return data;
    },
    onSuccess: () => {
      setNewFolderName("");
      queryClient.invalidateQueries({ queryKey: ['folders'] });
      onSuccess?.();
    },
    onError: (error: Error) => {
      console.error("Create folder error:", error);
      onError?.(error.message);
    },
  });

  const handleCreateFolder = useCallback(() => {
    if (newFolderName.trim()) {
      createFolder(newFolderName);
    }
  }, [createFolder, newFolderName]);

  const refreshFolders = useCallback(async () => {
    await queryClient.invalidateQueries({ queryKey: ['folders'] });
  }, [queryClient]);

  return {
    folders,
    folderId,
    setFolderId,
    newFolderName,
    setNewFolderName,
    handleCreateFolder,
    refreshFolders,
    isCreatingFolder: isCreating,
    isLoading,
  };
}
```

<!-- path: hnvtx/components/diagrams/hooks/useFileHandling.ts -->
```typescript
// hooks/useFileHandling.ts
import { useCallback, useRef } from 'react';
import Uppy from "@uppy/core";

export function useFileHandling(uppyRef: React.RefObject<Uppy | null>) {
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handleFileInputChange = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {
    const files = event.target.files;
    if (files && uppyRef.current) {
      Array.from(files).forEach((file) => {
        uppyRef.current?.addFile({
          name: file.name,
          type: file.type,
          data: file,
          source: "file-input",
          isRemote: false,
        });
      });
      event.target.value = '';
    }
  }, [uppyRef]);

  const triggerFileInput = useCallback(() => {
    fileInputRef.current?.click();
  }, []);

  const handleRemoveFile = useCallback((fileId: string) => {
    uppyRef.current?.removeFile(fileId);
  }, [uppyRef]);

  return {
    fileInputRef,
    handleFileInputChange,
    triggerFileInput,
    handleRemoveFile
  };
}
```

<!-- path: hnvtx/components/diagrams/FileUploader.tsx -->
```typescript
// components/FileUploader.tsx
'use client';

import { useState, useCallback } from 'react';
import { FileTable } from './FileTable';
import { useUppyUploader } from './hooks/useUppyUploader';
import { useFolders } from './hooks/useFolders';
import { useFileHandling } from './hooks/useFileHandling';
import { Toaster } from 'sonner';
import { useQueryClient } from '@tanstack/react-query';

export default function FileUploader() {
  const queryClient = useQueryClient();
  const [error, setError] = useState<string | null>(null);
  const [showUploadSection, setShowUploadSection] = useState(false);
  const [showDashboard, setShowDashboard] = useState(false);

  const {
    folders,
    folderId,
    newFolderName,
    setFolderId,
    setNewFolderName,
    handleCreateFolder,
    isCreatingFolder,
    isLoading: isLoadingFolders,
  } = useFolders({
    onError: setError,
    onSuccess: () => queryClient.invalidateQueries({ queryKey: ['files'] }),
  });

  const handleUploadSuccess = useCallback(() => {
    queryClient.invalidateQueries({ queryKey: ['files'] });
  }, [queryClient]);

  const {
    uppyRef,
    uploadedFiles,
    selectedFiles,
    isUploading,
    handleStartUpload,
    toggleCamera,
    toggleCameraActive,
    facingMode,
    isCameraActive,
    cameraError,
  } = useUppyUploader({
    folderId: folderId || null,
    setRefresh: () => {
      queryClient.invalidateQueries({ queryKey: ['files'] });
    },
    setError: (error) => {
      setError(error);
    },
  });

  const {
    fileInputRef,
    handleFileInputChange,
    triggerFileInput,
    handleRemoveFile,
  } = useFileHandling(uppyRef);

  const handleFileDeleted = useCallback(() => {
    queryClient.invalidateQueries({ queryKey: ['files'] });
  }, [queryClient]);

  return (
    <div className="mx-auto max-w-4xl space-y-6 p-4">
      <Toaster position="top-right" duration={4000} />

      <button
        onClick={() => setShowUploadSection(!showUploadSection)}
        className="mb-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors"
      >
        {showUploadSection ? 'Hide Upload Section' : 'Show Upload Section'}
      </button>

      {showUploadSection && (
        <div className="space-y-4 p-4 border rounded-lg bg-white dark:bg-gray-800">
          {/* Folder Management */}
          <div className="space-y-2">
            <input
              type="text"
              value={newFolderName}
              onChange={(e) => setNewFolderName(e.target.value)}
              placeholder="New folder name"
              className="w-full p-2 border rounded"
              disabled={isCreatingFolder}
            />
            <button
              onClick={handleCreateFolder}
              disabled={!newFolderName.trim() || isCreatingFolder}
              className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:opacity-50"
            >
              {isCreatingFolder ? 'Creating...' : 'Create Folder'}
            </button>
          </div>

          {/* File Upload Area */}
          <div className="mt-4">
            <input
              type="file"
              ref={fileInputRef}
              onChange={handleFileInputChange}
              className="hidden"
              multiple
            />
            <button
              onClick={triggerFileInput}
              className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
              disabled={isUploading}
            >
              {isUploading ? 'Uploading...' : 'Select Files'}
            </button>
            <button
              onClick={handleStartUpload}
              disabled={selectedFiles.length === 0 || isUploading}
              className="ml-2 px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:opacity-50"
            >
              {isUploading
                ? 'Uploading...'
                : `Upload ${selectedFiles.length} Files`}
            </button>
          </div>
        </div>
      )}

      {/* File Table */}
      <div className="mt-6">
        <FileTable
          folders={folders}
          onFileDelete={handleFileDeleted}
          folderId={folderId}
          onFolderSelect={setFolderId}
          isLoading={isLoadingFolders}
        />
      </div>
    </div>
  );
}

```

<!-- path: hnvtx/components/ofcadv/types.ts -->
```typescript
// lib/types.ts

// The high-level route object, fetched on the server for initial selection
export interface RouteForSelection {
    id: string;
    route_name: string;
    evolution_status: 'simple' | 'with_jcs' | 'fully_segmented';
  }
  
  // Detailed data for a selected route, fetched on the client
  export interface Site {
    id: string;
    name: string;
  }
  
  export interface Equipment {
    id: string;
    name: string;
    equipment_type: 'junction_closure';
    latitude: number;
    longitude: number;
    status: 'existing' | 'planned'; // 'existing' from DB, 'planned' is new
    attributes: {
      jc_type: 'inline' | 'branching' | 'terminal';
      capacity: number;
      position_on_route: number; // 0-100%
    };
  }
  
  export interface CableSegment {
    id: string;
    segment_order: number;
    start_point_id: string;
    end_point_id: string;
    start_point_type: 'site' | 'equipment';
    end_point_type: 'site' | 'equipment';
    fiber_count: number;
    distance_km: number;
  }
  
  export interface FiberSplice {
    id: string;
    equipment_id: string; // The JC equipment ID
    incoming_segment_id: string;
    incoming_fiber_number: number;
    outgoing_segment_id: string;
    outgoing_fiber_number: number;
    splice_type: 'through' | 'tap' | 'split';
    status: 'active' | 'spare' | 'faulty';
  }
  
  // The complete data payload returned by the client-side API call
  export interface RouteDetailsPayload {
    route: {
      id: string;
      name: string;
      start_site: Site;
      end_site: Site;
      capacity: number;
      distance_km: number;
      evolution_status: 'simple' | 'with_jcs' | 'fully_segmented';
    };
    equipment: Equipment[];
  }
  
  // Payload for the POST request to commit changes
  export interface EvolutionCommitPayload {
    plannedEquipment: Omit<Equipment, 'status' | 'id'>[];
    plannedSegments: Omit<CableSegment, 'id'>[];
    plannedSplices: Omit<FiberSplice, 'id'>[];
  }
```

<!-- path: hnvtx/components/ofcadv/ui/AddJcForm.tsx -->
```typescript
// app/evolve/ui/AddJcForm.tsx
"use client";

import { useState } from 'react';
import { Equipment, RouteDetailsPayload } from '@/components/ofcadv/types';

interface Props {
  route: RouteDetailsPayload['route'];
  onAddJc: (jc: Omit<Equipment, 'id' | 'status'>) => void;
}

// Define the initial state for the form
const getInitialState = () => ({
  name: '',
  latitude: 0,
  longitude: 0,
  jc_type: 'inline' as const,
  capacity: 48,
  position_on_route: 50,
});

export default function AddJcForm({ route, onAddJc }: Props) {
  const [newJC, setNewJC] = useState(getInitialState());

  const handleSubmit = () => {
    // Basic validation
    if (!newJC.name || newJC.latitude === 0 || newJC.longitude === 0) {
      alert('Please fill in JC Name, Latitude, and Longitude.');
      return;
    }

    // Call the parent component's handler with the structured data
    onAddJc({
      name: newJC.name,
      equipment_type: 'junction_closure',
      latitude: newJC.latitude,
      longitude: newJC.longitude,
      attributes: {
        jc_type: newJC.jc_type,
        capacity: newJC.capacity,
        position_on_route: newJC.position_on_route,
      },
    });

    // Reset the form for the next entry
    setNewJC(getInitialState());
  };

  return (
    <div className="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg border border-yellow-200 dark:border-yellow-800">
      <h4 className="font-semibold text-gray-900 dark:text-white mb-3">Add New Junction Closure</h4>
      <div className="space-y-3">
        <div>
          <label className="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
            JC Name *
          </label>
          <input
            type="text"
            value={newJC.name}
            onChange={(e) => setNewJC({ ...newJC, name: e.target.value })}
            placeholder="JC-SITE-001"
            className="w-full p-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
          />
        </div>

        <div className="grid grid-cols-2 gap-2">
          <div>
            <label className="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
              Latitude
            </label>
            <input
              type="number"
              step="0.000001"
              value={newJC.latitude || ''}
              onChange={(e) => setNewJC({ ...newJC, latitude: parseFloat(e.target.value) })}
              className="w-full p-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
            />
          </div>
          <div>
            <label className="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
              Longitude
            </label>
            <input
              type="number"
              step="0.000001"
              value={newJC.longitude || ''}
              onChange={(e) => setNewJC({ ...newJC, longitude: parseFloat(e.target.value) })}
              className="w-full p-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
            />
          </div>
        </div>

        <div>
          <label className="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
            Position on Route: {newJC.position_on_route}%
          </label>
          <input
            type="range"
            min="5"
            max="95"
            value={newJC.position_on_route}
            onChange={(e) => setNewJC({ ...newJC, position_on_route: Number(e.target.value) })}
            className="w-full"
          />
          <div className="text-xs text-gray-500 dark:text-gray-400 text-center">
            ~{(route.distance_km * newJC.position_on_route / 100).toFixed(1)} km from {route.start_site.name}
          </div>
        </div>

        <div className="grid grid-cols-2 gap-2">
          <div>
            <label className="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
              JC Type
            </label>
            <select
              value={newJC.jc_type}
              onChange={(e) => setNewJC({ ...newJC, jc_type: e.target.value as any })}
              className="w-full p-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
            >
              <option value="inline">Inline</option>
              <option value="branching">Branching</option>
              <option value="terminal">Terminal</option>
            </select>
          </div>
          <div>
            <label className="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
              Splice Capacity
            </label>
            <select
              value={newJC.capacity}
              onChange={(e) => setNewJC({ ...newJC, capacity: Number(e.target.value) })}
              className="w-full p-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
            >
              <option value={24}>24 Splice</option>
              <option value={48}>48 Splice</option>
              <option value={96}>96 Splice</option>
              <option value={144}>144 Splice</option>
            </select>
          </div>
        </div>

        <button
          onClick={handleSubmit}
          disabled={!newJC.name || newJC.latitude === 0 || newJC.longitude === 0}
          className="w-full p-2 bg-green-500 text-white rounded-md hover:bg-green-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-sm font-semibold"
        >
          Add JC to Route
        </button>
      </div>
    </div>
  );
}
```

<!-- path: hnvtx/components/ofcadv/ui/RouteVisualization.tsx -->
```typescript
// app/evolve/ui/RouteVisualization.tsx
"use client";

import { Equipment, RouteDetailsPayload } from '@/components/ofcadv/types';

interface Props {
  route: RouteDetailsPayload['route'];
  equipment: Equipment[];
  onRemoveJc: (jcId: string) => void;
}

export default function RouteVisualization({ route, equipment, onRemoveJc }: Props) {
  const sortedEquipment = [...equipment].sort(
    (a, b) => a.attributes.position_on_route - b.attributes.position_on_route
  );

  const getJcColor = (jcType: string) => {
    switch (jcType) {
      case 'branching': return 'bg-orange-500';
      case 'terminal': return 'bg-red-500';
      default: return 'bg-green-500';
    }
  };

  return (
    <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
      <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4">
        Route Topology
      </h3>
      <div className="space-y-4">
        {/* Route Path Diagram */}
        <div className="relative">
          <div className="flex items-center space-x-2 overflow-x-auto pb-4">
            {/* Start Node */}
            <div className="flex-shrink-0 text-center">
              <div className="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-xs">
                SITE
              </div>
              <div className="text-xs mt-1 text-gray-600 dark:text-gray-400 max-w-16 truncate" title={route.start_site.name}>
                {route.start_site.name}
              </div>
              <div className="text-xs text-gray-500">0 km</div>
            </div>

            {/* JCs along the route */}
            {sortedEquipment.map((jc) => (
              <div key={jc.id} className="flex items-center">
                <div className="w-16 h-0.5 bg-gray-400 dark:bg-gray-600"></div>
                <div className="flex-shrink-0 text-center relative group">
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white text-xs font-bold ${getJcColor(jc.attributes.jc_type)} ${jc.status === 'planned' ? 'ring-2 ring-offset-2 ring-offset-gray-800 ring-yellow-400' : ''}`}>
                    JC
                  </div>
                  <div className="text-xs mt-1 text-gray-600 dark:text-gray-400 max-w-16 truncate" title={jc.name}>
                    {jc.name}
                  </div>
                  {jc.attributes.jc_type === 'branching' && (
                    <div className="mt-1 inline-flex items-center gap-1 text-[10px] px-1.5 py-0.5 rounded bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300">
                      T-branch
                    </div>
                  )}
                  <div className="text-xs text-gray-500">~{(route.distance_km * jc.attributes.position_on_route / 100).toFixed(1)} km</div>
                  
                  {/* Show remove button only for PLANNED JCs */}
                  {jc.status === 'planned' && (
                    <button
                      onClick={() => onRemoveJc(jc.id)}
                      className="absolute -top-2 -right-2 w-5 h-5 bg-red-500 text-white rounded-full text-xs flex items-center justify-center hover:bg-red-600 opacity-0 group-hover:opacity-100 transition-opacity"
                      aria-label="Remove JC"
                    >
                      ×
                    </button>
                  )}
                </div>
              </div>
            ))}

            {/* End Node */}
            <div className="flex items-center">
              <div className="w-16 h-0.5 bg-gray-400 dark:bg-gray-600"></div>
              <div className="flex-shrink-0 text-center">
                <div className="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-xs">
                  SITE
                </div>
                <div className="text-xs mt-1 text-gray-600 dark:text-gray-400 max-w-16 truncate" title={route.end_site.name}>
                  {route.end_site.name}
                </div>
                <div className="text-xs text-gray-500">{route.distance_km} km</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
```

<!-- path: hnvtx/components/ofcadv/ui/CommitView.tsx -->
```typescript
// app/evolve/ui/CommitView.tsx
"use client";

import { Equipment, CableSegment, FiberSplice } from '@/components/ofcadv/types';

interface Props {
  equipment: Equipment[];
  segments: CableSegment[];
  splices: FiberSplice[]; // Pass the calculated splices for a full summary
  onCommit: () => void;
  isCommitting: boolean;
}

export default function CommitView({ equipment, segments, splices, onCommit, isCommitting }: Props) {
  const plannedJCs = equipment.filter(eq => eq.status === 'planned');

  if (plannedJCs.length === 0) {
    return (
        <div className="bg-gray-50 dark:bg-gray-800 p-8 rounded-lg text-center">
            <h4 className="text-lg font-medium text-gray-900 dark:text-white mb-1">Nothing to Commit</h4>
            <p className="text-sm text-gray-500 dark:text-gray-400">
                Add one or more new Junction Closures to the route before committing.
            </p>
        </div>
    );
  }

  return (
    <div className="space-y-4">
      <div className="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800">
        <h4 className="font-semibold text-blue-800 dark:text-blue-200 mb-2">Review & Commit Changes</h4>
        <p className="text-sm text-blue-700 dark:text-blue-300">
          This will permanently update the route structure by adding {plannedJCs.length} new junction closure(s) and creating {segments.length} new cable segments.
        </p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div className="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
          <h4 className="font-semibold text-gray-900 dark:text-white mb-3">
            <span className="text-green-500 font-mono text-xs py-1 px-2 bg-green-100 dark:bg-green-900 rounded mr-2">ADD</span>
            New Junction Closures
          </h4>
          <ul className="space-y-2">
            {plannedJCs.map(jc => (
              <li key={jc.id} className="flex justify-between text-sm">
                <span className="font-medium text-gray-800 dark:text-gray-200">{jc.name}</span>
                <span className="text-gray-600 dark:text-gray-400">{jc.attributes.position_on_route}% on route</span>
              </li>
            ))}
          </ul>
        </div>

        <div className="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
          <h4 className="font-semibold text-gray-900 dark:text-white mb-3">
            <span className="text-green-500 font-mono text-xs py-1 px-2 bg-green-100 dark:bg-green-900 rounded mr-2">CREATE</span>
            New Cable Segments
          </h4>
          <ul className="space-y-2">
            {segments.map(segment => (
              <li key={segment.id} className="flex justify-between text-sm">
                <span className="text-gray-800 dark:text-gray-200">
                  Segment #{segment.segment_order}
                </span>
                <span className="text-gray-600 dark:text-gray-400">{segment.distance_km} km</span>
              </li>
            ))}
          </ul>
        </div>
      </div>

      {splices.length > 0 && (
        <div className="bg-white dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700">
            <h4 className="font-semibold text-gray-900 dark:text-white mb-3">
                <span className="text-green-500 font-mono text-xs py-1 px-2 bg-green-100 dark:bg-green-900 rounded mr-2">CREATE</span>
                New Fiber Splices
            </h4>
            <div className="text-center text-sm text-gray-700 dark:text-gray-300">
                A total of <span className="font-bold text-lg">{splices.length}</span> default "through" splices will be created.
            </div>
        </div>
      )}

      <div className="flex justify-end mt-6">
        <button
          onClick={onCommit}
          disabled={isCommitting}
          className="px-8 py-2 bg-purple-600 text-white font-semibold rounded-md hover:bg-purple-700 disabled:bg-gray-500 disabled:cursor-wait"
        >
          {isCommitting ? 'Committing...' : 'Confirm & Commit Evolution'}
        </button>
      </div>
    </div>
  );
}
```

<!-- path: hnvtx/components/ofcadv/data.ts -->
```typescript
// lib/data.ts
import 'server-only';
import { RouteForSelection } from './types';

// In a real app, this would connect to your database (e.g., using Prisma)
export const getRoutesForSelection = async (): Promise<RouteForSelection[]> => {
  console.log("== EXECUTING ON SERVER: getRoutesForSelection ==");
  
  // Mocking a database call
  const mockRoutes: RouteForSelection[] = [
    { id: 'route-1', route_name: 'NodeA ⇔ NodeB _ 1', evolution_status: 'simple' },
    { id: 'route-2', route_name: 'NodeC ⇔ NodeD _ 1', evolution_status: 'with_jcs' },
    { id: 'route-3', route_name: 'NodeE ⇔ NodeF _ 1', evolution_status: 'fully_segmented' },
  ];
  return mockRoutes;
};
```

<!-- path: hnvtx/components/ofcadv/RouteManager.tsx -->
```typescript
// app/evolve/RouteEvolutionManager.tsx
"use client";

import { useState, useMemo, useEffect } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { queryKeys } from '@/components/ofcadv/queryKeys';
import { projectSegments, projectDefaultSplices } from '@/components/ofcadv/logic/project';
import type { BranchConfigMap } from '@/components/ofcadv/logic/project';
import { isRouteDetailsPayload } from '@/components/ofcadv/schemas';
import {
  RouteForSelection,
  RouteDetailsPayload,
  Equipment,
  CableSegment,
  FiberSplice,
  EvolutionCommitPayload,
} from '@/components/ofcadv/types';
import AddJcForm from '@/components/ofcadv/ui/AddJcForm';
import RouteVisualization from '@/components/ofcadv/ui/RouteVisualization';
import CommitView from '@/components/ofcadv/ui/CommitView';

// --- Client-Side API Functions ---
const fetchRouteDetails = async (routeId: string): Promise<RouteDetailsPayload> => {
  const res = await fetch(`/api/evolve/${routeId}`);
  if (!res.ok) throw new Error('Failed to fetch route details');
  const data = await res.json();
  if (!isRouteDetailsPayload(data)) {
    throw new Error('Invalid route details payload received from server');
  }
  return data;
};

const commitEvolution = async (vars: { routeId: string; payload: EvolutionCommitPayload }) => {
  const res = await fetch(`/api/evolve/${vars.routeId}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(vars.payload),
  });
  if (!res.ok) {
    const err = await res.json();
    throw new Error(err.message || 'Commit failed');
  }
  return res.json();
};

export default function RouteManager({ initialRoutes }: { initialRoutes: RouteForSelection[] }) {
  const [selectedRouteId, setSelectedRouteId] = useState<string | null>(null);
  const [evolutionMode, setEvolutionMode] = useState<'view' | 'add_jc' | 'commit'>('view');
  
  // Local UI state for JCs the user is planning to add
  const [plannedJCs, setPlannedJCs] = useState<Equipment[]>([]);
  const [branchConfig, setBranchConfig] = useState<BranchConfigMap>({});
  
  const queryClient = useQueryClient();

  // --- DATA FETCHING with React Query ---
  const { data: routeDetails, isLoading, isError, error } = useQuery({
    queryKey: queryKeys.routeDetails(selectedRouteId),
    queryFn: () => fetchRouteDetails(selectedRouteId!),
    enabled: !!selectedRouteId, // Query only runs when a route is selected
  });

  // In v5, query callbacks like onSuccess were removed. Mirror that behavior here.
  useEffect(() => {
    if (selectedRouteId && routeDetails) {
      // Reset local state when a new route is successfully loaded
      setPlannedJCs([]);
      setBranchConfig({});
      setEvolutionMode('view');
    }
  }, [selectedRouteId, routeDetails]);

  // --- DATA MUTATION with React Query ---
  const { mutate: commitMutation, isPending: isCommitting } = useMutation({
    mutationFn: commitEvolution,
    onSuccess: (data) => {
      alert(data.message);
      // Invalidate queries to refetch fresh server state
      queryClient.invalidateQueries({ queryKey: queryKeys.routeDetails(selectedRouteId) });
      // You might also want to refetch the initial list if statuses change
      queryClient.invalidateQueries({ queryKey: queryKeys.routes }); 
      setSelectedRouteId(null); // Deselect route
    },
    onError: (err) => alert(`Error: ${err.message}`),
  });
  
  // --- DERIVED STATE with useMemo ---
  // Combines existing equipment from the DB with locally planned JCs
  const allEquipmentOnRoute = useMemo(() => [
      ...(routeDetails?.equipment || []), 
      ...plannedJCs
  ], [routeDetails, plannedJCs]);

  // Projects segments and splices based on the combined equipment list
  const projectedSegments = useMemo(() => {
    if (!routeDetails) return [] as CableSegment[];
    return projectSegments(routeDetails.route, allEquipmentOnRoute, branchConfig);
  }, [routeDetails, allEquipmentOnRoute, branchConfig]);

  const projectedSplices = useMemo(() => {
    if (!routeDetails) return [] as FiberSplice[];
    return projectDefaultSplices(routeDetails.route, projectedSegments, allEquipmentOnRoute, branchConfig);
  }, [routeDetails, projectedSegments, allEquipmentOnRoute, branchConfig]);

  const handleAddJc = (newJcData: Omit<Equipment, 'id' | 'status'>) => {
    const newJc: Equipment = {
      ...newJcData,
      id: `planned-${Date.now()}`, // Temporary client-side ID
      status: 'planned',
    };
    setPlannedJCs(prev => [...prev, newJc]);
  };

  const handleRemoveJc = (jcId: string) => {
    setPlannedJCs(prev => prev.filter(jc => jc.id !== jcId));
    setBranchConfig(prev => {
      const { [jcId]: _, ...rest } = prev;
      return rest;
    });
  };

  const setBranchForJc = (jcId: string, updater: (prev: BranchConfigMap[string] | undefined) => BranchConfigMap[string]) => {
    setBranchConfig(prev => ({
      ...prev,
      [jcId]: updater(prev[jcId])
    }));
  };
  
  const handleCommit = () => {
    if (!selectedRouteId || plannedJCs.length === 0) return;
    
    // Prepare payload for the API
    const payload: EvolutionCommitPayload = {
      plannedEquipment: plannedJCs.map(({ id, status, ...rest }) => rest), // Remove client-only fields
      plannedSegments: projectedSegments.map(({ id, ...rest }) => rest),
      plannedSplices: projectedSplices.map(({ id, ...rest }) => rest),
    };

    commitMutation({ routeId: selectedRouteId, payload });
  };
  
  const getStatusColor = (status: string) => {
    // ... your getEvolutionStatusColor logic
  };

  return (
    <>
      {/* Route Selection */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
        {initialRoutes.map(route => (
          <div
            key={route.id}
            onClick={() => setSelectedRouteId(route.id)}
            className={`p-4 border-2 rounded-lg cursor-pointer transition-all ${
              selectedRouteId === route.id
                ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'
                : 'border-gray-200 dark:border-gray-600 hover:border-blue-300'
            }`}
          >
            <div className="font-medium">{route.route_name}</div>
            <span className={`px-2 py-1 rounded text-xs mt-2 inline-block ${getStatusColor(route.evolution_status)}`}>
              {route.evolution_status.replace('_', ' ')}
            </span>
          </div>
        ))}
      </div>

      {isLoading && <p>Loading route details...</p>}
      {isError && <p className="text-red-500">Error: {error?.message}</p>}

      {routeDetails && (
        <div className="grid grid-cols-1 xl:grid-cols-3 gap-6">
          {/* Left Panel: Info and Forms */}
          <div className="space-y-6">
            <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
              <h3 className="font-semibold mb-3">Route Details</h3>
               {/* ... display details from `routeDetails.route` ... */}
            </div>

            <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
              <h3 className="font-semibold mb-3">Evolution Actions</h3>
              <div className="flex flex-wrap gap-2">
                <button
                  onClick={() => setEvolutionMode('view')}
                  className={`px-3 py-1.5 rounded border text-sm ${
                    evolutionMode === 'view'
                      ? 'bg-blue-600 text-white border-blue-600'
                      : 'bg-transparent text-blue-600 border-blue-600'
                  }`}
                  disabled={!selectedRouteId}
                >
                  View
                </button>
                <button
                  onClick={() => setEvolutionMode('add_jc')}
                  className={`px-3 py-1.5 rounded border text-sm ${
                    evolutionMode === 'add_jc'
                      ? 'bg-green-600 text-white border-green-600'
                      : 'bg-transparent text-green-600 border-green-600'
                  }`}
                  disabled={!selectedRouteId}
                >
                  Add Junction Closure
                </button>
                <button
                  onClick={() => setEvolutionMode('commit')}
                  className={`px-3 py-1.5 rounded border text-sm ${
                    evolutionMode === 'commit'
                      ? 'bg-purple-600 text-white border-purple-600'
                      : 'bg-transparent text-purple-600 border-purple-600'
                  }`}
                  disabled={!selectedRouteId || plannedJCs.length === 0}
                  title={plannedJCs.length === 0 ? 'Add at least one JC to commit' : ''}
                >
                  Review & Commit
                </button>
              </div>
            </div>

            {evolutionMode === 'add_jc' && (
              <AddJcForm route={routeDetails.route} onAddJc={handleAddJc} />
            )}

            {/* Branch Configuration for planned branching JCs */}
            {plannedJCs.some(j => j.attributes.jc_type === 'branching') && (
              <div className="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                <h3 className="font-semibold mb-3">Branch Configuration</h3>
                <div className="space-y-4">
                  {plannedJCs.filter(j => j.attributes.jc_type === 'branching').map(jc => {
                    const cfg = branchConfig[jc.id];
                    return (
                      <div key={jc.id} className="border rounded p-3">
                        <div className="flex items-center justify-between">
                          <div className="font-medium">{jc.name}</div>
                          <span className="text-xs text-gray-500">@ {(routeDetails.route.distance_km * jc.attributes.position_on_route / 100).toFixed(1)} km</span>
                        </div>
                        <div className="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-3">
                          <label className="text-sm">
                            <span className="block mb-1 text-gray-600 dark:text-gray-300">Branch endpoint</span>
                            <select
                              className="w-full border rounded px-2 py-1 bg-white dark:bg-gray-900"
                              value={cfg?.target_id ?? routeDetails.route.end_site.id}
                              onChange={(e) => setBranchForJc(jc.id, (prev) => ({
                                target_id: e.target.value,
                                target_type: (e.target.value === routeDetails.route.start_site.id || e.target.value === routeDetails.route.end_site.id) ? 'site' : (prev?.target_type ?? 'site'),
                                distance_km: prev?.distance_km ?? Math.min(2, Math.max(0.2, routeDetails.route.distance_km * 0.1)),
                                tap_fibers: prev?.tap_fibers ?? 2,
                              }))}
                            >
                              <option value={routeDetails.route.start_site.id}>Start site: {routeDetails.route.start_site.name}</option>
                              <option value={routeDetails.route.end_site.id}>End site: {routeDetails.route.end_site.name}</option>
                            </select>
                          </label>
                          <label className="text-sm">
                            <span className="block mb-1 text-gray-600 dark:text-gray-300">Branch length (km)</span>
                            <input
                              type="number"
                              min={0.1}
                              step={0.1}
                              className="w-full border rounded px-2 py-1 bg-white dark:bg-gray-900"
                              value={cfg?.distance_km ?? Math.min(2, Math.max(0.2, routeDetails.route.distance_km * 0.1))}
                              onChange={(e) => setBranchForJc(jc.id, (prev) => ({
                                target_id: prev?.target_id ?? routeDetails.route.end_site.id,
                                target_type: prev?.target_type ?? 'site',
                                distance_km: Math.max(0.1, Number(e.target.value || 0)),
                                tap_fibers: prev?.tap_fibers ?? 2,
                              }))}
                            />
                          </label>
                          <label className="text-sm">
                            <span className="block mb-1 text-gray-600 dark:text-gray-300">Tap fibers</span>
                            <input
                              type="number"
                              min={1}
                              max={routeDetails.route.capacity}
                              className="w-full border rounded px-2 py-1 bg-white dark:bg-gray-900"
                              value={cfg?.tap_fibers ?? 2}
                              onChange={(e) => setBranchForJc(jc.id, (prev) => ({
                                target_id: prev?.target_id ?? routeDetails.route.end_site.id,
                                target_type: prev?.target_type ?? 'site',
                                distance_km: prev?.distance_km ?? Math.min(2, Math.max(0.2, routeDetails.route.distance_km * 0.1)),
                                tap_fibers: Math.min(routeDetails.route.capacity, Math.max(1, Number(e.target.value || 1))),
                              }))}
                            />
                          </label>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}
          </div>
          
          {/* Middle and Right Panels */}
          <div className="xl:col-span-2 space-y-6">
            <RouteVisualization 
                route={routeDetails.route} 
                equipment={allEquipmentOnRoute} 
                onRemoveJc={handleRemoveJc} 
            />

            {evolutionMode === 'commit' && (
              <CommitView 
                equipment={plannedJCs} 
                segments={projectedSegments} 
                splices={projectedSplices}
                onCommit={handleCommit}
                isCommitting={isCommitting}
              />
            )}
          </div>
        </div>
      )}
    </>
  );
}
```

<!-- path: hnvtx/components/ofcadv/schemas.ts -->
```typescript
// components/ofcadv/schemas.ts
// Lightweight runtime validators (type guards) to avoid extra deps.

import { RouteDetailsPayload, EvolutionCommitPayload, Equipment, CableSegment, FiberSplice, Site } from './types';

function isSite(x: any): x is Site {
  return x && typeof x.id === 'string' && typeof x.name === 'string';
}

function isEquipment(x: any): x is Equipment {
  return (
    x && typeof x.id === 'string' && typeof x.name === 'string' &&
    x.equipment_type === 'junction_closure' &&
    typeof x.latitude === 'number' && typeof x.longitude === 'number' &&
    (x.status === 'existing' || x.status === 'planned') &&
    x.attributes &&
    (x.attributes.jc_type === 'inline' || x.attributes.jc_type === 'branching' || x.attributes.jc_type === 'terminal') &&
    typeof x.attributes.capacity === 'number' &&
    typeof x.attributes.position_on_route === 'number'
  );
}

export function isRouteDetailsPayload(x: any): x is RouteDetailsPayload {
  return (
    x && x.route && typeof x.route.id === 'string' && typeof x.route.name === 'string' &&
    isSite(x.route.start_site) && isSite(x.route.end_site) &&
    typeof x.route.capacity === 'number' && typeof x.route.distance_km === 'number' &&
    (x.route.evolution_status === 'simple' || x.route.evolution_status === 'with_jcs' || x.route.evolution_status === 'fully_segmented') &&
    Array.isArray(x.equipment) && x.equipment.every(isEquipment)
  );
}

export function isCableSegment(x: any): x is CableSegment {
  return (
    x && typeof x.segment_order === 'number' &&
    typeof x.start_point_id === 'string' && typeof x.end_point_id === 'string' &&
    (x.start_point_type === 'site' || x.start_point_type === 'equipment') &&
    (x.end_point_type === 'site' || x.end_point_type === 'equipment') &&
    typeof x.fiber_count === 'number' && typeof x.distance_km === 'number'
  );
}

export function isFiberSplice(x: any): x is FiberSplice {
  return (
    x && typeof x.equipment_id === 'string' && typeof x.incoming_segment_id === 'string' &&
    typeof x.incoming_fiber_number === 'number' && typeof x.outgoing_segment_id === 'string' &&
    typeof x.outgoing_fiber_number === 'number' &&
    (x.splice_type === 'through' || x.splice_type === 'tap' || x.splice_type === 'split') &&
    (x.status === 'active' || x.status === 'spare' || x.status === 'faulty')
  );
}

export function isEvolutionCommitPayload(x: any): x is EvolutionCommitPayload {
  const ok = (
    x && Array.isArray(x.plannedEquipment) &&
    Array.isArray(x.plannedSegments) &&
    Array.isArray(x.plannedSplices)
  );
  if (!ok) return false;

  // We validate shapes of elements loosely as they are Omit<...>
  const equipOk = x.plannedEquipment.every((e: any) => (
    e && typeof e.name === 'string' && e.equipment_type === 'junction_closure' &&
    typeof e.latitude === 'number' && typeof e.longitude === 'number' &&
    e.attributes && (e.attributes.jc_type === 'inline' || e.attributes.jc_type === 'branching' || e.attributes.jc_type === 'terminal') &&
    typeof e.attributes.capacity === 'number' && typeof e.attributes.position_on_route === 'number'
  ));

  const segOk = x.plannedSegments.every((s: any) => isCableSegment({ ...s, id: 'x' }));
  const spOk = x.plannedSplices.every((sp: any) => isFiberSplice({ ...sp, id: 'x' }));

  return equipOk && segOk && spOk;
}

```

<!-- path: hnvtx/components/ofcadv/logic/project.ts -->
```typescript
// components/ofcadv/logic/project.ts
import { CableSegment, Equipment, FiberSplice, RouteDetailsPayload } from '../types';

export type BranchConfig = {
  target_id: string; // site or equipment id
  target_type: 'site' | 'equipment';
  distance_km: number; // length of the branch cable
  tap_fibers: number; // number of fibers to tap towards branch
};
export type BranchConfigMap = Record<string, BranchConfig>; // key: jc.id

// Project cable segments between start -> JCs -> end, ordered by position_on_route
export function projectSegments(
  route: RouteDetailsPayload['route'],
  equipment: Equipment[],
  branchConfig?: BranchConfigMap
): CableSegment[] {
  const sorted = [...equipment].sort(
    (a, b) => a.attributes.position_on_route - b.attributes.position_on_route
  );

  const points = [
    { id: route.start_site.id, type: 'site' as const, position: 0 },
    ...sorted.map((jc) => ({ id: jc.id, type: 'equipment' as const, position: jc.attributes.position_on_route })),
    { id: route.end_site.id, type: 'site' as const, position: 100 },
  ];

  const segments: CableSegment[] = [];
  let order = 1;
  for (let i = 0; i < points.length - 1; i++) {
    const start = points[i];
    const end = points[i + 1];
    const pct = Math.max(0, end.position - start.position) / 100;
    const distance = Math.round(route.distance_km * pct * 1000) / 1000; // km with 3 decimals
    segments.push({
      id: `proj-seg-${route.id}-${order}`,
      segment_order: order,
      start_point_id: start.id,
      end_point_id: end.id,
      start_point_type: start.type,
      end_point_type: end.type,
      fiber_count: route.capacity,
      distance_km: distance,
    });
    order++;
  }

  // Create branch segments based on provided config, fallback to small placeholder if branching without config
  const BRANCH_DEFAULT_KM = Math.max(0.2, Math.min(2, route.distance_km * 0.1)); // between 0.2 and 2 km
  for (const jc of equipment) {
    if (jc.attributes.jc_type === 'branching') {
      const cfg = branchConfig?.[jc.id];
      const endPointId = cfg?.target_id ?? `branch-end-${jc.id}`;
      const endPointType = cfg?.target_type ?? 'site';
      const distance = Math.round((cfg?.distance_km ?? BRANCH_DEFAULT_KM) * 1000) / 1000;
      segments.push({
        id: `proj-branch-${route.id}-${jc.id}`,
        segment_order: order++,
        start_point_id: jc.id,
        end_point_id: endPointId,
        start_point_type: 'equipment',
        end_point_type: endPointType,
        fiber_count: route.capacity,
        distance_km: distance,
      });
    }
  }
  return segments;
}

// Create default "through" splices as a placeholder; can be refined later.
export function projectDefaultSplices(
  route: RouteDetailsPayload['route'],
  segments: CableSegment[],
  equipment: Equipment[],
  branchConfig?: BranchConfigMap
): FiberSplice[] {
  const splices: FiberSplice[] = [];
  const DEFAULT_TAP_FIBERS = 2; // fallback

  // Build index of segments by their connection to speed lookups
  const segsByStart: Record<string, CableSegment[]> = {};
  const segsByEnd: Record<string, CableSegment[]> = {};
  for (const s of segments) {
    (segsByStart[s.start_point_id] ||= []).push(s);
    (segsByEnd[s.end_point_id] ||= []).push(s);
  }

  for (const jc of equipment) {
    const incoming = (segsByEnd[jc.id] || []).find(s => s.end_point_id === jc.id);
    const mainOutgoing = (segsByStart[jc.id] || []).find(s => s.start_point_id === jc.id && !s.id.startsWith('proj-branch-'));
    const branchOutgoing = (segsByStart[jc.id] || []).find(s => s.id.startsWith('proj-branch-'));

    if (!incoming || !mainOutgoing) continue; // need both to splice

    const fiberCount = Math.min(incoming.fiber_count, mainOutgoing.fiber_count);

    if (jc.attributes.jc_type === 'branching' && branchOutgoing) {
      const cfgTap = branchConfig?.[jc.id]?.tap_fibers ?? DEFAULT_TAP_FIBERS;
      // Through most fibers on the main, tap a few to the branch
      for (let i = 1; i <= fiberCount; i++) {
        if (i <= cfgTap) {
          splices.push({
            id: `sp-tap-${jc.id}-${i}`,
            equipment_id: jc.id,
            incoming_segment_id: incoming.id,
            incoming_fiber_number: i,
            outgoing_segment_id: branchOutgoing.id,
            outgoing_fiber_number: i,
            splice_type: 'tap',
            status: 'active',
          });
        } else {
          splices.push({
            id: `sp-through-${jc.id}-${i}`,
            equipment_id: jc.id,
            incoming_segment_id: incoming.id,
            incoming_fiber_number: i,
            outgoing_segment_id: mainOutgoing.id,
            outgoing_fiber_number: i,
            splice_type: 'through',
            status: 'active',
          });
        }
      }
    } else {
      // Inline: through all fibers by default
      for (let i = 1; i <= fiberCount; i++) {
        splices.push({
          id: `sp-through-${jc.id}-${i}`,
          equipment_id: jc.id,
          incoming_segment_id: incoming.id,
          incoming_fiber_number: i,
          outgoing_segment_id: mainOutgoing.id,
          outgoing_fiber_number: i,
          splice_type: 'through',
          status: 'active',
        });
      }
    }
  }

  return splices;
}

```

<!-- path: hnvtx/components/ofcadv/queryKeys.ts -->
```typescript
// components/ofcadv/queryKeys.ts

export const queryKeys = {
  routes: ['routes'] as const,
  routeDetails: (routeId: string | null) => ['routeDetails', routeId] as const,
};

```

<!-- path: hnvtx/providers/QueryProvider.tsx -->
```typescript
// providers/QueryProvider.tsx
'use client'

import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
import { ReactQueryDevtools } from '@tanstack/react-query-devtools'
import { useState } from 'react'

export function QueryProvider({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(() => new QueryClient({
    defaultOptions: {
      queries: {
        staleTime: 5 * 60 * 1000, // 5 minutes
        gcTime: 10 * 60 * 1000, // 10 minutes
        retry: (failureCount, error: Error) => {
          if ('status' in error && typeof error.status === 'number' && error.status >= 400 && error.status < 500) {
            return false
          }
          return failureCount < 3
        },
        refetchOnWindowFocus: false,
      },
      mutations: {
        retry: 1,
      },
    },
  }))

  return (
    <QueryClientProvider client={queryClient}>
      {children}
      <ReactQueryDevtools initialIsOpen={false} />
    </QueryClientProvider>
  )
}


```

<!-- path: hnvtx/providers/ToastProvider.tsx -->
```typescript
// components/providers/ToastProvider.tsx
'use client';

import { Toaster } from 'sonner';
import { useThemeStore } from '@/stores/themeStore';

export function ToastProvider({ children }: { children: React.ReactNode }) {
  const { theme } = useThemeStore();

  return (
    <>
      {children}
      <Toaster
        theme={theme === 'system' ? 'system' : theme}
        className="toaster group"
        toastOptions={{
          classNames: {
            toast:
              'group toast group-[.toaster]:bg-white group-[.toaster]:text-gray-950 group-[.toaster]:border-gray-200 group-[.toaster]:shadow-lg dark:group-[.toaster]:bg-gray-950 dark:group-[.toaster]:text-gray-50 dark:group-[.toaster]:border-gray-800',
            description: 'group-[.toast]:text-gray-500 dark:group-[.toast]:text-gray-400',
            actionButton:
              'group-[.toast]:bg-gray-900 group-[.toast]:text-gray-50 dark:group-[.toast]:bg-gray-50 dark:group-[.toast]:text-gray-900',
            cancelButton:
              'group-[.toast]:bg-gray-100 group-[.toast]:text-gray-500 dark:group-[.toast]:bg-gray-800 dark:group-[.toast]:text-gray-400',
          },
        }}
        richColors
        closeButton
        position="top-right"
      />
    </>
  );
}
```

<!-- path: hnvtx/providers/ThemeProvider.tsx -->
```typescript
"use client";

import { useEffect } from "react";
import { useThemeStore, hydrateThemeStore, Theme } from "@/stores/themeStore";

export default function ThemeProvider({
  children,
}: {
  children: React.ReactNode;
}) {
  const { theme, hydrated } = useThemeStore();

  // Hydrate theme from localStorage on mount
  useEffect(() => {
    // Add class to disable transitions during initial load
    document.documentElement.classList.add("no-transition");

    hydrateThemeStore();

    // Re-enable transitions after a short delay
    setTimeout(() => {
      document.documentElement.classList.remove("no-transition");
    }, 50);
  }, []);

  // Apply theme when hydrated or theme changes
  useEffect(() => {
    if (!hydrated) return;

    const applyTheme = (theme: Theme) => {
      const isDark =
        theme === "dark" ||
        (theme === "system" &&
          window.matchMedia("(prefers-color-scheme: dark)").matches);

      if (isDark) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    };

    applyTheme(theme);

    // Listen for system theme changes
    if (theme === "system") {
      const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
      const handleChange = () => applyTheme("system");

      mediaQuery.addEventListener("change", handleChange);
      return () => mediaQuery.removeEventListener("change", handleChange);
    }
  }, [theme, hydrated]);

  return <>{children}</>;
}
```

<!-- path: hnvtx/hooks/UseRouteBasedUploadConfigOptions.tsx -->
```typescript
// src/hooks/useRouteBasedUploadConfig.ts

import { useEffect, FC, ReactNode, useRef } from "react";
// Import the simplified store and its types
import {
  useUploadConfigStore,
  UploadConfig,
} from "@/stores/useUploadConfigStore";
import { useCurrentTableName } from "./useCurrentTableName";
import { TableNames } from "@/config/helper-types";
import { buildUploadConfig } from "@/config/table-column-keys";

export interface UseRouteBasedUploadConfigOptions {
  tableName?: TableNames;
  autoSetConfig?: boolean;
  customConfig?: Partial<UploadConfig<TableNames>>;
}

export const useRouteBasedUploadConfig = (
  options: UseRouteBasedUploadConfigOptions = {}
) => {
  const { tableName, autoSetConfig = true, customConfig } = options;
  const previousTableNameRef = useRef<TableNames | null>(null);

  // Get current table name from the new hook
  const currentTableName = useCurrentTableName(tableName);

  // Get the actions from the store
  const { setUploadConfig, getUploadConfig, clearUploadConfig } =
    useUploadConfigStore();

  // Proper cleanup and config management
  useEffect(() => {
    // Clear previous config when route changes
    if (
      previousTableNameRef.current &&
      previousTableNameRef.current !== currentTableName
    ) {
      clearUploadConfig(previousTableNameRef.current);
    }

    // Set new config if applicable
    if (autoSetConfig && currentTableName) {
      const generated = buildUploadConfig(currentTableName);
      const finalConfig = {
        ...generated,
        ...customConfig,
      } as UploadConfig<TableNames>;
      setUploadConfig(currentTableName, finalConfig);
    }

    // Update the ref with current table name
    previousTableNameRef.current = currentTableName;

    // Cleanup function - runs when component unmounts
    return () => {
      if (currentTableName) {
        clearUploadConfig(currentTableName);
      }
    };
  }, [
    currentTableName,
    autoSetConfig,
    customConfig,
    setUploadConfig,
    clearUploadConfig,
  ]);

  return {
    currentTableName,
    config: currentTableName ? getUploadConfig(currentTableName) : undefined,
  };
};

/**
 * A simple Provider component to easily wrap layouts or pages,
 * activating the route-based configuration logic.
 */
export const RouteBasedUploadConfigProvider: FC<{
  children: ReactNode;
  options?: UseRouteBasedUploadConfigOptions;
}> = ({ children, options = {} }) => {
  useRouteBasedUploadConfig(options);
  return <>{children}</>;
};

```

<!-- path: hnvtx/hooks/useOutdatedBrowserCheck.tsx -->
```typescript
import { useEffect, useState } from 'react';

const LOCAL_KEY = 'isOutdatedBrowser';

function detectOutdatedBrowser(): boolean {
  const ua = navigator.userAgent;
  let isOutdated = false;

  const isIE = /MSIE|Trident/.test(ua);
  const legacyEdgeMatch = ua.match(/Edge\/(\d+)/);
  const chromeMatch = ua.match(/Chrome\/(\d+)/);
  const firefoxMatch = ua.match(/Firefox\/(\d+)/);
  const safariMatch = ua.match(/Version\/(\d+).+Safari/);
  const edgeMatch = ua.match(/Edg\/(\d+)/);

  if (isIE) {
    isOutdated = true;
  } else if (legacyEdgeMatch) {
    const version = parseInt(legacyEdgeMatch[1]);
    if (version < 80) isOutdated = true;
  } else if (chromeMatch) {
    const version = parseInt(chromeMatch[1]);
    if (version < 110) isOutdated = true;
  } else if (firefoxMatch) {
    const version = parseInt(firefoxMatch[1]);
    if (version < 100) isOutdated = true;
  } else if (safariMatch) {
    const version = parseInt(safariMatch[1]);
    if (version < 15) isOutdated = true;
  } else if (edgeMatch) {
    const version = parseInt(edgeMatch[1]);
    if (version < 110) isOutdated = true;
  }

  const missingFeatures = [
    () => typeof Promise !== 'function' || typeof Symbol !== 'function',
    () => !CSS.supports('display', 'flex'),
    () => !CSS.supports('position', 'sticky'),
    () => !CSS.supports('backdrop-filter', 'blur(1px)'),
    () => typeof IntersectionObserver === 'undefined',
    () => typeof localStorage === 'undefined',
    () => typeof sessionStorage === 'undefined',
  ].some(fn => fn());

  return isOutdated || missingFeatures;
}

export function useOutdatedBrowserCheck(): boolean | null {
  const [isOutdated, setIsOutdated] = useState<boolean | null>(null);

  useEffect(() => {
    const cached = localStorage.getItem(LOCAL_KEY);
    if (cached !== null) {
      setIsOutdated(cached === 'true');
      return;
    }

    const result = detectOutdatedBrowser();
    localStorage.setItem(LOCAL_KEY, String(result));
    setIsOutdated(result);
  }, []);

  return isOutdated;
}

```

<!-- path: hnvtx/hooks/useBulkSelection.ts -->
```typescript
import { useState, useCallback } from 'react';

interface UseSelectionReturn<T> {
  selectedItems: Set<T>;
  selectedCount: number;
  toggleSelection: (id: T) => void;
  toggleAllSelection: (allIds: T[]) => void;
  setSelectedItems: (ids: T[]) => void;
  clearSelection: () => void;
  isSelected: (id: T) => boolean;
  isAllSelected: (allIds: T[]) => boolean;
  isIndeterminate: (allIds: T[]) => boolean;
}

export function useSelection<T = string>(): UseSelectionReturn<T> {
  const [selectedItems, setSelectedItems] = useState<Set<T>>(new Set());

  // Clear selection
  const clearSelection = useCallback(() => {
    setSelectedItems(new Set());
  }, []);

  // Toggle single item selection
  const toggleSelection = useCallback((id: T) => {
    setSelectedItems(prev => {
      const newSet = new Set(prev);
      if (newSet.has(id)) {
        newSet.delete(id);
      } else {
        newSet.add(id);
      }
      return newSet;
    });
  }, []);

  // Set selected items
  const setSelected = useCallback((ids: T[]) => {
    setSelectedItems(new Set(ids));
  }, []);

  // Toggle all items selection
  const toggleAllSelection = useCallback((allIds: T[]) => {
    setSelectedItems(prev => {
      if (prev.size === allIds.length && allIds.length > 0) {
        return new Set(); // Clear all if all are selected
      } else {
        return new Set(allIds); // Select all
      }
    });
  }, []);

  // Check if item is selected
  const isSelected = useCallback((id: T) => {
    return selectedItems.has(id);
  }, [selectedItems]);

  // Check if all items are selected
  const isAllSelected = useCallback((allIds: T[]) => {
    return allIds.length > 0 && selectedItems.size === allIds.length;
  }, [selectedItems]);

  // Check if selection is indeterminate (some but not all selected)
  const isIndeterminate = useCallback((allIds: T[]) => {
    return selectedItems.size > 0 && selectedItems.size < allIds.length;
  }, [selectedItems]);

  return {
    selectedItems,
    selectedCount: selectedItems.size,
    toggleSelection,
    toggleAllSelection,
    setSelectedItems: setSelected,
    clearSelection,
    isSelected,
    isAllSelected,
    isIndeterminate,
  };
}
```

<!-- path: hnvtx/hooks/useOrderedColumns.ts -->
```typescript
import { useMemo } from 'react';

const useOrderedColumns = <T extends { key: string }>(
  columns: T[],
  desiredOrder: string[]
): T[] => {
  return useMemo(() => {
    const ordered = desiredOrder
      .map(key => columns.find(col => col.key === key))
      .filter((col): col is T => col !== undefined);
    
    const remaining = columns.filter(col => !desiredOrder.includes(col.key));
    
    return [...ordered, ...remaining];
  }, [columns, desiredOrder]);
};

export default useOrderedColumns;
```

<!-- path: hnvtx/hooks/useAdminUsers.ts -->
```typescript
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { toast } from "sonner";
import { Database } from "@/types/supabase-types";
import { UserProfileData } from "@/components/users/user-types";
import { createClient } from "@/utils/supabase/client";

type ErrorType = {
  error: string;
  message: string;
  status?: number;
};

type Json = Record<string, any>;

type UserCreateInput = {
  id: string;  // This will be your custom UUID
  email: string;
  password: string;
  email_confirm?: boolean;
  first_name: string;
  last_name: string;
  role: string;
};

// Types
type AdminGetAllUsers =
  Database["public"]["Functions"]["admin_get_all_users"]["Args"];

type AdminGetAllUsersExtended =
  Database["public"]["Functions"]["admin_get_all_users_extended"]["Args"];

type AdminGetUserByID = Database['public']['Functions']['admin_get_user_by_id']['Args']

type AdminBulkDeleteUsersFunction =
  Database["public"]["Functions"]["admin_bulk_delete_users"]["Args"];

type AdminBulkUpdateUserRole =
  Database["public"]["Functions"]["admin_bulk_update_role"]["Args"];

type AdminBulkUpdateUserStatus =
  Database["public"]["Functions"]["admin_bulk_update_status"]["Args"];

type AdminUpdateUserProfile =
  Database["public"]["Functions"]["admin_update_user_profile"]["Args"];

export interface UserData {
  id: string;
  email: string;
  first_name: string;
  last_name: string;
  avatar_url: string;
  phone_number: string;
  date_of_birth: string;
  address: Json;
  preferences: Json;
  role: string;
  designation: string;
  status: string;
  is_email_verified: boolean;
  last_sign_in_at: string;
  created_at: string;
  updated_at: string;
  total_count: number;
}



// Query Keys
export const adminUserKeys = {
  all: ["admin-users"] as const,
  lists: () => [...adminUserKeys.all, "list"] as const,
  list: (filters: AdminGetAllUsers) =>
    [...adminUserKeys.lists(), filters] as const,
  details: () => [...adminUserKeys.all, "detail"] as const,
  detail: (id: string) => [...adminUserKeys.details(), id] as const,
  role: () => [...adminUserKeys.all, "my-role"] as const,
  userDetails: () => [...adminUserKeys.all, "my-details"] as const,
  superAdmin: () => [...adminUserKeys.all, "super-admin"] as const,
};

// Hook to get all users with filtering and pagination
export const useAdminGetAllUsers = (params: AdminGetAllUsers = {}) => {
  const supabase = createClient();
  return useQuery({
    queryKey: adminUserKeys.list(params),
    queryFn: async (): Promise<UserData[]> => {
      const { data, error } = await supabase.rpc("admin_get_all_users", params);

      if (error) {
        throw new Error(error.message);
      }

      return data || [];
    },
    staleTime: 5 * 60 * 1000, // 5 minutes
    gcTime: 10 * 60 * 1000, // 10 minutes
  });
};

export const useAdminGetAllUsersExtended = (params: AdminGetAllUsersExtended = {}) => {
  const supabase = createClient();
  return useQuery({
    queryKey: adminUserKeys.list(params),
    queryFn: async (): Promise<UserProfileData[]> => {
      const { data, error } = await supabase.rpc("admin_get_all_users_extended", params);

      if (error) {
        throw new Error(error.message);
      }

      return data as UserProfileData[] || [];
    },
    staleTime: 5 * 60 * 1000, // 5 minutes
    gcTime: 10 * 60 * 1000, // 10 minutes
  });
};

// Hook to get user by ID
export const useAdminGetUserById = (userId: string, enabled = true) => {
  const supabase = createClient();
  return useQuery({
    queryKey: adminUserKeys.detail(userId),
    queryFn: async (): Promise<UserProfileData | null> => {
      const { data, error } = await supabase.rpc("admin_get_user_by_id", {
        user_id: userId,
      });

      if (error) {
        throw new Error(error.message);
      }

      return data?.[0] as UserProfileData || null;
    },
    enabled: enabled && !!userId,
    staleTime: 5 * 60 * 1000,
  });
};

// Hook to get current user's role
export const useGetMyRole = () => {
  const supabase = createClient();
  return useQuery({
    queryKey: adminUserKeys.role(),
    queryFn: async (): Promise<string> => {
      const { data, error } = await supabase.rpc("get_my_role");

      if (error) {
        throw new Error(error.message);
      }

      return data || "";
    },
    staleTime: 15 * 60 * 1000, // 15 minutes (roles don't change often)
  });
};

// Hook to get current user's details
export const useGetMyUserDetails = () => {
  const supabase = createClient();
  return useQuery({
    queryKey: adminUserKeys.userDetails(),
    queryFn: async () => {
      const { data, error } = await supabase.rpc("get_my_user_details");

      if (error) {
        throw new Error(error.message);
      }

      return data?.[0] || null;
    },
    staleTime: 10 * 60 * 1000,
  });
};

// Hook to check if current user is super admin
export const useIsSuperAdmin = () => {
  const supabase = createClient();
  return useQuery({
    queryKey: adminUserKeys.superAdmin(),
    queryFn: async (): Promise<boolean> => {
      const { data, error } = await supabase.rpc("is_super_admin");

      if (error) {
        throw new Error(error.message);
      }

      return data || false;
    },
    staleTime: 15 * 60 * 1000,
  });
};

// Hook to update user profile
export const useAdminUpdateUserProfile = () => {
  const supabase = createClient();
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async (params: AdminUpdateUserProfile): Promise<boolean> => {
      const { data, error } = await supabase.rpc(
        "admin_update_user_profile",
        params
      );

      if (error) {
        throw new Error(error.message);
      }

      return data || false;
    },
    onSuccess: (_, variables) => {
      toast.success("User profile updated successfully");

      // Invalidate and refetch relevant queries
      queryClient.invalidateQueries({ queryKey: adminUserKeys.lists() });
      queryClient.invalidateQueries({
        queryKey: adminUserKeys.detail(variables.user_id),
      });
    },
    onError: (error) => {
      toast.error(`Failed to update user profile: ${error.message}`);
    },
  });
};

// Hook to bulk delete users
export const useAdminBulkDeleteUsers = () => {
  const supabase = createClient();
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async (
      params: AdminBulkDeleteUsersFunction
    ): Promise<boolean> => {
      const { data, error } = await supabase.rpc(
        "admin_bulk_delete_users",
        params
      );

      if (error) {
        throw new Error(error.message);
      }

      return data || false;
    },
    onSuccess: (_, variables) => {
      toast.success(
        `Successfully deleted ${variables.user_ids.length} user(s)`
      );

      // Invalidate all user lists
      queryClient.invalidateQueries({ queryKey: adminUserKeys.lists() });

      // Remove individual user queries from cache
      variables.user_ids.forEach((userId) => {
        queryClient.removeQueries({ queryKey: adminUserKeys.detail(userId) });
      });
    },
    onError: (error) => {
      toast.error(`Failed to delete users: ${error.message}`);
    },
  });
};

// Hook to bulk update user roles
export const useAdminBulkUpdateUserRole = () => {
  const supabase = createClient();
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async (params: AdminBulkUpdateUserRole): Promise<boolean> => {
      const { data, error } = await supabase.rpc(
        "admin_bulk_update_role",
        params
      );

      if (error) {
        throw new Error(error.message);
      }

      return data || false;
    },
    onSuccess: (_, variables) => {
      toast.success(
        `Successfully updated role for ${variables.user_ids.length} user(s)`
      );

      // Invalidate relevant queries
      queryClient.invalidateQueries({ queryKey: adminUserKeys.lists() });

      // Invalidate individual user details
      variables.user_ids.forEach((userId) => {
        queryClient.invalidateQueries({
          queryKey: adminUserKeys.detail(userId),
        });
      });
    },
    onError: (error) => {
      toast.error(`Failed to update user roles: ${error.message}`);
    },
  });
};

// Hook to bulk update user status
export const useAdminBulkUpdateUserStatus = () => {
  const supabase = createClient();
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async (params: AdminBulkUpdateUserStatus): Promise<boolean> => {
      const { data, error } = await supabase.rpc(
        "admin_bulk_update_status",
        params
      );

      if (error) {
        throw new Error(error.message);
      }

      return data || false;
    },
    onSuccess: (_, variables) => {
      toast.success(
        `Successfully updated status for ${variables.user_ids.length} user(s)`
      );

      // Invalidate relevant queries
      queryClient.invalidateQueries({ queryKey: adminUserKeys.lists() });

      // Invalidate individual user details
      variables.user_ids.forEach((userId) => {
        queryClient.invalidateQueries({
          queryKey: adminUserKeys.detail(userId),
        });
      });
    },
    onError: (error) => {
      toast.error(`Failed to update user status: ${error.message}`);
    },
  });
};

// Hook to create a new user
export const useAdminCreateUser = () => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async (userData: UserCreateInput) => {
      const res = await fetch("/api/admin/users", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(userData),
      });

      const data = await res.json();

      if (!res.ok) {
        throw new Error(data.error || "Failed to create user");
      }

      return data;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: adminUserKeys.lists() });
      toast.success("User created successfully");
    },
    onError: (error: Error) => {
      console.error("User creation error:", error);
      toast.error(error.message || "Failed to create user");
    },
  });
};


// Combined hook for multiple operations
interface UserOperations {
  createUser: ReturnType<typeof useAdminCreateUser>;
  updateUser: ReturnType<typeof useAdminUpdateUserProfile>;
  deleteUsers: ReturnType<typeof useAdminBulkDeleteUsers>;
  updateUserRoles: ReturnType<typeof useAdminBulkUpdateUserRole>;
  updateUserStatus: ReturnType<typeof useAdminBulkUpdateUserStatus>;
  isLoading: boolean;
}

export const useAdminUserOperations = (): UserOperations => {
  const createUser = useAdminCreateUser();
  const updateUser = useAdminUpdateUserProfile();
  const deleteUsers = useAdminBulkDeleteUsers();
  const updateUserRoles = useAdminBulkUpdateUserRole();
  const updateUserStatus = useAdminBulkUpdateUserStatus();

  return {
    createUser,
    updateUser,
    deleteUsers,
    updateUserRoles,
    updateUserStatus,
    isLoading: createUser.isPending || 
               updateUser.isPending || 
               deleteUsers.isPending || 
               updateUserRoles.isPending || 
               updateUserStatus.isPending
  };
};
```

<!-- path: hnvtx/hooks/database/advanced-bulk-queries.ts -->
```typescript
/* eslint-disable @typescript-eslint/no-explicit-any */
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { SupabaseClient } from "@supabase/supabase-js";
import { Database } from "@/types/supabase-types";
import { TableName, TableRow, TableUpdate, Filters, OrderBy, PerformanceOptions } from "./queries-type-helpers";
import { applyFilters, applyOrdering } from "./utility-functions";

// Enhanced bulk operations with more advanced filtering and performance features
export function useAdvancedBulkOperations<T extends TableName>(
  supabase: SupabaseClient<Database>,
  tableName: T,
  options?: {
    batchSize?: number;
    maxRetries?: number;
    retryDelay?: number;
    onProgress?: (completed: number, total: number) => void;
  }
) {
  const queryClient = useQueryClient();
  const { maxRetries = 3, retryDelay = 1000, onProgress } = options || {};

  // Helper function for retrying operations
  const withRetry = async <TResult>(operation: () => Promise<TResult>, retries = maxRetries): Promise<TResult> => {
    try {
      return await operation();
    } catch (error) {
      if (retries > 0) {
        await new Promise((resolve) => setTimeout(resolve, retryDelay));
        return withRetry(operation, retries - 1);
      }
      throw error;
    }
  };

  // Advanced bulk update with complex filtering and progress tracking
  const advancedBulkUpdate = useMutation({
    mutationFn: async (params: {
      criteria: {
        filters: Filters;
        data: TableUpdate<T>;
        orderBy?: OrderBy[];
        limit?: number;
      }[];
      performanceOptions?: PerformanceOptions;
    }): Promise<TableRow<T>[]> => {
      const { criteria, performanceOptions } = params;
      const allResults: TableRow<T>[] = [];
      let completed = 0;
      const total = criteria.length;

      for (const { filters, data, orderBy, limit } of criteria) {
        await withRetry(async () => {
          let query = supabase.from(tableName).update(data as any);

          // Apply filters
          query = applyFilters(query, filters);

          // Apply ordering if specified
          if (orderBy && orderBy.length > 0) {
            query = applyOrdering(query, orderBy);
          }

          // Apply limit if specified
          if (limit) {
            query = query.limit(limit);
          }

          // Apply performance options
          if (performanceOptions?.timeout) {
            query = query.abortSignal(AbortSignal.timeout(performanceOptions.timeout));
          }

          const { data: result, error } = await query.select();
          if (error) throw error;

          allResults.push(...(result as TableRow<T>[]));
          completed++;
          onProgress?.(completed, total);
        });
      }

      return allResults;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["table", tableName] });
      queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
    },
  });

  // Advanced bulk delete with complex criteria
  const advancedBulkDelete = useMutation({
    mutationFn: async (params: {
      criteria: Array<{
        filters?: Filters;
        ids?: string[];
        orderBy?: OrderBy[];
        limit?: number;
      }>;
      safetyLimit?: number; // Global safety limit
      performanceOptions?: PerformanceOptions;
    }): Promise<{ deletedCount: number; details: Array<{ criteriaIndex: number; deletedCount: number }> }> => {
      const { criteria, safetyLimit, performanceOptions } = params;
      let totalDeleted = 0;
      const details: Array<{ criteriaIndex: number; deletedCount: number }> = [];
      let completed = 0;
      const total = criteria.length;

      for (let i = 0; i < criteria.length; i++) {
        const { filters, ids, orderBy, limit } = criteria[i];

        await withRetry(async () => {
          let query = supabase.from(tableName).delete();

          // Apply ID filters if provided
          if (ids && ids.length > 0) {
            query = query.in("id" as any, ids);
          }

          // Apply other filters
          if (filters) {
            query = applyFilters(query, filters);
          }

          // Apply ordering (useful for limited deletes)
          if (orderBy && orderBy.length > 0) {
            query = applyOrdering(query, orderBy);
          }

          // Apply limit (either specified or safety limit)
          const effectiveLimit = Math.min(limit || Number.MAX_SAFE_INTEGER, safetyLimit || Number.MAX_SAFE_INTEGER);

          if (effectiveLimit < Number.MAX_SAFE_INTEGER) {
            query = query.limit(effectiveLimit);
          }

          // Apply performance options
          if (performanceOptions?.timeout) {
            query = query.abortSignal(AbortSignal.timeout(performanceOptions.timeout));
          }

          // First, count the records that will be deleted
          let countQuery = supabase.from(tableName).select("*", { count: "exact", head: true });

          if (ids && ids.length > 0) {
            countQuery = countQuery.in("id" as any, ids);
          }
          if (filters) {
            countQuery = applyFilters(countQuery, filters);
          }
          if (orderBy && orderBy.length > 0) {
            countQuery = applyOrdering(countQuery, orderBy);
          }
          if (effectiveLimit < Number.MAX_SAFE_INTEGER) {
            countQuery = countQuery.limit(effectiveLimit);
          }

          const { count: recordCount, error: countError } = await countQuery;
          if (countError) throw countError;

          // Now perform the actual delete
          const { error } = await query;
          if (error) throw error;

          const deletedInThisCriteria = recordCount || 0;
          totalDeleted += deletedInThisCriteria;
          details.push({ criteriaIndex: i, deletedCount: deletedInThisCriteria });

          completed++;
          onProgress?.(completed, total);
        });
      }

      return { deletedCount: totalDeleted, details };
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["table", tableName] });
      queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
    },
  });

  // Batch operation with transaction-like behavior (all or nothing)
  const transactionalBulkOperation = useMutation({
    mutationFn: async (params: {
      operations: Array<{
        type: "insert" | "update" | "delete";
        data?: any;
        filters?: Filters;
        ids?: string[];
      }>;
    }): Promise<{ success: boolean; results: any[]; errors?: Error[] }> => {
      const { operations } = params;
      const results: any[] = [];
      const errors: Error[] = [];

      // In a real implementation, you might want to use database transactions
      // For now, we'll simulate transaction-like behavior with rollback on error

      try {
        for (const operation of operations) {
          switch (operation.type) {
            case "insert":
              if (!operation.data) throw new Error("Insert operation requires data");
              const { data: insertData, error: insertError } = await supabase.from(tableName).insert(operation.data).select();
              if (insertError) throw insertError;
              results.push(insertData);
              break;

            case "update":
              if (!operation.data) throw new Error("Update operation requires data");
              let updateQuery = supabase.from(tableName).update(operation.data);

              if (operation.ids) {
                updateQuery = updateQuery.in("id" as any, operation.ids);
              }
              if (operation.filters) {
                updateQuery = applyFilters(updateQuery, operation.filters);
              }

              const { data: updateData, error: updateError } = await updateQuery.select();
              if (updateError) throw updateError;
              results.push(updateData);
              break;

            case "delete":
              let deleteQuery = supabase.from(tableName).delete();

              if (operation.ids) {
                deleteQuery = deleteQuery.in("id" as any, operation.ids);
              }
              if (operation.filters) {
                deleteQuery = applyFilters(deleteQuery, operation.filters);
              }

              const { error: deleteError } = await deleteQuery;
              if (deleteError) throw deleteError;
              results.push({ deleted: true });
              break;
          }
        }

        return { success: true, results };
      } catch (error) {
        errors.push(error as Error);
        // In a real database transaction, you would rollback here
        return { success: false, results: [], errors };
      }
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["table", tableName] });
      queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
    },
  });

  return {
    advancedBulkUpdate,
    advancedBulkDelete,
    transactionalBulkOperation,
  };
}

```

<!-- path: hnvtx/hooks/database/index.ts -->
```typescript
// hooks/database/index.ts - Main export file
export * from './queries-type-helpers'
export * from './utility-functions'
export * from './core-queries'
export * from './basic-mutation-hooks'
export * from './bulk-queries'
export * from './advanced-bulk-queries'

// Additional specialized hooks for complex operations
export * from './rpc-queries'
// Performance and Cache hooks
export * from './cache-performance'









```

<!-- path: hnvtx/hooks/database/basic-mutation-hooks.ts -->
```typescript
/* eslint-disable @typescript-eslint/no-explicit-any */
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { SupabaseClient } from "@supabase/supabase-js";
import { Database } from "@/types/supabase-types";
import { TableName, TableRow, TableInsert, TableUpdate, OptimisticContext, UseTableMutationOptions } from "./queries-type-helpers";

// Generic toggle status hook
export function useToggleStatus<T extends TableName>(supabase: SupabaseClient<Database>, tableName: T, options?: UseTableMutationOptions<TableRow<T>, { id: string; status: boolean; nameField?: keyof TableRow<T> }, OptimisticContext>) {
  const queryClient = useQueryClient();
  const { invalidateQueries = true, optimisticUpdate = true, ...mutationOptions } = options || {};

  return useMutation<TableRow<T>, Error, { id: string; status: boolean; nameField?: keyof TableRow<T> }, OptimisticContext>({
    mutationFn: async ({ id, status }): Promise<TableRow<T>> => {
      const { data, error } = await supabase
        .from(tableName)
        .update({ status, updated_at: new Date().toISOString() } as any)
        .eq("id" as any, id)
        .select()
        .single();
      if (error) throw error;
      return data as TableRow<T>;
    },
    onMutate: optimisticUpdate
      ? async ({ id, status }) => {
          await queryClient.cancelQueries({ queryKey: ["table", tableName] });
          const previousData = queryClient.getQueriesData({ queryKey: ["table", tableName] });
          queryClient.setQueriesData({ queryKey: ["table", tableName] }, (old: TableRow<T>[] | undefined) => {
            if (!old) return [];
            return old.map((item) => ("id" in item && (item as { id: unknown }).id === id ? { ...item, status, updated_at: new Date().toISOString() } : item)) as TableRow<T>[];
          });
          return { previousData };
        }
      : undefined,
    onError: optimisticUpdate
      ? (err, variables, context) => {
          context?.previousData?.forEach(([queryKey, data]) => queryClient.setQueryData(queryKey, data));
        }
      : undefined,
    onSuccess: (data, variables, context) => {
      if (invalidateQueries) {
        queryClient.invalidateQueries({ queryKey: ["table", tableName] });
        queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
      }
      options?.onSuccess?.(data, variables, context);
    },
    ...mutationOptions,
  });
}

// Optimized insert mutation with batching
export function useTableInsert<T extends TableName>(supabase: SupabaseClient<Database>, tableName: T, options?: UseTableMutationOptions<TableRow<T>[], TableInsert<T> | TableInsert<T>[], OptimisticContext>) {
  const queryClient = useQueryClient();
  const { invalidateQueries = true, optimisticUpdate = false, batchSize = 1000, ...mutationOptions } = options || {};

  return useMutation<TableRow<T>[], Error, TableInsert<T> | TableInsert<T>[], OptimisticContext>({
    mutationFn: async (data: TableInsert<T> | TableInsert<T>[]): Promise<TableRow<T>[]> => {
      const payload = (Array.isArray(data) ? data : [data]) as any;

      // Batch large inserts for better performance
      if (payload.length > batchSize) {
        const batches = [];
        for (let i = 0; i < payload.length; i += batchSize) {
          batches.push(payload.slice(i, i + batchSize));
        }

        const results = await Promise.all(
          batches.map(async (batch) => {
            const { data: result, error } = await supabase.from(tableName).insert(batch).select();
            if (error) throw error;
            return result as TableRow<T>[];
          })
        );

        return results.flat();
      }

      const { data: result, error } = await supabase.from(tableName).insert(payload).select();

      if (error) throw error;
      return result as TableRow<T>[];
    },
    onMutate: optimisticUpdate
      ? async (newData) => {
          await queryClient.cancelQueries({ queryKey: ["table", tableName] });

          const previousData = queryClient.getQueriesData({
            queryKey: ["table", tableName],
          });

          queryClient.setQueriesData({ queryKey: ["table", tableName] }, (old: TableRow<T>[] | undefined) => {
            if (!old) return [];
            const newItems = Array.isArray(newData) ? newData : [newData];
            return [
              ...old,
              ...newItems.map((item, index) => ({
                ...item,
                id: `temp-${Date.now()}-${index}`,
              })),
            ] as TableRow<T>[];
          });

          return { previousData };
        }
      : undefined,
    onError: optimisticUpdate
      ? (err, newData, context) => {
          if (context?.previousData) {
            context.previousData.forEach(([queryKey, data]) => {
              queryClient.setQueryData(queryKey, data);
            });
          }
        }
      : undefined,
    onSuccess: (data, variables, context) => {
      if (invalidateQueries) {
        queryClient.invalidateQueries({ queryKey: ["table", tableName] });
        queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
      }
      options?.onSuccess?.(data, variables, context);
    },
    ...mutationOptions,
  });
}

// Enhanced update mutation with optimizations
export function useTableUpdate<T extends TableName>(supabase: SupabaseClient<Database>, tableName: T, options?: UseTableMutationOptions<TableRow<T>[], { id: string; data: TableUpdate<T> }, OptimisticContext>) {
  const queryClient = useQueryClient();
  const { invalidateQueries = true, optimisticUpdate = false, ...mutationOptions } = options || {};

  return useMutation<TableRow<T>[], Error, { id: string; data: TableUpdate<T> }, OptimisticContext>({
    mutationFn: async ({ id, data }: { id: string; data: TableUpdate<T> }): Promise<TableRow<T>[]> => {
      const { data: result, error } = await supabase
        .from(tableName)
        .update(data as any)
        .eq("id" as any, id)
        .select();

      if (error) throw error;
      return result as TableRow<T>[];
    },
    onMutate: optimisticUpdate
      ? async ({ id, data: newData }) => {
          await queryClient.cancelQueries({ queryKey: ["table", tableName] });

          const previousData = queryClient.getQueriesData({
            queryKey: ["table", tableName],
          });

          queryClient.setQueriesData({ queryKey: ["table", tableName] }, (old: TableRow<T>[] | undefined) => {
            if (!old) return [];
            return old.map((item) => ("id" in item && (item as { id: unknown }).id === id ? { ...item, ...newData } : item)) as TableRow<T>[];
          });

          return { previousData };
        }
      : undefined,
    onError: optimisticUpdate
      ? (err, variables, context) => {
          if (context?.previousData) {
            context.previousData.forEach(([queryKey, data]) => {
              queryClient.setQueryData(queryKey, data);
            });
          }
        }
      : undefined,
    onSuccess: (data, variables, context) => {
      if (invalidateQueries) {
        queryClient.invalidateQueries({ queryKey: ["table", tableName] });
        queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
      }
      options?.onSuccess?.(data, variables, context);
    },
    ...mutationOptions,
  });
}

// Enhanced delete mutation
export function useTableDelete<T extends TableName>(supabase: SupabaseClient<Database>, tableName: T, options?: UseTableMutationOptions<void, string | string[], OptimisticContext>) {
  const queryClient = useQueryClient();
  const { invalidateQueries = true, optimisticUpdate = false, batchSize = 1000, ...mutationOptions } = options || {};

  return useMutation<void, Error, string | string[], OptimisticContext>({
    mutationFn: async (id: string | string[]): Promise<void> => {
      const ids = Array.isArray(id) ? id : [id];

      // Batch large deletes for better performance
      if (ids.length > batchSize) {
        const batches = [];
        for (let i = 0; i < ids.length; i += batchSize) {
          batches.push(ids.slice(i, i + batchSize));
        }

        await Promise.all(
          batches.map(async (batch) => {
            const { error } = await supabase
              .from(tableName)
              .delete()
              .in("id" as any, batch);
            if (error) throw error;
          })
        );
        return;
      }

      const { error } = await supabase
        .from(tableName)
        .delete()
        .in("id" as any, ids);

      if (error) throw error;
    },
    onMutate: optimisticUpdate
      ? async (id) => {
          await queryClient.cancelQueries({ queryKey: ["table", tableName] });

          const previousData = queryClient.getQueriesData({
            queryKey: ["table", tableName],
          });
          const ids = Array.isArray(id) ? id : [id];

          queryClient.setQueriesData({ queryKey: ["table", tableName] }, (old: TableRow<T>[] | undefined) => {
            if (!old) return [];
            return old.filter((item) => !("id" in item) || !ids.includes((item as { id: string }).id)) as TableRow<T>[];
          });

          return { previousData };
        }
      : undefined,
    onError: optimisticUpdate
      ? (err, variables, context) => {
          if (context?.previousData) {
            context.previousData.forEach(([queryKey, data]) => {
              queryClient.setQueryData(queryKey, data);
            });
          }
        }
      : undefined,
    onSuccess: (data, variables, context) => {
      if (invalidateQueries) {
        queryClient.invalidateQueries({ queryKey: ["table", tableName] });
        queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
      }
      options?.onSuccess?.(data, variables, context);
    },
    ...mutationOptions,
  });
}

```

<!-- path: hnvtx/hooks/database/rpc-hook-factory.ts -->
```typescript
// hooks/database/rpc-hook-factory.ts
import {
    useQuery,
    UseQueryResult,
    UseQueryOptions, // Import the base options type
  } from "@tanstack/react-query";
  import { SupabaseClient } from "@supabase/supabase-js";
  import { Database, Json } from "@/types/supabase-types";
  import { RpcFunctionName } from "./queries-type-helpers";
  
  // --- START OF FIX ---
  
  // This type is now more accurate. The data returned by the hook can be `TResult` or `null`.
  type PagedRpcQueryResult<TResult> = TResult | null;
  
  // Use Omit to create the options type. We're omitting the keys that our factory provides.
  // This tells TypeScript that the user can pass any *other* valid `useQuery` option.
  type PagedRpcQueryOptions<TResult> = Omit<
    UseQueryOptions<PagedRpcQueryResult<TResult>, Error, PagedRpcQueryResult<TResult>, readonly unknown[]>,
    'queryKey' | 'queryFn'
  >;
  
  // The options for the hook itself
  type PagedRpcHookOptions<TResult> = {
    limit?: number;
    offset?: number;
    orderBy?: string;
    orderDir?: "asc" | "desc";
    filters?: Json;
    queryOptions?: PagedRpcQueryOptions<TResult>; // Use the precise, new type
  };
  
  // --- END OF FIX ---
  
  
  export function createPagedRpcHook<TResult>(
    functionName: RpcFunctionName,
    viewName: string,
    defaultOrderBy: string
  ) {
    return function usePagedData(
      supabase: SupabaseClient<Database>,
      options: PagedRpcHookOptions<TResult>
    ): UseQueryResult<PagedRpcQueryResult<TResult>, Error> { // The hook's return type also includes `null`
      const {
        limit = 10,
        offset = 0,
        orderBy = defaultOrderBy,
        orderDir = "asc",
        filters = {},
        queryOptions,
      } = options;
  
      return useQuery<PagedRpcQueryResult<TResult>, Error, PagedRpcQueryResult<TResult>, readonly unknown[]>({
        queryKey: [viewName, { limit, offset, orderBy, orderDir, filters }],
        queryFn: async (): Promise<PagedRpcQueryResult<TResult>> => { // The queryFn's promise now correctly includes `null`
          const { data, error } = await supabase.rpc(functionName, {
            p_limit: limit,
            p_offset: offset,
            p_order_by: orderBy,
            p_order_dir: orderDir,
            p_filters: filters,
          });
  
          if (error) {
            console.error(`Error fetching from RPC function '${String(functionName)}':`, error);
            throw new Error(error.message);
          }
  
          return (data as TResult) ?? null;
        },
        ...queryOptions,
      });
    };
  }
```

<!-- path: hnvtx/hooks/database/bulk-queries.ts -->
```typescript
/* eslint-disable @typescript-eslint/no-explicit-any */
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { SupabaseClient } from "@supabase/supabase-js";
import { Database } from "@/types/supabase-types";
import { TableName, TableRow, TableInsert, TableUpdate, Filters, OrderBy, PerformanceOptions } from "./queries-type-helpers";
import { applyFilters } from "./utility-functions";

// Enhanced bulk operations hook with filter support
export function useTableBulkOperations<T extends TableName>(supabase: SupabaseClient<Database>, tableName: T, batchSize = 1000) {
  const queryClient = useQueryClient();

  const bulkInsert = useMutation({
    mutationFn: async (data: TableInsert<T>[]): Promise<TableRow<T>[]> => {
      const results: TableRow<T>[] = [];
      for (let i = 0; i < data.length; i += batchSize) {
        const batch = data.slice(i, i + batchSize) as any;
        const { data: batchResult, error } = await supabase.from(tableName).insert(batch).select();
        if (error) throw error;
        results.push(...(batchResult as TableRow<T>[]));
      }
      return results;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["table", tableName] });
      queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
    },
  });

  // Enhanced bulk update with filter support
  const bulkUpdate = useMutation({
    mutationFn: async (params: {
      updates: { id: string; data: TableUpdate<T> }[];
      filters?: Filters; // Optional filters to apply to ALL updates
    }): Promise<TableRow<T>[]> => {
      const { updates, filters } = params;
      const results: TableRow<T>[] = [];

      for (let i = 0; i < updates.length; i += batchSize) {
        const batch = updates.slice(i, i + batchSize);

        const batchPromises = batch.map(async ({ id, data }) => {
          let query = supabase
            .from(tableName)
            .update(data as any)
            .eq("id" as any, id);

          // Apply additional filters if provided
          if (filters) {
            query = applyFilters(query, filters);
          }

          const { data: result, error } = await query.select();
          if (error) throw error;
          return result as TableRow<T>[];
        });

        const batchResults = await Promise.all(batchPromises);
        results.push(...batchResults.flat());
      }

      return results;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["table", tableName] });
      queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
    },
  });

  // Enhanced bulk delete with filter support
  const bulkDelete = useMutation({
    mutationFn: async (params: {
      ids?: string[];
      filters?: Filters; // Optional: delete by filters instead of/in addition to IDs
      deleteAll?: boolean; // Safety flag for deleting all records
    }): Promise<void> => {
      const { ids, filters, deleteAll = false } = params;

      // Safety check: require either IDs, filters, or explicit deleteAll flag
      if (!ids && !filters && !deleteAll) {
        throw new Error("Must provide either ids, filters, or set deleteAll to true");
      }

      if (ids && ids.length > 0) {
        // Delete by IDs (existing behavior, but with optional additional filters)
        for (let i = 0; i < ids.length; i += batchSize) {
          const batch = ids.slice(i, i + batchSize);
          let query = supabase
            .from(tableName)
            .delete()
            .in("id" as any, batch);

          // Apply additional filters if provided
          if (filters) {
            query = applyFilters(query, filters);
          }

          const { error } = await query;
          if (error) throw error;
        }
      } else if (filters || deleteAll) {
        // Delete by filters only
        let query = supabase.from(tableName).delete();

        if (filters) {
          query = applyFilters(query, filters);
        }

        const { error } = await query;
        if (error) throw error;
      }
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["table", tableName] });
      queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
    },
  });

  const bulkUpsert = useMutation({
    mutationFn: async (data: TableInsert<T>[]): Promise<TableRow<T>[]> => {
      const results: TableRow<T>[] = [];
      for (let i = 0; i < data.length; i += batchSize) {
        const batch = data.slice(i, i + batchSize) as any;
        const { data: batchResult, error } = await supabase.from(tableName).upsert(batch).select();
        if (error) throw error;
        results.push(...(batchResult as TableRow<T>[]));
      }
      return results;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["table", tableName] });
      queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
    },
  });

  // New: Bulk insert with conditional logic based on existing data
  const bulkInsertByFilters = useMutation({
    mutationFn: async (params: {
      data: TableInsert<T>[];
      conflictResolution?: "skip" | "update" | "error"; // How to handle conflicts
      checkFilters?: Filters; // Check if records matching these filters exist
      onConflict?: string; // Column(s) to check for conflicts (e.g., 'email' or 'email,username')
    }): Promise<TableRow<T>[]> => {
      const { data, conflictResolution = "error", checkFilters, onConflict } = params;

      if (checkFilters) {
        // Check for existing records that match the filters
        let checkQuery = supabase.from(tableName).select("id");
        checkQuery = applyFilters(checkQuery, checkFilters);

        const { data: existingRecords, error: checkError } = await checkQuery;
        if (checkError) throw checkError;

        if (existingRecords && existingRecords.length > 0) {
          switch (conflictResolution) {
            case "skip":
              return []; // Skip insertion if records exist
            case "error":
              throw new Error(`Records matching filters already exist: ${existingRecords.length} found`);
            case "update":
              // Convert to upsert operation
              const { data: upsertResult, error: upsertError } = await supabase
                .from(tableName)
                .upsert(data as any, { onConflict })
                .select();
              if (upsertError) throw upsertError;
              return upsertResult as TableRow<T>[];
          }
        }
      }

      // Proceed with normal insertion
      const results: TableRow<T>[] = [];
      for (let i = 0; i < data.length; i += batchSize) {
        const batch = data.slice(i, i + batchSize) as any;

        let insertQuery = supabase.from(tableName).insert(batch);

        // Handle conflicts at database level if onConflict is specified
        if (conflictResolution === "skip" && onConflict) {
          insertQuery = supabase.from(tableName).upsert(batch, {
            onConflict,
            ignoreDuplicates: true,
          });
        } else if (conflictResolution === "update" && onConflict) {
          insertQuery = supabase.from(tableName).upsert(batch, { onConflict });
        }

        const { data: batchResult, error } = await insertQuery.select();
        if (error) throw error;
        results.push(...(batchResult as TableRow<T>[]));
      }
      return results;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["table", tableName] });
      queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
    },
  });

  // New: Bulk update by filters (update multiple records matching criteria)
  const bulkUpdateByFilters = useMutation({
    mutationFn: async (params: {
      data: TableUpdate<T>;
      filters: Filters;
      limit?: number; // Optional safety limit
    }): Promise<TableRow<T>[]> => {
      const { data, filters, limit } = params;

      let query = supabase.from(tableName).update(data as any);

      // Apply filters
      query = applyFilters(query, filters);

      // Apply limit if provided (for safety)
      if (limit) {
        query = query.limit(limit);
      }

      const { data: result, error } = await query.select();
      if (error) throw error;
      return result as TableRow<T>[];
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["table", tableName] });
      queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
    },
  });

  // New: Bulk upsert with filter-based conflict detection
  const bulkUpsertByFilters = useMutation({
    mutationFn: async (params: {
      data: TableInsert<T>[];
      onConflict?: string; // Column(s) for conflict detection
      checkFilters?: Filters; // Pre-check existing records
      updateColumns?: string[]; // Which columns to update on conflict (if not specified, updates all)
    }): Promise<TableRow<T>[]> => {
      const { data, onConflict, checkFilters, updateColumns } = params;

      // Optional: Check existing records first
      if (checkFilters) {
        try {
          // Create a new query builder
          let checkQuery = supabase.from(tableName).select("*", { count: "exact" });

          // Apply the filters
          checkQuery = applyFilters(checkQuery, checkFilters);

          // Execute the query
          const { data: existingRecords, error: checkError, count } = await checkQuery;

          if (checkError) {
            throw checkError;
          }

          console.log(`Found ${count || 0} existing records matching filters`);
        } catch (error) {
          throw error;
        }
      }

      const results: TableRow<T>[] = [];
      for (let i = 0; i < data.length; i += batchSize) {
        const batch = data.slice(i, i + batchSize) as any;

        const upsertOptions: any = {};
        if (onConflict) {
          upsertOptions.onConflict = onConflict;
        }
        if (updateColumns) {
          upsertOptions.columns = updateColumns;
        }

        const { data: batchResult, error } = await supabase.from(tableName).upsert(batch, upsertOptions).select();

        if (error) throw error;
        results.push(...(batchResult as TableRow<T>[]));
      }
      return results;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["table", tableName] });
      queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
    },
  });

  // New: Conditional bulk operations (perform operation only if conditions are met)
  const conditionalBulkUpdate = useMutation({
    mutationFn: async (params: {
      updates: Array<{
        id: string;
        data: TableUpdate<T>;
        conditions?: Filters; // Conditions that must be met for this specific update
      }>;
      globalFilters?: Filters; // Filters applied to all updates
    }): Promise<TableRow<T>[]> => {
      const { updates, globalFilters } = params;
      const results: TableRow<T>[] = [];

      for (let i = 0; i < updates.length; i += batchSize) {
        const batch = updates.slice(i, i + batchSize);

        const batchPromises = batch.map(async ({ id, data, conditions }) => {
          let query = supabase
            .from(tableName)
            .update(data as any)
            .eq("id" as any, id);

          // Apply global filters
          if (globalFilters) {
            query = applyFilters(query, globalFilters);
          }

          // Apply individual conditions
          if (conditions) {
            query = applyFilters(query, conditions);
          }

          const { data: result, error } = await query.select();
          if (error) throw error;
          return result as TableRow<T>[];
        });

        const batchResults = await Promise.all(batchPromises);
        results.push(...batchResults.flat());
      }

      return results;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["table", tableName] });
      queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
    },
  });

  return {
    bulkInsert,
    bulkUpdate,
    bulkDelete,
    bulkUpsert,
    bulkUpdateByFilters,
    bulkInsertByFilters,
    bulkUpsertByFilters,
    conditionalBulkUpdate,
  };
}

```

<!-- path: hnvtx/hooks/database/core-queries.ts -->
```typescript
/* eslint-disable @typescript-eslint/no-explicit-any */
import { useQuery, useInfiniteQuery, InfiniteData } from "@tanstack/react-query";
import { SupabaseClient } from "@supabase/supabase-js";
import { Database, Json } from "@/types/supabase-types";
import { TableOrViewName, TableName, Row, RowWithCount, DeduplicationOptions, InfiniteQueryPage, UseTableQueryOptions, UseTableInfiniteQueryOptions, UseTableRecordOptions, UseUniqueValuesOptions } from "./queries-type-helpers";
import { applyFilters, applyOrdering, buildDeduplicationQuery, createQueryKey, createUniqueValuesKey } from "./utility-functions";

// Generic table query hook with enhanced features
export function useTableQuery<T extends TableOrViewName, TData = RowWithCount<Row<T>>[]>(supabase: SupabaseClient<Database>, tableName: T, options?: UseTableQueryOptions<T, TData>) {
  const { columns = "*", filters, orderBy, limit, offset, deduplication, aggregation, performance, includeCount = false, ...queryOptions } = options || {};

  type QueryFnData = RowWithCount<Row<T>>[];

  return useQuery({
    queryKey: createQueryKey(tableName, filters, columns, orderBy, deduplication, aggregation, limit, offset),
    queryFn: async (): Promise<QueryFnData> => {
      if (deduplication) {
        const sql = buildDeduplicationQuery(tableName as string, deduplication, filters, orderBy);
        const { data: rpcData, error: rpcError } = await supabase.rpc("execute_sql", { sql_query: sql });
        if (rpcError) throw rpcError;
        if (rpcData && (rpcData as any).error) throw new Error(`Database RPC Error: ${(rpcData as any).error}`);
        return (rpcData as any)?.result || [];
      }

      if (aggregation) {
        const { data, error } = await supabase.rpc("aggregate_query", {
          table_name: tableName,
          aggregation_options: aggregation as unknown as Json,
          filters: (filters || {}) as unknown as Json,
          order_by: (orderBy || []) as unknown as Json,
        });
        if (error) throw error;
        return (data as any)?.result || [];
      }

      // When includeCount is requested, use Supabase's metadata count to support relation selects.
      // We then project the count back onto each row as `total_count` for backward compatibility.
      let query = includeCount
        ? supabase.from(tableName as any).select(columns as string, { count: "exact" })
        : supabase.from(tableName as any).select(columns as string);

      if (filters) query = applyFilters(query, filters);
      if (orderBy?.length) query = applyOrdering(query, orderBy);
      if (limit !== undefined) query = query.limit(limit);
      if (offset !== undefined) query = query.range(offset, offset + (limit || 1000) - 1);
      if (performance?.timeout) query = query.abortSignal(AbortSignal.timeout(performance.timeout));

      const { data, error, count } = await query as any;
      if (error) throw error;
      const rows = (data as unknown as Row<T>[]) || [];
      if (!includeCount) return rows as unknown as QueryFnData;
      const total = typeof count === "number" ? count : 0;
      // Attach total_count to each row to emulate window-count behavior
      const withCount = rows.map((r) => ({ ...(r as any), total_count: total }));
      return withCount as unknown as QueryFnData;
    },
    ...queryOptions,
  });
}

// Infinite scroll query hook for large datasets
export function useTableInfiniteQuery<T extends TableOrViewName, TData = InfiniteData<InfiniteQueryPage<T>>>(supabase: SupabaseClient<Database>, tableName: T, options?: UseTableInfiniteQueryOptions<T, TData>) {
  const { columns = "*", filters, orderBy, pageSize = 20, performance, ...queryOptions } = options || {};

  return useInfiniteQuery({
    queryKey: createQueryKey(tableName, filters, columns, orderBy, undefined, undefined, pageSize),
    queryFn: async ({ pageParam = 0 }) => {
      let query = supabase.from(tableName as any).select(columns, { count: "exact" });

      if (filters) query = applyFilters(query, filters);
      if (orderBy?.length) query = applyOrdering(query, orderBy);

      const startIdx = pageParam * pageSize;
      query = query.range(startIdx, startIdx + pageSize - 1);

      if (performance?.timeout) query = query.abortSignal(AbortSignal.timeout(performance.timeout));

      const { data, error, count } = await query;
      if (error) throw error;

      const results = (data as unknown as Row<T>[]) || [];

      return {
        data: results,
        nextCursor: results.length === pageSize ? pageParam + 1 : undefined,
        count: count ?? 0,
      };
    },
    getNextPageParam: (lastPage) => lastPage.nextCursor,
    initialPageParam: 0,
    ...queryOptions,
  });
}

// Generic single record query hook (optimized)
export function useTableRecord<T extends TableOrViewName, TData = Row<T> | null>(supabase: SupabaseClient<Database>, tableName: T, id: string | null, options?: UseTableRecordOptions<T, TData>) {
  const { columns = "*", performance, ...queryOptions } = options || {};

  return useQuery({
    queryKey: createQueryKey(tableName, { id: id as any }, columns),
    queryFn: async (): Promise<Row<T> | null> => {
      if (!id) return null;

      let query = supabase
        .from(tableName as any)
        .select(columns)
        .eq("id", id);

      if (performance?.timeout) query = query.abortSignal(AbortSignal.timeout(performance.timeout));

      const { data, error } = await query.maybeSingle();

      if (error) {
        if (error.code === "PGRST116") return null; // Not found, which is a valid null result
        throw error;
      }
      return (data as unknown as Row<T>) || null;
    },
    enabled: !!id && (queryOptions?.enabled ?? true),
    staleTime: 5 * 60 * 1000,
    ...queryOptions,
  });
}

// Get unique values for a specific column
export function useUniqueValues<T extends TableOrViewName, TData = unknown[]>(supabase: SupabaseClient<Database>, tableName: T, column: string, options?: UseUniqueValuesOptions<T, TData>) {
  const { filters, orderBy, limit, ...queryOptions } = options || {};

  return useQuery({
    queryKey: createUniqueValuesKey(tableName, column, filters, orderBy),
    queryFn: async (): Promise<unknown[]> => {
      const { data, error } = await supabase.rpc("get_unique_values", {
        table_name: tableName,
        column_name: column,
        filters: (filters || {}) as unknown as Json,
        order_by: (orderBy || []) as unknown as Json,
        limit_count: limit,
      });
      if (error) {
        console.error("RPC unique values failed, falling back to direct query", error);
        // Fallback implementation
        let fallbackQuery = supabase.from(tableName as any).select(column);
        if (filters) fallbackQuery = applyFilters(fallbackQuery, filters);
        if (orderBy?.length) fallbackQuery = applyOrdering(fallbackQuery, orderBy);
        if (limit) fallbackQuery = fallbackQuery.limit(limit);

        const { data: fallbackData, error: fallbackError } = await fallbackQuery;
        if (fallbackError) throw fallbackError;
        return [...new Set((fallbackData as any[])?.map((item) => item[column]) || [])];
      }
      return (data as any)?.map((item: any) => item.value) || [];
    },
    staleTime: 10 * 60 * 1000,
    ...queryOptions,
  });
}

// Deduplicated rows hook
export function useDeduplicated<T extends TableName>(supabase: SupabaseClient<Database>, tableName: T, deduplicationOptions: DeduplicationOptions, options?: Omit<UseTableQueryOptions<T>, "deduplication">) {
  return useTableQuery(supabase, tableName, {
    ...options,
    deduplication: deduplicationOptions,
  });
}

// Relationship query hook with optimizations
export function useTableWithRelations<T extends TableName, TData = RowWithCount<Row<T>>[]>(
  supabase: SupabaseClient<Database>,
  tableName: T,
  relations: string[],
  options?: UseTableQueryOptions<T, TData>
) {
  const columnsString = relations.length > 0 ? `*, ${relations.join(", ")}` : "*";

  return useTableQuery<T, TData>(supabase, tableName, {
    ...options,
    columns: columnsString,
  });
}

```

<!-- path: hnvtx/hooks/database/excel-queries/index.ts -->
```typescript
export * from "./excel-download";
export * from "./excel-upload";
```

<!-- path: hnvtx/hooks/database/excel-queries/excel-helpers.ts -->
```typescript
// hooks/database/excel-queries.ts
import * as ExcelJS from "exceljs";
import { Filters, UploadResult } from "@/hooks/database";
import { AuthTableOrViewName, Row } from "@/hooks/database";

//================================================================================
// TYPES AND INTERFACES
//================================================================================

export interface Column<T> {
  key: string;
  title: string;
  dataIndex: string;
  width?: number | string;
  sortable?: boolean;
  searchable?: boolean;
  filterable?: boolean;
  editable?: boolean;
  render?: (value: unknown, record: T, index: number) => React.ReactNode;
  filterOptions?: { label: string; value: unknown }[];
  align?: "left" | "center" | "right";
  hidden?: boolean;
  excelFormat?: "text" | "number" | "date" | "currency" | "percentage" | "json";
  excludeFromExport?: boolean;
}

// Generic RPC Configuration that works with any function
export interface RPCConfig<TParams = Record<string, unknown>> {
  functionName: string;
  parameters?: TParams;
  selectFields?: string;
}

// NOTE: T refers to a table/view name. Columns should describe a Row<T>.
export interface DownloadOptions<
  T extends AuthTableOrViewName = AuthTableOrViewName
> {
  fileName?: string;
  filters?: Filters;
  columns?: Column<Row<T>>[];
  sheetName?: string;
  maxRows?: number;
  customStyles?: ExcelStyles;
  rpcConfig?: RPCConfig;
}

export interface ExcelStyles {
  headerFont?: Partial<ExcelJS.Font>;
  headerFill?: ExcelJS.FillPattern;
  dataFont?: Partial<ExcelJS.Font>;
  alternateRowFill?: ExcelJS.FillPattern;
  borderStyle?: Partial<ExcelJS.Borders>;
}

export interface ExcelDownloadResult {
  fileName: string;
  rowCount: number;
  columnCount: number;
}

export interface UseExcelDownloadOptions<
  T extends AuthTableOrViewName = AuthTableOrViewName
> {
  onSuccess?: (
    data: ExcelDownloadResult,
    variables: DownloadOptions<T>
  ) => void;
  onError?: (error: Error, variables: DownloadOptions<T>) => void;
  showToasts?: boolean;
  batchSize?: number;
  defaultRPCConfig?: RPCConfig;
}

// Enhanced error tracking interfaces
export interface ValidationError {
  rowIndex: number;
  column: string;
  value: unknown;
  error: string;
  data?: Record<string, unknown>;
}

export interface ProcessingLog {
  rowIndex: number;
  excelRowNumber: number;
  originalData: Record<string, unknown>;
  processedData: Record<string, unknown>;
  validationErrors: ValidationError[];
  isSkipped: boolean;
  skipReason?: string;
}

export interface EnhancedUploadResult extends UploadResult {
  processingLogs: ProcessingLog[];
  validationErrors: ValidationError[];
  skippedRows: number;
}

//================================================================================
// UTILITY FUNCTIONS
//================================================================================

export const createFillPattern = (color: string): ExcelJS.FillPattern => ({
  type: "pattern",
  pattern: "solid",
  fgColor: { argb: color },
});

export const formatCellValue = <T = unknown>(
  value: unknown,
  column: Column<T>
): unknown => {
  if (value === null || value === undefined) return "";
  
  // Handle number types first
  if (typeof value === 'number') {
    return value;
  }
  
  // Handle object values
  if (typeof value === 'object' && value !== null) {
    // If it's a Date object
    if (value instanceof Date) {
      return value;
    }
    // If it's an array, join with comma
    if (Array.isArray(value)) {
      return value.join(', ');
    }
    // For other objects, try to stringify
    try {
      const str = JSON.stringify(value);
      // If it's a JSON object string, parse and get a simple string representation
      if (str.startsWith('{') || str.startsWith('[')) {
        const parsed = JSON.parse(str);
        if (typeof parsed === 'object' && parsed !== null) {
          // For objects, get values and join
          if (Array.isArray(parsed)) {
            return parsed.join(', ');
          }
          return Object.values(parsed).filter(v => v !== undefined && v !== null).join(', ');
        }
        return String(parsed);
      }
      return str;
    } catch {
      return String(value);
    }
  }

  // Handle non-object values
  switch (column.excelFormat) {
    case "date":
      return value instanceof Date ? value : new Date(value as string);
    case "number":
      return typeof value === "string" ? parseFloat(value) || 0 : value;
    case "currency":
      return typeof value === "string"
        ? parseFloat(value.replace(/[^0-9.-]/g, "")) || 0
        : value;
    case "percentage":
      return typeof value === "number"
        ? value / 100
        : parseFloat(String(value)) / 100 || 0;
    case "json": {
      if (typeof value === "string") {
        try {
          const parsed = JSON.parse(value);
          return JSON.stringify(parsed);
        } catch {
          return value;
        }
      }
      return String(value);
    }
    default:
      return String(value);
  }
};

export const applyCellFormatting = <T = unknown>(
  cell: ExcelJS.Cell,
  column: Column<T>
): void => {
  switch (column.excelFormat) {
    case "date":
      cell.numFmt = "mm/dd/yyyy";
      break;
    case "currency":
      cell.numFmt = '"$"#,##0.00';
      break;
    case "percentage":
      cell.numFmt = "0.00%";
      break;
    case "number":
      cell.numFmt = "#,##0.00";
      break;
  }
  if (column.align) {
    cell.alignment = { horizontal: column.align };
  }
};

export const getDefaultStyles = (): ExcelStyles => ({
  headerFont: { bold: true, color: { argb: "FFFFFFFF" }, size: 12 },
  headerFill: createFillPattern("FF2563EB"),
  dataFont: { size: 11 },
  alternateRowFill: createFillPattern("FFF8F9FA"),
  borderStyle: {
    top: { style: "thin" },
    left: { style: "thin" },
    bottom: { style: "thin" },
    right: { style: "thin" },
  },
});

export const sanitizeFileName = (fileName: string): string => {
  return fileName.replace(/[^a-z0-9.-]/gi, "_").replace(/_{2,}/g, "_");
};

export const convertFiltersToRPCParams = (
  filters?: Filters
): Record<string, unknown> => {
  if (!filters) return {};

  const rpcParams: Record<string, unknown> = {};

  Object.entries(filters).forEach(([key, value]) => {
    if (value !== undefined && value !== null && value !== "") {
      rpcParams[key] = value;
    }
  });

  return rpcParams;
};

// Safe UUID generator: uses crypto.randomUUID if available, otherwise a lightweight fallback
export const generateUUID = (): string => {
  const g = globalThis as { crypto?: { randomUUID?: () => string } };
  if (g && g.crypto && typeof g.crypto.randomUUID === "function") {
    return g.crypto.randomUUID();
  }
  // RFC4122 version 4 fallback
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
    const r = (Math.random() * 16) | 0;
    const v = c === "x" ? r : (r & 0x3) | 0x8;
    return v.toString(16);
  });
};

// Enhanced logging utilities
export const logRowProcessing = (
  rowIndex: number,
  excelRowNumber: number,
  originalData: Record<string, unknown>,
  processedData: Record<string, unknown>,
  validationErrors: ValidationError[] = [],
  isSkipped = false,
  skipReason?: string
): ProcessingLog => {
  const log: ProcessingLog = {
    rowIndex,
    excelRowNumber,
    originalData,
    processedData,
    validationErrors,
    isSkipped,
    skipReason,
  };

  console.group(`🔍 Processing Row ${excelRowNumber} (Index: ${rowIndex})`);
  console.log("📊 Original Data:", originalData);
  console.log("🔄 Processed Data:", processedData);

  if (validationErrors.length > 0) {
    console.warn("❌ Validation Errors:", validationErrors);
  }

  if (isSkipped) {
    console.warn("⏭️ Row Skipped:", skipReason);
  }

  console.groupEnd();

  return log;
};

export const logColumnTransformation = (
  rowIndex: number,
  column: string,
  originalValue: unknown,
  transformedValue: unknown,
  error?: string
): void => {
  console.log(`🔧 Column "${column}" (Row ${rowIndex + 2}):`);
  console.log(
    `   Original: ${JSON.stringify(originalValue)} (${typeof originalValue})`
  );
  console.log(
    `   Transformed: ${JSON.stringify(
      transformedValue
    )} (${typeof transformedValue})`
  );

  if (error) {
    console.error(`   ❌ Error: ${error}`);
  }
};

// Enhanced value validation
export const validateValue = (
  value: unknown,
  columnName: string,
  isRequired: boolean
): ValidationError | null => {
  if (isRequired) {
    const isEmpty =
      value === null ||
      value === undefined ||
      (typeof value === "string" && value.trim() === "");

    if (isEmpty) {
      return {
        rowIndex: -1, // Will be set by caller
        column: columnName,
        value,
        error: `Required field "${columnName}" is empty`,
      };
    }
  }

  // Type-specific validations
  if (value !== null && value !== undefined && value !== "") {
    // Check for UUID format if column suggests it's an ID
    if ((columnName === "id" || columnName.endsWith("_id") ) && columnName !== "transnet_id") {
      const uuidRegex =
        /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
      const strValue = String(value).trim();
      if (strValue && !uuidRegex.test(strValue) && strValue !== "") {
        return {
          rowIndex: -1,
          column: columnName,
          value,
          error: `Invalid UUID format for "${columnName}": ${strValue}`,
        };
      }
    }

    // Check for email format
    if (columnName.toLowerCase().includes("email")) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const strValue = String(value).trim();
      if (strValue && !emailRegex.test(strValue)) {
        return {
          rowIndex: -1,
          column: columnName,
          value,
          error: `Invalid email format for "${columnName}": ${strValue}`,
        };
      }
    }

    // Check for IP address format
    const isIPField =
      columnName === "ip_address" ||
      columnName.endsWith("_ip") ||
      columnName.includes("ipaddr");
    if (isIPField) {
      const ipRegex =
        /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
      const strValue = String(value).trim();
      if (strValue && !ipRegex.test(strValue)) {
        return {
          rowIndex: -1,
          column: columnName,
          value,
          error: `Invalid IP address format for "${columnName}": ${strValue}`,
        };
      }
    }
  }

  return null;
};

```

<!-- path: hnvtx/hooks/database/excel-queries/excel-download.ts -->
```typescript

import { AuthTableOrViewName, isTableName, Row, TableName, ViewName } from "../queries-type-helpers";
import * as ExcelJS from "exceljs";
import { SupabaseClient } from "@supabase/supabase-js";
import { Database } from "@/types/supabase-types";
import { useMutation } from "@tanstack/react-query";
import { applyCellFormatting, convertFiltersToRPCParams, DownloadOptions, ExcelDownloadResult, formatCellValue, getDefaultStyles, RPCConfig, sanitizeFileName, UseExcelDownloadOptions } from "./excel-helpers";
import { toast } from "sonner";
import { applyFilters } from "../utility-functions";

// Extended types for new functionality
interface OrderByOption {
column: string;
ascending?: boolean;
}

interface EnhancedDownloadOptions<T extends AuthTableOrViewName> extends DownloadOptions<T> {
orderBy?: OrderByOption[];
wrapText?: boolean;
autoFitColumns?: boolean;
}

interface EnhancedUseExcelDownloadOptions<T extends AuthTableOrViewName> extends UseExcelDownloadOptions<T> {
defaultOrderBy?: OrderByOption[];
defaultWrapText?: boolean;
defaultAutoFitColumns?: boolean;
}

// Hook for RPC-based downloads with full type safety
export function useRPCExcelDownload<T extends AuthTableOrViewName>(
  supabase: SupabaseClient<Database>,
  options?: EnhancedUseExcelDownloadOptions<T>
) {
  const {
    showToasts = true,
    batchSize = 50000,
    defaultOrderBy,
    defaultWrapText = true,
    defaultAutoFitColumns = true,
    ...mutationOptions
  } = options || {};

  return useMutation<
    ExcelDownloadResult,
    Error,
    EnhancedDownloadOptions<T> & { rpcConfig: RPCConfig }
  >({
    mutationFn: async (downloadOptions): Promise<ExcelDownloadResult> => {
      try {
        const defaultStyles = getDefaultStyles();
        const mergedOptions = {
          sheetName: "Data",
          maxRows: batchSize,
          customStyles: defaultStyles,
          orderBy: defaultOrderBy,
          wrapText: defaultWrapText,
          autoFitColumns: defaultAutoFitColumns,
          ...downloadOptions,
        };

        const {
          fileName = `export-${new Date().toISOString().split("T")[0]}.xlsx`,
          filters,
          columns,
          sheetName,
          maxRows,
          rpcConfig,
          orderBy,
          wrapText,
          autoFitColumns,
        } = mergedOptions;

        const styles = { ...defaultStyles, ...mergedOptions.customStyles };

        if (!columns || columns.length === 0)
          throw new Error("No columns specified for export");
        if (!rpcConfig)
          throw new Error("RPC configuration is required for this hook");

        const exportColumns = columns.filter((col) => !col.excludeFromExport);
        if (exportColumns.length === 0)
          throw new Error("All columns are excluded from export");

        toast.info("Fetching data via RPC...");

        // Prepare RPC parameters
        const rpcParams = {
          ...rpcConfig.parameters,
          ...convertFiltersToRPCParams(filters),
        };

        if (maxRows) {
          rpcParams.row_limit = maxRows;
        }

        // Add ordering parameters to RPC if supported
        if (orderBy && orderBy.length > 0) {
          rpcParams.order_by = orderBy.map(order => 
            `${order.column}.${order.ascending !== false ? 'asc' : 'desc'}`
          ).join(',');
        }

        // Execute RPC call with proper error handling
        const { data, error } = await supabase.rpc(
          rpcConfig.functionName as keyof Database["public"]["Functions"],
          rpcParams
        );

        if (error) throw new Error(`RPC call failed: ${error.message}`);
        if (!data || (Array.isArray(data) && data.length === 0)) {
          throw new Error("No data returned from RPC function");
        }

        // Ensure data is an array
        let dataArray = Array.isArray(data) ? data : [data];
        
        // Apply client-side ordering if RPC doesn't support it
        if (orderBy && orderBy.length > 0) {
          dataArray = dataArray.sort((a, b) => {
            for (const order of orderBy) {
              // Safe property access with type guards
              const aVal = (a && typeof a === 'object' && !Array.isArray(a)) 
                ? (a as Record<string, unknown>)[order.column] 
                : undefined;
              const bVal = (b && typeof b === 'object' && !Array.isArray(b)) 
                ? (b as Record<string, unknown>)[order.column] 
                : undefined;
              
              if (aVal === bVal) continue;
              
              let comparison = 0;
              if (aVal == null && bVal != null) comparison = 1;
              else if (aVal != null && bVal == null) comparison = -1;
              else if (aVal != null && bVal != null) {
                if (aVal < bVal) comparison = -1;
                else if (aVal > bVal) comparison = 1;
              }
              
              return order.ascending !== false ? comparison : -comparison;
            }
            return 0;
          });
        }
        
        toast.success(
          `Fetched ${dataArray.length} records. Generating Excel file...`
        );

        const workbook = new ExcelJS.Workbook();
        const worksheet = workbook.addWorksheet(sheetName || "Data");

        // Set column properties with enhanced options
        worksheet.columns = exportColumns.map((col) => ({
          key: String(col.dataIndex),
          width: typeof col.width === "number" ? col.width / 8 : 20,
        }));

        // Add header row with enhanced styling
        const headerTitles = exportColumns.map((col) => col.title);
        const headerRow = worksheet.addRow(headerTitles);
        headerRow.height = 25;

        exportColumns.forEach((col, index) => {
          const cell = headerRow.getCell(index + 1);
          if (styles.headerFont) cell.font = styles.headerFont;
          if (styles.headerFill) cell.fill = styles.headerFill;
          
          // Enhanced header alignment with text wrapping
          cell.alignment = { 
            horizontal: "center", 
            vertical: "middle",
            wrapText: wrapText || false
          };

          if (styles.borderStyle) {
            cell.border = {
              top: styles.borderStyle.top,
              bottom: styles.borderStyle.bottom,
              right: styles.borderStyle.right,
              left: index === 0 ? styles.borderStyle.left : undefined,
            };
          }
        });

        // Add data rows with enhanced styling
        dataArray.forEach((record, rowIndex: number) => {
          // Ensure we only process object-like rows
          if (record === null || typeof record !== "object" || Array.isArray(record)) {
            return; // skip non-object rows
          }

          const obj = record as Record<string, unknown>;
          const rowData: Record<string, unknown> = {};
          exportColumns.forEach((col) => {
            const key = String(col.dataIndex);
            const value = obj[key];
            rowData[key] = formatCellValue(value, col);
          });
          const excelRow = worksheet.addRow(rowData);

          // Enhanced cell styling with wrap text support
          exportColumns.forEach((col, colIndex) => {
            const cell = excelRow.getCell(colIndex + 1);

            if (styles.dataFont) cell.font = styles.dataFont;

            if (rowIndex % 2 === 1 && styles.alternateRowFill) {
              cell.fill = styles.alternateRowFill;
            }

            // Apply text wrapping and alignment
            cell.alignment = {
              ...cell.alignment,
              wrapText: wrapText || false,
              vertical: 'top' // Better for wrapped text
            };

            applyCellFormatting(cell, col);

            if (styles.borderStyle) {
              const isLastDataRow = rowIndex === dataArray.length - 1;
              cell.border = {
                right: styles.borderStyle.right,
                left: colIndex === 0 ? styles.borderStyle.left : undefined,
                top: styles.borderStyle.top,
                bottom: isLastDataRow ? styles.borderStyle.bottom : undefined,
              };
            }
          });
        });

        // Auto-fit columns if enabled
        if (autoFitColumns) {
          exportColumns.forEach((col, index) => {
            const column = worksheet.getColumn(index + 1);
            let maxLength = col.title.length;
            
            // Calculate max content length for auto-fitting
            dataArray.forEach((record) => {
              if (record && typeof record === "object" && !Array.isArray(record)) {
                const obj = record as Record<string, unknown>;
                const key = String(col.dataIndex);
                const value = obj[key];
                const cellText = String(formatCellValue(value, col) || '');
                
                // For wrapped text, consider line breaks
                if (wrapText) {
                  const lines = cellText.split('\n');
                  const maxLineLength = Math.max(...lines.map(line => line.length));
                  maxLength = Math.max(maxLength, maxLineLength);
                } else {
                  maxLength = Math.max(maxLength, cellText.length);
                }
              }
            });
            
            // Set reasonable bounds for column width
            const calculatedWidth = Math.min(Math.max(maxLength + 2, 10), 50);
            column.width = calculatedWidth;
          });
        }

        // Freeze header row
        worksheet.views = [{ state: "frozen", ySplit: 1 }];

        // Generate and download file
        const buffer = await workbook.xlsx.writeBuffer();
        const sanitizedFileName = sanitizeFileName(fileName);
        const blob = new Blob([buffer], {
          type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
        });

        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = sanitizedFileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(link.href);

        toast.success(
          `Excel file "${sanitizedFileName}" downloaded successfully!`
        );
        return {
          fileName: sanitizedFileName,
          rowCount: dataArray.length,
          columnCount: exportColumns.length,
        };
      } catch (error) {
        const errorMessage =
          error instanceof Error ? error.message : "Unknown error occurred";
        if (showToasts) {
          toast.error(`Download failed: ${errorMessage}`);
        }
        throw error;
      }
    },
    ...mutationOptions,
  });
}

// // Hook for traditional table/view downloads with enhanced features
// export function useTableExcelDownload<T extends AuthTableOrViewName>(
//   supabase: SupabaseClient<Database>,
//   tableName: T,
//   options?: EnhancedUseExcelDownloadOptions<T>
// ) {
//   const {
//     showToasts = true,
//     batchSize = 50000,
//     defaultOrderBy,
//     defaultWrapText = true,
//     defaultAutoFitColumns = true,
//     ...mutationOptions
//   } = options || {};

//   return useMutation<
//     ExcelDownloadResult,
//     Error,
//     Omit<EnhancedDownloadOptions<T>, "rpcConfig">
//   >({
//     mutationFn: async (downloadOptions): Promise<ExcelDownloadResult> => {
//       try {
//         const defaultStyles = getDefaultStyles();
//         const mergedOptions = {
//           sheetName: "Data",
//           maxRows: batchSize,
//           customStyles: defaultStyles,
//           orderBy: defaultOrderBy,
//           wrapText: defaultWrapText,
//           autoFitColumns: defaultAutoFitColumns,
//           ...downloadOptions,
//         };

//         const {
//           fileName = `${String(tableName)}-${
//             new Date().toISOString().split("T")[0]
//           }.xlsx`,
//           filters,
//           columns,
//           sheetName,
//           maxRows,
//           orderBy,
//           wrapText,
//           autoFitColumns,
//         } = mergedOptions;

//         const styles = { ...defaultStyles, ...mergedOptions.customStyles };

//         if (!columns || columns.length === 0)
//           throw new Error("No columns specified for export");
//         const exportColumns = columns.filter((col) => !col.excludeFromExport);
//         if (exportColumns.length === 0)
//           throw new Error("All columns are excluded from export");

//         toast.info("Fetching data for download...");

//         const selectFields = exportColumns
//           .map((col) => col.dataIndex)
//           .join(",");
//         let query = isTableName(tableName)
//           ? supabase.from(tableName as TableName).select(selectFields)
//           : supabase.from(tableName as ViewName).select(selectFields);

//         if (filters) query = applyFilters(query, filters);
        
//         // Apply ordering to the Supabase query
//         if (orderBy && orderBy.length > 0) {
//           orderBy.forEach(order => {
//             query = query.order(order.column, { ascending: order.ascending !== false });
//           });
//         }
        
//         if (maxRows) query = query.limit(maxRows);

//         const { data, error } = await query;

//         if (error) throw new Error(`Failed to fetch data: ${error.message}`);
//         if (!data || data.length === 0)
//           throw new Error("No data found for the selected criteria");

//         const typedData = data as Row<T>[];
//         toast.success(
//           `Fetched ${typedData.length} records. Generating Excel file...`
//         );

//         // Excel generation logic with enhanced features
//         const workbook = new ExcelJS.Workbook();
//         const worksheet = workbook.addWorksheet(sheetName || "Data");

//         worksheet.columns = exportColumns.map((col) => ({
//           key: String(col.dataIndex),
//           width: typeof col.width === "number" ? col.width / 8 : 20,
//         }));

//         const headerTitles = exportColumns.map((col) => col.title);
//         const headerRow = worksheet.addRow(headerTitles);
//         headerRow.height = wrapText ? 30 : 25; // Increase height for wrapped text

//         exportColumns.forEach((col, index) => {
//           const cell = headerRow.getCell(index + 1);
//           if (styles.headerFont) cell.font = styles.headerFont;
//           if (styles.headerFill) cell.fill = styles.headerFill;
          
//           // Enhanced header alignment with text wrapping
//           cell.alignment = { 
//             horizontal: "center", 
//             vertical: "middle",
//             wrapText: wrapText || false
//           };

//           if (styles.borderStyle) {
//             cell.border = {
//               top: styles.borderStyle.top,
//               bottom: styles.borderStyle.bottom,
//               right: styles.borderStyle.right,
//               left: index === 0 ? styles.borderStyle.left : undefined,
//             };
//           }
//         });

//         // Add data rows with enhanced styling
//         typedData.forEach((record, rowIndex) => {
//           const rowData: Record<string, unknown> = {};
//           exportColumns.forEach((col) => {
//             const key = col.dataIndex as keyof Row<T> & string;
//             rowData[key] = formatCellValue(record[key], col);
//           });
//           const excelRow = worksheet.addRow(rowData);
          
//           // Set row height for wrapped text
//           if (wrapText) {
//             excelRow.height = 20; // Minimum height, will auto-expand
//           }

//           exportColumns.forEach((col, colIndex) => {
//             const cell = excelRow.getCell(colIndex + 1);

//             if (styles.dataFont) cell.font = styles.dataFont;

//             if (rowIndex % 2 === 1 && styles.alternateRowFill) {
//               cell.fill = styles.alternateRowFill;
//             }

//             // Apply text wrapping and alignment
//             cell.alignment = {
//               ...cell.alignment,
//               wrapText: wrapText || false,
//               vertical: 'top' // Better for wrapped text
//             };

//             applyCellFormatting(cell, col);

//             if (styles.borderStyle) {
//               const isLastDataRow = rowIndex === typedData.length - 1;
//               cell.border = {
//                 right: styles.borderStyle.right,
//                 left: colIndex === 0 ? styles.borderStyle.left : undefined,
//                 top: styles.borderStyle.top,
//                 bottom: isLastDataRow ? styles.borderStyle.bottom : undefined,
//               };
//             }
//           });
//         });

//         // Auto-fit columns if enabled
//         if (autoFitColumns) {
//           exportColumns.forEach((col, index) => {
//             const column = worksheet.getColumn(index + 1);
//             let maxLength = col.title.length;
            
//             // Calculate max content length for auto-fitting
//             typedData.forEach((record) => {
//               const key = col.dataIndex as keyof Row<T> & string;
//               const value = record[key];
//               const cellText = String(formatCellValue(value, col) || '');
              
//               // For wrapped text, consider line breaks
//               if (wrapText) {
//                 const lines = cellText.split('\n');
//                 const maxLineLength = Math.max(...lines.map(line => line.length));
//                 maxLength = Math.max(maxLength, maxLineLength);
//               } else {
//                 maxLength = Math.max(maxLength, cellText.length);
//               }
//             });
            
//             // Set reasonable bounds for column width
//             const calculatedWidth = Math.min(Math.max(maxLength + 2, 10), wrapText ? 30 : 50);
//             column.width = calculatedWidth;
//           });
//         }

//         // Freeze header row
//         worksheet.views = [{ state: "frozen", ySplit: 1 }];

//         // Generate and download file
//         const buffer = await workbook.xlsx.writeBuffer();
//         const sanitizedFileName = sanitizeFileName(fileName);
//         const blob = new Blob([buffer], {
//           type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
//         });

//         const link = document.createElement("a");
//         link.href = URL.createObjectURL(blob);
//         link.download = sanitizedFileName;
//         document.body.appendChild(link);
//         link.click();
//         document.body.removeChild(link);
//         URL.revokeObjectURL(link.href);

//         toast.success(
//           `Excel file "${sanitizedFileName}" downloaded successfully!`
//         );
//         return {
//           fileName: sanitizedFileName,
//           rowCount: dataArray.length,
//           columnCount: exportColumns.length,
//         };
//       } catch (error) {
//         const errorMessage =
//           error instanceof Error ? error.message : "Unknown error occurred";
//         if (showToasts) {
//           toast.error(`Download failed: ${errorMessage}`);
//         }
//         throw error;
//       }
//     },
//     ...mutationOptions,
//   });
// }

// Hook for traditional table/view downloads with enhanced features
export function useTableExcelDownload<T extends AuthTableOrViewName>(
  supabase: SupabaseClient<Database>,
  tableName: T,
  options?: EnhancedUseExcelDownloadOptions<T>
) {
  const {
    showToasts = true,
    batchSize = 50000,
    defaultOrderBy,
    defaultWrapText = true,
    defaultAutoFitColumns = true,
    ...mutationOptions
  } = options || {};

  return useMutation<
    ExcelDownloadResult,
    Error,
    Omit<EnhancedDownloadOptions<T>, "rpcConfig">
  >({
    mutationFn: async (downloadOptions): Promise<ExcelDownloadResult> => {
      try {
        const defaultStyles = getDefaultStyles();
        const mergedOptions = {
          sheetName: "Data",
          maxRows: batchSize,
          customStyles: defaultStyles,
          orderBy: defaultOrderBy,
          wrapText: defaultWrapText,
          autoFitColumns: defaultAutoFitColumns,
          ...downloadOptions,
        };

        const {
          fileName = `${String(tableName)}-${
            new Date().toISOString().split("T")[0]
          }.xlsx`,
          filters,
          columns,
          sheetName,
          maxRows,
          orderBy,
          wrapText,
          autoFitColumns,
        } = mergedOptions;

        const styles = { ...defaultStyles, ...mergedOptions.customStyles };

        if (!columns || columns.length === 0)
          throw new Error("No columns specified for export");
        const exportColumns = columns.filter((col) => !col.excludeFromExport);
        if (exportColumns.length === 0)
          throw new Error("All columns are excluded from export");

        toast.info("Fetching data for download...");

        const selectFields = exportColumns
          .map((col) => col.dataIndex)
          .join(",");
        let query = isTableName(tableName)
          ? supabase.from(tableName as TableName).select(selectFields)
          : supabase.from(tableName as ViewName).select(selectFields);

        if (filters) query = applyFilters(query, filters);
        
        // Apply ordering to the Supabase query
        if (orderBy && orderBy.length > 0) {
          orderBy.forEach(order => {
            query = query.order(order.column, { ascending: order.ascending !== false });
          });
        }
        
        if (maxRows) query = query.limit(maxRows);

        const { data, error } = await query;

        if (error) throw new Error(`Failed to fetch data: ${error.message}`);
        if (!data || data.length === 0)
          throw new Error("No data found for the selected criteria");

        const typedData = data as Row<T>[];
        toast.success(
          `Fetched ${typedData.length} records. Generating Excel file...`
        );

        // Excel generation logic with enhanced features
        const workbook = new ExcelJS.Workbook();
        const worksheet = workbook.addWorksheet(sheetName || "Data");

        worksheet.columns = exportColumns.map((col) => ({
          key: String(col.dataIndex),
          width: typeof col.width === "number" ? col.width / 8 : 20,
        }));

        const headerTitles = exportColumns.map((col) => col.title);
        const headerRow = worksheet.addRow(headerTitles);
        headerRow.height = wrapText ? 30 : 25; // Increase height for wrapped text

        exportColumns.forEach((col, index) => {
          const cell = headerRow.getCell(index + 1);
          if (styles.headerFont) cell.font = styles.headerFont;
          if (styles.headerFill) cell.fill = styles.headerFill;
          
          // Enhanced header alignment with text wrapping
          cell.alignment = { 
            horizontal: "center", 
            vertical: "middle",
            wrapText: wrapText || false
          };

          if (styles.borderStyle) {
            cell.border = {
              top: styles.borderStyle.top,
              bottom: styles.borderStyle.bottom,
              right: styles.borderStyle.right,
              left: index === 0 ? styles.borderStyle.left : undefined,
            };
          }
        });

        // Add data rows with enhanced styling
        typedData.forEach((record, rowIndex) => {
          const rowData: Record<string, unknown> = {};
          exportColumns.forEach((col) => {
            const key = col.dataIndex as keyof Row<T> & string;
            rowData[key] = formatCellValue(record[key], col);
          });
          const excelRow = worksheet.addRow(rowData);
          
          // Set row height for wrapped text
          if (wrapText) {
            excelRow.height = 20; // Minimum height, will auto-expand
          }

          exportColumns.forEach((col, colIndex) => {
            const cell = excelRow.getCell(colIndex + 1);

            if (styles.dataFont) cell.font = styles.dataFont;

            if (rowIndex % 2 === 1 && styles.alternateRowFill) {
              cell.fill = styles.alternateRowFill;
            }

            // Apply text wrapping and alignment
            cell.alignment = {
              ...cell.alignment,
              wrapText: wrapText || false,
              vertical: 'top' // Better for wrapped text
            };

            applyCellFormatting(cell, col);

            if (styles.borderStyle) {
              const isLastDataRow = rowIndex === typedData.length - 1;
              cell.border = {
                right: styles.borderStyle.right,
                left: colIndex === 0 ? styles.borderStyle.left : undefined,
                top: styles.borderStyle.top,
                bottom: isLastDataRow ? styles.borderStyle.bottom : undefined,
              };
            }
          });
        });

        // Auto-fit columns if enabled
        if (autoFitColumns) {
          exportColumns.forEach((col, index) => {
            const column = worksheet.getColumn(index + 1);
            let maxLength = col.title.length;
            
            // Calculate max content length for auto-fitting
            typedData.forEach((record) => {
              const key = col.dataIndex as keyof Row<T> & string;
              const value = record[key];
              const cellText = String(formatCellValue(value, col) || '');
              
              // For wrapped text, consider line breaks
              if (wrapText) {
                const lines = cellText.split('\n');
                const maxLineLength = Math.max(...lines.map(line => line.length));
                maxLength = Math.max(maxLength, maxLineLength);
              } else {
                maxLength = Math.max(maxLength, cellText.length);
              }
            });
            
            // Set reasonable bounds for column width
            const calculatedWidth = Math.min(Math.max(maxLength + 2, 10), wrapText ? 30 : 50);
            column.width = calculatedWidth;
          });
        }

        worksheet.views = [{ state: "frozen", ySplit: 1 }];

        const buffer = await workbook.xlsx.writeBuffer();
        const sanitizedFileName = sanitizeFileName(fileName);
        const blob = new Blob([buffer], {
          type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
        });

        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = sanitizedFileName;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(link.href);

        toast.success(
          `Excel file "${sanitizedFileName}" downloaded successfully!`
        );
        return {
          fileName: sanitizedFileName,
          rowCount: typedData.length,
          columnCount: exportColumns.length,
        };
      } catch (error) {
        const errorMessage =
          error instanceof Error ? error.message : "Unknown error occurred";
        if (
          showToasts &&
          errorMessage !== "No data found for the selected criteria"
        ) {
          toast.error(`Download failed: ${errorMessage}`);
        }
        throw error;
      }
    },
    ...mutationOptions,
  });
}
//   // Basic usage with ordering
// const mutation = useTableExcelDownload(supabase, 'users', {
//   defaultOrderBy: [
//     { column: 'created_at', ascending: false },
//     { column: 'name', ascending: true }
//   ]
// });

// // Download with custom options
// mutation.mutate({
//   columns: userColumns,
//   orderBy: [{ column: 'email', ascending: true }],
//   wrapText: true,
//   autoFitColumns: false,
//   fileName: 'user-report.xlsx'
// });

// // RPC download with ordering
// const rpcMutation = useRPCExcelDownload(supabase, {
//   defaultWrapText: false,
//   defaultOrderBy: [{ column: 'priority', ascending: false }]
// });
```

<!-- path: hnvtx/hooks/database/excel-queries/excel-upload.ts -->
```typescript
import * as XLSX from "xlsx";
import { TableInsert, TableName, UploadOptions, UseExcelUploadOptions } from "../queries-type-helpers";
import { SupabaseClient } from "@supabase/supabase-js";
import { Database } from "@/types/supabase-types";
import { useMutation, useQueryClient } from "@tanstack/react-query";
import { EnhancedUploadResult, generateUUID, logColumnTransformation, logRowProcessing, ProcessingLog, validateValue, ValidationError } from "./excel-helpers";
import { toast } from "sonner";

//================================================================================
// UPLOAD FUNCTIONS
//================================================================================

/**
 * Reads a File object and returns its contents as a 2D array using xlsx.
 * @param file The File object to read.
 * @returns A Promise that resolves to a 2D array of the sheet data.
 */
const parseExcelFile = (file: File): Promise<unknown[][]> => {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
  
      reader.onload = (event: ProgressEvent<FileReader>) => {
        try {
          if (!event.target?.result) {
            throw new Error("File reading failed.");
          }
          const buffer = event.target.result as ArrayBuffer;
          const workbook = XLSX.read(buffer, { type: "array" });
          const worksheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[worksheetName];
          if (!worksheet) {
            throw new Error("No worksheet found in the file.");
          }
          // header: 1 tells sheet_to_json to return an array of arrays
          // defval: '' preserves empty cells so column indices stay aligned
          const data = XLSX.utils.sheet_to_json<unknown[]>(worksheet, {
            header: 1,
            defval: "",
          });
          resolve(data);
        } catch (error) {
          reject(error);
        }
      };
  
      reader.onerror = (error) => {
        reject(new Error(`FileReader error: ${error.type}`));
      };
  
      reader.readAsArrayBuffer(file);
    });
  };
  
  //================================================================================
  // MAIN ENHANCED UPLOAD HOOK
  //================================================================================
  
  /**
   * Enhanced React hook for uploading data from an Excel file to a Supabase table using 'xlsx'.
   * Includes comprehensive logging and error tracking.
   */
  export function useExcelUpload<T extends TableName>(
    supabase: SupabaseClient<Database>,
    tableName: T,
    options?: UseExcelUploadOptions<T>
  ) {
    const {
      showToasts = true,
      batchSize = 500,
      ...mutationOptions
    } = options || {};
    const queryClient = useQueryClient();
  
    return useMutation<EnhancedUploadResult, Error, UploadOptions<T>>({
      mutationFn: async (
        uploadOptions: UploadOptions<T>
      ): Promise<EnhancedUploadResult> => {
        const {
          file,
          columns,
          uploadType = "upsert",
          conflictColumn,
        } = uploadOptions;
  
        console.group("🚀 Excel Upload Process Started");
        console.log("📁 File:", file.name, `(${file.size} bytes)`);
        console.log("🎯 Table:", tableName);
        console.log("📋 Upload Type:", uploadType);
        console.log("🔑 Conflict Column:", conflictColumn);
        console.log("📊 Column Mappings:", columns);
  
        if (uploadType === "upsert" && !conflictColumn) {
          throw new Error(
            "A 'conflictColumn' must be specified for 'upsert' operations."
          );
        }
  
        const processingLogs: ProcessingLog[] = [];
        const allValidationErrors: ValidationError[] = [];
  
        toast.info("Reading and parsing Excel file...");
  
        // 1. Parse the Excel file using our xlsx utility function
        const jsonData = await parseExcelFile(file);
  
        console.log("📊 Raw Excel Data:", {
          totalRows: jsonData.length,
          headers: jsonData[0],
          sampleData: jsonData.slice(1, 4), // Show first 3 data rows
        });
  
        if (!jsonData || jsonData.length < 2) {
          toast.warning(
            "No data found in the Excel file. (A header row and at least one data row are required)."
          );
          console.groupEnd();
          return { 
            successCount: 0, 
            errorCount: 0, 
            totalRows: 0, 
            errors: [],
            processingLogs,
            validationErrors: allValidationErrors,
            skippedRows: 0,
          };
        }
  
        // 2. Map Excel headers to their column index for efficient lookup
        const excelHeaders: string[] = jsonData[0] as string[];
        const headerMap: Record<string, number> = {};
        console.log("📝 Excel Headers:", excelHeaders);
        
        excelHeaders.forEach((header, index) => {
          const cleanHeader = String(header).trim().toLowerCase();
          headerMap[cleanHeader] = index;
          console.log(`   [${index}]: "${header}" -> "${cleanHeader}"`);
        });
        
        const isFirstColumnId =
          String(excelHeaders?.[0] ?? "").toLowerCase() === "id";
        console.log("🆔 First column is ID:", isFirstColumnId);
  
        // 3. Validate that all required columns from the mapping exist in the file
        const getHeaderIndex = (name: string): number | undefined =>
          headerMap[String(name).trim().toLowerCase()];
  
        console.group("🔍 Column Mapping Validation");
        for (const mapping of columns) {
          const idx = getHeaderIndex(mapping.excelHeader);
          console.log(`📍 "${mapping.excelHeader}" -> "${mapping.dbKey}":`, 
            idx !== undefined ? `Column ${idx}` : "❌ NOT FOUND");
          
          // Allow missing 'id' header so we can auto-generate UUIDs during processing
          if (idx === undefined && mapping.dbKey !== "id") {
            console.error(`❌ Required column "${mapping.excelHeader}" not found in Excel file`);
            throw new Error(
              `Required column "${mapping.excelHeader}" not found in the Excel file.`
            );
          }
        }
        console.groupEnd();
  
        toast.info(
          `Found ${jsonData.length - 1} rows. Preparing data for upload...`
        );
  
        // 4. Process rows and transform data into the format for Supabase
        const dataRows = jsonData.slice(1);
  
        // Helper: determine if a row is effectively empty (ignoring 'id')
        const isRowEffectivelyEmpty = (row: unknown[]): boolean => {
          for (const mapping of columns) {
            if (mapping.dbKey === "id") continue; // ignore id when checking emptiness
            const idx = getHeaderIndex(mapping.excelHeader);
            const v = idx !== undefined ? row[idx] : undefined;
            if (v !== undefined && String(v).trim() !== "") {
              return false; // has some non-empty value in a non-id column
            }
          }
          return true;
        };
  
        // Filter out rows that are empty across all non-id columns, keep index for error reporting
        const filteredRows = dataRows
          .map((row, idx) => ({ row: row as unknown[], idx }))
          .filter(({ row }) => !isRowEffectivelyEmpty(row));
  
        console.log(`🎯 Filtered ${dataRows.length} rows down to ${filteredRows.length} non-empty rows`);
  
        // Initialize upload result early to record pre-insert validation errors
        const uploadResult: EnhancedUploadResult = {
          successCount: 0,
          errorCount: 0,
          totalRows: 0,
          errors: [],
          processingLogs,
          validationErrors: allValidationErrors,
          skippedRows: 0,
        };
  
        let recordsToProcess: TableInsert<T>[] = [];

        // Helpers capture the hook's generic T via closure over tableName
        const insertBatch = async (
          rows: TableInsert<T>[]
        ) => {
          // T is a generic (union of table names) here; Supabase's overloads require a concrete table literal.
          // A localized cast is used to bridge this at the single boundary to Supabase.
          // eslint-disable-next-line @typescript-eslint/no-explicit-any
          return supabase.from(tableName).insert(rows as any);
        };

        const upsertBatch = async (
          rows: TableInsert<T>[],
          onConflict: string
        ) => {
          // eslint-disable-next-line @typescript-eslint/no-explicit-any
          return supabase.from(tableName).upsert(rows as any, { onConflict });
        };

        const upsertOne = async (
          row: TableInsert<T>,
          onConflict: string
        ) => {
          // eslint-disable-next-line @typescript-eslint/no-explicit-any
          return supabase.from(tableName).upsert(row as any, { onConflict });
        };
  
        console.group("🔄 Row Processing Phase");
        
        for (let i = 0; i < filteredRows.length; i++) {
          const { row, idx } = filteredRows[i];
          const excelRowNumber = idx + 2; // +2 because Excel is 1-indexed and we skip header
          
          const originalData: Record<string, unknown> = {};
          const processedData: Record<string, unknown> = {};
          const rowValidationErrors: ValidationError[] = [];
          let isSkipped = false;
          let skipReason: string | undefined;
  
          // Build original data object for logging
          excelHeaders.forEach((header, headerIdx) => {
            originalData[header] = row[headerIdx];
          });
  
          // Secondary safeguard: determine if row has any meaningful non-id value
          const rowHasContent = columns.some((mapping) => {
            if (mapping.dbKey === "id") return false;
            const idx = getHeaderIndex(mapping.excelHeader);
            const v = idx !== undefined ? row[idx] : undefined;
            return v !== undefined && String(v).trim() !== "";
          });
  
          if (!rowHasContent) {
            // Skip rows that are effectively empty across non-id columns
            isSkipped = true;
            skipReason = "Row is empty across all non-id columns";
            uploadResult.skippedRows++;
            
            const log = logRowProcessing(
              i, 
              excelRowNumber, 
              originalData, 
              processedData, 
              rowValidationErrors, 
              isSkipped, 
              skipReason
            );
            processingLogs.push(log);
            continue;
          }
  
          // Process each column mapping
          for (const mapping of columns) {
            const colIndex = getHeaderIndex(mapping.excelHeader);
            // Guard: only index row when we have a valid column index
            let rawValue = colIndex !== undefined ? row[colIndex] : undefined;
  
            console.group(`🔧 Processing "${mapping.dbKey}" (Excel: "${mapping.excelHeader}")`);
            console.log(`📍 Column Index: ${colIndex}`);
            console.log(`📊 Raw Value:`, rawValue, `(${typeof rawValue})`);
  
            try {
              // Normalize empty strings to null for UUID-like fields
              if (
                (mapping.dbKey === "id" ||
                  mapping.dbKey.endsWith("_id") ||
                  mapping.dbKey === "parent_id") &&
                (rawValue === "" || rawValue === undefined)
              ) {
                rawValue = null;
                console.log("🔄 Normalized empty UUID field to null");
              }
  
              // Normalize IP address-like fields for inet columns: trim and empty -> null
              // Targets include: 'ip_address', any key ending with '_ip', or containing 'ipaddr'
              {
                const key = String(mapping.dbKey || "").toLowerCase();
                const isIPField =
                  key === "ip_address" ||
                  key.endsWith("_ip") ||
                  key.includes("ipaddr");
                if (isIPField && typeof rawValue === "string") {
                  const trimmed = rawValue.trim();
                  rawValue = trimmed === "" ? null : trimmed;
                  console.log("🌐 Processed IP field:", rawValue);
                }
              }
  
              // Only generate a UUID for `id` if the row actually has content
              if (mapping.dbKey === "id" && rowHasContent) {
                // If first Excel column is id/ID and current mapping is for 'id', auto-generate UUID when empty
                if (
                  isFirstColumnId &&
                  (rawValue === null ||
                    rawValue === undefined ||
                    String(rawValue).trim() === "")
                ) {
                  rawValue = generateUUID();
                  console.log("🆔 Generated UUID for empty ID:", rawValue);
                }
                // If 'id' header is entirely missing, still generate a UUID
                if (colIndex === undefined) {
                  rawValue = generateUUID();
                  console.log("🆔 Generated UUID for missing ID column:", rawValue);
                }
              }
  
              // Use the transform function if available, otherwise use the raw value
              let finalValue: unknown;
              if (mapping.transform) {
                try {
                  finalValue = mapping.transform(rawValue);
                  console.log("🔧 Transformed value:", finalValue, `(${typeof finalValue})`);
                } catch (transformError) {
                  const errorMsg = transformError instanceof Error 
                    ? transformError.message 
                    : "Transform function failed";
                  console.error("❌ Transform error:", errorMsg);
                  
                  const validationError: ValidationError = {
                    rowIndex: i,
                    column: mapping.dbKey,
                    value: rawValue,
                    error: `Transform failed for "${mapping.dbKey}": ${errorMsg}`,
                  };
                  rowValidationErrors.push(validationError);
                  allValidationErrors.push(validationError);
                  finalValue = rawValue; // Use raw value as fallback
                }
              } else {
                finalValue = rawValue;
              }
  
              // Validate the processed value
              const validationError = validateValue(
                finalValue, 
                mapping.dbKey, 
                mapping.required || false
              );
              
              if (validationError) {
                validationError.rowIndex = i;
                rowValidationErrors.push(validationError);
                allValidationErrors.push(validationError);
                console.error("❌ Validation failed:", validationError.error);
              }
  
              // Assign the processed value to the correct database key
              // Normalize empty strings to null to satisfy numeric/date/inet columns
              let assignValue =
                finalValue !== undefined
                  ? finalValue
                  : rawValue !== undefined
                  ? rawValue
                  : null;
              
              if (typeof assignValue === "string" && assignValue.trim() === "") {
                assignValue = null;
                console.log("🧹 Normalized empty string to null");
              }
              
              processedData[mapping.dbKey] = assignValue;
              console.log("✅ Final assigned value:", assignValue, `(${typeof assignValue})`);
  
              logColumnTransformation(
                i,
                mapping.dbKey,
                rawValue,
                assignValue
              );
  
            } catch (columnError) {
              const errorMsg = columnError instanceof Error 
                ? columnError.message 
                : "Unknown column processing error";
              console.error("💥 Column processing error:", errorMsg);
              
              const validationError: ValidationError = {
                rowIndex: i,
                column: mapping.dbKey,
                value: rawValue,
                error: `Column processing failed: ${errorMsg}`,
              };
              rowValidationErrors.push(validationError);
              allValidationErrors.push(validationError);
            } finally {
              console.groupEnd();
            }
          }
  
          // Check if row has validation errors
          const hasRequiredFieldErrors = rowValidationErrors.some(err => 
            err.error.includes("Required field") || err.error.includes("Missing required")
          );
  
          if (hasRequiredFieldErrors) {
            // Record a validation error for this row and skip it
            isSkipped = true;
            skipReason = `Validation failed: ${rowValidationErrors.map(e => e.error).join("; ")}`;
            uploadResult.errorCount += 1;
            uploadResult.skippedRows++;
            
            uploadResult.errors.push({
              rowIndex: excelRowNumber,
              data: processedData as Record<string, unknown>,
              error: skipReason,
            });
          } else {
            // Add to records to process
            recordsToProcess.push(processedData as TableInsert<T>);
          }
  
          // Log the complete row processing
          const log = logRowProcessing(
            i,
            excelRowNumber,
            originalData,
            processedData,
            rowValidationErrors,
            isSkipped,
            skipReason
          );
          processingLogs.push(log);
        }
        
        console.groupEnd(); // End Row Processing Phase
  
        console.log(`📊 Processing Summary:`);
        console.log(`   Total filtered rows: ${filteredRows.length}`);
        console.log(`   Records to process: ${recordsToProcess.length}`);
        console.log(`   Skipped rows: ${uploadResult.skippedRows}`);
        console.log(`   Validation errors: ${allValidationErrors.length}`);
  
        // Deduplicate by conflict columns to avoid Postgres error:
        // "ON CONFLICT DO UPDATE command cannot affect row a second time"
        if (uploadType === "upsert" && conflictColumn) {
          console.group("🔄 Deduplication Process");
          
          const conflictCols = String(conflictColumn)
            .split(",")
            .map((s) => s.trim())
            .filter((s) => s.length > 0);
  
          console.log("🎯 Conflict columns:", conflictCols);
  
          if (conflictCols.length > 0) {
            const seen = new Set<string>();
            const deduped: TableInsert<T>[] = [];
            let duplicateCount = 0;
            
            for (const rec of recordsToProcess) {
              const values = conflictCols.map((c) => (rec as Record<string, unknown>)[c]);
              const allPresent = values.every(
                (v) =>
                  v !== undefined &&
                  v !== null &&
                  !(typeof v === "string" && v === "")
              );
              
              if (!allPresent) {
                // Do not dedupe records missing conflict values; still avoid PK updates on composite keys
                if (!conflictCols.includes("id")) {
                  delete (rec as Record<string, unknown>).id;
                }
                deduped.push(rec);
                console.log("➕ Added record with missing conflict values (no deduplication)");
                continue;
              }
  
              // Normalize strings for dedupe to match DB uniqueness (trim + lowercase)
              const normalized = values.map((v) =>
                typeof v === "string" ? v.trim().toLowerCase() : v
              );
              const key = JSON.stringify(normalized);
              
              if (!seen.has(key)) {
                seen.add(key);
                if (!conflictCols.includes("id")) {
                  delete (rec as Record<string, unknown>).id;
                }
                deduped.push(rec);
                console.log(`➕ Added unique record with key: ${key}`);
              } else {
                duplicateCount++;
                console.log(`⏭️  Skipped duplicate record with key: ${key}`);
              }
            }
            
            console.log(`📊 Deduplication results:`);
            console.log(`   Original records: ${recordsToProcess.length}`);
            console.log(`   After deduplication: ${deduped.length}`);
            console.log(`   Duplicates removed: ${duplicateCount}`);
            
            recordsToProcess = deduped;
          }
          
          console.groupEnd();
        }
  
        // 5. Perform batch upload to Supabase
        uploadResult.totalRows = recordsToProcess.length;
        console.log(`🚀 Starting Supabase upload for ${uploadResult.totalRows} records`);
  
        if (recordsToProcess.length === 0) {
          console.log("⚠️ No records to upload after processing");
          toast.warning("No valid records found to upload after processing.");
          console.groupEnd();
          return uploadResult;
        }
  
        console.group("📤 Supabase Upload Process");
  
        for (let i = 0; i < recordsToProcess.length; i += batchSize) {
          const batch = recordsToProcess.slice(i, i + batchSize);
          const progress = Math.round(
            ((i + batch.length) / recordsToProcess.length) * 100
          );
          toast.info(`Uploading batch ${Math.floor(i / batchSize) + 1}... (${progress}%)`);
          
          console.log(`📦 Processing batch ${Math.floor(i / batchSize) + 1}:`);
          console.log(`   Range: ${i} - ${i + batch.length - 1}`);
          console.log(`   Batch size: ${batch.length}`);
          console.log(`   Progress: ${progress}%`);
          console.log("📊 Batch data sample:", batch.slice(0, 2)); // Show first 2 records
  
          // If using composite conflict keys, upsert rows one-by-one to avoid
          // "ON CONFLICT DO UPDATE command cannot affect row a second time"
          const isCompositeConflict =
            uploadType === "upsert" &&
            conflictColumn &&
            String(conflictColumn).split(",").length > 1;
            
          if (isCompositeConflict) {
            console.log("🔄 Using individual upserts for composite conflict keys");
            
            for (let j = 0; j < batch.length; j++) {
              const row = batch[j];
              console.log(`📝 Upserting individual record ${i + j + 1}:`, row);
              
              try {
                const { error } = await upsertOne(row as TableInsert<T>, conflictColumn as string);
                  
                if (error) {
                  console.error(`❌ Individual upsert failed for record ${i + j + 1}:`, error);
                  uploadResult.errorCount += 1;
                  uploadResult.errors.push({
                    rowIndex: i + j,
                    data: row as Record<string, unknown>,
                    error: error.message,
                  });
                  if (showToasts) {
                    toast.error(
                      `Error at record ${i + j + 1}: ${error.message}`
                    );
                  }
                } else {
                  console.log(`✅ Individual upsert successful for record ${i + j + 1}`);
                  uploadResult.successCount += 1;
                }
              } catch (unexpectedError) {
                const errorMsg = unexpectedError instanceof Error 
                  ? unexpectedError.message 
                  : "Unexpected error during individual upsert";
                console.error(`💥 Unexpected error during individual upsert:`, unexpectedError);
                uploadResult.errorCount += 1;
                uploadResult.errors.push({
                  rowIndex: i + j,
                  data: row as Record<string, unknown>,
                  error: errorMsg,
                });
              }
            }
            continue;
          }
  
          // Regular batch processing
          console.log(`🚀 Executing batch ${uploadType} operation`);
          
          try {
            let query;
            if (uploadType === "insert") {
              console.log("➕ Using INSERT operation");
              query = insertBatch(batch as TableInsert<T>[]);
            } else {
              console.log(`🔄 Using UPSERT operation with conflict: ${conflictColumn}`);
              query = upsertBatch(batch as TableInsert<T>[], conflictColumn as string);
            }
  
            const { error } = await query;
            
            if (error) {
              // Handle foreign key constraint violation specifically
              if (error.code === '23503' && error.message.includes('ofc_cables_sn_id_fkey')) {
                // Type-safe access to sn_id
                type RecordWithSnId = { sn_id?: unknown };
                const getSnId = (record: unknown): string | undefined => {
                  if (record && typeof record === 'object' && 'sn_id' in record) {
                    const value = (record as RecordWithSnId).sn_id;
                    return value !== null && value !== undefined ? String(value) : undefined;
                  }
                  return undefined;
                };
                
                // Extract all unique sn_ids from the batch that caused the error
                const invalidSnIds = [...new Set(
                  batch.map(record => getSnId(record)).filter((id): id is string => Boolean(id))
                )];
                
                // Log detailed error information
                console.error('Foreign key violation details:', {
                  table: tableName,
                  constraint: 'ofc_cables_sn_id_fkey',
                  invalidValues: invalidSnIds,
                  error: error.message
                });
                
                // Add validation errors for each affected row
                batch.forEach((record, index) => {
                  const snId = getSnId(record);
                  if (snId) {
                    uploadResult.validationErrors.push({
                      rowIndex: i + index,
                      column: 'sn_id',
                      value: snId,
                      error: `Foreign key violation: sn_id '${snId}' does not exist in the nodes table`,
                      data: { column: 'sn_id', value: snId, constraint: 'ofc_cables_sn_id_fkey' }
                    });
                  }
                });
                
                // Add a summary error to the upload result
                const errorMessage = `Foreign key violation: ${invalidSnIds.length} invalid sn_id value(s) found in batch. ` +
                  `Invalid values: ${invalidSnIds.join(', ')}`;
                uploadResult.errorCount += batch.length;
                uploadResult.errors.push({
                  rowIndex: i,
                  data: batch,
                  error: errorMessage
                });
                
                // Show user-friendly error message
                if (showToasts) {
                  toast.error(
                    `Foreign key violation: ${invalidSnIds.length} invalid sn_id value(s) found. ` +
                    'Check the console for details.',
                    { duration: 10000 }
                  );
                }
              } else {
                // Handle other types of errors
                const errorDetails: Record<string, unknown> = {};
                if (error.code === '23503') {
                  errorDetails.constraint = error.message.match(/constraint "(.*?)"/)?.[1];
                  errorDetails.detail = error.message;
                }
                
                uploadResult.errorCount += batch.length;
                uploadResult.errors.push({
                  rowIndex: i,
                  data: batch,
                  error: error.message,
                  ...(Object.keys(errorDetails).length > 0 ? { details: errorDetails } : {})
                });
                
                if (showToasts) {
                  toast.error(`Error in batch starting at record ${i + 1}: ${error.message}`);
                }
              }
            } else {
              console.log(`✅ Batch operation successful for ${batch.length} records`);
              uploadResult.successCount += batch.length;
            }
          } catch (unexpectedError) {
            const errorMsg = unexpectedError instanceof Error 
              ? unexpectedError.message 
              : "Unexpected error during batch operation";
            console.error(`💥 Unexpected error during batch operation:`, unexpectedError);
            uploadResult.errorCount += batch.length;
            uploadResult.errors.push({
              rowIndex: i,
              data: batch,
              error: errorMsg,
            });
          }
        }
        
        console.groupEnd(); // End Supabase Upload Process
  
        // 6. Finalize and report
        console.group("📊 Upload Results Summary");
        console.log(`✅ Successful uploads: ${uploadResult.successCount}`);
        console.log(`❌ Failed uploads: ${uploadResult.errorCount}`);
        console.log(`⏭️  Skipped rows: ${uploadResult.skippedRows}`);
        console.log(`📝 Total processing logs: ${processingLogs.length}`);
        console.log(`⚠️  Total validation errors: ${allValidationErrors.length}`);
        
        if (uploadResult.errors.length > 0) {
          console.log("🔍 Upload errors:", uploadResult.errors);
        }
        
        if (allValidationErrors.length > 0) {
          console.log("🔍 Validation errors:", allValidationErrors);
        }
        console.groupEnd();
  
        if (uploadResult.errorCount > 0) {
          if (showToasts) {
            toast.warning(
              `${uploadResult.successCount} rows uploaded successfully, but ${uploadResult.errorCount} failed. Check console for details.`
            );
          }
        } else {
          if (showToasts) {
            toast.success(
              `Successfully uploaded ${uploadResult.successCount} of ${uploadResult.totalRows} records.`
            );
          }
          
          // Invalidate related queries instead of reloading the page to preserve UI state
          try {
            await queryClient.invalidateQueries({
              predicate: (q) => {
                const key = q.queryKey as unknown[];
                if (!Array.isArray(key)) return false;
                // Match if any segment equals the tableName or contains it as a substring (to catch views/RPC keys like "v_ofc_cables_complete")
                return key.some((seg) => {
                  if (seg === tableName) return true;
                  if (typeof seg === "string" && seg.toLowerCase().includes(String(tableName).toLowerCase())) return true;
                  return false;
                });
              },
            });
            // Force refetch so UI reflects changes immediately even if staleTime is large
            await queryClient.refetchQueries({
              predicate: (q) => {
                const key = q.queryKey as unknown[];
                if (!Array.isArray(key)) return false;
                return key.some((seg) => {
                  if (seg === tableName) return true;
                  if (typeof seg === "string" && seg.toLowerCase().includes(String(tableName).toLowerCase())) return true;
                  return false;
                });
              },
              type: "active",
            });
            console.log("✅ Query cache invalidated successfully");
          } catch (err) {
            console.warn("⚠️ Failed to invalidate queries after upload", err);
          }
        }
  
        console.groupEnd(); // End Excel Upload Process
        return uploadResult;
      },
      ...mutationOptions,
    });
  }
```

<!-- path: hnvtx/hooks/database/cache-performance.ts -->
```typescript
import { useQueryClient, QueryClient } from "@tanstack/react-query";
import { Filters, RpcFunctionArgs, RpcFunctionName, RpcFunctionReturns, TableName, TableRow, UseTableQueryOptions } from "./queries-type-helpers";
import { SupabaseClient } from "@supabase/supabase-js";
import { Database } from "@/types/supabase-types";
import { applyFilters, applyOrdering, createQueryKey, createRpcQueryKey } from "./utility-functions";

// Performance monitoring hook
export function useQueryPerformance() {
  const queryClient = useQueryClient();

  const getQueryStats = () => {
    const cache = queryClient.getQueryCache();
    const queries = cache.getAll();

    return {
      totalQueries: queries.length,
      staleQueries: queries.filter((q) => q.isStale()).length,
      inactiveQueries: queries.filter((q) => q.getObserversCount() === 0).length,
      fetchingQueries: queries.filter((q) => q.state.status === "pending").length,
      cacheSizeBytes: JSON.stringify(cache).length,
    };
  };

  const clearStaleQueries = () => {
    queryClient.removeQueries({
      predicate: (query) => query.isStale() && query.state.status !== "pending",
    });
  };

  const prefetchCriticalData = async (supabase: SupabaseClient<Database>, criticalTables: TableName[]) => {
    const promises = criticalTables.map((tableName) =>
      queryClient.prefetchQuery({
        queryKey: ["table", tableName],
        queryFn: async () => {
          const { data, error } = await supabase.from(tableName).select("*").limit(100);
          if (error) throw error;
          return data;
        },
        staleTime: 10 * 60 * 1000, // 10 minutes
      })
    );

    await Promise.all(promises);
  };

  return {
    getQueryStats,
    clearStaleQueries,
    prefetchCriticalData,
  };
}

// Specialized hooks for RPC functions (keeping existing ones)
// This type is generated automatically by the Supabase CLI!
// Define the return type with more precision
// Use `Array<T>` syntax for clarity and add `| null` to handle initial/error states.

// Enhanced cache utilities with performance optimizations
export const tableQueryUtils = {
  invalidateTable: (queryClient: QueryClient, tableName: string) => {
    queryClient.invalidateQueries({ queryKey: ["table", tableName] });
    queryClient.invalidateQueries({ queryKey: ["unique", tableName] });
  },

  invalidateAllTables: (queryClient: QueryClient) => {
    queryClient.invalidateQueries({ queryKey: ["table"] });
    queryClient.invalidateQueries({ queryKey: ["unique"] });
  },

  invalidateRpc: (queryClient: QueryClient, functionName: string) => {
    queryClient.invalidateQueries({ queryKey: ["rpc", functionName] });
  },

  invalidateAllRpc: (queryClient: QueryClient) => {
    queryClient.invalidateQueries({ queryKey: ["rpc"] });
  },

  prefetchTable: async <T extends TableName>(queryClient: QueryClient, supabase: SupabaseClient<Database>, tableName: T, options?: UseTableQueryOptions<T>) => {
    return queryClient.prefetchQuery({
      queryKey: createQueryKey(tableName, options?.filters, options?.columns, options?.orderBy, options?.deduplication, options?.aggregation, options?.limit, options?.offset),
      queryFn: async (): Promise<TableRow<T>[]> => {
        let query = supabase.from(tableName).select(options?.columns || "*");

        if (options?.filters) {
          query = applyFilters(query, options.filters);
        }

        if (options?.orderBy) {
          query = applyOrdering(query, options.orderBy);
        }

        if (options?.limit) {
          query = query.limit(options.limit);
        }

        const { data, error } = await query;
        if (error) throw error;
        return (data as TableRow<T>[]) || [];
      },
      staleTime: 5 * 60 * 1000,
    });
  },

  prefetchRpc: async <T extends RpcFunctionName>(queryClient: QueryClient, supabase: SupabaseClient<Database>, functionName: T, args?: RpcFunctionArgs<T>) => {
    return queryClient.prefetchQuery({
      queryKey: createRpcQueryKey(functionName, args),
      queryFn: async (): Promise<RpcFunctionReturns<T>> => {
        const { data, error } = await supabase.rpc(functionName, args || ({} as RpcFunctionArgs<T>));
        if (error) throw error;
        return data as RpcFunctionReturns<T>;
      },
      staleTime: 3 * 60 * 1000,
    });
  },

  // Optimized cache management
  setQueryData: <T extends TableName>(queryClient: QueryClient, tableName: T, data: TableRow<T>[], filters?: Filters, columns?: string) => {
    queryClient.setQueryData(createQueryKey(tableName, filters, columns), data);
  },

  getQueryData: <T extends TableName>(queryClient: QueryClient, tableName: T, filters?: Filters, columns?: string): TableRow<T>[] | undefined => {
    return queryClient.getQueryData(createQueryKey(tableName, filters, columns));
  },

  // Performance monitoring
  getTableCacheStats: (queryClient: QueryClient, tableName: string) => {
    const cache = queryClient.getQueryCache();
    const tableQueries = cache.findAll({
      queryKey: ["table", tableName],
    });

    return {
      queryCount: tableQueries.length,
      staleCount: tableQueries.filter((q) => q.isStale()).length,
      fetchingCount: tableQueries.filter((q) => q.state.status === "pending").length,
      errorCount: tableQueries.filter((q) => q.state.status === "error").length,
      totalDataSize: tableQueries.reduce((acc, query) => {
        const data = query.state.data;
        return acc + (data ? JSON.stringify(data).length : 0);
      }, 0),
    };
  },

  // Cleanup utilities
  removeStaleQueries: (
    queryClient: QueryClient,
    maxAge = 10 * 60 * 1000 // 10 minutes
  ) => {
    queryClient.removeQueries({
      predicate: (query) => {
        const isOld = Date.now() - query.state.dataUpdatedAt > maxAge;
        return isOld && query.isStale() && query.state.status !== "pending";
      },
    });
  },

  // Batch operations
  batchInvalidate: (queryClient: QueryClient, operations: Array<{ type: "table" | "rpc"; name: string }>) => {
    operations.forEach(({ type, name }) => {
      queryClient.invalidateQueries({ queryKey: [type, name] });
    });
  },
};

```

<!-- path: hnvtx/hooks/database/queries-type-helpers.ts -->
```typescript
// hooks/database/queries-type-helpers.ts

import { UseQueryOptions, UseMutationOptions, UseInfiniteQueryOptions, InfiniteData } from "@tanstack/react-query";
import { Database, Tables, TablesInsert, TablesUpdate, Json } from "@/types/supabase-types";

// --- TYPE HELPERS ---

// The type to include Date as a possible type
export type TableInsertWithDates<T extends TableName> = {
  [K in keyof TablesInsert<T>]?: TablesInsert<T>[K] | Date | null;
};

export type TableUpdateWithDates<T extends TableName> = {
  [K in keyof TablesUpdate<T>]?: TablesUpdate<T>[K] | Date | null;
};

// A table is a source that can be read from and written to.
export type TableName = keyof Database["public"]["Tables"];

// Auth tables are tables that can only be read from.
export type AuthTable = keyof Database["auth"]["Tables"];

// A view is a source that can only be read from.
export type ViewName = keyof Database["public"]["Views"];

// A generic type for any readable source (table or view).
export type TableOrViewName = TableName | ViewName;

// A generic type for any readable source (table or view).
export type AuthTableOrViewName = AuthTable | ViewName | TableName;

// Helper function to check if the table name is a table (not a view)
export const isTableName = (name: AuthTableOrViewName): name is TableName => {
  // List of view names - add your view names here
  const viewNames = [
    'v_nodes_complete',
    'v_ofc_cables_complete',
    'v_ofc_connections_complete',
    'v_system_connections_complete',
    'v_systems_complete',
    // 'vmux_connections',
    // 'vmux_systems',
    // Add other view names here
  ];
  const authViewNames = [
    'users',
  ];
  return !viewNames.includes(name as string) && !authViewNames.includes(name as string);
};

// Table-specific types for mutation operations (insert, update, delete).
export type TableRow<T extends TableName> = Tables<T>;
export type TableInsert<T extends TableName> = TablesInsert<T>;
export type TableUpdate<T extends TableName> = TablesUpdate<T>;

// A generic row type for any read operation (works with both tables and views).
export type Row<T extends AuthTableOrViewName> = T extends TableName ? Tables<T> : T extends ViewName ? Database["public"]["Views"][T]["Row"] : T extends AuthTable ? Database["auth"]["Tables"][T]["Row"] : never;

// RPC function type helpers.
export type RpcFunctionName = keyof Database["public"]["Functions"];
export type RpcFunctionArgs<T extends RpcFunctionName> = Database["public"]["Functions"][T]["Args"];
export type RpcFunctionReturns<T extends RpcFunctionName> = Database["public"]["Functions"][T]["Returns"];

// --- ADVANCED TYPES FOR HOOK OPTIONS ---

export type FilterOperator = "eq" | "neq" | "gt" | "gte" | "lt" | "lte" | "like" | "ilike" | "in" | "contains" | "containedBy" | "overlaps" | "sl" | "sr" | "nxl" | "nxr" | "adj" | "is" | "isdistinct" | "fts" | "plfts" | "phfts" | "wfts" | "or";

export type FilterValue = string | number | boolean | null | string[] | number[] | { operator: FilterOperator; value: unknown };

export type Filters = Record<string, FilterValue>;

export type OrderBy = {
  column: string;
  ascending?: boolean;
  nullsFirst?: boolean;
  foreignTable?: string;
};

export type DeduplicationOptions = {
  columns: string[];
  orderBy?: OrderBy[];
};

export type AggregationOptions = {
  count?: boolean | string;
  sum?: string[];
  avg?: string[];
  min?: string[];
  max?: string[];
  groupBy?: string[];
};

export type PerformanceOptions = {
  useIndex?: string;
  explain?: boolean;
  timeout?: number;
  connection?: "read" | "write";
};

// The shape of data returned by queries, potentially with a total count.
export type RowWithCount<T> = T & { total_count?: number };

// --- HOOK OPTIONS INTERFACES ---

// Options for querying multiple records from tables OR views.
export interface UseTableQueryOptions<T extends TableOrViewName, TData = RowWithCount<Row<T>>[]> extends Omit<UseQueryOptions<RowWithCount<Row<T>>[], Error, TData>, "queryKey" | "queryFn"> {
  columns?: string;
  filters?: Filters;
  orderBy?: OrderBy[];
  limit?: number;
  offset?: number;
  deduplication?: DeduplicationOptions;
  aggregation?: AggregationOptions;
  performance?: PerformanceOptions;
  includeCount?: boolean;
}

// Options for infinite scrolling over tables OR views.
export type InfiniteQueryPage<T extends TableOrViewName> = {
  data: Row<T>[];
  nextCursor?: number;
  count?: number;
};

export interface UseTableInfiniteQueryOptions<T extends TableOrViewName, TData = InfiniteData<InfiniteQueryPage<T>>>
  extends Omit<UseInfiniteQueryOptions<InfiniteQueryPage<T>, Error, TData, readonly unknown[], number | undefined>, "queryKey" | "queryFn" | "getNextPageParam" | "initialPageParam"> {
  columns?: string;
  filters?: Filters;
  orderBy?: OrderBy[];
  pageSize?: number;
  performance?: PerformanceOptions;
}

// Options for querying a single record from a table OR view.
export interface UseTableRecordOptions<T extends TableOrViewName, TData = Row<T> | null> extends Omit<UseQueryOptions<Row<T> | null, Error, TData>, "queryKey" | "queryFn"> {
  columns?: string;
  performance?: PerformanceOptions;
}

// Options for getting unique values from a table OR view.
export interface UseUniqueValuesOptions<T extends TableOrViewName, TData = unknown[]> extends Omit<UseQueryOptions<unknown[], Error, TData>, "queryKey" | "queryFn"> {
  tableName: T;
  filters?: Filters;
  orderBy?: OrderBy[];
  limit?: number;
  performance?: PerformanceOptions;
}

export interface UseRpcQueryOptions<T extends RpcFunctionName, TData = RpcFunctionReturns<T>> extends Omit<UseQueryOptions<RpcFunctionReturns<T>, Error, TData>, "queryKey" | "queryFn"> {
  performance?: PerformanceOptions;
}

// Options for mutations, which apply ONLY to tables.
export interface UseTableMutationOptions<TData = unknown, TVariables = unknown, TContext = unknown> extends Omit<UseMutationOptions<TData, Error, TVariables, TContext>, "mutationFn"> {
  invalidateQueries?: boolean;
  optimisticUpdate?: boolean;
  batchSize?: number;
}

export interface OptimisticContext {
  previousData?: [readonly unknown[], unknown][];
}

export type PagedSystemsCompleteResult = Array<Database["public"]["Functions"]["get_paged_v_systems_complete"]["Returns"][number]> | null;

export type UsePagedSystemsCompleteOptions = {
  limit?: number;
  offset?: number;
  orderBy?: string;
  orderDir?: "asc" | "desc";
  filters?: Json;
  queryOptions?: Omit<UseQueryOptions<PagedSystemsCompleteResult>, "queryKey" | "queryFn">;
};

// --- TYPES FOR EXCEL UPLOAD HOOK ---

/**
 * Defines how to map a column from the Excel file to a database column.
 * @template T - The name of the table to upload to.
 */
export interface UploadColumnMapping<T extends TableName> {
  /** The exact header name in the Excel file (e.g., "Product Name"). */
  excelHeader: string;
  /** The corresponding key in the database table (e.g., "product_name"). */
  dbKey: keyof TableInsert<T> & string;
  /** An optional function to transform the cell's value before uploading. */
  transform?: (value: unknown) => unknown;
  /** If true, the value must be non-empty after transform; otherwise the row is rejected. */
  required?: boolean;
}

/**
 * Specifies the type of upload operation to perform.
 * - 'insert': Adds all rows as new records. Fails if a record violates a unique constraint.
 * - 'upsert': Inserts new records or updates existing ones based on a conflict column.
 */
export type UploadType = "insert" | "upsert";

/**
 * Options required to initiate an Excel file upload.
 * @template T - The name of the table to upload to.
 */
export interface UploadOptions<T extends TableName> {
  /** The file object from a file input element. */
  file: File;
  /** An array defining how to map Excel columns to database columns. */
  columns: UploadColumnMapping<T>[];
  /** The type of database operation to perform. Defaults to 'upsert'. */
  uploadType?: UploadType;
  /**
   * The database column to use for conflict resolution in an 'upsert' operation.
   * This is REQUIRED for 'upsert'.
   * e.g., 'id' or 'sku' if you want to update rows with matching IDs or SKUs.
   */
  conflictColumn?: keyof TableInsert<T> & string;
}

/**
 * The result of a successful upload operation.
 */
export interface UploadResult {
  successCount: number;
  errorCount: number;
  totalRows: number;
  errors: { rowIndex: number; data: unknown; error: string }[];
}

/**
 * Configuration options for the useExcelUpload hook itself.
 * @template T - The name of the table to upload to.
 */
export interface UseExcelUploadOptions<T extends TableName> {
  onSuccess?: (data: UploadResult, variables: UploadOptions<T>) => void;
  onError?: (error: Error, variables: UploadOptions<T>) => void;
  showToasts?: boolean;
  batchSize?: number;
}

// FIX: Add the return type for the new RPC function
export type PagedOfcCablesCompleteResult = 
  Array<Database["public"]["Functions"]["get_paged_ofc_cables_complete"]["Returns"][number]> | null;

// FIX: Add the options type for the new hook we will create
// export type UsePagedOfcCablesCompleteOptions = {
//   limit?: number;
//   offset?: number;
//   orderBy?: string;
//   orderDir?: "asc" | "desc";
//   filters?: Json;
//   queryOptions?: Omit<UseQueryOptions<PagedOfcCablesCompleteResult, Error>, "queryKey" | "queryFn">;
// };

export type PagedNodesCompleteResult = Array<Database["public"]["Functions"]["get_paged_nodes_complete"]["Returns"][number]> | null;

// export type UsePagedNodesCompleteOptions = {
//   limit?: number;
//   offset?: number;
//   orderBy?: string;
//   orderDir?: "asc" | "desc";
//   filters?: Json;
//   queryOptions?: Omit<UseQueryOptions<PagedNodesCompleteResult, Error>, "queryKey" | "queryFn">;
// };

export type PagedOfcConnectionsCompleteResult = 
  Array<Database["public"]["Functions"]["get_paged_ofc_connections_complete"]["Returns"][number]> | null;

// FIX: Add the options type for the new hook we will create
// export type UsePagedOfcConnectionsCompleteOptions = {
//   limit?: number;
//   offset?: number;
//   orderBy?: string;
//   orderDir?: "asc" | "desc";
//   filters?: Json;
//   queryOptions?: Omit<UseQueryOptions<PagedOfcConnectionsCompleteResult, Error>, "queryKey" | "queryFn">;
// };

export type PagedSystemConnectionsCompleteResult = Array<Database["public"]["Functions"]["get_paged_system_connections_complete"]["Returns"][number]> | null;

// export type UsePagedSystemConnectionsCompleteOptions = {
//   limit?: number;
//   offset?: number;
//   orderBy?: string;
//   orderDir?: "asc" | "desc";
//   filters?: Json;
//   queryOptions?: Omit<UseQueryOptions<PagedSystemConnectionsCompleteResult>, "queryKey" | "queryFn">;
// };

export type PagedLookupTypesWithCountResult = Array<Database["public"]["Functions"]["get_paged_lookup_types_with_count"]["Returns"][number]> | null;

// export type UsePagedLookupTypesWithCountOptions = {
//   limit?: number;
//   offset?: number;
//   orderBy?: string;
//   orderDir?: "asc" | "desc";
//   filters?: Json;
//   queryOptions?: Omit<UseQueryOptions<PagedLookupTypesWithCountResult, Error>, "queryKey" | "queryFn">;
// };

export type PagedMaintenanceAreasWithCountResult = Array<Database["public"]["Functions"]["get_paged_maintenance_areas_with_count"]["Returns"][number]> | null;

// export type UsePagedMaintenanceAreasWithCountOptions = {
//   limit?: number;
//   offset?: number;
//   orderBy?: string;
//   orderDir?: "asc" | "desc";
//   filters?: Json;
//   queryOptions?: Omit<UseQueryOptions<PagedMaintenanceAreasWithCountResult, Error>, "queryKey" | "queryFn">;
// };

export type PagedEmployeeDesignationsWithCountResult = Array<Database["public"]["Functions"]["get_paged_employee_designations_with_count"]["Returns"][number]> | null;

// export type UsePagedEmployeeDesignationsWithCountOptions = {
//   limit?: number;
//   offset?: number;
//   orderBy?: string;
//   orderDir?: "asc" | "desc";
//   filters?: Json;
//   queryOptions?: Omit<UseQueryOptions<PagedEmployeeDesignationsWithCountResult, Error>, "queryKey" | "queryFn">;
// };

export type PagedEmployeesWithCountResult = Array<Database["public"]["Functions"]["get_paged_employees_with_count"]["Returns"][number]> | null;

// export type UsePagedEmployeesWithCountOptions = {
//   limit?: number;
//   offset?: number;
//   orderBy?: string;
//   orderDir?: "asc" | "desc";
//   filters?: Json;
//   queryOptions?: Omit<UseQueryOptions<PagedEmployeesWithCountResult, Error>, "queryKey" | "queryFn">;
// };

export type PagedRingsWithCountResult = Array<Database["public"]["Functions"]["get_paged_rings_with_count"]["Returns"][number]> | null;

// export type UsePagedRingsWithCountOptions = {
//   limit?: number;
//   offset?: number;
//   orderBy?: string;
//   orderDir?: "asc" | "desc";
//   filters?: Json;
//   queryOptions?: Omit<UseQueryOptions<PagedRingsWithCountResult, Error>, "queryKey" | "queryFn">;
// };

// Define a type for the function's return data for full type safety
export type DashboardOverviewData = {
  system_status_counts: { [key: string]: number };
  node_status_counts: { [key: string]: number };
  path_operational_status: { [key: string]: number };
  cable_utilization_summary: {
    average_utilization_percent: number;
    high_utilization_count: number;
    total_cables: number;
  };
  user_activity_last_30_days: {
    date: string;
    count: number;
  }[];
  systems_per_maintenance_area: { [key: string]: number };
};
```

<!-- path: hnvtx/hooks/database/rpc-queries.ts -->
```typescript
import {
  useQuery,
  useMutation,
  useQueryClient,
  UseQueryResult,
} from '@tanstack/react-query';
import { SupabaseClient } from '@supabase/supabase-js';
import { Database } from '@/types/supabase-types';
import {
  RpcFunctionName,
  RpcFunctionArgs,
  RpcFunctionReturns,
  UseRpcQueryOptions,
  UseTableMutationOptions,
  PagedSystemsCompleteResult,
  PagedNodesCompleteResult,
  PagedOfcConnectionsCompleteResult,
  PagedSystemConnectionsCompleteResult,
  PagedLookupTypesWithCountResult,
  PagedMaintenanceAreasWithCountResult,
  PagedEmployeeDesignationsWithCountResult,
  PagedEmployeesWithCountResult,
  PagedRingsWithCountResult,
} from './queries-type-helpers';
import { createRpcQueryKey } from './utility-functions';
import {
  PagedOfcCablesCompleteResult,
} from '@/hooks/database/queries-type-helpers';
import { createPagedRpcHook } from '@/hooks/database/rpc-hook-factory';

// RPC query hook with performance enhancements
export function useRpcQuery<
  T extends RpcFunctionName,
  TData = RpcFunctionReturns<T>
>(
  supabase: SupabaseClient<Database>,
  functionName: T,
  args?: RpcFunctionArgs<T>,
  options?: UseRpcQueryOptions<T, TData>
) {
  const { performance, ...queryOptions } = options || {};

  return useQuery({
    queryKey: createRpcQueryKey(functionName, args, performance),
    queryFn: async (): Promise<RpcFunctionReturns<T>> => {
      const { data, error } = await supabase.rpc(
        functionName,
        args || ({} as RpcFunctionArgs<T>)
      );
      if (error) throw error;
      return data as RpcFunctionReturns<T>;
    },
    staleTime: 3 * 60 * 1000,
    ...queryOptions,
  });
}

// Enhanced RPC mutation hook
export function useRpcMutation<T extends RpcFunctionName>(
  supabase: SupabaseClient<Database>,
  functionName: T,
  options?: UseTableMutationOptions<RpcFunctionReturns<T>, RpcFunctionArgs<T>>
) {
  const queryClient = useQueryClient();
  const { invalidateQueries = true, ...mutationOptions } = options || {};

  return useMutation({
    mutationFn: async (
      args: RpcFunctionArgs<T>
    ): Promise<RpcFunctionReturns<T>> => {
      const { data, error } = await supabase.rpc(
        functionName,
        args || ({} as RpcFunctionArgs<T>)
      );
      if (error) throw error;
      return data as RpcFunctionReturns<T>;
    },
    onSuccess: (data, variables, context) => {
      if (invalidateQueries) {
        queryClient.invalidateQueries({ queryKey: ['rpc', functionName] });
        queryClient.invalidateQueries({ queryKey: ['table'] });
      }
      options?.onSuccess?.(data, variables, context);
    },
    ...mutationOptions,
  });
}

/**
 * A specialized hook to fetch paginated data from the `v_systems_complete` view
 * using the high-performance RPC function.
 */
export const usePagedSystemsComplete =
  createPagedRpcHook<PagedSystemsCompleteResult>(
    'get_paged_v_systems_complete', // RPC function name
    'v_systems_complete', // Unique query key
    'system_name' // Default sort column
  );

export const usePagedSystemConnectionsComplete =
  createPagedRpcHook<PagedSystemConnectionsCompleteResult>(
    'get_paged_system_connections_complete',
    'v_system_connections_complete',
    'system_name' // *** CORRECTLY USES "system_name" AS DEFAULT ***
  );

export const usePagedOfcCablesComplete =
  createPagedRpcHook<PagedOfcCablesCompleteResult>(
    'get_paged_ofc_cables_complete',
    'v_ofc_cables_complete',
    'route_name'
  );

export const usePagedOfcConnectionsComplete =
  createPagedRpcHook<PagedOfcConnectionsCompleteResult>(
    'get_paged_ofc_connections_complete',
    'v_ofc_connections_complete',
    'ofc_route_name'
  );

export const usePagedNodesComplete =
  createPagedRpcHook<PagedNodesCompleteResult>(
    'get_paged_nodes_complete',
    'v_nodes_complete',
    'name'
  );

export const usePagedLookupTypesWithCount =
  createPagedRpcHook<PagedLookupTypesWithCountResult>(
    'get_paged_lookup_types_with_count',
    'v_lookup_types_with_count',
    'name'
  );

export const usePagedMaintenanceAreasWithCount =
  createPagedRpcHook<PagedMaintenanceAreasWithCountResult>(
    'get_paged_maintenance_areas_with_count',
    'v_maintenance_areas_with_count',
    'name'
  );

export const usePagedEmployeeDesignationsWithCount =
  createPagedRpcHook<PagedEmployeeDesignationsWithCountResult>(
    'get_paged_employee_designations_with_count',
    'v_employee_designations_with_count',
    'name'
  );

export const usePagedEmployeesWithCount =
  createPagedRpcHook<PagedEmployeesWithCountResult>(
    'get_paged_employees_with_count',
    'v_employees_with_count',
    'employee_name'
  );

export const usePagedRingsWithCount =
  createPagedRpcHook<PagedRingsWithCountResult>(
    'get_paged_rings_with_count',
    'v_rings_with_count',
    'name'
  );

export function useDashboardOverview(
  supabase: SupabaseClient<Database>,
  options: UseRpcQueryOptions<'get_dashboard_overview'>
) {
  return useRpcQuery(supabase, 'get_dashboard_overview', {}, options);
}

// Lookup type hooks
export function useGetLookupTypeId(
  supabase: SupabaseClient<Database>,
  category: string,
  name: string,
  options?: UseRpcQueryOptions<'get_lookup_type_id'>
) {
  return useRpcQuery(
    supabase,
    'get_lookup_type_id',
    { p_category: category, p_name: name },
    options
  );
}

export function useGetLookupTypesByCategory(
  supabase: SupabaseClient<Database>,
  category: string,
  options?: UseRpcQueryOptions<'get_lookup_types_by_category'>
) {
  return useRpcQuery(
    supabase,
    'get_lookup_types_by_category',
    { p_category: category },
    options
  );
}

export function useAddLookupType(
  supabase: SupabaseClient<Database>,
  options?: UseTableMutationOptions<string, RpcFunctionArgs<'add_lookup_type'>>
) {
  return useRpcMutation(supabase, 'add_lookup_type', options);
}

// User-related hooks
export function useGetMyUserDetails(
  supabase: SupabaseClient<Database>,
  options?: UseRpcQueryOptions<'get_my_user_details'>
) {
  return useRpcQuery(supabase, 'get_my_user_details', {}, options);
}

export function useGetMyRole(
  supabase: SupabaseClient<Database>,
  options?: UseRpcQueryOptions<'get_my_role'>
) {
  return useRpcQuery(supabase, 'get_my_role', {}, options);
}

export function useIsSuperAdmin(
  supabase: SupabaseClient<Database>,
  options?: UseRpcQueryOptions<'is_super_admin'>
) {
  return useRpcQuery(supabase, 'is_super_admin', {}, options);
}

// Admin function hooks
export function useAdminGetAllUsers(
  supabase: SupabaseClient<Database>,
  args?: RpcFunctionArgs<'admin_get_all_users'>,
  options?: UseRpcQueryOptions<'admin_get_all_users'>
) {
  return useRpcQuery(supabase, 'admin_get_all_users', args, options);
}

export function useAdminGetAllUsersExtended(
  supabase: SupabaseClient<Database>,
  args?: RpcFunctionArgs<'admin_get_all_users_extended'>,
  options?: UseRpcQueryOptions<'admin_get_all_users_extended'>
) {
  return useRpcQuery(supabase, 'admin_get_all_users_extended', args, options);
}

export function useAdminUpdateUserProfile(
  supabase: SupabaseClient<Database>,
  options?: UseTableMutationOptions<
    boolean,
    RpcFunctionArgs<'admin_update_user_profile'>
  >
) {
  return useRpcMutation(supabase, 'admin_update_user_profile', options);
}

export function useAdminBulkUpdateRole(
  supabase: SupabaseClient<Database>,
  options?: UseTableMutationOptions<
    boolean,
    RpcFunctionArgs<'admin_bulk_update_role'>
  >
) {
  return useRpcMutation(supabase, 'admin_bulk_update_role', options);
}

export function useAdminBulkUpdateStatus(
  supabase: SupabaseClient<Database>,
  options?: UseTableMutationOptions<
    boolean,
    RpcFunctionArgs<'admin_bulk_update_status'>
  >
) {
  return useRpcMutation(supabase, 'admin_bulk_update_status', options);
}

export function useAdminBulkDeleteUsers(
  supabase: SupabaseClient<Database>,
  options?: UseTableMutationOptions<
    boolean,
    RpcFunctionArgs<'admin_bulk_delete_users'>
  >
) {
  return useRpcMutation(supabase, 'admin_bulk_delete_users', options);
}

```

<!-- path: hnvtx/hooks/database/file-queries.ts -->
```typescript
import { useMutation, useQuery, useQueryClient } from "@tanstack/react-query";
import { createClient } from "@/utils/supabase/client";
import { Database } from "@/types/supabase-types";

type FileRecord = Database["public"]["Tables"]["files"]["Row"];
type FileInsert = Database["public"]["Tables"]["files"]["Insert"];
type FileUpdate = Database["public"]["Tables"]["files"]["Update"];

export function useFiles(folderId?: string | null) {
  const supabase = createClient();
  
  return useQuery({
    queryKey: ["files", folderId],
    queryFn: async () => {
      let query = supabase
        .from("files")
        .select("*");
      
      if (folderId) {
        query = query.eq("folder_id", folderId);
      }
      
      const { data, error } = await query.order("uploaded_at", { ascending: false });
      
      if (error) {
        throw new Error(error.message);
      }
      
      return data || [];
    },
    enabled: true,
  });
}

export function useUploadFile() {
  const supabase = createClient();
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: async (fileData: FileInsert) => {
      const { data, error } = await supabase
        .from("files")
        .insert(fileData)
        .select()
        .single();
        
      if (error) {
        throw new Error(error.message);
      }
      
      return data;
    },
    onSuccess: (data, variables) => {
      queryClient.invalidateQueries({ 
        queryKey: ["files", variables.folder_id] 
      });
    },
  });
}

export function useDeleteFile() {
  const supabase = createClient();
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: async ({
      id,
      folderId,
    }: {
      id: string;
      folderId?: string | null;
    }) => {
      const { error } = await supabase
        .from("files")
        .delete()
        .eq("id", id);
        
      if (error) {
        throw new Error(error.message);
      }
      
      return { id };
    },
    onSuccess: (_, variables) => {
      queryClient.invalidateQueries({ 
        queryKey: ["files", variables.folderId] 
      });
    },
  });
}

export function useUpdateFile() {
  const supabase = createClient();
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: async ({
      id,
      updates,
    }: {
      id: string;
      updates: FileUpdate;
    }) => {
      const { data, error } = await supabase
        .from("files")
        .update(updates)
        .eq("id", id)
        .select()
        .single();
        
      if (error) {
        throw new Error(error.message);
      }
      
      return data;
    },
    onSuccess: (data) => {
      queryClient.invalidateQueries({ 
        queryKey: ["files", data.folder_id] 
      });
    },
  });
}

```

<!-- path: hnvtx/hooks/database/utility-functions.ts -->
```typescript
/* eslint-disable @typescript-eslint/no-explicit-any */
import { QueryKey } from "@tanstack/react-query";
import { AggregationOptions, DeduplicationOptions, FilterOperator, Filters, OrderBy, PerformanceOptions } from "./queries-type-helpers";
import { Json } from "@/types/supabase-types";

// --- UTILITY FUNCTIONS ---
export const createQueryKey = (
  tableName: string,
  filters?: Filters,
  columns?: string,
  orderBy?: OrderBy[],
  deduplication?: DeduplicationOptions,
  aggregation?: AggregationOptions,
  limit?: number,
  offset?: number
): QueryKey => {
  const key: unknown[] = ["table", tableName];
  const params: Record<string, unknown> = { filters, columns, orderBy, deduplication, aggregation, limit, offset };
  const cleanParams = Object.fromEntries(
    Object.entries(params).filter(([, value]) => value !== undefined && value !== null)
  );
  if (Object.keys(cleanParams).length > 0) key.push(cleanParams);
  return key;
};

export const createRpcQueryKey = (functionName: string, args?: Record<string, unknown>, performance?: PerformanceOptions): QueryKey => {
  const key: unknown[] = ["rpc", functionName];
  const params = { args, performance };
  const cleanParams = Object.fromEntries(
    Object.entries(params).filter(([, value]) => value !== undefined && value !== null)
  );
  if (Object.keys(cleanParams).length > 0) key.push(cleanParams);
  return key;
};

export const createUniqueValuesKey = (tableName: string, column: string, filters?: Filters, orderBy?: OrderBy[]): QueryKey => ["unique", tableName, column, { filters, orderBy }];

export function applyFilters(query: any, filters: Filters): any {
  let modifiedQuery = query;
  Object.entries(filters).forEach(([key, value]) => {
    if (value === undefined || value === null) return;

    // Support raw OR conditions: pass a prebuilt PostgREST or() string
    if (key === "$or") {
      if (typeof value === "string" && typeof modifiedQuery.or === "function") {
        modifiedQuery = modifiedQuery.or(value);
      } else if (
        typeof value === "object" && !Array.isArray(value) && "operator" in value && (value as any).operator === "or"
      ) {
        const v = (value as any).value;
        if (typeof v === "string" && typeof modifiedQuery.or === "function") {
          modifiedQuery = modifiedQuery.or(v);
        } else {
          console.warn("$or filter value must be a string representing PostgREST conditions");
        }
      } else {
        console.warn("Unsupported $or filter format; expected string or { operator: 'or', value: string }");
      }
      return;
    }

    if (typeof value === "object" && !Array.isArray(value) && "operator" in value) {
      const { operator, value: filterValue } = value as { operator: FilterOperator; value: unknown };
      if (operator === "or" && typeof filterValue === "string" && typeof modifiedQuery.or === "function") {
        modifiedQuery = modifiedQuery.or(filterValue as string);
      } else if (operator in modifiedQuery && typeof (modifiedQuery as any)[operator] === 'function') {
        modifiedQuery = modifiedQuery[operator](key, filterValue);
      } else {
        console.warn(`Unsupported or dynamic operator used: ${operator}`);
      }
    } else if (Array.isArray(value)) {
      modifiedQuery = modifiedQuery.in(key, value);
    } else {
      modifiedQuery = modifiedQuery.eq(key, value);
    }
  });
  return modifiedQuery;
}

export function applyOrdering(query: any, orderBy: OrderBy[]): any {
  let modifiedQuery = query;
  orderBy.forEach(({ column, ascending = true, nullsFirst, foreignTable }) => {
    const orderColumn = foreignTable ? `${foreignTable}.${column}` : column;
    const options: { ascending: boolean; nullsFirst?: boolean } = { ascending };
    if (nullsFirst !== undefined) options.nullsFirst = nullsFirst;
    modifiedQuery = modifiedQuery.order(orderColumn, options);
  });
  return modifiedQuery;
}

export function buildDeduplicationQuery(tableName: string, deduplication: DeduplicationOptions, filters?: Filters, orderBy?: OrderBy[]): string {
  const { columns, orderBy: dedupOrderBy } = deduplication;
  const partitionBy = columns.join(', ');
  const rowNumberOrder = dedupOrderBy?.length
    ? dedupOrderBy.map(o => `${o.column} ${o.ascending !== false ? 'ASC' : 'DESC'}`).join(', ')
    : 'id ASC';

  let finalOrderClause = '';
  if (orderBy && orderBy.length > 0) {
    const orderParts = orderBy.map(o =>
      `${o.column} ${o.ascending !== false ? 'ASC' : 'DESC'}${o.nullsFirst !== undefined ? (o.nullsFirst ? ' NULLS FIRST' : ' NULLS LAST') : ''}`
    );
    finalOrderClause = `ORDER BY ${orderParts.join(', ')}`;
  }

  let whereClause = '';
  if (filters && Object.keys(filters).length > 0) {
    const conditions = Object.entries(filters)
      .filter(([, value]) => value !== undefined && value !== null) // FIX: Ensure value is not null
      .map(([key, value]) => {
        // FIX: Added check for null on value before accessing properties
        if (value && typeof value === 'object' && !Array.isArray(value) && 'operator' in value) {
          const filterValue = typeof value.value === 'string' ? `'${value.value.toString().replace(/'/g, "''")}'` : value.value;
          return `${key} = ${filterValue}`;
        }
        if (Array.isArray(value)) {
          const arrayValues = value.map(v => typeof v === 'string' ? `'${v.replace(/'/g, "''")}'` : v).join(',');
          return `${key} IN (${arrayValues})`;
        }
        const filterValue = typeof value === 'string' ? `'${value.replace(/'/g, "''")}'` : value;
        return `${key} = ${filterValue}`;
      });

    if (conditions.length > 0) whereClause = `WHERE ${conditions.join(' AND ')}`;
  }

  return `
    WITH deduplicated AS (
      SELECT *, ROW_NUMBER() OVER (PARTITION BY ${partitionBy} ORDER BY ${rowNumberOrder}) as rn
      FROM ${tableName}
      ${whereClause}
    )
    SELECT * FROM deduplicated WHERE rn = 1 ${finalOrderClause}
  `;
}

/**
 * Converts a rich "Filters" object (used by the PostgREST query builder)
 * into a simple key-value JSON object suitable for RPC functions.
 * It strips out complex operators and preserves simple values.
 *
 * @param filters The rich Filters object.
 * @returns A Json-compatible object.
 */
export function convertRichFiltersToSimpleJson(filters: Filters): Json {
  const simpleFilters: { [key: string]: Json | undefined } = {};

  for (const key in filters) {
    // Skip the client-side only '$or' operator
    if (key === '$or') {
      continue;
    }

    const filterValue = filters[key];

    // Check if the value is a simple primitive (string, number, boolean, or null)
    if (
      typeof filterValue === 'string' ||
      typeof filterValue === 'number' ||
      typeof filterValue === 'boolean' ||
      filterValue === null
    ) {
      simpleFilters[key] = filterValue;
    }
    // You can also handle simple arrays if your RPCs support the 'IN' operator
    else if (Array.isArray(filterValue)) {
        simpleFilters[key] = filterValue;
    }
    // We explicitly IGNORE complex objects like { operator: 'neq', value: '...' }
    // because the RPC function doesn't know how to handle them.
  }

  return simpleFilters;
}
```

<!-- path: hnvtx/hooks/useDebounce.ts -->
```typescript
// @/hooks/useDebounce.ts
import { useState, useEffect } from 'react';

export function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    // Cleanup function to cancel the timeout if value changes before delay has passed
    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);

  return debouncedValue;
}
```

<!-- path: hnvtx/hooks/useCrudManager.ts -->
```typescript
"use client";

import { useState, useCallback, useEffect } from "react";
import { useDebounce } from "use-debounce";
import { createClient } from "@/utils/supabase/client";
import {
  useTableInsert,
  useTableUpdate,
  useToggleStatus,
  useTableBulkOperations,
  Filters,
  TableName,
  TableInsert,
  TableUpdate,
  TableInsertWithDates,
} from "@/hooks/database";
import { toast } from "sonner";
import { useDeleteManager } from "./useDeleteManager";

// --- TYPE DEFINITIONS for the Hook's Interface ---
export type RecordWithId = {
  id: string | number | null;
  system_id?: string | number | null;
  system_connection_id?: string | number | null;
  name?: string | null;
  first_name?: string | null;
  last_name?: string | null;
  [key: string]: unknown;
};

export interface DataQueryHookParams {
  currentPage: number;
  pageLimit: number;
  searchQuery: string;
  filters: Filters;
}

export interface DataQueryHookReturn<V> {
  data: V[];
  totalCount: number;
  activeCount: number;
  inactiveCount: number;
  isLoading: boolean;
  error: Error | null;
  refetch: () => void;
}

type DataQueryHook<V> = (params: DataQueryHookParams) => DataQueryHookReturn<V>;

type BaseRecord = { id: string | null; [key: string]: unknown };

export interface CrudManagerOptions<T extends TableName, V extends BaseRecord> {
  tableName: T;
  dataQueryHook: DataQueryHook<V>;
  searchColumn?: keyof V & string;
  processDataForSave?: (data: TableInsertWithDates<T>) => TableInsert<T>;
}

// --- THE HOOK ---
export function useCrudManager<T extends TableName, V extends BaseRecord>({
  tableName,
  dataQueryHook,
  processDataForSave,
}: CrudManagerOptions<T, V>) {
  const supabase = createClient();

  // --- STATE MANAGEMENT ---
  const [editingRecord, setEditingRecord] = useState<V | null>(null);
  const [viewingRecord, setViewingRecord] = useState<V | null>(null);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageLimit, setPageLimit] = useState(10);
  const [searchQuery, setSearchQuery] = useState("");
  const [filters, setFilters] = useState<Filters>({});
  const [isEditModalOpen, setIsEditModalOpen] = useState(false);
  const [isViewModalOpen, setIsViewModalOpen] = useState(false);
  const [selectedRowIds, setSelectedRowIds] = useState<string[]>([]);
  const [debouncedSearch] = useDebounce(searchQuery, 400);

  // Reset pagination when filters change
  useEffect(() => {
    setCurrentPage(1);
  }, [debouncedSearch, filters]);

  // --- DATA FETCHING ---
  const { data, totalCount, activeCount, inactiveCount, isLoading, error, refetch } = dataQueryHook({
    currentPage,
    pageLimit,
    searchQuery: debouncedSearch,
    filters,
  });

  // --- MUTATIONS ---
  const { mutate: insertItem, isPending: isInserting } = useTableInsert(
    supabase,
    tableName,
    {
      onSuccess: () => {
        refetch();
        closeModal();
        toast.success("Record created successfully.");
      },
      onError: (error) => {
        toast.error(`Failed to create record: ${error.message}`);
      },
    }
  );

  const { mutate: updateItem, isPending: isUpdating } = useTableUpdate(
    supabase,
    tableName,
    {
      onSuccess: () => {
        refetch();
        closeModal();
        toast.success("Record updated successfully.");
      },
      onError: (error) => {
        toast.error(`Failed to update record: ${error.message}`);
      },
    }
  );

  const { mutate: toggleStatus } = useToggleStatus(supabase, tableName, {
    onSuccess: () => {
      refetch();
      toast.success("Status updated successfully.");
    },
    onError: (error) => {
      toast.error(`Failed to update status: ${error.message}`);
    },
  });

  // Initialize delete manager
  const deleteManager = useDeleteManager({ 
    tableName, 
    onSuccess: () => {
      refetch();
      handleClearSelection(); // Clear selection after successful delete
    }
  });

  const { bulkUpdate } = useTableBulkOperations(supabase, tableName);

  const isMutating =
    isInserting ||
    isUpdating ||
    deleteManager.isPending ||
    bulkUpdate.isPending;

  // --- MODAL HANDLERS ---
  const openAddModal = useCallback(() => {
    setEditingRecord(null);
    setIsEditModalOpen(true);
  }, []);

  const openEditModal = useCallback((record: V) => {
    setEditingRecord(record);
    setIsEditModalOpen(true);
  }, []);

  const openViewModal = useCallback((record: V) => {
    setViewingRecord(record);
    setIsViewModalOpen(true);
  }, []);

  const closeModal = useCallback(() => {
    setIsEditModalOpen(false);
    setEditingRecord(null);
    setIsViewModalOpen(false);
    setViewingRecord(null);
  }, []);

  // --- SAVE HANDLER ---
  const handleSave = useCallback(
    (formData: TableInsertWithDates<T>) => {
      // Convert ISO date strings back to Date objects for the database
      // const processedData = { ...formData };

      // Handle date fields - adjust these field names as needed
      // const dateFields = [
      //   "employee_dob",
      //   "employee_doj", 
      //   "created_at",
      //   "updated_at",
      // ] as const;

      // dateFields.forEach((field) => {
      //   const fieldKey = field as keyof typeof processedData;
      //   if (field in processedData && processedData[fieldKey]) {
      //     const dateValue = processedData[fieldKey] as string | Date;
      //     (processedData as TableInsertWithDates<T>)[fieldKey] = new Date(
      //       dateValue
      //     ) as unknown as TableInsertWithDates<T>[typeof fieldKey];
      //   }
      // });
      const processedData = processDataForSave 
        ? processDataForSave(formData) 
        : (formData as TableInsert<T>);

      if (editingRecord && "id" in editingRecord && editingRecord.id) {
        updateItem({
          id: String(editingRecord.id),
          data: processedData as TableUpdate<T>,
        });
      } else {
        insertItem(processedData as TableInsert<T>);
      }
    },
    [editingRecord, insertItem, updateItem]
  );

  // --- DELETE HANDLERS ---
  const handleDelete = useCallback(
    (record: RecordWithId) => {
      if (!record.id) {
        toast.error("Cannot delete record: Invalid ID");
        return;
      }

      const displayName = getDisplayName(record);
      deleteManager.deleteSingle({
        id: String(record.id),
        name: displayName,
      });
    },
    [deleteManager]
  );

  // --- UTILITY TO GET DISPLAY NAME ---
  const getDisplayName = useCallback((record: RecordWithId): string => {
    if (record.name) return String(record.name);
    if (record.first_name && record.last_name) {
      return `${record.first_name} ${record.last_name}`;
    }
    if (record.first_name) return String(record.first_name);
    return String(record.id) || 'Unknown';
  }, []);

  // --- STATUS TOGGLE HANDLER ---
  const handleToggleStatus = useCallback(
    (record: RecordWithId & { status?: boolean | null }) => {
      if (!record.id) {
        toast.error("Cannot update status: Invalid record ID");
        return;
      }

      toggleStatus({
        id: String(record.id),
        status: !(record.status ?? false),
      });
    },
    [toggleStatus]
  );

  // --- BULK SELECTION HANDLERS ---
  const handleRowSelect = useCallback(
    (rows: Array<V & { id?: string | number }>) => {
      const validIds = rows
        .map((r) => r.id)
        .filter((id): id is NonNullable<typeof id> => id != null)
        .map((id) => String(id));
      setSelectedRowIds(validIds);
    },
    []
  );

  const handleClearSelection = useCallback(() => {
    setSelectedRowIds([]);
  }, []);

  // --- BULK DELETE HANDLER ---
  const handleBulkDelete = useCallback(() => {
    if (selectedRowIds.length === 0) {
      toast.error("No records selected for deletion");
      return;
    }

    // Convert selected IDs back to records for display names
    const selectedRecords = data
      .filter((record) => selectedRowIds.includes(String(record.id)))
      .map((record) => ({
        id: String(record.id),
        name: getDisplayName(record as RecordWithId),
      }));

    deleteManager.deleteMultiple(selectedRecords);
  }, [selectedRowIds, data, deleteManager, getDisplayName]);

  // --- BULK STATUS UPDATE HANDLER ---
  const handleBulkUpdateStatus = useCallback(
    (status: "active" | "inactive") => {
      if (selectedRowIds.length === 0) return;
      const updates = selectedRowIds.map((id) => ({
        id,
        data: { status: status === "active" } as unknown as TableUpdate<T>,
      }));

      bulkUpdate.mutate(
        { updates },
        {
          onSuccess: () => {
            toast.success(
              `Successfully updated ${updates.length} records to ${status}`
            );
            setSelectedRowIds([]);
            refetch();
          },
          onError: (err) => {
            toast.error(`Failed to update status: ${err.message}`);
          },
        }
      );
    },
    [selectedRowIds, bulkUpdate, refetch]
  );

  // --- BULK DELETE BY FILTER ---
  const handleBulkDeleteByFilter = useCallback(
    (column: string, value: unknown, displayName: string) => {
      deleteManager.deleteBulk({
        column,
        value,
        displayName,
      });
    },
    [deleteManager]
  );

  // --- RETURN VALUE ---
  return {
    // Data
    data: data || [],
    totalCount,
    activeCount,
    inactiveCount,
    isLoading,
    error,
    isMutating,
    refetch,

    // Pagination
    pagination: { 
      currentPage, 
      pageLimit, 
      setCurrentPage, 
      setPageLimit 
    },

    // Search & Filters  
    search: { 
      searchQuery, 
      setSearchQuery 
    },
    filters: { 
      filters, 
      setFilters 
    },

    // Modals
    editModal: { 
      isOpen: isEditModalOpen, 
      record: editingRecord, 
      openAdd: openAddModal, 
      openEdit: openEditModal, 
      close: closeModal 
    },
    viewModal: { 
      isOpen: isViewModalOpen, 
      record: viewingRecord, 
      open: openViewModal, 
      close: closeModal 
    },

    // Actions
    actions: { 
      handleSave, 
      handleDelete, 
      handleToggleStatus 
    },

    // Bulk Actions
    bulkActions: { 
      selectedRowIds, 
      selectedCount: selectedRowIds.length, 
      handleBulkDelete, 
      handleBulkDeleteByFilter,
      handleBulkUpdateStatus, 
      handleClearSelection, 
      handleRowSelect 
    },

    // Delete Modal (for ConfirmModal component)
    deleteModal: { 
      isOpen: deleteManager.isConfirmModalOpen, 
      message: deleteManager.confirmationMessage, 
      onConfirm: deleteManager.handleConfirm, 
      onCancel: deleteManager.handleCancel, 
      loading: deleteManager.isPending 
    },

    // Utility functions
    utils: {
      getDisplayName,
    },
  };
}
```

<!-- path: hnvtx/hooks/useCrudPage.ts -->
```typescript
"use client";

import { useState, useMemo, useCallback, useEffect } from "react";
import { useDebounce } from "use-debounce";
import { createClient } from "@/utils/supabase/client";
import {
  useTableWithRelations,
  useTableInsert,
  useTableUpdate,
  useToggleStatus,
  useTableBulkOperations,
  Filters,
  TableName,
  Row,
  TableInsert,
  TableUpdate,
  TableInsertWithDates,
} from "@/hooks/database";
import { toast } from "sonner";
import { useDeleteManager } from "@/hooks/useDeleteManager";
import { DEFAULTS } from "@/config/constants";

// A generic type to ensure records passed to actions have an 'id' and optionally a 'name'
type RecordWithId = {
  id: string | number;
  system_id?: string | number;
  system_connection_id?: string | number;
  name?: string;
  [key: string]: unknown;
};

/**
 * A comprehensive hook to manage the state and logic for a standard CRUD page.
 * @param tableName The name of the Supabase table.
 * @param options Configuration options for the hook.
 */
export function useCrudPage<T extends TableName>({
  tableName,
  relations = [],
  searchColumn = "name",
  orderByColumn = "name",
}: {
  tableName: T;
  relations?: string[];
  searchColumn: (keyof Row<T> & string) | "name";
  orderByColumn?: string;
}) {
  const supabase = createClient();

  // --- STATE MANAGEMENT ---
  const [currentPage, setCurrentPage] = useState(1);
  const [pageLimit, setPageLimit] = useState(DEFAULTS.PAGE_SIZE);
  const [searchQuery, setSearchQuery] = useState("");
  const [filters, setFilters] = useState<Filters>({});
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingRecord, setEditingRecord] = useState<Row<T> | null>(null);
  const [debouncedSearch] = useDebounce(searchQuery, DEFAULTS.DEBOUNCE_DELAY);
  const [selectedRowIds, setSelectedRowIds] = useState<string[]>([]);

  // --- FILTERS ---
  const serverFilters = useMemo(() => {
    const combinedFilters: Filters = { ...filters };
    if (debouncedSearch) {
      combinedFilters[searchColumn] = {
        operator: "ilike",
        value: `%${debouncedSearch}%`,
      };
    }
    return combinedFilters;
  }, [filters, debouncedSearch, searchColumn]);

  // Reset pagination when filters change
  useEffect(() => {
    setCurrentPage(1);
  }, [debouncedSearch, filters]);

  // --- DATA FETCHING ---
  const { data, isLoading, error, refetch } = useTableWithRelations(
    supabase,
    tableName,
    relations,
    {
      filters: serverFilters,
      limit: pageLimit,
      offset: (currentPage - 1) * pageLimit,
      includeCount: true,
      orderBy: [{ column: orderByColumn, ascending: true }],
    }
  );

  const totalCount =
    (data?.[0] as { total_count: number })?.total_count ?? data?.length ?? 0;

  // --- MUTATIONS ---
  const { mutate: insertItem, isPending: isInserting } = useTableInsert(
    supabase,
    tableName,
    {
      onSuccess: () => {
        refetch();
        closeModal();
        toast.success("Record created successfully!");
      },
      onError: (err) => toast.error(`Creation failed: ${err.message}`),
    }
  );
  const { mutate: updateItem, isPending: isUpdating } = useTableUpdate(
    supabase,
    tableName,
    {
      onSuccess: () => {
        refetch();
        closeModal();
        toast.success("Record updated successfully!");
      },
      onError: (err) => toast.error(`Update failed: ${err.message}`),
    }
  );
  const { mutate: toggleStatus } = useToggleStatus(supabase, tableName, {
    onSuccess: () => refetch(),
    onError: (err) => toast.error(`Status toggle failed: ${err.message}`),
  });

  // *** INTEGRATE useDeleteManager ***
  const deleteManager = useDeleteManager({ tableName, onSuccess: refetch });

  // NEW: Bulk mutation hooks
  const { bulkDelete, bulkUpdate } = useTableBulkOperations(
    supabase,
    tableName
  );

  const isMutating =
    isInserting ||
    isUpdating ||
    deleteManager.isPending ||
    bulkDelete.isPending ||
    bulkUpdate.isPending;

  // --- HANDLERS ---
  const openAddModal = useCallback(() => {
    setEditingRecord(null);
    setIsModalOpen(true);
  }, []);
  const openEditModal = useCallback((record: Row<T>) => {
    setEditingRecord(record);
    setIsModalOpen(true);
  }, []);
  const closeModal = useCallback(() => {
    setIsModalOpen(false);
    setEditingRecord(null);
  }, []);

  const handleSave = useCallback(
    (formData: TableInsertWithDates<T>) => {
      // Convert ISO date strings back to Date objects for the database
      const processedData = { ...formData };

      // Handle date fields - adjust these field names as needed
      const dateFields = ['employee_dob', 'employee_doj', 'created_at', 'updated_at'] as const;
      
      dateFields.forEach((field) => {
        const fieldKey = field as keyof typeof processedData;
        if (field in processedData && processedData[fieldKey]) {
          const dateValue = processedData[fieldKey] as string | Date;
          (processedData as TableInsertWithDates<T>)[fieldKey] = new Date(dateValue) as unknown as TableInsertWithDates<T>[typeof fieldKey];
        }
      });

    if (editingRecord && "id" in editingRecord && editingRecord.id) {
      updateItem({
        id: String(editingRecord.id),
        data: processedData as TableUpdate<T>,
      });
    } else {
      insertItem(processedData as TableInsert<T>);
    }
  },
  [editingRecord, insertItem, updateItem]
);

  // The delete handler now just triggers the delete manager
  const handleDelete = useCallback(
    (record: RecordWithId) => {
      deleteManager.deleteSingle({
        id: String(record.id),
        name: record.name || String(record.id),
      });
    },
    [deleteManager]
  );

  const handleToggleStatus = useCallback(
    (record: RecordWithId & { status?: boolean | null }) => {
      toggleStatus({
        id: String(record.id),
        status: !(record.status ?? false),
      });
    },
    [toggleStatus]
  );

  // NEW: Bulk action handlers
  const handleRowSelect = useCallback(
    (rows: Array<Row<T> & { id?: string | number }>) => {
      setSelectedRowIds(
        rows
          .map((r) => r?.id)
          .filter((id): id is string => typeof id === "string")
      );
    },
    []
  );

  const handleClearSelection = useCallback(() => setSelectedRowIds([]), []);

  const handleBulkDelete = useCallback(() => {
    if (selectedRowIds.length === 0) return;
    if (
      window.confirm(
        `Are you sure you want to delete ${selectedRowIds.length} selected records?`
      )
    ) {
      bulkDelete.mutate(
        { ids: selectedRowIds },
        {
          onSuccess: () => {
            toast.success(`${selectedRowIds.length} records deleted.`);
            setSelectedRowIds([]);
            refetch();
          },
          onError: (err) => toast.error(`Bulk delete failed: ${err.message}`),
        }
      );
    }
  }, [selectedRowIds, bulkDelete, refetch]);

  const handleBulkUpdateStatus = useCallback(
    (status: "active" | "inactive") => {
      if (selectedRowIds.length === 0) return;
      const updates = selectedRowIds.map((id) => ({
        id,
        data: { status: status === "active" } as unknown as TableUpdate<T>,
      }));
      bulkUpdate.mutate(
        { updates },
        {
          onSuccess: () => {
            toast.success(`${selectedRowIds.length} records updated.`);
            setSelectedRowIds([]);
            refetch();
          },
          onError: (err) =>
            toast.error(`Bulk status update failed: ${err.message}`),
        }
      );
    },
    [selectedRowIds, bulkUpdate, refetch]
  );

  // --- RETURN VALUE ---
  return {
    // Data and state
    data: data || [],
    totalCount,
    isLoading,
    error,
    isMutating,
    refetch,

    // UI State
    pagination: { currentPage, pageLimit, setCurrentPage, setPageLimit },
    search: { searchQuery, setSearchQuery },
    filters: { filters, setFilters },
    modal: {
      isModalOpen,
      editingRecord,
      openAddModal,
      openEditModal,
      closeModal,
    },

    // Actions
    actions: { handleSave, handleDelete, handleToggleStatus },

    // Bulk Actions
    bulkActions: {
      selectedCount: selectedRowIds.length,
      handleBulkDelete,
      handleBulkUpdateStatus,
      handleClearSelection,
      handleRowSelect,
    },

    // Expose delete modal state and handlers directly
    deleteModal: {
      isOpen: deleteManager.isConfirmModalOpen,
      message: deleteManager.confirmationMessage,
      confirm: deleteManager.handleConfirm,
      cancel: deleteManager.handleCancel,
      isLoading: deleteManager.isPending,
    },
  };
}

```

<!-- path: hnvtx/hooks/useRoleFunctions.ts -->
```typescript
// hooks/database/functions.ts - Hooks for Supabase functions
import { useQuery, UseQueryResult } from '@tanstack/react-query'
import { createClient } from '@/utils/supabase/client'
import React from 'react'
import { useAuth } from '@/hooks/useAuth'

// Types for better type safety
type UserRole = string | null
type SuperAdminStatus = boolean | null

interface UserPermissions {
  role: UserRole
  isSuperAdmin: SuperAdminStatus
  isLoading: boolean
  error: Error | null
  isError: boolean
  refetch: () => void
}

/**
 * Hook to get the current user's role with automatic session refresh if needed
 */
export const useMyRole = (): UseQueryResult<UserRole, Error> => {
  const supabase = createClient()
  const { user, authState, syncSession } = useAuth()
  
  return useQuery({
    queryKey: ['my-role', user?.id],
    queryFn: async (): Promise<UserRole> => {
      try {
        const { data, error } = await supabase.rpc('get_my_role')

        // If we get null data, try refreshing the session and retry
        if (data === null) {
          const sessionRefreshed = await syncSession()
          if (sessionRefreshed) {
            const { data: retryData, error: retryError } = await supabase.rpc('get_my_role')
            if (retryError) throw retryError
            return retryData as UserRole
          }
        }

        if (error) {
          console.error('Role fetch error:', error)
          throw new Error(`Failed to get user role: ${error.message}`)
        }
        
        return data as UserRole
      } catch (err) {
        console.error('Role query error:', err)
        throw err
      }
    },
    staleTime: 10 * 60 * 1000, // 10 minutes
    gcTime: 15 * 60 * 1000, // 15 minutes
    retry: (failureCount, error) => {
      // Don't retry on authentication errors
      if (error.message.includes('JWT') || error.message.includes('auth')) {
        return false
      }
      return failureCount < 2
    },
    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),
    enabled: authState === "authenticated" && !!user?.id,
    refetchOnWindowFocus: false,
    networkMode: 'offlineFirst'
  })
}

/**
 * Hook to check if the current user is a super admin
 */
export const useIsSuperAdmin = (): UseQueryResult<SuperAdminStatus, Error> => {
  const supabase = createClient()
  const { user, authState, syncSession } = useAuth()
  
  return useQuery({
    queryKey: ['is-super-admin', user?.id],
    queryFn: async (): Promise<SuperAdminStatus> => {
      try {
        const { data, error } = await supabase.rpc('is_super_admin')

        // If we get null data, try refreshing the session and retry
        if (data === null) {
          const sessionRefreshed = await syncSession()
          if (sessionRefreshed) {
            const { data: retryData, error: retryError } = await supabase.rpc('is_super_admin')
            if (retryError) throw retryError
            return retryData as SuperAdminStatus
          }
        }
        
        if (error) {
          console.error('Super admin check error:', error)
          throw new Error(`Failed to check super admin status: ${error.message}`)
        }
        
        return data as SuperAdminStatus
      } catch (err) {
        console.error('Super admin query error:', err)
        throw err
      }
    },
    staleTime: 10 * 60 * 1000, // 10 minutes
    gcTime: 15 * 60 * 1000, // 15 minutes
    retry: (failureCount, error) => {
      if (error.message.includes('JWT') || error.message.includes('auth')) {
        return false
      }
      return failureCount < 2
    },
    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 30000),
    enabled: authState === "authenticated" && !!user?.id,
    refetchOnWindowFocus: false,
    networkMode: 'offlineFirst'
  })
}

/**
 * Combined hook that returns both role and super admin status
 * with optimized refetching and error handling
 */
export const useUserPermissions = (): UserPermissions => {
  const roleQuery = useMyRole()
  const superAdminQuery = useIsSuperAdmin()
  
  const refetch = React.useCallback(() => {
    return Promise.allSettled([
      roleQuery.refetch(),
      superAdminQuery.refetch()
    ])
  }, [roleQuery, superAdminQuery])
  
  return {
    role: roleQuery.data ?? null,
    isSuperAdmin: superAdminQuery.data ?? null,
    isLoading: roleQuery.isLoading || superAdminQuery.isLoading,
    error: roleQuery.error || superAdminQuery.error || null,
    isError: roleQuery.isError || superAdminQuery.isError,
    refetch
  }
}

/**
 * Extended version of user permissions with utility methods
 */
export const useUserPermissionsExtended = () => {
  const permissions = useUserPermissions()
  
  const hasRole = React.useCallback((requiredRole: string): boolean => {
    return permissions.role === requiredRole
  }, [permissions.role])
  
  const hasAnyRole = React.useCallback((requiredRoles: string[]): boolean => {
    return permissions.role ? requiredRoles.includes(permissions.role) : false
  }, [permissions.role])
  
  const canAccess = React.useCallback((allowedRoles?: string[]): boolean => {
    // Super admin can access everything
    if (permissions.isSuperAdmin) return true
    
    // If no roles specified, just check if authenticated
    if (!allowedRoles || allowedRoles.length === 0) return !!permissions.role
    
    // Check if user has required role
    return hasAnyRole(allowedRoles)
  }, [permissions.isSuperAdmin, permissions.role, hasAnyRole])
  
  return {
    ...permissions,
    hasRole,
    hasAnyRole,
    canAccess,
    isReady: !permissions.isLoading && !permissions.error
  }
}

/**
 * Optimized hook for role-based conditional rendering
 * Uses memoization to prevent unnecessary re-renders
 */
export const useHasPermission = (allowedRoles?: string[]): boolean => {
  const { canAccess } = useUserPermissionsExtended()
  return React.useMemo(() => canAccess(allowedRoles), [canAccess, allowedRoles])
}

// Export types for use in other files
export type { UserRole, SuperAdminStatus, UserPermissions }
```

<!-- path: hnvtx/hooks/useDebugSession.ts -->
```typescript
// hooks/useDebugSession.ts
import { useEffect, useState } from 'react'
import { createClient } from '@/utils/supabase/client'

export const useDebugSession = () => {
  const [sessionInfo, setSessionInfo] = useState<any>(null)
  const supabase = createClient()

  useEffect(() => {
    const checkSession = async () => {
      // Check current session
      const { data: { session }, error } = await supabase.auth.getSession()
      
      // Check headers that would be sent with requests
      const headers = await supabase.auth.getSession().then(({ data: { session } }) => ({
        'apikey': 'present',
        'authorization': session ? `Bearer ${session.access_token}` : 'none',
        'user_id': session?.user?.id || 'none'
      }))

      setSessionInfo({
        hasSession: !!session,
        userId: session?.user?.id,
        accessToken: session?.access_token ? 'present' : 'none',
        refreshToken: session?.refresh_token ? 'present' : 'none',
        expiresAt: session?.expires_at,
        headers,
        error: error?.message
      })

      console.log('Session Debug:', {
        hasSession: !!session,
        userId: session?.user?.id,
        accessToken: session?.access_token ? 'present' : 'none',
        headers,
        error: error?.message
      })
    }

    checkSession()

    // Listen for changes
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (event, session) => {
        console.log('Auth state change:', event, session?.user?.id)
        checkSession()
      }
    )

    return () => subscription.unsubscribe()
  }, [])

  return sessionInfo
}
```

<!-- path: hnvtx/hooks/useAuth.ts -->
```typescript
// hooks/useAuth.ts
"use client";

import { useEffect, useMemo, useCallback } from "react";
import { createClient } from "@/utils/supabase/client";
import { useAuthStore } from "@/stores/authStore";
import { toast } from "sonner";

// Auth Hook
export const useAuth = () => {
  const { user, authState, setUser, setAuthState, logout: logoutStore, executeWithLoading, isAuthenticated, isLoading, getUserId } = useAuthStore();
  const supabase = useMemo(() => createClient(), []);

  // Initialize auth state - runs only once
  useEffect(() => {
    let isMounted = true;
    const subscription = supabase.auth.onAuthStateChange(async (event, session) => {
      if (isMounted) {
        setUser(session?.user ?? null);
      }
    }).data.subscription;

    const initAuth = async () => {
      try {
        // First try to get existing session without forcing refresh
        const { data: { session: existingSession } } = await supabase.auth.getSession();
        
        if (existingSession?.user) {
          if (isMounted) setUser(existingSession.user);
          return;
        }

        // Only force refresh if no existing session
        const { data: { session }, error } = await supabase.auth.refreshSession();

        if (error) {
          if (isMounted) setAuthState("unauthenticated");
          return;
        }

        if (session?.user && isMounted) {
          setUser(session.user);
        } else if (isMounted) {
          setAuthState("unauthenticated");
        }
      } catch (error) {
        if (isMounted) {
          console.error("Failed to initialize auth:", error instanceof Error ? error.message : "Unknown error");
          setAuthState("unauthenticated");
        }
      }
    };

    initAuth();

    return () => {
      isMounted = false;
      subscription?.unsubscribe();
    };
  }, [supabase, setUser, setAuthState]);

  // Memoized auth methods
  const signUp = useCallback(async (credentials: { email: string; password: string; firstName: string; lastName: string }) => {
    return executeWithLoading(async () => {
      try {
        const { data, error } = await supabase.auth.signUp({
          email: credentials.email,
          password: credentials.password,
          options: {
            data: {
              first_name: credentials.firstName,
              last_name: credentials.lastName,
            },
          },
        });

        if (error) throw error;
        if (data.user && !data.session) {
          toast.success("Signup successful! Please check your email for verification.");
        }
        return { data, error: null };
      } catch (error) {
        const message = error instanceof Error ? error.message : "Signup failed";
        toast.error(message);
        return { data: null, error: message };
      }
    });
  }, [executeWithLoading, supabase.auth]);

  const signIn = useCallback(async (email: string, password: string) => {
    return executeWithLoading(async () => {
      try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) throw error;
        toast.success("Signed in successfully!");
        return { data, error: null };
      } catch (error) {
        const message = error instanceof Error ? error.message : "Sign in failed";
        toast.error(message);
        return { data: null, error: message };
      }
    });
  }, [executeWithLoading, supabase.auth]);

  const signInWithMagicLink = useCallback(async (email: string) => {
    return executeWithLoading(async () => {
      try {
        const { data, error } = await supabase.auth.signInWithOtp({
          email,
          options: { shouldCreateUser: true },
        });
        if (error) throw error;
        toast.success("Check your email for the magic link!");
        return { data, error: null };
      } catch (error) {
        const message = error instanceof Error ? error.message : "Failed to send magic link";
        toast.error(message);
        return { data: null, error: message };
      }
    });
  }, [executeWithLoading, supabase.auth]);

  const signInWithGoogle = useCallback(async () => {
    try {
      const { data, error } = await supabase.auth.signInWithOAuth({
        provider: "google",
        options: { 
          redirectTo: `${window.location.origin}/auth/callback`,
          // Skip browser redirect to prevent page reload
          skipBrowserRedirect: true
        },
      });
      
      if (error) throw error;
      
      // If we have a URL, perform the redirect manually
      if (data?.url) {
        window.location.href = data.url;
      }
      
      return { data, error: null };
    } catch (error) {
      sessionStorage.removeItem('oauth_in_progress');
      const message = error instanceof Error ? error.message : "Google sign in failed";
      toast.error(message);
      return { data: null, error: message };
    }
  }, [supabase.auth]);

  const logout = useCallback(async () => {
    try {
      const { error } = await supabase.auth.signOut();
      if (error) throw error;
      logoutStore();
      toast.success("Signed out successfully!");
    } catch (error) {
      const message = error instanceof Error ? error.message : "Logout failed";
      toast.error(message);
      logoutStore();
      throw error;
    }
  }, [supabase.auth, logoutStore]);

  const forgotPassword = useCallback(async (email: string) => {
    return executeWithLoading(async () => {
      try {
        const { error } = await supabase.auth.resetPasswordForEmail(email, {
          redirectTo: `${window.location.origin}/reset-password`,
        });
        if (error) throw error;
        return { error: null };
      } catch (error) {
        const message = error instanceof Error ? error.message : "Failed to send reset email";
        toast.error(message);
        return { error: message };
      } finally {
        setAuthState("unauthenticated");
      }
    });
  }, [executeWithLoading, supabase.auth, setAuthState]);

  const resetPassword = useCallback(async (newPassword: string) => {
    return executeWithLoading(async () => {
      try {
        const { error } = await supabase.auth.updateUser({ password: newPassword });
        if (error) throw error;
        toast.success("Password updated successfully!");
        return { error: null };
      } catch (error) {
        const message = error instanceof Error ? error.message : "Password update failed";
        toast.error(message);
        return { error: message };
      }
    });
  }, [executeWithLoading, supabase.auth]);

  const syncSession = useCallback(async () => {
    try {
      const { data: { session }, error } = await supabase.auth.refreshSession();
      if (error) {
        console.error("Session sync error:", error);
        return false;
      }
      if (session?.user) {
        setUser(session.user);
        return true;
      }
      return false;
    } catch (error) {
      console.error("Failed to sync session:", error);
      return false;
    }
  }, [supabase.auth, setUser]);

  const checkSession = useCallback(async () => {
    return executeWithLoading(async () => {
      const { data: { session } } = await supabase.auth.getSession();
      setUser(session?.user || null);
      return session;
    });
  }, [executeWithLoading, supabase.auth, setUser]);

  // Memoize the entire return value
  return useMemo(() => ({
    // State
    user,
    authState,
    isLoading: isLoading(),
    isAuthenticated: isAuthenticated(),
    userId: getUserId(),

    // Actions
    signUp,
    signIn,
    signInWithMagicLink,
    signInWithGoogle,
    logout,
    forgotPassword,
    resetPassword,
    syncSession,
    checkSession,
  }), [
    user,
    authState,
    isLoading,
    isAuthenticated,
    getUserId,
    signUp,
    signIn,
    signInWithMagicLink,
    signInWithGoogle,
    logout,
    forgotPassword,
    resetPassword,
    syncSession,
    checkSession
  ]);
};
```

<!-- path: hnvtx/hooks/useEntityManagement.ts -->
```typescript
"use client";

import { BaseEntity, EntityWithChildren, isHierarchicalEntity, UseEntityManagementProps } from "@/components/common/entity-management/types";
import { useMemo, useState } from "react";

export function useEntityManagement<T extends BaseEntity>({ entitiesQuery, config, onEdit, onDelete, onToggleStatus, onCreateNew }: UseEntityManagementProps<T>) {
  const [searchTerm, setSearchTerm] = useState("");
  const [viewMode, setViewMode] = useState<"tree" | "list">("list");
  const [showFilters, setShowFilters] = useState(false);
  const [filters, setFilters] = useState<Record<string, string>>({});
  const [selectedEntityId, setSelectedEntityId] = useState<string | null>(null);
  const [showDetailsPanel, setShowDetailsPanel] = useState(false);
  const [expandedEntities, setExpandedEntities] = useState<Set<string>>(new Set());

  const allEntities = entitiesQuery.data || [];

  // Search functionality
  const searchedEntities = useMemo(() => {
    if (!searchTerm) return allEntities;

    return allEntities.filter((entity) =>
      config.searchFields.some((field) => {
        const value = entity[field];
        return value && String(value).toLowerCase().includes(searchTerm.toLowerCase());
      })
    );
  }, [allEntities, searchTerm, config.searchFields]);

  // Filter functionality
  const filteredEntities = useMemo(() => {
    return searchedEntities.filter((entity) => {
      return Object.entries(filters).every(([key, value]) => {
        if (!value) return true;

        const entityValue = (entity as any)[key];
        if (key === "status") {
          return entityValue.toString() === value;
        }
        return entityValue === value;
      });
    });
  }, [searchedEntities, filters]);

  // Build hierarchical structure for tree view
  const hierarchicalEntities = useMemo((): EntityWithChildren<T>[] => {
    if (!config.isHierarchical) return filteredEntities.map((entity) => ({ ...entity, children: [] }));

    // Create a map to store entities with their children
    const entityMap = new Map<string, EntityWithChildren<T>>();

    // Initialize all entities with empty children arrays
    filteredEntities.forEach((entity) => {
      entityMap.set(entity.id, { ...entity, children: [] });
    });

    const rootEntities: EntityWithChildren<T>[] = [];

    // Build the hierarchy
    filteredEntities.forEach((entity) => {
      const entityWithChildren = entityMap.get(entity.id);
      if (!entityWithChildren) return;

      if (isHierarchicalEntity(entity) && entity.parent_id) {
        // This entity has a parent, add it to parent's children
        const parent = entityMap.get(entity.parent_id);
        if (parent) {
          parent.children.push(entityWithChildren);
        } else {
          // Parent not in filtered results, treat as root
          rootEntities.push(entityWithChildren);
        }
      } else {
        // This is a root entity
        rootEntities.push(entityWithChildren);
      }
    });

    return rootEntities;
  }, [filteredEntities, config.isHierarchical]);

  const selectedEntity = allEntities.find((entity) => entity.id === selectedEntityId) || null;

  // Event handlers
  const handleEntitySelect = (id: string) => {
    setSelectedEntityId(id);
    setShowDetailsPanel(true);
  };

  const toggleExpanded = (id: string) => {
    setExpandedEntities((prev) => {
      const newSet = new Set(prev);
      if (newSet.has(id)) {
        newSet.delete(id);
      } else {
        newSet.add(id);
      }
      return newSet;
    });
  };

  const handleOpenCreateForm = () => {
    onCreateNew();
  };

  const handleOpenEditForm = () => {
    if (selectedEntity) {
      onEdit(selectedEntity);
    }
  };

  return {
    // State
    searchTerm,
    viewMode,
    showFilters,
    filters,
    selectedEntityId,
    showDetailsPanel,
    expandedEntities,

    // Computed data
    allEntities,
    filteredEntities,
    hierarchicalEntities,
    selectedEntity,

    // Handlers
    setSearchTerm,
    setViewMode,
    setShowFilters,
    setFilters,
    setShowDetailsPanel,
    handleEntitySelect,
    toggleExpanded,
    handleOpenCreateForm,
    handleOpenEditForm,
    onToggleStatus,
    onDelete,
  };
}

```

<!-- path: hnvtx/hooks/useDeleteManager.ts -->
```typescript
// hooks/useDeleteManager.ts
import { useState, useCallback } from 'react';
import { toast } from 'sonner';
import { useTableDelete } from '@/hooks/database';
import { createClient } from '@/utils/supabase/client';
import { Database } from '@/types/supabase-types';
import { hasDetails } from '@/types/error-types';

interface DeleteItem {
  id: string;
  name: string;
  [key: string]: unknown;
}

interface BulkDeleteFilter {
  column: string;
  value: unknown;
  displayName: string;
}

interface UseDeleteManagerProps {
  tableName: keyof Database['public']['Tables'];
  onSuccess?: () => void;
}

export function useDeleteManager({ tableName, onSuccess }: UseDeleteManagerProps) {
  const [isConfirmModalOpen, setIsConfirmModalOpen] = useState(false);
  const [deleteConfig, setDeleteConfig] = useState<{
    type: 'single' | 'bulk';
    items?: DeleteItem[];
    filter?: BulkDeleteFilter;
  } | null>(null);

  const supabase = createClient();
  const { mutate: deleteRowsById, isPending } = useTableDelete(supabase, tableName);

  
  
  // Single item deletion
  const deleteSingle = useCallback((item: DeleteItem) => {
    setDeleteConfig({
      type: 'single',
      items: [item],
    });
    setIsConfirmModalOpen(true);
  }, []);

  // Multiple items deletion (by IDs)
  const deleteMultiple = useCallback((items: DeleteItem[]) => {
    setDeleteConfig({
      type: 'single', // Still uses ID-based deletion
      items,
    });
    setIsConfirmModalOpen(true);
  }, []);

  // Bulk deletion by filter
  const deleteBulk = useCallback((filter: BulkDeleteFilter) => {
    setDeleteConfig({
      type: 'bulk',
      filter,
    });
    setIsConfirmModalOpen(true);
  }, []);

  const handleConfirm = useCallback(async () => {
    if (!deleteConfig) return;

    setIsConfirmModalOpen(false);

    try {
      if (deleteConfig.type === 'single' && deleteConfig.items) {
        // Direct ID-based deletion
        const idsToDelete = deleteConfig.items.map(item => item.id);
        
        deleteRowsById(idsToDelete, {
          onSuccess: () => {
            const itemNames = deleteConfig.items!.map(item => item.name).join(', ');
            toast.success(
              deleteConfig.items!.length === 1
                ? `Successfully deleted "${itemNames}"`
                : `Successfully deleted ${deleteConfig.items!.length} items: ${itemNames}`
            );
            onSuccess?.();
          },
          onError: (err) => {
            console.error('Deletion failed:', err);
            if (hasDetails(err)) {
              toast.error('Failed to delete items'+ err.details);
            } else {
              toast.error('Failed to delete items');
            }
          },
        });
      } else if (deleteConfig.type === 'bulk' && deleteConfig.filter) {
        // First fetch IDs that match the filter, then delete
        const { data: rowsToDelete, error: fetchError } = await supabase
          .from(tableName)
          .select('id')
          .eq(deleteConfig.filter.column, deleteConfig.filter.value);

        if (fetchError) {
          throw fetchError;
        }

        if (!rowsToDelete || rowsToDelete.length === 0) {
          toast.error(`No items found matching "${deleteConfig.filter.displayName}" to delete.`);
          return;
        }

        const idsToDelete = rowsToDelete.map(row => row.id);
        
        deleteRowsById(idsToDelete, {
          onSuccess: () => {
            toast.success(
              `Successfully deleted ${idsToDelete.length} items from "${deleteConfig.filter!.displayName}"`
            );
            onSuccess?.();
          },
          onError: (err) => {
            console.error('Deletion failed:', err);
            if (hasDetails(err)) {
              toast.error('Failed to delete items'+ err.details);
            } else {
              toast.error('Failed to delete items');
            }
          },
        });
      }
    } catch (error) {
      console.error('Error during deletion:', error);
      toast.error('Failed to delete items');
    } finally {
      setDeleteConfig(null);
    }
  }, [deleteConfig, deleteRowsById, onSuccess, supabase, tableName]);

  const handleCancel = useCallback(() => {
    setIsConfirmModalOpen(false);
    setDeleteConfig(null);
  }, []);

  // Generate confirmation message
  const getConfirmationMessage = useCallback(() => {
    if (!deleteConfig) return '';

    if (deleteConfig.type === 'single' && deleteConfig.items) {
      const items = deleteConfig.items;
      if (items.length === 1) {
        return `Are you sure you want to delete "${items[0].name}"? This cannot be undone.`;
      }
      return `Are you sure you want to delete ${items.length} items? This cannot be undone.`;
    }

    if (deleteConfig.type === 'bulk' && deleteConfig.filter) {
      return `Are you sure you want to delete all items in "${deleteConfig.filter.displayName}"? This cannot be undone.`;
    }

    return 'Are you sure you want to delete? This cannot be undone.';
  }, [deleteConfig]);

  return {
    // Actions
    deleteSingle,
    deleteMultiple,
    deleteBulk,
    handleConfirm,
    handleCancel,
    
    // State
    isConfirmModalOpen,
    isPending,
    confirmationMessage: getConfirmationMessage(),
    
    // For debugging/display
    deleteConfig,
  };
}


```

<!-- path: hnvtx/hooks/useSorting.ts -->
```typescript
import { useMemo, useState, useCallback } from 'react';

// Types
export type SortDirection = 'asc' | 'desc' | null;

export interface SortConfig<T> {
  key: keyof T | string;
  direction: SortDirection;
}

export interface SortOptions {
  caseSensitive?: boolean;
  numericSort?: boolean;
  locale?: string;
}

export interface UseSortingProps<T> {
  data: T[];
  defaultSortKey?: keyof T | string;
  defaultDirection?: SortDirection;
  options?: SortOptions;
}

export interface UseSortingReturn<T> {
  sortedData: T[];
  sortConfig: SortConfig<T>;
  setSortConfig: (config: SortConfig<T>) => void;
  handleSort: (key: keyof T | string) => void;
  resetSort: () => void;
  isSorted: boolean;
  getSortDirection: (key: keyof T | string) => SortDirection;
}

// Union type for supported sortable values
type SortableValue = string | number | Date | boolean | null | undefined;

// Helper function to get nested property value
function getNestedValue(obj: Record<string, unknown>, path: string): SortableValue {
  const keys = path.split('.');
  let current: unknown = obj;
  
  for (const key of keys) {
    if (current === null || current === undefined) {
      return undefined;
    }
    if (typeof current === 'object' && current !== null && key in current) {
      current = (current as Record<string, unknown>)[key];
    } else {
      return undefined;
    }
  }
  
  // Type guard to ensure we return only sortable values
  if (
    typeof current === 'string' ||
    typeof current === 'number' ||
    typeof current === 'boolean' ||
    current instanceof Date ||
    current === null ||
    current === undefined
  ) {
    return current as SortableValue;
  }
  
  // Convert other types to string for comparison
  return String(current);
}

// Helper function to compare values
function compareValues(
  a: SortableValue, 
  b: SortableValue, 
  direction: SortDirection, 
  options: SortOptions = {}
): number {
  const { caseSensitive = false, numericSort = true, locale = 'en' } = options;
  
  // Handle null/undefined values
  if (a == null && b == null) return 0;
  if (a == null) return direction === 'asc' ? -1 : 1;
  if (b == null) return direction === 'asc' ? 1 : -1;

  // Handle different data types
  if (typeof a === 'string' && typeof b === 'string') {
    const valueA = caseSensitive ? a : a.toLowerCase();
    const valueB = caseSensitive ? b : b.toLowerCase();
    
    // Use localeCompare for proper string sorting
    const result = valueA.localeCompare(valueB, locale, {
      numeric: numericSort,
      sensitivity: caseSensitive ? 'case' : 'base'
    });
    
    return direction === 'asc' ? result : -result;
  }

  // Handle numbers
  if (typeof a === 'number' && typeof b === 'number') {
    const result = a - b;
    return direction === 'asc' ? result : -result;
  }

  // Handle dates
  if (a instanceof Date && b instanceof Date) {
    const result = a.getTime() - b.getTime();
    return direction === 'asc' ? result : -result;
  }

  // Handle boolean values
  if (typeof a === 'boolean' && typeof b === 'boolean') {
    const result = Number(a) - Number(b);
    return direction === 'asc' ? result : -result;
  }

  // Fallback to string comparison for mixed types
  const stringA = String(a);
  const stringB = String(b);
  const result = stringA.localeCompare(stringB, locale, {
    numeric: numericSort,
    sensitivity: caseSensitive ? 'case' : 'base'
  });
  
  return direction === 'asc' ? result : -result;
}

// Main sorting hook
export function useSorting<T extends Record<string, unknown>>({
  data,
  defaultSortKey,
  defaultDirection = 'asc',
  options = {}
}: UseSortingProps<T>): UseSortingReturn<T> {
  
  const [sortConfig, setSortConfig] = useState<SortConfig<T>>({
    key: defaultSortKey || '',
    direction: defaultSortKey ? defaultDirection : null
  });

  // Memoized sorted data
  const sortedData = useMemo(() => {
    if (!sortConfig.key || !sortConfig.direction || !data.length) {
      return data;
    }

    return [...data].sort((a, b) => {
      const valueA = getNestedValue(a, String(sortConfig.key));
      const valueB = getNestedValue(b, String(sortConfig.key));
      
      return compareValues(valueA, valueB, sortConfig.direction, options);
    });
  }, [data, sortConfig, options]);

  // Handle sort column click
  const handleSort = useCallback((key: keyof T | string) => {
    setSortConfig(prevConfig => {
      if (prevConfig.key === key) {
        // Cycle through: asc -> desc -> null -> asc
        switch (prevConfig.direction) {
          case 'asc':
            return { key, direction: 'desc' };
          case 'desc':
            return { key: '', direction: null };
          default:
            return { key, direction: 'asc' };
        }
      } else {
        // New column, start with ascending
        return { key, direction: 'asc' };
      }
    });
  }, []);

  // Reset sorting
  const resetSort = useCallback(() => {
    setSortConfig({ key: '', direction: null });
  }, []);

  // Check if currently sorted
  const isSorted = Boolean(sortConfig.key && sortConfig.direction);

  // Get sort direction for a specific key
  const getSortDirection = useCallback((key: keyof T | string): SortDirection => {
    return sortConfig.key === key ? sortConfig.direction : null;
  }, [sortConfig]);

  return {
    sortedData,
    sortConfig,
    setSortConfig,
    handleSort,
    resetSort,
    isSorted,
    getSortDirection
  };
}

// Additional utility hooks for specific use cases

// Hook for multi-column sorting
export interface MultiSortConfig<T> {
  key: keyof T | string;
  direction: SortDirection;
  priority: number;
}

export function useMultiSorting<T extends Record<string, unknown>>(
  data: T[], 
  options: SortOptions = {}
) {
  const [sortConfigs, setSortConfigs] = useState<MultiSortConfig<T>[]>([]);

  const sortedData = useMemo(() => {
    if (!sortConfigs.length || !data.length) return data;

    return [...data].sort((a, b) => {
      for (const config of sortConfigs.sort((x, y) => x.priority - y.priority)) {
        if (!config.direction) continue;
        
        const valueA = getNestedValue(a, String(config.key));
        const valueB = getNestedValue(b, String(config.key));
        
        const result = compareValues(valueA, valueB, config.direction, options);
        if (result !== 0) return result;
      }
      return 0;
    });
  }, [data, sortConfigs, options]);

  const addSort = useCallback((key: keyof T | string, direction: SortDirection) => {
    if (!direction) return;
    
    setSortConfigs(prev => {
      const existing = prev.find(config => config.key === key);
      if (existing) {
        return prev.map(config => 
          config.key === key 
            ? { ...config, direction }
            : config
        );
      }
      return [...prev, { key, direction, priority: prev.length }];
    });
  }, []);

  const removeSort = useCallback((key: keyof T | string) => {
    setSortConfigs(prev => prev.filter(config => config.key !== key));
  }, []);

  const clearSort = useCallback(() => {
    setSortConfigs([]);
  }, []);

  return {
    sortedData,
    sortConfigs,
    addSort,
    removeSort,
    clearSort
  };
}

// Hook for search + sort combination
export function useSearchAndSort<T extends Record<string, unknown>>(
  data: T[],
  searchKeys: (keyof T | string)[],
  sortOptions: SortOptions = {}
) {
  const [searchTerm, setSearchTerm] = useState('');
  
  // Filter data based on search term
  const filteredData = useMemo(() => {
    if (!searchTerm.trim()) return data;
    
    return data.filter(item => 
      searchKeys.some(key => {
        const value = getNestedValue(item, String(key));
        return String(value || '').toLowerCase().includes(searchTerm.toLowerCase());
      })
    );
  }, [data, searchTerm, searchKeys]);

  // Apply sorting to filtered data
  const sortingResult = useSorting({
    data: filteredData,
    options: sortOptions
  });

  return {
    ...sortingResult,
    searchTerm,
    setSearchTerm,
    filteredCount: filteredData.length,
    totalCount: data.length
  };
}

// Utility type for extracting sortable keys from an object type
export type SortableKeys<T> = {
  [K in keyof T]: T[K] extends SortableValue ? K : never;
}[keyof T];

// Hook with strongly typed keys (optional, for better type safety)
export function useTypedSorting<T extends Record<string, unknown>>(
  data: T[],
  defaultSortKey?: SortableKeys<T>,
  defaultDirection: SortDirection = 'asc',
  options: SortOptions = {}
) {
  return useSorting({
    data,
    defaultSortKey,
    defaultDirection,
    options
  });
}
```

<!-- path: hnvtx/hooks/useOfcConnection.ts -->
```typescript
import { useCallback, useMemo } from 'react';
import { SupabaseClient } from '@supabase/supabase-js';
import { Database } from '@/types/supabase-types';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import {
  usePagedOfcCablesComplete,
  usePagedOfcConnectionsComplete,
} from './database';
import { useSorting, SortDirection } from '@/hooks/useSorting';

type OfcConnection =
  Database['public']['Tables']['ofc_connections']['Insert'] & {
    id?: string;
  };

interface UseOfcConnectionProps {
  supabase: SupabaseClient<Database>;
  cableId: string;
  // pagination and sorting options
  limit?: number;
  offset?: number;
  orderBy?: string;
  orderDir?: 'asc' | 'desc';
  // optional server-side search query
  search?: string;
  // NEW: Optional client-side sorting enhancement
  enableClientSorting?: boolean;
}

// Define sortable keys for better type safety (optional)
type OfcConnectionSortableKeys =
  | 'fiber_no_sn'
  | 'connection_type'
  | 'connection_category'
  | 'status'
  | 'destination_port'
  | 'source_port'
  | 'en_power_dbm'
  | 'sn_power_dbm'
  | 'route_loss_db'
  | 'created_at'
  | 'updated_at';

export const useOfcConnection = ({
  supabase,
  cableId,
  limit = 10,
  offset = 0,
  orderBy = 'fiber_no_sn',
  orderDir = 'asc',
  search,
  enableClientSorting = false, // Default to false to maintain existing behavior
}: UseOfcConnectionProps) => {
  const queryClient = useQueryClient();

  const { data: cable, isLoading: isLoadingCable } = usePagedOfcCablesComplete(
    supabase,
    {
      filters: { id: cableId },
      limit: 1,
      offset: 0,
    }
  );

  // Get existing connections for this cable with pagination
  const {
    data: rawConnections = [],
    isLoading: isLoadingOfcConnections,
    refetch: refetchOfcConnections,
  } = usePagedOfcConnectionsComplete(supabase, {
    filters: { ofc_id: cableId, ...(search ? { search } : {}) },
    limit,
    offset,
    orderBy,
    orderDir,
  });

  // Extract counts and debug info
  const { totalCount, activeCount, inactiveCount } = useMemo(() => {
    if (rawConnections && rawConnections.length > 0) {
      return {
        totalCount: rawConnections[0]?.total_count || 0,
        activeCount: rawConnections[0]?.active_count || 0,
        inactiveCount: rawConnections[0]?.inactive_count || 0,
      };
    }
    return { totalCount: 0, activeCount: 0, inactiveCount: 0 };
  }, [rawConnections]);

  // NEW: Optional client-side sorting (only used if enabled)
  const {
    sortedData: clientSortedConnections,
    sortConfig,
    handleSort,
    resetSort,
    isSorted,
    getSortDirection,
  } = useSorting({
    data: rawConnections || [], // Handle null case
    defaultSortKey: orderBy,
    defaultDirection: orderDir as SortDirection,
    options: {
      caseSensitive: false,
      numericSort: true,
    },
  });

  // Return the appropriate data based on sorting preference
  const existingConnections = useMemo(() => {
    const connections = rawConnections || [];
    return enableClientSorting ? clientSortedConnections : connections;
  }, [enableClientSorting, clientSortedConnections, rawConnections]);

  // NEW: Enhanced sort handler (optional, only exposed if client sorting is enabled)
  const handleSortColumn = useCallback(
    (key: OfcConnectionSortableKeys) => {
      if (!enableClientSorting) {
        console.warn(
          'Client-side sorting is disabled. Use server-side orderBy/orderDir props instead.'
        );
        return;
      }
      handleSort(key);
    },
    [enableClientSorting, handleSort]
  );

  // Mutation for creating new connections (unchanged)
  const { mutateAsync: createConnections } = useMutation({
    mutationFn: async (newConnections: OfcConnection[]) => {
      const { data, error } = await supabase
        .from('ofc_connections')
        .insert(newConnections);
      if (error) throw error;
      return data;
    },
    onSuccess: () => {
      // Invalidate and refetch the connections query after successful insertion
      queryClient.invalidateQueries({ queryKey: ['ofc_connections'] });
      refetchOfcConnections();
    },
  });

  // createMissingConnections (unchanged)
  const createMissingConnections = useCallback(async (): Promise<void> => {
    if (!cable || !cable[0]) return;

    // Get fresh connection count to avoid stale data
    const { data: currentConnections, error } = await supabase
      .from('ofc_connections')
      .select('id')
      .eq('ofc_id', cableId);

    if (error) {
      console.error('Failed to fetch current connections:', error);
      throw error;
    }

    const currentConnectionCount = currentConnections?.length || 0;
    const cableCapacity = cable[0].capacity as number;
    const missingCount = cableCapacity - currentConnectionCount;

    if (missingCount <= 0) {
      console.log('No missing connections to create');
      return;
    }

    // Create an array of new connections to insert
    const newConnections = Array.from({ length: missingCount }, (_, index) => {
      const connection: OfcConnection = {
        ofc_id: cableId,
        fiber_no_sn: currentConnectionCount + index + 1,
        connection_type: 'straight', // Or a default value
        connection_category: 'OFC_JOINT_TYPES', // Or a default value
        status: true,
        // --- All optional fields are explicitly set to null for clarity ---
        system_id: null, // <-- The only missing field, now added
        destination_port: null,
        source_port: null,
        en_dom: null,
        en_power_dbm: null,
        fiber_no_en: null,
        logical_path_id: null,
        otdr_distance_en_km: null,
        otdr_distance_sn_km: null,
        path_segment_order: null,
        remark: null,
        route_loss_db: null,
        sn_dom: null,
        sn_power_dbm: null,
        // created_at and updated_at are best handled by the database itself
      };
      return connection;
    });

    try {
      console.log(`Creating ${newConnections.length} new connections`);
      await createConnections(newConnections);
    } catch (error) {
      console.error('Failed to create connections:', error);
      throw error;
    }
  }, [cable, cableId, createConnections, supabase]);

  // ensureConnectionsExist (unchanged)
  const ensureConnectionsExist = useCallback(async (): Promise<void> => {
    if (isLoadingCable || isLoadingOfcConnections) {
      console.log('Still loading data, skipping connection creation');
      return;
    }

    try {
      await createMissingConnections();
    } catch (error) {
      console.error('Error ensuring connections exist:', error);
      throw error;
    }
  }, [isLoadingCable, isLoadingOfcConnections, createMissingConnections]);

  return {
    // EXISTING API (unchanged)
    cable: cable?.[0],
    existingConnections, // Now optionally client-sorted, but maintains same structure
    isLoading: isLoadingCable || isLoadingOfcConnections,
    ensureConnectionsExist,
    createMissingConnections,
    totalCount,
    activeCount,
    inactiveCount,

    // NEW: Optional sorting enhancements (only available if enableClientSorting is true)
    ...(enableClientSorting && {
      sortConfig,
      handleSortColumn,
      resetSort,
      isSorted,
      getSortDirection,
      isClientSorting: true,
    }),
  };
};

```

<!-- path: hnvtx/hooks/useCurrentTableName.ts -->
```typescript
// hooks/useCurrentTableName.ts
import { usePathname } from "next/navigation";
import { useMemo } from "react";
import { TableNames } from "@/config/helper-types";

export const useCurrentTableName = (tableName?: TableNames): TableNames | null => {
  const pathname = usePathname();

  return useMemo(() => {
    if (tableName) return tableName;

    const path = pathname || "";
    const segments = path.split("/").filter(Boolean); // Remove empty segments

    // Look for the dashboard segment and get the next segment as the route
    const dashboardIndex = segments.findIndex((segment) => segment === "dashboard");
    if (dashboardIndex === -1 || dashboardIndex >= segments.length - 1) {
      return null;
    }

    const routeSegment = segments[dashboardIndex + 1];

    // Map route segments to table names
    switch (routeSegment) {
      case "users":
        return "user_profiles";
      case "employees":
        return "employees";
      case "categories":
        return "lookup_types";
      case "designations":
        return "employee_designations";
      case "rings":
        return "rings";
      case "maintenance-areas":
        return "maintenance_areas";
      case "lookup":
        return "lookup_types";
      case "ofc":
        // Check if there's a third segment (ID) after ofc
        const hasId = segments.length > dashboardIndex + 2 && segments[dashboardIndex + 2];
        return hasId ? "ofc_connections" : "ofc_cables";
      case "ofc_connections":
        return "ofc_connections";
      case "nodes":
        return "nodes";
      case "systems":
        return "systems";
      case "cpan":
        return "cpan_systems";
      case "cpan_connections":
        return "cpan_connections";
      case "fiber-joints":
        return "fiber_joints";
      case "fiber-joint-connections":
        return "fiber_joint_connections";
      case "logical-fiber-paths":
        return "logical_fiber_paths";
      case "maan":
        return "maan_systems";
      case "maan_connections":
        return "maan_connections";
      case "management-ports":
        return "management_ports";
      case "sdh":
        return "sdh_systems";
      case "sdh_connections":
        return "sdh_connections";
      case "sdh_node_associations":
        return "sdh_node_associations";
      case "system-connections":
        return "system_connections";
      case "user-activity-logs":
        return "user_activity_logs";
      case "vmux":
        return "vmux_systems";
      case "vmux_connections":
        return "vmux_connections";
      default:
        return null;
    }
  }, [tableName, pathname]);
};

```

<!-- path: hnvtx/hooks/useColumnConfig.tsx -->
```typescript
import { useMemo, ReactNode, useEffect } from 'react';
import { TABLE_COLUMN_KEYS } from '@/config/table-column-keys';
import { Column } from '@/hooks/database/excel-queries/excel-helpers';
import { GenericRow, TableOrViewName } from '@/config/helper-types';
// import { inferColumnWidth } from "@/config/column-width";
import {
  inferDynamicColumnWidth,
  inferExcelFormat,
  toTitleCase,
} from '@/config/helper-functions';

/**
 * This is the final, compatible Column Configuration type.
 * It is generic and includes all properties from your `Column<T>` interface.
 */
export interface ColumnConfig<T extends TableOrViewName> {
  /** The unique, type-safe column name. Used as the React key. */
  key: keyof GenericRow<T> & string;
  /** The human-readable title for the column header. */
  title: string;
  /** The key for accessing data from a row object. We set it to be the same as `key`. */
  dataIndex: keyof GenericRow<T> & string;
  /** Optional: The data format for Excel exports. */
  excelFormat?: 'text' | 'number' | 'date' | 'currency' | 'percentage' | 'json';
  /** Optional: Flag to hide the column in the UI. */
  hidden?: boolean;
  /** Optional: Column width for UI tables. Use "auto" to fit content width. */
  width?: number | string;
  /** Optional: Allow sorting on this column. */
  sortable?: boolean;
  /** Optional: Allow searching on this column. */
  searchable?: boolean;
  /** Optional: Allow filtering on this column. */
  filterable?: boolean;
  /** Optional: A custom render function for the cell. */
  render?: (value: unknown, record: GenericRow<T>, index: number) => ReactNode;
  // ... and any other properties from your master Column<T> type.
  resizable?: boolean;
}

type ColumnOverrides<T extends TableOrViewName> = {
  // [K in keyof GenericRow<T>]?: Partial<
  //   Omit<Column<GenericRow<T>>, 'key' | 'dataIndex'>
  // >;
  [K in keyof GenericRow<T>]?: Partial<ColumnConfig<T>>;
};

interface UseDynamicColumnConfigOptions<T extends TableOrViewName> {
  overrides?: ColumnOverrides<T>;
  omit?: (keyof GenericRow<T> & string)[];
  data?: GenericRow<T>[];
}

/**
 * A hook that dynamically generates a detailed and type-safe column configuration array
 * that is fully compatible with the application's standard `Column<T>` interface.
 */
// FIX: The hook is now fully generic for tables and views.
export function useDynamicColumnConfig<T extends TableOrViewName>(
  tableName: T,
  options: UseDynamicColumnConfigOptions<T> = {}
): Column<GenericRow<T>>[] {
  const { overrides = {}, omit = [], data = [] } = options;

  const dateColumns = useMemo(
    () =>
      new Set([
        'date_of_birth',
        'last_sign_in_at',
        'created_at',
        'updated_at',
        'auth_updated_at',
        'email_confirmed_at',
        'phone_confirmed_at',
      ]),
    []
  ); // Memoize once

  // generate column widths dynamically
  const columnWidths = useMemo(() => {
    const widths: Record<string, number> = {};
    if (data.length > 0) {
      for (const colName of Object.keys(data[0] || {})) {
        widths[colName] = dateColumns.has(colName)
          ? 120
          : inferDynamicColumnWidth(colName, data);
      }
    }
    return widths;
  }, [data, dateColumns]);

  const columns = useMemo(() => {
    const keysToUse = TABLE_COLUMN_KEYS[tableName] as
      | (keyof GenericRow<T> & string)[]
      | undefined;

    if (!keysToUse) {
      console.warn(`No column keys found for table/view: ${tableName}`);
      return [];
    }

    const omitSet = new Set(omit);

    return (keysToUse as (keyof GenericRow<T> & string)[])
      .filter((key) => !omitSet.has(key))
      .map((key) => {
        const columnOverride =
          (key in overrides ? overrides[key as keyof typeof overrides] : {}) ||
          {};
        // console.log(key + ":" + columnWidths?.[key]);
        const defaultConfig: Column<GenericRow<T>> = {
          title: toTitleCase(key),
          dataIndex: key,
          key: key,
          excelFormat: inferExcelFormat(key),
          width: columnWidths?.[key],
        };

        return { ...defaultConfig, ...columnOverride };
      });
  }, [tableName, overrides, omit, columnWidths]);

  const columnsKeys = columns.map((col) => col.key);

  useEffect(() => {
    console.log(`columns for ${tableName}`, columnsKeys);
  // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  return columns;
}

```

<!-- path: hnvtx/hooks/defaultUploadConfigs.ts -->
```typescript
import { TableNames } from "@/config/helper-types";
import { buildUploadConfig, TABLES } from "@/config/table-column-keys";

// Thin adapter: build per-table upload config from SSOT
const defaultUploadConfigs = () => {
  const result: Partial<
    Record<TableNames, ReturnType<typeof buildUploadConfig<TableNames>>>
  > = {};

  (Object.keys(TABLES) as TableNames[]).forEach((tableName) => {
    result[tableName] = buildUploadConfig(tableName);
  });

  return result as Record<
    TableNames,
    ReturnType<typeof buildUploadConfig<TableNames>>
  >;
};

export default defaultUploadConfigs;

```

<!-- path: hnvtx/hooks/useDelete.ts -->
```typescript
import { useState } from "react";
import { useTableDelete } from "@/hooks/database";
import { createClient } from "@/utils/supabase/client";
import { TableName } from "@/hooks/database";

export const useDelete = ({ tableName, onSuccess }: { tableName: TableName; onSuccess?: () => void }) => {
  const supabase = createClient();
  const [itemToDelete, setItemToDelete] = useState<{ id: string; name: string } | null>(null);

  const { mutate: deleteMutation, isPending } = useTableDelete(supabase, tableName as TableName, {
    onSuccess: () => {
      onSuccess?.();
      setItemToDelete(null);
    },
  });

  const deleteSingle = (item: { id: string; name: string }) => {
    setItemToDelete(item);
  };

  const handleConfirm = () => {
    if (itemToDelete) {
      deleteMutation(itemToDelete.id);
    }
  };

  const handleCancel = () => {
    setItemToDelete(null);
  };

  return {
    isConfirmModalOpen: itemToDelete !== null,
    isPending,
    itemToDelete,
    confirmationMessage: `Are you sure you want to delete "${itemToDelete?.name}"? This action cannot be undone.`,
    deleteSingle,
    handleConfirm,
    handleCancel,
  };
};
```

<!-- path: hnvtx/hooks/useIsMobile.tsx -->
```typescript
// hooks/useIsMobile.tsx
import { useState, useEffect } from 'react';

const useIsMobile = (breakpoint = 768) => {
  const [isMobile, setIsMobile] = useState(false);

  useEffect(() => {
    const checkDevice = () => {
      // Check screen width
      const isSmallScreen = window.innerWidth < breakpoint;
      
      // Check user agent for mobile indicators
      const userAgent = navigator.userAgent.toLowerCase();
      const mobileKeywords = [
        'mobile', 'android', 'iphone', 'ipad', 'ipod', 
        'blackberry', 'windows phone', 'opera mini'
      ];
      const isMobileAgent = mobileKeywords.some(keyword => 
        userAgent.includes(keyword)
      );
      
      // Check for touch capability
      const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
      
      // Combine all checks - prioritize screen size but consider other factors
      const mobile = isSmallScreen || (isMobileAgent && hasTouch);
      
      setIsMobile(mobile);
    };

    // Initial check
    checkDevice();

    // Listen for resize events
    window.addEventListener('resize', checkDevice);
    
    // Listen for orientation changes (mobile specific)
    window.addEventListener('orientationchange', checkDevice);

    // Cleanup
    return () => {
      window.removeEventListener('resize', checkDevice);
      window.removeEventListener('orientationchange', checkDevice);
    };
  }, [breakpoint]);

  return isMobile;
};

export default useIsMobile;

// Usage examples:
// const isMobile = useIsMobile(); // Uses default 768px breakpoint
// const isMobile = useIsMobile(1024); // Custom breakpoint
// const isMobile = useIsMobile(480); // Smaller breakpoint for strict mobile-only
```

<!-- path: hnvtx/package.json -->
```json
{
  "name": "hnvtx",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev --turbopack",
    "cleandev": "rm -rf .next node_modules && npm install && next dev --turbopack",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "gitpush": "git add . && git commit -m \"$(date +'%Y-%m-%d %H:%M:%S')\" && git push",
    "find-unused": "node data/scripts/find-unused-files.js",
    "supabase": "supabase",
    "gen:types": "supabase gen types typescript --project-id yunvefyvwbqaigkawcvj --schema public,auth > types/supabase-types.ts",
    "push:all": "dotenv -e .env node data/scripts/push-sql.js",
    "push:folder": "dotenv -e .env node data/scripts/push-sql.js",
    "debug:script": "dotenv -e .env node data/scripts/debug-connection.js"
  },
  "dependencies": {
    "@hookform/resolvers": "^5.2.1",
    "@radix-ui/react-select": "^2.2.6",
    "@supabase/ssr": "^0.6.1",
    "@supabase/supabase-js": "^2.56.0",
    "@tanstack/react-query": "^5.85.5",
    "@tanstack/react-query-devtools": "^5.85.1",
    "@types/bcrypt": "^6.0.0",
    "@types/pg": "^8.15.5",
    "@uppy/core": "^5.0.1",
    "@uppy/dashboard": "^5.0.1",
    "@uppy/drag-drop": "^5.0.1",
    "@uppy/react": "^5.0.2",
    "@uppy/webcam": "^5.0.0",
    "@uppy/xhr-upload": "^5.0.0",
    "bcrypt": "^6.0.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "core-js": "^3.45.0",
    "exceljs": "^4.4.0",
    "framer-motion": "^12.23.12",
    "intersection-observer": "^0.12.2",
    "lodash.isequal": "^4.5.0",
    "lucide-react": "^0.541.0",
    "next": "^15.4.4",
    "papaparse": "^5.5.3",
    "pg": "^8.16.3",
    "react": "^19.1.0",
    "react-datepicker": "^8.7.0",
    "react-dom": "^19.1.0",
    "react-hook-form": "^7.62.0",
    "react-icons": "^5.5.0",
    "react-select": "^5.10.2",
    "regenerator-runtime": "^0.14.1",
    "sonner": "^2.0.7",
    "tailwind-merge": "^3.3.1",
    "url-polyfill": "^1.1.13",
    "use-debounce": "^10.0.5",
    "web-push": "^3.6.7",
    "whatwg-fetch": "^3.6.20",
    "xlsx": "^0.18.5",
    "zod": "^4.1.5",
    "zustand": "^5.0.7"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3.3.1",
    "@tailwindcss/postcss": "^4.1.11",
    "@tanstack/eslint-plugin-query": "^5.83.1",
    "@types/lodash": "^4.17.20",
    "@types/lodash.isequal": "^4.5.8",
    "@types/node": "^20.19.11",
    "@types/papaparse": "^5.3.16",
    "@types/react": "^19.1.10",
    "@types/react-dom": "^19.1.7",
    "@types/uuid": "^10.0.0",
    "@types/web-push": "^3.6.4",
    "dotenv-cli": "^10.0.0",
    "eslint": "^9.33.0",
    "eslint-config-next": "^15.4.4",
    "prism-react-renderer": "^2.4.1",
    "supabase": "^2.39.2",
    "tailwindcss": "^4.1.11",
    "tw-animate-css": "^1.3.7",
    "typescript": "^5.9.2"
  }
}

```

<!-- path: hnvtx/next.config.ts -->
```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'lh3.googleusercontent.com',
      },
      {
        protocol: 'https',
        hostname: 'example.com',
      },
      {
        protocol: 'https',
        hostname: 'gravatar.com',
      },
      {
        protocol: 'https',
        hostname: 'res.cloudinary.com',
      },
      {
        protocol: 'https',
        hostname: 'images.unsplash.com',
      },
      {
        protocol: 'https',
        hostname: 'cdn.pixabay.com',
      },
    ],
  },
};

export default nextConfig;

```

<!-- path: hnvtx/eslint.config.mjs -->
```mjs
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
];


export default eslintConfig;

```

<!-- path: hnvtx/stores/themeStore.ts -->
```typescript
import { create } from "zustand";

export type Theme = "light" | "dark" | "system";

interface ThemeState {
  theme: Theme;
  setTheme: (theme: Theme) => void;
  hydrated: boolean;
  setHydrated: (hydrated: boolean) => void;
}

export const useThemeStore = create<ThemeState>()((set, get) => ({
  // NEVER access localStorage in initial state - always use default
  theme: "system", // Default value, no localStorage access
  hydrated: false,

  setTheme: (newTheme: Theme) => {
    set({ theme: newTheme });
    // Only access localStorage in actions (client-side)
    if (typeof window !== "undefined") {
      try {
        localStorage.setItem("theme-storage", newTheme);
      } catch (error) {
        console.warn("Failed to save theme:", error);
      }
    }
  },

  setHydrated: (hydrated: boolean) => set({ hydrated }),
}));

// Client-side hydration function
export const hydrateThemeStore = () => {
  if (typeof window === "undefined") return;

  try {
    const storedTheme = localStorage.getItem("theme-storage");
    if (storedTheme && ["light", "dark", "system"].includes(storedTheme)) {
      useThemeStore.setState({
        theme: storedTheme as Theme,
        hydrated: true,
      });
    } else {
      useThemeStore.setState({ hydrated: true });
    }
  } catch (error) {
    console.warn("Failed to load theme:", error);
    useThemeStore.setState({ hydrated: true });
  }
};
```

<!-- path: hnvtx/stores/useUploadConfigStore.ts -->
```typescript
// src/stores/useUploadConfigStore.ts

import { create } from "zustand";
import { devtools, persist } from "zustand/middleware";
import { TableNames } from "@/config/helper-types";
import { Tables } from "@/types/supabase-types";

export interface UploadColumnMapping<T extends TableNames> {
  excelHeader: string;
  dbKey: keyof Tables<T> & string;
  transform?: (value: unknown) => unknown;
}

export interface UploadConfig<T extends TableNames> {
  tableName: T;
  columnMapping: UploadColumnMapping<T>[];
  uploadType: "insert" | "upsert";
  conflictColumn?: keyof Tables<T> & string;
  isUploadEnabled: boolean;
}

interface UploadConfigState {
  configs: Record<string, UploadConfig<TableNames>>;
  setUploadConfig: <T extends TableNames>(pageKey: string, config: UploadConfig<T>) => void;
  getUploadConfig: (pageKey: string) => UploadConfig<TableNames> | undefined;
  clearUploadConfig: (pageKey: string) => void;
}

export const useUploadConfigStore = create<UploadConfigState>()(
  persist( // `persist` should be the outer wrapper
    devtools( // `devtools` should be the inner wrapper
      (set, get) => ({
        // The store's state is a dictionary of configurations.
        configs: {},

        setUploadConfig: (pageKey, config) => {
          if (config?.uploadType === "upsert" && !config.conflictColumn) {
            console.error(`UploadConfig Error...`);
          }
          set((state) => ({
            configs: {
              ...state.configs,
              [pageKey]: config,
            },
          }));
        },

        getUploadConfig: (pageKey) => {
          return get().configs[pageKey];
        },

        clearUploadConfig: (pageKey) => {
          set((state) => {
            const newConfigs = { ...state.configs };
            delete newConfigs[pageKey];
            return { configs: newConfigs };
          });
        },
      }),
      // The options object for devtools
      {
        name: "UploadConfigStore",
      }
    ),
    // The options object for persist
    {
      name: "upload-config-storage", // Use a different key for localStorage
    }
  )
);
```

<!-- path: hnvtx/stores/authStore.ts -->
```typescript
// stores/authStore.ts
import { create } from "zustand";
import { devtools, persist } from "zustand/middleware";
import { User } from "@supabase/supabase-js";

export type AuthState = "loading" | "authenticated" | "unauthenticated";

interface AuthStore {
  // Auth State
  user: User | null;
  authState: AuthState;

  // Actions
  setUser: (user: User | null) => void;
  setAuthState: (state: AuthState) => void;
  logout: () => void;

  // Async action wrapper to handle loading states
  executeWithLoading: <T>(action: () => Promise<T>) => Promise<T>;

  // Getters
  isLoading: () => boolean;
  isAuthenticated: () => boolean;
  getUserId: () => string | null;
}

export const useAuthStore = create<AuthStore>()(
  persist(
    devtools(
      (set, get) => ({
        // Initial State
        user: null,
        authState: "loading",

        // Actions
        setUser: (user) => {
          // Only update if the user has actually changed
          const currentUser = get().user;
          if (user?.id !== currentUser?.id) {
            set({
              user,
              authState: user ? "authenticated" : "unauthenticated",
            });
          }
        },

        setAuthState: (newAuthState) => {
          // Only update if the state has actually changed
          if (get().authState !== newAuthState) {
            set({ authState: newAuthState });
          }
        },

        logout: () => {
          set({
            user: null,
            authState: "unauthenticated",
          });
        },

        // Fixed async action wrapper
        executeWithLoading: async <T>(action: () => Promise<T>): Promise<T> => {
          const currentState = get().authState;
          const currentUser = get().user;

          // Only set loading if not already in a loading state
          if (currentState !== "loading") {
            set({ authState: "loading" });
          }

          try {
            const result = await action();
            
            // Get the latest state after action completes
            const { authState: latestState, user: latestUser } = get();
            
            // Only update state if still in loading state and we have a definitive state
            if (latestState === "loading") {
              // If user exists, we're authenticated, otherwise unauthenticated
              const newState = latestUser ? "authenticated" : "unauthenticated";
              if (newState !== currentState) {
                set({ authState: newState });
              }
            }

            return result;
          } catch (error) {
            // On error, reset to appropriate state based on current user
            const { user } = get();
            const newState = user ? "authenticated" : "unauthenticated";
            if (newState !== currentState) {
              set({ authState: newState });
            }
            throw error;
          }
        },

        // Getters
        isLoading: () => {
          return get().authState === "loading";
        },

        isAuthenticated: () => {
          const { user, authState } = get();
          return user !== null && authState === "authenticated";
        },

        getUserId: () => {
          const { user } = get();
          return user?.id || null;
        },
      }),
      {
        name: "AuthenticationStore",
      }
    ),
    {
      name: "auth-store",
      partialize: (state) => ({
        user: state.user,
        authState: state.authState,
      }),
    }
  )
);

```

<!-- path: hnvtx/next-env.d.ts -->
```typescript
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.

```

<!-- path: hnvtx/README.md -->
```markdown
## How to push sql creation on supabase

First, Install Supabase CLI locally:

```bash
npm install supabase dotenv-cli --save-dev
```

## Use individual environment variables

```sh
PGHOST=db.yunvefyvwbqaigkawcvj.supabase.co
PGPORT=5432
PGDATABASE=postgres
PGUSER=postgres
PGPASSWORD=your_password_here
```

## Add the recursive push script in your project

### data/scripts/debug-connection.js

```js
#!/usr/bin/env node
/**
 * Debug PostgreSQL connection
 */

console.log('🔍 Debugging PostgreSQL connection...');

const dbUrl = process.env.SUPABASE_DB_URL;
const pgVars = {
  PGHOST: process.env.PGHOST,
  PGPORT: process.env.PGPORT,
  PGDATABASE: process.env.PGDATABASE,
  PGUSER: process.env.PGUSER,
  PGPASSWORD: process.env.PGPASSWORD ? '****' : undefined
};

console.log('\n📋 Environment Variables:');
console.log('SUPABASE_DB_URL:', dbUrl ? 'SET' : 'NOT SET');
console.log('PG Variables:', pgVars);

if (!dbUrl && !pgVars.PGHOST) {
  console.log('\n❌ No database connection configured!');
  console.log('\n💡 You need to set either:');
  console.log('Option 1 - SUPABASE_DB_URL in your .env:');
  console.log('SUPABASE_DB_URL=postgresql://postgres:password@db.yunvefyvwbqaigkawcvj.supabase.co:5432/postgres');
  console.log('\nOption 2 - Individual PG variables in your .env:');
  console.log('PGHOST=db.yunvefyvwbqaigkawcvj.supabase.co');
  console.log('PGPORT=5432');
  console.log('PGDATABASE=postgres');
  console.log('PGUSER=postgres');
  console.log('PGPASSWORD=your_password_here');
  process.exit(1);
}

// Test connection
const { execSync } = require('child_process');

try {
  console.log('\n🧪 Testing connection...');
  
  if (dbUrl) {
    console.log('Using SUPABASE_DB_URL...');
    const url = new URL(dbUrl.trim());
    const env = {
      ...process.env,
      PGHOST: url.hostname,
      PGPORT: url.port || '5432',
      PGDATABASE: url.pathname.slice(1) || 'postgres',
      PGUSER: url.username,
      PGPASSWORD: url.password
    };
    
    execSync('psql -c "SELECT version();"', {
      stdio: 'inherit',
      env: env
    });
  } else {
    console.log('Using PG environment variables...');
    execSync('psql -c "SELECT version();"', {
      stdio: 'inherit'
    });
  }
  
  console.log('✅ Connection successful!');
  
} catch (err) {
  console.error('\n❌ Connection failed:', err.message);
  console.log('\n💡 Troubleshooting steps:');
  console.log('1. Verify your database credentials');
  console.log('2. Check if psql is installed: psql --version');
  console.log('3. Try connecting manually: psql -h your_host -U your_user -d your_database');
  console.log('4. Check if your IP is whitelisted in Supabase dashboard');
}
```

### data/scripts/push-sql.js

```js
#!/usr/bin/env node
/**
 * Push all .sql files from a folder (recursively) to PostgreSQL using existing PG environment variables.
 */

const { execSync } = require('child_process');
const fs = require('fs');
const path = require('path');

// Arguments
const folder = process.argv[2];
if (!folder) {
  console.error('❌ Please provide a folder path, e.g. npm run push:folder 11_user_management');
  process.exit(1);
}

const baseFolder = path.join('data', 'telecom_network_db', folder);
if (!fs.existsSync(baseFolder)) {
  console.error(`❌ Folder not found: ${baseFolder}`);
  process.exit(1);
}

// Check for database connection info
const dbUrl = process.env.SUPABASE_DB_URL;
const pgHost = process.env.PGHOST;
const pgUser = process.env.PGUSER;
const pgPassword = process.env.PGPASSWORD;
const pgDatabase = process.env.PGDATABASE;
const pgPort = process.env.PGPORT;

if (!dbUrl && !pgHost) {
  console.error('❌ Database connection not configured. Set either:');
  console.error('   SUPABASE_DB_URL=postgresql://user:pass@host:port/database');
  console.error('   OR individual PG variables: PGHOST, PGUSER, PGPASSWORD, etc.');
  process.exit(1);
}

console.log(`📂 Running folder: ${folder}`);

if (dbUrl) {
  console.log(`🔗 Using SUPABASE_DB_URL`);
} else {
  console.log(`🔗 Using PG variables: ${pgUser}@${pgHost}:${pgPort || 5432}/${pgDatabase || 'postgres'}`);
}

function runFolder(dir) {
  const items = fs.readdirSync(dir);
  items.forEach(item => {
    const fullPath = path.join(dir, item);
    const stat = fs.statSync(fullPath);

    if (stat.isDirectory()) {
      runFolder(fullPath); // recurse into subfolders
    } else if (item.endsWith('.sql')) {
      console.log(`   ▶ Running: ${fullPath}`);
      try {
        let command;
        let env = { ...process.env };

        if (dbUrl) {
          // Use connection URL
          const url = new URL(dbUrl.trim());
          env.PGHOST = url.hostname;
          env.PGPORT = url.port || '5432';
          env.PGDATABASE = url.pathname.slice(1) || 'postgres';
          env.PGUSER = url.username;
          env.PGPASSWORD = url.password;
        }
        // If using PG vars, they're already in process.env

        command = `psql -f "${fullPath}"`;
        
        execSync(command, {
          stdio: 'inherit',
          env: env
        });
        
      } catch (err) {
        console.error(`❌ Failed: ${fullPath}`);
        console.error(`Error: ${err.message}`);
        console.error('💡 Check your database connection settings');
        process.exit(1);
      }
    }
  });
}

runFolder(baseFolder);
console.log('✅ All scripts executed successfully.');
```

## In package.json:

```json
"scripts": {
    "supabase": "supabase",
    "push:all": "dotenv -e .env node data/scripts/push-sql.js",
    "push:folder": "dotenv -e .env node data/scripts/push-sql.js",
    "debug:script": "dotenv -e .env node data/scripts/debug-connection.js"
}
```

## Check connection

```sh
npm run debug:script
```

## run script

```sh
npm run push:folder folder_name
```
```

<!-- path: hnvtx/components.json -->
```json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "app/globals.css",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
```

<!-- path: hnvtx/utils/index.ts -->
```typescript
// Core utilities
export { cn } from './classNames';
export { default as formatters } from './formatters';
export { default as validation } from './validationUtils';
export * from './caseConverter';

// Supabase
export { createClient } from './supabase/server';
export { createClient as createBrowserClient } from './supabase/client';

```

<!-- path: hnvtx/utils/classNames.tsx -->
```typescript
import clsx from 'clsx';
import { twMerge } from 'tailwind-merge';

interface CnFunction {
    (...args: Parameters<typeof clsx>): string;
}

export const cn: CnFunction = (...args) => {
    return twMerge(clsx(...args));
};
```

<!-- path: hnvtx/utils/renderKeyValueCell.tsx -->
```typescript
import React, { JSX } from "react";

export function renderKeyValueCell(value: unknown): JSX.Element {
  let elements: JSX.Element[] = [];

  if (value) {
    try {
      const parsedValue = typeof value === "string" ? JSON.parse(value) : value;

      if (typeof parsedValue === "object" && parsedValue !== null) {
        elements = Object.entries(parsedValue)
          .filter(([_, val]) => val !== null && val !== undefined && val !== "")
          .map(([key, val]) => (
            <div key={key} className='flex text-sm text-gray-500'>
              <span className='font-medium mr-1'>{key}:</span>
              <span>{String(val)}</span>
            </div>
          ));
      } else {
        elements = [
          <div key='single' className='text-sm text-gray-500'>
            {String(parsedValue)}
          </div>,
        ];
      }
    } catch (error) {
      elements = [
        <div key='error' className='text-sm text-gray-500'>
          {String(value)}
        </div>,
      ];
    }
  }

  return elements.length > 0 ? <div className='text-sm text-gray-500'>{elements}</div> : <div className='text-sm text-gray-500'>N/A</div>;
}

```

<!-- path: hnvtx/utils/caseConverter.ts -->
```typescript
/**
 * Type-safe case conversion utilities for JavaScript objects
 * Supports deep nested objects and arrays with proper TypeScript inference
 */

// === TYPE DEFINITIONS ===

/**
 * Primitive values that don't need transformation
 * Note: Functions are treated as primitives and returned as-is
 */
type Primitive = string | number | boolean | null | undefined | Date | RegExp;

/**
 * Check if a value is a plain object (not Date, Array, etc.)
 */
type IsPlainObject<T> = T extends Primitive
  ? false
  : T extends readonly unknown[]
  ? false
  : T extends Record<string, unknown>
  ? true
  : false;

/**
 * Transform object keys while preserving type structure
 */
type TransformKeys<T, U extends string> = T extends Primitive
  ? T
  : T extends readonly (infer Item)[]
  ? readonly TransformKeys<Item, U>[]
  : IsPlainObject<T> extends true
  ? {
      [K in keyof T as K extends string ? U : K]: TransformKeys<T[K], U>
    }
  : T;

// Case transformation type mappings
type CamelCase<S extends string> = S extends `${infer P1}_${infer P2}`
  ? `${P1}${Capitalize<CamelCase<P2>>}`
  : S;

type SnakeCase<S extends string> = S extends `${infer C}${infer T}`
  ? C extends Lowercase<C>
    ? `${C}${SnakeCase<T>}`
    : `_${Lowercase<C>}${SnakeCase<T>}`
  : S;

type KebabCase<S extends string> = S extends `${infer C}${infer T}`
  ? C extends Lowercase<C>
    ? `${C}${KebabCase<T>}`
    : `-${Lowercase<C>}${KebabCase<T>}`
  : S;

type PascalCase<S extends string> = Capitalize<CamelCase<S>>;

type ScreamingSnakeCase<S extends string> = Uppercase<
  S extends `${infer C}${infer T}`
    ? C extends Lowercase<C>
      ? `${C}${ScreamingSnakeCase<T>}`
      : `_${Lowercase<C>}${ScreamingSnakeCase<T>}`
    : S
>;

// === UTILITY FUNCTIONS ===

/**
 * Type guard to check if a value is a plain object
 */
function isPlainObject(value: unknown): value is Record<string, unknown> {
  return (
    value !== null &&
    typeof value === 'object' &&
    !Array.isArray(value) &&
    !(value instanceof Date) &&
    !(value instanceof RegExp) &&
    typeof value !== 'function'
  );
}

/**
 * Type guard to check if a value is primitive
 */
function isPrimitive(value: unknown): value is Primitive {
  return (
    value === null ||
    value === undefined ||
    typeof value === 'string' ||
    typeof value === 'number' ||
    typeof value === 'boolean' ||
    value instanceof Date ||
    value instanceof RegExp ||
    typeof value === 'function'
  );
}

// === KEY TRANSFORMATION FUNCTIONS ===

/**
 * Convert string to camelCase
 */
function toCamelCaseKey(key: string): string {
  return key.replace(/_([a-z])/g, (_, letter: string) => letter.toUpperCase());
}

/**
 * Convert string to snake_case
 */
function toSnakeCaseKey(key: string): string {
  return key.replace(/[A-Z]/g, (letter: string) => `_${letter.toLowerCase()}`);
}

/**
 * Convert string to PascalCase
 */
function toPascalCaseKey(key: string): string {
  const camelKey = toCamelCaseKey(key);
  return camelKey.charAt(0).toUpperCase() + camelKey.slice(1);
}

/**
 * Convert string to kebab-case
 */
function toKebabCaseKey(key: string): string {
  return key
    .replace(/([a-z0-9])([A-Z])/g, '$1-$2')
    .replace(/_/g, '-')
    .toLowerCase();
}

/**
 * Convert string to SCREAMING_SNAKE_CASE
 */
function toScreamingSnakeCaseKey(key: string): string {
  return key
    .replace(/([a-z0-9])([A-Z])/g, '$1_$2')
    .replace(/-/g, '_')
    .toUpperCase();
}

// === GENERIC CONVERTER FACTORY ===

/**
 * Key transformation function type
 */
type KeyTransformer = (key: string) => string;

/**
 * Creates a type-safe object converter function
 */
function createConverter<T extends KeyTransformer>(transformer: T) {
  function convert<TInput>(input: TInput): TransformKeys<TInput, string> {
    if (isPrimitive(input)) {
      return input as TransformKeys<TInput, string>;
    }

    if (Array.isArray(input)) {
      return input.map(convert) as TransformKeys<TInput, string>;
    }

    if (isPlainObject(input)) {
      const result: Record<string, unknown> = {};
      
      for (const [key, value] of Object.entries(input)) {
        const transformedKey = transformer(key);
        result[transformedKey] = convert(value);
      }
      
      return result as TransformKeys<TInput, string>;
    }

    return input as TransformKeys<TInput, string>;
  }

  return convert;
}

// === EXPORTED CONVERTERS ===

/**
 * Converts object keys to camelCase
 * 
 * @example
 * ```typescript
 * const input = { user_name: 'John', user_age: 30 };
 * const output = toCamelCase(input);
 * // Result: { userName: 'John', userAge: 30 }
 * ```
 */
export const toCamelCase = createConverter(toCamelCaseKey);

/**
 * Converts object keys to snake_case
 * 
 * @example
 * ```typescript
 * const input = { userName: 'John', userAge: 30 };
 * const output = toSnakeCase(input);
 * // Result: { user_name: 'John', user_age: 30 }
 * ```
 */
export const toSnakeCase = createConverter(toSnakeCaseKey);

/**
 * Converts object keys to PascalCase
 * 
 * @example
 * ```typescript
 * const input = { user_name: 'John', user_age: 30 };
 * const output = toPascalCase(input);
 * // Result: { UserName: 'John', UserAge: 30 }
 * ```
 */
export const toPascalCase = createConverter(toPascalCaseKey);

/**
 * Converts object keys to kebab-case
 * 
 * @example
 * ```typescript
 * const input = { userName: 'John', userAge: 30 };
 * const output = toKebabCase(input);
 * // Result: { 'user-name': 'John', 'user-age': 30 }
 * ```
 */
export const toKebabCase = createConverter(toKebabCaseKey);

/**
 * Converts object keys to SCREAMING_SNAKE_CASE
 * 
 * @example
 * ```typescript
 * const input = { userName: 'John', userAge: 30 };
 * const output = toScreamingSnakeCase(input);
 * // Result: { USER_NAME: 'John', USER_AGE: 30 }
 * ```
 */
export const toScreamingSnakeCase = createConverter(toScreamingSnakeCaseKey);

// === ADVANCED USAGE ===

/**
 * Creates a custom converter with a user-defined transformation function
 * 
 * @param transformer - Function that transforms a single key
 * @returns A converter function that applies the transformation recursively
 * 
 * @example
 * ```typescript
 * const addPrefix = createCustomConverter(key => `prefix_${key}`);
 * const input = { name: 'John', age: 30 };
 * const output = addPrefix(input);
 * // Result: { prefix_name: 'John', prefix_age: 30 }
 * ```
 */
export const createCustomConverter = createConverter;

// === TYPE EXPORTS FOR ADVANCED USAGE ===

export type {
  TransformKeys,
  KeyTransformer,
  CamelCase,
  SnakeCase,
  KebabCase,
  PascalCase,
  ScreamingSnakeCase,
  Primitive,
  IsPlainObject
};

// === USAGE EXAMPLES ===

/**
 * Example usage with Supabase or similar database libraries
 * 
 * @example
 * ```typescript
 * interface UserProfile {
 *   id: string;
 *   firstName: string;
 *   lastName: string;
 *   createdAt: Date;
 * }
 * 
 * // Converting from database (snake_case) to frontend (camelCase)
 * const { data } = await supabase.from('user_profiles').select('*');
 * const profiles: UserProfile[] = data?.map(toCamelCase) ?? [];
 * 
 * // Converting from frontend (camelCase) to database (snake_case)
 * const newProfile: Partial<UserProfile> = {
 *   firstName: 'John',
 *   lastName: 'Doe'
 * };
 * await supabase.from('user_profiles').insert(toSnakeCase(newProfile));
 * ```
 */

/**
 * Example with nested objects and arrays
 * 
 * @example
 * ```typescript
 * const complexData = {
 *   user_profile: {
 *     personal_info: {
 *       first_name: 'Jane',
 *       last_name: 'Smith'
 *     },
 *     contact_methods: [
 *       { method_type: 'email', contact_value: 'jane@example.com' },
 *       { method_type: 'phone', contact_value: '+1234567890' }
 *     ]
 *   },
 *   created_at: new Date(),
 *   is_active: true
 * };
 * 
 * const camelCaseData = toCamelCase(complexData);
 * // TypeScript knows the exact shape of the result!
 * // camelCaseData.userProfile.personalInfo.firstName is properly typed
 * ```
 */
```

<!-- path: hnvtx/utils/hashPassword.ts -->
```typescript
import bcrypt from "bcrypt";

export async function hashPassword(password: string) {
  const saltRounds = 10; // standard
  return await bcrypt.hash(password, saltRounds);
}

```

<!-- path: hnvtx/utils/formatters.ts -->
```typescript
/**
 * Professional data formatting utility library
 * Provides comprehensive formatting functions with optimizations and error handling
 */

// Types and interfaces
export interface NumberFormatOptions extends Intl.NumberFormatOptions {
  locale?: string;
}

export interface PhoneFormatOptions {
  format?: 'US' | 'international' | 'E164';
}

export interface ListFormatOptions {
  conjunction?: 'and' | 'or';
  style?: 'long' | 'short' | 'narrow';
  type?: 'conjunction' | 'disjunction' | 'unit';
}

export interface StringCaseOptions {
  preserveAcronyms?: boolean;
  delimiter?: string;
}

export interface ValidationError {
  field: string;
  message: string;
  code?: string;
}

// Performance optimizations - cached formatters
const formattersCache = new Map<string, Intl.NumberFormat | Intl.DateTimeFormat | Intl.ListFormat>();

// Overloaded function signatures for type safety
function getCachedFormatter(
  type: 'number',
  locale: string,
  options: Intl.NumberFormatOptions
): Intl.NumberFormat;
function getCachedFormatter(
  type: 'date',
  locale: string,
  options: Intl.DateTimeFormatOptions
): Intl.DateTimeFormat;
function getCachedFormatter(
  type: 'list',
  locale: string,
  options: Intl.ListFormatOptions
): Intl.ListFormat;
function getCachedFormatter(
  type: 'number' | 'date' | 'list',
  locale: string,
  options: Intl.NumberFormatOptions | Intl.DateTimeFormatOptions | Intl.ListFormatOptions
): Intl.NumberFormat | Intl.DateTimeFormat | Intl.ListFormat {
  const key = `${type}-${locale}-${JSON.stringify(options)}`;
  
  if (!formattersCache.has(key)) {
    let formatter: Intl.NumberFormat | Intl.DateTimeFormat | Intl.ListFormat;
    switch (type) {
      case 'number':
        formatter = new Intl.NumberFormat(locale, options as Intl.NumberFormatOptions);
        break;
      case 'date':
        formatter = new Intl.DateTimeFormat(locale, options as Intl.DateTimeFormatOptions);
        break;
      case 'list':
        formatter = new Intl.ListFormat(locale, options as Intl.ListFormatOptions);
        break;
      default:
        throw new Error(`Unsupported formatter type: ${type}`);
    }
    formattersCache.set(key, formatter);
  }
  
  return formattersCache.get(key)!;
}

// =============================================================================
// NUMBER FORMATTERS
// =============================================================================

/**
 * Format a number with locale-aware formatting
 */
export const formatNumber = (
  num: number,
  options: NumberFormatOptions = {}
): string => {
  if (!Number.isFinite(num)) {
    return num.toString();
  }

  const { locale = 'en-US', ...intlOptions } = options;
  const formatter = getCachedFormatter('number', locale, intlOptions);
  
  return formatter.format(num);
};

/**
 * Format a number as currency
 */
export const formatCurrency = (
  amount: number,
  currency: string = 'USD',
  locale: string = 'en-US',
  options: Intl.NumberFormatOptions = {}
): string => {
  return formatNumber(amount, {
    locale,
    style: 'currency',
    currency,
    ...options
  });
};

/**
 * Format a number as percentage
 */
export const formatPercentage = (
  value: number,
  decimals: number = 1,
  locale: string = 'en-US'
): string => {
  return formatNumber(value / 100, {
    locale,
    style: 'percent',
    minimumFractionDigits: decimals,
    maximumFractionDigits: decimals
  });
};

/**
 * Format a score with optional fraction display
 */
export const formatScore = (
  score: number,
  total: number,
  options: {
    showFraction?: boolean;
    decimals?: number;
    locale?: string;
  } = {}
): string => {
  const { showFraction = true, decimals = 1, locale = 'en-US' } = options;
  
  if (total <= 0) {
    return showFraction ? `${score}/0 (0%)` : '0%';
  }

  const percentage = (score / total) * 100;
  const formattedPercentage = formatPercentage(percentage, decimals, locale);
  
  return showFraction 
    ? `${formatNumber(score, { locale })}/${formatNumber(total, { locale })} (${formattedPercentage})`
    : formattedPercentage;
};

/**
 * Format file size in human-readable format
 */
export const formatFileSize = (
  bytes: number,
  options: {
    binary?: boolean;
    decimals?: number;
    locale?: string;
  } = {}
): string => {
  const { binary = false, decimals = 2, locale = 'en-US' } = options;
  
  if (bytes === 0) return '0 B';
  if (!Number.isFinite(bytes) || bytes < 0) return 'Invalid size';

  const base = binary ? 1024 : 1000;
  const sizes = binary 
    ? ['B', 'KiB', 'MiB', 'GiB', 'TiB', 'PiB'] 
    : ['B', 'KB', 'MB', 'GB', 'TB', 'PB'];
  
  const i = Math.floor(Math.log(bytes) / Math.log(base));
  const size = bytes / Math.pow(base, i);
  
  return `${formatNumber(size, { 
    locale,
    minimumFractionDigits: i === 0 ? 0 : decimals,
    maximumFractionDigits: i === 0 ? 0 : decimals
  })} ${sizes[i]}`;
};

// =============================================================================
// STRING FORMATTERS
// =============================================================================

/**
 * Convert string to title case with smart handling
 */
export const toTitleCase = (
  str: string,
  options: StringCaseOptions = {}
): string => {
  if (!str) return '';
  
  const { preserveAcronyms = true } = options;
  
  // Common words that should remain lowercase in titles
  const articles = new Set(['a', 'an', 'and', 'as', 'at', 'but', 'by', 'for', 'if', 'in', 'nor', 'of', 'on', 'or', 'so', 'the', 'to', 'up', 'yet']);
  
  return str
    .toLowerCase()
    .split(/\s+/)
    .map((word, index) => {
      // Always capitalize first and last word
      if (index === 0 || !articles.has(word)) {
        // Preserve acronyms if option is set
        if (preserveAcronyms && word.toUpperCase() === word && word.length <= 4) {
          return word.toUpperCase();
        }
        return word.charAt(0).toUpperCase() + word.slice(1);
      }
      return word;
    })
    .join(' ');
};

/**
 * Convert snake_case to Title Case
 */
export const snakeToTitleCase = (str: string): string => {
  if (!str) return '';
  
  return str
    .split('_')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
    .join(' ');
};

/**
 * Convert camelCase to kebab-case
 */
export const camelToKebab = (str: string): string => {
  if (!str) return '';
  
  return str
    .replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g, '$1-$2')
    .toLowerCase();
};

/**
 * Convert kebab-case to camelCase
 */
export const kebabToCamel = (str: string): string => {
  if (!str) return '';
  
  return str.replace(/-([a-z])/g, (_, letter) => letter.toUpperCase());
};

/**
 * Convert snake_case to camelCase
 */
export const snakeToCamel = (str: string): string => {
  if (!str) return '';
  
  return str.replace(/_([a-z])/g, (_, letter) => letter.toUpperCase());
};

/**
 * Convert camelCase to snake_case
 */
export const camelToSnake = (str: string): string => {
  if (!str) return '';
  
  return str.replace(/([A-Z])/g, '_$1').toLowerCase();
};

/**
 * Create URL-friendly slug from text
 */
export const createSlug = (
  text: string,
  options: {
    maxLength?: number;
    separator?: string;
    lowercase?: boolean;
  } = {}
): string => {
  const { maxLength = 50, separator = '-', lowercase = true } = options;
  
  if (!text) return '';
  
  let slug = text
    .trim()
    .replace(/[^\w\s-]/g, '') // Remove special characters
    .replace(/\s+/g, separator) // Replace spaces with separator
    .replace(new RegExp(`${separator}+`, 'g'), separator) // Replace multiple separators
    .replace(new RegExp(`^${separator}|${separator}$`, 'g'), ''); // Remove leading/trailing separators
  
  if (lowercase) {
    slug = slug.toLowerCase();
  }
  
  if (maxLength && slug.length > maxLength) {
    slug = slug.substring(0, maxLength).replace(new RegExp(`${separator}$`), '');
  }
  
  return slug;
};

/**
 * Truncate text with smart word boundaries
 */
export const truncateText = (
  text: string,
  maxLength: number,
  options: {
    suffix?: string;
    preserveWords?: boolean;
  } = {}
): string => {
  const { suffix = '...', preserveWords = true } = options;
  
  if (!text || text.length <= maxLength) return text;
  
  if (!preserveWords) {
    return text.substring(0, maxLength - suffix.length) + suffix;
  }
  
  const words = text.split(' ');
  let truncated = '';
  
  for (const word of words) {
    const nextText = truncated ? `${truncated} ${word}` : word;
    if (nextText.length > maxLength - suffix.length) {
      break;
    }
    truncated = nextText;
  }
  
  return truncated ? truncated + suffix : text.substring(0, maxLength - suffix.length) + suffix;
};

// =============================================================================
// CONTACT INFORMATION FORMATTERS
// =============================================================================

/**
 * Format user name with various display options
 */
export const formatUserName = (
  firstName: string,
  lastName: string,
  format: 'full' | 'lastFirst' | 'initials' | 'firstInitial' = 'full'
): string => {
  const first = firstName?.trim() || '';
  const last = lastName?.trim() || '';
  
  if (!first && !last) return '';
  
  switch (format) {
    case 'full':
      return `${first} ${last}`.trim();
    case 'lastFirst':
      return last ? `${last}, ${first}`.trim() : first;
    case 'initials':
      return `${first.charAt(0)}${last.charAt(0)}`.toUpperCase();
    case 'firstInitial':
      return `${first.charAt(0).toUpperCase()}. ${last}`.trim();
    default:
      return `${first} ${last}`.trim();
  }
};

/**
 * Format phone number with international support
 */
export const formatPhoneNumber = (
  phone: string,
  options: PhoneFormatOptions = {}
): string => {
  const { format = 'US' } = options;
  
  if (!phone) return '';
  
  const cleaned = phone.replace(/\D/g, '');
  
  switch (format) {
    case 'US':
      if (cleaned.length === 10) {
        return `(${cleaned.slice(0, 3)}) ${cleaned.slice(3, 6)}-${cleaned.slice(6)}`;
      }
      if (cleaned.length === 11 && cleaned.startsWith('1')) {
        return `+1 (${cleaned.slice(1, 4)}) ${cleaned.slice(4, 7)}-${cleaned.slice(7)}`;
      }
      break;
      
    case 'E164':
      if (cleaned.length === 10) {
        return `+1${cleaned}`;
      }
      if (cleaned.length === 11 && cleaned.startsWith('1')) {
        return `+${cleaned}`;
      }
      break;
      
    case 'international':
      // Basic international formatting - could be expanded
      if (cleaned.length >= 10) {
        return `+${cleaned}`;
      }
      break;
  }
  
  return phone; // Return original if can't format
};

/**
 * Format email address (basic validation and normalization)
 */
export const formatEmail = (email: string): string => {
  if (!email) return '';
  
  return email.trim().toLowerCase();
};

// =============================================================================
// DATE AND TIME FORMATTERS
// =============================================================================

/**
 * Format date with locale support
 */
type FormatDateOptions = Intl.DateTimeFormatOptions & {
  locale?: string;
  format?: 'short' | 'medium' | 'long' | 'full' | 'ddmmyyyy' | 'yyyy-mm-dd' | 'dd/mm/yyyy' | 'mm/dd/yyyy' | 'dd MMM yyyy' | 'dd-mm-yyyy';
};

const DATE_FORMATS: Record<
  'short' | 'medium' | 'long' | 'full',
  Intl.DateTimeFormatOptions
> = {
  short: { year: '2-digit', month: 'numeric', day: 'numeric' },
  medium: { year: 'numeric', month: 'short', day: 'numeric' },
  long: { year: 'numeric', month: 'long', day: 'numeric' },
  full: {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  },
};

export const formatDate = (
  date: Date | string | number,
  options: FormatDateOptions = {}
): string => {
  const {
    locale = 'en-US',
    format,
    ...intlOptions
  } = options;

  try {
    // Pre-validate string inputs before creating Date object
    if (typeof date === 'string') {
      const trimmed = date.trim();
      if (trimmed === '' || trimmed === 'null' || trimmed === 'undefined') {
        return 'No Date';
      }
    }

    const dateObj = new Date(date);
    
    // Check for invalid dates (NaN) or suspicious Unix epoch dates
    if (isNaN(dateObj.getTime()) || isSuspiciousUnixEpoch(date, dateObj)) {
      return 'No Date';
    }

    // Handle custom string formats
    if (typeof format === 'string') {
      const day = dateObj.getDate().toString().padStart(2, '0');
      const month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
      const year = dateObj.getFullYear().toString();
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const monthName = monthNames[dateObj.getMonth()];

      switch (format) {
        case 'ddmmyyyy':
          return `${day}${month}${year}`;
        case 'yyyy-mm-dd':
          return `${year}-${month}-${day}`;
        case 'dd-mm-yyyy':
          return `${day}-${month}-${year}`;
        case 'dd/mm/yyyy':
          return `${day}/${month}/${year}`;
        case 'mm/dd/yyyy':
          return `${month}/${day}/${year}`;
        case 'dd MMM yyyy':
          return `${day} ${monthName} ${year}`;
        // Fall through to Intl formats below
      }
    }

    // Use Intl for short/medium/long/full/custom Intl options
    const mergedOptions = {
      ...(format && DATE_FORMATS[format as keyof typeof DATE_FORMATS]),
      ...intlOptions,
    };

    const formatter = getCachedFormatter('date', locale, mergedOptions);
    return formatter.format(dateObj);
  } catch {
    return 'No Date';
  }
};

/**
 * Detects if we got Unix epoch from invalid input that was coerced
 * This is very aggressive - assumes most Unix epoch dates are from invalid coercion
 */
function isSuspiciousUnixEpoch(originalInput: Date | string | number, dateObj: Date): boolean {
  const time = dateObj.getTime();
  const isUnixEpoch = time === 0; // January 1, 1970 00:00:00 UTC
  
  if (!isUnixEpoch) return false;
  
  // If input is a Date object that's already Unix epoch, it might be valid
  if (originalInput instanceof Date) {
    return false;
  }
  
  // If input is exactly the number 0, it's intentional
  if (originalInput === 0) {
    return false;
  }
  
  // For any other number, if it results in Unix epoch, it's suspicious
  if (typeof originalInput === 'number') {
    return true;
  }
  
  // For strings - be VERY strict. Most Unix epoch results from strings are invalid
  if (typeof originalInput === 'string') {
    const trimmed = originalInput.trim();
    
    // Only these exact strings are considered valid Unix epoch
    const validUnixEpochStrings = [
      '0',
      '1970-01-01',
      '01/01/1970',
      '1/1/1970', 
      '01-01-1970',
      '1970-01-01T00:00:00.000Z',
      '1970-01-01T00:00:00Z'
    ];
    
    // Exact match only - no partial matches
    const isExactMatch = validUnixEpochStrings.includes(trimmed) || 
                        validUnixEpochStrings.includes(trimmed.toLowerCase());
    
    // If it's not an exact match but resulted in Unix epoch, it's from invalid input
    return !isExactMatch;
  }
  
  // Default to suspicious for any other type
  return true;
}


/**
 * Format time range
 */
export const formatTimeRange = (
  startTime: Date | string,
  endTime: Date | string,
  options: Intl.DateTimeFormatOptions & { locale?: string } = {}
): string => {
  const { locale = 'en-US', ...intlOptions } = options;
  
  const formatOptions = {
    hour: 'numeric' as const,
    minute: '2-digit' as const,
    ...intlOptions
  };
  
  const start = formatDate(startTime, { locale, ...formatOptions });
  const end = formatDate(endTime, { locale, ...formatOptions });
  
  return `${start} - ${end}`;
};

/**
 * Format relative time (e.g., "2 hours ago")
 */
export const formatRelativeTime = (
  date: Date | string | number,
  locale: string = 'en-US'
): string => {
  try {
    const dateObj = new Date(date);
    const now = new Date();
    const diffMs = now.getTime() - dateObj.getTime();
    const diffSec = Math.floor(diffMs / 1000);
    const diffMin = Math.floor(diffSec / 60);
    const diffHour = Math.floor(diffMin / 60);
    const diffDay = Math.floor(diffHour / 24);
    
    if (diffSec < 60) return 'just now';
    if (diffMin < 60) return `${diffMin} minute${diffMin !== 1 ? 's' : ''} ago`;
    if (diffHour < 24) return `${diffHour} hour${diffHour !== 1 ? 's' : ''} ago`;
    if (diffDay < 30) return `${diffDay} day${diffDay !== 1 ? 's' : ''} ago`;
    
    // For older dates, return formatted date
    return formatDate(dateObj, { locale, dateStyle: 'medium' });
  } catch {
    return 'No Date';
  }
};

// =============================================================================
// LIST AND ARRAY FORMATTERS
// =============================================================================

/**
 * Format array as a grammatically correct list
 */
export const formatList = (
  items: (string | number)[],
  options: ListFormatOptions & { locale?: string } = {}
): string => {
  const { locale = 'en-US', conjunction = 'and', ...intlOptions } = options;
  
  if (!Array.isArray(items) || items.length === 0) return '';
  
  const stringItems = items.map(String).filter(Boolean);
  
  if (stringItems.length === 0) return '';
  if (stringItems.length === 1) return stringItems[0];
  
  try {
    const listFormatOptions: Intl.ListFormatOptions = {
      style: 'long',
      type: conjunction === 'or' ? 'disjunction' : 'conjunction',
      ...intlOptions
    };
    
    const formatter = getCachedFormatter('list', locale, listFormatOptions);
    
    return formatter.format(stringItems);
  } catch {
    // Fallback for older browsers
    if (stringItems.length === 2) {
      return `${stringItems[0]} ${conjunction} ${stringItems[1]}`;
    }
    
    const lastItem = stringItems[stringItems.length - 1];
    const otherItems = stringItems.slice(0, -1);
    return `${otherItems.join(', ')}, ${conjunction} ${lastItem}`;
  }
};

/**
 * Format array with truncation support
 */
export const formatArrayWithLimit = (
  items: (string | number)[],
  options: {
    maxItems?: number;
    moreText?: string;
    conjunction?: 'and' | 'or';
    locale?: string;
  } = {}
): string => {
  const { maxItems = 5, moreText = 'more', conjunction = 'and', locale = 'en-US' } = options;
  
  if (!Array.isArray(items) || items.length === 0) return '';
  
  const stringItems = items.map(String).filter(Boolean);
  
  if (stringItems.length <= maxItems) {
    return formatList(stringItems, { conjunction, locale });
  }
  
  const visibleItems = stringItems.slice(0, maxItems);
  const remainingCount = stringItems.length - maxItems;
  
  return `${formatList(visibleItems, { conjunction, locale })} and ${remainingCount} ${moreText}`;
};

// =============================================================================
// ERROR AND VALIDATION FORMATTERS
// =============================================================================

/**
 * Format error messages consistently
 */
export const formatErrorMessage = (error: unknown): string => {
  if (typeof error === 'string') return error;
  if (error instanceof Error) return error.message;
  if (error && typeof error === 'object') {
    if ('message' in error && typeof error.message === 'string') {
      return error.message;
    }
    if ('error' in error && typeof error.error === 'string') {
      return error.error;
    }
  }
  return 'An unexpected error occurred';
};

/**
 * Format validation errors with field names
 */
export const formatValidationErrors = (
  errors: ValidationError[] | Record<string, string>
): string[] => {
  if (Array.isArray(errors)) {
    return errors
      .filter(error => error.message?.trim())
      .map(error => `${toTitleCase(error.field.replace(/([A-Z])/g, ' $1'))}: ${error.message}`);
  }
  
  return Object.entries(errors)
    .filter(([, message]) => message?.trim())
    .map(([field, message]) => `${toTitleCase(field.replace(/([A-Z])/g, ' $1'))}: ${message}`);
};

// =============================================================================
// SEARCH AND UTILITY FORMATTERS
// =============================================================================

/**
 * Normalize search query
 */
export const normalizeSearchQuery = (query: string): string => {
  if (!query) return '';
  
  return query
    .trim()
    .replace(/\s+/g, ' ') // Replace multiple spaces with single space
    .toLowerCase();
};

/**
 * Highlight search terms in text
 */
export const highlightSearchTerms = (
  text: string,
  searchTerms: string | string[],
  options: {
    className?: string;
    caseSensitive?: boolean;
    wholeWords?: boolean;
  } = {}
): string => {
  const { className = 'highlight', caseSensitive = false, wholeWords = false } = options;
  
  if (!text || !searchTerms) return text;
  
  const terms = Array.isArray(searchTerms) ? searchTerms : [searchTerms];
  const flags = caseSensitive ? 'g' : 'gi';
  
  let result = text;
  
  terms.forEach(term => {
    if (!term.trim()) return;
    
    const escapedTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const pattern = wholeWords ? `\\b${escapedTerm}\\b` : escapedTerm;
    const regex = new RegExp(pattern, flags);
    
    result = result.replace(regex, `<span class="${className}">$&</span>`);
  });
  
  return result;
};

// =============================================================================
// EXPORTS
// =============================================================================

const formatters = {
  // Numbers
  formatNumber,
  formatCurrency,
  formatPercentage,
  formatScore,
  formatFileSize,
  
  // Strings
  toTitleCase,
  snakeToTitleCase,
  camelToKebab,
  kebabToCamel,
  snakeToCamel,
  camelToSnake,
  createSlug,
  truncateText,
  
  // Contact
  formatUserName,
  formatPhoneNumber,
  formatEmail,
  
  // Dates
  formatDate,
  formatTimeRange,
  formatRelativeTime,
  
  // Lists
  formatList,
  formatArrayWithLimit,
  
  // Errors
  formatErrorMessage,
  formatValidationErrors,
  
  // Search
  normalizeSearchQuery,
  highlightSearchTerms,
};

export default formatters;
```

<!-- path: hnvtx/utils/validationUtils.ts -->
```typescript
/**
 * Enhanced Validation Utility Functions
 * Improved security, robustness, and modern best practices
 */

// Types for better type safety
export interface ValidationResult {
  isValid: boolean;
  errors: string[];
}

export interface FileValidationOptions {
  maxSize?: number; // in bytes
  allowedTypes?: string[];
  allowedExtensions?: string[];
  minSize?: number;
}

export interface PasswordOptions {
  minLength?: number;
  requireUppercase?: boolean;
  requireLowercase?: boolean;
  requireNumbers?: boolean;
  requireSpecialChars?: boolean;
  maxLength?: number;
}

// Enhanced email validation with more comprehensive regex
export const isValidEmail = (email: string): boolean => {
  if (!email || typeof email !== 'string') return false;
  
  // More comprehensive email regex following RFC 5322 guidelines
  const emailRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
  
  // Additional checks
  if (email.length > 254) return false; // RFC 5321 limit
  if (email.includes('..')) return false; // Consecutive dots not allowed
  
  return emailRegex.test(email.trim().toLowerCase());
};

// Enhanced password validation with configurable options
export const validatePassword = (
  password: string, 
  options: PasswordOptions = {}
): ValidationResult => {
  const {
    minLength = 8,
    requireUppercase = true,
    requireLowercase = true,
    requireNumbers = true,
    requireSpecialChars = true,
    maxLength = 128
  } = options;

  const errors: string[] = [];
  
  if (!password || typeof password !== 'string') {
    errors.push('Password is required');
    return { isValid: false, errors };
  }

  if (password.length < minLength) {
    errors.push(`Password must be at least ${minLength} characters long`);
  }

  if (password.length > maxLength) {
    errors.push(`Password must be no more than ${maxLength} characters long`);
  }
  
  if (requireUppercase && !/[A-Z]/.test(password)) {
    errors.push('Password must contain at least one uppercase letter');
  }
  
  if (requireLowercase && !/[a-z]/.test(password)) {
    errors.push('Password must contain at least one lowercase letter');
  }
  
  if (requireNumbers && !/\d/.test(password)) {
    errors.push('Password must contain at least one number');
  }
  
  if (requireSpecialChars && !/[!@#$%^&*(),.?":{}|<>_+=\-\[\]\\;'\/~`]/.test(password)) {
    errors.push('Password must contain at least one special character');
  }

  // Check for common weak patterns
  if (password.toLowerCase().includes('password')) {
    errors.push('Password cannot contain the word "password"');
  }

  if (/(.)\1{2,}/.test(password)) {
    errors.push('Password cannot contain more than 2 consecutive identical characters');
  }

  return {
    isValid: errors.length === 0,
    errors
  };
};

// Enhanced phone number validation with country code support
export const isValidPhoneNumber = (phone: string, countryCode?: string): boolean => {
  if (!phone || typeof phone !== 'string') return false;
  
  // Remove all non-digit characters except +
  const cleanPhone = phone.replace(/[^\d+]/g, '');
  
  // Basic international format validation
  if (countryCode === 'US') {
    // US phone number: 10 digits
    const usPhoneRegex = /^(\+1)?[2-9]\d{2}[2-9]\d{2}\d{4}$/;
    return usPhoneRegex.test(cleanPhone);
  }
  
  // International format: + followed by 1-15 digits
  const intlPhoneRegex = /^\+[1-9]\d{1,14}$/;
  // National format: 7-15 digits
  const nationalPhoneRegex = /^[1-9]\d{6,14}$/;
  
  return intlPhoneRegex.test(cleanPhone) || nationalPhoneRegex.test(cleanPhone);
};

// Enhanced name validation
export const isValidName = (name: string, options: { minLength?: number; maxLength?: number } = {}): ValidationResult => {
  const { minLength = 2, maxLength = 50 } = options;
  const errors: string[] = [];

  if (!name || typeof name !== 'string') {
    errors.push('Name is required');
    return { isValid: false, errors };
  }

  const trimmedName = name.trim();
  
  if (trimmedName.length < minLength) {
    errors.push(`Name must be at least ${minLength} characters long`);
  }
  
  if (trimmedName.length > maxLength) {
    errors.push(`Name must be no more than ${maxLength} characters long`);
  }

  // Allow letters, spaces, hyphens, apostrophes, and common international characters
  if (!/^[a-zA-ZÀ-ÿ\u0100-\u017F\u0180-\u024F\u1E00-\u1EFF\s\-'\.]+$/.test(trimmedName)) {
    errors.push('Name can only contain letters, spaces, hyphens, and apostrophes');
  }

  // Prevent excessive consecutive spaces or special characters
  if (/\s{2,}/.test(trimmedName) || /[\-'\.]{2,}/.test(trimmedName)) {
    errors.push('Name cannot contain consecutive spaces or special characters');
  }

  return {
    isValid: errors.length === 0,
    errors
  };
};

// Enhanced URL validation
export const isValidUrl = (url: string, options: { allowedProtocols?: string[] } = {}): boolean => {
  if (!url || typeof url !== 'string') return false;
  
  const { allowedProtocols = ['http:', 'https:'] } = options;
  
  try {
    const parsedUrl = new URL(url.trim());
    
    // Check if protocol is allowed
    if (!allowedProtocols.includes(parsedUrl.protocol)) {
      return false;
    }
    
    // Additional security checks
    if (parsedUrl.hostname === '') return false;
    if (parsedUrl.hostname.includes('..')) return false;
    
    return true;
  } catch {
    return false;
  }
};

// Enhanced required field validation with better type checking
export const isRequired = (value: unknown): boolean => {
  if (value === null || value === undefined) return false;
  if (typeof value === 'string') return value.trim().length > 0;
  if (typeof value === 'number') return !isNaN(value);
  if (typeof value === 'boolean') return true;
  if (Array.isArray(value)) return value.length > 0;
  if (typeof value === 'object') return Object.keys(value).length > 0;
  return Boolean(value);
};

// Enhanced numeric validation
export const isValidNumber = (value: unknown, min?: number, max?: number): ValidationResult => {
  const errors: string[] = [];
  
  let num: number;
  if (typeof value === 'string') {
    num = parseFloat(value.trim());
  } else if (typeof value === 'number') {
    num = value;
  } else {
    errors.push('Value must be a number');
    return { isValid: false, errors };
  }
  
  if (isNaN(num) || !isFinite(num)) {
    errors.push('Value must be a valid number');
    return { isValid: false, errors };
  }
  
  if (min !== undefined && num < min) {
    errors.push(`Value must be at least ${min}`);
  }
  
  if (max !== undefined && num > max) {
    errors.push(`Value must be no more than ${max}`);
  }

  return {
    isValid: errors.length === 0,
    errors
  };
};

// Enhanced integer validation
export const isValidInteger = (value: unknown, min?: number, max?: number): ValidationResult => {
  const errors: string[] = [];
  
  let num: number;
  if (typeof value === 'string') {
    num = parseInt(value.trim(), 10);
  } else if (typeof value === 'number') {
    num = value;
  } else {
    errors.push('Value must be an integer');
    return { isValid: false, errors };
  }
  
  if (isNaN(num) || !Number.isInteger(num)) {
    errors.push('Value must be a valid integer');
    return { isValid: false, errors };
  }
  
  if (min !== undefined && num < min) {
    errors.push(`Value must be at least ${min}`);
  }
  
  if (max !== undefined && num > max) {
    errors.push(`Value must be no more than ${max}`);
  }

  return {
    isValid: errors.length === 0,
    errors
  };
};

// Enhanced time validation with format options
export const isValidTime = (time: string, format: '12' | '24' = '24'): ValidationResult => {
  const errors: string[] = [];
  
  if (!time || typeof time !== 'string') {
    errors.push('Time is required');
    return { isValid: false, errors };
  }

  const trimmedTime = time.trim();
  
  if (format === '24') {
    // 24-hour format: HH:MM or HH:MM:SS
    const timeRegex = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?$/;
    if (!timeRegex.test(trimmedTime)) {
      errors.push('Time must be in HH:MM or HH:MM:SS format (24-hour)');
    }
  } else {
    // 12-hour format: HH:MM AM/PM
    const timeRegex = /^(0?[1-9]|1[0-2]):[0-5][0-9]\s?(AM|PM|am|pm)$/;
    if (!timeRegex.test(trimmedTime)) {
      errors.push('Time must be in HH:MM AM/PM format');
    }
  }

  return {
    isValid: errors.length === 0,
    errors
  };
};

// Enhanced date validation
export const isValidDate = (date: string | Date): ValidationResult => {
  const errors: string[] = [];
  
  let parsedDate: Date;
  
  if (date instanceof Date) {
    parsedDate = date;
  } else if (typeof date === 'string') {
    if (!date.trim()) {
      errors.push('Date is required');
      return { isValid: false, errors };
    }
    parsedDate = new Date(date.trim());
  } else {
    errors.push('Date must be a string or Date object');
    return { isValid: false, errors };
  }
  
  if (isNaN(parsedDate.getTime())) {
    errors.push('Invalid date format');
  }

  // Check for reasonable date range (year 1900-2100)
  const year = parsedDate.getFullYear();
  if (year < 1900 || year > 2100) {
    errors.push('Date must be between 1900 and 2100');
  }

  return {
    isValid: errors.length === 0,
    errors
  };
};

// Enhanced future date validation
export const isFutureDate = (date: string | Date, allowToday = false): ValidationResult => {
  const dateValidation = isValidDate(date);
  if (!dateValidation.isValid) {
    return dateValidation;
  }

  const errors: string[] = [];
  const inputDate = typeof date === 'string' ? new Date(date.trim()) : date;
  const now = new Date();
  
  // Set time to start of day for comparison
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const compareDate = new Date(inputDate.getFullYear(), inputDate.getMonth(), inputDate.getDate());
  
  if (allowToday ? compareDate < today : compareDate <= today) {
    errors.push(allowToday ? 'Date must be today or in the future' : 'Date must be in the future');
  }

  return {
    isValid: errors.length === 0,
    errors
  };
};

// Enhanced past date validation
export const isPastDate = (date: string | Date, allowToday = false): ValidationResult => {
  const dateValidation = isValidDate(date);
  if (!dateValidation.isValid) {
    return dateValidation;
  }

  const errors: string[] = [];
  const inputDate = typeof date === 'string' ? new Date(date.trim()) : date;
  const now = new Date();
  
  // Set time to start of day for comparison
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const compareDate = new Date(inputDate.getFullYear(), inputDate.getMonth(), inputDate.getDate());
  
  if (allowToday ? compareDate > today : compareDate >= today) {
    errors.push(allowToday ? 'Date must be today or in the past' : 'Date must be in the past');
  }

  return {
    isValid: errors.length === 0,
    errors
  };
};

// Enhanced file validation
export const validateFile = (
  file: File,
  options: FileValidationOptions = {}
): ValidationResult => {
  const errors: string[] = [];

  if (!file || !(file instanceof File)) {
    errors.push('Valid file is required');
    return { isValid: false, errors };
  }

  // Check minimum file size
  if (options.minSize && file.size < options.minSize) {
    errors.push(`File size must be at least ${formatFileSize(options.minSize)}`);
  }

  // Check maximum file size
  if (options.maxSize && file.size > options.maxSize) {
    errors.push(`File size must be less than ${formatFileSize(options.maxSize)}`);
  }

  // Check file type
  if (options.allowedTypes && options.allowedTypes.length > 0) {
    if (!options.allowedTypes.includes(file.type)) {
      errors.push(`File type "${file.type}" is not allowed. Allowed types: ${options.allowedTypes.join(', ')}`);
    }
  }

  // Check file extension
  if (options.allowedExtensions && options.allowedExtensions.length > 0) {
    const extension = file.name.split('.').pop()?.toLowerCase();
    if (!extension || !options.allowedExtensions.map(ext => ext.toLowerCase()).includes(extension)) {
      errors.push(`File extension must be one of: ${options.allowedExtensions.join(', ')}`);
    }
  }

  // Check for potentially dangerous file names
  if (/[<>:"|?*]/.test(file.name)) {
    errors.push('File name contains invalid characters');
  }

  return {
    isValid: errors.length === 0,
    errors
  };
};

// Enhanced file size formatter
export const formatFileSize = (bytes: number): string => {
  if (bytes === 0) return '0 Bytes';
  if (bytes < 0) return 'Invalid size';
  
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  
  if (i >= sizes.length) return 'File too large';
  
  const size = bytes / Math.pow(k, i);
  return `${size.toFixed(i === 0 ? 0 : 2)} ${sizes[i]}`;
};

// Enhanced sanitization with more comprehensive XSS prevention
export const sanitizeInput = (input: string): string => {
  if (!input || typeof input !== 'string') return '';
  
  return input
    .replace(/&/g, '&amp;')    // Must be first
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#x27;')
    .replace(/\//g, '&#x2F;')
    .replace(/\\/g, '&#x5C;')
    .replace(/`/g, '&#x60;')
    .replace(/=/g, '&#x3D;');
};

// Credit card validation (Luhn algorithm)
export const isValidCreditCard = (cardNumber: string): ValidationResult => {
  const errors: string[] = [];
  
  if (!cardNumber || typeof cardNumber !== 'string') {
    errors.push('Card number is required');
    return { isValid: false, errors };
  }

  // Remove spaces and hyphens
  const cleanCard = cardNumber.replace(/[\s-]/g, '');
  
  // Check if all digits
  if (!/^\d+$/.test(cleanCard)) {
    errors.push('Card number must contain only digits');
    return { isValid: false, errors };
  }

  // Check length
  if (cleanCard.length < 13 || cleanCard.length > 19) {
    errors.push('Card number must be between 13 and 19 digits');
    return { isValid: false, errors };
  }

  // Luhn algorithm
  let sum = 0;
  let alternate = false;
  
  for (let i = cleanCard.length - 1; i >= 0; i--) {
    let n = parseInt(cleanCard.charAt(i), 10);
    
    if (alternate) {
      n *= 2;
      if (n > 9) {
        n = (n % 10) + 1;
      }
    }
    
    sum += n;
    alternate = !alternate;
  }

  if (sum % 10 !== 0) {
    errors.push('Invalid card number');
  }

  return {
    isValid: errors.length === 0,
    errors
  };
};

// Enhanced validation schemas
export const validationSchemas = {
  register: {
    firstName: (value: string) => {
      const nameValidation = isValidName(value);
      return {
        isValid: isRequired(value) && nameValidation.isValid,
        error: !isRequired(value) ? 'First name is required' : nameValidation.errors[0] || ''
      };
    },
    lastName: (value: string) => {
      const nameValidation = isValidName(value);
      return {
        isValid: isRequired(value) && nameValidation.isValid,
        error: !isRequired(value) ? 'Last name is required' : nameValidation.errors[0] || ''
      };
    },
    email: (value: string) => ({
      isValid: isRequired(value) && isValidEmail(value),
      error: !isRequired(value) ? 'Email is required' : 
             !isValidEmail(value) ? 'Please enter a valid email address' : ''
    }),
    password: (value: string) => {
      const validation = validatePassword(value);
      return {
        isValid: validation.isValid,
        error: validation.errors[0] || ''
      };
    },
    confirmPassword: (value: string, password: string) => ({
      isValid: isRequired(value) && value === password,
      error: !isRequired(value) ? 'Please confirm your password' : 
             value !== password ? 'Passwords do not match' : ''
    })
  },

  login: {
    email: (value: string) => ({
      isValid: isRequired(value) && isValidEmail(value),
      error: !isRequired(value) ? 'Email is required' : 
             !isValidEmail(value) ? 'Please enter a valid email address' : ''
    }),
    password: (value: string) => ({
      isValid: isRequired(value),
      error: !isRequired(value) ? 'Password is required' : ''
    })
  }
};

// Enhanced generic form validator with better type safety
export const validateForm = <T extends Record<string, unknown>>(
  data: T,
  schema: Record<keyof T, (value: T[keyof T], ...args: unknown[]) => { isValid: boolean; error: string }>
): { isValid: boolean; errors: Record<keyof T, string> } => {
  const errors = {} as Record<keyof T, string>;
  let isValid = true;

  (Object.keys(schema) as Array<keyof T>).forEach(key => {
    try {
      const validation = schema[key](data[key]);
      if (!validation.isValid) {
        errors[key] = validation.error;
        isValid = false;
      }
    } catch (error) {
      console.error(`Validation error for field ${String(key)}:`, error);
      errors[key] = 'Validation error occurred';
      isValid = false;
    }
  });

  return { isValid, errors };
};

// Comprehensive validation utilities object
const validationUtils = {
  isValidEmail,
  validatePassword,
  isValidPhoneNumber,
  isValidName,
  isValidUrl,
  isRequired,
  isValidNumber,
  isValidInteger,
  isValidTime,
  isValidDate,
  isFutureDate,
  isPastDate,
  validateFile,
  formatFileSize,
  sanitizeInput,
  isValidCreditCard,
  validationSchemas,
  validateForm
};

export default validationUtils;
```

<!-- path: hnvtx/utils/imageOptimization.ts -->
```typescript
// utils/imageOptimization.ts
"use client";

import Uppy from "@uppy/core";
import ImageEditor from "@uppy/image-editor";
import { useRef, useEffect } from "react";

// Types for better type safety
interface CompressionOptions {
  maxWidth?: number;
  maxHeight?: number;
  quality?: number;
}

interface OptimizedUppyOptions {
  folderId: string | null;
  maxFileSize?: number;
  maxNumberOfFiles?: number;
}

// 1. Improved ImageEditor configuration with better compression
export const enhancedImageEditorConfig = {
  quality: 0.85,
  cropperOptions: {
    viewMode: 1 as 0 | 1 | 2 | 3,
    background: false,
    autoCropArea: 1,
    responsive: true,
    checkOrientation: false,
    guides: true,
    highlight: false,
    dragMode: "crop" as const,
  },
  actions: {
    revert: true,
    rotate: true,
    granularRotate: true,
    flip: true,
    zoomIn: true,
    zoomOut: true,
    cropSquare: true,
    cropWidescreen: true,
    cropWidescreenVertical: true,
  },
};

// 2. Enhanced image compression utility function
export const compressImage = (
  file: File,
  options: CompressionOptions = {},
): Promise<File> => {
  const { maxWidth = 1920, maxHeight = 1080, quality = 0.8 } = options;

  return new Promise((resolve) => {
    // Check if it's actually an image
    if (!file.type.startsWith("image/")) {
      resolve(file);
      return;
    }

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    if (!ctx) {
      console.warn("Could not get canvas context");
      resolve(file);
      return;
    }

    const img = new Image();

    img.onload = () => {
      try {
        // Calculate new dimensions while maintaining aspect ratio
        let { width, height } = img;

        if (width > maxWidth || height > maxHeight) {
          const aspectRatio = width / height;

          if (width > height) {
            width = Math.min(width, maxWidth);
            height = width / aspectRatio;
          } else {
            height = Math.min(height, maxHeight);
            width = height * aspectRatio;
          }
        }

        canvas.width = width;
        canvas.height = height;

        // Clear canvas and draw image
        ctx.clearRect(0, 0, width, height);
        ctx.drawImage(img, 0, 0, width, height);

        canvas.toBlob(
          (blob) => {
            if (blob && blob.size > 0) {
              try {
                const compressedFile = new File([blob], file.name, {
                  type: file.type,
                  lastModified: Date.now(),
                });
                resolve(compressedFile);
              } catch (error) {
                console.warn("Error creating compressed file:", error);
                resolve(file);
              }
            } else {
              console.warn("Canvas toBlob produced empty result");
              resolve(file);
            }
          },
          file.type,
          quality,
        );
      } catch (error) {
        console.warn("Error compressing image:", error);
        resolve(file);
      }
    };

    img.onerror = () => {
      console.warn("Error loading image for compression");
      resolve(file);
    };

    img.src = URL.createObjectURL(file);
  });
};

// 3. Enhanced Uppy configuration with compression
export const createOptimizedUppy = (options: OptimizedUppyOptions) => {
  const {
    folderId,
    maxFileSize = 50 * 1024 * 1024, // 50MB
    maxNumberOfFiles = 20,
  } = options;

  const uppy = new Uppy({
    id: "file-uploader",
    autoProceed: false,
    allowMultipleUploads: true,
    restrictions: {
      maxFileSize,
      maxNumberOfFiles,
      allowedFileTypes: [
        "image/*",
        "application/pdf",
        ".doc",
        ".docx",
        ".txt",
        ".rtf",
        "video/*",
        "audio/*",
      ],
    },
    meta: {
      folderId: folderId,
    },
    onBeforeFileAdded: (currentFile, files) => {
      // Additional validation
      if (currentFile.size === 0) {
        uppy.log(`Skipping file ${currentFile.name} - file is empty`);
        return false;
      }

      // Check for duplicate files
      const existingFile = Object.values(files).find(
        (file) =>
          file.name === currentFile.name && file.size === currentFile.size,
      );

      if (existingFile) {
        uppy.log(`Skipping file ${currentFile.name} - duplicate file`);
        return false;
      }

      return true;
    },
  });

  // Add ImageEditor plugin with error handling
  try {
    uppy.use(ImageEditor, enhancedImageEditorConfig);
  } catch (error) {
    console.warn("Failed to add ImageEditor plugin:", error);
  }

  return uppy;
};

// 4. WebP conversion utility (for modern browsers)
export const convertToWebP = (file: File, quality = 0.8): Promise<File> => {
  return new Promise((resolve) => {
    if (!file.type.startsWith("image/") || file.type === "image/webp") {
      resolve(file);
      return;
    }

    // Check if browser supports WebP
    const canvas = document.createElement("canvas");
    const testBlob = canvas.toDataURL("image/webp");

    if (!testBlob.startsWith("data:image/webp")) {
      resolve(file);
      return;
    }

    const ctx = canvas.getContext("2d");
    if (!ctx) {
      resolve(file);
      return;
    }

    const img = new Image();

    img.onload = () => {
      try {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);

        canvas.toBlob(
          (blob) => {
            if (blob && blob.size > 0 && blob.size < file.size) {
              const webpFile = new File(
                [blob],
                file.name.replace(/\.[^/.]+$/, ".webp"),
                {
                  type: "image/webp",
                  lastModified: Date.now(),
                },
              );
              resolve(webpFile);
            } else {
              resolve(file);
            }
          },
          "image/webp",
          quality,
        );
      } catch (error) {
        console.warn("Error converting to WebP:", error);
        resolve(file);
      }
    };

    img.onerror = () => resolve(file);
    img.src = URL.createObjectURL(file);
  });
};

// 5. Progressive JPEG utility
export const createProgressiveJPEG = (file: File): Promise<File> => {
  return new Promise((resolve) => {
    if (file.type !== "image/jpeg") {
      resolve(file);
      return;
    }

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    if (!ctx) {
      resolve(file);
      return;
    }

    const img = new Image();

    img.onload = () => {
      try {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);

        canvas.toBlob(
          (blob) => {
            if (blob && blob.size > 0) {
              const progressiveFile = new File([blob], file.name, {
                type: "image/jpeg",
                lastModified: Date.now(),
              });
              resolve(progressiveFile);
            } else {
              resolve(file);
            }
          },
          "image/jpeg",
          0.85,
        );
      } catch (error) {
        console.warn("Error creating progressive JPEG:", error);
        resolve(file);
      }
    };

    img.onerror = () => resolve(file);
    img.src = URL.createObjectURL(file);
  });
};

// 6. FIXED Smart compression based on image content
export const smartCompress = async (file: File): Promise<File> => {
  if (!file.type.startsWith("image/")) {
    return file;
  }

  return new Promise((resolve) => {
    const img = new Image();
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    if (!ctx) {
      console.warn("Could not get canvas context for smart compression");
      resolve(file);
      return;
    }

    img.onload = () => {
      try {
        // Get optimal settings based on file size
        const { quality, maxWidth, maxHeight } = getOptimalImageSettings(file);

        // Calculate new dimensions while maintaining aspect ratio
        let { width, height } = img;

        if (width > maxWidth || height > maxHeight) {
          const aspectRatio = width / height;

          if (width > height) {
            width = Math.min(width, maxWidth);
            height = width / aspectRatio;
          } else {
            height = Math.min(height, maxHeight);
            width = height * aspectRatio;
          }
        }

        canvas.width = width;
        canvas.height = height;

        // Clear canvas and draw image
        ctx.clearRect(0, 0, width, height);
        ctx.drawImage(img, 0, 0, width, height);

        canvas.toBlob(
          (blob) => {
            if (blob && blob.size > 0) {
              try {
                const optimizedFile = new File([blob], file.name, {
                  type: file.type,
                  lastModified: Date.now(),
                });

                console.log(`Smart compression result: ${file.name}`, {
                  original: (file.size / 1024 / 1024).toFixed(2) + "MB",
                  compressed:
                    (optimizedFile.size / 1024 / 1024).toFixed(2) + "MB",
                  reduction:
                    (
                      ((file.size - optimizedFile.size) / file.size) *
                      100
                    ).toFixed(1) + "%",
                });

                resolve(optimizedFile);
              } catch (error) {
                console.warn("Error creating optimized file:", error);
                resolve(file);
              }
            } else {
              console.warn(
                "Smart compression produced empty result, using original file",
              );
              resolve(file);
            }
          },
          file.type,
          quality,
        );
      } catch (error) {
        console.warn("Error in smart compression:", error);
        resolve(file);
      }
    };

    img.onerror = (error) => {
      console.warn("Error loading image for smart compression:", error);
      resolve(file);
    };

    img.src = URL.createObjectURL(file);
  });
};

// 7. Custom hook for optimized file uploader
export const useOptimizedFileUploader = (
  folderId: string | null,
): Uppy<{ folderId: string | null }, Record<string, never>> | null => {
  const uppyRef = useRef<Uppy<
    { folderId: string | null },
    Record<string, never>
  > | null>(null);

  useEffect(() => {
    // Clean up previous instance
    if (uppyRef.current) {
      uppyRef.current.destroy();
    }

    const uppy = createOptimizedUppy({ folderId });

    // Add comprehensive image optimization preprocessor
    uppy.addPreProcessor(async (fileIDs) => {
      const optimizationPromises = fileIDs.map(async (fileID) => {
        const file = uppy.getFile(fileID);

        if (file && file.type && file.type.startsWith("image/")) {
          try {
            let optimizedFile = file.data as File;

            // Validate original file
            if (optimizedFile.size === 0) {
              console.warn(
                `Skipping optimization for ${file.name} - empty file`,
              );
              return;
            }

            // Apply smart compression with fallback
            try {
              const compressedFile = await smartCompress(optimizedFile);
              if (
                compressedFile.size > 0 &&
                compressedFile.size < optimizedFile.size
              ) {
                optimizedFile = compressedFile;
              }
            } catch (compressionError) {
              console.warn(
                `Compression failed for ${file.name}:`,
                compressionError,
              );
            }

            // Convert to WebP if beneficial (with validation)
            try {
              const webpFile = await convertToWebP(optimizedFile);
              if (webpFile.size > 0 && webpFile.size < optimizedFile.size) {
                optimizedFile = webpFile;
              }
            } catch (webpError) {
              console.warn(
                `WebP conversion failed for ${file.name}:`,
                webpError,
              );
            }

            // For JPEGs, make them progressive (with validation)
            try {
              if (optimizedFile.type === "image/jpeg") {
                const progressiveFile =
                  await createProgressiveJPEG(optimizedFile);
                if (progressiveFile.size > 0) {
                  optimizedFile = progressiveFile;
                }
              }
            } catch (progressiveError) {
              console.warn(
                `Progressive JPEG creation failed for ${file.name}:`,
                progressiveError,
              );
            }

            // Final validation before updating Uppy
            if (optimizedFile.size === 0) {
              console.error(
                `Optimization resulted in empty file for ${file.name}, using original`,
              );
              return; // Don't update Uppy, keep original
            }

            // Update the file in Uppy
            uppy.setFileState(fileID, {
              data: optimizedFile,
              size: optimizedFile.size,
            });

            const originalSizeMB = ((file.size ?? 0) / 1024 / 1024).toFixed(2);
            const optimizedSizeMB = (optimizedFile.size / 1024 / 1024).toFixed(
              2,
            );
            const compressionRatio = (
              (((file.size ?? 0) - optimizedFile.size) / (file.size ?? 1)) *
              100
            ).toFixed(1);

            console.log(
              `Optimized ${file.name}: ${originalSizeMB}MB → ${optimizedSizeMB}MB (${compressionRatio}% reduction)`,
            );
          } catch (error) {
            console.warn(`Failed to optimize ${file.name}:`, error);
            // Keep original file in case of any error
          }
        }
      });

      await Promise.all(optimizationPromises);
    });

    uppyRef.current = uppy;

    return () => {
      if (uppyRef.current) {
        uppyRef.current.destroy();
        uppyRef.current = null;
      }
    };
  }, [folderId]);

  return uppyRef.current;
};

// 8. Utility function to get optimal image settings
export const getOptimalImageSettings = (file: File) => {
  const sizeInMB = file.size / (1024 * 1024);

  if (sizeInMB > 10) {
    return { quality: 0.6, maxWidth: 1600, maxHeight: 1200 };
  } else if (sizeInMB > 5) {
    return { quality: 0.7, maxWidth: 1800, maxHeight: 1350 };
  } else if (sizeInMB > 2) {
    return { quality: 0.75, maxWidth: 1920, maxHeight: 1440 };
  } else {
    return { quality: 0.85, maxWidth: 1920, maxHeight: 1440 };
  }
};

// 9. Batch optimization function
export const optimizeFilesBatch = async (files: File[]): Promise<File[]> => {
  const optimizationPromises = files.map(async (file) => {
    console.log(
      "Original file:",
      file.name,
      "Size:",
      file.size,
      "Type:",
      file.type,
    );

    if (file.type.startsWith("image/") && file.size > 0) {
      try {
        const optimized = await smartCompress(file);
        return optimized.size > 0 ? optimized : file; // Fallback to original if compression fails
      } catch (error) {
        console.warn(`Batch optimization failed for ${file.name}:`, error);
        return file; // Return original on error
      }
    }

    return file;
  });

  return Promise.all(optimizationPromises);
};

```

<!-- path: hnvtx/utils/supabase/middleware.ts -->
```typescript
 
import { createServerClient } from '@supabase/ssr'
import { NextResponse, type NextRequest } from 'next/server'
 
export async function updateSession(request: NextRequest) {
  let supabaseResponse = NextResponse.next({
    request,
  })
 
  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll()
        },
        setAll(cookiesToSet) {
          // eslint-disable-next-line @typescript-eslint/no-unused-vars
          cookiesToSet.forEach(({ name, value, options }) => request.cookies.set(name, value))
          supabaseResponse = NextResponse.next({
            request,
          })
          cookiesToSet.forEach(({ name, value, options }) =>
            supabaseResponse.cookies.set(name, value, options)
          )
        },
      },
    }
  )
 
  // refreshing the auth token
  await supabase.auth.getUser()
 
  return supabaseResponse
}
```

<!-- path: hnvtx/utils/supabase/admin.ts -->
```typescript
import { createClient as createAdminClient } from '@supabase/supabase-js';

// This is a server-side only client that uses the service role key
// It should only be used in API routes or server components

export function createAdmin() {
  // These environment variables should be set in your deployment environment
  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
  const supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;

  console.log('URL:', process.env.NEXT_PUBLIC_SUPABASE_URL);
  console.log('Service key:', process.env.SUPABASE_SERVICE_ROLE_KEY ? 'exists' : 'missing');

  if (!supabaseUrl || !supabaseServiceRoleKey) {
    throw new Error(
      'Missing required environment variables: NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY must be set'
    );
  }

  return createAdminClient(supabaseUrl, supabaseServiceRoleKey, {
    auth: {
      autoRefreshToken: false,
      persistSession: false,
      detectSessionInUrl: false,
    },
  });
}

```

<!-- path: hnvtx/utils/supabase/server.ts -->
```typescript
 
import { createServerClient } from '@supabase/ssr'
import { cookies } from 'next/headers'
 
export async function createClient() {
  const cookieStore = await cookies()
 
  // Create a server's supabase client with newly configured cookie,
  // which could be used to maintain user's session
  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll()
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            )
          } catch {
            // The `setAll` method was called from a Server Component.
            // This can be ignored if you have middleware refreshing
            // user sessions.
          }
        },
      },
    }
  )
}
```

<!-- path: hnvtx/utils/supabase/client.ts -->
```typescript
// utils/supabase/client.ts

import { createBrowserClient } from '@supabase/ssr'

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  )
}
```

<!-- path: hnvtx/tsconfig.json -->
```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "paths": {
      "@/*": ["./*"]
    },
    "plugins": [
      {
        "name": "next"
      }
    ]
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": [
    "node_modules",
    "components/table/DataTableDemo.tsx",
    "components/table/ExampleModalUsage.tsx",
    "**/* copy.tsx",
    "components/debug/**"
  ]
}

```

<!-- path: hnvtx/plan2.md -->
```markdown
Of course. This is a fantastic and logical evolution for your project. Let's implement it step-by-step with all the necessary code.

I will provide the complete code for each new or modified file, one by one, in the logical order you should create or update them:
1.  **Database:** A single migration file for all schema changes.
2.  **Schemas:** Updates to your Zod schemas file.
3.  **Data Hooks:** New React Query hooks to fetch the specific data needed for the UI.
4.  **UI Components:** The new React components for the System Details Page to manage the ring path.

---

### **Phase 1: Database Schema Migration**

Create a new migration file in your Supabase project (`supabase/migrations/<timestamp>_system_paths.sql`) and add the following content. This single file contains all the necessary database changes.

**File:** `supabase/migrations/<timestamp>_system_paths.sql`

```sql
-- Step 1: Add the requested 'ring_no' column to the systems table.
ALTER TABLE public.systems
ADD COLUMN ring_no VARCHAR(255);

-- Create an index for faster lookups if you plan to search by ring number.
CREATE INDEX IF NOT EXISTS idx_systems_ring_no ON public.systems (ring_no);

-- Step 2: Create the 'logical_fiber_paths' table. This is the core of the new model.
-- It represents a named, end-to-end service or circuit for a system.
CREATE TABLE public.logical_fiber_paths (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    path_name VARCHAR(255) NOT NULL,
    path_type_id UUID REFERENCES public.lookup_types(id) ON DELETE SET NULL, -- e.g., Ring, Point-to-Point
    
    -- A path is provisioned FOR a system
    source_system_id UUID NOT NULL REFERENCES public.systems(id) ON DELETE CASCADE,
    destination_system_id UUID REFERENCES public.systems(id) ON DELETE SET NULL,

    -- These logical fields now live here
    source_port TEXT,
    destination_port TEXT,

    operational_status VARCHAR(50) DEFAULT 'planning', -- e.g., planning, active, maintenance
    total_distance_km NUMERIC(10, 3), -- This can be calculated later by a trigger or function
    remark TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ
);

-- Step 3: Simplify the 'ofc_connections' table to be purely physical.
-- We will move the logical/system-related data to the logical_fiber_paths table.
ALTER TABLE public.ofc_connections
DROP COLUMN IF EXISTS system_id,
DROP COLUMN IF EXISTS source_port,
DROP COLUMN IF EXISTS destination_port,
DROP COLUMN IF EXISTS connection_category,
DROP COLUMN IF EXISTS connection_type;

-- Add a new column to link a physical fiber strand to its logical path.
ALTER TABLE public.ofc_connections
ADD COLUMN logical_path_id UUID REFERENCES public.logical_fiber_paths(id) ON DELETE SET NULL;

-- Index for efficient lookups of which path a fiber belongs to.
CREATE INDEX IF NOT EXISTS idx_ofc_connections_logical_path_id ON public.ofc_connections(logical_path_id);


-- Step 4: Create the 'logical_path_segments' linking table.
-- This table defines the ordered sequence of physical assets that make up a logical path.
-- This is the key to the "cascading" logic.
CREATE TABLE public.logical_path_segments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    logical_path_id UUID NOT NULL REFERENCES public.logical_fiber_paths(id) ON DELETE CASCADE,
    
    -- A segment can be a cable or a joint.
    ofc_cable_id UUID REFERENCES public.ofc_cables(id),
    fiber_joint_id UUID REFERENCES public.fiber_joints(id),

    -- The order of this segment within the path
    path_order INT NOT NULL,

    -- Ensure a segment is either a cable or a joint, but not both.
    CHECK ((ofc_cable_id IS NOT NULL AND fiber_joint_id IS NULL) OR (ofc_cable_id IS NULL AND fiber_joint_id IS NOT NULL)),
    
    -- The order must be unique for each path.
    UNIQUE (logical_path_id, path_order)
);

-- Indexes for performance
CREATE INDEX idx_logical_path_segments_path_id ON public.logical_path_segments(logical_path_id);


-- Step 5: Create a detailed view to simplify frontend queries.
-- This view joins all the necessary information to display a complete path.
CREATE OR REPLACE VIEW public.v_system_ring_paths_detailed AS
SELECT
  srp.id,
  srp.logical_path_id,
  lp.path_name,
  lp.source_system_id,
  srp.ofc_cable_id,
  srp.path_order,
  oc.route_name,
  oc.sn_id AS start_node_id,
  sn.name AS start_node_name,
  oc.en_id AS end_node_id,
  en.name AS end_node_name,
  srp.created_at
FROM
  public.logical_path_segments srp
  JOIN public.logical_fiber_paths lp ON srp.logical_path_id = lp.id
  JOIN public.ofc_cables oc ON srp.ofc_cable_id = oc.id
  LEFT JOIN public.nodes sn ON oc.sn_id = sn.id
  LEFT JOIN public.nodes en ON oc.en_id = en.id
ORDER BY
  srp.logical_path_id,
  srp.path_order;
```

---

### **Phase 2: Zod Schema and Type Updates**

Update your single source of truth for validation schemas to reflect the new database structure.

**File:** `schemas/schema.ts`

```typescript
// ... (keep all existing schemas)

// 1. UPDATE systemSchema
export const systemSchema = z.object({
  id: z.uuid().optional(),
  system_type_id: z.string().uuid({ message: "System type is required." }),
  node_id: z.string().uuid({ message: "Node is required." }),
  system_name: z.string().optional().nullable(),
  ip_address: ipValidation.optional().or(z.literal('')),
  ring_no: z.string().optional().nullable(), // <-- ADDED
  maintenance_terminal_id: z.uuid().optional().nullable(),
  commissioned_on: z.coerce.date().optional().nullable(),
  remark: z.string().optional().nullable(),
  status: z.boolean().default(true).optional(),
  created_at: z.coerce.date().optional(),
  updated_at: z.coerce.date().optional(),
});

// 2. SIMPLIFY ofcConnectionSchema
export const ofcConnectionSchema = z.object({
  id: z.uuid().optional(),
  ofc_id: z.uuid({ message: "OFC Cable is required." }),
  logical_path_id: z.uuid().optional().nullable(), // Now links to the logical path
  
  fiber_no_sn: z.number().int({ message: "Start Node Fiber No. is required." }),
  fiber_no_en: z.number().int().optional().nullable(),

  // REMOVED system_id, source_port, destination_port, connection_category, connection_type

  // Keep all physical measurement fields
  sn_dom: z.coerce.date().optional().nullable(),
  otdr_distance_sn_km: emptyStringToNumber,
  sn_power_dbm: emptyStringToNumber,
  en_dom: z.coerce.date().optional().nullable(),
  otdr_distance_en_km: emptyStringToNumber,
  en_power_dbm: emptyStringToNumber,
  route_loss_db: emptyStringToNumber,
  status: z.boolean().optional().nullable(),
  remark: z.string().optional().nullable(),
  created_at: z.coerce.date().optional().nullable(),
  updated_at: z.coerce.date().optional().nullable(),
});

// 3. ADD new schemas for the logical layer
export const logicalFiberPathSchema = z.object({
  id: z.uuid().optional(),
  path_name: z.string().min(1, "Path name is required."),
  path_type_id: z.uuid().optional().nullable(),
  source_system_id: z.uuid(),
  destination_system_id: z.uuid().optional().nullable(),
  source_port: z.string().optional().nullable(),
  destination_port: z.string().optional().nullable(),
  operational_status: z.string().default('planning'),
  total_distance_km: z.number().optional().nullable(),
  remark: z.string().optional().nullable(),
});

export const logicalPathSegmentSchema = z.object({
    id: z.uuid().optional(),
    logical_path_id: z.uuid(),
    ofc_cable_id: z.uuid().optional().nullable(),
    fiber_joint_id: z.uuid().optional().nullable(),
    path_order: z.number().int().positive(),
}).refine(data => (data.ofc_cable_id && !data.fiber_joint_id) || (!data.ofc_cable_id && data.fiber_joint_id), {
    message: "A segment must be either a cable or a joint, not both.",
    path: ["ofc_cable_id"], 
});

// ... (keep all other existing schemas)

// Add new type exports at the bottom of the file
export type LogicalFiberPath = z.infer<typeof logicalFiberPathSchema>;
export type LogicalPathSegment = z.infer<typeof logicalPathSegmentSchema>;
```

---

### **Phase 3: New Data Hooks**

Create a new file to hold the specialized hooks for fetching the path data.

**File:** `hooks/database/path-queries.ts`

```typescript
"use client";

import { useQuery } from "@tanstack/react-query";
import { createClient } from "@/utils/supabase/client";
import { useTableQuery } from "./core-queries";
import { useMemo } from "react";
import { Row } from "./queries-type-helpers";

const supabase = createClient();

/**
 * Fetches the detailed, ordered path segments for a given logical path.
 */
export function useSystemPath(logicalPathId: string | null) {
  return useQuery({
    queryKey: ['system-path', logicalPathId],
    queryFn: async () => {
      if (!logicalPathId) return [];
      const { data, error } = await supabase
        .from('v_system_ring_paths_detailed')
        .select('*')
        .eq('logical_path_id', logicalPathId)
        .order('path_order', { ascending: true });

      if (error) throw error;
      return data;
    },
    enabled: !!logicalPathId,
  });
}

/**
 * Fetches available OFC cables that can be connected next in a path.
 */
export function useAvailablePathSegments(sourceNodeId: string | null, pathSegments: Row<'v_system_ring_paths_detailed'>[] = []) {
  const lastSegment = pathSegments?.[pathSegments.length - 1];
  
  // Determine the last node in the current path
  const lastNodeId = useMemo(() => {
    if (!lastSegment) return sourceNodeId; // If no segments, start from the system's node
    // The next connection must start from the end node of the last cable segment
    return lastSegment.end_node_id;
  }, [lastSegment, sourceNodeId]);

  // Get a list of cable IDs already used in the path to prevent adding them again
  const existingCableIds = useMemo(() => pathSegments.map(p => p.ofc_cable_id), [pathSegments]);

  return useTableQuery(supabase, 'ofc_cables', {
    columns: '*, sn:sn_id(name), en:en_id(name)',
    filters: {
      // Find cables where either the start or end node matches our last node
      or: `(sn_id.eq.${lastNodeId},en_id.eq.${lastNodeId})`,
      // Exclude cables already in the path
      ...(existingCableIds.length > 0 && { id: { operator: 'not.in', value: `(${existingCableIds.join(',')})` } }),
    },
    enabled: !!lastNodeId, // Only run this query if we have a node to start from
  });
}
```

---

### **Phase 4: Frontend Implementation**

This involves creating the new System Details page and the components to manage the path.

**Step 4.1: The Main Page**

Create the main page that fetches the system's data and orchestrates the UI.

**File:** `app/dashboard/systems/[id]/page.tsx`

```typescript
"use client";

import { useParams } from "next/navigation";
import { createClient } from "@/utils/supabase/client";
import { useTableRecord } from "@/hooks/database";
import { PageSpinner } from "@/components/common/ui/LoadingSpinner";
import { ErrorDisplay } from "@/components/common/ui/error/ErrorDisplay";
import { SystemRingPath } from "@/components/systems/SystemRingPath"; // We will create this next

export default function SystemDetailsPage() {
  const params = useParams();
  const id = params.id as string;
  const supabase = createClient();

  const { data: system, isLoading, isError, error, refetch } = useTableRecord(
    supabase,
    "systems",
    id,
    { columns: "*, node:node_id(id, name)" }
  );

  if (isLoading) return <PageSpinner />;
  if (isError) return <ErrorDisplay error={error} onRetry={refetch} />;
  if (!system) return <div className="p-6">System not found.</div>;

  return (
    <div className="space-y-8 p-4 md:p-6">
      <header>
        <h1 className="text-3xl font-bold text-gray-900 dark:text-white">{system.system_name}</h1>
        <p className="text-gray-500 dark:text-gray-400">
          Ring: {system.ring_no || "Not Assigned"} | Home Node: {system.node?.name}
        </p>
      </header>

      <main>
        {/* Here you can have other system detail cards */}
        
        {/* The new Ring Path Management Component */}
        <SystemRingPath system={system} />
      </main>
    </div>
  );
}
```

**Step 4.2: The Ring Path Management Component**

This is the main interactive component for building the path.

**File:** `components/systems/SystemRingPath.tsx`
```typescript
"use client";

import { useState } from "react";
import { createClient } from "@/utils/supabase/client";
import { useTableQuery, useTableInsert } from "@/hooks/database";
import { useSystemPath } from "@/hooks/database/path-queries";
import { Button } from "@/components/common/ui/Button";
import { FiPlus } from "react-icons/fi";
import { AddSegmentModal } from "./AddSegmentModal"; // We will create this next
import { toast } from "sonner";
import { Row } from "@/hooks/database";

interface Props {
  system: Row<'systems'> & { node: Row<'nodes'> | null };
}

export function SystemRingPath({ system }: Props) {
  const supabase = createClient();
  const [isModalOpen, setIsModalOpen] = useState(false);

  // For this example, we assume one logical path per system ring.
  // A more advanced implementation might allow multiple paths.
  const { data: logicalPath, refetch: refetchLogicalPath } = useTableQuery(supabase, 'logical_fiber_paths', {
    filters: { source_system_id: system.id },
    limit: 1
  });
  const path = logicalPath?.[0];

  const { data: pathSegments, isLoading, refetch: refetchSegments } = useSystemPath(path?.id || null);

  const { mutate: createPath } = useTableInsert(supabase, 'logical_fiber_paths', {
    onSuccess: () => {
        toast.success("Logical path created. You can now add segments.");
        refetchLogicalPath();
    }
  });

  const handleCreatePath = () => {
    createPath({
        path_name: `${system.system_name} Ring Path`,
        source_system_id: system.id,
        path_type_id: null, // You can fetch a default "Ring" type ID here
    });
  };

  return (
    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md border dark:border-gray-700">
      <div className="p-4 border-b dark:border-gray-700 flex justify-between items-center">
        <h3 className="text-xl font-semibold">Ring Path Builder</h3>
        {!path ? (
            <Button onClick={handleCreatePath}>Initialize Path</Button>
        ) : (
            <Button onClick={() => setIsModalOpen(true)} icon={<FiPlus />}>Add Segment</Button>
        )}
      </div>

      <div className="p-4">
        {isLoading && <p>Loading path...</p>}
        {!isLoading && (!pathSegments || pathSegments.length === 0) && (
            <p className="text-gray-500 text-center py-8">
                {path ? "No segments defined for this path. Click 'Add Segment' to begin." : "Initialize the path to start building."}
            </p>
        )}
        {pathSegments && pathSegments.length > 0 && (
          <ol className="relative border-l border-gray-200 dark:border-gray-700 ml-4">
            {pathSegments.map((segment, index) => (
              <li key={segment.id} className="mb-6 ml-6">
                <span className="absolute flex items-center justify-center w-8 h-8 bg-blue-100 rounded-full -left-4 ring-8 ring-white dark:ring-gray-800 dark:bg-blue-900">
                  {segment.path_order}
                </span>
                <div className="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border dark:border-gray-600">
                    <h4 className="font-semibold text-gray-900 dark:text-white">{segment.route_name}</h4>
                    <p className="text-sm text-gray-500 dark:text-gray-400">
                        {segment.start_node_name} → {segment.end_node_name}
                    </p>
                </div>
              </li>
            ))}
          </ol>
        )}
      </div>

      {isModalOpen && path && system.node && (
        <AddSegmentModal
          isOpen={isModalOpen}
          onClose={() => setIsModalOpen(false)}
          logicalPathId={path.id}
          sourceNodeId={system.node.id}
          currentSegments={pathSegments || []}
          onSegmentAdded={() => {
            refetchSegments();
            setIsModalOpen(false);
          }}
        />
      )}
    </div>
  );
}
```

**Step 4.3: The "Smart" Segment Selector Modal**

This modal will contain the logic to show only valid next cable segments.

**File:** `components/systems/AddSegmentModal.tsx`
```typescript
"use client";

import { useAvailablePathSegments } from "@/hooks/database/path-queries";
import { Modal } from "../common/ui/Modal";
import { useState } from "react";
import { Button } from "../common/ui/Button";
import { useTableInsert } from "@/hooks/database";
import { createClient } from "@/utils/supabase/client";
import { toast } from "sonner";
import { Row } from "@/hooks/database";

interface Props {
  isOpen: boolean;
  onClose: () => void;
  logicalPathId: string;
  sourceNodeId: string;
  currentSegments: Row<'v_system_ring_paths_detailed'>[];
  onSegmentAdded: () => void;
}

export function AddSegmentModal({ isOpen, onClose, logicalPathId, sourceNodeId, currentSegments, onSegmentAdded }: Props) {
  const [selectedCableId, setSelectedCableId] = useState<string | null>(null);
  const supabase = createClient();
  
  const { data: availableCables, isLoading } = useAvailablePathSegments(sourceNodeId, currentSegments);

  const { mutate: addSegment, isPending } = useTableInsert(supabase, 'logical_path_segments', {
    onSuccess: () => {
        toast.success("Segment added to path!");
        onSegmentAdded();
    },
    onError: (err) => toast.error(`Failed to add segment: ${err.message}`)
  });

  const handleAdd = () => {
    if (!selectedCableId) {
        toast.error("Please select a cable segment.");
        return;
    }
    addSegment({
        logical_path_id: logicalPathId,
        ofc_cable_id: selectedCableId,
        path_order: (currentSegments.length || 0) + 1,
    });
  };

  return (
    <Modal isOpen={isOpen} onClose={onClose} title="Add Next Path Segment">
      <div className="space-y-4">
        <label htmlFor="cable-select" className="block text-sm font-medium text-gray-700 dark:text-gray-300">
          Available Cables
        </label>
        {isLoading && <p>Loading available cables...</p>}
        {!isLoading && (!availableCables || availableCables.length === 0) && (
            <p className="text-gray-500">No further connecting cables found.</p>
        )}
        {availableCables && availableCables.length > 0 && (
            <select
                id="cable-select"
                className="w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white"
                value={selectedCableId || ""}
                onChange={(e) => setSelectedCableId(e.target.value)}
            >
                <option value="" disabled>Select a cable...</option>
                {availableCables.map((cable: any) => (
                    <option key={cable.id} value={cable.id}>
                        {cable.route_name} ({cable.sn.name} → {cable.en.name})
                    </option>
                ))}
            </select>
        )}
        <div className="flex justify-end gap-2 pt-4">
            <Button variant="outline" onClick={onClose} disabled={isPending}>Cancel</Button>
            <Button onClick={handleAdd} disabled={isPending || !selectedCableId}>
                {isPending ? "Adding..." : "Add to Path"}
            </Button>
        </div>
      </div>
    </Modal>
  );
}```

This completes the full implementation. You now have a robust system for defining physical paths, a UI for managing them, and a clear next step for provisioning services onto the individual fibers.

Yes, absolutely. To make the new "System Ring Path" feature fully functional, robust, and user-friendly, several more components, hooks, and backend functions are required. The previous plan laid the foundation; this phase builds the complete house on top of it.

Here is a full list of the additional pieces needed to create a complete, production-ready feature.

---

### **1. UI Components: Enhancing the User Experience**

These components are essential for making the path management feature intuitive.

#### **1.1. Component: Create Path Modal**

The user needs a way to create the initial `logical_fiber_path` record before they can add segments to it.

**File:** `components/systems/CreatePathModal.tsx`
```typescript
"use client";

import { useForm, Controller } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { logicalFiberPathSchema, LogicalFiberPath } from "@/schemas/schema";
import { useTableInsert, useTableQuery } from "@/hooks/database";
import { createClient } from "@/utils/supabase/client";
import { Modal } from "../common/ui/Modal";
import { Button } from "../common/ui/Button";
import { Input } from "../common/ui/Input";
import { SearchableSelect } from "../common/SearchableSelect";
import { toast } from "sonner";
import { Row } from "@/hooks/database";

interface Props {
  isOpen: boolean;
  onClose: () => void;
  system: Row<'systems'>;
  onPathCreated: () => void;
}

// Form schema for creating a new path
const createPathFormSchema = logicalFiberPathSchema.pick({
  path_name: true,
  path_type_id: true,
  destination_system_id: true,
  remark: true,
});
type CreatePathForm = Zod.infer<typeof createPathFormSchema>;

export function CreatePathModal({ isOpen, onClose, system, onPathCreated }: Props) {
  const supabase = createClient();
  const { control, handleSubmit, register, formState: { errors, isSubmitting } } = useForm<CreatePathForm>({
    resolver: zodResolver(createPathFormSchema),
  });

  // Fetch path types and other systems for the dropdowns
  const { data: pathTypes } = useTableQuery(supabase, 'lookup_types', { filters: { category: 'PATH_TYPES' } });
  const { data: systems } = useTableQuery(supabase, 'systems', { filters: { id: { operator: 'neq', value: system.id } } });

  const { mutate: createPath } = useTableInsert(supabase, 'logical_fiber_paths', {
    onSuccess: () => {
      toast.success("Logical path created successfully.");
      onPathCreated();
      onClose();
    },
    onError: (err) => toast.error(`Failed to create path: ${err.message}`),
  });

  const onSubmit = (formData: CreatePathForm) => {
    createPath({
      ...formData,
      source_system_id: system.id,
    });
  };

  return (
    <Modal isOpen={isOpen} onClose={onClose} title="Create New Logical Path">
      <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
        <div>
          <label className="block text-sm font-medium mb-1">Path Name*</label>
          <Input {...register("path_name")} placeholder="e.g., Primary Ring to Site B" />
          {errors.path_name && <p className="text-red-500 text-xs mt-1">{errors.path_name.message}</p>}
        </div>

        <Controller
          name="path_type_id"
          control={control}
          render={({ field }) => (
            <SearchableSelect
              label="Path Type"
              options={pathTypes?.map(pt => ({ value: pt.id, label: pt.name })) || []}
              value={field.value || ""}
              onChange={val => field.onChange(val)}
              placeholder="Select path type..."
            />
          )}
        />
        
        <Controller
          name="destination_system_id"
          control={control}
          render={({ field }) => (
            <SearchableSelect
              label="Destination System"
              options={systems?.map(s => ({ value: s.id, label: s.system_name || s.id })) || []}
              value={field.value || ""}
              onChange={val => field.onChange(val)}
              placeholder="Select destination system..."
            />
          )}
        />
        
        <div>
          <label className="block text-sm font-medium mb-1">Remarks</label>
          <textarea {...register("remark")} className="w-full rounded-md border-gray-300 dark:bg-gray-700" rows={3} />
        </div>

        <div className="flex justify-end gap-2 pt-4">
          <Button type="button" variant="outline" onClick={onClose} disabled={isSubmitting}>Cancel</Button>
          <Button type="submit" disabled={isSubmitting}>
            {isSubmitting ? "Creating..." : "Create Path"}
          </Button>
        </div>
      </form>
    </Modal>
  );
}
```

#### **1.2. Component: Path Visualizer**

A visual representation is much better than a simple list for understanding the path. This component will render the nodes and cables in sequence.

**File:** `components/systems/PathVisualizer.tsx`
```typescript
"use client";

import { FiServer, FiGitMerge, FiMoreHorizontal } from "react-icons/fi";
import { Row } from "@/hooks/database";

interface Props {
  segments: Row<'v_system_ring_paths_detailed'>[];
  sourceNodeName: string;
}

export function PathVisualizer({ segments, sourceNodeName }: Props) {
  if (!segments || segments.length === 0) return null;
  
  return (
    <div className="p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
      <div className="flex items-center overflow-x-auto pb-4">
        {/* Start Node */}
        <div className="flex flex-col items-center flex-shrink-0 mx-2">
          <FiServer className="w-8 h-8 text-blue-500" />
          <p className="text-xs font-semibold mt-1 max-w-[80px] text-center truncate">{sourceNodeName}</p>
        </div>

        {/* Segments */}
        {segments.map(segment => (
          <div key={segment.id} className="flex items-center flex-shrink-0">
            <div className="flex flex-col items-center mx-2">
              <FiMoreHorizontal className="w-6 h-6 text-gray-400" />
              <p className="text-xs mt-1 max-w-[80px] text-center text-gray-500 truncate" title={segment.route_name || ''}>
                {segment.route_name}
              </p>
            </div>
            <div className="flex flex-col items-center flex-shrink-0 mx-2">
              <FiServer className="w-8 h-8 text-blue-500" />
              <p className="text-xs font-semibold mt-1 max-w-[80px] text-center truncate">{segment.end_node_name}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}
```

---

### **2. Database Functions (RPC): For Data Integrity**

Handling complex logic like reordering or ensuring fiber continuity is safer and more performant inside the database.

**File:** `supabase/migrations/<timestamp>_path_management_functions.sql`

```sql
-- Function to safely delete a path segment and re-order the subsequent ones.
CREATE OR REPLACE FUNCTION public.delete_path_segment_and_reorder(
    p_segment_id UUID,
    p_path_id UUID
) RETURNS void AS $$
DECLARE
    deleted_order INT;
BEGIN
    -- Get the order of the segment being deleted
    SELECT path_order INTO deleted_order FROM public.logical_path_segments
    WHERE id = p_segment_id AND logical_path_id = p_path_id;

    IF FOUND THEN
        -- Delete the specified segment
        DELETE FROM public.logical_path_segments WHERE id = p_segment_id;

        -- Update the order of all subsequent segments in the same path
        UPDATE public.logical_path_segments
        SET path_order = path_order - 1
        WHERE logical_path_id = p_path_id AND path_order > deleted_order;
    END IF;
END;
$$ LANGUAGE plpgsql;

-- Function to find continuous, unassigned fibers across all segments of a logical path.
CREATE OR REPLACE FUNCTION public.get_continuous_available_fibers(
    p_path_id UUID
) RETURNS TABLE(fiber_no INT) AS $$
BEGIN
    RETURN QUERY
    WITH path_cables AS (
        -- Get all cables for the given logical path
        SELECT ofc_cable_id
        FROM public.logical_path_segments
        WHERE logical_path_id = p_path_id AND ofc_cable_id IS NOT NULL
    ),
    available_fibers_per_cable AS (
        -- Find all available fibers for each cable in the path
        SELECT
            oc.ofc_id,
            oc.fiber_no_sn
        FROM
            public.ofc_connections oc
        WHERE
            oc.ofc_id IN (SELECT ofc_cable_id FROM path_cables)
            AND oc.logical_path_id IS NULL -- Fiber is not assigned to any path
            AND oc.status = TRUE -- Fiber is active
    )
    -- Find fibers that are available in ALL cables of the path
    SELECT fiber_no_sn::INT
    FROM available_fibers_per_cable
    GROUP BY fiber_no_sn
    HAVING COUNT(DISTINCT ofc_id) = (SELECT COUNT(*) FROM path_cables);
END;
$$ LANGUAGE plpgsql;

-- Function to provision a selected fiber across all segments of a path atomically.
CREATE OR REPLACE FUNCTION public.provision_fiber_on_path(
    p_path_id UUID,
    p_fiber_no INT
) RETURNS void AS $$
BEGIN
    UPDATE public.ofc_connections
    SET logical_path_id = p_path_id
    WHERE
        fiber_no_sn = p_fiber_no
        AND ofc_id IN (
            SELECT ofc_cable_id
            FROM public.logical_path_segments
            WHERE logical_path_id = p_path_id AND ofc_cable_id IS NOT NULL
        );
    
    -- Set the logical path status to active
    UPDATE public.logical_fiber_paths
    SET operational_status = 'active'
    WHERE id = p_path_id;
END;
$$ LANGUAGE plpgsql;
```

---

### **3. Frontend Hooks: For the New Mutations**

Create a dedicated file for hooks that call these new database functions.

**File:** `hooks/database/path-mutations.ts`
```typescript
"use client";

import { useMutation, useQueryClient } from "@tanstack/react-query";
import { createClient } from "@/utils/supabase/client";
import { toast } from "sonner";

const supabase = createClient();

/**
 * Hook to call the RPC function for deleting a path segment.
 */
export function useDeletePathSegment() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async ({ segmentId, pathId }: { segmentId: string, pathId: string }) => {
      const { error } = await supabase.rpc('delete_path_segment_and_reorder', {
        p_segment_id: segmentId,
        p_path_id: pathId,
      });
      if (error) throw error;
    },
    onSuccess: (_, { pathId }) => {
      toast.success("Path segment deleted.");
      // Refetch the detailed path to update the UI
      queryClient.invalidateQueries({ queryKey: ['system-path', pathId] });
    },
    onError: (err) => toast.error(`Failed to delete segment: ${err.message}`),
  });
}

/**
 * Hook to call the RPC function for provisioning a fiber onto a path.
 */
export function useProvisionFiber() {
    const queryClient = useQueryClient();
    return useMutation({
        mutationFn: async ({ pathId, fiberNo }: { pathId: string, fiberNo: number }) => {
            const { error } = await supabase.rpc('provision_fiber_on_path', {
                p_path_id: pathId,
                p_fiber_no: fiberNo
            });
            if (error) throw error;
        },
        onSuccess: (_, { pathId }) => {
            toast.success("Fiber provisioned successfully!");
            queryClient.invalidateQueries({ queryKey: ['system-path', pathId] });
            // Also invalidate fiber availability queries if you have them
            queryClient.invalidateQueries({ queryKey: ['available-fibers', pathId] }); 
        },
        onError: (err) => toast.error(`Provisioning failed: ${err.message}`),
    });
}
```

---

### **4. Schema/Type Updates for RPCs**

To ensure your new hooks are fully type-safe, add the return types for the RPCs to your Supabase types file.

**File:** `types/supabase-types.ts`
*After running `supabase gen types`*, your `Functions` section should include the new RPCs. If you are not regenerating, you can add them manually for now:
```typescript
// Inside Database['public']['Functions']
// ...
delete_path_segment_and_reorder: {
    Args: { p_segment_id: string; p_path_id: string; };
    Returns: void;
};
get_continuous_available_fibers: {
    Args: { p_path_id: string; };
    Returns: { fiber_no: number }[];
};
provision_fiber_on_path: {
    Args: { p_path_id: string; p_fiber_no: number; };
    Returns: void;
};
// ...
```

This full set of changes provides a complete, robust, and maintainable implementation for the advanced system ring path feature.

Excellent question. Now that the core feature is designed, we can focus on the professional-grade enhancements that turn a great application into an exceptional one. These suggestions address usability, data integrity, and long-term architectural health.

Here are further improvements, categorized for clarity.

### 1. Advanced User Experience (UX) & Interface Polish

These features will make the new path management tool more intuitive and powerful for the end-user.

#### **Suggestion 1.1: Drag-and-Drop Reordering for Path Segments**

*   **Observation:** The current design allows adding and deleting segments. If a user adds a segment in the wrong order, they would have to delete several segments and re-add them correctly, which is cumbersome.
*   **Improvement:** Implement a drag-and-drop interface for the list of segments in the `SystemRingPath` component. Libraries like `dnd-kit` or `react-beautiful-dnd` are perfect for this. When a user drops a segment into a new position, you would call a new RPC function.
*   **Backend RPC Function (`reorder_path_segments`):** This database function would take the `logical_path_id` and an array of `ofc_cable_id`s in their new order. It would then re-number the `path_order` column for all segments in that path atomically within a transaction.
*   **Benefit:** Provides a vastly superior and more intuitive user experience for managing complex paths. It reduces user error and frustration.

#### **Suggestion 1.2: Interactive Path Visualizer**

*   **Observation:** The `PathVisualizer` component shows the path but is static.
*   **Improvement:** Make the visualizer interactive.
    *   When a user hovers over a node (`<FiServer />`) or segment (`<FiMoreHorizontal />`) in the visualizer, highlight the corresponding row in the detailed list below it.
    *   Clicking a node in the visualizer could open a small popover with key details about that node (IP address, type, etc.).
    *   This can be achieved with simple `onMouseEnter` and `onMouseLeave` event handlers and shared state between the visualizer and the list.
*   **Benefit:** Creates a much richer connection between the visual representation and the detailed data, making it easier for network engineers to understand the topology at a glance.

#### **Suggestion 1.3: A Global "Command Palette"**

*   **Observation:** As your application grows with more pages (Nodes, Rings, Systems, Users), navigation can become cumbersome.
*   **Improvement:** Implement a command palette (often triggered by `Cmd+K` or `Ctrl+K`). This is a central search bar that allows users to instantly jump to any page or even search for specific records (e.g., typing "Node-XYZ" could offer a link directly to that node's detail page). Libraries like `cmdk` make this very easy to implement.
*   **Benefit:** Massively improves navigation speed and usability for power users, making the entire application feel faster and more professional.

---

### 2. Data Integrity and Lifecycle Management

These suggestions ensure your data remains consistent and reliable as users interact with it.

#### **Suggestion 2.1: Pre-Deletion Checks & Cascade Warnings**

*   **Observation:** Your `ofc_cable_id` foreign key has `ON DELETE RESTRICT`. This is good for data integrity, as it prevents a cable from being deleted if it's part of a system path. However, the user will just see a generic "foreign key violation" error from the database.
*   **Improvement:** Before allowing a user to delete an `ofc_cable` (from the `app/dashboard/ofc/page.tsx`), perform a pre-check. In your `onDelete` handler:
    1.  First, query the `logical_path_segments` table to see if the `ofc_cable_id` exists.
    2.  If it does, show a user-friendly error toast: `toast.error("Cannot delete this cable because it is part of one or more system ring paths.")` instead of proceeding with the deletion.
*   **Benefit:** Prevents confusing database errors and provides clear, actionable feedback to the user, improving their confidence in the system.

#### **Suggestion 2.2: Implement User Activity Logging**

*   **Observation:** Your `user_activity_logs` table is defined in the schema but is not yet used. For a system managing critical infrastructure, an audit trail is essential.
*   **Improvement:** Create a database trigger or use a Supabase Function that automatically logs changes to key tables like `systems`, `ofc_cables`, and `logical_path_segments`.
    *   **Trigger Function:** Create a generic function that takes the old and new row data and logs the `user_id` (from `auth.uid()`), the action (`INSERT`, `UPDATE`, `DELETE`), and a JSON diff of the changes.
    *   **Attach Trigger:** Attach this function to the tables you want to audit.
*   **Benefit:** Creates an invaluable audit trail. When a system path goes down, you can instantly see who changed the path, what they changed, and when they changed it, which is critical for diagnostics and accountability.

---

### 3. Architectural Refinements & Future-Proofing

#### **Suggestion 3.1: Full Offline Support with PWA Caching**

*   **Observation:** You have a PWA manifest and an `OfflineStatus` component, which is a great start. However, the app doesn't currently cache data for offline use.
*   **Improvement:** Implement a service worker with caching strategies.
    1.  **Cache Static Assets:** Cache your application shell (JS, CSS, fonts).
    2.  **Stale-While-Revalidate for API Data:** For data like node lists or system lists, serve the cached data immediately for a fast UI response, and then fetch fresh data in the background to update the cache for the next visit.
    3.  **Offline Mutations:** Use a library like `Dexie.js` (IndexedDB wrapper) to store create/update/delete actions made while offline. When the connection is restored, sync these pending changes to Supabase.
*   **Benefit:** This is a game-changer for field technicians who may be working in areas with poor connectivity. They can still view network data and queue up changes, making the application a reliable tool in any environment.

#### **Suggestion 3.2: Versioning Your API**

*   **Observation:** Your API routes are at `app/api/evolve/...`. As you add more complex features, you might need to change the request or response shapes of these APIs.
*   **Improvement:** Introduce versioning into your API paths from the start. Your existing routes `app/api/v1/...` are perfect. Standardize on this pattern for all new API endpoints.
    *   New Route: `app/api/v1/systems/[id]/paths`
*   **Benefit:** Allows you to evolve your backend API without breaking older versions of the client application. It's a fundamental practice for building stable, long-lasting applications.
*   

Of course. This is where the application becomes truly powerful. Implementing these features requires a combination of backend logic (database functions), frontend hooks for data management, and interactive UI components.

Here is the full code and step-by-step guide to implement these advanced features.

---

### **Suggestion 1.1: Drag-and-Drop Reordering for Path Segments**

This will involve installing a new library, adding a database function, creating a mutation hook, and updating the UI component.

#### **Step 1: Install `dnd-kit`**

This is a modern, performant, and accessible library for drag-and-drop.

```bash
npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
```

#### **Step 2: Create the Backend RPC Function**

This function will atomically reorder the segments in the database.

**File:** `supabase/migrations/<timestamp>_reorder_segments.sql`
```sql
CREATE OR REPLACE FUNCTION public.reorder_path_segments(
    p_path_id UUID,
    p_segment_ids UUID[]
) RETURNS void AS $$
BEGIN
    -- Use a transaction to ensure all updates succeed or none do.
    BEGIN
        -- Use unnest with ordinality to update the path_order for each segment
        -- based on its position in the provided array.
        UPDATE public.logical_path_segments AS srp
        SET path_order = new_order.idx
        FROM (
            SELECT
                id,
                idx
            FROM
                unnest(p_segment_ids) WITH ORDINALITY AS t(id, idx)
        ) AS new_order
        WHERE
            srp.id = new_order.id AND
            srp.logical_path_id = p_path_id;
    END;
END;
$$ LANGUAGE plpgsql;
```

#### **Step 3: Create the Frontend Mutation Hook**

**File:** `hooks/database/path-mutations.ts` (add this new hook)
```typescript
// ... (keep existing hooks)

/**
 * Hook to call the RPC function for reordering path segments.
 */
export function useReorderPathSegments() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async ({ pathId, segmentIds }: { pathId: string, segmentIds: string[] }) => {
      const { error } = await supabase.rpc('reorder_path_segments', {
        p_path_id: pathId,
        p_segment_ids: segmentIds,
      });
      if (error) throw error;
    },
    onSuccess: (_, { pathId }) => {
      toast.success("Path reordered successfully.");
      queryClient.invalidateQueries({ queryKey: ['system-path', pathId] });
    },
    onError: (err) => toast.error(`Failed to reorder path: ${err.message}`),
  });
}
```

#### **Step 4: Update the UI Component (`SystemRingPath.tsx`)**

This is the most significant change. We will integrate `dnd-kit` to make the segment list draggable.

**File:** `components/systems/SystemRingPath.tsx` (fully updated version)
```typescript
"use client";

import { useState } from "react";
import { createClient } from "@/utils/supabase/client";
import { useTableQuery } from "@/hooks/database";
import { useSystemPath } from "@/hooks/database/path-queries";
import { Button } from "@/components/common/ui/Button";
import { FiPlus, FiTrash2, FiMove } from "react-icons/fi";
import { AddSegmentModal } from "./AddSegmentModal";
import { toast } from "sonner";
import { Row } from "@/hooks/database";
import { CreatePathModal } from "./CreatePathModal";
import { useDeletePathSegment, useReorderPathSegments } from "@/hooks/database/path-mutations";

// Dnd-kit imports
import { DndContext, closestCenter, PointerSensor, useSensor, useSensors } from '@dnd-kit/core';
import { SortableContext, useSortable, verticalListSortingStrategy } from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';

interface Props {
  system: Row<'systems'> & { node: Row<'nodes'> | null };
}

// Sub-component for a single draggable segment item
function SortableSegmentItem({ segment, onDelete }: { segment: Row<'v_system_ring_paths_detailed'>, onDelete: () => void }) {
    const { attributes, listeners, setNodeRef, transform, transition } = useSortable({ id: segment.id });

    const style = {
        transform: CSS.Transform.toString(transform),
        transition,
    };

    return (
        <li ref={setNodeRef} style={style} className="mb-6 ml-6 flex items-center gap-4">
             <span className="absolute flex items-center justify-center w-8 h-8 bg-blue-100 rounded-full -left-4 ring-8 ring-white dark:ring-gray-800 dark:bg-blue-900">
                {segment.path_order}
            </span>
            <div className="flex-1 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border dark:border-gray-600">
                <h4 className="font-semibold text-gray-900 dark:text-white">{segment.route_name}</h4>
                <p className="text-sm text-gray-500 dark:text-gray-400">
                    {segment.start_node_name} → {segment.end_node_name}
                </p>
            </div>
            <div className="flex items-center gap-2">
                <Button variant="ghost" size="sm" onClick={onDelete} className="text-red-500 hover:bg-red-100">
                    <FiTrash2 />
                </Button>
                <Button variant="ghost" size="sm" {...attributes} {...listeners} className="cursor-grab active:cursor-grabbing">
                    <FiMove />
                </Button>
            </div>
        </li>
    );
}

export function SystemRingPath({ system }: Props) {
  const supabase = createClient();
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [isCreatePathModalOpen, setisCreatePathModalOpen] = useState(false);

  const { data: logicalPath, refetch: refetchLogicalPath } = useTableQuery(supabase, 'logical_fiber_paths', {
    filters: { source_system_id: system.id },
    limit: 1
  });
  const path = logicalPath?.[0];

  const { data: pathSegments, isLoading, refetch: refetchSegments } = useSystemPath(path?.id || null);

  const deleteSegmentMutation = useDeletePathSegment();
  const reorderSegmentsMutation = useReorderPathSegments();

  const sensors = useSensors(useSensor(PointerSensor));

  const handleDragEnd = (event: any) => {
    const { active, over } = event;
    if (active.id !== over.id && pathSegments) {
      const oldIndex = pathSegments.findIndex(s => s.id === active.id);
      const newIndex = pathSegments.findIndex(s => s.id === over.id);

      const reorderedSegments = Array.from(pathSegments);
      const [movedItem] = reorderedSegments.splice(oldIndex, 1);
      reorderedSegments.splice(newIndex, 0, movedItem);

      const newSegmentIds = reorderedSegments.map(s => s.id);
      reorderSegmentsMutation.mutate({ pathId: path.id, segmentIds: newSegmentIds });
    }
  };

  const handleDeleteSegment = (segmentId: string) => {
    if (window.confirm("Are you sure you want to remove this segment from the path?")) {
      deleteSegmentMutation.mutate({ segmentId, pathId: path.id });
    }
  };

  return (
    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md border dark:border-gray-700">
      <div className="p-4 border-b dark:border-gray-700 flex justify-between items-center">
        <h3 className="text-xl font-semibold">Ring Path Builder</h3>
        {!path ? (
            <Button onClick={() => setisCreatePathModalOpen(true)}>Initialize Path</Button>
        ) : (
            <Button onClick={() => setIsModalOpen(true)} leftIcon={<FiPlus />}>Add Segment</Button>
        )}
      </div>

      <div className="p-4">
        {isLoading && <p>Loading path...</p>}
        {!isLoading && (!pathSegments || pathSegments.length === 0) && (
            <p className="text-gray-500 text-center py-8">
                {path ? "No segments defined. Click 'Add Segment' to begin." : "Initialize the path to start building."}
            </p>
        )}
        {pathSegments && pathSegments.length > 0 && (
            <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={handleDragEnd}>
                <SortableContext items={pathSegments.map(s => s.id)} strategy={verticalListSortingStrategy}>
                    <ol className="relative border-l border-gray-200 dark:border-gray-700 ml-4">
                        {pathSegments.map(segment => (
                            <SortableSegmentItem 
                                key={segment.id} 
                                segment={segment} 
                                onDelete={() => handleDeleteSegment(segment.id)}
                            />
                        ))}
                    </ol>
                </SortableContext>
            </DndContext>
        )}
      </div>

      {isModalOpen && path && system.node && (
        <AddSegmentModal
          isOpen={isModalOpen}
          onClose={() => setIsModalOpen(false)}
          logicalPathId={path.id}
          sourceNodeId={system.node.id}
          currentSegments={pathSegments || []}
          onSegmentAdded={() => {
            refetchSegments();
            setIsModalOpen(false);
          }}
        />
      )}
      {isCreatePathModalOpen && (
          <CreatePathModal 
            isOpen={isCreatePathModalOpen}
            onClose={() => setisCreatePathModalOpen(false)}
            system={system}
            onPathCreated={refetchLogicalPath}
          />
      )}
    </div>
  );
}
```

---

### **Suggestion 1.2: Interactive Path Visualizer**

Let's make the visualizer and the list communicate by sharing hover state.

**File:** `components/systems/SystemRingPath.tsx` (updated again)
```typescript
// ... (keep all the dnd-kit imports and logic from above)
import { PathVisualizer } from './PathVisualizer'; // We will create this
import { PathSegmentList } from './PathSegmentList'; // We will also create this

// ...
export function SystemRingPath({ system }: Props) {
  // ... (keep all the existing state and hooks)
  const [hoveredItemId, setHoveredItemId] = useState<string | null>(null);

  // ... (keep the handleDragEnd and handleDeleteSegment functions)

  return (
    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md border dark:border-gray-700">
      <div className="p-4 border-b dark:border-gray-700 flex justify-between items-center">
        {/* ... (header content remains the same) */}
      </div>

      {/* NEW: Pass hover state to the visualizer */}
      <PathVisualizer
        segments={pathSegments || []}
        sourceNodeName={system.node?.name || 'Source'}
        hoveredItemId={hoveredItemId}
        setHoveredItemId={setHoveredItemId}
      />
      
      <div className="p-4">
        {isLoading && <p>Loading path...</p>}
        {!isLoading && (!pathSegments || pathSegments.length === 0) && (
          <p className="text-gray-500 text-center py-8">{/* ... */}</p>
        )}
        {pathSegments && pathSegments.length > 0 && (
          // NEW: The drag-and-drop list is now its own component
          <PathSegmentList
            segments={pathSegments}
            onDragEnd={handleDragEnd}
            onDelete={handleDeleteSegment}
            hoveredItemId={hoveredItemId}
            setHoveredItemId={setHoveredItemId}
          />
        )}
      </div>

      {/* ... (modals remain the same) */}
    </div>
  );
}
```

**New File:** `components/systems/PathSegmentList.tsx`
```typescript
"use client";

import { Row } from "@/hooks/database";
import { DndContext, closestCenter, PointerSensor, useSensor, useSensors, DragEndEvent } from '@dnd-kit/core';
import { SortableContext, useSortable, verticalListSortingStrategy } from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';
import { Button } from "../common/ui/Button";
import { FiTrash2, FiMove } from "react-icons/fi";

interface SortableItemProps {
    segment: Row<'v_system_ring_paths_detailed'>;
    onDelete: () => void;
    isHovered: boolean;
    onHover: (id: string | null) => void;
}

function SortableSegmentItem({ segment, onDelete, isHovered, onHover }: SortableItemProps) {
    const { attributes, listeners, setNodeRef, transform, transition } = useSortable({ id: segment.id });
    const style = { transform: CSS.Transform.toString(transform), transition };

    return (
        <li
            ref={setNodeRef}
            style={style}
            onMouseEnter={() => onHover(segment.id)}
            onMouseLeave={() => onHover(null)}
            className={`mb-6 ml-6 flex items-center gap-4 p-2 rounded-lg transition-all ${isHovered ? 'bg-blue-100 dark:bg-blue-900/50 ring-2 ring-blue-400' : ''}`}
        >
            <span className={`absolute flex items-center justify-center w-8 h-8 rounded-full -left-4 ring-8 ${isHovered ? 'ring-blue-100 dark:ring-blue-900/50' : 'ring-white dark:ring-gray-800'} bg-blue-100 dark:bg-blue-900`}>
                {segment.path_order}
            </span>
            <div className="flex-1 bg-gray-50 dark:bg-gray-700 rounded-lg border dark:border-gray-600 p-3">
                <h4 className="font-semibold text-gray-900 dark:text-white">{segment.route_name}</h4>
                <p className="text-sm text-gray-500 dark:text-gray-400">{segment.start_node_name} → {segment.end_node_name}</p>
            </div>
            <div className="flex items-center gap-2">
                <Button variant="ghost" size="sm" onClick={onDelete} className="text-red-500 hover:bg-red-100"><FiTrash2 /></Button>
                <Button variant="ghost" size="sm" {...attributes} {...listeners} className="cursor-grab active:cursor-grabbing"><FiMove /></Button>
            </div>
        </li>
    );
}


interface ListProps {
    segments: Row<'v_system_ring_paths_detailed'>[];
    onDragEnd: (event: DragEndEvent) => void;
    onDelete: (id: string) => void;
    hoveredItemId: string | null;
    setHoveredItemId: (id: string | null) => void;
}

export function PathSegmentList({ segments, onDragEnd, onDelete, hoveredItemId, setHoveredItemId }: ListProps) {
    const sensors = useSensors(useSensor(PointerSensor));

    return (
        <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={onDragEnd}>
            <SortableContext items={segments.map(s => s.id)} strategy={verticalListSortingStrategy}>
                <ol className="relative border-l border-gray-200 dark:border-gray-700 ml-4">
                    {segments.map(segment => (
                        <SortableSegmentItem
                            key={segment.id}
                            segment={segment}
                            onDelete={() => onDelete(segment.id)}
                            isHovered={hoveredItemId === segment.id}
                            onHover={setHoveredItemId}
                        />
                    ))}
                </ol>
            </SortableContext>
        </DndContext>
    );
}
```

**Updated File:** `components/systems/PathVisualizer.tsx`
```typescript
"use client";

import { FiServer, FiMoreHorizontal } from "react-icons/fi";
import { Row } from "@/hooks/database";

interface Props {
  segments: Row<'v_system_ring_paths_detailed'>[];
  sourceNodeName: string;
  hoveredItemId: string | null;
  setHoveredItemId: (id: string | null) => void;
}

export function PathVisualizer({ segments, sourceNodeName, hoveredItemId, setHoveredItemId }: Props) {
  if (!segments || segments.length === 0) return null;
  
  return (
    <div className="p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
      <div className="flex items-center overflow-x-auto pb-4">
        <div 
          className="flex flex-col items-center flex-shrink-0 mx-2 p-2 rounded-lg transition-all"
          onMouseEnter={() => setHoveredItemId(segments[0].start_node_id)}
          onMouseLeave={() => setHoveredItemId(null)}
        >
          <FiServer className={`w-8 h-8 transition-colors ${hoveredItemId === segments[0].start_node_id ? 'text-blue-600' : 'text-blue-500'}`} />
          <p className="text-xs font-semibold mt-1 max-w-[80px] text-center truncate">{sourceNodeName}</p>
        </div>

        {segments.map(segment => (
          <div 
            key={segment.id} 
            className="flex items-center flex-shrink-0 transition-all p-2 rounded-lg"
            onMouseEnter={() => setHoveredItemId(segment.id)}
            onMouseLeave={() => setHoveredItemId(null)}
          >
            <div className="flex flex-col items-center mx-2">
              <FiMoreHorizontal className={`w-6 h-6 transition-colors ${hoveredItemId === segment.id ? 'text-blue-600' : 'text-gray-400'}`} />
              <p className={`text-xs mt-1 max-w-[80px] text-center truncate transition-colors ${hoveredItemId === segment.id ? 'text-blue-600' : 'text-gray-500'}`} title={segment.route_name || ''}>
                {segment.route_name}
              </p>
            </div>
            <div 
              className="flex flex-col items-center flex-shrink-0 mx-2"
              onMouseEnter={() => setHoveredItemId(segment.end_node_id)}
              onMouseLeave={() => setHoveredItemId(null)}
            >
              <FiServer className={`w-8 h-8 transition-colors ${hoveredItemId === segment.end_node_id ? 'text-blue-600' : 'text-blue-500'}`} />
              <p className="text-xs font-semibold mt-1 max-w-[80px] text-center truncate">{segment.end_node_name}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}
```

---

### **Suggestion 2.1: Pre-Deletion Checks & Cascade Warnings**

This logic goes inside your OFC Cables page.

**File:** `app/dashboard/ofc/page.tsx`
```typescript
// ... (keep existing imports and component structure)
import { useDeleteManager } from "@/hooks/useDeleteManager"; // Ensure you are using your enhanced delete manager
import { toast } from "sonner";
import { createClient } from "@/utils/supabase/client";

const OfcPage = () => {
  const supabase = createClient();
  const router = useRouter();
  // ... (all other existing state and hooks)

  const deleteManager = useDeleteManager({
    tableName: "ofc_cables",
    onSuccess: () => refetch(),
  });

  // NEW: Create an async delete handler that performs the pre-check
  const handleDeleteOfc = async (ofcId: string, name: string) => {
    try {
        // 1. Pre-deletion check
        const { count, error: checkError } = await supabase
            .from('logical_path_segments')
            .select('id', { count: 'exact', head: true })
            .eq('ofc_cable_id', ofcId);

        if (checkError) throw new Error(`Failed to check dependencies: ${checkError.message}`);

        // 2. If dependencies exist, show an error toast and stop
        if (count && count > 0) {
            toast.error(`Cannot delete "${name}"`, {
                description: `This cable is currently used in ${count} system path(s). Please remove it from all paths before deleting.`
            });
            return;
        }

        // 3. If no dependencies, proceed with the original delete logic
        deleteManager.deleteSingle({ id: ofcId, name });

    } catch (error) {
        toast.error(error instanceof Error ? error.message : "An unexpected error occurred during pre-deletion check.");
    }
  };

  const actions = useMemo(
    () =>
      GetOfcTableActions({
        // ... (onView, onEdit, onToggleStatus remain the same)
        onDelete: handleDeleteOfc, // Use the new async handler
        isSuperAdmin: isSuperAdmin || false,
      }),
    [pageData, isSuperAdmin, toggleStatus, router]
  );
  
  // ... (rest of the component JSX remains the same)
};

export default OfcPage;
```

---

*Note on Command Palette:* The implementation for a command palette (`cmdk`) is quite involved and would require multiple new components and hooks. I have omitted it from this response to keep the focus on the core features you asked about, but it remains an excellent suggestion for a future enhancement.

Of course. This is an excellent set of features to implement. They significantly enhance the professional feel and usability of the application. I will provide the full, production-ready code for each suggestion, broken down into manageable steps.

---

### **Suggestion 1.1: Drag-and-Drop Reordering for Path Segments**

This feature makes managing complex routes intuitive and efficient.

#### **Step 1: Install Dependencies**

First, you need to add the `dnd-kit` libraries to your project.

```bash
npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
```

#### **Step 2: Create the Database Function**

This function is crucial for atomically reordering the segments. It receives an array of segment IDs in the new desired order and updates the `path_order` column accordingly.

**File:** `supabase/migrations/<timestamp>_reorder_segments.sql`
```sql
-- This function takes a path ID and an array of segment IDs in their new order.
-- It re-numbers the path_order for all segments in that path atomically.
CREATE OR REPLACE FUNCTION public.reorder_path_segments(
    p_path_id UUID,
    p_segment_ids UUID[]
) RETURNS void AS $$
BEGIN
    -- Use a transaction to ensure all updates succeed or none do.
    BEGIN
        -- Use `unnest` with `WITH ORDINALITY` to get the new index (order) for each ID.
        -- Then, update the `logical_path_segments` table by joining on the ID.
        UPDATE public.logical_path_segments AS srp
        SET path_order = new_order.idx
        FROM (
            SELECT
                id,
                idx
            FROM
                unnest(p_segment_ids) WITH ORDINALITY AS t(id, idx)
        ) AS new_order
        WHERE
            srp.id = new_order.id AND
            srp.logical_path_id = p_path_id;
    END;
END;
$$ LANGUAGE plpgsql;
```

#### **Step 3: Create the Frontend Mutation Hook**

This hook will call the new RPC function.

**File:** `hooks/database/path-mutations.ts`
```typescript
"use client";

import { useMutation, useQueryClient } from "@tanstack/react-query";
import { createClient } from "@/utils/supabase/client";
import { toast } from "sonner";

const supabase = createClient();

/**
 * Hook to call the RPC function for deleting a path segment.
 */
export function useDeletePathSegment() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async ({ segmentId, pathId }: { segmentId: string, pathId: string }) => {
      const { error } = await supabase.rpc('delete_path_segment_and_reorder', {
        p_segment_id: segmentId,
        p_path_id: pathId,
      });
      if (error) throw error;
    },
    onSuccess: (_, { pathId }) => {
      toast.success("Path segment deleted.");
      queryClient.invalidateQueries({ queryKey: ['system-path', pathId] });
    },
    onError: (err) => toast.error(`Failed to delete segment: ${err.message}`),
  });
}

/**
 * NEW HOOK: Hook to call the RPC function for reordering path segments.
 */
export function useReorderPathSegments() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: async ({ pathId, segmentIds }: { pathId: string, segmentIds: string[] }) => {
      const { error } = await supabase.rpc('reorder_path_segments', {
        p_path_id: pathId,
        p_segment_ids: segmentIds,
      });
      if (error) throw error;
    },
    onSuccess: (_, { pathId }) => {
      toast.success("Path reordered successfully.");
      queryClient.invalidateQueries({ queryKey: ['system-path', pathId] });
    },
    onError: (err) => toast.error(`Failed to reorder path: ${err.message}`),
  });
}
```

#### **Step 4: Create the Draggable UI Components**

We'll break the list into its own component to manage the drag-and-drop state.

**New File:** `components/systems/PathSegmentList.tsx`
```typescript
"use client";

import { Row } from "@/hooks/database";
import { DndContext, closestCenter, PointerSensor, useSensor, useSensors, DragEndEvent } from '@dnd-kit/core';
import { SortableContext, useSortable, verticalListSortingStrategy } from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';
import { Button } from "../common/ui/Button";
import { FiTrash2, FiMove } from "react-icons/fi";

// Sub-component for a single draggable item
function SortableSegmentItem({ segment, onDelete }: { segment: Row<'v_system_ring_paths_detailed'>, onDelete: () => void }) {
    const { attributes, listeners, setNodeRef, transform, transition } = useSortable({ id: segment.id });

    const style = {
        transform: CSS.Transform.toString(transform),
        transition,
    };

    return (
        <li ref={setNodeRef} style={style} className="mb-6 ml-6 flex items-center gap-4">
             <span className="absolute flex items-center justify-center w-8 h-8 bg-blue-100 rounded-full -left-4 ring-8 ring-white dark:ring-gray-800 dark:bg-blue-900">
                {segment.path_order}
            </span>
            <div className="flex-1 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg border dark:border-gray-600">
                <h4 className="font-semibold text-gray-900 dark:text-white">{segment.route_name}</h4>
                <p className="text-sm text-gray-500 dark:text-gray-400">
                    {segment.start_node_name} → {segment.end_node_name}
                </p>
            </div>
            <div className="flex items-center gap-2">
                <Button variant="ghost" size="sm" onClick={onDelete} className="text-red-500 hover:bg-red-100 dark:hover:bg-red-900/50">
                    <FiTrash2 />
                </Button>
                <Button variant="ghost" size="sm" {...attributes} {...listeners} className="cursor-grab active:cursor-grabbing">
                    <FiMove />
                </Button>
            </div>
        </li>
    );
}

// Main list component that provides the DndContext
interface ListProps {
    segments: Row<'v_system_ring_paths_detailed'>[];
    onDragEnd: (event: DragEndEvent) => void;
    onDelete: (id: string) => void;
}

export function PathSegmentList({ segments, onDragEnd, onDelete }: ListProps) {
    const sensors = useSensors(useSensor(PointerSensor, {
      activationConstraint: {
        distance: 8, // Require pointer to move 8px before dragging starts
      },
    }));

    return (
        <DndContext sensors={sensors} collisionDetection={closestCenter} onDragEnd={onDragEnd}>
            <SortableContext items={segments.map(s => s.id)} strategy={verticalListSortingStrategy}>
                <ol className="relative border-l border-gray-200 dark:border-gray-700 ml-4">
                    {segments.map(segment => (
                        <SortableSegmentItem
                            key={segment.id}
                            segment={segment}
                            onDelete={() => onDelete(segment.id)}
                        />
                    ))}
                </ol>
            </SortableContext>
        </DndContext>
    );
}
```

#### **Step 5: Integrate into the Main Component**

Update `SystemRingPath.tsx` to use the new `PathSegmentList` and handle the drag-end event.

**File:** `components/systems/SystemRingPath.tsx` (Updated)
```typescript
// ... (imports)
import { PathSegmentList } from "./PathSegmentList"; // Import the new component
import { useDeletePathSegment, useReorderPathSegments } from "@/hooks/database/path-mutations";
import { DragEndEvent } from "@dnd-kit/core";

// ... (inside the SystemRingPath component)
export function SystemRingPath({ system }: Props) {
  // ... (existing state and hooks)
  
  const deleteSegmentMutation = useDeletePathSegment();
  const reorderSegmentsMutation = useReorderPathSegments();

  const handleDragEnd = (event: DragEndEvent) => {
    const { active, over } = event;
    if (over && active.id !== over.id && pathSegments) {
      const oldIndex = pathSegments.findIndex(s => s.id === active.id);
      const newIndex = pathSegments.findIndex(s => s.id === over.id);

      // Create a new array with the reordered items
      const reorderedSegments = Array.from(pathSegments);
      const [movedItem] = reorderedSegments.splice(oldIndex, 1);
      reorderedSegments.splice(newIndex, 0, movedItem);

      // Get the array of IDs in the new order
      const newSegmentIds = reorderedSegments.map(s => s.id);
      
      // Call the mutation
      reorderSegmentsMutation.mutate({ pathId: path.id, segmentIds: newSegmentIds });
    }
  };

  const handleDeleteSegment = (segmentId: string) => {
    if (window.confirm("Are you sure you want to remove this segment? The path order will be updated.")) {
      deleteSegmentMutation.mutate({ segmentId, pathId: path.id });
    }
  };

  return (
    // ... (rest of the JSX)
      <div className="p-4">
        {/* ... (loading and empty states) */}
        {pathSegments && pathSegments.length > 0 && (
          <PathSegmentList
            segments={pathSegments}
            onDragEnd={handleDragEnd}
            onDelete={handleDeleteSegment}
          />
        )}
      </div>
    // ... (rest of the JSX)
  );
}
```

---

### **Suggestion 1.3: A Global "Command Palette"**

This feature requires a new library, a backend function, a hook, and integration into your main layout.

#### **Step 1: Install `cmdk`**

```bash
npm install cmdk
```

#### **Step 2: Create the Backend Search Function**

This RPC function searches across multiple tables and returns a unified result set.

**File:** `supabase/migrations/<timestamp>_global_search.sql`
```sql
CREATE OR REPLACE FUNCTION public.global_search(
    search_term TEXT
) RETURNS TABLE(id TEXT, title TEXT, subtitle TEXT, type TEXT, href TEXT) AS $$
BEGIN
    RETURN QUERY
    WITH full_search AS (
        (
            SELECT
                u.id::text,
                u.full_name AS title,
                u.email AS subtitle,
                'user' AS type,
                '/dashboard/users' AS href -- General link, specific user handled on client
            FROM public.v_user_profiles_extended u
            WHERE u.full_name ILIKE '%' || search_term || '%' OR u.email ILIKE '%' || search_term || '%'
            LIMIT 10
        )
        UNION ALL
        (
            SELECT
                n.id::text,
                n.name AS title,
                n.ip_address::text AS subtitle,
                'node' AS type,
                '/dashboard/nodes' AS href
            FROM public.nodes n
            WHERE n.name ILIKE '%' || search_term || '%' OR n.ip_address::text ILIKE '%' || search_term || '%'
            LIMIT 10
        )
        UNION ALL
        (
            SELECT
                s.id::text,
                s.system_name AS title,
                s.ip_address::text AS subtitle,
                'system' AS type,
                '/dashboard/systems/' || s.id::text AS href
            FROM public.systems s
            WHERE s.system_name ILIKE '%' || search_term || '%'
            LIMIT 10
        )
        -- Add more UNION ALL blocks here for other tables like rings, ofc_cables, etc.
    )
    SELECT * FROM full_search
    LIMIT 20; -- Overall limit
END;
$$ LANGUAGE plpgsql;
```

#### **Step 3: Create the Frontend Hook**

This hook debounces user input and calls the RPC function.

**File:** `hooks/useCommandPaletteSearch.ts`
```typescript
"use client";

import { useState } from "react";
import { useQuery } from "@tanstack/react-query";
import { useDebounce } from "use-debounce";
import { createClient } from "@/utils/supabase/client";

export interface SearchResult {
  id: string;
  title: string;
  subtitle: string;
  type: 'user' | 'node' | 'system' | 'page'; // Extend with more types
  href: string;
}

const supabase = createClient();

export function useCommandPaletteSearch() {
  const [query, setQuery] = useState('');
  const [debouncedQuery] = useDebounce(query, 300);

  const { data, isLoading } = useQuery({
    queryKey: ['global-search', debouncedQuery],
    queryFn: async (): Promise<SearchResult[]> => {
      if (!debouncedQuery) return [];
      const { data, error } = await supabase.rpc('global_search', { search_term: debouncedQuery });
      if (error) throw new Error(error.message);
      return data || [];
    },
    enabled: !!debouncedQuery,
  });

  return { query, setQuery, results: data, isLoading };
}
```

#### **Step 4: Create the Command Palette Component**

**File:** `components/common/CommandPalette.tsx`
```typescript
"use client";

import { useEffect, useState } from "react";
import { Command } from "cmdk";
import { useRouter } from "next/navigation";
import { useCommandPaletteSearch, SearchResult } from "@/hooks/useCommandPaletteSearch";
import { FiUsers, FiServer, FiGitMerge, FiHome, FiSearch, FiLogIn } from "react-icons/fi";
import NavItems from "../navigation/sidebar-components/NavItems";

interface Props {
  isOpen: boolean;
  setIsOpen: (open: boolean) => void;
}

const iconMap: Record<string, React.ReactNode> = {
  user: <FiUsers />,
  node: <FiServer />,
  system: <FiGitMerge />,
  page: <FiHome />,
};

export function CommandPalette({ isOpen, setIsOpen }: Props) {
  const router = useRouter();
  const { query, setQuery, results, isLoading } = useCommandPaletteSearch();
  const navItems = NavItems();

  useEffect(() => {
    const down = (e: KeyboardEvent) => {
      if (e.key === "k" && (e.metaKey || e.ctrlKey)) {
        e.preventDefault();
        setIsOpen(!isOpen);
      }
    };
    document.addEventListener("keydown", down);
    return () => document.removeEventListener("keydown", down);
  }, [isOpen, setIsOpen]);

  const runCommand = (command: () => void) => {
    setIsOpen(false);
    command();
  };

  const handleSelect = (result: SearchResult) => {
    runCommand(() => router.push(result.href));
  };

  return (
    <Command.Dialog open={isOpen} onOpenChange={setIsOpen} label="Global command menu">
      <Command.Input value={query} onValueChange={setQuery} placeholder="Type a command or search..." />
      <Command.List>
        <Command.Empty>{isLoading ? "Searching..." : "No results found."}</Command.Empty>

        {/* Static Navigation Group */}
        <Command.Group heading="Navigation">
          {navItems.filter(item => item.href && !item.children).map(item => (
            <Command.Item key={item.id} onSelect={() => runCommand(() => router.push(item.href!))}>
              {item.icon}
              <span>{item.label}</span>
            </Command.Item>
          ))}
        </Command.Group>
        
        {/* Dynamic Search Results Group */}
        {results && results.length > 0 && (
          <Command.Group heading="Search Results">
            {results.map((result) => (
              <Command.Item key={result.id} onSelect={() => handleSelect(result)}>
                {iconMap[result.type] || <FiLogIn />}
                <div>
                  <p>{result.title}</p>
                  <p className="text-xs text-gray-500">{result.subtitle}</p>
                </div>
              </Command.Item>
            ))}
          </Command.Group>
        )}
      </Command.List>
    </Command.Dialog>
  );
}
```

#### **Step 5: Integrate into the Layout**

Finally, add the palette to your main dashboard layout so it's always available.

**File:** `components/dashboard/DashboardContent.tsx` (or `app/dashboard/layout.tsx`)
```typescript
"use client";

import { ReactNode, useState } from "react";
// ... other imports
import { CommandPalette } from "../common/CommandPalette";
import { FiSearch } from "react-icons/fi";

function DashboardContent({ children, /* ... other props */ }) {
  // ... existing code
  const [isCommandPaletteOpen, setIsCommandPaletteOpen] = useState(false);

  return (
      <ColumnManagementProvider /* ... */>
        <Sidebar /* ... */ />
        
        {/* Add the Command Palette here */}
        <CommandPalette isOpen={isCommandPaletteOpen} setIsOpen={setIsCommandPaletteOpen} />

        <div /* main content area */>
          {/* Update DashboardHeader to include a trigger button */}
          <DashboardHeader 
            onMenuClick={() => setIsCollapsed(false)} 
            onSearchClick={() => setIsCommandPaletteOpen(true)} // Add this prop
          />
          {/* ... rest of the content */}
        </div>
      </ColumnManagementProvider>
  );
}

// And update the DashboardHeader component
// components/dashboard/DashboardHeader.tsx

interface DashboardHeaderProps {
  onMenuClick: () => void;
  onSearchClick: () => void; // Add this
  title?: string;
}

export default function DashboardHeader({ onMenuClick, onSearchClick, title = "Dashboard" }: DashboardHeaderProps) {
  // ...
  return (
    <header>
      {/* ... */}
      <div className="flex items-center space-x-4">
        <button onClick={onSearchClick} className="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
            <FiSearch />
        </button>
        {/* ... auth button and theme toggle */}
      </div>
      {/* ... */}
    </header>
  );
}
```

This completes the full implementation of these advanced features. You now have a draggable interface for path management, an interactive visualizer, a global command palette, and a safer deletion process.

Of course. After a thorough review of all the SQL files provided, I can say this is an exceptionally well-designed and robust database schema. It demonstrates a deep understanding of PostgreSQL features, security best practices (especially within a Supabase context), and modular design.

My feedback is organized into two main sections:
1.  **Strengths**: Highlighting the excellent patterns and practices you've implemented.
2.  **Suggestions for Improvement**: Minor corrections and suggestions for further refinement and reduction of boilerplate.

---

### Strengths (Excellent Work Here)

Your project is a textbook example of how to build a secure, scalable, and maintainable database.

1.  **Rock-Solid Security Model**:
    *   **Row-Level Security (RLS)**: Your RLS implementation is top-tier. The use of `SECURITY INVOKER` on views is the correct way to ensure policies are enforced for the calling user.
    *   **Granular Policies**: The policies for roles like `maan_admin` and `sdh_admin` are perfect. Using `EXISTS` subqueries to check the `system_type_id` of related records is the precise, secure way to implement attribute-based access control.
    *   **`SECURITY DEFINER` with `search_path`**: In your trigger functions and utilities, using `SECURITY DEFINER` combined with `SET search_path = ''` is a critical security best practice that prevents potential privilege escalation attacks. This is often overlooked, and it's excellent that you've implemented it.

2.  **Comprehensive Auditing**:
    *   The `log_user_activity` and `log_data_changes` trigger function pair is a fantastic, generic auditing solution. It correctly captures the user, role, operation type, and both the old and new data as `JSONB`, making it incredibly powerful for tracking changes.

3.  **Efficient and Modern PostgreSQL Usage**:
    *   **Window Functions for Counts**: Using `count(*) OVER()` and `sum(...) OVER()` in your views (`v_systems_complete`, `v_nodes_complete`, etc.) is the most performant way to get total counts alongside paginated data, avoiding extra `COUNT` queries.
    *   **Full-Text Search (FTS)**: The use of GIN indexes on `to_tsvector` for `remark` fields is the correct and most efficient way to implement full-text search in PostgreSQL.
    *   **Data Integrity**: You make excellent use of foreign keys (`ON DELETE SET NULL` / `CASCADE`), `UNIQUE` constraints, and `CHECK` constraints to ensure data integrity at the database level.

4.  **Well-Structured and Modular Design**:
    *   The separation of concerns into different modules (core, systems, auditing, security) is very clean.
    *   The use of a centralized `lookup_types` table is a highly scalable pattern for managing dropdowns and enumerated values.
    *   The generic `systems` and `system_connections` tables, with specialized one-to-one tables for different system types (`maan_systems`, `sdh_systems`), is a great implementation of the "class table inheritance" pattern.

---

### Suggestions for Improvement & Fixes

These are mostly minor refinements to reduce code duplication and enhance consistency.

#### 1. Typo in Screenshot (UI Layer)

*   **Observation**: The screenshot shows a filter dropdown with the label "All Statuss".
*   **Correction**: This is likely a typo in your front-end code, as the database schema correctly uses the singular "Status".

#### 2. Consolidate Duplicate System-Specific Tables

*   **Observation**: The tables `cpan_systems` and `maan_systems` are structurally identical. They both contain `system_id`, `ring_no`, and `area_id`.
    ```sql
    -- telecom_network_db/03_network_systems/1_tables/04_cpan_systems.sql
    create table cpan_systems (
      system_id UUID primary key references systems (id) on delete CASCADE,
      ring_no UUID references rings (id),
      area_id UUID references maintenance_areas (id)
    );

    -- telecom_network_db/03_network_systems/1_tables/06_maan_systems.sql
    create table maan_systems (
      system_id UUID primary key references systems (id) on delete CASCADE,
      ring_no UUID references rings (id),
      area_id UUID references maintenance_areas (id) -- Mapped to area_id
    );
    ```
*   **Suggestion**: You can consolidate these into a single table to reduce redundancy. This makes it easier to manage ring-based systems in the future.

    **Example Consolidation:**
    ```sql
    -- Create a new, single table for ring-based systems
    CREATE TABLE ring_based_systems (
      system_id UUID PRIMARY KEY REFERENCES systems(id) ON DELETE CASCADE,
      ring_id UUID REFERENCES rings(id),
      maintenance_area_id UUID REFERENCES maintenance_areas(id)
    );

    -- You would then remove cpan_systems and maan_systems tables.
    -- Your views and policies would need to be updated to join against this new table.
    ```

#### 3. Reduce Boilerplate in Paginated Functions

*   **Observation**: Your `get_paged_...` functions (e.g., `get_paged_nodes_complete`, `get_paged_ofc_cables_complete`) are excellent but contain a lot of repeated boilerplate code for constructing the `where_clause` and the final `sql_query`.
*   **Suggestion**: Consider creating a single, more generic pagination function that takes the view name and a list of searchable columns as parameters. This is an advanced refactor but can significantly reduce code duplication.

    **Conceptual Example of a Generic Function:**
    ```sql
    CREATE OR REPLACE FUNCTION get_paged_data(
        p_view_name TEXT,
        p_limit INT,
        p_offset INT,
        -- ... other params
        p_filters JSONB
    )
    RETURNS TABLE (...) -- You can use a generic record or JSONB return type
    AS $$
    DECLARE
        -- Logic to dynamically build the query for the given p_view_name
    BEGIN
        -- ... build dynamic query using format() ...
        RETURN QUERY EXECUTE sql_query;
    END;
    $$ LANGUAGE plpgsql;
    ```
    This is just a conceptual idea; your current approach is perfectly functional and secure, but this could be a future enhancement.

#### 4. Consider PostgreSQL `ENUM` Type for Fixed Positions

*   **Observation**: In `sdh_node_associations`, the `node_position` uses a `CHAR(1)` with a `CHECK` constraint.
    ```sql
    -- telecom_network_db/03_network_systems/1_tables/10_sdh_node_associations.sql
    node_position CHAR(1) check (
      node_position in ('A', 'B', 'C', 'D', 'E', 'F', 'G', 'H')
    )
    ```
*   **Suggestion**: This is a perfect use case for a PostgreSQL `ENUM` type. ENUMs are type-safe, self-documenting, and can be more efficient.

    **Example Implementation:**
    ```sql
    -- Define the type once
    CREATE TYPE sdh_position AS ENUM ('A', 'B', 'C', 'D', 'E', 'F', 'G', 'H');

    -- Use it in your table
    CREATE TABLE sdh_node_associations (
      -- ...
      node_position sdh_position,
      -- ...
    );
    ```

Overall, this is a very impressive project. The few suggestions here are minor refinements on an already outstanding foundation.
```

<!-- path: hnvtx/postcss.config.mjs -->
```mjs
const config = {
  plugins: ["@tailwindcss/postcss"],
};

export default config;

```

<!-- path: hnvtx/lib/utils.ts -->
```typescript
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

```

<!-- path: hnvtx/lib/queryClient.ts -->
```typescript

// lib/queryClient.ts
import { QueryClient } from '@tanstack/react-query'

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5 minutes
      gcTime: 10 * 60 * 1000, // 10 minutes (formerly cacheTime)
      retry: (failureCount, error: Error) => {
        // Don't retry on 4xx errors
        if ('status' in error && typeof error.status === 'number' && error.status >= 400 && error.status < 500) {
          return false
        }
        return failureCount < 3
      },
      refetchOnWindowFocus: false,
    },
    mutations: {
      retry: 1,
    },
  },
})
```

